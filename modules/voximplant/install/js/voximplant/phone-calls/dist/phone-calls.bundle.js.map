{"version":3,"file":"phone-calls.bundle.js","sources":["../src/view/common.js","../src/view/keypad.js","../src/view/background-worker/base-worker.js","../src/view/background-worker/desktop-worker.js","../src/view/background-worker/browser-worker.js","../src/view/background-worker.js","../src/view/form-manager.js","../src/view/call-list.js","../src/view/folded-view.js","../src/view/desktop.js","../src/view/view.js","../src/controller.js","../src/index.js"],"sourcesContent":["export const baseZIndex = 15000;\nexport const nop = function() {};\n","import {Dom, Type, Text, Loc} from 'main.core';\nimport {Popup, Menu} from 'main.popup';\nimport {baseZIndex, nop} from './common';\n\nconst digits = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '*', '0', '#']\n\ntype KeypadParams = {\n\tbindElement: ?HTMLElement,\n\toffsetTop: ?number,\n\toffsetLeft: ?number,\n\tanglePosition: ?string,\n\tangleOffset: ?number,\n\thistory: string[],\n\tdefaultLineId: string,\n\tlines: Object,\n\tavailableLines: string[],\n\tcallInterceptAllowed: boolean,\n\thideDial: boolean,\n\tonButtonClick: () => void,\n\tonDial: () => void,\n\tonIntercept: () => void,\n\tonClose: () => void,\n}\n\nexport class Keypad\n{\n\tconstructor(params: KeypadParams)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {}\n\t\t}\n\n\t\tthis.bindElement = params.bindElement || null;\n\t\tthis.offsetTop = params.offsetTop || 0;\n\t\tthis.offsetLeft = params.offsetLeft || 0;\n\t\tthis.anglePosition = params.anglePosition || '';\n\t\tthis.angleOffset = params.angleOffset || 0;\n\t\tthis.history = params.history || [];\n\n\t\tthis.selectedLineId = params.defaultLineId;\n\t\tthis.lines = params.lines || {}\n\t\tthis.availableLines = params.availableLines || [];\n\n\t\tthis.callInterceptAllowed = params.callInterceptAllowed === true;\n\n\t\tthis.zIndex = baseZIndex + 200;\n\n\t\t//flags\n\t\tthis.hideDial = (params.hideDial === true);\n\t\tthis.plusEntered = false;\n\n\t\tthis.callbacks = {\n\t\t\tonButtonClick: Type.isFunction(params.onButtonClick) ? params.onButtonClick : nop,\n\t\t\tonDial: Type.isFunction(params.onDial) ? params.onDial : nop,\n\t\t\tonIntercept: Type.isFunction(params.onIntercept) ? params.onIntercept : nop,\n\t\t\tonClose: Type.isFunction(params.onClose) ? params.onClose : nop\n\t\t}\n\n\t\tthis.elements = {\n\t\t\tinputContainer: null,\n\t\t\tinput: null,\n\t\t\tlineSelector: null,\n\t\t\tlineName: null,\n\t\t\tinterceptButton: null,\n\t\t\thistoryButton: null\n\t\t}\n\t\tthis.plusKeyTimeout = null;\n\n\t\tthis.popup = this.createPopup();\n\t}\n\n\tcreatePopup()\n\t{\n\t\tlet popupOptions = {\n\t\t\tid: 'phone-call-view-popup-keypad',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tdarkMode: true,\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcontent: this.render(),\n\t\t\tnoAllPaddings: true,\n\n\t\t\toffsetTop: this.offsetTop,\n\t\t\toffsetLeft: this.offsetLeft,\n\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this)\n\t\t\t}\n\t\t}\n\n\t\tif (this.anglePosition !== '')\n\t\t{\n\t\t\tpopupOptions.angle = {\n\t\t\t\tposition: this.anglePosition,\n\t\t\t\toffset: this.angleOffset\n\t\t\t}\n\t\t}\n\n\t\treturn new Popup(popupOptions);\n\t}\n\n\tonPopupClose()\n\t{\n\t\tthis.callbacks.onClose();\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\t}\n\n\tcanSelectLine()\n\t{\n\t\treturn this.availableLines.length > 1;\n\t}\n\n\tsetSelectedLineId(lineId)\n\t{\n\t\tthis.selectedLineId = lineId;\n\n\t\tif (this.elements.lineName)\n\t\t{\n\t\t\tthis.elements.lineName.innerText = this.getLineName(lineId)\n\t\t}\n\t}\n\n\tgetLineName(lineId)\n\t{\n\t\treturn this.lines.hasOwnProperty(lineId) ? this.lines[lineId].SHORT_NAME : '';\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-calc-wrap\" + (BX.MessengerCommon.isPage() ? ' bx-messenger-calc-wrap-desktop' : '')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-calc-body\"}, children: [\n\t\t\t\t\t\tthis.elements.inputContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-calc-panel'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-calc-panel-delete\"}, events: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onDeleteButtonClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.input = Dom.create(\"input\", {\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\t'readonly': this.hideDial,\n\t\t\t\t\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\t\t\t\t\tvalue: '',\n\t\t\t\t\t\t\t\t\t\tplaceholder: Loc.getMessage(this.hideDial ? 'IM_PHONE_PUT_DIGIT' : 'IM_PHONE_PUT_NUMBER')\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-calc-panel-input\"},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tkeydown: this._onInputKeydown.bind(this),\n\t\t\t\t\t\t\t\t\t\tkeyup: () => this._onAfterNumberChanged()\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-calc-btns-block\"},\n\t\t\t\t\t\t\tchildren: digits.map(\n\t\t\t\t\t\t\t\tdigit => renderNumber(digit, this._onKeyMouseDown.bind(this), this._onKeyMouseUp.bind(this))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.hideDial ? null : Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-wrap\"}, children: [\n\t\t\t\t\t\tthis.elements.lineSelector = !this.canSelectLine() ? null : Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"im-phone-select-line\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.lineName = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"im-phone-select-line-name\"},\n\t\t\t\t\t\t\t\t\ttext: this.getLineName(this.selectedLineId)\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"span\", {props: {className: \"im-phone-select-line-select\"}})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onLineSelectClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-separate\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-text\"},\n\t\t\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL')\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onDialButtonClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.historyButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-arrow\"},\n\t\t\t\t\t\t\t\t\tevents: {click: this._onShowHistoryButtonClick.bind(this)}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.interceptButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"im-phone-intercept-button\" + (this.callInterceptAllowed ? \"\" : \" im-phone-intercept-button-locked\")},\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"IM_PHONE_CALL_VIEW_INTERCEPT\"),\n\t\t\t\t\t\t\tevents: {click: this._onInterceptButtonClick.bind(this)}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\t_onInputKeydown(e: KeyboardEvent)\n\t{\n\t\tif (e.keyCode == 13)\n\t\t{\n\t\t\tthis.callbacks.onDial({\n\t\t\t\tphoneNumber: this.elements.input.value,\n\t\t\t\tlineId: this.selectedLineId\n\t\t\t});\n\t\t}\n\t\telse if (e.keyCode == 37 || e.keyCode == 39 || e.keyCode == 8 || e.keyCode == 107 || e.keyCode == 46 || e.keyCode == 35 || e.keyCode == 36) // left, right, backspace, num plus, home, end\n\t\t{}\n\t\telse if (e.key === '+' || e.key === '#' || e.key === '*') // +\n\t\t{}\n\t\telse if ((e.keyCode == 67 || e.keyCode == 86 || e.keyCode == 65 || e.keyCode == 88) && (e.metaKey || e.ctrlKey)) // ctrl+v/c/a/x\n\t\t{}\n\t\telse if (e.keyCode >= 48 && e.keyCode <= 57 && !e.shiftKey) // 0-9\n\t\t{\n\t\t\tinsertAtCursor(this.elements.input, e.key);\n\n\t\t\te.preventDefault();\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tkey: e.key\n\t\t\t});\n\t\t}\n\t\telse if (e.keyCode >= 96 && e.keyCode <= 105 && !e.shiftKey) // extra 0-9\n\t\t{\n\t\t\tinsertAtCursor(this.elements.input, e.key);\n\n\t\t\te.preventDefault();\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tkey: e.key\n\t\t\t});\n\t\t}\n\t\telse if (!e.ctrlKey && !e.metaKey && !e.altKey)\n\t\t{\n\t\t\te.preventDefault();\n\t\t}\n\t}\n\n\t_onAfterNumberChanged()\n\t{\n\t\tthis.elements.inputContainer.classList.toggle('bx-messenger-calc-panel-active', this.elements.input.value.length > 0);\n\n\t\tthis.elements.input.focus();\n\t}\n\n\t_onDeleteButtonClick()\n\t{\n\t\tthis.elements.input.value = this.elements.input.value.substr(0, this.elements.input.value.length - 1);\n\t\tthis._onAfterNumberChanged();\n\t}\n\n\t_onDialButtonClick()\n\t{\n\t\tthis.callbacks.onDial({\n\t\t\tphoneNumber: this.elements.input.value,\n\t\t\tlineId: this.selectedLineId\n\t\t});\n\t}\n\n\t_onInterceptButtonClick()\n\t{\n\t\tthis.callbacks.onIntercept({\n\t\t\tinterceptButton: this.elements.interceptButton\n\t\t})\n\t}\n\n\t_onKeyMouseDown(key)\n\t{\n\t\tif (key === '0')\n\t\t{\n\t\t\tthis.plusEntered = false;\n\t\t\tthis.plusKeyTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (!this.elements.input.value.startsWith('+'))\n\t\t\t\t{\n\t\t\t\t\tthis.plusEntered = true;\n\t\t\t\t\tthis.elements.input.value = '+' + this.elements.input.value;\n\t\t\t\t}\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\t_onKeyMouseUp(key)\n\t{\n\t\tif (key === '0')\n\t\t{\n\t\t\tclearTimeout(this.plusKeyTimeout);\n\t\t\tif (!this.plusEntered)\n\t\t\t{\n\t\t\t\tinsertAtCursor(this.elements.input, '0');\n\t\t\t}\n\n\t\t\tthis.plusEntered = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tinsertAtCursor(this.elements.input, key);\n\t\t}\n\t\tthis._onAfterNumberChanged();\n\t\tthis.callbacks.onButtonClick({\n\t\t\tkey: key\n\t\t});\n\t}\n\n\t_onShowHistoryButtonClick()\n\t{\n\t\tlet menuItems = [];\n\n\t\tif (!Type.isArray(this.history) || this.history.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.history.forEach((phoneNumber, index) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: \"history_\" + index,\n\t\t\t\ttext: Text.encode(phoneNumber),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.historySelectMenu.close();\n\t\t\t\t\tthis.callbacks.onDial({\n\t\t\t\t\t\tphoneNumber: phoneNumber,\n\t\t\t\t\t\tlineId: this.selectedLineId\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.historySelectMenu = new Menu(\n\t\t\t'phoneCallViewDialHistory',\n\t\t\tthis.elements.historyButton,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tzIndex: baseZIndex + 300,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'top'\n\t\t\t\t},\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 33\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'white',\n\t\t\t\t\topacity: 0\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.historySelectMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.historySelectMenu = null,\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.historySelectMenu.show();\n\t}\n\n\t_onLineSelectClick(e)\n\t{\n\t\tlet menuItems = [];\n\t\tthis.availableLines.forEach((lineId) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: \"selectLine_\" + lineId,\n\t\t\t\ttext: Text.encode(this.getLineName(lineId)),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.lineSelectMenu.close();\n\t\t\t\t\tthis.setSelectedLineId(lineId);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.lineSelectMenu = new Menu(\n\t\t\t'phoneCallViewSelectLine',\n\t\t\tthis.elements.lineSelector,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\tzIndex: this.zIndex + 100,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'top'\n\t\t\t\t},\n\t\t\t\toffsetLeft: 35,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 33\n\t\t\t\t},\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'white',\n\t\t\t\t\topacity: 0\n\t\t\t\t},\n\t\t\t\tmaxHeight: 600,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.lineSelectMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.lineSelectMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.lineSelectMenu.show();\n\t}\n\n\tshow()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\tthis.elements.input.focus();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.lineSelectMenu)\n\t\t{\n\t\t\tthis.lineSelectMenu.destroy();\n\t\t}\n\n\t\tif (this.historySelectMenu)\n\t\t{\n\t\t\tthis.historySelectMenu.destroy();\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.lineSelectMenu)\n\t\t{\n\t\t\tthis.lineSelectMenu.destroy();\n\t\t}\n\n\t\tif (this.historySelectMenu)\n\t\t{\n\t\t\tthis.historySelectMenu.destroy();\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\n\t\tthis.popup = null;\n\t}\n}\n\nfunction renderNumber(number: string, onMouseDown, onMouseUp)\n{\n\tlet classSuffix;\n\tif (number == '*')\n\t{\n\t\tclassSuffix = '10';\n\t}\n\telse if (number == '#')\n\t{\n\t\tclassSuffix = '11';\n\t}\n\telse\n\t{\n\t\tclassSuffix = number;\n\t}\n\treturn Dom.create(\"span\", {\n\t\tdataset: {'digit': number},\n\t\tprops: {className: \"bx-messenger-calc-btn bx-messenger-calc-btn-\" + classSuffix},\n\t\tchildren: [\n\t\t\tDom.create(\"span\", {props: {className: 'bx-messenger-calc-btn-num'}})\n\t\t],\n\t\tevents: {\n\t\t\tmousedown: (e) => onMouseDown(e.currentTarget.dataset.digit),\n\t\t\tmouseup: (e) => onMouseUp(e.currentTarget.dataset.digit)\n\t\t}\n\t});\n}\n\nfunction insertAtCursor(inputElement, value)\n{\n\tif (inputElement.selectionStart || inputElement.selectionStart == '0')\n\t{\n\t\tvar startPos = inputElement.selectionStart;\n\t\tvar endPos = inputElement.selectionEnd;\n\t\tinputElement.value = inputElement.value.substring(0, startPos)\n\t\t\t+ value\n\t\t\t+ inputElement.value.substring(endPos, inputElement.value.length);\n\t\tinputElement.selectionStart = startPos + value.length;\n\t\tinputElement.selectionEnd = startPos + value.length;\n\t}\n\telse\n\t{\n\t\tinputElement.value += value;\n\t}\n}","import {UiState, PhoneCallView, desktopEvents} from \"../view\";\n\n\nexport const callCardEvents = {\n\taddCommentButtonClick: 'addCommentButtonClick',\n\tmuteButtonClick: 'muteButtonClick',\n\tholdButtonClick: 'holdButtonClick',\n\ttransferButtonClick: 'transferButtonClick',\n\tcancelTransferButtonClick: 'cancelTransferButtonClick',\n\tcompleteTransferButtonClick: 'completeTransferButtonClick',\n\thangupButtonClick: 'hangupButtonClick',\n\tnextButtonClick: 'nextButtonClick',\n\tskipButtonClick: 'skipButtonClick',\n\tanswerButtonClick: 'answerButtonClick',\n\tentityChanged: 'entityChanged',\n\tqualityMeterClick: 'qualityMeterClick',\n\tdialpadButtonClick: 'dialpadButtonClick',\n\tmakeCallButtonClick: 'makeCallButtonClick',\n\tnotifyAdminButtonClick: 'notifyAdminButtonClick',\n\tcloseButtonClick: 'closeButtonClick',\n};\n\nconst UndefinedCallCard = {\n\tresult: 'error',\n\terrorCode: 'Call card is undefined'\n}\n\n/** @abstract */\nexport class BaseWorker\n{\n\n\tisExternalCall: boolean = false;\n\tused: boolean = false;\n\tCallCard: ?PhoneCallView;\n\n\n\n\t/** @abstract */\n\tinitializePlacement(): BaseWorker\n\t{\n\t\tthrow new Error('You have to implement the method initializePlacement!');\n\t}\n\n\t/** @abstract */\n\tinitializeInterface(placement: Object): BaseWorker\n\t{\n\t\tthrow new Error('You have to implement the method initializeInterface!');\n\t}\n\n\t/** @abstract */\n\temitInitializeEvent(params)\n\t{\n\t\tthrow new Error('You have to implement the method emitInitializeEvent!');\n\t}\n\n\t/** @abstract */\n\temitEvent(name: string, params)\n\t{\n\t\tthrow new Error('You have to implement the method emitEvent!');\n\t};\n\n\tsetCallCard(callCard: ?PhoneCallView): BaseWorker\n\t{\n\t\tthis.CallCard = callCard;\n\n\t\treturn this;\n\t}\n\n\tsetIsExternalCall(isExternalCall: boolean): BaseWorker\n\t{\n\t\tthis.isExternalCall = isExternalCall;\n\n\t\treturn this;\n\t}\n\n\tisCardActive(): boolean\n\t{\n\t\treturn this.CallCard instanceof PhoneCallView;\n\t}\n\n\tisUsed(): boolean\n\t{\n\t\treturn this.used;\n\t}\n\n\tinitializeInterfaceEvents(placement: Object): BaseWorker\n\t{\n\t\tplacement.prototype.events.push('BackgroundCallCard::initialized');\n\t\tplacement.prototype.events.push('BackgroundCallCard::addCommentButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::muteButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::holdButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::closeButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::transferButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::cancelTransferButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::completeTransferButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::hangupButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::nextButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::skipButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::answerButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::entityChanged');\n\t\tplacement.prototype.events.push('BackgroundCallCard::qualityMeterClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::dialpadButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::makeCallButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::notifyAdminButtonClick');\n\n\t\treturn this;\n\t}\n\n\tgetEvents()\n\t{\n\t\treturn callCardEvents;\n\t}\n\n\tgetListUiStates(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tcallback(Object.keys(UiState).filter((state) =>\n\t\t{\n\t\t\tswitch (state)\n\t\t\t{\n\t\t\t\tcase 'sipPhoneError':\n\t\t\t\t\treturn false;\n\t\t\t\tcase 'idle':\n\t\t\t\t\treturn false;\n\t\t\t\tcase 'externalCard':\n\t\t\t\t\treturn false;\n\t\t\t\tdefault:\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t}));\n\t}\n\n\tsetUiState(params: {uiState: string, disableAutoStartTimer: ?boolean}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params && params.uiState && UiState[params.uiState])\n\t\t{\n\t\t\tthis.CallCard.setUiState(UiState[params.uiState]);\n\t\t\t// BX.onCustomEvent(window, \"CallCard::CallStateChanged\", [callState, additionalParams]);\n\t\t\t// this.setOnSlave(desktopEvents.setCallState, [callState, additionalParams]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'Invalid ui state'\n\t\t\t}]);\n\n\t\t\treturn;\n\t\t}\n\t\tif (params.uiState === 'connected')\n\t\t{\n\t\t\tif (params.disableAutoStartTimer)\n\t\t\t{\n\t\t\t\tthis.CallCard.stopTimer();\n\t\t\t\tthis.hideTimer();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showTimer();\n\t\t\t}\n\t\t}\n\n\t\tif (params.uiState !== 'connected' && !this.CallCard.isTimerStarted())\n\t\t{\n\t\t\tthis.hideTimer();\n\t\t}\n\n\t\tcallback([]);\n\t}\n\n\tsetMute(params: {muted: boolean}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.CallCard.isMuted() === !!params.muted)\n\t\t{\n\t\t\tcallback([]);\n\n\t\t\treturn;\n\t\t}\n\t\tif (params.muted)\n\t\t{\n\t\t\tthis.CallCard.setMuted(params.muted)\n\t\t\tBX.addClass(this.CallCard.elements.buttons.mute, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.mute();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.CallCard.setMuted(params.muted)\n\t\t\tBX.removeClass(this.CallCard.elements.buttons.mute, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onUnMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.unmute();\n\t\t\t}\n\t\t}\n\t\tcallback([]);\n\t}\n\n\tsetHold(params: {held: boolean}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.CallCard.isHeld() === !!params.held)\n\t\t{\n\t\t\tcallback([]);\n\n\t\t\treturn;\n\t\t}\n\t\tif (params.held)\n\t\t{\n\t\t\tthis.CallCard.setHeld(params.held)\n\t\t\tBX.addClass(this.CallCard.elements.buttons.hold, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.hold();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.CallCard.setHeld(params.held);\n\t\t\tBX.removeClass(this.CallCard.elements.buttons.hold, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onUnHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.unhold();\n\t\t\t}\n\t\t}\n\t\tcallback([]);\n\t}\n\n\tstartTimer(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showTimer();\n\t\tthis.CallCard.startTimer();\n\t}\n\n\tstopTimer(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.CallCard.stopTimer();\n\t}\n\n\tclose(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.CallCard.close();\n\t\tcallback([]);\n\n\t\tthis.CallCard = false;\n\t}\n\n\tsetCardTitle(params: {title: string}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.CallCard.setTitle(params.title);\n\t\tcallback([]);\n\t}\n\n\tsetStatusText(params: {statusText: string}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.CallCard.setStatusText(params.statusText);\n\t\tcallback([]);\n\t}\n\n\tshowTimer(): void\n\t{\n\t\tif (!this.CallCard.elements.timer.visible)\n\t\t{\n\t\t\tthis.CallCard.sections.timer.visible = true;\n\t\t\tthis.CallCard.elements.timer.style.display = '';\n\t\t\tif(this.CallCard.isFolded())\n\t\t\t{\n\t\t\t\tthis.CallCard.unfoldedElements.timer.style.display = '';\n\t\t\t}\n\t\t}\n\t}\n\n\thideTimer(): void\n\t{\n\t\tif (this.CallCard.sections.timer)\n\t\t{\n\t\t\tthis.CallCard.sections.timer.visible = false;\n\t\t}\n\t\tif (this.CallCard.elements.timer)\n\t\t{\n\t\t\tthis.CallCard.elements.timer.style.display = 'none';\n\t\t}\n\t\tthis.CallCard.initialTimestamp = 0;\n\t}\n\n\tgetUndefinedCallCardError()\n\t{\n\t\treturn UndefinedCallCard;\n\t}\n}","import {BaseWorker} from \"./base-worker\";\nimport {UiState} from \"../view\";\n\nconst desktopMethodEvents = {\n\tsetUiState: 'DesktopCallCardSetUiState',\n\tsetMute: 'DesktopCallCardSetMute',\n\tsetHold: 'DesktopCallCardSetHold',\n\tgetListUiState: 'DesktopCallCardGetListUiState',\n\tsetCardTitle: 'DesktopCallCardSetCardTitle',\n\tsetStatusText: 'DesktopCallCardSetStatusText',\n\tclose: 'DesktopCallCardClose',\n\tstartTimer: 'DesktopCallCardStartTimer',\n\tstopTimer: 'DesktopCallCardStopTimer',\n};\n\nconst corporatePortalPageEvents = {\n\taddCommentButtonClick: 'DesktopCallCardAddCommentButtonClick',\n\tmuteButtonClick: 'DesktopCallCardMuteButtonClick',\n\tholdButtonClick: 'DesktopCallCardHoldButtonClick',\n\ttransferButtonClick: 'DesktopCallCardTransferButtonClick',\n\tcancelTransferButtonClick: 'DesktopCallCardCancelTransferButtonClick',\n\tcompleteTransferButtonClick: 'DesktopCallCardCompleteTransferButtonClick',\n\thangupButtonClick: 'DesktopCallCardHangupButtonClick',\n\tnextButtonClick: 'DesktopCallCardNextButtonClick',\n\tskipButtonClick: 'DesktopCallCardSkipButtonClick',\n\tanswerButtonClick: 'DesktopCallCardAnswerButtonClick',\n\tentityChanged: 'DesktopCallCardEntityChanged',\n\tqualityMeterClick: 'DesktopCallCardQualityMeterClick',\n\tdialpadButtonClick: 'DesktopCallCardDialpadButtonClick',\n\tmakeCallButtonClick: 'DesktopCallCardMakeCallButtonClick',\n\tnotifyAdminButtonClick: 'DesktopCallCardNotifyAdminButtonClick',\n};\n\nexport class DesktopWorker extends BaseWorker\n{\n\n\teventHandlers: Array;\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.eventHandlers = [];\n\t}\n\n\tisCardActive(): boolean\n\t{\n\t\treturn super.isCardActive() || this.CallCard !== null;\n\t}\n\n\tinitializePlacement()\n\t{\n\t\tconst placement = BX.rest.AppLayout.initializePlacement('PAGE_BACKGROUND_WORKER');\n\n\t\tthis.initializeInterfaceMethods(placement);\n\t\tthis.initializeInterfaceEvents(placement);\n\t\tthis.addEventHandlersForEventsFromCallCard();\n\t}\n\n\tinitializeInterface(placement)\n\t{\n\n\t\tthis.initializeInterfaceMethods(placement);\n\t\tthis.addTransmitEventHandlers();\n\n\t}\n\tinitializeInterfaceMethods(placement)\n\t{\n\t\tplacement.prototype.CallCardGetListUiStates = (params, callback) => this.getListUiStates(params, callback);\n\n\t\tplacement.prototype.CallCardSetMute = (params, callback) => this.transmitSetMute(params, callback);\n\t\tplacement.prototype.CallCardSetHold = (params, callback) => this.transmitSetHold(params, callback);\n\t\tplacement.prototype.CallCardSetUiState = (params, callback) => this.transmitSetUiState(params, callback);\n\t\tplacement.prototype.CallCardSetCardTitle = (params, callback) => this.transmitSetCardTitle(params, callback);\n\t\tplacement.prototype.CallCardSetStatusText = (params, callback) => this.transmitSetStatusText(params, callback);\n\t\tplacement.prototype.CallCardClose = (params, callback) => this.transmitClose(params, callback);\n\t\tplacement.prototype.CallCardStartTimer = (params, callback) => this.transmitStartTimer(params, callback);\n\t\tplacement.prototype.CallCardStopTimer = (params, callback) => this.transmitStopTimer(params, callback);\n\t}\n\n\temitInitializeEvent(params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isCallCardPage())\n\t\t{\n\t\t\tBXDesktopSystem.BroadcastEvent('DesktopCallCardInitialized', [params]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"BackgroundCallCard::initialized\", [params]);\n\t}\n\n\temitEvent(name: string, params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isCallCardPage())\n\t\t{\n\t\t\tconst desktopEventName = 'DesktopCallCard' + (name[0].toUpperCase() + name.slice(1));\n\t\t\tBXDesktopSystem.BroadcastEvent(desktopEventName, [params]);\n\t\t}\n\n\t\tBX.onCustomEvent(window, 'BackgroundCallCard::' + name, [params]);\n\t}\n\n\tremoveDesktopEventHandlers()\n\t{\n\t\tfor (const event in this.getEvents())\n\t\t{\n\t\t\tthis.removeCustomEvents('DesktopCallCard' + (event[0].toUpperCase() + event.slice(1)));\n\t\t}\n\t\tthis.removeCustomEvents('DesktopCallCardInitialized');\n\t\tthis.removeCustomEvents('DesktopCallCardCloseButtonClick');\n\t}\n\t/*\n\t Transmit an event about changing the call card by calling methods\n\t from the rest application from the corporate portal window\n\t */\n\t//region Transmit events\n\n\taddTransmitEventHandlers()\n\t{\n\t\tthis\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.getListUiState,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getListUiStates)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setUiState,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setUiState)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setMute,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setMute)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setHold,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setHold)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setCardTitle,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setCardTitle)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setStatusText,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setStatusText)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.close,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().close)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.startTimer,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().startTimer)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.stopTimer,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().stopTimer)\n\t\t\t);\n\t}\n\n\tonTransmitHandler(params: any, callback: Function, handler: Function)\n\t{\n\t\tif (this.isCorporatePortalPage())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.used = true;\n\t\tcallback = typeof (callback) === 'function' ? callback : BX.DoNothing;\n\n\t\thandler(params, callback);\n\t}\n\n\ttransmitSetUiState(params: {uiState: string, disableAutoStartTimer?: boolean}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('uiState') || !UiState[params.uiState])\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'Invalid ui state'\n\t\t\t}]);\n\n\t\t\treturn;\n\t\t}\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setUiState, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetMute(params: {muted: boolean}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('muted'))\n\t\t{\n\t\t\tcallback({\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field muted'\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setMute, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetHold(params: {held: boolean}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!params.hasOwnProperty('held'))\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field held'\n\t\t\t}]);\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setHold, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitStartTimer(params: {}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.startTimer, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitStopTimer(params: {}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.stopTimer, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitClose(params: {}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.CallCard = null;\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.close, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetCardTitle(params: {title: string}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('title'))\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field title'\n\t\t\t}]);\n\n\t\t\treturn\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setCardTitle, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetStatusText(params: {statusText: string}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('statusText'))\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field statusText'\n\t\t\t}]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setStatusText, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\t//endregion\n\n\taddEventHandlersForEventsFromCallCard()\n\t{\n\t\tif (!this.isCorporatePortalPage())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor (const event in this.getEvents())\n\t\t{\n\t\t\tthis.addCustomEvent(corporatePortalPageEvents[event], (params, callback) =>\n\t\t\t{\n\t\t\t\tBX.onCustomEvent(window, 'BackgroundCallCard::' + event, [params, callback]);\n\t\t\t})\n\t\t}\n\n\t\tthis.addCustomEvent('DesktopCallCardInitialized', (params, callback) =>\n\t\t{\n\t\t\tif (!this.CallCard)\n\t\t\t{\n\t\t\t\tthis.CallCard = true;\n\t\t\t}\n\t\t\tBX.onCustomEvent(window, 'BackgroundCallCard::initialized', [params, callback]);\n\t\t});\n\n\t\tthis.addCustomEvent('DesktopCallCardCloseButtonClick', (params, callback) =>\n\t\t{\n\t\t\tthis.CallCard = null;\n\t\t\tBX.onCustomEvent(window, 'BackgroundCallCard::closeButtonClick', [params, callback]);\n\t\t});\n\t}\n\taddCustomEvent(eventName: string, eventHandler: Function)\n\t{\n\t\tconst realHandler = function (e)\n\t\t{\n\t\t\tconst arEventParams = [];\n\t\t\tfor (const i in e.detail)\n\t\t\t{\n\t\t\t\tarEventParams.push(e.detail[i]);\n\t\t\t}\n\n\t\t\teventHandler.apply(window, arEventParams);\n\t\t};\n\n\t\tif (!this.eventHandlers[eventName])\n\t\t{\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\t}\n\n\t\tthis.eventHandlers[eventName].push(realHandler);\n\t\twindow.addEventListener(eventName, realHandler);\n\n\t\treturn this;\n\t}\n\n\tremoveCustomEvents(eventName)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.eventHandlers[eventName].forEach(eventHandler => window.removeEventListener(eventName, eventHandler));\n\t\tthis.eventHandlers[eventName] = [];\n\t}\n\n\tisCallCardPage(): boolean\n\t{\n\t\treturn BXDesktopWindow.GetWindowId() !== BXDesktopSystem.GetMainWindow().GetWindowId()\n\t}\n\n\tisCorporatePortalPage(): boolean\n\t{\n\t\treturn !BX.MessengerCommon.isDesktop();\n\t}\n\n\tgetCallCardWindow(): window\n\t{\n\t\treturn BXWindows.find(element => element.name === 'callWindow');\n\t}\n\n\tgetCallCardPlatformWorker(): BaseWorker\n\t{\n\t\tconst callWindow = this.getCallCardWindow();\n\n\t\treturn callWindow.PCW.backgroundWorker.platformWorker;\n\t}\n}","import {BaseWorker} from \"./base-worker\";\n\n\nexport class BrowserWorker extends BaseWorker\n{\n\n\tinitializePlacement()\n\t{\n\t\tconst placement = BX.rest.AppLayout.initializePlacement('PAGE_BACKGROUND_WORKER');\n\n\t\tthis.initializeInterface(placement);\n\t\tthis.initializeInterfaceEvents(placement)\n\t}\n\n\tinitializeInterface(placement)\n\t{\n\t\tplacement.prototype.CallCardSetMute = (params, callback) => this.setMute(params, callback);\n\t\tplacement.prototype.CallCardSetHold = (params, callback) => this.setHold(params, callback);\n\t\tplacement.prototype.CallCardSetUiState = (params, callback) => this.setUiState(params, callback);\n\t\tplacement.prototype.CallCardGetListUiStates = (params, callback) => this.getListUiStates(params, callback);\n\t\tplacement.prototype.CallCardSetCardTitle = (params, callback) => this.setCardTitle(params, callback);\n\t\tplacement.prototype.CallCardSetStatusText = (params, callback) => this.setStatusText(params, callback);\n\t\tplacement.prototype.CallCardClose = (params, callback) => this.close(params, callback);\n\t\tplacement.prototype.CallCardStartTimer = (params, callback) => this.startTimer(params, callback);\n\t\tplacement.prototype.CallCardStopTimer = (params, callback) => this.stopTimer(params, callback);\n\t}\n\temitEvent(name: string, params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.onCustomEvent(window, 'BackgroundCallCard::' + name, [params]);\n\t}\n\n\temitInitializeEvent(params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"BackgroundCallCard::initialized\", [params]);\n\t}\n}","import {PhoneCallView} from './view'\nimport {BaseWorker, callCardEvents} from \"./background-worker/base-worker\";\nimport {DesktopWorker} from \"./background-worker/desktop-worker\";\nimport {BrowserWorker} from \"./background-worker/browser-worker\";\n\n\nexport const backgroundWorkerEvents = callCardEvents;\n\nlet instance: BackgroundWorker;\n\nexport class BackgroundWorker\n{\n\tplatformWorker: BaseWorker;\n\n\tconstructor()\n\t{\n\t\tthis.initializePlacement();\n\t}\n\tstatic getInstance(): BackgroundWorker\n\t{\n\t\tif (!instance)\n\t\t{\n\t\t\tinstance = new BackgroundWorker();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tsetCallCard(callCard: ?PhoneCallView)\n\t{\n\t\tthis.platformWorker.CallCard = callCard;\n\t}\n\n\tinitializePlacement()\n\t{\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tthis.platformWorker = new DesktopWorker();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.platformWorker = new BrowserWorker();\n\t\t}\n\n\t\tthis.platformWorker.initializePlacement();\n\t}\n\n\temitEvent(name: string, params)\n\t{\n\t\tthis.platformWorker.emitEvent(name, params);\n\t}\n\n\tremoveDesktopEventHandlers()\n\t{\n\t\tthis.platformWorker.removeDesktopEventHandlers();\n\t}\n\tisDesktop()\n\t{\n\t\treturn typeof (BXDesktopSystem) !== 'undefined';\n\t}\n\n\tisUsed()\n\t{\n\t\treturn this.platformWorker.isUsed();\n\t}\n\n\tisActiveIntoCurrentCall()\n\t{\n\t\treturn this.isExternalCall && this.isUsed();\n\t}\n\n\tsetExternalCall(isExternalCall: boolean)\n\t{\n\t\tthis.platformWorker.setIsExternalCall(isExternalCall);\n\t}\n}\n","import {Type} from 'main.core';\n\nconst nop = function(){}\n\nexport class FormManager\n{\n\tconstructor(params)\n\t{\n\t\tthis.node = params.node;\n\t\tthis.currentForm = null;\n\t\tthis.callbacks = {\n\t\t\tonFormLoad: Type.isFunction(params.onFormLoad) ? params.onFormLoad : nop,\n\t\t\tonFormUnLoad: Type.isFunction(params.onFormUnLoad) ? params.onFormUnLoad : nop,\n\t\t\tonFormSend: Type.isFunction(params.onFormSend) ? params.onFormSend : nop\n\t\t}\n\t}\n\n\t/**\n\t * @param {object} params\n\t * @param {int} params.id\n\t * @param {string} params.secCode\n\t */\n\tload(params)\n\t{\n\t\tlet formData = this.getFormData(params);\n\t\twindow.Bitrix24FormLoader.load(formData);\n\t\tthis.currentForm = formData;\n\t};\n\n\tunload()\n\t{\n\t\tif (this.currentForm)\n\t\t{\n\t\t\twindow.Bitrix24FormLoader.unload(this.currentForm);\n\t\t\tthis.currentForm = null;\n\t\t}\n\t};\n\n\t/**\n\t * @param {object} params\n\t * @param {int} params.id\n\t * @param {string} params.secCode\n\t * @returns {object}\n\t */\n\tgetFormData(params)\n\t{\n\t\treturn {\n\t\t\tid: params.id,\n\t\t\tsec: params.secCode,\n\t\t\ttype: 'inline',\n\t\t\tlang: 'ru',\n\t\t\tref: window.location.href,\n\t\t\tnode: this.node,\n\t\t\thandlers:\n\t\t\t\t{\n\t\t\t\t\t'load': this._onFormLoad.bind(this),\n\t\t\t\t\t'unload': this._onFormUnLoad.bind(this),\n\t\t\t\t\t'send': this.onFormSend.bind(this)\n\t\t\t\t},\n\t\t\toptions:\n\t\t\t\t{\n\t\t\t\t\t'borders': false,\n\t\t\t\t\t'logo': false\n\t\t\t\t}\n\t\t}\n\t};\n\n\t_onFormLoad(form)\n\t{\n\t\tthis.callbacks.onFormLoad(form);\n\t}\n\n\t_onFormUnLoad(form)\n\t{\n\t\tthis.callbacks.onFormUnLoad(form);\n\t}\n\n\tonFormSend(form)\n\t{\n\t\tthis.callbacks.onFormSend(form);\n\t}\n}","import {Dom, Type, Text, Loc} from 'main.core';\nimport {Menu} from 'main.popup'\nimport {baseZIndex, nop} from './common'\n\nexport class CallList\n{\n\tconstructor(params)\n\t{\n\t\tthis.node = params.node;\n\t\tthis.id = params.id;\n\n\t\tthis.entityType = '';\n\t\tthis.statuses = new Map(); // {STATUS_ID (string): { STATUS_NAME; string, CLASS: string, ITEMS: []}\n\t\tthis.elements = {};\n\t\tthis.currentStatusId = params.callListStatusId || 'IN_WORK';\n\t\tthis.currentItemIndex = params.itemIndex || 0;\n\t\tthis.callingStatusId = null;\n\t\tthis.callingItemIndex = null;\n\t\tthis.selectionLocked = false;\n\n\t\t// this.itemActionMenu = null;\n\t\tthis.callbacks = {\n\t\t\tonError: Type.isFunction(params.onError) ? params.onError : nop,\n\t\t\tonSelectedItem: Type.isFunction(params.onSelectedItem) ? params.onSelectedItem : nop\n\t\t};\n\n\t\tthis.showLimit = 10;\n\t\tthis.showDelta = 10;\n\t}\n\n\tinit(next)\n\t{\n\t\tif (!Type.isFunction(next))\n\t\t{\n\t\t\tnext = nop;\n\t\t}\n\n\t\tthis.load(() =>\n\t\t{\n\t\t\tconst currentStatus = this.statuses.get(this.currentStatusId)\n\t\t\tif (currentStatus && currentStatus.ITEMS.length > 0)\n\t\t\t{\n\t\t\t\tthis.update();\n\t\t\t\tthis.selectItem(this.currentStatusId, this.currentItemIndex);\n\t\t\t\tnext();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.debug('empty call list. don\\'t know what to do');\n\t\t\t}\n\t\t})\n\t};\n\n\t/**\n\t * @param {object} params\n\t * @param {Node} params.node DOM node to render call list.\n\t */\n\treinit(params)\n\t{\n\t\tif (Type.isDomNode(params.node))\n\t\t{\n\t\t\tthis.node = params.node;\n\t\t}\n\n\t\tthis.update();\n\t\tthis.selectItem(this.currentStatusId, this.currentItemIndex);\n\t\tif (this.callingStatusId !== null && this.callingItemIndex !== null)\n\t\t{\n\t\t\tthis.setCallingElement(this.callingStatusId, this.callingItemIndex);\n\t\t}\n\n\t};\n\n\tload(next)\n\t{\n\t\tconst params = {\n\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t'ajax_action': 'GET_CALL_LIST',\n\t\t\t'callListId': this.id\n\t\t};\n\n\t\tBX.ajax({\n\t\t\turl: CallList.getAjaxUrl(),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\tdata: params,\n\t\t\tonsuccess: (data) =>\n\t\t\t{\n\t\t\t\tif (!data.ERROR)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isArray(data.STATUSES))\n\t\t\t\t\t{\n\t\t\t\t\t\t//this.statuses = data.STATUSES;\n\t\t\t\t\t\tdata.STATUSES.forEach((statusRecord) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstatusRecord.ITEMS = [];\n\t\t\t\t\t\t\tthis.statuses.set(statusRecord.STATUS_ID, statusRecord);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tdata.ITEMS.forEach((item) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet itemStatus = this.statuses.get(item.STATUS_ID);\n\t\t\t\t\t\t\tif (itemStatus)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titemStatus.ITEMS.push(item);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.entityType = data.ENTITY_TYPE;\n\t\t\t\t\tlet currentStatus = this.statuses.get(this.currentStatusId);\n\t\t\t\t\tif (currentStatus && currentStatus.ITEMS.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentStatusId = this.getNonEmptyStatusId();\n\t\t\t\t\t\tthis.currentItemIndex = 0;\n\t\t\t\t\t}\n\t\t\t\t\tnext();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tselectItem(statusId, newIndex)\n\t{\n\t\tlet currentNode = this.statuses.get(this.currentStatusId).ITEMS[this.currentItemIndex]._node;\n\t\tBX.removeClass(currentNode, 'im-phone-call-list-customer-block-active');\n\n\t\tif (this.itemActionMenu)\n\t\t{\n\t\t\tthis.itemActionMenu.close();\n\t\t}\n\n\t\tthis.currentStatusId = statusId;\n\t\tthis.currentItemIndex = newIndex;\n\n\t\tcurrentNode = this.statuses.get(this.currentStatusId).ITEMS[this.currentItemIndex]._node;\n\t\tBX.addClass(currentNode, 'im-phone-call-list-customer-block-active');\n\n\t\tconst newEntity = this.statuses.get(statusId).ITEMS[newIndex];\n\n\t\tif ((this.entityType == 'DEAL' || this.entityType == 'QUOTE' || this.entityType == 'INVOICE') && newEntity.ASSOCIATED_ENTITY)\n\t\t{\n\t\t\tthis.callbacks.onSelectedItem({\n\t\t\t\ttype: newEntity.ASSOCIATED_ENTITY.TYPE,\n\t\t\t\tid: newEntity.ASSOCIATED_ENTITY.ID,\n\t\t\t\tbindings: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: this.entityType,\n\t\t\t\t\t\tid: newEntity.ELEMENT_ID\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tphones: newEntity.ASSOCIATED_ENTITY.PHONES,\n\t\t\t\tstatusId: statusId,\n\t\t\t\tindex: newIndex\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onSelectedItem({\n\t\t\t\ttype: this.entityType,\n\t\t\t\tid: newEntity.ELEMENT_ID,\n\t\t\t\tphones: newEntity.PHONES,\n\t\t\t\tstatusId: statusId,\n\t\t\t\tindex: newIndex\n\t\t\t});\n\t\t}\n\t};\n\n\tmoveToNextItem()\n\t{\n\t\tvar newIndex = this.currentItemIndex + 1;\n\t\tif (newIndex >= this.statuses.get(this.currentStatusId).ITEMS.length)\n\t\t{\n\t\t\tnewIndex = 0;\n\t\t}\n\n\t\tthis.selectItem(this.currentStatusId, newIndex);\n\t};\n\n\tsetCallingElement(statusId, index)\n\t{\n\t\tthis.callingStatusId = statusId;\n\t\tthis.callingItemIndex = index;\n\t\tconst currentNode = this.statuses.get(this.callingStatusId).ITEMS[this.callingItemIndex]._node;\n\t\tBX.addClass(currentNode, 'im-phone-call-list-customer-block-calling');\n\t\tthis.selectionLocked = true;\n\t};\n\n\tresetCallingElement()\n\t{\n\t\tif (this.callingStatusId === null || this.callingItemIndex === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentNode = this.statuses.get(this.callingStatusId).ITEMS[this.callingItemIndex]._node;\n\t\tBX.removeClass(currentNode, 'im-phone-call-list-customer-block-calling');\n\t\tthis.callingStatusId = null;\n\t\tthis.callingItemIndex = null;\n\t\tthis.selectionLocked = false;\n\t};\n\n\tupdate()\n\t{\n\t\tDom.clean(this.node)\n\t\tthis.node.append(this.render())\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-list-container'},\n\t\t\tchildren: this.renderStatusBlocks()\n\t\t});\n\t};\n\n\trenderStatusBlocks(): HTMLElement[]\n\t{\n\t\tlet result = [];\n\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tif (!status || status.ITEMS.length === 0)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tstatus._node = this.renderStatusBlock(status);\n\t\t\tresult.push(status._node);\n\t\t}\n\t\treturn result;\n\t};\n\n\trenderCallListItems(statusId): HTMLElement[]\n\t{\n\t\tlet result = [];\n\t\tconst status = this.statuses.get(statusId);\n\n\t\tif (status._shownCount > 0)\n\t\t{\n\t\t\tif (status._shownCount > status.ITEMS.length)\n\t\t\t{\n\t\t\t\tstatus._shownCount = status.ITEMS.length;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstatus._shownCount = Math.min(this.showLimit, status.ITEMS.length);\n\t\t}\n\n\t\tfor (let i = 0; i < status._shownCount; i++)\n\t\t{\n\t\t\tresult.push(this.renderCallListItem(status.ITEMS[i], statusId, i));\n\t\t}\n\n\t\tif (status.ITEMS.length > status._shownCount)\n\t\t{\n\t\t\tstatus._showMoreNode = Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-call-list-show-more-wrap'}, children: [\n\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-call-list-show-more-button'},\n\t\t\t\t\t\tdataset: {statusId: statusId},\n\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_LIST_MORE').replace('#COUNT#', (status.ITEMS.length - status._shownCount)),\n\t\t\t\t\t\tevents: {click: this.onShowMoreClick.bind(this)}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t});\n\t\t\tresult.push(status._showMoreNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstatus._showMoreNode = null;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\trenderCallListItem(itemDescriptor, statusId, itemIndex)\n\t{\n\t\tconst statusName = this.statuses.get(statusId).NAME;\n\n\t\tlet phonesText = '';\n\t\tif (Type.isArray(itemDescriptor.PHONES))\n\t\t{\n\t\t\titemDescriptor.PHONES.forEach((phone, index) =>\n\t\t\t{\n\t\t\t\tif (index !== 0)\n\t\t\t\t{\n\t\t\t\t\tphonesText += '; ';\n\t\t\t\t}\n\n\t\t\t\tphonesText += Text.encode(phone.VALUE);\n\t\t\t})\n\t\t}\n\n\t\titemDescriptor._node = Dom.create(\"div\", {\n\t\t\tprops: {className: (this.currentStatusId == statusId && this.currentItemIndex == itemIndex ? 'im-phone-call-list-customer-block im-phone-call-list-customer-block-active' : 'im-phone-call-list-customer-block')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-customer-block-action'},\n\t\t\t\t\tchildren: [Dom.create(\"span\", {text: statusName})],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tif (this.itemActionMenu)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showItemMenu(itemDescriptor, e.target);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-name' + (itemDescriptor.ASSOCIATED_ENTITY ? ' im-phone-call-list-connection-line' : '')},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"a\", {\n\t\t\t\t\t\t\tattrs: {href: itemDescriptor.EDIT_URL, target: '_blank'},\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-link'},\n\t\t\t\t\t\t\ttext: itemDescriptor.NAME,\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\twindow.open(itemDescriptor.EDIT_URL);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t\t(itemDescriptor.POST ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: itemDescriptor.POST\n\t\t\t\t}) : null),\n\t\t\t\t(itemDescriptor.COMPANY_TITLE ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: itemDescriptor.COMPANY_TITLE\n\t\t\t\t}) : null),\n\t\t\t\t(phonesText ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: phonesText\n\t\t\t\t}) : null),\n\t\t\t\t(itemDescriptor.ASSOCIATED_ENTITY ? this.renderAssociatedEntity(itemDescriptor.ASSOCIATED_ENTITY) : null)\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tif (!this.selectionLocked && (this.currentStatusId != itemDescriptor.STATUS_ID || this.currentItemIndex != itemIndex))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selectItem(itemDescriptor.STATUS_ID, itemIndex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn itemDescriptor._node;\n\t};\n\n\trenderAssociatedEntity(associatedEntity)\n\t{\n\t\tlet phonesText = '';\n\t\tif (Type.isArray(associatedEntity.PHONES))\n\t\t{\n\t\t\tassociatedEntity.PHONES.forEach((phone, index) =>\n\t\t\t{\n\t\t\t\tif (index !== 0)\n\t\t\t\t{\n\t\t\t\t\tphonesText += '; ';\n\t\t\t\t}\n\n\t\t\t\tphonesText += Text.encode(phone.VALUE);\n\t\t\t})\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-list-item-customer-entity im-phone-call-list-connection-line-item'},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"a\", {\n\t\t\t\t\tattrs: {href: associatedEntity.EDIT_URL, target: '_blank'},\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-link'},\n\t\t\t\t\ttext: associatedEntity.NAME,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\twindow.open(associatedEntity.EDIT_URL);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: associatedEntity.POST\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: associatedEntity.COMPANY_TITLE\n\t\t\t\t}),\n\t\t\t\t(phonesText ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: phonesText\n\t\t\t\t}) : null)\n\t\t\t]\n\t\t});\n\t};\n\n\tonShowMoreClick(e)\n\t{\n\t\tvar statusId = e.target.dataset.statusId;\n\t\tvar status = this.statuses.get(statusId);\n\n\t\tstatus._shownCount += this.showDelta;\n\t\tif (status._shownCount > status.ITEMS.length)\n\t\t{\n\t\t\tstatus._shownCount = status.ITEMS.length;\n\t\t}\n\n\t\tconst newStatusNode = this.renderStatusBlock(status);\n\t\tstatus._node.parentNode.replaceChild(newStatusNode, status._node);\n\t\tstatus._node = newStatusNode;\n\t};\n\n\tshowItemMenu(callListItem, node)\n\t{\n\t\tlet menuItems = [];\n\t\tlet menuItem;\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tmenuItem = {\n\t\t\t\tid: \"setStatus_\" + statusId,\n\t\t\t\ttext: status.NAME,\n\t\t\t\tonclick: this.actionMenuItemClickHandler(callListItem.ELEMENT_ID, statusId).bind(this)\n\t\t\t};\n\t\t\tmenuItems.push(menuItem);\n\t\t}\n\t\tmenuItems.push({\n\t\t\tid: 'callListItemActionMenu_delimiter',\n\t\t\tdelimiter: true\n\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: \"defer15min\",\n\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_DEFER_15_MIN'),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\tthis.setElementRank(callListItem.ELEMENT_ID, callListItem.RANK + 35);\n\t\t\t}\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: \"defer1hour\",\n\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_DEFER_HOUR'),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\tthis.setElementRank(callListItem.ELEMENT_ID, callListItem.RANK + 185);\n\t\t\t}\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: \"moveToEnd\",\n\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_TO_END'),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\tthis.setElementRank(callListItem.ELEMENT_ID, callListItem.RANK + 5100);\n\t\t\t}\n\t\t});\n\n\t\tthis.itemActionMenu = new Menu(\n\t\t\t'callListItemActionMenu',\n\t\t\tnode,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: {position: \"top\"},\n\t\t\t\tzIndex: baseZIndex + 200,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.itemActionMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.itemActionMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.itemActionMenu.show();\n\t};\n\n\tactionMenuItemClickHandler(elementId, statusId)\n\t{\n\t\treturn () =>\n\t\t{\n\t\t\tthis.itemActionMenu.close();\n\t\t\tthis.setElementStatus(elementId, statusId);\n\t\t}\n\t};\n\n\tsetElementRank(elementId, rank)\n\t{\n\t\tthis.executeItemAction({\n\t\t\taction: 'SET_ELEMENT_RANK',\n\t\t\tparameters: {\n\t\t\t\tcallListId: this.id,\n\t\t\t\telementId: elementId,\n\t\t\t\trank: rank\n\t\t\t},\n\t\t\tsuccessCallback: (data) =>\n\t\t\t{\n\t\t\t\tif (data.ITEMS)\n\t\t\t\t{\n\t\t\t\t\tthis.repopulateItems(data.ITEMS);\n\t\t\t\t\tthis.update();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tsetElementStatus(elementId, statusId)\n\t{\n\t\tthis.executeItemAction({\n\t\t\taction: 'SET_ELEMENT_STATUS',\n\t\t\tparameters: {\n\t\t\t\tcallListId: this.id,\n\t\t\t\telementId: elementId,\n\t\t\t\tstatusId: statusId\n\t\t\t},\n\t\t\tsuccessCallback: (data) =>\n\t\t\t{\n\t\t\t\tthis.repopulateItems(data.ITEMS);\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t})\n\t};\n\n\t/**\n\t * @param {int} elementId\n\t * @param {int} webformResultId\n\t */\n\tsetWebformResult(elementId, webformResultId)\n\t{\n\t\tthis.executeItemAction({\n\t\t\taction: 'SET_WEBFORM_RESULT',\n\t\t\tparameters: {\n\t\t\t\tcallListId: this.id,\n\t\t\t\telementId: elementId,\n\t\t\t\twebformResultId: webformResultId\n\t\t\t}\n\t\t})\n\t};\n\n\texecuteItemAction(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (!Type.isFunction(params.successCallback))\n\t\t{\n\t\t\tparams.successCallback = nop;\n\t\t}\n\n\t\tvar requestParams = {\n\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t'ajax_action': params.action,\n\t\t\t'parameters': params.parameters\n\t\t};\n\n\t\tBX.ajax({\n\t\t\turl: CallList.getAjaxUrl(),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\tdata: requestParams,\n\t\t\tonsuccess: (data) => params.successCallback(data)\n\t\t});\n\t};\n\n\trepopulateItems(items)\n\t{\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tstatus.ITEMS = [];\n\t\t}\n\n\t\titems.forEach((item) => this.statuses.get(item.STATUS_ID).ITEMS.push(item));\n\n\t\tif (this.statuses.get(this.currentStatusId).ITEMS.length === 0)\n\t\t{\n\t\t\tthis.currentStatusId = this.getNonEmptyStatusId();\n\t\t\tthis.currentItemIndex = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.currentItemIndex >= this.statuses.get(this.currentStatusId).ITEMS.length)\n\t\t\t{\n\t\t\t\tthis.currentItemIndex = 0;\n\t\t\t}\n\t\t}\n\n\t\tthis.selectItem(this.currentStatusId, this.currentItemIndex);\n\t};\n\n\tgetNonEmptyStatusId()\n\t{\n\t\tlet foundStatusId = false;\n\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tif (status.ITEMS.length > 0)\n\t\t\t{\n\t\t\t\tfoundStatusId = statusId;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn foundStatusId;\n\t};\n\n\tgetCurrentElement()\n\t{\n\t\treturn this.statuses.get(this.currentStatusId).ITEMS[this.currentItemIndex];\n\t};\n\n\tgetStatusTitle(statusId)\n\t{\n\t\tconst count = this.statuses.get(statusId).ITEMS.length;\n\n\t\treturn Text.encode(this.statuses.get(statusId).NAME) + ' (' + count.toString() + ')';\n\t};\n\n\trenderStatusBlock(status)\n\t{\n\t\tlet animationTimeout;\n\t\tlet itemsNode;\n\t\tlet measuringNode;\n\t\tconst statusId = status.STATUS_ID;\n\n\t\tif (!status.hasOwnProperty('_folded'))\n\t\t{\n\t\t\tstatus._folded = false;\n\t\t}\n\n\t\tlet className = 'im-phone-call-list-block';\n\n\t\tif (status.CLASS != '')\n\t\t{\n\t\t\tclassName = className + ' ' + status.CLASS;\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: className}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-block-title' + (status._folded ? '' : ' active')},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"span\", {text: this.getStatusTitle(statusId)}),\n\t\t\t\t\t\tDom.create(\"div\", {props: {className: 'im-phone-call-list-block-title-arrow'}})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (e: Event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault()\n\t\t\t\t\t\t\tclearTimeout(animationTimeout);\n\t\t\t\t\t\t\tstatus._folded = !status._folded;\n\t\t\t\t\t\t\tif (status._folded)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.removeClass(e.target, 'active');\n\t\t\t\t\t\t\t\titemsNode.style.height = measuringNode.clientHeight.toString() + 'px';\n\t\t\t\t\t\t\t\tanimationTimeout = setTimeout(function ()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titemsNode.style.height = 0;\n\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.addClass(e.target, 'active');\n\t\t\t\t\t\t\t\titemsNode.style.height = 0;\n\t\t\t\t\t\t\t\tanimationTimeout = setTimeout(function ()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titemsNode.style.height = measuringNode.clientHeight + 'px';\n\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\titemsNode = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-items-block'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tmeasuringNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-list-items-measuring'},\n\t\t\t\t\t\t\tchildren: this.renderCallListItems(statusId)\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\ttransitionend: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!status._folded)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titemsNode.style.removeProperty('height');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\tstatic getAjaxUrl(): string\n\t{\n\t\treturn (BX.MessengerCommon.isDesktop() ? '/desktop_app/call_list.ajax.php' : '/bitrix/components/bitrix/crm.activity.call_list/ajax.php')\n\t}\n}\n","import {Dom, Loc, Text, Type} from 'main.core';\nimport {CallList} from './call-list'\n\nlet foldedCallListInstance = null;\nlet avatars = {};\n\nexport class FoldedCallView\n{\n\tconstructor()\n\t{\n\t\tthis.currentItem = {};\n\t\tthis.callListParams = {\n\t\t\tid: 0,\n\t\t\twebformId: 0,\n\t\t\twebformSecCode: '',\n\t\t\titemIndex: 0,\n\t\t\titemStatusId: '',\n\t\t\tstatusList: {},\n\t\t\tentityType: ''\n\t\t};\n\t\tthis.node = null;\n\t\tthis.elements = {\n\t\t\tavatar: null,\n\t\t\tcallButton: null,\n\t\t\tnextButton: null,\n\t\t\tunfoldButton: null\n\t\t};\n\t\tthis._lsKey = 'bx-im-folded-call-view-data';\n\t\tthis._lsTtl = 86400;\n\t\tthis.init();\n\t}\n\n\tstatic getInstance(): FoldedCallView\n\t{\n\t\tif (foldedCallListInstance === null)\n\t\t{\n\t\t\tfoldedCallListInstance = new FoldedCallView();\n\t\t}\n\n\t\treturn foldedCallListInstance;\n\t};\n\n\tinit()\n\t{\n\t\tthis.load();\n\t\tif (this.callListParams.id > 0)\n\t\t{\n\t\t\tthis.currentItem = this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS[this.callListParams.itemIndex];\n\t\t\tthis.render();\n\t\t}\n\t};\n\n\tload()\n\t{\n\t\tvar savedData = BX.localStorage.get(this._lsKey);\n\t\tif (Type.isPlainObject(savedData))\n\t\t{\n\t\t\tthis.callListParams = savedData;\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.node)\n\t\t{\n\t\t\tDom.remove(this.node);\n\t\t\tthis.node = null;\n\t\t}\n\n\t\tBX.localStorage.remove(this._lsKey);\n\t};\n\n\tstore()\n\t{\n\t\tBX.localStorage.set(this._lsKey, this.callListParams, this._lsTtl);\n\t};\n\n\tfold(params, animation)\n\t{\n\t\tanimation = (animation === true);\n\t\tthis.callListParams.id = params.callListId;\n\t\tthis.callListParams.webformId = params.webformId;\n\t\tthis.callListParams.webformSecCode = params.webformSecCode;\n\t\tthis.callListParams.itemIndex = params.currentItemIndex;\n\t\tthis.callListParams.itemStatusId = params.currentItemStatusId;\n\t\tthis.callListParams.statusList = Object.fromEntries(params.statusList);\n\t\tthis.callListParams.entityType = params.entityType;\n\t\tthis.currentItem = this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS[this.callListParams.itemIndex];\n\t\tthis.store();\n\t\tthis.render(animation);\n\t};\n\n\tunfold(makeCall)\n\t{\n\t\tDom.addClass(this.node, \"im-phone-folded-call-view-unfold\");\n\t\tthis.node.addEventListener('animationend', () =>\n\t\t{\n\t\t\tif (this.node)\n\t\t\t{\n\t\t\t\tDom.remove(this.node);\n\t\t\t\tthis.node = null;\n\t\t\t}\n\n\t\t\tBX.localStorage.remove(this._lsKey);\n\t\t\tif (!window.BXIM || this.callListParams.id === 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar restoredParams = {};\n\t\t\tif (this.callListParams.webformId > 0 && this.callListParams.webformSecCode !== '')\n\t\t\t{\n\t\t\t\trestoredParams.webformId = this.callListParams.webformId;\n\t\t\t\trestoredParams.webformSecCode = this.callListParams.webformSecCode;\n\t\t\t}\n\t\t\trestoredParams.callListStatusId = this.callListParams.itemStatusId;\n\t\t\trestoredParams.callListItemIndex = this.callListParams.itemIndex;\n\t\t\trestoredParams.makeCall = makeCall;\n\n\t\t\t// TODO: WTF is happening here?\n\t\t\twindow.BXIM.startCallList(this.callListParams.id, restoredParams);\n\t\t});\n\t};\n\n\tmoveToNext()\n\t{\n\t\tthis.callListParams.itemIndex++;\n\t\tif (this.callListParams.itemIndex >= this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS.length)\n\t\t{\n\t\t\tthis.callListParams.itemIndex = 0;\n\t\t}\n\n\t\tthis.currentItem = this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS[this.callListParams.itemIndex];\n\t\tthis.store();\n\t\tthis.render();\n\t};\n\n\trender(animation)\n\t{\n\t\tanimation = (animation === true);\n\t\tif (this.node === null)\n\t\t{\n\t\t\tthis.node = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tid: 'im-phone-folded-call-view',\n\t\t\t\t\tclassName: 'im-phone-call-wrapper im-phone-call-wrapper-fixed im-phone-call-panel'\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tdblclick: this._onViewDblClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tdocument.body.appendChild(this.node);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.clean(this.node);\n\t\t}\n\n\t\tthis.node.appendChild(Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-left'},\n\t\t\tstyle: (animation ? {bottom: '-90px'} : {}),\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user'}, children: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-image'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {props: {className: 'im-phone-call-wrapper-fixed-user-image-item'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-info'},\n\t\t\t\t\t\t\tchildren: this.renderUserInfo()\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t}));\n\n\t\tthis.node.appendChild(Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-right'}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-btn-container'}, children: [\n\t\t\t\t\t\tthis.elements.callButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn im-phone-call-btn-green'},\n\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_FOLDED_BUTTON_CALL'),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onDialButtonClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.nextButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn im-phone-call-btn-gray im-phone-call-btn-arrow'},\n\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_FOLDED_BUTTON_NEXT'),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onNextButtonClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t}));\n\n\t\tthis.node.appendChild(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-btn-block'}, children: [\n\t\t\t\t\tthis.elements.unfoldButton = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-btn-arrow'},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: 'im-phone-btn-arrow-inner'},\n\t\t\t\t\t\t\t\ttext: Loc.getMessage(\"IM_PHONE_CALL_VIEW_UNFOLD\")\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t],\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: this._onUnfoldButtonClick.bind(this)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t})\n\t\t);\n\n\t\tif (avatars[this.currentItem.ELEMENT_ID])\n\t\t{\n\t\t\tthis.elements.avatar.style.backgroundImage = 'url(\\'' + Text.encode(avatars[this.currentItem.ELEMENT_ID]) + '\\')';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadAvatar(this.callListParams.entityType, this.currentItem.ELEMENT_ID);\n\t\t}\n\n\t\tif (animation)\n\t\t{\n\t\t\tDom.addClass(this.node, 'im-phone-folded-call-view-fold');\n\t\t\tthis.node.addEventListener('animationend', function ()\n\t\t\t{\n\t\t\t\tBX.removeClass(this.node, 'im-phone-folded-call-view-fold');\n\t\t\t})\n\t\t}\n\t};\n\n\trenderUserInfo()\n\t{\n\t\tvar result = [];\n\n\t\tresult.push(Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-name'},\n\t\t\ttext: this.currentItem.NAME\n\t\t}));\n\t\tif (this.currentItem.POST)\n\t\t{\n\t\t\tresult.push(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-item'},\n\t\t\t\ttext: this.currentItem.POST\n\t\t\t}));\n\t\t}\n\t\tif (this.currentItem.COMPANY_TITLE)\n\t\t{\n\t\t\tresult.push(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-item'},\n\t\t\t\ttext: this.currentItem.COMPANY_TITLE\n\t\t\t}));\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tloadAvatar(entityType, entityId)\n\t{\n\t\tBX.ajax({\n\t\t\turl: CallList.getAjaxUrl(),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t\t'ajax_action': 'GET_AVATAR',\n\t\t\t\t'entityType': entityType,\n\t\t\t\t'entityId': entityId\n\t\t\t},\n\t\t\tonsuccess: (data) =>\n\t\t\t{\n\t\t\t\tif (!data.avatar)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tavatars[entityId] = data.avatar;\n\t\t\t\tif (this.currentItem.ELEMENT_ID == entityId && this.elements.avatar)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.avatar.style.backgroundImage = 'url(\\'' + Text.encode(data.avatar) + '\\')';\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t_onViewDblClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.unfold(false);\n\t};\n\n\t_onDialButtonClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.unfold(true);\n\t};\n\n\t_onNextButtonClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.moveToNext();\n\t};\n\n\t_onUnfoldButtonClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.unfold(false);\n\t};\n}","import {Type} from 'main.core';\n\nconst desktopFeatureMap = {\n\t'iframe': 39\n};\n\nexport class Desktop\n{\n\tconstructor(params)\n\t{\n\t\tthis.parentPhoneCallView = params.parentPhoneCallView;\n\t\tthis.closable = params.closable;\n\t\tthis.title = params.title || '';\n\t\tthis.window = null;\n\t}\n\n\topenCallWindow(content, js, params)\n\t{\n\t\tif (!BX.MessengerCommon.isDesktop())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tparams = params || {};\n\n\t\tif (params.minSettingsWidth)\n\t\t{\n\t\t\tthis.minSettingsWidth = params.minSettingsWidth;\n\t\t}\n\n\t\tif (params.minSettingsHeight)\n\t\t{\n\t\t\tthis.minSettingsHeight = params.minSettingsHeight;\n\t\t}\n\n\t\tparams.resizable = (params.resizable === true);\n\n\t\tBX.desktop.createWindow(\"callWindow\", (callWindow) =>\n\t\t{\n\t\t\tcallWindow.SetProperty(\"clientSize\", {Width: params.width, Height: params.height});\n\t\t\tcallWindow.SetProperty(\"resizable\", params.resizable);\n\t\t\tif (params.resizable && params.hasOwnProperty('minWidth') && params.hasOwnProperty('minHeight'))\n\t\t\t{\n\t\t\t\tcallWindow.SetProperty(\"minClientSize\", {Width: params.minWidth, Height: params.minHeight});\n\t\t\t}\n\t\t\tcallWindow.SetProperty(\"title\", this.title);\n\t\t\tcallWindow.SetProperty(\"closable\", true);\n\t\t\t//callWindow.OpenDeveloperTools();\n\t\t\tlet html = this.getHtmlPage(content, js, {});\n\t\t\tcallWindow.ExecuteCommand(\"html.load\", html);\n\t\t\tthis.window = callWindow;\n\t\t});\n\t};\n\n\tsetClosable(closable: boolean)\n\t{\n\t\tthis.closable = (closable === true);\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.SetProperty(\"closable\", this.closable);\n\t\t}\n\t};\n\n\tsetTitle(title)\n\t{\n\t\tthis.title = title;\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.SetProperty(\"title\", title)\n\t\t}\n\t};\n\n\tgetHtmlPage(content, jsContent, initImJs, bodyClass)\n\t{\n\t\tif (!BX.MessengerCommon.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcontent = content || '';\n\t\tjsContent = jsContent || '';\n\t\tbodyClass = bodyClass || '';\n\n\t\tif (this.htmlWrapperHead == null)\n\t\t{\n\t\t\tthis.htmlWrapperHead = document.head.outerHTML.replace(/BX\\.PULL\\.start\\([^)]*\\);/g, '');\n\t\t}\n\n\t\tif (Type.isDomNode(content))\n\t\t{\n\t\t\tcontent = content.outerHTML;\n\t\t}\n\n\t\tif (Type.isDomNode(jsContent))\n\t\t{\n\t\t\tjsContent = jsContent.outerHTML;\n\t\t}\n\n\t\tif (Type.isStringFilled(jsContent))\n\t\t{\n\t\t\tjsContent =\n\t\t\t\t`<script type=\"text/javascript\">\n\t\t\t\t\tBX.ready(function() {\n\t\t\t\t\t\t${jsContent}\n\t\t\t\t\t});\n\t\t\t\t</script>`;\n\t\t}\n\n\t\tlet initJs = '';\n\t\tif (initImJs)\n\t\t{\n\t\t\tinitJs = `\n\t\t\t\t<script type=\"text/javascript\">\n\t\t\t\t\tBX.ready(function() {\n\t\t\t\t\t\t\twindow.PCW = new BX.Voximplant.PhoneCallView({\n\t\t\t\t\t\t\t\t'slave': true, \n\t\t\t\t\t\t\t\t'skipOnResize': true, \n\t\t\t\t\t\t\t\t'callId': '${this.parentPhoneCallView.callId}',\n\t\t\t\t\t\t\t\t'uiState': ${this.parentPhoneCallView._uiState},\n\t\t\t\t\t\t\t\t'phoneNumber': '${this.parentPhoneCallView.phoneNumber}',\n\t\t\t\t\t\t\t\t'companyPhoneNumber': '${this.parentPhoneCallView.companyPhoneNumber}',\n\t\t\t\t\t\t\t\t'direction': '${this.parentPhoneCallView.direction}',\n\t\t\t\t\t\t\t\t'fromUserId': '${this.parentPhoneCallView.fromUserId}',\n\t\t\t\t\t\t\t\t'toUserId': '${this.parentPhoneCallView.toUserId}',\n\t\t\t\t\t\t\t\t'crm': ${this.parentPhoneCallView.crm},\n\t\t\t\t\t\t\t\t'hasSipPhone': ${this.parentPhoneCallView.hasSipPhone},\n\t\t\t\t\t\t\t\t'deviceCall': ${this.parentPhoneCallView.deviceCall},\n\t\t\t\t\t\t\t\t'transfer': ${this.parentPhoneCallView.transfer},\n\t\t\t\t\t\t\t\t'crmEntityType': '${this.parentPhoneCallView.crmEntityType}',\n\t\t\t\t\t\t\t\t'crmEntityId': '${this.parentPhoneCallView.crmEntityId}',\n\t\t\t\t\t\t\t\t'crmActivityId': '${this.parentPhoneCallView.crmActivityId}',\n\t\t\t\t\t\t\t\t'crmActivityEditUrl': '${this.parentPhoneCallView.crmActivityEditUrl}',\n\t\t\t\t\t\t\t\t'callListId': ${this.parentPhoneCallView.callListId},\n\t\t\t\t\t\t\t\t'callListStatusId': '${this.parentPhoneCallView.callListStatusId}',\n\t\t\t\t\t\t\t\t'callListItemIndex': ${this.parentPhoneCallView.callListItemIndex},\n\t\t\t\t\t\t\t\t'config': ${this.parentPhoneCallView.config ? JSON.stringify(this.parentPhoneCallView.config) : '{}'},\n\t\t\t\t\t\t\t\t'portalCall': ${this.parentPhoneCallView.portalCall ? 'true' : 'false'},\n\t\t\t\t\t\t\t\t'portalCallData': ${this.parentPhoneCallView.portalCallData ? JSON.stringify(this.parentPhoneCallView.portalCallData) : '{}'},\n\t\t\t\t\t\t\t\t'portalCallUserId': ${this.parentPhoneCallView.portalCallUserId},\n\t\t\t\t\t\t\t\t'webformId': ${this.parentPhoneCallView.webformId},\n\t\t\t\t\t\t\t\t'webformSecCode': '${this.parentPhoneCallView.webformSecCode}',\n\t\t\t\t\t\t\t\t'restApps': ${this.parentPhoneCallView.restApps ? JSON.stringify(this.parentPhoneCallView.restApps) : '[]'},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t</script>`;\n\t\t}\n\t\treturn `\n\t\t\t<!DOCTYPE html>\n\t\t\t<html lang=\"${document.documentElement.lang}\">\n\t\t\t\t${this.htmlWrapperHead}\n\t\t\t\t<body class=\"im-desktop im-desktop-popup ${bodyClass}\">\n\t\t\t\t\t<div id=\"placeholder-messanger\">${content}</div>\n\t\t\t\t\t${initJs}\n\t\t\t\t\t${jsContent}\n\t\t\t\t</body>\n\t\t\t</html>\n\t\t`;\n\t};\n\n\taddCustomEvent(eventName, eventHandler)\n\t{\n\t\tif (!BX.MessengerCommon.isDesktop())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tBX.desktop.addCustomEvent(eventName, eventHandler);\n\t};\n\n\tonCustomEvent(windowTarget, eventName, arEventParams)\n\t{\n\t\tif (!BX.MessengerCommon.isDesktop())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tBX.desktop.onCustomEvent(windowTarget, eventName, arEventParams);\n\t};\n\n\tresize(width, height)\n\t{\n\t\tBXDesktopWindow.SetProperty(\"clientSize\", {Width: width, Height: height});\n\t};\n\n\tsetResizable(resizable)\n\t{\n\t\tresizable = (resizable === true);\n\t\tBXDesktopWindow.SetProperty(\"resizable\", resizable);\n\t};\n\n\tsetMinSize(width, height)\n\t{\n\t\tBXDesktopWindow.SetProperty(\"minClientSize\", {Width: width, Height: height});\n\t};\n\n\tsetWindowPosition(params)\n\t{\n\t\tBXDesktopWindow.SetProperty(\"position\", params);\n\t};\n\n\tcenter()\n\t{\n\t\tBXDesktopWindow.ExecuteCommand(\"center\");\n\t};\n\n\tgetVersion(full)\n\t{\n\t\tif (typeof (BXDesktopSystem) == 'undefined')\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!this.clientVersion)\n\t\t{\n\t\t\tthis.clientVersion = BXDesktopSystem.GetProperty('versionParts');\n\t\t}\n\n\t\treturn full ? this.clientVersion.join('.') : this.clientVersion[3];\n\t};\n\n\tisFeatureSupported(featureName)\n\t{\n\t\tif (!desktopFeatureMap.hasOwnProperty(featureName))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.getVersion() >= desktopFeatureMap[featureName];\n\t};\n}","/**\n * @bxjs_lang_path js_phone_call_view.php\n */\n\nimport {Dom, Type, Text, Runtime, Loc, Uri} from 'main.core';\nimport {Popup, Menu} from 'main.popup'\nimport {BackgroundWorker, backgroundWorkerEvents} from './background-worker'\nimport {FormManager} from './form-manager'\nimport {CallList} from './call-list'\nimport {FoldedCallView} from './folded-view'\nimport {Desktop} from './desktop'\nimport {Keypad} from './keypad'\nimport type {Dialog} from 'ui.entity-selector'\nimport {baseZIndex, nop} from './common'\n\nexport const Direction = {\n\tincoming: 'incoming',\n\toutgoing: 'outgoing',\n\tcallback: 'callback',\n}\n\nexport const UiState = {\n\tincoming: 1,\n\ttransferIncoming: 2,\n\toutgoing: 3,\n\tconnectingIncoming: 4,\n\tconnectingOutgoing: 5,\n\tconnected: 6,\n\ttransferring: 7,\n\ttransferFailed: 8,\n\ttransferConnected: 9,\n\tidle: 10,\n\terror: 11,\n\tmoneyError: 12,\n\tsipPhoneError: 13,\n\tredial: 14,\n\texternalCard: 15,\n}\n\nexport const CallState = {\n\tidle: 'idle',\n\tconnecting: 'connecting',\n\tconnected: 'connected',\n}\n\nexport const CallProgress = {\n\tconnect: 'connect',\n\terror: 'error',\n\toffline: 'offline',\n\tonline: 'online',\n\twait: 'wait'\n}\n\nconst ButtonLayouts = {\n\tcentered: 'centered',\n\tspaced: 'spaced'\n};\n\n/* Phone Call UI */\nconst layouts = {\n\tsimple: 'simple',\n\tcrm: 'crm'\n}\n\nconst initialSize = {\n\tsimple: {\n\t\twidth: 550,\n\t\theight: 492\n\t},\n\tcrm: {\n\t\twidth: 550,\n\t\theight: 650\n\t}\n};\n\nconst lsKeys = {\n\theight: 'im-phone-call-view-height',\n\twidth: 'im-phone-call-view-width'\n};\n\nexport const desktopEvents = {\n\tsetTitle: 'phoneCallViewSetTitle',\n\tsetStatus: 'phoneCallViewSetStatus',\n\tsetUiState: 'phoneCallViewSetUiState',\n\tsetDeviceCall: 'phoneCallViewSetDeviceCall',\n\tsetCrmEntity: 'phoneCallViewSetCrmEntity',\n\tsetPortalCall: 'phoneCallViewSetPortalCall',\n\tsetPortalCallUserId: 'phoneCallViewSetPortalCallUserId',\n\tsetPortalCallQueueName: 'phoneCallViewSetPortalCallQueueName',\n\tsetPortalCallData: 'phoneCallViewSetPortalCallData',\n\tsetConfig: 'phoneCallViewSetConfig',\n\tsetCallState: 'phoneCallViewSetCallState',\n\treloadCrmCard: 'phoneCallViewReloadCrmCard',\n\tsetCallId: 'phoneCallViewSetCallId',\n\tsetLineNumber: 'phoneCallViewSetLineNumber',\n\tsetPhoneNumber: 'phoneCallViewSetPhoneNumber',\n\tsetCompanyPhoneNumber: 'phoneCallViewSetCompanyPhoneNumber',\n\tsetTransfer: 'phoneCallViewSetTransfer',\n\tcloseWindow: 'phoneCallViewCloseWindow',\n\n\tonHold: 'phoneCallViewOnHold',\n\tonUnHold: 'phoneCallViewOnUnHold',\n\tonMute: 'phoneCallViewOnMute',\n\tonUnMute: 'phoneCallViewOnUnMute',\n\tonMakeCall: 'phoneCallViewOnMakeCall',\n\tonCallListMakeCall: 'phoneCallViewOnCallListMakeCall',\n\tonAnswer: 'phoneCallViewOnAnswer',\n\tonSkip: 'phoneCallViewOnSkip',\n\tonHangup: 'phoneCallViewOnHangup',\n\tonClose: 'phoneCallViewOnClose',\n\tonStartTransfer: 'phoneCallViewOnStartTransfer',\n\tonCompleteTransfer: 'phoneCallViewOnCompleteTransfer',\n\tonCancelTransfer: 'phoneCallViewOnCancelTransfer',\n\tonBeforeUnload: 'phoneCallViewOnBeforeUnload',\n\tonSwitchDevice: 'phoneCallViewOnSwitchDevice',\n\tonQualityGraded: 'phoneCallViewOnQualityGraded',\n\tonDialpadButtonClicked: 'phoneCallViewOnDialpadButtonClicked',\n\tonCommentShown: 'phoneCallViewOnCommentShown',\n\tonSaveComment: 'phoneCallViewOnSaveComment',\n\tonSetAutoClose: 'phoneCallViewOnSetAutoClose',\n};\n\nconst blankAvatar = '/bitrix/js/im/images/blank.gif';\n\nexport type PhoneCallViewParams = {\n\tdarkMode: boolean,\n\tphoneNumber: ?string,\n\tlineNumber: ?string,\n\tcompanyPhoneNumber: ?string,\n\tdirection: string, /** @see Direction */\n\tuiState: number, /** @see UiState */\n\n\tfromUserId: ?number,\n\ttoUserId: ?number,\n\tconfig: Object,\n\tcallId: ?string,\n\tcrmEntityType: ?string,\n\tcrmEntityId: ?number,\n\tcrmActivityId: ?number,\n\tcrmActivityEditUrl: ?string,\n\tcrmData: ?Object,\n\tcrmBindings: Array,\n\n\tportalCallData: ?Object,\n\tportalCallUserId: ?number,\n\tportalCallQueueName: ?string,\n\n\thasSipPhone: ?boolean,\n\tdeviceCall: ?boolean,\n\tportalCall: ?boolean,\n\tcrm: ?boolean,\n\trecording: ?boolean,\n\tmakeCall: ?boolean,\n\tfolded: ?boolean,\n\tautoFold: ?boolean,\n\ttransfer: ?boolean,\n\n\tstatusText: ?string,\n\tinitialTimestamp: ?number,\n\tevents: EventHandlers,\n\n\tcallListId: ?number,\n\tcallListStatusId: ?number,\n\tcallListItemIndex: ?number,\n\twebformId: ?string,\n\twebformSecCode: ?string,\n\tslave: ?boolean,\n\tskipOnResize: ?boolean,\n\n\tisExternalCall: ?boolean,\n\n\trestApps: RestApp[],\n}\n\ntype EventHandlers = {\n\thold: () => void,\n\tunhold: () => void,\n\tmute: () => void,\n\tunmute: () => void,\n\tmakeCall: () => void,\n\tcallListMakeCall: () => void,\n\tanswer: () => void,\n\tskip: () => void,\n\thangup: () => void,\n\tclose: () => void,\n\ttransfer: (TransferTarget) => void,\n\tcompleteTransfer: () => void,\n\tcancelTransfer: () => void,\n\tswitchDevice: () => void,\n\tqualityGraded: () => void,\n\tdialpadButtonClicked: () => void,\n\tsaveComment: () => void,\n\tnotifyAdmin: () => void\n}\n\ntype RestApp = {\n\tid: number,\n\tname: string\n}\n\nexport class PhoneCallView\n{\n\tpopup: ?Popup\n\trestApps: RestApp[]\n\tformManager: ?FormManager\n\n\tconstructor(params: PhoneCallViewParams)\n\t{\n\t\tthis.id = 'im-phone-call-view';\n\t\tthis.darkMode = params.darkMode === true;\n\n\t\t//params\n\t\tthis.phoneNumber = params.phoneNumber || 'hidden';\n\t\tthis.lineNumber = params.lineNumber || '';\n\t\tthis.companyPhoneNumber = params.companyPhoneNumber || '';\n\t\tthis.direction = params.direction || Direction.incoming;\n\t\tthis.fromUserId = params.fromUserId;\n\t\tthis.toUserId = params.toUserId;\n\t\tthis.config = params.config || {};\n\t\tthis.callId = params.callId || '';\n\t\tthis.callState = CallState.idle;\n\n\t\t//associated crm entities\n\t\tthis.crmEntityType = BX.prop.getString(params, 'crmEntityType', '');\n\t\tthis.crmEntityId = BX.prop.getInteger(params, 'crmEntityId', 0);\n\t\tthis.crmActivityId = BX.prop.getInteger(params, 'crmActivityId', 0);\n\t\tthis.crmActivityEditUrl = BX.prop.getString(params, 'crmActivityEditUrl', '');\n\t\tthis.crmData = BX.prop.getObject(params, 'crmData', {});\n\t\tthis.crmBindings = BX.prop.getArray(params, 'crmBindings', []);\n\t\tthis.externalRequests = {};\n\n\t\t//portal call\n\t\tthis.portalCallData = params.portalCallData;\n\t\tthis.portalCallUserId = params.portalCallUserId;\n\t\tthis.portalCallQueueName = params.portalCallQueueName;\n\n\t\t//flags\n\t\tthis.hasSipPhone = (params.hasSipPhone === true);\n\t\tthis.deviceCall = (params.deviceCall === true);\n\t\tthis.portalCall = (params.portalCall === true);\n\t\tthis.crm = (params.crm === true);\n\t\tthis.held = false;\n\t\tthis.muted = false;\n\t\tthis.recording = (params.recording === true);\n\t\tthis.makeCall = (params.makeCall === true); // emulate pressing on \"dial\" button right after showing call view\n\t\tthis.closable = false;\n\t\tthis.allowAutoClose = true;\n\t\tthis.folded = (params.folded === true);\n\t\tthis.autoFold = (params.autoFold === true);\n\t\tthis.transfer = (params.transfer === true);\n\n\t\tthis.title = '';\n\t\tthis._uiState = params.uiState || UiState.idle;\n\t\tthis.statusText = params.statusText || '';\n\t\tthis.progress = '';\n\t\tthis.quality = 0;\n\t\tthis.qualityPopup = null;\n\t\tthis.qualityGrade = 0;\n\t\tthis.comment = '';\n\t\tthis.commentShown = false;\n\n\t\t//timer\n\t\tthis.initialTimestamp = params.initialTimestamp || 0;\n\t\tthis.timerInterval = null;\n\n\t\tthis.elements = this.getInitialElements();\n\t\tthis.sections = this.getInitialSections();\n\n\t\tvar uiStateButtons = this.getUiStateButtons(this._uiState);\n\t\tthis.buttonLayout = uiStateButtons.layout;\n\t\tthis.buttons = uiStateButtons.buttons;\n\n\t\tthis.restApps = params.restApps || [];\n\n\t\tif (!Type.isPlainObject(params.events))\n\t\t{\n\t\t\tparams.events = {};\n\t\t}\n\n\t\tthis.callbacks = {\n\t\t\thold: Type.isFunction(params.events.hold) ? params.events.hold : nop,\n\t\t\tunhold: Type.isFunction(params.events.unhold) ? params.events.unhold : nop,\n\t\t\tmute: Type.isFunction(params.events.mute) ? params.events.mute : nop,\n\t\t\tunmute: Type.isFunction(params.events.unmute) ? params.events.unmute : nop,\n\t\t\tmakeCall: Type.isFunction(params.events.makeCall) ? params.events.makeCall : nop,\n\t\t\tcallListMakeCall: Type.isFunction(params.events.callListMakeCall) ? params.events.callListMakeCall : nop,\n\t\t\tanswer: Type.isFunction(params.events.answer) ? params.events.answer : nop,\n\t\t\tskip: Type.isFunction(params.events.skip) ? params.events.skip : nop,\n\t\t\thangup: Type.isFunction(params.events.hangup) ? params.events.hangup : nop,\n\t\t\tclose: Type.isFunction(params.events.close) ? params.events.close : nop,\n\t\t\ttransfer: Type.isFunction(params.events.transfer) ? params.events.transfer : nop,\n\t\t\tcompleteTransfer: Type.isFunction(params.events.completeTransfer) ? params.events.completeTransfer : nop,\n\t\t\tcancelTransfer: Type.isFunction(params.events.cancelTransfer) ? params.events.cancelTransfer : nop,\n\t\t\tswitchDevice: Type.isFunction(params.events.switchDevice) ? params.events.switchDevice : nop,\n\t\t\tqualityGraded: Type.isFunction(params.events.qualityGraded) ? params.events.qualityGraded : nop,\n\t\t\tdialpadButtonClicked: Type.isFunction(params.events.dialpadButtonClicked) ? params.events.dialpadButtonClicked : nop,\n\t\t\tsaveComment: Type.isFunction(params.events.saveComment) ? params.events.saveComment : nop,\n\t\t\tnotifyAdmin: Type.isFunction(params.events.notifyAdmin) ? params.events.notifyAdmin : nop,\n\t\t};\n\n\t\tthis.popup = null;\n\n\t\t// event handlers\n\t\tthis._onBeforeUnloadHandler = this._onBeforeUnload.bind(this);\n\t\tthis._onDblClickHandler = this._onDblClick.bind(this);\n\t\tthis._onHoldButtonClickHandler = this._onHoldButtonClick.bind(this);\n\t\tthis._onMuteButtonClickHandler = this._onMuteButtonClick.bind(this);\n\t\tthis._onTransferButtonClickHandler = this._onTransferButtonClick.bind(this);\n\t\tthis._onTransferCompleteButtonClickHandler = this._onTransferCompleteButtonClick.bind(this);\n\t\tthis._onTransferCancelButtonClickHandler = this._onTransferCancelButtonClick.bind(this);\n\t\tthis._onDialpadButtonClickHandler = this._onDialpadButtonClick.bind(this);\n\t\tthis._onHangupButtonClickHandler = this._onHangupButtonClick.bind(this);\n\t\tthis._onCloseButtonClickHandler = this._onCloseButtonClick.bind(this);\n\t\tthis._onMakeCallButtonClickHandler = this._onMakeCallButtonClick.bind(this);\n\t\tthis._onNextButtonClickHandler = this._onNextButtonClick.bind(this);\n\t\tthis._onRedialButtonClickHandler = this._onRedialButtonClick.bind(this);\n\t\tthis._onFoldButtonClickHandler = this._onFoldButtonClick.bind(this);\n\t\tthis._onAnswerButtonClickHandler = this._onAnswerButtonClick.bind(this);\n\t\tthis._onSkipButtonClickHandler = this._onSkipButtonClick.bind(this);\n\t\tthis._onSwitchDeviceButtonClickHandler = this._onSwitchDeviceButtonClick.bind(this);\n\t\tthis._onQualityMeterClickHandler = this._onQualityMeterClick.bind(this);\n\t\tthis._onPullEventCrmHandler = this._onPullEventCrm.bind(this);\n\n\t\tthis._externalEventHandler = this._onExternalEvent.bind(this);\n\t\tthis._unloadHandler = this._onWindowUnload.bind(this);\n\n\t\t// tabs\n\t\tthis.hiddenTabs = [];\n\t\tthis.currentTabName = '';\n\t\tthis.moreTabsMenu = null;\n\n\t\t// callList\n\t\tthis.callListId = params.callListId || 0;\n\t\tthis.callListStatusId = params.callListStatusId || null;\n\t\tthis.callListItemIndex = params.callListItemIndex || null;\n\t\tthis.callListView = null;\n\t\tthis.currentEntity = null;\n\t\tthis.callingEntity = null;\n\t\tthis.numberSelectMenu = null;\n\n\t\t// webform\n\t\tthis.webformId = params.webformId || 0;\n\t\tthis.webformSecCode = params.webformSecCode || '';\n\t\tthis.webformLoaded = false;\n\n\t\t// partner data\n\t\tthis.restAppLayoutLoaded = false;\n\t\tthis.restAppLayoutLoading = false;\n\t\tthis.restAppInterface = null;\n\n\t\t// desktop integration\n\t\tthis.callWindow = null;\n\t\tthis.slave = params.slave === true;\n\t\tthis.skipOnResize = params.skipOnResize === true;\n\t\tthis.desktop = new Desktop({\n\t\t\tparentPhoneCallView: this,\n\t\t\tclosable: (this.callListId > 0 ? true : this.closable)\n\t\t});\n\n\t\tthis.currentLayout = (this.callListId > 0 ? layouts.crm : layouts.simple);\n\n\t\t// TODO: make this decent somehow\n\t\tthis.backgroundWorker = BackgroundWorker.getInstance();\n\t\tthis.backgroundWorker.setCallCard(this);\n\t\tthis.backgroundWorker.setExternalCall(!!params.isExternalCall);\n\n\t\tthis.init();\n\n\t\tif (this.backgroundWorker.isDesktop())\n\t\t{\n\t\t\tthis.backgroundWorker.removeDesktopEventHandlers();\n\t\t}\n\t\tthis.backgroundWorker.platformWorker.emitInitializeEvent(this.getPlacementOptions());\n\t\tthis.createTitle().then(title => this.setTitle(title));\n\t\tif (params.hasOwnProperty('uiState'))\n\t\t{\n\t\t\tthis.setUiState(params['uiState']);\n\t\t}\n\n\t\twindow.test = this;\n\t}\n\n\tgetInitialElements()\n\t{\n\t\treturn {\n\t\t\tmain: null,\n\t\t\ttitle: null,\n\t\t\tsections: {\n\t\t\t\tstatus: null,\n\t\t\t\ttimer: null,\n\t\t\t\tcrmButtons: null,\n\t\t\t},\n\t\t\tavatar: null,\n\t\t\tprogress: null,\n\t\t\ttimer: null,\n\t\t\tstatus: null,\n\t\t\tcommentEditorContainer: null,\n\t\t\tcommentEditor: null,\n\t\t\tqualityMeter: null,\n\t\t\tcrmCard: null,\n\t\t\tcrmButtonsContainer: null,\n\t\t\tcrmButtons: {},\n\t\t\tbuttonsContainer: null,\n\t\t\ttopLevelButtonsContainer: null,\n\t\t\ttopButtonsContainer: null, //well..\n\t\t\tbuttons: {},\n\t\t\tsidebarContainer: null,\n\t\t\ttabsContainer: null,\n\t\t\ttabsBodyContainer: null,\n\t\t\ttabs: {\n\t\t\t\tcallList: null,\n\t\t\t\twebform: null,\n\t\t\t\tapp: null\n\t\t\t},\n\t\t\ttabsBody: {\n\t\t\t\tcallList: null,\n\t\t\t\twebform: null,\n\t\t\t\tapp: null\n\t\t\t},\n\t\t\tmoreTabs: null\n\t\t};\n\t};\n\n\tgetInitialSections()\n\t{\n\t\treturn {\n\t\t\tstatus: {visible: false},\n\t\t\ttimer: {visible: false},\n\t\t\tcrmButtons: {visible: false},\n\t\t\tcommentEditor: {visible: false}\n\t\t}\n\t};\n\n\tinit()\n\t{\n\t\tif (BX.MessengerCommon.isDesktop() && !this.slave)\n\t\t{\n\t\t\tthis.desktop.openCallWindow('', null, {\n\t\t\t\twidth: this.getInitialWidth(),\n\t\t\t\theight: this.getInitialHeight(),\n\t\t\t\tresizable: (this.currentLayout == layouts.crm),\n\t\t\t\tminWidth: this.elements.sidebarContainer ? 950 : 550,\n\t\t\t\tminHeight: 650\n\t\t\t});\n\t\t\tthis.bindMasterDesktopEvents();\n\n\t\t\twindow.addEventListener('beforeunload', this._unloadHandler); //master window unload\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.main = this.createLayout();\n\t\tthis.updateView();\n\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tdocument.body.appendChild(this.elements.main);\n\t\t\tthis.bindSlaveDesktopEvents();\n\t\t}\n\t\telse if (this.isFolded())\n\t\t{\n\t\t\tdocument.body.appendChild(this.elements.main);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.popup = this.createPopup();\n\t\t\tBX.addCustomEvent(window, \"onLocalStorageSet\", this._externalEventHandler);\n\t\t}\n\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tif (this.callListView)\n\t\t\t{\n\t\t\t\tthis.callListView.reinit({\n\t\t\t\t\tnode: this.elements.tabsBody.callList\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callListView = new CallList({\n\t\t\t\t\tnode: this.elements.tabsBody.callList,\n\t\t\t\t\tid: this.callListId,\n\t\t\t\t\tstatusId: this.callListStatusId,\n\t\t\t\t\titemIndex: this.callListItemIndex,\n\t\t\t\t\tmakeCall: this.makeCall,\n\t\t\t\t\tonSelectedItem: this.onCallListSelectedItem.bind(this)\n\t\t\t\t});\n\n\t\t\t\tthis.callListView.init(() =>\n\t\t\t\t{\n\t\t\t\t\tif (this.makeCall)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._onMakeCallButtonClick();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.setUiState(UiState.outgoing);\n\t\t\t}\n\t\t}\n\t\telse if (this.crm && !this.isFolded())\n\t\t{\n\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t}\n\n\t\tBX.addCustomEvent(\"onPullEvent-crm\", this._onPullEventCrmHandler);\n\t\tif (!this.isDesktop())\n\t\t{\n\t\t\twindow.addEventListener('beforeunload', this._onBeforeUnloadHandler);\n\t\t}\n\t};\n\n\treinit()\n\t{\n\t\tthis.elements = this.getInitialElements();\n\n\t\twindow.removeEventListener('beforeunload', this._unloadHandler);\n\t\tBX.removeCustomEvent(window, \"onLocalStorageSet\", this._externalEventHandler);\n\t\tBX.removeCustomEvent(\"onPullEvent-crm\", this._onPullEventCrmHandler);\n\n\t\tthis.init();\n\t};\n\n\tshow()\n\t{\n\t\tif(!this.popup && this.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.reinit();\n\t\t}\n\n\t\tif (!this.isDesktop() && !this.isFolded())\n\t\t{\n\t\t\tthis.disableDocumentScroll();\n\t\t}\n\n\t\tthis.popup.show();\n\t\treturn this;\n\t};\n\n\tcreatePopup(): Popup\n\t{\n\t\treturn new Popup({\n\t\t\tid: this.getId(),\n\t\t\tbindElement: null,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.elements.main,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: baseZIndex,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: {restrict: false},\n\t\t\toverlay: {backgroundColor: 'black', opacity: 30},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tif (this.isFolded())\n\t\t\t\t\t{\n\t\t\t\t\t\t// this.destroy();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callbacks.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => this.popup = null\n\t\t\t}\n\t\t});\n\t};\n\n\tcreateLayout()\n\t{\n\t\tif (this.isFolded())\n\t\t{\n\t\t\treturn this.createLayoutFolded();\n\t\t}\n\t\telse if (this.currentLayout == layouts.crm)\n\t\t{\n\t\t\treturn this.createLayoutCrm();\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.createLayoutSimple();\n\t\t}\n\t};\n\n\tcreateLayoutCrm()\n\t{\n\t\tvar result = Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-top-level'},\n\t\t\tevents: {\n\t\t\t\tdblclick: this._onDblClickHandler\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.topLevelButtonsContainer = Dom.create(\"div\"),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-wrapper' + (this.hasSideBar() ? '' : ' im-phone-call-wrapper-without-sidebar')},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-container' + (this.hasSideBar() ? '' : ' im-phone-call-container-without-sidebar')},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-header-container'}, children: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-header'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.title = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-title-text'},\n\t\t\t\t\t\t\t\t\t\t\t\t\thtml: this.renderTitle()\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.crmCard = Dom.create(\"div\", {props: {className: 'im-phone-call-crm-card'}}),\n\t\t\t\t\t\t\t\tthis.elements.sections.status = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.sections.status.visible ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-description'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.status = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-description-item'},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: this.statusText\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.sections.timer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.sections.timer.visible ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-timer'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-timer-item'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.timer = Dom.create(\"span\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.commentEditorContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.commentShown ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-comments'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.commentEditor = Dom.create(\"textarea\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'im-phone-call-comments-textarea',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: this.comment,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder: Loc.getMessage('IM_PHONE_CALL_COMMENT_PLACEHOLDER')\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbxchange: this._onCommentChanged.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.sections.crmButtons = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.sections.crmButtons.visible ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.crmButtonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-crm-buttons'}})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.buttonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container'}}),\n\t\t\t\t\t\t\t\tthis.elements.topButtonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container-top'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.hasSideBar())\n\t\t{\n\t\t\tthis.createSidebarLayout();\n\t\t\tif (this.elements.sidebarContainer)\n\t\t\t{\n\t\t\t\tresult.appendChild(this.elements.sidebarContainer);\n\t\t\t}\n\n\t\t\tsetTimeout(() => this.checkMoreButton(), 0);\n\t\t}\n\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tresult.style.position = 'fixed';\n\t\t\tresult.style.top = 0;\n\t\t\tresult.style.bottom = 0;\n\t\t\tresult.style.left = 0;\n\t\t\tresult.style.right = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.style.width = this.getInitialWidth() + 'px';\n\t\t\tresult.style.height = this.getInitialHeight() + 'px';\n\t\t}\n\n\t\treturn result;\n\t};\n\n\t/**\n\t * @return boolean\n\t */\n\thasSideBar()\n\t{\n\t\tif (this.isDesktop() && !this.desktop.isFeatureSupported('iframe'))\n\t\t{\n\t\t\treturn this.callListId > 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn (this.callListId > 0 || this.webformId > 0 || this.restApps.length > 0);\n\t\t}\n\t};\n\n\tgetInitialWidth()\n\t{\n\t\tconst storedWidth = (window.localStorage) ? parseInt(window.localStorage.getItem(lsKeys.width)) : 0;\n\n\t\tif (this.currentLayout == layouts.simple)\n\t\t{\n\t\t\treturn initialSize.simple.width;\n\t\t}\n\t\telse if (this.hasSideBar())\n\t\t{\n\t\t\tif (storedWidth > 0)\n\t\t\t{\n\t\t\t\treturn storedWidth;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Math.min(Math.floor(screen.width * 0.8), 1200);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn initialSize.crm.width;\n\t\t}\n\t};\n\n\tgetInitialHeight()\n\t{\n\t\tconst storedHeight = (window.localStorage) ? parseInt(window.localStorage.getItem(lsKeys.height)) : 0;\n\n\t\tif (this.currentLayout == layouts.simple)\n\t\t{\n\t\t\treturn initialSize.simple.height\n\t\t}\n\t\telse if (storedHeight > 0)\n\t\t{\n\t\t\treturn storedHeight;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn initialSize.crm.height;\n\t\t}\n\t};\n\n\tsaveInitialSize(width, height)\n\t{\n\t\tif (!window.localStorage)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.currentLayout == layouts.crm)\n\t\t{\n\t\t\twindow.localStorage.setItem(lsKeys.height, height.toString());\n\t\t\tif (this.hasSideBar())\n\t\t\t{\n\t\t\t\twindow.localStorage.setItem(lsKeys.width, width);\n\t\t\t}\n\t\t}\n\t};\n\n\tshowSections(sections)\n\t{\n\t\tif (!Type.isArray(sections))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsections.forEach((sectionName) =>\n\t\t{\n\t\t\tif (this.elements.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.removeProperty('display');\n\t\t\t}\n\n\t\t\tif (this.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.sections[sectionName].visible = true;\n\t\t\t}\n\t\t});\n\t};\n\n\thideSections(sections)\n\t{\n\t\tif (!Type.isArray(sections))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsections.forEach((sectionName) =>\n\t\t{\n\t\t\tif (this.elements.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.display = 'none';\n\t\t\t}\n\n\t\t\tif (this.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.sections[sectionName].visible = false;\n\t\t\t}\n\t\t});\n\t};\n\n\tshowOnlySections(sections)\n\t{\n\t\tif (!Type.isArray(sections))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet sectionsIndex = {};\n\t\tsections.forEach(sectionName => sectionsIndex[sectionName] = true);\n\n\t\tfor (var sectionName in this.elements.sections)\n\t\t{\n\t\t\tif (!this.elements.sections.hasOwnProperty(sectionName) || !Type.isDomNode(this.elements.sections[sectionName]))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (sectionsIndex[sectionName])\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.removeProperty('display');\n\t\t\t\tif (this.sections.hasOwnProperty(sectionName))\n\t\t\t\t{\n\t\t\t\t\tthis.sections[sectionName].visible = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.display = 'none';\n\t\t\t\tif (this.sections.hasOwnProperty(sectionName))\n\t\t\t\t{\n\t\t\t\t\tthis.sections[sectionName].visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tcreateSidebarLayout()\n\t{\n\t\tlet tabs = [];\n\t\tlet tabsBody = [];\n\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tthis.elements.tabs.callList = Dom.create(\"span\", {\n\t\t\t\tprops: {className: 'im-phone-sidebar-tab'},\n\t\t\t\tdataset: {tabId: 'callList', tabBodyId: 'callList'},\n\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_TITLE'),\n\t\t\t\tevents: {click: this._onTabHeaderClick.bind(this)}\n\t\t\t});\n\t\t\ttabs.push(this.elements.tabs.callList);\n\t\t\tthis.elements.tabsBody.callList = Dom.create('div');\n\t\t\ttabsBody.push(this.elements.tabsBody.callList);\n\t\t}\n\n\t\tif (this.webformId > 0 && this.isWebformSupported())\n\t\t{\n\t\t\tthis.elements.tabs.webform = Dom.create(\"span\", {\n\t\t\t\tprops: {className: 'im-phone-sidebar-tab'},\n\t\t\t\tdataset: {tabId: 'webform', tabBodyId: 'webform'},\n\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_WEBFORM_TITLE'),\n\t\t\t\tevents: {click: this._onTabHeaderClick.bind(this)}\n\t\t\t});\n\t\t\ttabs.push(this.elements.tabs.webform);\n\t\t\tthis.elements.tabsBody.webform = Dom.create('div', {props: {className: 'im-phone-call-form-container'}});\n\t\t\ttabsBody.push(this.elements.tabsBody.webform);\n\n\t\t\tthis.formManager = new FormManager({\n\t\t\t\tnode: this.elements.tabsBody.webform,\n\t\t\t\tonFormSend: this._onFormSend.bind(this)\n\t\t\t})\n\t\t}\n\n\t\tif (this.restApps.length > 0 && this.isRestAppsSupported())\n\t\t{\n\t\t\tthis.restApps.forEach((restApp) =>\n\t\t\t{\n\t\t\t\tconst restAppId = restApp.id;\n\t\t\t\tconst tabId = 'restApp' + restAppId;\n\t\t\t\tthis.elements.tabs[tabId] = Dom.create(\"span\", {\n\t\t\t\t\tprops: {className: 'im-phone-sidebar-tab'},\n\t\t\t\t\tdataset: {tabId: tabId, tabBodyId: 'app', restAppId: restAppId},\n\t\t\t\t\ttext: Text.encode(restApp.name),\n\t\t\t\t\tevents: {click: this._onTabHeaderClick.bind(this)}\n\t\t\t\t});\n\t\t\t\ttabs.push(this.elements.tabs[tabId]);\n\n\t\t\t});\n\t\t\tthis.elements.tabsBody.app = Dom.create('div', {props: {className: 'im-phone-call-app-container'}});\n\t\t\ttabsBody.push(this.elements.tabsBody.app);\n\t\t}\n\n\t\tthis.elements.sidebarContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-sidebar-wrap'}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-container'}, children: [\n\t\t\t\t\t\tthis.elements.tabsContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-left'},\n\t\t\t\t\t\t\tchildren: tabs\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-right'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.moreTabs = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-sidebar-tab im-phone-sidebar-tab-more'},\n\t\t\t\t\t\t\t\t\tstyle: {display: 'none'},\n\t\t\t\t\t\t\t\t\tdataset: {},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_MORE'),\n\t\t\t\t\t\t\t\t\tevents: {click: this._onTabMoreClick.bind(this)}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.tabsBodyContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-body-container'},\n\t\t\t\t\tchildren: tabsBody\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tthis.setActiveTab({tabId: 'callList', tabBodyId: 'callList'});\n\t\t}\n\t\telse if (this.webformId > 0 && this.isWebformSupported())\n\t\t{\n\t\t\tthis.setActiveTab({tabId: 'webform', tabBodyId: 'webform'});\n\t\t}\n\t\telse if (this.restApps.length > 0 && this.isRestAppsSupported())\n\t\t{\n\t\t\tthis.setActiveTab({\n\t\t\t\ttabId: 'restApp' + this.restApps[0].id,\n\t\t\t\ttabBodyId: 'app',\n\t\t\t\trestAppId: this.restApps[0].id\n\t\t\t});\n\t\t}\n\t};\n\n\tcreateLayoutSimple()\n\t{\n\t\tvar portalCallUserImage = '';\n\t\tif (this.isPortalCall()\n\t\t\t&& this.portalCallData.hrphoto\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId]\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId] != blankAvatar\n\t\t)\n\t\t{\n\t\t\tportalCallUserImage = this.portalCallData.hrphoto[this.portalCallUserId];\n\t\t}\n\t\tvar result = Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper'}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-container'}, children: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-section'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.title = Dom.create(\"div\", {props: {className: 'im-phone-calling-text'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section im-phone-calling-progress-section'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-container'}, children: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-container-block-l'},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {props: {className: 'im-phone-calling-progress-phone'}})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.progress = Dom.create(\"div\", {props: {className: 'im-phone-calling-progress-container-block-c'}}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-container-block-r'},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-customer'},\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: Type.isStringFilled(portalCallUserImage) ? {'background-image': 'url(\\'' + portalCallUserImage + '\\')'} : {}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.status = Dom.create(\"div\", {props: {className: 'im-phone-calling-process-status'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.buttonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container'}}),\n\t\t\t\t\t\tthis.elements.topButtonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container-top'}})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tresult.style.width = this.getInitialWidth() + 'px';\n\t\tresult.style.height = this.getInitialHeight() + 'px';\n\n\t\treturn result;\n\t};\n\n\tcreateLayoutFolded()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"im-phone-call-panel-mini\"},\n\t\t\tstyle: {zIndex: baseZIndex},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.sections.timer = this.elements.timer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"im-phone-call-panel-mini-time\"},\n\t\t\t\t\tstyle: this.sections.timer.visible ? {} : {display: 'none'}\n\t\t\t\t}),\n\t\t\t\tthis.elements.buttonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-panel-mini-buttons'}}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"im-phone-call-panel-mini-expand\"},\n\t\t\t\t\tevents: {click: () => this.unfold()}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tsetActiveTab(params)\n\t{\n\t\tconst tabId = params.tabId;\n\t\tconst tabBodyId = params.tabBodyId;\n\t\tconst restAppId = params.restAppId || '';\n\t\tparams.hidden = params.hidden === true;\n\t\tfor (let tab in this.elements.tabs)\n\t\t{\n\t\t\tif (this.elements.tabs.hasOwnProperty(tab) && Type.isDomNode(this.elements.tabs[tab]))\n\t\t\t{\n\t\t\t\tthis.elements.tabs[tab].classList.toggle('im-phone-sidebar-tab-active', tab == tabId)\n\t\t\t}\n\t\t}\n\n\t\tthis.elements.moreTabs.classList.toggle('im-phone-sidebar-tab-active', params.hidden);\n\n\t\tfor (let tab in this.elements.tabsBody)\n\t\t{\n\t\t\tif (this.elements.tabsBody.hasOwnProperty(tab) && Type.isDomNode(this.elements.tabsBody[tab]))\n\t\t\t{\n\t\t\t\tif (tab == tabBodyId)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.tabsBody[tab].style.removeProperty('display');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.elements.tabsBody[tab].style.display = 'none';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.currentTabName = tabId;\n\n\t\tif (tabId === 'webform' && !this.webformLoaded)\n\t\t{\n\t\t\tthis.loadForm({\n\t\t\t\tid: this.webformId,\n\t\t\t\tsecCode: this.webformSecCode\n\t\t\t})\n\t\t}\n\n\t\tif (restAppId !== '')\n\t\t{\n\t\t\tthis.loadRestApp({\n\t\t\t\tid: restAppId,\n\t\t\t\tcallId: this.callId,\n\t\t\t\tnode: this.elements.tabsBody.app\n\t\t\t});\n\t\t}\n\t};\n\n\tisCurrentTabHidden()\n\t{\n\t\tlet result = false;\n\t\tfor (let i = 0; i < this.hiddenTabs.length; i++)\n\t\t{\n\t\t\tif (this.hiddenTabs[i].dataset.tabId == this.currentTabName)\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tcheckMoreButton()\n\t{\n\t\tif (!this.elements.tabsContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar tabs = this.elements.tabsContainer.children;\n\t\tvar currentTab;\n\t\tthis.hiddenTabs = [];\n\n\t\tfor (var i = 0; i < tabs.length; i++)\n\t\t{\n\t\t\tcurrentTab = tabs.item(i);\n\t\t\tif (currentTab.offsetTop > 7)\n\t\t\t{\n\t\t\t\tthis.hiddenTabs.push(currentTab);\n\t\t\t}\n\t\t}\n\t\tif (this.hiddenTabs.length > 0)\n\t\t{\n\t\t\tthis.elements.moreTabs.style.removeProperty('display');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.moreTabs.style.display = 'none';\n\t\t}\n\n\t\tif (this.isCurrentTabHidden())\n\t\t{\n\t\t\tDom.addClass(this.elements.moreTabs, 'im-phone-sidebar-tab-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.elements.moreTabs, 'im-phone-sidebar-tab-active');\n\t\t}\n\t};\n\n\t_onTabHeaderClick(e)\n\t{\n\t\tif (this.moreTabsMenu)\n\t\t{\n\t\t\tthis.moreTabsMenu.close();\n\t\t}\n\n\t\tthis.setActiveTab({\n\t\t\ttabId: e.target.dataset.tabId,\n\t\t\ttabBodyId: e.target.dataset.tabBodyId,\n\t\t\trestAppId: e.target.dataset.restAppId || '',\n\t\t\thidden: false\n\t\t});\n\t};\n\n\t_onTabMoreClick()\n\t{\n\t\tif (this.hiddenTabs.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.moreTabsMenu)\n\t\t{\n\t\t\tthis.moreTabsMenu.close();\n\t\t\treturn;\n\t\t}\n\n\t\tvar menuItems = [];\n\t\tthis.hiddenTabs.forEach((tabElement) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: \"selectTab_\" + tabElement.dataset.tabId,\n\t\t\t\ttext: tabElement.innerText,\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.moreTabsMenu.close();\n\t\t\t\t\tthis.setActiveTab({\n\t\t\t\t\t\ttabId: tabElement.dataset.tabId,\n\t\t\t\t\t\ttabBodyId: tabElement.dataset.tabBodyId,\n\t\t\t\t\t\trestAppId: tabElement.dataset.restAppId || '',\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.moreTabsMenu = new Menu(\n\t\t\t'phoneCallViewMoreTabs',\n\t\t\tthis.elements.moreTabs,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: {position: \"top\"},\n\t\t\t\tzIndex: baseZIndex + 100,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.moreTabsMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.moreTabsMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.moreTabsMenu.show();\n\t};\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t};\n\n\tcreateTitle()\n\t{\n\t\tlet callTitle = '';\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tBX.PhoneNumberParser.getInstance().parse(this.phoneNumber).then((parsedNumber) =>\n\t\t\t{\n\t\t\t\tif (this.phoneNumber == 'unknown')\n\t\t\t\t{\n\t\t\t\t\tresolve(Loc.getMessage('IM_PHONE_CALL_VIEW_NUMBER_UNKNOWN'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this.phoneNumber == 'hidden')\n\t\t\t\t{\n\t\t\t\t\tcallTitle = Loc.getMessage('IM_PHONE_HIDDEN_NUMBER');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcallTitle = this.phoneNumber.toString();\n\n\t\t\t\t\tif (parsedNumber.isValid())\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = parsedNumber.format();\n\n\t\t\t\t\t\tif (parsedNumber.isInternational() && callTitle.charAt(0) != '+')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcallTitle = '+' + callTitle;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = this.phoneNumber.toString();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.isCallback())\n\t\t\t\t{\n\t\t\t\t\tcallTitle = Loc.getMessage('IM_PHONE_CALLBACK_TO').replace('#PHONE#', callTitle);\n\t\t\t\t}\n\t\t\t\telse if (this.isPortalCall())\n\t\t\t\t{\n\t\t\t\t\tswitch (this.direction)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase Direction.incoming:\n\t\t\t\t\t\t\tif (this.portalCallUserId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcallTitle = Loc.getMessage(\"IM_M_CALL_VOICE_FROM\").replace('#USER#', this.portalCallData.users[this.portalCallUserId].name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase Direction.outgoing:\n\t\t\t\t\t\t\tif (this.portalCallUserId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcallTitle = Loc.getMessage(\"IM_M_CALL_VOICE_TO\").replace('#USER#', this.portalCallData.users[this.portalCallUserId].name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcallTitle = Loc.getMessage(\"IM_M_CALL_VOICE_TO\").replace('#USER#', this.portalCallQueueName) + ' (' + this.phoneNumber + ')';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcallTitle = Loc.getMessage(this.direction === Direction.incoming ? 'IM_PHONE_CALL_VOICE_FROM' : 'IM_PHONE_CALL_VOICE_TO').replace('#PHONE#', callTitle);\n\n\t\t\t\t\tif (this.direction === Direction.incoming && this.companyPhoneNumber)\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = callTitle + ', ' + Loc.getMessage('IM_PHONE_CALL_TO_PHONE').replace('#PHONE#', this.companyPhoneNumber);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isTransfer())\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = callTitle + ' ' + Loc.getMessage('IM_PHONE_CALL_TRANSFERED');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve(callTitle);\n\t\t\t});\n\t\t})\n\t};\n\n\trenderTitle()\n\t{\n\t\treturn Text.encode(this.title);\n\t};\n\n\trenderAvatar()\n\t{\n\t\tlet portalCallUserImage = '';\n\t\tif (this.isPortalCall()\n\t\t\t&& this.elements.avatar\n\t\t\t&& this.portalCallData.hrphoto\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId]\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId] != blankAvatar\n\t\t)\n\t\t{\n\t\t\tportalCallUserImage = this.portalCallData.hrphoto[this.portalCallUserId];\n\n\t\t\tDom.adjust(this.elements.avatar, {\n\t\t\t\tstyle: portalCallUserImage === '' ? {} : {'background-image': 'url(\\'' + portalCallUserImage + '\\')'}\n\t\t\t});\n\t\t}\n\t};\n\n\t_getCrmEditUrl(entityTypeName, entityId)\n\t{\n\t\tif (!Type.isStringFilled(entityTypeName))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tentityId = Number(entityId);\n\n\t\treturn '/crm/' + entityTypeName.toLowerCase() + '/edit/' + entityId.toString() + '/';\n\t};\n\n\t_generateExternalContext()\n\t{\n\t\treturn this._getRandomString(16);\n\t};\n\n\t_getRandomString(len)\n\t{\n\t\tconst charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\t\tlet randomString = '';\n\t\tfor (let i = 0; i < len; i++)\n\t\t{\n\t\t\tconst randomPoz = Math.floor(Math.random() * charSet.length);\n\t\t\trandomString += charSet.substring(randomPoz, randomPoz + 1);\n\t\t}\n\t\treturn randomString;\n\t};\n\n\tsetPhoneNumber(phoneNumber)\n\t{\n\t\tthis.phoneNumber = phoneNumber;\n\t\tthis.setOnSlave(desktopEvents.setPhoneNumber, [phoneNumber]);\n\t};\n\n\tsetTitle(title)\n\t{\n\t\tthis.title = title;\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tif (this.slave)\n\t\t\t{\n\t\t\t\tBXDesktopWindow.SetProperty('title', title);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.setTitle, [title]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.elements.title)\n\t\t{\n\t\t\tthis.elements.title.innerHTML = this.renderTitle();\n\t\t}\n\t};\n\n\tgetTitle()\n\t{\n\t\treturn this.title;\n\t};\n\n\tsetQuality(quality)\n\t{\n\t\tthis.quality = quality;\n\n\t\tif (this.elements.qualityMeter)\n\t\t{\n\t\t\tthis.elements.qualityMeter.style.width = this.getQualityMeterWidth();\n\t\t}\n\t};\n\n\tgetQualityMeterWidth(): string\n\t{\n\t\tif (this.quality > 0 && this.quality <= 5)\n\t\t{\n\t\t\treturn this.quality * 20 + '%';\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn '0';\n\t\t}\n\t};\n\n\tsetProgress(progress: $Keys<typeof CallProgress>)\n\t{\n\t\tif (this.progress === progress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.progress = progress;\n\n\t\tif (!this.elements.progress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.clean(this.elements.progress);\n\t\tthis.elements.progress.appendChild(this.renderProgress(this.progress));\n\t};\n\n\tsetStatusText(statusText)\n\t{\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.setStatus, [statusText]);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.statusText = statusText;\n\t\tif (this.elements.status)\n\t\t{\n\t\t\tthis.elements.status.innerText = this.statusText;\n\t\t}\n\t};\n\n\tsetConfig(config)\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.config = config;\n\t\tif (!this.isDesktop() || this.slave)\n\t\t{\n\t\t\tthis.renderCrmButtons();\n\t\t}\n\t\tthis.setOnSlave(desktopEvents.setConfig, [config]);\n\t};\n\n\tsetCallId(callId)\n\t{\n\t\tthis.callId = callId;\n\t\tthis.setOnSlave(desktopEvents.setCallId, [callId]);\n\t};\n\n\tsetLineNumber(lineNumber)\n\t{\n\t\tthis.lineNumber = lineNumber;\n\t\tthis.setOnSlave(desktopEvents.setLineNumber, [lineNumber]);\n\t};\n\n\tsetCompanyPhoneNumber(companyPhoneNumber)\n\t{\n\t\tthis.companyPhoneNumber = companyPhoneNumber;\n\t\tthis.setOnSlave(desktopEvents.setCompanyPhoneNumber, [companyPhoneNumber]);\n\t};\n\n\tsetButtons(buttons, layout)\n\t{\n\t\tif (!ButtonLayouts[layout])\n\t\t{\n\t\t\tlayout = ButtonLayouts.centered;\n\t\t}\n\n\t\tthis.buttonLayout = layout;\n\t\tthis.buttons = buttons;\n\t\tthis.renderButtons();\n\t};\n\n\tsetUiState(uiState)\n\t{\n\t\tthis._uiState = uiState;\n\n\t\tvar stateButtons = this.getUiStateButtons(uiState);\n\t\tthis.buttons = stateButtons.buttons;\n\t\tthis.buttonLayout = stateButtons.layout;\n\n\t\tswitch (uiState)\n\t\t{\n\t\t\tcase UiState.incoming:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferIncoming:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.outgoing:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingIncoming:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingOutgoing:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.showCallIcon();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.connected:\n\t\t\t\tif (this.deviceCall)\n\t\t\t\t{\n\t\t\t\t\tthis.setClosable(true);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setClosable(false);\n\t\t\t\t}\n\n\t\t\t\tthis.showSections(['status', 'timer']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.showCallIcon();\n\t\t\t\tthis.startTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferring:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showSections(['status', 'timer']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tbreak;\n\t\t\tcase UiState.idle:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tbreak;\n\t\t\tcase UiState.error:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.moneyError:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.sipPhoneError:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.redial:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.setUiState, [uiState]);\n\t\t\treturn;\n\t\t}\n\t\tthis.renderButtons();\n\t};\n\n\t/**\n\t * @param {string} callState\n\t * @param {object} additionalParams\n\t * @see CallState\n\t */\n\tsetCallState(callState, additionalParams)\n\t{\n\t\tif (this.callState === callState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callState = callState;\n\n\t\tif (!Type.isPlainObject(additionalParams))\n\t\t{\n\t\t\tadditionalParams = {};\n\t\t}\n\n\t\tthis.renderButtons();\n\t\tif (callState === CallState.connected && this.isAutoFoldAllowed())\n\t\t{\n\t\t\tthis.fold();\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"CallCard::CallStateChanged\", [callState, additionalParams]);\n\t\tthis.setOnSlave(desktopEvents.setCallState, [callState, additionalParams]);\n\t};\n\n\tisAutoFoldAllowed()\n\t{\n\t\treturn (this.autoFold === true && !this.isDesktop() && !this.isFolded() && this.restApps.length === 0);\n\t};\n\n\tisHeld()\n\t{\n\t\treturn this.held;\n\t};\n\n\tsetHeld(held)\n\t{\n\t\tthis.held = held;\n\t};\n\n\tsetRecording(recording)\n\t{\n\t\tthis.recording = recording;\n\t};\n\n\tisRecording()\n\t{\n\t\treturn this.recording;\n\t};\n\n\tisMuted()\n\t{\n\t\treturn this.muted;\n\t};\n\n\tsetMuted(muted)\n\t{\n\t\tthis.muted = muted;\n\t};\n\n\tisTransfer()\n\t{\n\t\treturn this.transfer;\n\t};\n\n\tsetTransfer(transfer)\n\t{\n\t\ttransfer = (transfer === true);\n\t\tif (this.transfer == transfer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.transfer = transfer;\n\t\tthis.setOnSlave(desktopEvents.setTransfer, [transfer]);\n\t\tthis.setUiState(this._uiState);\n\t};\n\n\tisCallback()\n\t{\n\t\treturn (this.direction === Direction.callback);\n\t};\n\n\tisPortalCall()\n\t{\n\t\treturn this.portalCall;\n\t};\n\n\tsetCallback(eventName, callback)\n\t{\n\t\tif (!this.callbacks.hasOwnProperty(eventName))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.callbacks[eventName] = Type.isFunction(callback) ? callback : nop;\n\t};\n\n\tsetDeviceCall(deviceCall)\n\t{\n\t\tthis.deviceCall = deviceCall;\n\n\t\tif (this.elements.buttons.sipPhone)\n\t\t{\n\t\t\tif (deviceCall)\n\t\t\t{\n\t\t\t\tDom.addClass(this.elements.buttons.sipPhone, 'active');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.elements.buttons.sipPhone, 'active');\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.setDeviceCall, [deviceCall]);\n\t\t}\n\t};\n\n\tsetCrmEntity(params)\n\t{\n\t\tthis.crmEntityType = params.type;\n\t\tthis.crmEntityId = params.id;\n\t\tthis.crmActivityId = params.activityId || '';\n\t\tthis.crmActivityEditUrl = params.activityEditUrl || '';\n\t\tthis.crmBindings = Type.isArray(params.bindings) ? params.bindings : [];\n\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.setCrmEntity, [params]);\n\t\t}\n\t};\n\n\tsetCrmData(crmData)\n\t{\n\t\tif (!Type.isPlainObject(crmData))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.crm = true;\n\t\tthis.crmData = crmData;\n\t};\n\n\tloadCrmCard(entityType, entityId)\n\t{\n\t\tBX.onCustomEvent(window, 'CallCard::EntityChanged', [{\n\t\t\t'CRM_ENTITY_TYPE': entityType,\n\t\t\t'CRM_ENTITY_ID': entityId,\n\t\t\t'PHONE_NUMBER': this.phoneNumber\n\t\t}]);\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.entityChanged,{\n\t\t\t'CRM_ENTITY_TYPE': entityType,\n\t\t\t'CRM_ENTITY_ID': entityId,\n\t\t\t'PHONE_NUMBER': this.phoneNumber\n\t\t});\n\n\t\tBX.ajax.runAction(\"voximplant.callview.getCrmCard\", {\n\t\t\tdata: {\n\t\t\t\tentityType: entityType,\n\t\t\t\tentityId: entityId\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (this.currentLayout == layouts.simple)\n\t\t\t{\n\t\t\t\tthis.currentLayout = layouts.crm;\n\t\t\t\tthis.crm = true;\n\t\t\t\tvar newMainElement = this.createLayoutCrm();\n\n\t\t\t\tthis.elements.main.parentNode.replaceChild(newMainElement, this.elements.main);\n\t\t\t\tthis.elements.main = newMainElement;\n\t\t\t\tthis.setUiState(this._uiState);\n\t\t\t\tthis.setStatusText(this.statusText);\n\t\t\t}\n\n\t\t\tif (this.elements.crmCard)\n\t\t\t{\n\t\t\t\tBX.html(this.elements.crmCard, response.data.html);\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tif (this.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.resizeWindow(this.getInitialWidth(), this.getInitialHeight());\n\t\t\t\t\t}\n\t\t\t\t\tthis.adjust();\n\t\t\t\t\tthis.bindCrmCardEvents();\n\t\t\t\t}, 100);\n\t\t\t}\n\n\t\t\tthis.renderCrmButtons();\n\t\t}).catch((response) => console.error(\"Could not load crm card: \", response.errors[0]));\n\t};\n\n\treloadCrmCard()\n\t{\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.reloadCrmCard, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t}\n\t};\n\n\tbindCrmCardEvents()\n\t{\n\t\tif (!this.elements.crmCard)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!BX.Crm || !BX.Crm.Page)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar anchors = this.elements.crmCard.querySelectorAll('a[data-use-slider=Y]');\n\t\tfor (var i = 0; i < anchors.length; i++)\n\t\t{\n\t\t\tBX.bind(anchors[i], 'click', this.onCrmAnchorClick.bind(this));\n\t\t}\n\t};\n\n\tonCrmAnchorClick(e)\n\t{\n\t\tif (BX.Crm.Page.isSliderEnabled(e.currentTarget.href))\n\t\t{\n\t\t\tif (!this.isFolded())\n\t\t\t{\n\t\t\t\tthis.fold();\n\t\t\t}\n\t\t}\n\t};\n\n\tsetPortalCallUserId(userId)\n\t{\n\t\tthis.portalCallUserId = userId;\n\t\tthis.setOnSlave(desktopEvents.setPortalCallUserId, [userId]);\n\n\t\tif (this.portalCallData && this.portalCallData.users[this.portalCallUserId])\n\t\t{\n\t\t\tthis.renderAvatar();\n\t\t\tthis.createTitle().then(title => this.setTitle(title));\n\t\t}\n\t};\n\n\tsetPortalCallQueueName(queueName)\n\t{\n\t\tthis.portalCallQueueName = queueName;\n\t\tthis.setOnSlave(desktopEvents.setPortalCallQueueName, [queueName]);\n\n\t\tthis.createTitle().then(title => this.setTitle(title));\n\t};\n\n\tsetPortalCall(portalCall)\n\t{\n\t\tthis.portalCall = (portalCall === true);\n\t\tthis.setOnSlave(desktopEvents.setPortalCall, [portalCall]);\n\t};\n\n\tsetPortalCallData(data)\n\t{\n\t\tthis.portalCallData = data;\n\t\tthis.setOnSlave(desktopEvents.setPortalCallData, [data]);\n\t};\n\n\tsetOnSlave(message, parameters)\n\t{\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(message, parameters);\n\t\t}\n\t};\n\n\tupdateView()\n\t{\n\t\tif (this.elements.title)\n\t\t{\n\t\t\tthis.elements.title.innerHTML = this.renderTitle();\n\t\t}\n\n\t\tif (this.elements.progress)\n\t\t{\n\t\t\tDom.clean(this.elements.progress);\n\t\t\tthis.elements.progress.appendChild(this.renderProgress(this.progress));\n\t\t}\n\n\t\tif (this.elements.status)\n\t\t{\n\t\t\tthis.elements.status.innerText = this.statusText;\n\t\t}\n\n\t\tthis.renderButtons();\n\t\tthis.renderTimer();\n\t};\n\n\trenderProgress(progress: $Keys<typeof CallProgress>): HTMLElement\n\t{\n\t\tlet result;\n\t\tswitch (progress)\n\t\t{\n\t\t\tcase CallProgress.connect:\n\t\t\t\tresult = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-overlay-progress'}, children: [\n\t\t\t\t\t\tDom.create(\"img\", {props: {className: 'bx-messenger-call-overlay-progress-status bx-messenger-call-overlay-progress-status-anim-1'}}),\n\t\t\t\t\t\tDom.create(\"img\", {props: {className: 'bx-messenger-call-overlay-progress-status bx-messenger-call-overlay-progress-status-anim-2'}})\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase CallProgress.online:\n\t\t\t\tresult = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-overlay-progress bx-messenger-call-overlay-progress-online'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"img\", {props: {className: 'bx-messenger-call-overlay-progress-status bx-messenger-call-overlay-progress-status-anim-3'}})\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase CallProgress.error:\n\t\t\t\tprogress = CallProgress.offline;\n\t\t\t// fallthrough to default\n\t\t\tdefault:\n\t\t\t\tresult = Dom.create(\"div\", {props: {className: 'bx-messenger-call-overlay-progress bx-messenger-call-overlay-progress-' + progress}});\n\t\t}\n\n\t\treturn result;\n\t};\n\n\t/**\n\t * @param uiState UiState\n\t * @returns object {buttons: string[], layout: string}\n\t */\n\tgetUiStateButtons(uiState)\n\t{\n\t\tvar result = {\n\t\t\tbuttons: [],\n\t\t\tlayout: ButtonLayouts.centered\n\t\t};\n\t\tswitch (uiState)\n\t\t{\n\t\t\tcase UiState.incoming:\n\t\t\t\tresult.buttons = ['answer', 'skip'];\n\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferIncoming:\n\t\t\t\tresult.buttons = ['answer', 'skip'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.outgoing:\n\t\t\t\tresult.buttons = ['call'];\n\n\t\t\t\tif (this.callListId > 0)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('next');\n\t\t\t\t\tresult.buttons.push('fold');\n\n\t\t\t\t\tif (!this.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.buttons.push('topClose');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingIncoming:\n\t\t\t\tresult.buttons = ['hangup'];\n\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingOutgoing:\n\t\t\t\tif (this.hasSipPhone)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('sipPhone');\n\t\t\t\t}\n\t\t\t\tresult.buttons.push('hangup');\n\t\t\t\tbreak;\n\t\t\tcase UiState.error:\n\t\t\t\tif (this.hasSipPhone)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('sipPhone');\n\t\t\t\t}\n\t\t\t\tif (this.callListId > 0)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('redial', 'next', 'topClose');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('close');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UiState.moneyError:\n\t\t\t\tresult.buttons = ['notifyAdmin', 'close'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.sipPhoneError:\n\t\t\t\tresult.buttons = ['sipPhone', 'close'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.connected:\n\t\t\t\tresult.buttons = this.isTransfer() ? [] : ['hold'];\n\t\t\t\tif (!this.deviceCall)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('mute', 'qualityMeter');\n\t\t\t\t}\n\t\t\t\tresult.buttons.push('fold');\n\n\t\t\t\tif (!this.callListId && !this.isTransfer())\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('transfer');\n\t\t\t\t}\n\n\t\t\t\tif (this.deviceCall)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('close');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('dialpad', 'hangup');\n\t\t\t\t}\n\n\t\t\t\tresult.layout = ButtonLayouts.spaced;\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferring:\n\t\t\t\tresult.buttons = ['transferComplete', 'transferCancel'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferFailed:\n\t\t\t\tresult.buttons = ['transferCancel'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferConnected:\n\t\t\t\tresult.buttons = ['hangup'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.idle:\n\t\t\t\tif (this.hasSipPhone)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons = ['close'];\n\t\t\t\t}\n\t\t\t\telse if (this.direction == Direction.incoming)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons = ['close'];\n\t\t\t\t}\n\t\t\t\telse if (this.direction == Direction.outgoing)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons = ['redial'];\n\t\t\t\t\tif (this.callListId > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.buttons.push('next');\n\t\t\t\t\t\tresult.buttons.push('fold');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.buttons.push('close');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.callListId > 0 && !this.isDesktop())\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('topClose');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UiState.redial:\n\t\t\t\tresult.buttons = ['redial'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.externalCard:\n\t\t\t\tresult.buttons = ['close'];\n\t\t\t\tresult.buttons.push('fold');\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\trenderButtons()\n\t{\n\t\tif (this.isFolded())\n\t\t{\n\t\t\tthis.renderButtonsFolded();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderButtonsDefault();\n\t\t}\n\t};\n\n\trenderButtonsDefault()\n\t{\n\t\tvar buttonsFragment = document.createDocumentFragment();\n\t\tvar topButtonsFragment = document.createDocumentFragment();\n\t\tvar topLevelButtonsFragment = document.createDocumentFragment();\n\t\tvar subContainers = {\n\t\t\tleft: null,\n\t\t\tright: null\n\t\t};\n\t\tthis.elements.buttons = {};\n\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t{\n\t\t\tsubContainers.left = Dom.create('div', {props: {className: 'im-phone-call-buttons-container-left'}});\n\t\t\tsubContainers.right = Dom.create('div', {props: {className: 'im-phone-call-buttons-container-right'}});\n\t\t\tbuttonsFragment.appendChild(subContainers.left);\n\t\t\tbuttonsFragment.appendChild(subContainers.right);\n\t\t}\n\n\t\tthis.buttons.forEach((buttonName) =>\n\t\t{\n\t\t\tlet buttonNode;\n\n\t\t\tswitch (buttonName)\n\t\t\t{\n\t\t\t\tcase 'hold':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-hold', this._onHoldButtonClickHandler);\n\t\t\t\t\tif (this.isHeld())\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(buttonNode, 'active');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'mute':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-mute', this._onMuteButtonClickHandler);\n\t\t\t\t\tif (this.isMuted())\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(buttonNode, 'active');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'transfer':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-transfer', this._onTransferButtonClickHandler);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'transferComplete':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_TRANSFER'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-blue im-phone-call-btn-arrow',\n\t\t\t\t\t\tthis._onTransferCompleteButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'transferCancel':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_RETURN'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red',\n\t\t\t\t\t\tthis._onTransferCancelButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'dialpad':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-dialpad', this._onDialpadButtonClickHandler);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'call':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_PHONE_CALL'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-green',\n\t\t\t\t\t\tthis._onMakeCallButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'answer':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_PHONE_BTN_ANSWER'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-green',\n\t\t\t\t\t\tthis._onAnswerButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'skip':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_PHONE_BTN_BUSY'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red',\n\t\t\t\t\t\tthis._onSkipButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'hangup':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_HANGUP'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red  im-phone-call-btn-tube',\n\t\t\t\t\t\tthis._onHangupButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.right.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'close':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_CLOSE'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red',\n\t\t\t\t\t\tthis._onCloseButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.right.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'topClose':\n\t\t\t\t\tif (!this.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-top-close-btn'},\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onCloseButtonClickHandler\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttopLevelButtonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'notifyAdmin':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_NOTIFY_ADMIN'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-blue im-phone-call-btn-arrow',\n\t\t\t\t\t\t() =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.backgroundWorker.isUsed\n\t\t\t\t\t\t\t\t? this.backgroundWorker.emitEvent(backgroundWorkerEvents.notifyAdminButtonClick)\n\t\t\t\t\t\t\t\t: this.callbacks.notifyAdmin()\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'sipPhone':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', (this.deviceCall ? 'im-phone-call-btn-phone active' : 'im-phone-call-btn-phone'), this._onSwitchDeviceButtonClickHandler);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'qualityMeter':\n\t\t\t\t\tbuttonNode = Dom.create(\"span\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-call-btn-signal'},\n\t\t\t\t\t\tevents: {click: this._onQualityMeterClickHandler},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn-signal-icon-container'}, children: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {props: {className: 'im-phone-call-btn-signal-background'}}),\n\t\t\t\t\t\t\t\t\tthis.elements.qualityMeter = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn-signal-active'},\n\t\t\t\t\t\t\t\t\t\tstyle: {width: this.getQualityMeterWidth()}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t]\n\t\t\t\t\t});\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'settings':\n\t\t\t\t\t// todo\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'next':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_NEXT'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-gray im-phone-call-btn-arrow',\n\t\t\t\t\t\tthis._onNextButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'redial':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_RECALL'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-green',\n\t\t\t\t\t\tthis._onMakeCallButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'fold':\n\t\t\t\t\tif (!this.isDesktop() && this.canBeFolded())\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-btn-arrow'},\n\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_FOLD'),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onFoldButtonClickHandler\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttopButtonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow \"Unknown button \" + buttonName;\n\t\t\t}\n\n\t\t\tif (buttonNode)\n\t\t\t{\n\t\t\t\tthis.elements.buttons[buttonName] = buttonNode;\n\t\t\t}\n\t\t});\n\t\tif (this.elements.buttonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.buttonsContainer);\n\t\t\tthis.elements.buttonsContainer.appendChild(buttonsFragment);\n\t\t}\n\t\tif (this.elements.topButtonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.topButtonsContainer);\n\t\t\tthis.elements.topButtonsContainer.appendChild(topButtonsFragment);\n\t\t}\n\t\tif (this.elements.topLevelButtonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.topLevelButtonsContainer);\n\t\t\tthis.elements.topLevelButtonsContainer.appendChild(topLevelButtonsFragment);\n\t\t}\n\t};\n\n\trenderButtonsFolded()\n\t{\n\t\tlet buttonsFragment = document.createDocumentFragment();\n\t\tlet buttonNode;\n\t\tthis.elements.buttons = {};\n\n\t\tthis.buttons.forEach((buttonName) =>\n\t\t{\n\t\t\tswitch (buttonName)\n\t\t\t{\n\t\t\t\tcase 'hangup':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_HANGUP'),\n\t\t\t\t\t\t'im-phone-call-panel-mini-cancel',\n\t\t\t\t\t\tthis._onHangupButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'close':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_CLOSE'),\n\t\t\t\t\t\t'im-phone-call-panel-mini-cancel',\n\t\t\t\t\t\tthis._onCloseButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tif (this.elements.buttonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.buttonsContainer);\n\t\t\tthis.elements.buttonsContainer.appendChild(buttonsFragment);\n\t\t}\n\t};\n\n\trenderCrmButtons()\n\t{\n\t\tlet buttonsFragment = document.createDocumentFragment();\n\t\tthis.elements.crmButtons = {};\n\n\t\tif (!this.elements.crmButtonsContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet buttons = ['addComment'];\n\n\t\tif (this.crmEntityType == 'CONTACT')\n\t\t{\n\t\t\tbuttons.push('addDeal');\n\t\t\tbuttons.push('addInvoice');\n\t\t}\n\t\telse if (this.crmEntityType == 'COMPANY')\n\t\t{\n\t\t\tbuttons.push('addDeal');\n\t\t\tbuttons.push('addInvoice');\n\t\t}\n\t\telse if (!this.crmEntityType && this.config.CRM_CREATE == 'none')\n\t\t{\n\t\t\tbuttons.push('addLead');\n\t\t\tbuttons.push('addContact');\n\t\t}\n\n\t\tif (buttons.length > 0)\n\t\t{\n\t\t\tbuttons.forEach((buttonName) =>\n\t\t\t{\n\t\t\t\tlet buttonNode;\n\t\t\t\tswitch (buttonName)\n\t\t\t\t{\n\t\t\t\t\tcase 'addComment':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button im-phone-call-crm-button-comment' + (this.commentShown ? ' im-phone-call-crm-button-active' : '')},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.crmButtons.addCommentLabel = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: this.commentShown ? Loc.getMessage('IM_PHONE_CALL_VIEW_SAVE') : Loc.getMessage('IM_PHONE_ACTION_CRM_COMMENT')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddCommentButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addDeal':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_ACTION_CRM_DEAL')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddDealButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addInvoice':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_ACTION_CRM_INVOICE')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddInvoiceButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addLead':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_CRM_BTN_NEW_LEAD')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddLeadButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addContact':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_CRM_BTN_NEW_CONTACT')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddContactButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (buttonNode)\n\t\t\t\t{\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tthis.elements.crmButtons[buttonName] = buttonNode;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tDom.clean(this.elements.crmButtonsContainer);\n\t\t\tthis.elements.crmButtonsContainer.appendChild(buttonsFragment);\n\t\t\tthis.showSections(['crmButtons']);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.clean(this.elements.crmButtonsContainer);\n\t\t\tthis.hideSections(['crmButtons']);\n\t\t}\n\t};\n\n\tloadForm(params)\n\t{\n\t\tif (!this.formManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.formManager.load({\n\t\t\tid: params.id,\n\t\t\tsecCode: params.secCode\n\t\t})\n\t};\n\n\tunloadForm()\n\t{\n\t\tif (!this.formManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.formManager.unload();\n\t\tDom.clean(this.elements.tabsBody.webform);\n\t};\n\n\t_onFormSend(e)\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar currentElement = this.callListView.getCurrentElement();\n\t\tthis.callListView.setWebformResult(currentElement.ELEMENT_ID, e.resultId);\n\t};\n\n\tloadRestApp(params)\n\t{\n\t\tvar restAppId = params.id;\n\t\tvar node = params.node;\n\n\t\tif (this.restAppLayoutLoaded)\n\t\t{\n\t\t\tBX.rest.AppLayout.getPlacement('CALL_CARD').load(restAppId, this.getPlacementOptions());\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.restAppLayoutLoading)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.restAppLayoutLoading = true;\n\n\t\tBX.ajax.runAction(\"voximplant.callView.loadRestApp\", {\n\t\t\tdata: {\n\t\t\t\t'appId': restAppId,\n\t\t\t\t'placementOptions': this.getPlacementOptions()\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (!this.popup && !this.isDesktop())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tRuntime.html(node, response.data.html);\n\t\t\tthis.restAppLayoutLoaded = true;\n\t\t\tthis.restAppLayoutLoading = false;\n\t\t\tthis.restAppInterface = BX.rest.AppLayout.initializePlacement('CALL_CARD');\n\t\t\tthis.initializeAppInterface(this.restAppInterface);\n\t\t});\n\t};\n\n\tunloadRestApps()\n\t{\n\t\tif (!BX.rest || !BX.rest.AppLayout)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tvar placement = BX.rest.AppLayout.getPlacement('CALL_CARD');\n\t\tif (this.restAppLayoutLoaded && placement)\n\t\t{\n\t\t\tplacement.destroy();\n\t\t\tthis.restAppLayoutLoaded = false;\n\t\t}\n\t};\n\n\tinitializeAppInterface(appInterface)\n\t{\n\t\tappInterface.prototype.events.push('CallCard::EntityChanged');\n\t\tappInterface.prototype.events.push('CallCard::BeforeClose');\n\t\tappInterface.prototype.events.push('CallCard::CallStateChanged');\n\t\tappInterface.prototype.getStatus = (params, cb) =>\n\t\t{\n\t\t\tcb(this.getPlacementOptions());\n\t\t};\n\n\t\tappInterface.prototype.disableAutoClose = (params, cb) =>\n\t\t{\n\t\t\tthis.disableAutoClose();\n\t\t\tcb([]);\n\t\t};\n\n\t\tappInterface.prototype.enableAutoClose = (params, cb) =>\n\t\t{\n\t\t\tthis.enableAutoClose();\n\t\t\tcb([]);\n\t\t};\n\t};\n\n\tgetPlacementOptions()\n\t{\n\t\treturn {\n\t\t\t'CALL_ID': this.callId,\n\t\t\t'PHONE_NUMBER': this.phoneNumber === \"unknown\" ? undefined : this.phoneNumber,\n\t\t\t'LINE_NUMBER': this.lineNumber,\n\t\t\t'LINE_NAME': this.companyPhoneNumber,\n\t\t\t'CRM_ENTITY_TYPE': this.crmEntityType,\n\t\t\t'CRM_ENTITY_ID': this.crmEntityId,\n\t\t\t'CRM_ACTIVITY_ID': this.crmActivityId === 0 ? undefined : this.crmActivityId,\n\t\t\t'CRM_BINDINGS': this.crmBindings,\n\t\t\t'CALL_DIRECTION': this.direction,\n\t\t\t'CALL_STATE': this.callState,\n\t\t\t'CALL_LIST_MODE': this.callListId > 0\n\t\t}\n\t};\n\n\tisUnloadAllowed()\n\t{\n\t\tif (this.backgroundWorker.isActiveIntoCurrentCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.folded &&\n\t\t\t(\n\t\t\t\tthis.deviceCall ||\n\t\t\t\tthis._uiState === UiState.idle ||\n\t\t\t\tthis._uiState === UiState.error ||\n\t\t\t\tthis._uiState === UiState.externalCard\n\t\t\t);\n\t};\n\n\t_onBeforeUnload(e)\n\t{\n\t\tif (!this.isUnloadAllowed())\n\t\t{\n\t\t\te.returnValue = Loc.getMessage('IM_PHONE_CALL_VIEW_DONT_LEAVE');\n\t\t\treturn Loc.getMessage('IM_PHONE_CALL_VIEW_DONT_LEAVE');\n\t\t}\n\t};\n\n\t_onDblClick(e: Event)\n\t{\n\t\te.preventDefault()\n\t\tif (!this.isFolded() && this.canBeFolded())\n\t\t{\n\t\t\tthis.fold();\n\t\t}\n\t};\n\n\t_onHoldButtonClick()\n\t{\n\t\tif (this.isHeld())\n\t\t{\n\t\t\tthis.held = false;\n\t\t\tDom.removeClass(this.elements.buttons.hold, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onUnHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.unhold();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.held = true;\n\t\t\tDom.addClass(this.elements.buttons.hold, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.hold();\n\t\t\t}\n\t\t}\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.holdButtonClick,this.isHeld())\n\t};\n\n\t_onMuteButtonClick()\n\t{\n\t\tif (this.isMuted())\n\t\t{\n\t\t\tthis.muted = false;\n\t\t\tDom.removeClass(this.elements.buttons.mute, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onUnMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.unmute();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.muted = true;\n\t\t\tDom.addClass(this.elements.buttons.mute, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.mute();\n\t\t\t}\n\t\t}\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.muteButtonClick, this.isMuted());\n\t};\n\n\t_onTransferButtonClick()\n\t{\n\t\tthis.selectTransferTarget((result) =>\n\t\t{\n\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.transferButtonClick, result)\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onStartTransfer, [result]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.transfer(result);\n\t\t\t}\n\t\t});\n\t};\n\n\t_onTransferCompleteButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.completeTransferButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onCompleteTransfer, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.completeTransfer();\n\t\t}\n\t};\n\n\t_onTransferCancelButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.cancelTransferButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onCancelTransfer, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.cancelTransfer();\n\t\t}\n\t};\n\n\t_onDialpadButtonClick()\n\t{\n\t\tthis.keypad = new Keypad({\n\t\t\tbindElement: this.elements.buttons.dialpad,\n\t\t\thideDial: true,\n\t\t\tonButtonClick: (e) =>\n\t\t\t{\n\t\t\t\tvar key = e.key;\n\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t{\n\t\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onDialpadButtonClicked, [key]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.dialpadButtonClicked(key);\n\t\t\t\t}\n\t\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.dialpadButtonClick, key);\n\t\t\t},\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.keypad.destroy();\n\t\t\t\tthis.keypad = null;\n\t\t\t}\n\t\t});\n\t\tthis.keypad.show();\n\t};\n\n\t_onHangupButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.hangupButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onHangup, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.hangup();\n\t\t}\n\t};\n\n\t_onCloseButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.closeButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onClose, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t};\n\n\t_onMakeCallButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.makeCallButtonClick);\n\t\tvar event = {};\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tthis.callingEntity = this.currentEntity;\n\n\t\t\tif (this.currentEntity.phones.length === 0)\n\t\t\t{\n\t\t\t\t// show keypad and dial entered number\n\t\t\t\tthis.keypad = new Keypad({\n\t\t\t\t\tbindElement: this.elements.buttons.call ? this.elements.buttons.call : null,\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keypad.destroy();\n\t\t\t\t\t\tthis.keypad = null;\n\t\t\t\t\t},\n\t\t\t\t\tonDial: (e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keypad.close();\n\t\t\t\t\t\tthis.phoneNumber = e.phoneNumber;\n\t\t\t\t\t\tthis.createTitle().then(title => this.setTitle(title));\n\n\t\t\t\t\t\tevent = {\n\t\t\t\t\t\t\tphoneNumber: e.phoneNumber,\n\t\t\t\t\t\t\tcrmEntityType: this.crmEntityType,\n\t\t\t\t\t\t\tcrmEntityId: this.crmEntityId,\n\t\t\t\t\t\t\tcallListId: this.callListId\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onCallListMakeCall, [event]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callbacks.callListMakeCall(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.keypad.show();\n\t\t\t}\n\t\t\telse if (this.currentEntity.phones.length == 1)\n\t\t\t{\n\t\t\t\t// just dial the number\n\t\t\t\tevent.phoneNumber = this.currentEntity.phones[0].VALUE;\n\t\t\t\tevent.crmEntityType = this.crmEntityType;\n\t\t\t\tevent.crmEntityId = this.crmEntityId;\n\t\t\t\tevent.callListId = this.callListId;\n\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t{\n\t\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onCallListMakeCall, [event]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.callListMakeCall(event);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// allow user to select the number\n\t\t\t\tthis.showNumberSelectMenu({\n\t\t\t\t\tbindElement: this.elements.buttons.call ? this.elements.buttons.call : null,\n\t\t\t\t\tphoneNumbers: this.currentEntity.phones,\n\t\t\t\t\tonSelect: (e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.closeNumberSelectMenu();\n\t\t\t\t\t\tthis.phoneNumber = e.phoneNumber;\n\t\t\t\t\t\tthis.createTitle().then(title => this.setTitle(title));\n\n\t\t\t\t\t\tevent = {\n\t\t\t\t\t\t\tphoneNumber: e.phoneNumber,\n\t\t\t\t\t\t\tcrmEntityType: this.crmEntityType,\n\t\t\t\t\t\t\tcrmEntityId: this.crmEntityId,\n\t\t\t\t\t\t\tcallListId: this.callListId\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onCallListMakeCall, [event]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callbacks.callListMakeCall(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onMakeCall, [this.phoneNumber]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.makeCall(this.phoneNumber);\n\t\t\t}\n\t\t}\n\t};\n\n\t_onNextButtonClick()\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.nextButtonClick);\n\t\tthis.setUiState(UiState.outgoing);\n\t\tthis.callListView.moveToNextItem();\n\t\tthis.setStatusText('');\n\t};\n\n\t_onRedialButtonClick(e)\n\t{\n\n\t};\n\n\t_onCommentChanged()\n\t{\n\t\tthis.comment = this.elements.commentEditor.value;\n\t};\n\n\t_onAddCommentButtonClick()\n\t{\n\t\tthis.commentShown = !this.commentShown;\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onCommentShown, [this.commentShown]);\n\t\t}\n\n\t\tif (this.commentShown)\n\t\t{\n\t\t\tif (this.elements.crmButtons.addComment)\n\t\t\t{\n\t\t\t\tDom.addClass(this.elements.crmButtons.addComment, 'im-phone-call-crm-button-active');\n\t\t\t\tthis.elements.crmButtons.addCommentLabel.innerText = Loc.getMessage('IM_PHONE_CALL_VIEW_SAVE');\n\t\t\t}\n\t\t\tif (this.elements.commentEditor)\n\t\t\t{\n\t\t\t\tthis.elements.commentEditor.value = this.comment;\n\t\t\t\tthis.elements.commentEditor.focus();\n\t\t\t}\n\n\t\t\tif (this.elements.commentEditorContainer)\n\t\t\t{\n\t\t\t\tthis.elements.commentEditorContainer.style.removeProperty('display');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tif (this.elements.crmButtons.addComment)\n\t\t\t{\n\t\t\t\tDom.removeClass(this.elements.crmButtons.addComment, 'im-phone-call-crm-button-active');\n\t\t\t\tthis.elements.crmButtons.addCommentLabel.innerText = Loc.getMessage('IM_PHONE_ACTION_CRM_COMMENT');\n\t\t\t}\n\n\t\t\tif (this.elements.commentEditorContainer)\n\t\t\t{\n\t\t\t\tthis.elements.commentEditorContainer.style.display = 'none';\n\t\t\t}\n\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onSaveComment, [this.comment]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.saveComment();\n\t\t\t}\n\n\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.addCommentButtonClick, this.comment);\n\t\t}\n\t};\n\n\t_onAddDealButtonClick()\n\t{\n\t\tvar url = this._getCrmEditUrl('DEAL', 0);\n\t\tvar externalContext = this._generateExternalContext();\n\t\tif (this.crmEntityType === 'CONTACT')\n\t\t{\n\t\t\turl = Uri.addParam(url, {contact_id: this.crmEntityId});\n\t\t}\n\t\telse if (this.crmEntityType === 'COMPANY')\n\t\t{\n\t\t\turl = Uri.addParam(url, {company_id: this.crmEntityId});\n\t\t}\n\n\t\turl = Uri.addParam(url, {external_context: externalContext});\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\turl = Uri.addParam(url, {call_list_id: this.callListId});\n\t\t\turl = Uri.addParam(url, {call_list_element: this.currentEntity.id});\n\t\t}\n\n\t\tthis.externalRequests[externalContext] = {\n\t\t\ttype: 'add',\n\t\t\tcontext: externalContext,\n\t\t\twindow: window.open(url)\n\t\t};\n\t};\n\n\t_onAddInvoiceButtonClick()\n\t{\n\t\tlet url = this._getCrmEditUrl('INVOICE', 0);\n\t\tconst externalContext = this._generateExternalContext();\n\n\t\turl = Uri.addParam(url, {redirect: \"y\"});\n\t\tif (this.crmEntityType === 'CONTACT')\n\t\t{\n\t\t\turl = Uri.addParam(url, {contact: this.crmEntityId});\n\t\t}\n\t\telse if (this.crmEntityType === 'COMPANY')\n\t\t{\n\t\t\turl = Uri.addParam(url, {company: this.crmEntityId});\n\t\t}\n\n\t\turl = Uri.addParam(url, {external_context: externalContext});\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\turl = Uri.addParam(url, {call_list_id: this.callListId});\n\t\t\turl = Uri.addParam(url, {call_list_element: this.currentEntity.id});\n\t\t}\n\n\t\tthis.externalRequests[externalContext] = {\n\t\t\ttype: 'add',\n\t\t\tcontext: externalContext,\n\t\t\twindow: window.open(url)\n\t\t};\n\t};\n\n\t_onAddLeadButtonClick()\n\t{\n\t\tlet url = this._getCrmEditUrl('LEAD', 0);\n\t\turl = Uri.addParam(url, {\n\t\t\tphone: this.phoneNumber,\n\t\t\torigin_id: 'VI_' + this.callId\n\t\t});\n\t\twindow.open(url);\n\t};\n\n\t_onAddContactButtonClick()\n\t{\n\t\tlet url = this._getCrmEditUrl('CONTACT', 0);\n\t\turl = Uri.addParam(url, {\n\t\t\tphone: this.phoneNumber,\n\t\t\torigin_id: 'VI_' + this.callId\n\t\t});\n\t\twindow.open(url);\n\t};\n\n\t_onFoldButtonClick()\n\t{\n\t\tthis.fold();\n\t};\n\n\t_onAnswerButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.answerButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onAnswer, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.answer();\n\t\t}\n\t};\n\n\t_onSkipButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.skipButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onSkip, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.skip();\n\t\t}\n\t};\n\n\t_onSwitchDeviceButtonClick()\n\t{\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onSwitchDevice, [{\n\t\t\t\tphoneNumber: this.phoneNumber\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.switchDevice({\n\t\t\t\tphoneNumber: this.phoneNumber\n\t\t\t});\n\t\t}\n\t};\n\n\t_onQualityMeterClick()\n\t{\n\t\tthis.showQualityPopup({\n\t\t\tonSelect: (qualityGrade) =>\n\t\t\t{\n\t\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.qualityMeterClick, qualityGrade);\n\t\t\t\tthis.qualityGrade = qualityGrade;\n\t\t\t\tthis.closeQualityPopup();\n\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t{\n\t\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onQualityGraded, [qualityGrade]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.qualityGraded(qualityGrade);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t_onExternalEvent(params)\n\t{\n\t\tparams = Type.isPlainObject(params) ? params : {};\n\t\tparams.key = params.key || '';\n\n\t\tvar value = params.value || {};\n\t\tvalue.entityTypeName = value.entityTypeName || '';\n\t\tvalue.context = value.context || '';\n\t\tvalue.isCanceled = Type.isBoolean(value.isCanceled) ? value.isCanceled : false;\n\n\t\tif (value.isCanceled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.key === \"onCrmEntityCreate\" && this.externalRequests[value.context])\n\t\t{\n\t\t\tif (this.externalRequests[value.context])\n\t\t\t{\n\t\t\t\tif (this.externalRequests[value.context]['type'] == 'create')\n\t\t\t\t{\n\t\t\t\t\tthis.crmEntityType = value.entityTypeName;\n\t\t\t\t\tthis.crmEntityId = value.entityInfo.id;\n\t\t\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t\t\t}\n\t\t\t\telse if (this.externalRequests[value.context]['type'] == 'add')\n\t\t\t\t{\n\t\t\t\t\t// reload crm card\n\t\t\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t\t\t}\n\n\t\t\t\tif (this.externalRequests[value.context]['window'])\n\t\t\t\t{\n\t\t\t\t\tthis.externalRequests[value.context]['window'].close();\n\t\t\t\t}\n\n\t\t\t\tdelete this.externalRequests[value.context];\n\t\t\t}\n\t\t}\n\t};\n\n\t_onPullEventCrm(command, params)\n\t{\n\t\tif (command === 'external_event')\n\t\t{\n\t\t\tif (params.NAME === 'onCrmEntityCreate' && params.IS_CANCELED == false)\n\t\t\t{\n\t\t\t\tvar eventParams = params.PARAMS;\n\t\t\t\tif (this.externalRequests[eventParams.context])\n\t\t\t\t{\n\t\t\t\t\tvar crmEntityType = eventParams.entityTypeName;\n\t\t\t\t\tvar crmEntityId = eventParams.entityInfo.id;\n\n\t\t\t\t\tif (this.callListView)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar currentElement = this.callListView.getCurrentElement();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tonCallListSelectedItem(entity)\n\t{\n\t\tthis.currentEntity = entity;\n\t\tthis.crmEntityType = entity.type;\n\t\tthis.crmEntityId = entity.id;\n\t\tthis.comment = \"\";\n\n\t\tif (Type.isArray(entity.bindings))\n\t\t{\n\t\t\tthis.crmBindings = entity.bindings.map((value) =>\n\t\t\t\t{\n\t\t\t\t\treturn {'ENTITY_TYPE': value.type, 'ENTITY_ID': value.id}\n\t\t\t\t}\n\t\t\t)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.crmBindings = [];\n\t\t}\n\n\t\tif (entity.phones.length > 0)\n\t\t{\n\t\t\tthis.phoneNumber = entity.phones[0].VALUE;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.phoneNumber = 'unknown';\n\t\t}\n\n\t\tthis.createTitle().then(title => this.setTitle(title));\n\t\tthis.loadCrmCard(entity.type, entity.id);\n\t\tif (this.currentTabName === 'webform')\n\t\t{\n\t\t\tthis.formManager.unload();\n\t\t\tthis.formManager.load({\n\t\t\t\tid: this.webformId,\n\t\t\t\tsecCode: this.webformSecCode,\n\t\t\t\tlang: Loc.getMessage(\"LANGUAGE_ID\"),\n\t\t\t})\n\t\t}\n\t\tif (this._uiState === UiState.redial)\n\t\t{\n\t\t\tthis.setUiState(UiState.outgoing);\n\t\t}\n\n\t\tthis.updateView();\n\t};\n\n\t_onWindowUnload()\n\t{\n\t\tthis.close();\n\t};\n\n\tshowCallIcon()\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.callingEntity)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callListView.setCallingElement(this.callingEntity.statusId, this.callingEntity.index);\n\t};\n\n\thideCallIcon()\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callListView.resetCallingElement();\n\t};\n\n\tisTimerStarted()\n\t{\n\t\treturn !!this.timerInterval;\n\t}\n\n\tstartTimer()\n\t{\n\t\tif (this.isTimerStarted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.initialTimestamp === 0)\n\t\t{\n\t\t\tthis.initialTimestamp = (new Date()).getTime();\n\t\t}\n\t\tthis.timerInterval = setInterval(this.renderTimer.bind(this), 1000);\n\t\tthis.renderTimer();\n\t};\n\n\trenderTimer()\n\t{\n\t\tif (!this.elements.timer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet currentTimestamp = (new Date()).getTime();\n\t\tlet elapsedMilliSeconds = (currentTimestamp - this.initialTimestamp);\n\n\t\tlet elapsedSeconds = Math.floor(elapsedMilliSeconds / 1000);\n\t\tlet minutes = Math.floor(elapsedSeconds / 60).toString();\n\t\tif (minutes.length < 2)\n\t\t{\n\t\t\tminutes = '0' + minutes;\n\t\t}\n\t\tlet seconds = (elapsedSeconds % 60).toString();\n\t\tif (seconds.length < 2)\n\t\t{\n\t\t\tseconds = '0' + seconds;\n\t\t}\n\t\tconst template = (this.isRecording() ? Loc.getMessage('IM_PHONE_TIMER_WITH_RECORD') : Loc.getMessage('IM_PHONE_TIMER_WITHOUT_RECORD'));\n\n\t\tif (this.isFolded())\n\t\t{\n\t\t\tthis.elements.timer.innerText = minutes + ':' + seconds;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.timer.innerText = template.replace('#MIN#', minutes).replace('#SEC#', seconds);\n\t\t}\n\t};\n\n\tstopTimer()\n\t{\n\t\tif (!this.isTimerStarted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearInterval(this.timerInterval);\n\t\tthis.timerInterval = null;\n\t};\n\n\tshowQualityPopup(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (!Type.isFunction(params.onSelect))\n\t\t{\n\t\t\tparams.onSelect = nop;\n\t\t}\n\n\t\tconst elements = {\n\t\t\t'1': null,\n\t\t\t'2': null,\n\t\t\t'3': null,\n\t\t\t'4': null,\n\t\t\t'5': null\n\t\t};\n\n\t\tthis.qualityPopup = new Popup({\n\t\t\tid: 'PhoneCallViewQualityGrade',\n\t\t\tbindElement: this.elements.qualityMeter,\n\t\t\ttargetContainer: document.body,\n\t\t\tdarkMode: true,\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\tzIndex: baseZIndex + 200,\n\t\t\tnoAllPaddings: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top'\n\t\t\t},\n\t\t\tangle: {\n\t\t\t\tposition: 'bottom',\n\t\t\t\toffset: 30\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t\tcontent: Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-popup-rating'}, children: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-popup-rating-title'},\n\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_RATE_QUALITY')\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-popup-rating-stars'}, children: [\n\t\t\t\t\t\t\telements['1'] = createStar(1, this.qualityGrade == '1', params.onSelect),\n\t\t\t\t\t\t\telements['2'] = createStar(2, this.qualityGrade == '2', params.onSelect),\n\t\t\t\t\t\t\telements['3'] = createStar(3, this.qualityGrade == '3', params.onSelect),\n\t\t\t\t\t\t\telements['4'] = createStar(4, this.qualityGrade == '4', params.onSelect),\n\t\t\t\t\t\t\telements['5'] = createStar(5, this.qualityGrade == '5', params.onSelect)\n\t\t\t\t\t\t], events: {\n\t\t\t\t\t\t\tmouseover: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (elements[this.qualityGrade])\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tDom.removeClass(elements[this.qualityGrade], 'im-phone-popup-rating-stars-item-active');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmouseout: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (elements[this.qualityGrade])\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tDom.addClass(elements[this.qualityGrade], 'im-phone-popup-rating-stars-item-active');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}),\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => this.qualityPopup = null,\n\t\t\t}\n\t\t});\n\n\t\tthis.qualityPopup.show();\n\t};\n\n\tcloseQualityPopup()\n\t{\n\t\tif (this.qualityPopup)\n\t\t{\n\t\t\tthis.qualityPopup.close();\n\t\t}\n\t};\n\n\tsaveComment()\n\t{\n\t\tthis.callbacks.saveComment({\n\t\t\tcallId: this.callId,\n\t\t\tcomment: this.comment\n\t\t})\n\t};\n\n\tshowNumberSelectMenu(params)\n\t{\n\t\tvar menuItems = [];\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (!Type.isArray(params.phoneNumbers))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tparams.onSelect = Type.isFunction(params.onSelect) ? params.onSelect : BX.DoNothing;\n\t\tparams.phoneNumbers.forEach((phoneNumber) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: 'number-select-' + BX.util.getRandomString(10),\n\t\t\t\ttext: phoneNumber.VALUE,\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tparams.onSelect({\n\t\t\t\t\t\tphoneNumber: phoneNumber.VALUE\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.numberSelectMenu = new Menu(\n\t\t\t'im-phone-call-view-number-select',\n\t\t\tparams.bindElement,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 40,\n\t\t\t\tangle: {position: \"top\"},\n\t\t\t\tzIndex: baseZIndex + 200,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'white',\n\t\t\t\t\topacity: 0\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.numberSelectMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.numberSelectMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.numberSelectMenu.show();\n\t};\n\n\tcloseNumberSelectMenu()\n\t{\n\t\tif (this.numberSelectMenu)\n\t\t{\n\t\t\tthis.numberSelectMenu.close();\n\t\t}\n\t};\n\n\tfold()\n\t{\n\t\tif (!this.canBeFolded())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callListId > 0 && this.callState === CallState.idle)\n\t\t{\n\t\t\tthis.foldCallView();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.foldCall();\n\t\t}\n\t};\n\n\tunfold()\n\t{\n\t\tif (!this.isDesktop() && this.isFolded())\n\t\t{\n\t\t\tDom.remove(this.elements.main);\n\t\t\tthis.folded = false;\n\t\t\tthis.elements = this.unfoldedElements;\n\t\t\tthis.show();\n\t\t}\n\t};\n\n\tfoldCall()\n\t{\n\t\tif (this.isDesktop() || !this.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet popupNode = this.popup.getPopupContainer();\n\t\tlet overlayNode = this.popup.overlay.element;\n\n\t\tDom.addClass(popupNode, 'im-phone-call-view-folding');\n\t\tDom.addClass(overlayNode, 'popup-window-overlay-im-phone-call-view-folding');\n\t\tsetTimeout(() =>\n\t\t{\n\t\t\tthis.folded = true;\n\t\t\tthis.popup.close();\n\t\t\tthis.unfoldedElements = this.elements;\n\t\t\tDom.removeClass(popupNode, 'im-phone-call-view-folding');\n\t\t\tDom.removeClass(overlayNode, 'popup-window-overlay-im-phone-call-view-folding');\n\t\t\tthis.reinit();\n\t\t\tthis.enableDocumentScroll();\n\t\t}, 300);\n\t};\n\n\tfoldCallView()\n\t{\n\t\tconst foldedCallView = FoldedCallView.getInstance();\n\t\tconst popupNode = this.popup.getPopupContainer();\n\t\tconst overlayNode = this.popup.overlay.element;\n\n\t\tDom.addClass(popupNode, 'im-phone-call-view-folding');\n\t\tDom.addClass(overlayNode, 'popup-window-overlay-im-phone-call-view-folding');\n\t\tsetTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.close();\n\t\t\t\tfoldedCallView.fold({\n\t\t\t\t\tcallListId: this.callListId,\n\t\t\t\t\twebformId: this.webformId,\n\t\t\t\t\twebformSecCode: this.webformSecCode,\n\t\t\t\t\tcurrentItemIndex: this.callListView.currentItemIndex,\n\t\t\t\t\tcurrentItemStatusId: this.callListView.currentStatusId,\n\t\t\t\t\tstatusList: this.callListView.statuses,\n\t\t\t\t\tentityType: this.callListView.entityType\n\t\t\t\t}, true);\n\t\t\t},\n\t\t\t300\n\t\t);\n\t};\n\n\tbindSlaveDesktopEvents()\n\t{\n\t\tBX.desktop.addCustomEvent(desktopEvents.setTitle, this.setTitle.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setStatus, this.setStatusText.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setUiState, this.setUiState.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setDeviceCall, this.setDeviceCall.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setCrmEntity, this.setCrmEntity.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.reloadCrmCard, this.reloadCrmCard.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setPortalCall, this.setPortalCall.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setPortalCallUserId, this.setPortalCallUserId.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setPortalCallQueueName, this.setPortalCallQueueName.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setPortalCallData, this.setPortalCallData.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setConfig, this.setConfig.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setCallId, this.setCallId.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setLineNumber, this.setLineNumber.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setCompanyPhoneNumber, this.setCompanyPhoneNumber.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setPhoneNumber, this.setPhoneNumber.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setTransfer, this.setTransfer.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.setCallState, this.setCallState.bind(this));\n\t\tBX.desktop.addCustomEvent(desktopEvents.closeWindow, () => window.close());\n\n\t\tBX.bind(window, \"beforeunload\", () =>\n\t\t{\n\t\t\tBX.unbindAll(window, \"beforeunload\");\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onBeforeUnload, []);\n\t\t});\n\n\t\tBX.bind(window, \"resize\", Runtime.debounce(() =>\n\t\t{\n\t\t\tif (this.skipOnResize)\n\t\t\t{\n\t\t\t\tthis.skipOnResize = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.saveInitialSize(window.innerWidth, window.innerHeight)\n\t\t}, 100));\n\n\t\tBX.addCustomEvent(\"SidePanel.Slider:onOpen\", (event) =>\n\t\t{\n\t\t\tif (!event.getSlider().isSelfContained())\n\t\t\t{\n\t\t\t\tevent.denyAction();\n\t\t\t\twindow.open(event.slider.url);\n\t\t\t}\n\t\t});\n\n\t\t/*BX.bind(window, \"keydown\", function(e)\n\t\t{\n\t\t\tif(e.keyCode === 27)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onBeforeUnload, []);\n\t\t\t}\n\t\t}.bind(this));*/\n\t};\n\n\tbindMasterDesktopEvents()\n\t{\n\t\tBX.desktop.addCustomEvent(desktopEvents.onHold, () => this.callbacks.hold());\n\t\tBX.desktop.addCustomEvent(desktopEvents.onUnHold, () => this.callbacks.unhold());\n\t\tBX.desktop.addCustomEvent(desktopEvents.onMute, () => this.callbacks.mute());\n\t\tBX.desktop.addCustomEvent(desktopEvents.onUnMute, () => this.callbacks.unmute());\n\t\tBX.desktop.addCustomEvent(desktopEvents.onMakeCall, (phoneNumber) => this.callbacks.makeCall(phoneNumber));\n\t\tBX.desktop.addCustomEvent(desktopEvents.onCallListMakeCall, (e) => this.callbacks.callListMakeCall(e));\n\t\tBX.desktop.addCustomEvent(desktopEvents.onAnswer, () => this.callbacks.answer());\n\t\tBX.desktop.addCustomEvent(desktopEvents.onSkip, () => this.callbacks.skip());\n\t\tBX.desktop.addCustomEvent(desktopEvents.onHangup, () => this.callbacks.hangup());\n\t\tBX.desktop.addCustomEvent(desktopEvents.onClose, () => this.close());\n\t\tBX.desktop.addCustomEvent(desktopEvents.onStartTransfer, (e) => this.callbacks.transfer(e));\n\t\tBX.desktop.addCustomEvent(desktopEvents.onCompleteTransfer, () => this.callbacks.completeTransfer());\n\t\tBX.desktop.addCustomEvent(desktopEvents.onCancelTransfer, () => this.callbacks.cancelTransfer());\n\t\tBX.desktop.addCustomEvent(desktopEvents.onSwitchDevice, (e) => this.callbacks.switchDevice(e));\n\t\tBX.desktop.addCustomEvent(desktopEvents.onBeforeUnload, () =>\n\t\t{\n\t\t\tthis.desktop.window = null;\n\t\t\tthis.callbacks.hangup();\n\t\t\tthis.callbacks.close();\n\t\t}); //slave window unload\n\t\tBX.desktop.addCustomEvent(desktopEvents.onQualityGraded, (grade) => this.callbacks.qualityGraded(grade));\n\t\tBX.desktop.addCustomEvent(desktopEvents.onDialpadButtonClicked, (grade) => this.callbacks.dialpadButtonClicked(grade));\n\t\tBX.desktop.addCustomEvent(desktopEvents.onCommentShown, (commentShown) => this.commentShown = commentShown);\n\t\tBX.desktop.addCustomEvent(desktopEvents.onSaveComment, (comment) =>\n\t\t{\n\t\t\tthis.comment = comment;\n\t\t\tthis.saveComment();\n\t\t});\n\t\tBX.desktop.addCustomEvent(desktopEvents.onSetAutoClose, (autoClose) => this.autoClose = autoClose);\n\n\t};\n\n\tunbindDesktopEvents()\n\t{\n\t\tfor (let eventId in desktopEvents)\n\t\t{\n\t\t\tif (desktopEvents.hasOwnProperty(eventId))\n\t\t\t{\n\t\t\t\tBX.desktop.removeCustomEvents(desktopEvents[eventId]);\n\t\t\t}\n\t\t}\n\t};\n\n\tisDesktop()\n\t{\n\t\treturn BX.MessengerCommon.isDesktop();\n\t};\n\n\tisFolded()\n\t{\n\t\treturn this.folded;\n\t};\n\n\tcanBeFolded()\n\t{\n\t\treturn this.allowAutoClose && (this.callState === CallState.connected || (this.callState === CallState.idle && this.callListId > 0));\n\t};\n\n\tgetFoldedHeight()\n\t{\n\t\tif (!this.folded)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!this.elements.main)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn this.elements.main.clientHeight + (this.elements.sections.status ? this.elements.sections.status.clientHeight : 0);\n\t};\n\n\tisWebformSupported()\n\t{\n\t\treturn (!this.isDesktop() || this.desktop.isFeatureSupported('iframe'));\n\t};\n\n\tisRestAppsSupported()\n\t{\n\t\treturn (!this.isDesktop() || this.desktop.isFeatureSupported('iframe'));\n\t};\n\n\tsetClosable(closable)\n\t{\n\t\tclosable = (closable === true);\n\t\tthis.closable = closable;\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\t//this.desktop.setClosable(closable);\n\t\t}\n\t\telse if (this.popup)\n\t\t{\n\t\t\tthis.popup.setClosingByEsc(closable);\n\t\t\t//this.popup.setAutoHide(closable);\n\t\t}\n\t};\n\n\tisClosable()\n\t{\n\t\treturn this.closable;\n\t};\n\n\tadjust()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.adjustPosition();\n\t\t}\n\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tif (this.currentLayout == layouts.simple)\n\t\t\t{\n\t\t\t\tthis.desktop.setResizable(false);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.desktop.setResizable(true);\n\t\t\t\tthis.desktop.setMinSize((this.elements.sidebarContainer ? 900 : 550), 650);\n\t\t\t}\n\t\t\tthis.desktop.center();\n\t\t}\n\t};\n\n\tresizeWindow(width, height)\n\t{\n\t\tif (!this.isDesktop() || !this.slave)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.skipOnResize = true;\n\t\tthis.desktop.resize(width, height);\n\t};\n\n\tclose()\n\t{\n\t\tBX.onCustomEvent(window, 'CallCard::BeforeClose', []);\n\n\t\tif (this.isFolded() && this.elements.main)\n\t\t{\n\t\t\tDom.addClass(this.elements.main, 'im-phone-call-panel-mini-closing');\n\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tDom.remove(this.elements.main);\n\t\t\t\t\tthis.elements = this.getInitialElements();\n\t\t\t\t},\n\t\t\t\t300\n\t\t\t);\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\n\t\tif (this.desktop.window)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.closeWindow, []);\n\t\t\t//this.desktop.window.ExecuteCommand('close');\n\t\t\t//this.desktop.window = null;\n\t\t}\n\t\tthis.backgroundWorker.setCallCard(null);\n\t\tthis.backgroundWorker = null;\n\n\t\tthis.enableDocumentScroll();\n\n\t\tthis.callbacks.close();\n\t\tBX.onCustomEvent(window, 'CallCard::AfterClose', []);\n\t};\n\n\tdisableAutoClose()\n\t{\n\t\tthis.allowAutoClose = false;\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onSetAutoClose, [this.allowAutoClose]);\n\t\t}\n\t\tthis.renderButtons();\n\t};\n\n\tenableAutoClose()\n\t{\n\t\tthis.allowAutoClose = true;\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(desktopEvents.onSetAutoClose, [this.allowAutoClose]);\n\t\t}\n\t\tthis.renderButtons();\n\t};\n\n\tautoClose()\n\t{\n\t\tif (this.allowAutoClose && !this.commentShown)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.onCustomEvent(window, 'CallCard::BeforeClose', []);\n\t\t}\n\t};\n\n\tdisableDocumentScroll()\n\t{\n\t\tconst scrollWidth = window.innerWidth - document.documentElement.clientWidth;\n\t\tdocument.body.style.setProperty('padding-right', scrollWidth + \"px\");\n\t\tdocument.body.classList.add('im-phone-call-disable-scroll');\n\t\tconst imBar = document.getElementById('bx-im-bar');\n\t\tif (imBar)\n\t\t{\n\t\t\timBar.style.setProperty('right', scrollWidth + \"px\");\n\t\t}\n\t};\n\n\tenableDocumentScroll()\n\t{\n\t\tdocument.body.classList.remove('im-phone-call-disable-scroll');\n\t\tdocument.body.style.removeProperty('padding-right');\n\t\tconst imBar = document.getElementById('bx-im-bar');\n\t\tif (imBar)\n\t\t{\n\t\t\timBar.style.removeProperty('right');\n\t\t}\n\t};\n\n\tdispose()\n\t{\n\t\twindow.removeEventListener('beforeunload', this._onBeforeUnloadHandler);\n\t\tBX.removeCustomEvent(\"onPullEvent-crm\", this._onPullEventCrmHandler);\n\t\tthis.unloadRestApps();\n\t\tthis.unloadForm();\n\n\t\tif (this.isFolded() && this.elements.main)\n\t\t{\n\t\t\tDom.addClass(this.elements.main, 'im-phone-call-panel-mini-closing');\n\t\t\tsetTimeout(() => Dom.remove(this.elements.main), 300);\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\n\t\tif (this.qualityPopup)\n\t\t{\n\t\t\tthis.qualityPopup.close();\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tif (this.numberSelectMenu)\n\t\t{\n\t\t\tthis.closeNumberSelectMenu();\n\t\t}\n\n\t\tthis.enableDocumentScroll();\n\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tthis.unbindDesktopEvents();\n\t\t\tif (this.desktop.window)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.closeWindow, []);\n\t\t\t\t//this.desktop.window.ExecuteCommand('close');\n\t\t\t\tthis.desktop.window = null;\n\t\t\t}\n\t\t\tif (!this.slave)\n\t\t\t{\n\t\t\t\twindow.removeEventListener('beforeunload', this._unloadHandler); //master window unload\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\twindow.removeEventListener('beforeunload', this._onBeforeUnloadHandler);\n\t\t}\n\t};\n\n\tcanBeUnloaded()\n\t{\n\t\tif (this.backgroundWorker.isUsed())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.allowAutoClose && this.isFolded();\n\t};\n\n\tisCallListMode()\n\t{\n\t\treturn (this.callListId > 0);\n\t};\n\n\tgetState()\n\t{\n\t\treturn {\n\t\t\tcallId: this.callId,\n\t\t\tfolded: this.folded,\n\t\t\tuiState: this._uiState,\n\t\t\tphoneNumber: this.phoneNumber,\n\t\t\tcompanyPhoneNumber: this.companyPhoneNumber,\n\t\t\tdirection: this.direction,\n\t\t\tfromUserId: this.fromUserId,\n\t\t\ttoUserId: this.toUserId,\n\t\t\tstatusText: this.statusText,\n\t\t\tcrm: this.crm,\n\t\t\thasSipPhone: this.hasSipPhone,\n\t\t\tdeviceCall: this.deviceCall,\n\t\t\ttransfer: this.transfer,\n\t\t\tcrmEntityType: this.crmEntityType,\n\t\t\tcrmEntityId: this.crmEntityId,\n\t\t\tcrmActivityId: this.crmActivityId,\n\t\t\tcrmActivityEditUrl: this.crmActivityEditUrl,\n\t\t\tcallListId: this.callListId,\n\t\t\tcallListStatusId: this.callListStatusId,\n\t\t\tcallListItemIndex: this.callListItemIndex,\n\t\t\tconfig: (this.config ? this.config : '{}'),\n\t\t\tportalCall: (this.portalCall ? 'true' : 'false'),\n\t\t\tportalCallData: (this.portalCallData ? this.portalCallData : '{}'),\n\t\t\tportalCallUserId: this.portalCallUserId,\n\t\t\twebformId: this.webformId,\n\t\t\twebformSecCode: this.webformSecCode,\n\t\t\tinitialTimestamp: this.initialTimestamp,\n\t\t\tcrmData: this.crmData\n\t\t};\n\t};\n\n\tselectTransferTarget(resultCallback: (TransferTarget) => void)\n\t{\n\t\tresultCallback = Type.isFunction(resultCallback) ? resultCallback : BX.DoNothing;\n\n\t\tRuntime.loadExtension('ui.entity-selector').then((exports: EntitySelector) =>\n\t\t{\n\t\t\tconst config =\n\t\t\t\tthis.backgroundWorker.isUsed()\n\t\t\t\t\t? this.getDialogConfigForBackgroundApp(resultCallback)\n\t\t\t\t\t: this.getDefaultDialogConfig(resultCallback)\n\t\t\t;\n\t\t\tconst Dialog: Dialog = exports.Dialog;\n\t\t\tconst transferDialog = new Dialog(config);\n\n\t\t\ttransferDialog.show();\n\t\t});\n\t};\n\n\tgetDialogConfigForBackgroundApp(resultCallback)\n\t{\n\t\treturn {\n\t\t\ttargetNode: this.elements.buttons.transfer,\n\t\t\tmultiple: false,\n\t\t\tcacheable: false,\n\t\t\thideOnSelect: false,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tselectFields: ['personalPhone', 'personalMobile', 'workPhone']\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department'\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event) =>\n\t\t\t\t{\n\t\t\t\t\tevent.target.deselectAll();\n\n\t\t\t\t\tconst item = event.data.item;\n\n\t\t\t\t\tif (item.getEntityId() === 'user')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar customData = item.getCustomData();\n\t\t\t\t\t\tif (customData.get('personalPhone') || customData.get('personalMobile') || customData.get('workPhone'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tshowTransferToUserMenu({\n\t\t\t\t\t\t\t\tuserId: item.getId(),\n\t\t\t\t\t\t\t\tcustomData: Object.fromEntries(customData),\n\t\t\t\t\t\t\t\tdarkMode: this.darkMode,\n\t\t\t\t\t\t\t\tonSelect: (result: TransferTarget) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\t\t\t\tphoneNumber: this.phoneNumber,\n\t\t\t\t\t\t\t\t\t\ttarget: result.target\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\t\tphoneNumber: this.phoneNumber,\n\t\t\t\t\t\t\t\ttarget: item.getId()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetDefaultDialogConfig(resultCallback: (TransferTarget) => void)\n\t{\n\t\treturn {\n\t\t\ttargetNode: this.elements.buttons.transfer,\n\t\t\tmultiple: false,\n\t\t\tcacheable: false,\n\t\t\thideOnSelect: false,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tselectFields: ['personalPhone', 'personalMobile', 'workPhone']\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'voximplant_group'\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event) =>\n\t\t\t\t{\n\t\t\t\t\tevent.target.deselectAll();\n\n\t\t\t\t\tvar item = event.data.item;\n\n\t\t\t\t\tif (item.getEntityId() === 'user')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar customData = item.getCustomData();\n\t\t\t\t\t\tif (customData.get('personalPhone') || customData.get('personalMobile') || customData.get('workPhone'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tshowTransferToUserMenu({\n\t\t\t\t\t\t\t\tuserId: item.getId(),\n\t\t\t\t\t\t\t\tcustomData: Object.fromEntries(customData),\n\t\t\t\t\t\t\t\tdarkMode: this.darkMode,\n\t\t\t\t\t\t\t\tonSelect: (result: TransferTarget) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\t\t\tresultCallback(result)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\t\ttype: 'user',\n\t\t\t\t\t\t\t\ttarget: item.getId()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (item.getEntityId() === 'voximplant_group')\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\ttype: 'queue',\n\t\t\t\t\t\t\ttarget: item.getId()\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n}\n\nfunction renderSimpleButton(text, className, clickCallback)\n{\n\tlet params = {};\n\tif (Type.isStringFilled(text))\n\t{\n\t\tparams.text = text;\n\t}\n\n\tif (Type.isStringFilled(className))\n\t{\n\t\tparams.props = {className: className};\n\t}\n\n\tif (Type.isFunction(clickCallback))\n\t{\n\t\tparams.events = {click: clickCallback};\n\t}\n\n\treturn Dom.create('span', params);\n}\n\nfunction createStar(grade, active, onSelect)\n{\n\treturn Dom.create(\"div\", {\n\t\tprops: {className: 'im-phone-popup-rating-stars-item ' + (active ? 'im-phone-popup-rating-stars-item-active' : '')},\n\t\tdataset: {grade: grade},\n\t\tevents: {\n\t\t\tclick: (e) =>\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\tconst grade = e.currentTarget.dataset.grade;\n\t\t\t\tonSelect(grade);\n\t\t\t}\n\t\t}\n\t})\n}\n\ntype TransferOptions = {\n\tuserId: number,\n\tcustomData: Object,\n\tdarkMode: boolean,\n\tonSelect: (TransferTarget) => void,\n}\n\ntype TransferTarget = {\n\ttype: string,\n\ttarget: string,\n}\n\nfunction showTransferToUserMenu(options: TransferOptions = {})\n{\n\tconst userId = Type.isInteger(options.userId) ? options.userId : 0;\n\tconst userCustomData = Type.isPlainObject(options.customData) ? options.customData : {};\n\tconst darkMode = options.darkMode === true;\n\tconst onSelect = Type.isFunction(options.onSelect) ? options.onSelect : nop;\n\tlet popup;\n\n\tconst onMenuItemClick = (e) =>\n\t{\n\t\tconst type = e.currentTarget.dataset[\"type\"];\n\t\tconst target = e.currentTarget.dataset[\"target\"];\n\t\tonSelect({\n\t\t\ttype: type,\n\t\t\ttarget: target,\n\t\t});\n\t\tpopup.close();\n\t};\n\n\tlet menuItems = [\n\t\t{\n\t\t\ticon: 'bx-messenger-menu-call-voice',\n\t\t\ttext: Loc.getMessage('IM_PHONE_INNER_CALL'),\n\t\t\tdataset: {\n\t\t\t\ttype: 'user',\n\t\t\t\ttarget: userId\n\t\t\t},\n\t\t\tonclick: onMenuItemClick\n\t\t},\n\t\t{\n\t\t\tseparator: true\n\t\t},\n\t];\n\n\tif (userCustomData[\"personalMobile\"])\n\t{\n\t\tmenuItems.push({\n\t\t\ttype: \"call\",\n\t\t\ttext: Loc.getMessage(\"IM_PHONE_PERSONAL_MOBILE\"),\n\t\t\tphone: Text.encode(userCustomData[\"personalMobile\"]),\n\t\t\tdataset: {\n\t\t\t\ttype: 'pstn',\n\t\t\t\ttarget: userCustomData[\"personalMobile\"]\n\t\t\t},\n\t\t\tonclick: onMenuItemClick,\n\t\t});\n\t}\n\tif (userCustomData[\"personalPhone\"])\n\t{\n\t\tmenuItems.push({\n\t\t\ttype: \"call\",\n\t\t\ttext: Loc.getMessage(\"IM_PHONE_PERSONAL_PHONE\"),\n\t\t\tphone: Text.encode(userCustomData[\"personalPhone\"]),\n\t\t\tdataset: {\n\t\t\t\ttype: 'pstn',\n\t\t\t\ttarget: userCustomData[\"personalPhone\"]\n\t\t\t},\n\t\t\tonclick: onMenuItemClick,\n\t\t});\n\t}\n\tif (userCustomData[\"workPhone\"])\n\t{\n\t\tmenuItems.push({\n\t\t\ttype: \"call\",\n\t\t\ttext: Loc.getMessage(\"IM_PHONE_WORK_PHONE\"),\n\t\t\tphone: Text.encode(userCustomData[\"workPhone\"]),\n\t\t\tdataset: {\n\t\t\t\ttype: 'pstn',\n\t\t\t\ttarget: userCustomData[\"workPhone\"]\n\t\t\t},\n\t\t\tonclick: onMenuItemClick,\n\t\t});\n\t}\n\tconst popupContent = Dom.create(\"div\", {\n\t\tprops: {className: \"bx-messenger-popup-menu\"},\n\t\tchildren: [\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-popup-menu-items\"},\n\t\t\t\tchildren: BX.MessengerChat.MenuPrepareList(menuItems),\n\t\t\t}),\n\t\t],\n\t});\n\n\tpopup = new Popup({\n\t\tid: \"bx-messenger-phone-transfer-menu\",\n\t\tbindElement: null,\n\t\ttargetContainer: document.body,\n\t\tdarkMode: darkMode,\n\t\tlightShadow: true,\n\t\tautoHide: true,\n\t\tcloseByEsc: true,\n\t\tcacheable: false,\n\t\toverlay: {\n\t\t\tbackgroundColor: '#FFFFFF',\n\t\t\topacity: 0\n\t\t},\n\t\tcontent: popupContent,\n\t});\n\tpopup.show();\n}","import {Browser, Type, Text, Runtime, Loc} from 'main.core';\nimport {Keypad} from './view/keypad'\nimport {PhoneCallView, Direction, UiState, CallState, CallProgress} from './view/view'\nimport {BackgroundWorker} from './view/background-worker';\nimport {FoldedCallView} from './view/folded-view';\nimport {Popup} from 'main.popup';\n\nconst lsKeys = {\n\tcallInited: 'viInitedCall',\n\texternalCall: 'viExternalCard',\n\tvite: 'vite',\n\tdialHistory: 'vox-dial-history',\n\tfoldedView: 'vox-folded-call-card',\n}\n\ntype PhoneCallsControllerOptions = {\n\tphoneEnabled: boolean,\n\tuserId: number,\n\tisAdmin: boolean,\n\tcallCardRestApps: Array,\n\tcanInterceptCall: boolean,\n\trestApps: Array,\n\n\tdeviceActive: boolean,\n\tdeviceCall: boolean, //?\n\tdefaultLineId: string,\n\tavailableLines: Array\n}\n\nconst DeviceType = {\n\tWebrtc: 'WEBRTC',\n\tPhone: 'PHONE',\n}\n\nexport class PhoneCallsController\n{\n\tcallView: ?PhoneCallView\n\tkeypad: ?Keypad\n\tdefaultLineId: string\n\n\tisCallTransfer: boolean\n\n\tcurrentCall: ?VoxImplant.Call\n\tvoximplantClient: ?VoxImplant.Client\n\n\tcallId: string\n\tisCallHold: boolean\n\tisMuted: boolean\n\n\thasSipPhone: boolean\n\tdeviceType: ?string\n\t/** @see DeviceType */\n\n\thasExternalCall: boolean\n\n\tphoneTransferTargetId: number\n\tphoneTransferTargetType: string\n\tphoneTransferCallId: string\n\tphoneTransferEnabled: boolean\n\tphoneCrm: Object\n\n\tinitiator: boolean\n\tcallInitUserId: number\n\tcallActive: boolean\n\tcallUserId: number\n\tphoneNumber: string\n\n\tdebug: boolean\n\n\tconstructor(options: PhoneCallsControllerOptions)\n\t{\n\t\tthis.debug = false;\n\n\t\tthis.phoneEnabled = Type.isBoolean(options.phoneEnabled) ? options.phoneEnabled : false;\n\n\t\tthis.userId = options.userId;\n\t\tthis.isAdmin = options.isAdmin;\n\n\t\tconst history = BX.localStorage.get(lsKeys.dialHistory);\n\t\tthis.dialHistory = Type.isArray(history) ? history : [];\n\n\t\tthis.availableLines = Type.isArray(options.availableLines) ? options.availableLines : [];\n\t\tthis.defaultLineId = Type.isString(options.defaultLineId) ? options.defaultLineId : '';\n\t\tthis.callInterceptAllowed = options.canInterceptCall || false;\n\t\tthis.restApps = options.restApps;\n\n\t\tthis.hasSipPhone = options.deviceActive === true;\n\n\t\tthis.readDefaults();\n\t\tthis.restoreFoldedCallView();\n\n\t\tif (Browser.isLocalStorageSupported())\n\t\t{\n\t\t\tBX.addCustomEvent(window, \"onLocalStorageSet\", this.storageSet.bind(this));\n\t\t}\n\t\tBX.addCustomEvent(\"onPullEvent-voximplant\", this.onPullEvent.bind(this));\n\n\t\t// call event handlers\n\t\tthis.onCallConnectedHandler = this.onCallConnected.bind(this);\n\t\tthis.onCallDisconnectedHandler = this.onCallDisconnected.bind(this);\n\t\tthis.onCallFailedHandler = this.onCallFailed.bind(this);\n\t\tthis.onProgressToneStartHandler = this.onProgressToneStart.bind(this);\n\t\tthis.onProgressToneStopHandler = this.onProgressToneStop.bind(this);\n\n\t\t// to be sure, that background placement is initialized\n\t\tBackgroundWorker.getInstance();\n\n\t\t// to restore stored FoldedCallView if required\n\t\tFoldedCallView.getInstance();\n\n\t\tBX.garbage(() =>\n\t\t{\n\t\t\tif (this.callActive && this.callView && this.callView.canBeUnloaded() && (this.hasExternalCall || this.deviceType === 'PHONE'))\n\t\t\t{\n\t\t\t\tBX.localStorage.set(lsKeys.foldedView, {\n\t\t\t\t\tcallId: this.callId,\n\t\t\t\t\tphoneCrm: this.phoneCrm,\n\t\t\t\t\tdeviceType: this.deviceType,\n\t\t\t\t\thasExternalCall: this.hasExternalCall,\n\t\t\t\t\tcallView: this.callView.getState()\n\t\t\t\t}, 15);\n\t\t\t}\n\t\t})\n\t}\n\n\tget BXIM()\n\t{\n\t\treturn window.BXIM;\n\t}\n\n\tsetCallEventListeners(call: VoxImplant.Call)\n\t{\n\t\tcall.addEventListener(VoxImplant.CallEvents.Connected, this.onCallConnectedHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.Disconnected, this.onCallDisconnectedHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.Failed, this.onCallFailedHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.ProgressToneStart, this.onProgressToneStartHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.ProgressToneStop, this.onProgressToneStopHandler);\n\t}\n\n\tremoveCallEventListeners(call: VoximplantCall)\n\t{\n\t\tcall.removeEventListener(VoxImplant.CallEvents.Connected, this.onCallConnectedHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.Disconnected, this.onCallDisconnectedHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.Failed, this.onCallFailedHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.ProgressToneStart, this.onProgressToneStartHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.ProgressToneStop, this.onProgressToneStopHandler);\n\t}\n\n\tsetNotifyManager(notifyManager)\n\t{\n\t\tthis.notifyManager = notifyManager;\n\t}\n\n\tready()\n\t{\n\t\treturn true; // TODO ??\n\t}\n\n\treadDefaults()\n\t{\n\t\tif (!localStorage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.defaultMicrophone = localStorage.getItem('bx-im-settings-default-microphone');\n\t\tthis.defaultCamera = localStorage.getItem('bx-im-settings-default-camera');\n\t\tthis.defaultSpeaker = localStorage.getItem('bx-im-settings-default-speaker');\n\t\tthis.enableMicAutoParameters = (localStorage.getItem('bx-im-settings-enable-mic-auto-parameters') !== 'N');\n\t}\n\n\tonPullEvent(command, params)\n\t{\n\t\tconst handlers = {\n\t\t\t'invite': this.onPullInvite,\n\t\t\t'answer_self': this.onPullAnswerSelf,\n\t\t\t'timeout': this.onPullTimeout,\n\t\t\t'outgoing': this.onPullOutgoing,\n\t\t\t'start': this.onPullStart,\n\t\t\t'hold': this.onPullHold,\n\t\t\t'unhold': this.onPullUnhold,\n\t\t\t'update_crm': this.onPullUpdateCrm,\n\t\t\t'updatePortalUser': this.onPullUpdatePortalUser,\n\t\t\t'completeTransfer': this.onPullCompleteTransfer,\n\t\t\t'phoneDeviceActive': this.onPullPhoneDeviceActive,\n\t\t\t'changeDefaultLineId': this.onPullChangeDefaultLineId,\n\t\t\t'replaceCallerId': this.onPullReplaceCallerId,\n\t\t\t'showExternalCall': this.onPullShowExternalCall,\n\t\t\t'hideExternalCall': this.onPullHideExternalCall,\n\t\t}\n\n\t\tif (handlers.hasOwnProperty(command))\n\t\t{\n\t\t\thandlers[command].apply(this, [params]);\n\t\t}\n\t}\n\n\tonPullInvite(params)\n\t{\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.BXIM.callController && this.BXIM.callController.hasActiveCall())\n\t\t{\n\t\t\t// todo: set and proceed busy status in b_voximplant_queue\n\t\t\t/*this.phoneCommand('busy', {'CALL_ID' : params.callId});*/\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isCallListMode())\n\t\t{\n\t\t\tthis.phoneCommand('busy', {'CALL_ID': params.callId});\n\t\t\treturn false;\n\t\t}\n\n\t\tif (BX.localStorage.get(lsKeys.callInited) || BX.localStorage.get(lsKeys.externalCall))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.checkDesktop().then(() =>\n\t\t{\n\t\t\tif (params.CRM && params.CRM.FOUND)\n\t\t\t{\n\t\t\t\tthis.phoneCrm = params.CRM;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.phoneCrm = {};\n\t\t\t}\n\n\t\t\tthis.phonePortalCall = !!params.portalCall;\n\t\t\tif (this.phonePortalCall && params.portalCallData)\n\t\t\t{\n\t\t\t\tBX.MessengerCommon.updateUserData(params.portalCallData)\n\t\t\t\tconst userData = BX.MessengerCommon.getUser(params.portalCallUserId);\n\t\t\t\tif (userData)\n\t\t\t\t{\n\t\t\t\t\tparams.callerId = userData.name;\n\t\t\t\t}\n\n\t\t\t\tparams.phoneNumber = '';\n\t\t\t}\n\n\t\t\tthis.phoneCallConfig = params.config ? params.config : {};\n\t\t\tthis.phoneCallTime = 0;\n\n\t\t\tthis.BXIM.repeatSound('ringtone', 5000);\n\n\t\t\t// if (this.isPage())\n\t\t\t// {\n\t\t\t// \tBX.MessengerWindow.changeTab('im');\n\t\t\t// }\n\n\t\t\tthis.phoneCommand('wait', {'CALL_ID': params.callId, 'DEBUG_INFO': this.getDebugInfo()});\n\n\t\t\tthis.isCallTransfer = !!params.isTransfer;\n\n\t\t\tthis.displayIncomingCall({\n\t\t\t\tchatId: params.chatId,\n\t\t\t\tcallId: params.callId,\n\t\t\t\tcallerId: params.callerId,\n\t\t\t\tlineNumber: params.lineNumber,\n\t\t\t\tcompanyPhoneNumber: params.phoneNumber,\n\t\t\t\tisCallback: params.isCallback,\n\t\t\t\tshowCrmCard: params.showCrmCard,\n\t\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\tportalCall: params.portalCall,\n\t\t\t\tportalCallUserId: params.portalCallUserId,\n\t\t\t\tportalCallData: params.portalCallData,\n\t\t\t\tconfig: params.config\n\t\t\t});\n\t\t}).catch(() => {});\n\t}\n\n\tonPullAnswerSelf(params)\n\t{\n\t\tif (this.callSelfDisabled || this.callId != params.callId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.BXIM.stopRepeatSound('ringtone');\n\t\tthis.BXIM.stopRepeatSound('dialtone');\n\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\t\tthis.callView.close();\n\n\t\tthis.callId = params.callId;\n\t}\n\n\tonPullTimeout(params)\n\t{\n\t\tif (this.phoneTransferCallId === params.callId)\n\t\t{\n\t\t\treturn this.errorInviteTransfer(params.failedCode, params.failedReason);\n\t\t}\n\t\telse if (this.callId != params.callId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tBX.localStorage.remove(lsKeys.callInited);\n\n\t\tvar external = this.hasExternalCall;\n\n\t\tthis.BXIM.stopRepeatSound('ringtone');\n\t\tthis.BXIM.stopRepeatSound('dialtone');\n\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn\n\t\t}\n\n\t\tthis.callView.setCallState(CallState.idle, {failedCode: params.failedCode});\n\t\tif (external && params.failedCode == 486)\n\t\t{\n\t\t\tthis.callView.setProgress(CallProgress.offline);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_ERROR_BUSY_PHONE'));\n\t\t\tthis.callView.setUiState(UiState.sipPhoneError);\n\t\t}\n\t\telse if (external && params.failedCode == 480)\n\t\t{\n\t\t\tthis.callView.setProgress(CallProgress.error);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_ERROR_NA_PHONE'));\n\t\t\tthis.callView.setUiState(UiState.sipPhoneError);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.isCallListMode())\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText('');\n\t\t\t\tthis.callView.setUiState(UiState.outgoing);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_END'));\n\t\t\t\tthis.callView.setUiState(UiState.idle);\n\t\t\t\tthis.callView.autoClose();\n\t\t\t}\n\t\t}\n\t}\n\n\tonPullOutgoing(params)\n\t{\n\t\tif ((this.phoneNumber == params.phoneNumber || params.phoneNumber.indexOf(this.phoneNumber) >= 0))\n\t\t{\n\t\t\tthis.deviceType = params.callDevice == DeviceType.Phone ? DeviceType.Phone : DeviceType.Webrtc;\n\t\t\tthis.phonePortalCall = !!params.portalCall;\n\n\t\t\tthis.phoneNumber = params.phoneNumber;\n\n\t\t\tif (this.hasExternalCall && this.deviceType == DeviceType.Phone)\n\t\t\t{\n\t\t\t\tthis.callView.setProgress(CallProgress.connect);\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_WAIT_ANSWER'));\n\t\t\t}\n\n\t\t\tthis.phoneCallConfig = params.config ? params.config : {};\n\t\t\tthis.callId = params.callId;\n\t\t\tthis.phoneCallTime = 0;\n\t\t\tthis.phoneCrm = params.CRM;\n\t\t\tif (this.callView && params.showCrmCard)\n\t\t\t{\n\t\t\t\tthis.callView.setCrmData(params.CRM);\n\t\t\t\tthis.callView.setCrmEntity({\n\t\t\t\t\ttype: params.crmEntityType,\n\t\t\t\t\tid: params.crmEntityId,\n\t\t\t\t\tactivityId: params.crmActivityId,\n\t\t\t\t\tactivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\t\tbindings: params.crmBindings\n\t\t\t\t});\n\t\t\t\tthis.callView.setConfig(params.config);\n\t\t\t\tthis.callView.setCallId(params.callId);\n\t\t\t\tif (params.lineNumber)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setLineNumber(params.lineNumber);\n\t\t\t\t}\n\n\t\t\t\tif (params.lineName)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setCompanyPhoneNumber(params.lineName);\n\t\t\t\t}\n\n\t\t\t\tthis.callView.reloadCrmCard();\n\t\t\t}\n\n\t\t\tif (this.callView && this.phonePortalCall)\n\t\t\t{\n\t\t\t\tthis.callView.setPortalCall(true);\n\t\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t\t\tthis.callView.setPortalCallQueueName(params.portalCallQueueName);\n\t\t\t}\n\t\t}\n\t\telse if (!this.callActive && params.callDevice === DeviceType.Phone)\n\t\t{\n\t\t\tthis.checkDesktop().then(() =>\n\t\t\t{\n\t\t\t\tthis.deviceType = params.callDevice === DeviceType.Phone ? DeviceType.Phone : DeviceType.Webrtc;\n\t\t\t\tthis.phonePortalCall = !!params.portalCall;\n\t\t\t\tthis.callId = params.callId;\n\t\t\t\tthis.phoneCallTime = 0;\n\t\t\t\tthis.phoneCallConfig = params.config ? params.config : {};\n\t\t\t\tthis.phoneCrm = params.CRM;\n\n\t\t\t\tthis.phoneDisplayExternal({\n\t\t\t\t\tcallId: params.callId,\n\t\t\t\t\tconfig: params.config ? params.config : {},\n\t\t\t\t\tphoneNumber: params.phoneNumber,\n\t\t\t\t\tportalCall: params.portalCall,\n\t\t\t\t\tportalCallUserId: params.portalCallUserId,\n\t\t\t\t\tportalCallData: params.portalCallData,\n\t\t\t\t\tportalCallQueueName: params.portalCallQueueName,\n\t\t\t\t\tshowCrmCard: params.showCrmCard,\n\t\t\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\t\t\tcrmEntityId: params.crmEntityId\n\t\t\t\t});\n\t\t\t}).catch(() => {});\n\t\t}\n\t}\n\n\tonPullStart(params)\n\t{\n\t\tif (this.phoneTransferCallId === params.callId)\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER_CONNECTED'));\n\t\t\treturn;\n\t\t}\n\t\telse if (this.callId != params.callId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callOverlayTimer('start');\n\t\tthis.BXIM.stopRepeatSound('ringtone');\n\t\tif (this.callId == params.callId && this.deviceType == DeviceType.Phone && (this.deviceType == params.callDevice || this.phonePortalCall))\n\t\t{\n\t\t\tthis.onCallConnected();\n\t\t}\n\t\telse if (this.callId == params.callId && params.callDevice == DeviceType.Phone && this.phoneIncoming)\n\t\t{\n\t\t\tthis.deviceType = DeviceType.Phone;\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setDeviceCall(true);\n\t\t\t}\n\t\t\tthis.onCallConnected();\n\t\t}\n\t\tif (params.CRM)\n\t\t{\n\t\t\tthis.phoneCrm = params.CRM;\n\t\t}\n\n\t\tif (this.phoneNumber !== '')\n\t\t{\n\t\t\tthis.phoneNumberLast = this.phoneNumber;\n\t\t\tthis.BXIM.setLocalConfig('phone_last', this.phoneNumber);\n\t\t}\n\t}\n\n\tonPullHold(params)\n\t{\n\t\tif (this.callId == params.callId)\n\t\t{\n\t\t\tthis.isCallHold = true;\n\t\t}\n\t}\n\n\tonPullUnhold(params)\n\t{\n\t\tif (this.callId == params.callId)\n\t\t{\n\t\t\tthis.isCallHold = false;\n\t\t}\n\t}\n\n\tonPullUpdateCrm(params)\n\t{\n\t\tif (this.callId == params.callId && params.CRM && params.CRM.FOUND)\n\t\t{\n\t\t\tthis.phoneCrm = params.CRM;\n\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setCrmData(params.CRM);\n\t\t\t\tif (params.showCrmCard)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setCrmEntity({\n\t\t\t\t\t\ttype: params.crmEntityType,\n\t\t\t\t\t\tid: params.crmEntityId,\n\t\t\t\t\t\tactivityId: params.crmActivityId,\n\t\t\t\t\t\tactivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\t\t\tbindings: params.crmBindings\n\t\t\t\t\t});\n\t\t\t\t\tthis.callView.reloadCrmCard();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonPullUpdatePortalUser(params)\n\t{\n\t\tif (this.callId == params.callId && this.callView)\n\t\t{\n\t\t\tthis.callView.setPortalCall(true);\n\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t}\n\t}\n\n\tonPullCompleteTransfer(params)\n\t{\n\t\tif (this.callId != params.callId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.callId = params.newCallId;\n\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\n\t\tthis.deviceType = params.callDevice == DeviceType.Phone ? DeviceType.Phone : DeviceType.Webrtc;\n\t\tif (this.deviceType == DeviceType.Phone)\n\t\t{\n\t\t\tthis.callView.setDeviceCall(true);\n\t\t}\n\t\tthis.callView.setTransfer(false);\n\t\tthis.onCallConnected();\n\t}\n\n\tonPullPhoneDeviceActive(params)\n\t{\n\t\tthis.hasSipPhone = params.active == 'Y';\n\t}\n\n\tonPullChangeDefaultLineId(params)\n\t{\n\t\tthis.defaultLineId = params.defaultLineId;\n\t}\n\n\tonPullReplaceCallerId(params)\n\t{\n\t\tvar callTitle = Loc.getMessage('IM_PHONE_CALL_TRANSFER').replace('#PHONE#', params.callerId);\n\t\tthis.setCallOverlayTitle(callTitle);\n\t\tthis.callView.setPhoneNumber(params.callerId);\n\t\tif (params.CRM)\n\t\t{\n\t\t\tthis.phoneCrm = params.CRM;\n\t\t\tthis.callView.setCrmData(params.CRM);\n\t\t\tif (params.showCrmCard)\n\t\t\t{\n\t\t\t\tthis.callView.setCrmEntity({\n\t\t\t\t\ttype: params.crmEntityType,\n\t\t\t\t\tid: params.crmEntityId,\n\t\t\t\t\tactivityId: params.crmActivityId,\n\t\t\t\t\tactivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\t\tbindings: params.crmBindings\n\t\t\t\t});\n\t\t\t\tthis.callView.reloadCrmCard();\n\t\t\t}\n\t\t}\n\t}\n\n\tonPullShowExternalCall(params)\n\t{\n\t\tif (this.BXIM.callController && this.BXIM.callController.hasActiveCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (BX.localStorage.get(lsKeys.callInited) || BX.localStorage.get(lsKeys.externalCall))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.checkDesktop().then(() =>\n\t\t{\n\t\t\tif (params.CRM && params.CRM.FOUND)\n\t\t\t{\n\t\t\t\tthis.phoneCrm = params.CRM;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.phoneCrm = {};\n\t\t\t}\n\n\t\t\tthis.showExternalCall({\n\t\t\t\tcallId: params.callId,\n\t\t\t\tfromUserId: params.fromUserId,\n\t\t\t\ttoUserId: params.toUserId,\n\t\t\t\tisCallback: params.isCallback,\n\t\t\t\tphoneNumber: params.phoneNumber,\n\t\t\t\tlineNumber: params.lineNumber,\n\t\t\t\tcompanyPhoneNumber: params.companyPhoneNumber,\n\t\t\t\tshowCrmCard: params.showCrmCard,\n\t\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\t\tcrmBindings: params.crmBindings,\n\t\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\tconfig: params.config,\n\t\t\t\tportalCall: params.portalCall,\n\t\t\t\tportalCallData: params.portalCallData,\n\t\t\t\tportalCallUserId: params.portalCallUserId\n\t\t\t});\n\t\t}).catch(() => {});\n\t}\n\n\tonPullHideExternalCall(params)\n\t{\n\t\tif (this.callActive && this.hasExternalCall && this.callId == params.callId)\n\t\t{\n\t\t\tthis.hideExternalCall();\n\t\t}\n\t}\n\n\tphoneCommand(command, params, async, successCallback)\n\t{\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\tparams = typeof (params) == 'object' ? params : {};\n\n\t\ttry\n\t\t{\n\t\t\tparams = JSON.stringify(params);\n\t\t} catch (e)\n\t\t{\n\t\t\tconsole.error(\"Could not convert params to JSON, error: \", e);\n\t\t\treturn;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tBX.ajax({\n\t\t\t\turl: this.BXIM.pathToCallAjax + '?PHONE_SHARED&V=' + this.BXIM.revision,\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\ttimeout: 30,\n\t\t\t\tasync: async,\n\t\t\t\tdata: {\n\t\t\t\t\t'IM_PHONE': 'Y',\n\t\t\t\t\t'COMMAND': command,\n\t\t\t\t\t'PARAMS': params,\n\t\t\t\t\t'IM_AJAX_CALL': 'Y',\n\t\t\t\t\t'sessid': BX.bitrix_sessid()\n\t\t\t\t},\n\t\t\t\tonsuccess: function (response)\n\t\t\t\t{\n\t\t\t\t\tresolve(response);\n\t\t\t\t\tif (Type.isFunction(successCallback))\n\t\t\t\t\t{\n\t\t\t\t\t\tsuccessCallback(response)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t})\n\t}\n\n\tcorrectPhoneNumber(number)\n\t{\n\t\treturn number.toString().replace(/[^0-9+#*;,]/g, '');\n\t}\n\n\tonIncomingCall(params)\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.currentCall = params.call;\n\t\tthis.setCallEventListeners(this.currentCall);\n\t\tthis.currentCall.answer();\n\t}\n\n\tgetCallParams()\n\t{\n\t\tlet result = Type.isPlainObject(this.phoneParams) ? Runtime.clone(this.phoneParams) : {};\n\t\tif (this.phoneFullNumber != this.phoneNumber)\n\t\t{\n\t\t\tresult['FULL_NUMBER'] = this.phoneFullNumber;\n\t\t}\n\t\treturn JSON.stringify(result);\n\t}\n\n\tstartCall()\n\t{\n\t\tthis.phoneParams['CALLER_ID'] = '';\n\t\tthis.phoneParams['USER_ID'] = this.userId;\n\t\tthis.phoneLog('Call params: ', this.phoneNumber, this.phoneParams);\n\t\tif (!this.voximplantClient.connected())\n\t\t{\n\t\t\tthis.phoneOnSDKReady();\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.currentCall = this.voximplantClient.call(this.phoneNumber, false, this.getCallParams());\n\t\tthis.setCallEventListeners(this.currentCall);\n\n\t\tconst initParams = {\n\t\t\t'NUMBER': this.phoneNumber,\n\t\t\t'NUMBER_USER': Text.decode(this.phoneNumberUser),\n\t\t\t'IM_AJAX_CALL': 'Y',\n\t\t}\n\t\tthis.phoneCommand('init', initParams).then((data) =>\n\t\t{\n\t\t\tif (!(data.HR_PHOTO.length === 0))\n\t\t\t{\n\t\t\t\tfor (var i in data.HR_PHOTO)\n\t\t\t\t{\n\t\t\t\t\t// this.BXIM.messenger.hrphoto[i] = data.HR_PHOTO[i];\n\t\t\t\t}\n\n\t\t\t\tthis.callOverlayUserId = data.DIALOG_ID;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callOverlayChatId = data.DIALOG_ID.substr(4);\n\t\t\t}\n\t\t})\n\t}\n\n\tphoneCallFinish()\n\t{\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tclearInterval(this.phoneCallTimeInterval);\n\t\tBX.localStorage.remove(lsKeys.callInited);\n\n\t\tthis.callOverlayTimer('pause');\n\n\t\t// this.BXIM.desktop.closeTopmostWindow();\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.currentCall.hangup({\n\t\t\t\t\t\"X-Disconnect-Code\": 200,\n\t\t\t\t\t\"X-Disconnect-Reason\": \"Normal hangup\"\n\t\t\t\t});\n\t\t\t} catch (e)\n\t\t\t{}\n\t\t\tthis.removeCallEventListeners(this.currentCall);\n\t\t\tthis.currentCall = null;\n\t\t\tthis.phoneLog('Call hangup call');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleApiDisconnect();\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\n\t\tthis.phoneRinging = 0;\n\t\tthis.phoneIncoming = false;\n\t\tthis.callActive = false;\n\t\tthis.callId = '';\n\t\tthis.hasExternalCall = false;\n\t\tthis.deviceType = DeviceType.Webrtc;\n\t\t//this.phonePortalCall = false;\n\t\tthis.phoneNumber = '';\n\t\tthis.phoneNumberUser = '';\n\t\tthis.phoneParams = {};\n\t\tthis.callOverlayOptions = {};\n\t\tthis.callSelfDisabled = false;\n\t\t//this.phoneCrm = {};\n\t\tthis.isMuted = false;\n\t\tthis.isCallHold = false;\n\t\tthis.isCallTransfer = false;\n\t\tthis.phoneMicAccess = false;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t}\n\n\tphoneOnAuthResult()\n\t{\n\t\tif (this.deviceType == DeviceType.Phone)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.phoneIncoming)\n\t\t{\n\t\t\tthis.phoneCommand('ready', {'CALL_ID': this.callId});\n\t\t}\n\t\telse if (this.callInitUserId == this.userId)\n\t\t{\n\t\t\tthis.startCall();\n\t\t}\n\t}\n\n\tonCallFailed(e)\n\t{\n\t\tconst headers = e.headers || {};\n\t\tthis.phoneLog('Call failed', e.code, e.reason);\n\n\t\tvar reason = Loc.getMessage('IM_PHONE_END');\n\t\tif (e.code == 603)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_DECLINE');\n\t\t}\n\t\telse if (e.code == 380)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_SIP_LICENSE');\n\t\t}\n\t\telse if (e.code == 436)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_NEED_RENT');\n\t\t}\n\t\telse if (e.code == 438)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_BLOCK_RENT');\n\t\t}\n\t\telse if (e.code == 400)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_LICENSE');\n\t\t}\n\t\telse if (e.code == 401)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_401');\n\t\t}\n\t\telse if (e.code == 480 || e.code == 503)\n\t\t{\n\t\t\tif (this.phoneNumber == 911 || this.phoneNumber == 112)\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_NO_EMERGENCY');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_UNAVAILABLE');\n\t\t\t}\n\t\t}\n\t\telse if (e.code == 484 || e.code == 404)\n\t\t{\n\t\t\tif (this.phoneNumber == 911 || this.phoneNumber == 112)\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_NO_EMERGENCY');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_INCOMPLETED');\n\t\t\t}\n\t\t}\n\t\telse if (e.code == 402)\n\t\t{\n\t\t\tif (headers.hasOwnProperty('X-Reason') && headers['X-Reason'] === \"SIP_PAYMENT_REQUIRED\")\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_ERR_SIP_LICENSE');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_NO_MONEY') + (this.isAdmin ? ' ' + Loc.getMessage('IM_PHONE_PAY_URL_NEW') : '');\n\t\t\t}\n\t\t}\n\t\telse if (e.code == 486 && this.phoneRinging > 1)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_M_CALL_ST_DECLINE');\n\t\t}\n\t\telse if (e.code == 486)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERROR_BUSY');\n\t\t}\n\t\telse if (e.code == 403)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_403');\n\t\t\tthis.phoneServer = '';\n\t\t\tthis.phoneLogin = '';\n\t\t\tthis.phoneCheckBalance = true;\n\t\t}\n\t\telse if (e.code == 504)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERROR_CONNECT');\n\t\t}\n\t\telse\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERROR');\n\t\t}\n\n\t\tif (e.code == 408 || e.code == 403)\n\t\t{\n\t\t\tthis.scheduleApiDisconnect();\n\t\t}\n\t\tthis.callOverlayProgress('offline');\n\t\tthis.callAbort(reason);\n\n\t\tthis.callView.setUiState(UiState.error);\n\t\tthis.callView.setCallState(CallState.idle);\n\t}\n\n\tscheduleApiDisconnect()\n\t{\n\t\tif (this.voximplantClient && this.voximplantClient.connected())\n\t\t{\n\t\t\tsetTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.voximplantClient && this.voximplantClient.connected())\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantClient.disconnect();\n\t\t\t\t}\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\tonCallDisconnected(e)\n\t{\n\t\tthis.phoneLog('Call disconnected', this.currentCall ? this.currentCall.id() : '-', this.currentCall ? this.currentCall.state() : '-');\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.phoneCallFinish();\n\t\t\tthis.callOverlayDeleteEvents();\n\t\t\tthis.callOverlayStatus(Loc.getMessage('IM_M_CALL_ST_END'));\n\n\t\t\tthis.BXIM.playSound('stop');\n\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\tif (this.isCallListMode())\n\t\t\t{\n\t\t\t\tthis.callView.setUiState(UiState.outgoing);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_END'));\n\t\t\t\tthis.callView.setUiState(UiState.idle);\n\t\t\t\tthis.callView.autoClose();\n\t\t\t}\n\t\t}\n\n\t\tthis.scheduleApiDisconnect();\n\t}\n\n\tonProgressToneStart(e)\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.phoneLog('Progress tone start', this.currentCall.id());\n\t\tthis.phoneRinging++;\n\t\tthis.callOverlayStatus(Loc.getMessage('IM_PHONE_WAIT_ANSWER'));\n\t}\n\n\tonProgressToneStop(e)\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tthis.phoneLog('Progress tone stop', this.currentCall.id());\n\t}\n\n\tonConnectionEstablished(e)\n\t{\n\t\tthis.phoneLog('Connection established', this.voximplantClient.connected());\n\t}\n\n\tonConnectionFailed(e)\n\t{\n\t\tthis.phoneLog('Connection failed');\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort(Loc.getMessage('IM_M_CALL_ERR'));\n\t}\n\n\tonConnectionClosed(e)\n\t{\n\t\tthis.phoneLog('Connection closed');\n\t}\n\n\tonMicResult(e)\n\t{\n\t\tthis.phoneMicAccess = e.result;\n\t\tthis.phoneLog('Mic Access Allowed', e.result);\n\n\t\tif (e.result)\n\t\t{\n\t\t\tthis.callOverlayProgress('connect');\n\t\t\tthis.callOverlayStatus(Loc.getMessage('IM_M_CALL_ST_CONNECT'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.phoneCallFinish();\n\t\t\tthis.callOverlayProgress('offline');\n\t\t\tthis.callAbort(Loc.getMessage('IM_M_CALL_ST_NO_ACCESS'));\n\n\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t}\n\t}\n\n\tonNetStatsReceived(e)\n\t{\n\t\tif (!this.currentCall || this.currentCall.state() != \"CONNECTED\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst percent = (100 - parseInt(e.stats.packetLoss));\n\t\tconst grade = this.displayCallQuality(percent);\n\n\t\tthis.currentCall.sendMessage(JSON.stringify({\n\t\t\t'COMMAND': 'meter',\n\t\t\t'PACKETLOSS': e.stats.packetLoss,\n\t\t\t'PERCENT': percent,\n\t\t\t'GRADE': grade\n\t\t}));\n\t}\n\n\tholdCall()\n\t{\n\t\tthis.toggleCallHold(true);\n\t}\n\n\tunholdCall()\n\t{\n\t\tthis.toggleCallHold(false);\n\t}\n\n\ttoggleCallHold(state)\n\t{\n\t\tif (!this.currentCall && this.deviceType == DeviceType.Webrtc)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof (state) != 'undefined')\n\t\t{\n\t\t\tthis.isCallHold = !state;\n\t\t}\n\n\t\tif (this.isCallHold)\n\t\t{\n\t\t\tif (this.deviceType === DeviceType.Webrtc)\n\t\t\t{\n\t\t\t\tthis.currentCall.sendMessage(JSON.stringify({'COMMAND': 'unhold'}));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.phoneCommand('unhold', {'CALL_ID': this.callId});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.deviceType === DeviceType.Webrtc)\n\t\t\t{\n\t\t\t\tthis.currentCall.sendMessage(JSON.stringify({'COMMAND': 'hold'}));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.phoneCommand('hold', {'CALL_ID': this.callId});\n\t\t\t}\n\t\t}\n\t\tthis.isCallHold = !this.isCallHold;\n\t}\n\n\tsendDTMF(key)\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.phoneLog('Send DTMF code', this.currentCall.id(), key);\n\n\t\tthis.currentCall.sendTone(key);\n\t}\n\n\tstartCallViaRestApp(number, lineId, params)\n\t{\n\t\tBX.rest.callMethod(\n\t\t\t'voximplant.call.startViaRest',\n\t\t\t{\n\t\t\t\t'NUMBER': number,\n\t\t\t\t'LINE_ID': lineId,\n\t\t\t\t'PARAMS': params,\n\t\t\t\t'SHOW': 'Y'\n\t\t\t}\n\t\t);\n\t}\n\n\tphoneSupport()\n\t{\n\t\treturn this.phoneEnabled && (this.hasSipPhone || this.ready());\n\t}\n\n\tmuteCall()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isMuted = true;\n\t\tthis.currentCall.muteMicrophone();\n\t}\n\n\tunmuteCall()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isMuted = false;\n\t\tthis.currentCall.unmuteMicrophone();\n\t}\n\n\ttoggleCallAudio()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isMuted)\n\t\t{\n\t\t\tthis.currentCall.unmuteMicrophone();\n\t\t\tthis.callView.setMuted(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.currentCall.muteMicrophone();\n\t\t}\n\t\tthis.isMuted = !this.isMuted;\n\t}\n\n\tphoneDeviceCall(status)\n\t{\n\t\tlet result = true;\n\t\tif (typeof (status) == 'boolean')\n\t\t{\n\t\t\tthis.BXIM.setLocalConfig('viDeviceCallBlock', !status);\n\t\t\tBX.localStorage.set('viDeviceCallBlock', !status, 86400);\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setDeviceCall(status);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar deviceCallBlock = this.BXIM.getLocalConfig('viDeviceCallBlock');\n\t\t\tif (!deviceCallBlock)\n\t\t\t{\n\t\t\t\tdeviceCallBlock = BX.localStorage.get('viDeviceCallBlock');\n\t\t\t}\n\t\t\tresult = this.hasSipPhone && deviceCallBlock != true;\n\t\t}\n\t\treturn result;\n\n\t}\n\n\topenKeyPad(e = {})\n\t{\n\t\tif (Loc.getMessage[\"voximplantCanMakeCalls\"] == \"N\")\n\t\t{\n\t\t\tRuntime.loadExtension(\"voximplant.common\").then(() => BX.Voximplant.openLimitSlider());\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loadPhoneLines().then(() => this._doOpenKeyPad(e));\n\t}\n\n\t_doOpenKeyPad(e)\n\t{\n\t\tif (!this.phoneSupport() && !(this.BXIM.desktopStatus && this.BXIM.desktopVersion >= 18) && !this.isRestLine(this.defaultLineId))\n\t\t{\n\t\t\tthis.showUnsupported();\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callActive || this.currentCall || BX.localStorage.get(lsKeys.callInited) || BX.localStorage.get(lsKeys.externalCall))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.keypad = new Keypad({\n\t\t\tbindElement: e.bindElement,\n\t\t\toffsetTop: e.offsetTop,\n\t\t\toffsetLeft: e.offsetLeft,\n\t\t\tanglePosition: e.anglePosition,\n\t\t\tangleOffset: e.angleOffset,\n\t\t\tdefaultLineId: this.defaultLineId,\n\t\t\tlines: this.phoneLines,\n\t\t\tavailableLines: this.availableLines,\n\t\t\thistory: this.dialHistory,\n\t\t\tcallInterceptAllowed: this.callInterceptAllowed,\n\n\t\t\tonDial: this.onKeyPadDial.bind(this),\n\t\t\tonIntercept: this.onKeyPadIntercept.bind(this),\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.onKeyPadClose();\n\t\t\t\tif (Type.isFunction(e.onClose))\n\t\t\t\t{\n\t\t\t\t\te.onClose()\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.keypad.show();\n\t}\n\n\tonKeyPadDial(e)\n\t{\n\t\tlet params = {};\n\t\tthis.closeKeyPad()\n\n\t\tif (e.lineId)\n\t\t{\n\t\t\tparams['LINE_ID'] = e.lineId;\n\t\t}\n\n\t\tthis.phoneCall(e.phoneNumber, params);\n\t}\n\n\tonKeyPadIntercept(e)\n\t{\n\t\tif (!this.callInterceptAllowed)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t\tif ('UI' in BX && 'InfoHelper' in BX.UI)\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show('limit_contact_center_telephony_intercept');\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis.phoneCommand('interceptCall', {}, true, (response) =>\n\t\t{\n\t\t\tif (!response.FOUND || response.FOUND == 'Y')\n\t\t\t{\n\t\t\t\tthis.keypad.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (response.ERROR)\n\t\t\t\t{\n\t\t\t\t\tthis.interceptErrorPopup = new Popup({\n\t\t\t\t\t\tid: 'intercept-call-error',\n\t\t\t\t\t\tbindElement: e.interceptButton,\n\t\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\t\tcontent: Text.encode(response.ERROR),\n\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\t\tposition: 'bottom'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tangle: {\n\t\t\t\t\t\t\toffset: 40\n\t\t\t\t\t\t},\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonPopupClose: (e) => this.interceptErrorPopup = null,\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.interceptErrorPopup.show();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tonKeyPadClose()\n\t{\n\t\tthis.keypad = null;\n\t}\n\n\tcloseKeyPad()\n\t{\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\t}\n\n\tphoneDisplayExternal(params)\n\t{\n\t\tvar number = params.phoneNumber;\n\t\tthis.phoneLog(number, params);\n\n\t\tthis.phoneNumberUser = Text.encode(number);\n\n\t\tnumber = this.correctPhoneNumber(number);\n\t\tif (typeof (params) != 'object')\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (this.callActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = this.userId;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.phoneNumber = number;\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcallId: params.callId,\n\t\t\tconfig: params.config,\n\t\t\tdirection: Direction.outgoing,\n\t\t\tphoneNumber: this.phoneNumber,\n\t\t\tstatusText: Loc.getMessage('IM_M_CALL_ST_CONNECT'),\n\t\t\thasSipPhone: true,\n\t\t\tdeviceCall: true,\n\t\t\tportalCall: params.portalCall,\n\t\t\tportalCallUserId: params.portalCallUserId,\n\t\t\tportalCallData: params.portalCallData,\n\t\t\tportalCallQueueName: params.portalCallQueueName,\n\t\t\tcrm: params.showCrmCard,\n\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.setUiState(UiState.idle);\n\t\tthis.callView.setCallState(CallState.connected);\n\t\tthis.callView.show();\n\t}\n\n\tloadPhoneLines()\n\t{\n\t\tconst cachedLines = BX.localStorage.get('bx-im-phone-lines');\n\t\tif (cachedLines)\n\t\t{\n\t\t\tthis.phoneLines = cachedLines;\n\t\t\treturn Promise.resolve(cachedLines);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (this.phoneLines)\n\t\t\t{\n\t\t\t\treturn resolve(this.phoneLines);\n\t\t\t}\n\n\t\t\tBX.ajax.runAction(\"voximplant.callView.getLines\").then((response) =>\n\t\t\t{\n\t\t\t\tthis.phoneLines = response.data;\n\t\t\t\tBX.localStorage.set('bx-im-phone-lines', this.phoneLines, 86400);\n\t\t\t\t{\n\t\t\t\t\tresolve(this.phoneLines);\n\t\t\t\t}\n\t\t\t}).catch((err) =>\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t\treject(err)\n\t\t\t})\n\t\t})\n\t}\n\n\tisRestLine(lineId)\n\t{\n\t\tif (!this.phoneLines)\n\t\t{\n\t\t\tthrow new Error(\"Phone lines are not loaded. Call PhoneCallsController.loadPhoneLines prior to using this method\")\n\t\t}\n\n\t\tif (this.phoneLines.hasOwnProperty(lineId))\n\t\t{\n\t\t\treturn this.phoneLines[lineId].TYPE === 'REST';\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tsetPhoneNumber(phoneNumber)\n\t{\n\t\tconst matches = /(\\+?\\d+)([;#]*)([\\d,]*)/.exec(phoneNumber);\n\t\tthis.phoneFullNumber = phoneNumber;\n\t\tif (matches)\n\t\t{\n\t\t\tthis.phoneNumber = matches[1];\n\t\t}\n\t}\n\n\tphoneCall(number, params)\n\t{\n\t\tthis.loadPhoneLines().then(() => this._doPhoneCall(number, params));\n\t}\n\n\t_doPhoneCall(number, params = {})\n\t{\n\t\tif (BX.localStorage.get(lsKeys.callInited) || this.callView || this.callActive)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\tthis.showUnsupported();\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tif (Type.isStringFilled(number))\n\t\t{\n\t\t\tthis.addToHistory(number);\n\t\t}\n\n\t\tconst lineId = Type.isStringFilled(params['LINE_ID']) ? params['LINE_ID'] : this.defaultLineId;\n\t\tif (this.isRestLine(lineId))\n\t\t{\n\t\t\tthis.startCallViaRestApp(number, lineId, params);\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.phoneLog(number, params);\n\n\t\tthis.phoneNumberUser = Text.encode(number);\n\t\tlet numberOriginal = number;\n\n\t\tif (typeof (params) != 'object')\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tconst internationalNumber = this.correctPhoneNumber(number);\n\n\t\tif (internationalNumber.length <= 0)\n\t\t{\n\t\t\tthis.BXIM.openConfirm({\n\t\t\t\ttitle: Loc.getMessage('IM_PHONE_WRONG_NUMBER'),\n\t\t\t\tmessage: Loc.getMessage('IM_PHONE_WRONG_NUMBER_DESC')\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.setPhoneNumber(internationalNumber);\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = this.userId;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.hasExternalCall = this.phoneDeviceCall();\n\t\tthis.phoneParams = params;\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tdarkMode: BX.MessengerTheme.isDark(),\n\n\t\t\tphoneNumber: this.phoneFullNumber,\n\t\t\tcallTitle: this.phoneNumberUser,\n\t\t\tfromUserId: this.userId,\n\t\t\tdirection: Direction.outgoing,\n\t\t\tuiState: UiState.connectingOutgoing,\n\t\t\tstatus: Loc.getMessage('IM_M_CALL_ST_CONNECT'),\n\t\t\thasSipPhone: this.hasSipPhone,\n\t\t\tdeviceCall: this.hasExternalCall,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tautoFold: (params['AUTO_FOLD'] === true),\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.show();\n\n\t\tthis.BXIM.playSound(\"start\");\n\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tthis.deviceType = DeviceType.Phone;\n\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_NOTICE'));\n\n\t\t\tthis.phoneCommand(\n\t\t\t\t'deviceStartCall',\n\t\t\t\t{\n\t\t\t\t\t'NUMBER': numberOriginal.toString().replace(/[^0-9+*#,;]/g, ''),\n\t\t\t\t\t'PARAMS': params\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tif (response.ERROR)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.setProgress(CallProgress.error);\n\t\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_ERROR'));\n\t\t\t\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\t\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callId = response.CALL_ID;\n\t\t\t\t\t\tthis.hasExternalCall = (response.EXTERNAL === true);\n\t\t\t\t\t\tthis.phoneCallConfig = response.CONFIG;\n\t\t\t\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_WAIT_PHONE'));\n\t\t\t\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\t\t\t\tthis.callView.setCallState(CallState.connecting);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (BX.MessengerCommon.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\t//todo\n\t\t\t\t\t\tBX.desktop.changeTab('im');\n\t\t\t\t\t\tBX.desktop.windowCommand(\"show\");\n\t\t\t\t\t\tthis.BXIM.desktop.closeTopmostWindow();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_CALL_INIT'));\n\n\t\t\tthis.phoneApiInit().then(() => this.phoneOnSDKReady());\n\t\t}\n\t}\n\n\tshowUnsupported()\n\t{\n\t\tthis.BXIM.openConfirm(Loc.getMessage('IM_CALL_NO_WEBRT'), [\n\t\t\tnew BX.PopupWindowButton({\n\t\t\t\ttext: Loc.getMessage('IM_M_CALL_BTN_DOWNLOAD'),\n\t\t\t\tclassName: \"popup-window-button-accept\",\n\t\t\t\tevents: {\n\t\t\t\t\tclick: BX.delegate(function ()\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.open(BX.browser.IsMac() ? \"http://dl.bitrix24.com/b24/bitrix24_desktop.dmg\" : \"http://dl.bitrix24.com/b24/bitrix24_desktop.exe\", \"desktopApp\");\n\t\t\t\t\t\tBX.proxy_context.popupWindow.close();\n\t\t\t\t\t}, this)\n\t\t\t\t}\n\t\t\t}),\n\t\t\tnew BX.PopupWindowButton({\n\t\t\t\ttext: Loc.getMessage('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\t\tclassName: \"popup-window-button\",\n\t\t\t\tevents: {click: function () { this.popupWindow.close(); }}\n\t\t\t})\n\t\t]);\n\t}\n\n\taddToHistory(phoneNumber: string)\n\t{\n\t\tlet oldHistory = this.dialHistory;\n\t\tconst phoneIndex = oldHistory.indexOf(phoneNumber);\n\n\t\tif (phoneIndex === 0)\n\t\t{\n\t\t\t//it's the first element already, nothing to do\n\t\t}\n\t\telse if (phoneIndex > 0)\n\t\t{\n\t\t\t//moving number to the top\n\t\t\toldHistory.splice(phoneIndex, phoneIndex);\n\t\t\tthis.dialHistory = [phoneNumber].concat(oldHistory);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//adding as the top element of history\n\t\t\tthis.dialHistory = [phoneNumber].concat(oldHistory.slice(0, 4));\n\t\t}\n\n\t\tBX.localStorage.set(lsKeys.dialHistory, this.dialHistory, 31536000)\n\t\tthis.BXIM.setLocalConfig('phone-history', this.dialHistory);\n\t}\n\n\tstartCallList(callListId, params)\n\t{\n\t\tcallListId = Number(callListId);\n\t\tif (callListId === 0 || this.currentCall || this.callView || this.isCallListMode())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.callListId = callListId;\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcrm: true,\n\t\t\tcallListId: callListId,\n\t\t\tcallListStatusId: params.callListStatusId,\n\t\t\tcallListItemIndex: params.callListItemIndex,\n\t\t\tdirection: Direction.outgoing,\n\t\t\tmakeCall: (params.makeCall === true),\n\t\t\tuiState: UiState.outgoing,\n\t\t\tBXIM: this.BXIM,\n\t\t\twebformId: params.webformId || 0,\n\t\t\twebformSecCode: params.webformSecCode || '',\n\t\t\thasSipPhone: this.hasSipPhone,\n\t\t\tdeviceCall: this.phoneDeviceCall(),\n\t\t\tcrmData: this.phoneCrm,\n\t\t\trestApps: this.restApps,\n\t\t});\n\n\t\tthis.bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.show();\n\n\t\treturn true;\n\t}\n\n\tisCallListMode()\n\t{\n\t\treturn (this.callListId > 0);\n\t}\n\n\tcallListMakeCall(e)\n\t{\n\t\tconsole.log('callListMakeCall', e)\n\t\tthis.loadPhoneLines().then(() => this._doCallListMakeCall(e));\n\t}\n\n\t_doCallListMakeCall(e)\n\t{\n\t\tif (this.isRestLine(this.defaultLineId))\n\t\t{\n\t\t\tthis.startCallViaRestApp(\n\t\t\t\te.phoneNumber,\n\t\t\t\tthis.defaultLineId,\n\t\t\t\t{\n\t\t\t\t\t'ENTITY_TYPE': 'CRM_' + e.crmEntityType,\n\t\t\t\t\t'ENTITY_ID': e.crmEntityId,\n\t\t\t\t\t'CALL_LIST_ID': e.callListId\n\t\t\t\t}\n\t\t\t);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (BX.localStorage.get(lsKeys.callInited))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callActive)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.lastCallListCallParams = e;\n\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_CALL_NO_WEBRT'));\n\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst number = e.phoneNumber;\n\t\tconst numberOriginal = number;\n\t\tconst internationalNumber = this.correctPhoneNumber(number);\n\n\t\tif (internationalNumber.length <= 0)\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_WRONG_NUMBER_DESC').replace(\"<br/>\", \"\\n\"));\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = this.userId;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.hasExternalCall = this.phoneDeviceCall();\n\t\tthis.setPhoneNumber(internationalNumber);\n\t\tthis.phoneParams = {\n\t\t\t'ENTITY_TYPE': 'CRM_' + e.crmEntityType,\n\t\t\t'ENTITY_ID': e.crmEntityId,\n\t\t\t'CALL_LIST_ID': e.callListId\n\t\t};\n\n\t\tthis.BXIM.playSound(\"start\");\n\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tthis.deviceType = DeviceType.Phone;\n\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_NOTICE'));\n\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\tthis.callView.setCallState(CallState.connecting);\n\t\t\tthis.phoneCommand(\n\t\t\t\t'deviceStartCall',\n\t\t\t\t{\n\t\t\t\t\t'NUMBER': numberOriginal.toString().replace(/[^0-9+*#,;]/g, ''),\n\t\t\t\t\t'PARAMS': this.phoneParams\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t(response) =>\n\t\t\t\t{\n\t\t\t\t\tif (response.ERROR)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.setProgress(CallProgress.error);\n\t\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_ERROR'));\n\t\t\t\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\t\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callId = response.CALL_ID;\n\n\t\t\t\t\t\t// TODO: is this necessary? It did not work previously\n\t\t\t\t\t\tthis.hasExternalCall = (response.EXTERNAL === true);\n\t\t\t\t\t\tthis.phoneCallConfig = response.CONFIG;\n\n\t\t\t\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_WAIT_PHONE'));\n\t\t\t\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\t\t\t\tthis.callView.setCallState(CallState.connecting);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (BX.MessengerCommon.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\t//todo\n\t\t\t\t\t\tBX.desktop.changeTab('im');\n\t\t\t\t\t\tBX.desktop.windowCommand(\"show\");\n\t\t\t\t\t\tthis.BXIM.desktop.closeTopmostWindow();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_CALL_INIT'));\n\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\tthis.callView.setCallState(CallState.connecting);\n\t\t\tthis.phoneApiInit().then(() => this.phoneOnSDKReady());\n\t\t}\n\t}\n\n\tphoneIncomingAnswer()\n\t{\n\t\tthis.BXIM.stopRepeatSound('ringtone');\n\t\tthis.callSelfDisabled = true;\n\t\tthis.phoneCommand('answer', {'CALL_ID': this.callId});\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tthis.callView.setUiState(UiState.connectingIncoming);\n\t\tthis.callView.setCallState(CallState.connecting);\n\n\t\tthis.phoneApiInit().then(\n\t\t\t() => this.phoneCommand('ready', {'CALL_ID': this.callId})\n\t\t);\n\t}\n\n\tphoneApiInit()\n\t{\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\treturn Promise.reject('Telephony is not supported');\n\t\t}\n\n\t\tif (this.voximplantClient && this.voximplantClient.connected())\n\t\t{\n\t\t\tif (this.defaultMicrophone)\n\t\t\t{\n\t\t\t\tthis.voximplantClient.useAudioSource(this.defaultMicrophone);\n\t\t\t}\n\t\t\tif (this.defaultSpeaker)\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setDefaultAudioSettings({\n\t\t\t\t\toutputId: this.defaultSpeaker\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tlet phoneApiParameters = {\n\t\t\tuseRTCOnly: true,\n\t\t\tmicRequired: true,\n\t\t\tvideoSupport: false,\n\t\t\tprogressTone: false\n\t\t};\n\n\t\tif (this.enableMicAutoParameters === false)\n\t\t{\n\t\t\tphoneApiParameters.audioConstraints = {\n\t\t\t\toptional: [\n\t\t\t\t\t{echoCancellation: false},\n\t\t\t\t\t{googEchoCancellation: false},\n\t\t\t\t\t{googEchoCancellation2: false},\n\t\t\t\t\t{googDAEchoCancellation: false},\n\t\t\t\t\t{googAutoGainControl: false},\n\t\t\t\t\t{googAutoGainControl2: false},\n\t\t\t\t\t{mozAutoGainControl: false},\n\t\t\t\t\t{googNoiseSuppression: false},\n\t\t\t\t\t{googNoiseSuppression2: false},\n\t\t\t\t\t{googHighpassFilter: false},\n\t\t\t\t\t{googTypingNoiseDetection: false},\n\t\t\t\t\t{googAudioMirroring: false}\n\t\t\t\t]\n\t\t\t};\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tBX.Voximplant.getClient({\n\t\t\t\t// debug: this.debug,\n\t\t\t\tapiParameters: phoneApiParameters\n\t\t\t}).then((client) =>\n\t\t\t{\n\t\t\t\tthis.voximplantClient = client;\n\n\t\t\t\tif (this.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantClient.useAudioSource(this.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (this.defaultSpeaker)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setDefaultAudioSettings({\n\t\t\t\t\t\toutputId: this.defaultSpeaker\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (BX.MessengerCommon.isDesktop() && Type.isFunction(this.voximplantClient.setLoggerCallback))\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantClient.enableSilentLogging();\n\t\t\t\t\tthis.voximplantClient.setLoggerCallback(e => this.phoneLog(e.label + \": \" + e.message))\n\t\t\t\t}\n\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.ConnectionFailed, this.onConnectionFailed.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.ConnectionClosed, this.onConnectionClosed.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.IncomingCall, this.onIncomingCall.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.MicAccessResult, this.onMicResult.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.SourcesInfoUpdated, this.phoneOnInfoUpdated.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.NetStatsReceived, this.onNetStatsReceived.bind(this));\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.phoneCommand('connectionError', {\n\t\t\t\t\t'CALL_ID': this.callId,\n\t\t\t\t\t'ERROR': e\n\t\t\t\t});\n\n\t\t\t\tthis.phoneCallFinish();\n\t\t\t\tthis.BXIM.playSound('error');\n\t\t\t\tthis.callOverlayProgress('offline');\n\t\t\t\tthis.callAbort(Loc.getMessage('IM_PHONE_ERROR'));\n\t\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\t\tthis.callView.setCallState(CallState.idle);\n\n\t\t\t\treject('Could not connect to Voximplant cloud');\n\t\t\t});\n\t\t})\n\t}\n\n\tphoneOnSDKReady(params)\n\t{\n\t\tthis.phoneLog('SDK ready');\n\n\t\tparams = params || {};\n\t\tparams.delay = params.delay || false;\n\n\t\tif (!params.delay && this.hasSipPhone)\n\t\t{\n\t\t\tif (!this.phoneIncoming && !this.phoneDeviceCall())\n\t\t\t{\n\t\t\t\t// if (BX.MessengerCommon.isPage())\n\t\t\t\t// {\n\t\t\t\t// \tBX.MessengerWindow.changeTab('im');\n\t\t\t\t// }\n\t\t\t\tif (BX.MessengerCommon.isDesktop())\n\t\t\t\t{\n\t\t\t\t\tBX.desktop.windowCommand(\"show\");\n\t\t\t\t\t// this.desktop.closeTopmostWindow();\n\t\t\t\t}\n\t\t\t\tthis.callOverlayProgress('wait');\n\t\t\t\tthis.callDialogAllowTimeout = setTimeout(() => this.phoneOnSDKReady({delay: true}), 5000);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (BX.MessengerCommon.isDesktop() && this.BXIM.init)\n\t\t{\n\t\t\tBX.desktop.syncPause(true);\n\t\t}\n\n\t\tthis.phoneLog('Connection exists');\n\n\t\tthis.callView.setProgress(CallProgress.connect);\n\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_CONNECT'));\n\t\tthis.phoneOnAuthResult({result: true});\n\t\tthis.callView.setCallState(CallState.connecting);\n\t\tif (this.phoneIncoming)\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.connectingIncoming);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t}\n\t}\n\n\tphoneOnInfoUpdated(e)\n\t{\n\t\tthis.phoneLog('Info updated', this.voximplantClient.audioSources(), this.voximplantClient.videoSources());\n\t}\n\n\tonCallConnected(e)\n\t{\n\t\tif (BX.MessengerCommon.isDesktop() && this.BXIM.init)\n\t\t{\n\t\t\tBX.desktop.syncPause(true);\n\t\t}\n\n\t\tthis.BXIM.stopRepeatSound('ringtone', 5000);\n\n\t\tBX.localStorage.set(lsKeys.callInited, true, 7);\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tthis.phoneConnectedInterval = setInterval(\n\t\t\t() => BX.localStorage.set(lsKeys.callInited, true, 7),\n\t\t\t5000\n\t\t);\n\n\t\t// this.desktop.closeTopmostWindow();\n\n\t\tthis.phoneLog('Call connected', e);\n\n\t\tthis.callView.setUiState(UiState.connected);\n\t\tthis.callView.setCallState(CallState.connected);\n\t\tthis.callView.setProgress(CallProgress.online);\n\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_ONLINE'));\n\t\tthis.callActive = true;\n\t}\n\n\tbindPhoneViewCallbacks(callView)\n\t{\n\t\tif (!callView instanceof PhoneCallView)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tcallView.setCallback('mute', this.onCallViewMute.bind(this));\n\t\tcallView.setCallback('unmute', this.onCallViewUnmute.bind(this));\n\t\tcallView.setCallback('hold', this.onCallViewHold.bind(this));\n\t\tcallView.setCallback('unhold', this.onCallViewUnhold.bind(this));\n\t\tcallView.setCallback('answer', this.onCallViewAnswer.bind(this));\n\t\tcallView.setCallback('skip', this.onCallViewSkip.bind(this));\n\t\tcallView.setCallback('hangup', this.onCallViewHangup.bind(this));\n\t\tcallView.setCallback('transfer', this.onCallViewTransfer.bind(this));\n\t\tcallView.setCallback('cancelTransfer', this.onCallViewCancelTransfer.bind(this));\n\t\tcallView.setCallback('completeTransfer', this.onCallViewCompleteTransfer.bind(this));\n\t\tcallView.setCallback('callListMakeCall', this.onCallViewCallListMakeCall.bind(this));\n\t\tcallView.setCallback('close', this.onCallViewClose.bind(this));\n\t\tcallView.setCallback('switchDevice', this.onCallViewSwitchDevice.bind(this));\n\t\tcallView.setCallback('qualityGraded', this.onCallViewQualityGraded.bind(this));\n\t\tcallView.setCallback('dialpadButtonClicked', this.onCallViewDialpadButtonClicked.bind(this));\n\t\tcallView.setCallback('saveComment', this.onCallViewSaveComment.bind(this));\n\t}\n\n\tonCallViewMute()\n\t{\n\t\tthis.muteCall();\n\t}\n\n\tonCallViewUnmute()\n\t{\n\t\tthis.unmuteCall();\n\t}\n\n\tonCallViewHold()\n\t{\n\t\tthis.holdCall();\n\t}\n\n\tonCallViewUnhold()\n\t{\n\t\tthis.unholdCall();\n\t}\n\n\tonCallViewAnswer()\n\t{\n\t\tthis.phoneIncomingAnswer();\n\t}\n\n\tonCallViewSkip()\n\t{\n\t\tthis.phoneCommand('skip', {'CALL_ID': this.callId});\n\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\t\tthis.callView.close();\n\t}\n\n\tonCallViewHangup()\n\t{\n\t\tif (this.hasExternalCall && this.callId)\n\t\t{\n\t\t\tthis.phoneCommand('deviceHungup', {'CALL_ID': this.callId});\n\t\t}\n\n\t\tthis.phoneCallFinish();\n\t\tthis.BXIM.playSound('stop');\n\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_FINISHED'));\n\t\tthis.callView.setCallState(CallState.idle);\n\t\tif (this.isCallListMode())\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.outgoing);\n\t\t\tif (this.callView.isFolded())\n\t\t\t{\n\t\t\t\tthis.callView.unfold();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\t}\n\n\tonCallViewTransfer(e)\n\t{\n\t\tif (e.type == 'user' || e.type == 'pstn' || e.type == 'queue')\n\t\t{\n\t\t\tthis.phoneTransferTargetType = e.type;\n\t\t\tthis.phoneTransferTargetId = e.target;\n\t\t\tthis.sendInviteTransfer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error('Unknown transfer type', e);\n\t\t}\n\t}\n\n\tonCallViewCancelTransfer(e)\n\t{\n\t\tthis.cancelInviteTransfer(e);\n\t}\n\n\tonCallViewCompleteTransfer(e)\n\t{\n\t\tthis.completeTransfer(e)\n\t}\n\n\tonCallViewCallListMakeCall(e)\n\t{\n\t\tthis.callListMakeCall(e)\n\t}\n\n\tonCallViewClose()\n\t{\n\t\tthis.callListId = 0;\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.dispose();\n\t\t\tthis.callView = null;\n\t\t}\n\n\t\tif (this.deviceType == DeviceType.Phone)\n\t\t{\n\t\t\tthis.callId = '';\n\t\t\tthis.callActive = false;\n\t\t\tthis.hasExternalCall = false;\n\t\t\tthis.callSelfDisabled = false;\n\t\t\tclearInterval(this.phoneConnectedInterval);\n\n\t\t\tBX.localStorage.set(lsKeys.externalCall, false);\n\t\t}\n\t}\n\n\tonCallViewSwitchDevice(e)\n\t{\n\t\tvar phoneNumber = e.phoneNumber;\n\t\tvar lastCallListCallParams = this.lastCallListCallParams;\n\t\tif (this.hasExternalCall && this.callId)\n\t\t{\n\t\t\tthis.phoneCommand('deviceHungup', {'CALL_ID': this.callId});\n\t\t}\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\t\tthis.phoneDeviceCall(!this.phoneDeviceCall());\n\t\tthis.callView.setDeviceCall(this.phoneDeviceCall());\n\t\tif (this.isCallListMode())\n\t\t{\n\t\t\tthis.callListMakeCall(lastCallListCallParams);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.close();\n\t\t\tthis.phoneCall(phoneNumber);\n\t\t}\n\t}\n\n\tonCallViewQualityGraded(grade)\n\t{\n\t\tvar message = {\n\t\t\tCOMMAND: 'gradeQuality',\n\t\t\tgrade: grade\n\t\t};\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.sendMessage(JSON.stringify(message));\n\t\t}\n\t}\n\n\tonCallViewDialpadButtonClicked(key)\n\t{\n\t\tthis.sendDTMF(key);\n\t}\n\n\tonCallViewSaveComment(e)\n\t{\n\t\tthis.phoneCommand(\"saveComment\", {\n\t\t\t'CALL_ID': e.callId,\n\t\t\t'COMMENT': e.comment\n\t\t})\n\t}\n\n\tdisplayIncomingCall(params)\n\t{\n\t\t/*chatId, callId, callerId, lineNumber, companyPhoneNumber, isCallback*/\n\t\tparams.isCallback = !!params.isCallback;\n\t\tthis.phoneLog('incoming call', params);\n\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\tthis.showUnsupported();\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.phoneNumberUser = Text.encode(params.callerId);\n\t\tparams.callerId = params.callerId.replace(/[^a-zA-Z0-9\\.]/g, '');\n\n\t\tif (this.callActive)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = 0;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.phoneIncoming = true;\n\t\tthis.callId = params.callId;\n\t\tthis.phoneNumber = params.callerId;\n\t\tthis.phoneParams = {};\n\n\t\tconst direction = params.isCallback ? Direction.callback : Direction.incoming;\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tBXIM: this.BXIM,\n\t\t\tuserId: this.userId,\n\t\t\tphoneNumber: this.phoneNumber,\n\t\t\tlineNumber: params.lineNumber,\n\t\t\tcompanyPhoneNumber: params.companyPhoneNumber,\n\t\t\tcallTitle: this.phoneNumberUser,\n\t\t\tdirection: direction,\n\t\t\ttransfer: this.isCallTransfer,\n\t\t\tstatusText: (params.isCallback ? Loc.getMessage('IM_PHONE_INVITE_CALLBACK') : Loc.getMessage('IM_PHONE_INVITE')),\n\t\t\tcrm: params.showCrmCard,\n\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\tcallId: this.callId,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.setUiState(UiState.incoming);\n\t\tthis.callView.setCallState(CallState.connecting);\n\t\tif (params.config)\n\t\t{\n\t\t\tthis.callView.setConfig(params.config);\n\t\t}\n\n\t\tthis.callView.show();\n\n\t\tif (params.portalCall)\n\t\t{\n\t\t\tthis.callView.setPortalCall(true);\n\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t}\n\n\t\tif (!this.BXIM.windowFocus && this.notifyManager && this.notifyManager.nativeNotifyGranted())\n\t\t{\n\t\t\tlet icon = '';\n\t\t\tif (this.callUserId)\n\t\t\t{\n\t\t\t\tconst userData = BX.MessengerCommon.getUser(this.callUserId);\n\t\t\t\tif (userData)\n\t\t\t\t{\n\t\t\t\t\ticon = userData.avatar;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst notify = {\n\t\t\t\ttitle: Loc.getMessage('IM_PHONE_DESC'),\n\t\t\t\ttext: Text.decode(this.callView.getTitle()),\n\t\t\t\ticon: icon,\n\t\t\t\ttag: 'im-call',\n\t\t\t\tonshow: () => setTimeout(() => notify.close(), 5000),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\twindow.focus();\n\t\t\t\t\tnotify.close();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.notifyManager.nativeNotify(notify);\n\t\t}\n\t}\n\n\tsendInviteTransfer()\n\t{\n\t\tif (!this.currentCall && this.deviceType == DeviceType.Webrtc)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.phoneTransferTargetType || !this.phoneTransferTargetId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.phoneCommand('startTransfer',\n\t\t\t{\n\t\t\t\t'CALL_ID': this.callId,\n\t\t\t\t'TARGET_TYPE': this.phoneTransferTargetType,\n\t\t\t\t'TARGET_ID': this.phoneTransferTargetId\n\t\t\t}\n\t\t).then((result) =>\n\t\t{\n\t\t\tif (result.SUCCESS == 'Y')\n\t\t\t{\n\t\t\t\tthis.phoneTransferEnabled = true;\n\t\t\t\tBX.localStorage.set(lsKeys.vite, true, 1);\n\n\t\t\t\tthis.phoneTransferCallId = result.DATA.CALL.CALL_ID;\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER'));\n\t\t\t\tthis.callView.setUiState(UiState.transferring);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error(\"Could not start call transfer. Error: \", result.ERRORS);\n\t\t\t}\n\t\t});\n\t}\n\n\tcancelInviteTransfer()\n\t{\n\t\tif (!this.currentCall && this.deviceType == DeviceType.Webrtc)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_ONLINE'));\n\t\tthis.callView.setUiState(UiState.connected);\n\n\t\tif (this.isCallTransfer)\n\t\t{\n\t\t\tthis.phoneCommand('cancelTransfer', {'CALL_ID': this.phoneTransferCallId});\n\t\t}\n\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\t}\n\n\terrorInviteTransfer(code, reason)\n\t{\n\t\tif (!this.isCallTransfer)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (code == '403' || code == '410' || code == '486')\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER_' + code));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER_1'));\n\t\t}\n\t\tthis.BXIM.playSound('error', true);\n\t\tthis.callView.setUiState(UiState.transferFailed);\n\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\t}\n\n\tcompleteTransfer()\n\t{\n\t\tthis.phoneCommand('completeTransfer', {'CALL_ID': this.phoneTransferCallId});\n\t}\n\n\tshowExternalCall(params)\n\t{\n\t\tvar direction;\n\t\tif (this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsetTimeout(() => BX.localStorage.set(lsKeys.externalCall, true, 5), 100);\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tthis.phoneConnectedInterval = setInterval(() =>\n\t\t{\n\t\t\tif (this.hasExternalCall)\n\t\t\t{\n\t\t\t\tBX.localStorage.set(lsKeys.externalCall, true, 5);\n\t\t\t}\n\t\t}, 5000);\n\n\t\tthis.callId = params.callId;\n\t\tthis.callActive = true;\n\t\tthis.hasExternalCall = true;\n\n\t\tif (params.isCallback)\n\t\t{\n\t\t\tdirection = Direction.callback;\n\t\t}\n\t\telse if (params.fromUserId > 0)\n\t\t{\n\t\t\tdirection = Direction.outgoing;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdirection = Direction.incoming;\n\t\t}\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcallId: params.callId,\n\t\t\tdirection: direction,\n\t\t\tphoneNumber: params.phoneNumber,\n\t\t\tlineNumber: params.lineNumber,\n\t\t\tcompanyPhoneNumber: params.companyPhoneNumber,\n\t\t\tfromUserId: params.fromUserId,\n\t\t\ttoUserId: params.toUserId,\n\t\t\tcrm: params.showCrmCard,\n\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\tcrmBindings: params.crmBindings,\n\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tisExternalCall: true,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.bindPhoneViewCallbacksExternalCall(this.callView);\n\t\tthis.callView.setUiState(UiState.externalCard);\n\t\tthis.callView.setCallState(CallState.connected);\n\t\tthis.callView.setConfig(params.config);\n\t\tthis.callView.show();\n\n\t\tif (params.portalCall)\n\t\t{\n\t\t\tthis.callView.setPortalCall(true);\n\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t}\n\t}\n\n\tbindPhoneViewCallbacksExternalCall(callView)\n\t{\n\t\tcallView.setCallback('close', () =>\n\t\t{\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.dispose();\n\t\t\t\tthis.callView = null;\n\t\t\t}\n\n\t\t\tthis.callId = '';\n\t\t\tthis.callActive = false;\n\t\t\tthis.hasExternalCall = false;\n\t\t\tthis.callSelfDisabled = false;\n\t\t\tclearInterval(this.phoneConnectedInterval);\n\t\t\tBX.localStorage.set(lsKeys.externalCall, false);\n\t\t});\n\t\tcallView.setCallback('saveComment', this.onCallViewSaveComment.bind(this));\n\t}\n\n\thideExternalCall(clearFlag)\n\t{\n\t\tif (this.callView && !this.callView.isCallListMode())\n\t\t{\n\t\t\tthis.callView.autoClose();\n\t\t}\n\t}\n\n\tphoneLog()\n\t{\n\t\tif (BX.MessengerCommon.isDesktop())\n\t\t{\n\t\t\tlet text = '';\n\t\t\tfor (let i = 0; i < arguments.length; i++)\n\t\t\t{\n\t\t\t\tif (BX.type.isPlainObject(arguments[i]))\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\ttext = text + ' | ' + JSON.stringify(arguments[i]);\n\t\t\t\t\t} catch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\ttext = text + ' | (circular structure)';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttext = text + ' | ' + arguments[i];\n\t\t\t\t}\n\t\t\t}\n\t\t\tBX.desktop.log('phone.' + this.BXIM.userEmail + '.log', text.substring(3));\n\t\t}\n\t\tif (this.debug)\n\t\t{\n\t\t\tif (console)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tconsole.log('Phone Log', JSON.stringify(arguments));\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.log('Phone Log', arguments[0]);\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns promise which will be resolved if\n\t *  - either Bitrix Desktop is found and this code is running inside it\n\t *  - or no Bitrix Desktop found\n\t * @returns {Promise}\n\t */\n\tcheckDesktop()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tBX.desktopUtils.runningCheck(\n\t\t\t\t() => reject(),\n\t\t\t\t() => resolve()\n\t\t\t);\n\t\t});\n\t}\n\n\tcallDialogAllowShow(checkActive)\n\t{\n\t\t// TODO: make this dialog work properly again\n\t\treturn;\n\n\t\tif (BX.MessengerCommon.isDesktop())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.phoneMicAccess)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callDialogAllow)\n\t\t{\n\t\t\tthis.callDialogAllow.close();\n\t\t}\n\n\t\tthis.callDialogAllow = new BX.IM.Call.HardwareDialog({\n\t\t\tbindNode: this.messenger.popupMessengerDialog,\n\t\t\toffsetTop: (this.messenger.popupMessengerDialog ? (this.callOverlayMinimize ? -20 : -this.messenger.popupMessengerDialog.offsetHeight / 2 - 100) : -20),\n\t\t\toffsetLeft: (this.callOverlay ? (this.callOverlay.offsetWidth / 2 - 170) : 0),\n\t\t\tonDestroy: function ()\n\t\t\t{\n\t\t\t\tthis.callDialogAllow = null;\n\t\t\t}.bind(this)\n\t\t});\n\t\tthis.callDialogAllow.show();\n\t}\n\n\trestoreFoldedCallView()\n\t{\n\t\tconst callProperties = BX.localStorage.get(lsKeys.foldedView);\n\n\t\tif (!Type.isPlainObject(callProperties))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callActive = true;\n\t\tthis.callId = callProperties.phoneCallId;\n\t\tthis.phoneCrm = callProperties.phoneCrm;\n\t\tthis.deviceType = callProperties.phoneCallDevice;\n\t\tthis.hasExternalCall = callProperties.hasExternalCall;\n\n\t\tlet callViewProperties = callProperties.callView;\n\t\tcallViewProperties.BXIM = this.BXIM;\n\t\tthis.callView = new PhoneCallView(callProperties.callView);\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.externalCard);\n\t\t\tthis.callView.setCallState(CallState.connected);\n\t\t\tthis.bindPhoneViewCallbacksExternalCall(this.callView);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.bindPhoneViewCallbacks(this.callView);\n\t\t}\n\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tBX.localStorage.set(lsKeys.externalCall, true, 5);\n\t\t\tthis.phoneConnectedInterval = setInterval(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tif (this.hasExternalCall)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.localStorage.set(lsKeys.externalCall, true, 5);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t5000\n\t\t\t);\n\t\t}\n\n\t\tthis.phoneCommand('getCall', {'CALL_ID': this.callId}, true, (result) =>\n\t\t{\n\t\t\tif (!result.FOUND || result.FOUND !== 'Y')\n\t\t\t{\n\t\t\t\tthis.callId = '';\n\t\t\t\tthis.callActive = false;\n\t\t\t\tthis.hasExternalCall = false;\n\t\t\t\tthis.callSelfDisabled = false;\n\t\t\t\tclearInterval(this.phoneConnectedInterval);\n\t\t\t\tBX.localStorage.set(lsKeys.externalCall, false);\n\t\t\t\tif (this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.dispose();\n\t\t\t\t\tthis.callView = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tdisplayCallQuality(percent)\n\t{\n\t\tif (!this.currentCall || this.currentCall.state() != \"CONNECTED\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet grade = 5;\n\t\tif (100 == percent)\n\t\t{\n\t\t\tgrade = 5;\n\t\t}\n\t\telse if (percent >= 99)\n\t\t{\n\t\t\tgrade = 4;\n\t\t}\n\t\telse if (percent >= 97)\n\t\t{\n\t\t\tgrade = 3;\n\t\t}\n\t\telse if (percent >= 95)\n\t\t{\n\t\t\tgrade = 2;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgrade = 1;\n\t\t}\n\n\t\tthis.callView.setQuality(grade);\n\t\treturn grade;\n\t}\n\n\tcallOverlayProgress(progress)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setProgress(progress);\n\t\t\tif (progress === 'offline')\n\t\t\t{\n\t\t\t\tthis.BXIM.playSound('error');\n\t\t\t}\n\t\t}\n\t}\n\n\tcallOverlayStatus(status)\n\t{\n\t\tif (!Type.isStringFilled(status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setStatusText(status);\n\t\t}\n\t}\n\n\tsetCallOverlayTitle(title)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setTitle(title);\n\t\t}\n\t}\n\n\tcallOverlayTimer(state) // TODO not ready yet\n\t{\n\t\tstate = typeof (state) == 'undefined' ? 'start' : state;\n\n\t\tif (state == 'start')\n\t\t{\n\t\t\tthis.phoneCallTimeInterval = setInterval(() => this.phoneCallTime++, 1000);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclearInterval(this.phoneCallTimeInterval);\n\t\t}\n\t}\n\n\tcallAbort(reason)\n\t{\n\t\tthis.callOverlayDeleteEvents();\n\n\t\tif (reason && this.callView)\n\t\t{\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText(reason);\n\t\t\t}\n\t\t}\n\t}\n\n\tcallOverlayDeleteEvents()\n\t{\n\t\t// this.desktop.closeTopmostWindow();\n\n\t\tif (BX.MessengerCommon.isDesktop() && this.BXIM.init)\n\t\t{\n\t\t\tBX.desktop.syncPause(false);\n\t\t}\n\n\t\tthis.phoneCallFinish();\n\n\t\tthis.BXIM.stopRepeatSound('ringtone');\n\t\tthis.BXIM.stopRepeatSound('dialtone');\n\n\t\tclearTimeout(this.callDialogAllowTimeout);\n\t\tif (this.callDialogAllow)\n\t\t{\n\t\t\tthis.callDialogAllow.close();\n\t\t}\n\n\t}\n\n\tstorageSet(params)\n\t{\n\t\tif (params.key == lsKeys.vite)\n\t\t{\n\t\t\tif (params.value === true || !this.callSelfDisabled)\n\t\t\t{\n\t\t\t\tthis.phoneTransferEnabled = params.value;\n\t\t\t}\n\t\t}\n\t\telse if (params.key == lsKeys.externalCall)\n\t\t{\n\t\t\tif (params.value === false)\n\t\t\t{\n\t\t\t\tthis.hideExternalCall();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetDebugInfo()\n\t{\n\t\treturn {\n\t\t\tcontext: this.BXIM.context,\n\t\t\tdesign: this.BXIM.design,\n\t\t\t// isDesktop: this.isDesktop() ? 'Y' : 'N',\n\t\t\t// isPage: this.isPage() ? 'Y' : 'N',\n\t\t\t// isMobile: this.isMobile() ? 'Y' : 'N',\n\t\t\tvInitedCall: BX.localStorage.get('vInitedCall') ? 'Y' : 'N',\n\t\t\tdesktopStatus: this.BXIM.desktopStatus ? 'Y' : 'N',\n\t\t\thasActiveCall: BX.MessengerCalls && BX.MessengerCalls.hasActiveCall() ? 'Y' : 'N',\n\t\t\thasActiveCallTab: this.BXIM.callController && this.BXIM.callController.hasActiveCall() ? 'Y' : 'N',\n\t\t\tappVersion: navigator.appVersion\n\t\t}\n\t}\n\n\ttestSimple()\n\t{\n\t\tconst callId = 'test-call'\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcallId,\n\t\t\trestApps: this.restApps,\n\t\t\tevents: {\n\t\t\t\tclose: () =>\n\t\t\t\t{\n\t\t\t\t\tconsole.trace('close')\n\t\t\t\t\tthis.callView?.dispose();\n\t\t\t\t\tthis.callView = null;\n\t\t\t\t},\n\t\t\t\thangup: () => this.callView.close(),\n\t\t\t\ttransfer: (e) => console.log('transfer', e),\n\t\t\t\tdialpadButtonClicked: (e) => console.log('dialpadButtonClicked', e),\n\t\t\t\thold: () => console.log('hold'),\n\t\t\t\tunhold: () => console.log('unhold'),\n\t\t\t\tmute: () => console.log('mute'),\n\t\t\t\tunmute: () => console.log('unmute'),\n\t\t\t}\n\t\t})\n\t\tthis.callView.show();\n\t}\n\n\ttestCrm()\n\t{\n\n\t}\n\n\ttestUser()\n\t{\n\t\tthis.callView = new PhoneCallView({})\n\t}\n}","import { PhoneCallsController } from './controller';\nimport { PhoneCallView } from './view/view';\nimport { FoldedCallView } from './view/folded-view';\nimport './css/view.css';\n\nexport {\n\tPhoneCallsController,\n\tPhoneCallView,\n}\n\n// legacy compat\nBX.FoldedCallView = FoldedCallView;"],"names":["baseZIndex","nop","digits","Keypad","params","Type","isPlainObject","bindElement","offsetTop","offsetLeft","anglePosition","angleOffset","history","selectedLineId","defaultLineId","lines","availableLines","callInterceptAllowed","zIndex","hideDial","plusEntered","callbacks","onButtonClick","isFunction","onDial","onIntercept","onClose","elements","inputContainer","input","lineSelector","lineName","interceptButton","historyButton","plusKeyTimeout","popup","createPopup","popupOptions","id","targetContainer","document","body","darkMode","closeByEsc","autoHide","content","render","noAllPaddings","overlay","backgroundColor","opacity","events","onPopupClose","bind","angle","position","offset","Popup","destroy","length","lineId","innerText","getLineName","hasOwnProperty","SHORT_NAME","Dom","create","props","className","BX","MessengerCommon","isPage","children","click","_onDeleteButtonClick","attrs","type","value","placeholder","Loc","getMessage","keydown","_onInputKeydown","keyup","_onAfterNumberChanged","map","digit","renderNumber","_onKeyMouseDown","_onKeyMouseUp","canSelectLine","text","_onLineSelectClick","_onDialButtonClick","_onShowHistoryButtonClick","_onInterceptButtonClick","e","keyCode","phoneNumber","key","metaKey","ctrlKey","shiftKey","insertAtCursor","preventDefault","altKey","classList","toggle","focus","substr","setTimeout","startsWith","clearTimeout","menuItems","isArray","forEach","index","push","Text","encode","onclick","historySelectMenu","close","Menu","bindOptions","onPopupDestroy","show","lineSelectMenu","setSelectedLineId","maxHeight","number","onMouseDown","onMouseUp","classSuffix","dataset","mousedown","currentTarget","mouseup","inputElement","selectionStart","startPos","endPos","selectionEnd","substring","callCardEvents","addCommentButtonClick","muteButtonClick","holdButtonClick","transferButtonClick","cancelTransferButtonClick","completeTransferButtonClick","hangupButtonClick","nextButtonClick","skipButtonClick","answerButtonClick","entityChanged","qualityMeterClick","dialpadButtonClick","makeCallButtonClick","notifyAdminButtonClick","closeButtonClick","UndefinedCallCard","result","errorCode","BaseWorker","Error","placement","name","callCard","CallCard","isExternalCall","PhoneCallView","used","prototype","callback","Object","keys","UiState","filter","state","isCardActive","getUndefinedCallCardError","uiState","setUiState","disableAutoStartTimer","stopTimer","hideTimer","showTimer","isTimerStarted","isMuted","muted","setMuted","addClass","buttons","mute","isDesktop","slave","desktop","onCustomEvent","desktopEvents","onMute","removeClass","onUnMute","unmute","isHeld","held","setHeld","hold","onHold","onUnHold","unhold","startTimer","setTitle","title","setStatusText","statusText","timer","visible","sections","style","display","isFolded","unfoldedElements","initialTimestamp","desktopMethodEvents","setMute","setHold","getListUiState","setCardTitle","corporatePortalPageEvents","DesktopWorker","eventHandlers","rest","AppLayout","initializePlacement","initializeInterfaceMethods","initializeInterfaceEvents","addEventHandlersForEventsFromCallCard","addTransmitEventHandlers","CallCardGetListUiStates","getListUiStates","CallCardSetMute","transmitSetMute","CallCardSetHold","transmitSetHold","CallCardSetUiState","transmitSetUiState","CallCardSetCardTitle","transmitSetCardTitle","CallCardSetStatusText","transmitSetStatusText","CallCardClose","transmitClose","CallCardStartTimer","transmitStartTimer","CallCardStopTimer","transmitStopTimer","isCallCardPage","BXDesktopSystem","BroadcastEvent","window","desktopEventName","toUpperCase","slice","event","getEvents","removeCustomEvents","addCustomEvent","onTransmitHandler","getCallCardPlatformWorker","handler","isCorporatePortalPage","DoNothing","eventName","eventHandler","realHandler","arEventParams","i","detail","apply","addEventListener","removeEventListener","BXDesktopWindow","GetWindowId","GetMainWindow","BXWindows","find","element","callWindow","getCallCardWindow","PCW","backgroundWorker","platformWorker","BrowserWorker","initializeInterface","backgroundWorkerEvents","instance","BackgroundWorker","emitEvent","removeDesktopEventHandlers","isUsed","setIsExternalCall","FormManager","node","currentForm","onFormLoad","onFormUnLoad","onFormSend","formData","getFormData","Bitrix24FormLoader","load","unload","sec","secCode","lang","ref","location","href","handlers","_onFormLoad","_onFormUnLoad","options","form","CallList","entityType","statuses","Map","currentStatusId","callListStatusId","currentItemIndex","itemIndex","callingStatusId","callingItemIndex","selectionLocked","onError","onSelectedItem","showLimit","showDelta","next","currentStatus","get","ITEMS","update","selectItem","debug","isDomNode","setCallingElement","bitrix_sessid","ajax","url","getAjaxUrl","method","dataType","data","onsuccess","ERROR","STATUSES","statusRecord","set","STATUS_ID","item","itemStatus","ENTITY_TYPE","getNonEmptyStatusId","console","log","statusId","newIndex","currentNode","_node","itemActionMenu","newEntity","ASSOCIATED_ENTITY","TYPE","ID","bindings","ELEMENT_ID","phones","PHONES","clean","append","renderStatusBlocks","status","renderStatusBlock","_shownCount","Math","min","renderCallListItem","_showMoreNode","replace","onShowMoreClick","itemDescriptor","statusName","NAME","phonesText","phone","VALUE","showItemMenu","target","EDIT_URL","open","POST","COMPANY_TITLE","renderAssociatedEntity","associatedEntity","newStatusNode","parentNode","replaceChild","callListItem","menuItem","actionMenuItemClickHandler","delimiter","setElementRank","RANK","elementId","setElementStatus","rank","executeItemAction","action","parameters","callListId","successCallback","repopulateItems","webformResultId","requestParams","items","foundStatusId","count","toString","animationTimeout","itemsNode","measuringNode","_folded","CLASS","getStatusTitle","height","clientHeight","renderCallListItems","transitionend","removeProperty","foldedCallListInstance","avatars","FoldedCallView","currentItem","callListParams","webformId","webformSecCode","itemStatusId","statusList","avatar","callButton","nextButton","unfoldButton","_lsKey","_lsTtl","init","savedData","localStorage","remove","animation","currentItemStatusId","fromEntries","store","makeCall","BXIM","restoredParams","callListItemIndex","startCallList","dblclick","_onViewDblClick","appendChild","bottom","renderUserInfo","_onNextButtonClick","_onUnfoldButtonClick","backgroundImage","loadAvatar","entityId","unfold","moveToNext","desktopFeatureMap","Desktop","parentPhoneCallView","closable","js","minSettingsWidth","minSettingsHeight","resizable","createWindow","SetProperty","Width","width","Height","minWidth","minHeight","html","getHtmlPage","ExecuteCommand","jsContent","initImJs","bodyClass","htmlWrapperHead","head","outerHTML","isStringFilled","initJs","callId","_uiState","companyPhoneNumber","direction","fromUserId","toUserId","crm","hasSipPhone","deviceCall","transfer","crmEntityType","crmEntityId","crmActivityId","crmActivityEditUrl","config","JSON","stringify","portalCall","portalCallData","portalCallUserId","restApps","documentElement","windowTarget","full","clientVersion","GetProperty","join","featureName","getVersion","Direction","incoming","outgoing","transferIncoming","connectingIncoming","connectingOutgoing","connected","transferring","transferFailed","transferConnected","idle","error","moneyError","sipPhoneError","redial","externalCard","CallState","connecting","CallProgress","connect","offline","online","wait","ButtonLayouts","centered","spaced","layouts","simple","initialSize","lsKeys","setStatus","setDeviceCall","setCrmEntity","setPortalCall","setPortalCallUserId","setPortalCallQueueName","setPortalCallData","setConfig","setCallState","reloadCrmCard","setCallId","setLineNumber","setPhoneNumber","setCompanyPhoneNumber","setTransfer","closeWindow","onMakeCall","onCallListMakeCall","onAnswer","onSkip","onHangup","onStartTransfer","onCompleteTransfer","onCancelTransfer","onBeforeUnload","onSwitchDevice","onQualityGraded","onDialpadButtonClicked","onCommentShown","onSaveComment","onSetAutoClose","blankAvatar","lineNumber","callState","prop","getString","getInteger","crmData","getObject","crmBindings","getArray","externalRequests","portalCallQueueName","recording","allowAutoClose","folded","autoFold","progress","quality","qualityPopup","qualityGrade","comment","commentShown","timerInterval","getInitialElements","getInitialSections","uiStateButtons","getUiStateButtons","buttonLayout","layout","callListMakeCall","answer","skip","hangup","completeTransfer","cancelTransfer","switchDevice","qualityGraded","dialpadButtonClicked","saveComment","notifyAdmin","_onBeforeUnloadHandler","_onBeforeUnload","_onDblClickHandler","_onDblClick","_onHoldButtonClickHandler","_onHoldButtonClick","_onMuteButtonClickHandler","_onMuteButtonClick","_onTransferButtonClickHandler","_onTransferButtonClick","_onTransferCompleteButtonClickHandler","_onTransferCompleteButtonClick","_onTransferCancelButtonClickHandler","_onTransferCancelButtonClick","_onDialpadButtonClickHandler","_onDialpadButtonClick","_onHangupButtonClickHandler","_onHangupButtonClick","_onCloseButtonClickHandler","_onCloseButtonClick","_onMakeCallButtonClickHandler","_onMakeCallButtonClick","_onNextButtonClickHandler","_onRedialButtonClickHandler","_onRedialButtonClick","_onFoldButtonClickHandler","_onFoldButtonClick","_onAnswerButtonClickHandler","_onAnswerButtonClick","_onSkipButtonClickHandler","_onSkipButtonClick","_onSwitchDeviceButtonClickHandler","_onSwitchDeviceButtonClick","_onQualityMeterClickHandler","_onQualityMeterClick","_onPullEventCrmHandler","_onPullEventCrm","_externalEventHandler","_onExternalEvent","_unloadHandler","_onWindowUnload","hiddenTabs","currentTabName","moreTabsMenu","callListView","currentEntity","callingEntity","numberSelectMenu","webformLoaded","restAppLayoutLoaded","restAppLayoutLoading","restAppInterface","skipOnResize","currentLayout","getInstance","setCallCard","setExternalCall","emitInitializeEvent","getPlacementOptions","createTitle","then","test","main","crmButtons","commentEditorContainer","commentEditor","qualityMeter","crmCard","crmButtonsContainer","buttonsContainer","topLevelButtonsContainer","topButtonsContainer","sidebarContainer","tabsContainer","tabsBodyContainer","tabs","callList","webform","app","tabsBody","moreTabs","openCallWindow","getInitialWidth","getInitialHeight","bindMasterDesktopEvents","createLayout","updateView","bindSlaveDesktopEvents","reinit","onCallListSelectedItem","loadCrmCard","removeCustomEvent","disableDocumentScroll","getId","closeIcon","draggable","restrict","createLayoutFolded","createLayoutCrm","createLayoutSimple","hasSideBar","renderTitle","bxchange","_onCommentChanged","createSidebarLayout","checkMoreButton","top","left","right","isFeatureSupported","storedWidth","parseInt","getItem","floor","screen","storedHeight","setItem","sectionName","sectionsIndex","tabId","tabBodyId","_onTabHeaderClick","isWebformSupported","formManager","_onFormSend","isRestAppsSupported","restApp","restAppId","_onTabMoreClick","setActiveTab","portalCallUserImage","isPortalCall","hrphoto","hidden","tab","loadForm","loadRestApp","currentTab","isCurrentTabHidden","tabElement","callTitle","Promise","resolve","PhoneNumberParser","parse","parsedNumber","isValid","format","isInternational","charAt","isCallback","users","isTransfer","adjust","entityTypeName","Number","toLowerCase","_getRandomString","len","charSet","randomString","randomPoz","random","setOnSlave","innerHTML","getQualityMeterWidth","renderProgress","renderCrmButtons","renderButtons","stateButtons","setClosable","showOnlySections","hideCallIcon","showCallIcon","showSections","additionalParams","isAutoFoldAllowed","fold","sipPhone","activityId","activityEditUrl","runAction","response","newMainElement","resizeWindow","bindCrmCardEvents","errors","Crm","Page","anchors","querySelectorAll","onCrmAnchorClick","isSliderEnabled","userId","renderAvatar","queueName","message","renderTimer","renderButtonsFolded","renderButtonsDefault","buttonsFragment","createDocumentFragment","topButtonsFragment","topLevelButtonsFragment","subContainers","buttonName","buttonNode","renderSimpleButton","canBeFolded","CRM_CREATE","addCommentLabel","_onAddCommentButtonClick","_onAddDealButtonClick","_onAddInvoiceButtonClick","_onAddLeadButtonClick","_onAddContactButtonClick","hideSections","currentElement","getCurrentElement","setWebformResult","resultId","getPlacement","Runtime","initializeAppInterface","appInterface","getStatus","cb","disableAutoClose","enableAutoClose","undefined","isActiveIntoCurrentCall","isUnloadAllowed","returnValue","selectTransferTarget","keypad","dialpad","call","showNumberSelectMenu","phoneNumbers","onSelect","closeNumberSelectMenu","moveToNextItem","addComment","_getCrmEditUrl","externalContext","_generateExternalContext","Uri","addParam","contact_id","company_id","external_context","call_list_id","call_list_element","context","redirect","contact","company","origin_id","showQualityPopup","closeQualityPopup","isCanceled","isBoolean","entityInfo","command","IS_CANCELED","eventParams","PARAMS","entity","resetCallingElement","Date","getTime","setInterval","currentTimestamp","elapsedMilliSeconds","elapsedSeconds","minutes","seconds","template","isRecording","clearInterval","cacheable","createStar","mouseover","mouseout","util","getRandomString","foldCallView","foldCall","popupNode","getPopupContainer","overlayNode","enableDocumentScroll","foldedCallView","unbindAll","debounce","saveInitialSize","innerWidth","innerHeight","getSlider","isSelfContained","denyAction","slider","grade","autoClose","eventId","setClosingByEsc","adjustPosition","setResizable","setMinSize","center","resize","scrollWidth","clientWidth","setProperty","add","imBar","getElementById","unloadRestApps","unloadForm","unbindDesktopEvents","resultCallback","loadExtension","exports","getDialogConfigForBackgroundApp","getDefaultDialogConfig","Dialog","transferDialog","targetNode","multiple","hideOnSelect","enableSearch","entities","inviteEmployeeLink","selectFields","deselectAll","getEntityId","customData","getCustomData","showTransferToUserMenu","hide","clickCallback","active","isInteger","userCustomData","onMenuItemClick","icon","separator","popupContent","MessengerChat","MenuPrepareList","lightShadow","callInited","externalCall","vite","dialHistory","foldedView","DeviceType","Webrtc","Phone","PhoneCallsController","phoneEnabled","isAdmin","isString","canInterceptCall","deviceActive","readDefaults","restoreFoldedCallView","Browser","isLocalStorageSupported","storageSet","onPullEvent","onCallConnectedHandler","onCallConnected","onCallDisconnectedHandler","onCallDisconnected","onCallFailedHandler","onCallFailed","onProgressToneStartHandler","onProgressToneStart","onProgressToneStopHandler","onProgressToneStop","garbage","callActive","callView","canBeUnloaded","hasExternalCall","deviceType","phoneCrm","getState","VoxImplant","CallEvents","Connected","Disconnected","Failed","ProgressToneStart","ProgressToneStop","notifyManager","defaultMicrophone","defaultCamera","defaultSpeaker","enableMicAutoParameters","onPullInvite","onPullAnswerSelf","onPullTimeout","onPullOutgoing","onPullStart","onPullHold","onPullUnhold","onPullUpdateCrm","onPullUpdatePortalUser","onPullCompleteTransfer","onPullPhoneDeviceActive","onPullChangeDefaultLineId","onPullReplaceCallerId","onPullShowExternalCall","onPullHideExternalCall","phoneSupport","callController","hasActiveCall","isCallListMode","phoneCommand","checkDesktop","CRM","FOUND","phonePortalCall","updateUserData","userData","getUser","callerId","phoneCallConfig","phoneCallTime","repeatSound","getDebugInfo","isCallTransfer","displayIncomingCall","chatId","showCrmCard","callSelfDisabled","stopRepeatSound","phoneCallFinish","callAbort","phoneTransferCallId","errorInviteTransfer","failedCode","failedReason","phoneConnectedInterval","external","setProgress","indexOf","callDevice","setCrmData","phoneDisplayExternal","callOverlayTimer","phoneIncoming","phoneNumberLast","setLocalConfig","isCallHold","newCallId","phoneTransferTargetId","phoneTransferTargetType","phoneTransferEnabled","setCallOverlayTitle","showExternalCall","hideExternalCall","async","reject","pathToCallAjax","revision","timeout","currentCall","setCallEventListeners","phoneParams","clone","phoneFullNumber","phoneLog","voximplantClient","phoneOnSDKReady","getCallParams","initParams","decode","phoneNumberUser","HR_PHOTO","callOverlayUserId","DIALOG_ID","callOverlayChatId","phoneCallTimeInterval","removeCallEventListeners","scheduleApiDisconnect","phoneRinging","callOverlayOptions","phoneMicAccess","callInitUserId","startCall","headers","code","reason","phoneServer","phoneLogin","phoneCheckBalance","callOverlayProgress","disconnect","callOverlayDeleteEvents","callOverlayStatus","playSound","percent","stats","packetLoss","displayCallQuality","sendMessage","toggleCallHold","sendTone","callMethod","ready","muteMicrophone","unmuteMicrophone","deviceCallBlock","getLocalConfig","Voximplant","openLimitSlider","loadPhoneLines","_doOpenKeyPad","desktopStatus","desktopVersion","isRestLine","showUnsupported","phoneLines","onKeyPadDial","onKeyPadIntercept","onKeyPadClose","closeKeyPad","phoneCall","UI","InfoHelper","interceptErrorPopup","correctPhoneNumber","initiator","callUserId","bindPhoneViewCallbacks","cachedLines","err","matches","exec","_doPhoneCall","addToHistory","startCallViaRestApp","numberOriginal","internationalNumber","openConfirm","phoneDeviceCall","MessengerTheme","isDark","CALL_ID","EXTERNAL","CONFIG","changeTab","windowCommand","closeTopmostWindow","phoneApiInit","PopupWindowButton","delegate","browser","IsMac","proxy_context","popupWindow","oldHistory","phoneIndex","splice","concat","_doCallListMakeCall","lastCallListCallParams","useAudioSource","Hardware","AudioDeviceManager","setDefaultAudioSettings","outputId","phoneApiParameters","useRTCOnly","micRequired","videoSupport","progressTone","audioConstraints","optional","echoCancellation","googEchoCancellation","googEchoCancellation2","googDAEchoCancellation","googAutoGainControl","googAutoGainControl2","mozAutoGainControl","googNoiseSuppression","googNoiseSuppression2","googHighpassFilter","googTypingNoiseDetection","googAudioMirroring","getClient","apiParameters","client","setLoggerCallback","enableSilentLogging","label","Events","ConnectionFailed","onConnectionFailed","ConnectionClosed","onConnectionClosed","IncomingCall","onIncomingCall","MicAccessResult","onMicResult","SourcesInfoUpdated","phoneOnInfoUpdated","NetStatsReceived","onNetStatsReceived","delay","callDialogAllowTimeout","syncPause","phoneOnAuthResult","audioSources","videoSources","setCallback","onCallViewMute","onCallViewUnmute","onCallViewHold","onCallViewUnhold","onCallViewAnswer","onCallViewSkip","onCallViewHangup","onCallViewTransfer","onCallViewCancelTransfer","onCallViewCompleteTransfer","onCallViewCallListMakeCall","onCallViewClose","onCallViewSwitchDevice","onCallViewQualityGraded","onCallViewDialpadButtonClicked","onCallViewSaveComment","muteCall","unmuteCall","holdCall","unholdCall","phoneIncomingAnswer","sendInviteTransfer","cancelInviteTransfer","dispose","COMMAND","sendDTMF","windowFocus","nativeNotifyGranted","notify","getTitle","tag","onshow","nativeNotify","SUCCESS","DATA","CALL","ERRORS","bindPhoneViewCallbacksExternalCall","clearFlag","arguments","userEmail","desktopUtils","runningCheck","checkActive","callDialogAllow","IM","Call","HardwareDialog","bindNode","messenger","popupMessengerDialog","callOverlayMinimize","offsetHeight","callOverlay","offsetWidth","onDestroy","callProperties","phoneCallId","phoneCallDevice","callViewProperties","setQuality","design","vInitedCall","MessengerCalls","hasActiveCallTab","appVersion","navigator","trace"],"mappings":"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"}