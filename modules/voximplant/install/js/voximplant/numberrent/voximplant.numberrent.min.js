(function(){BX.namespace("BX.Voximplant");var e="/telephony/rent.php";BX.Voximplant.NumberRent=function(e){if(!BX.type.isPlainObject(e)){e={}}this.packetSize=parseInt(e.packetSize)||1;this.slider=null;this.onSliderMessageHandler=this.onSliderMessage.bind(this)};BX.Voximplant.NumberRent.create=function(e){return new BX.Voximplant.NumberRent(e)};BX.Voximplant.NumberRent.prototype={show:function(){var n=e;if(this.packetSize>1){n+="?PACKET_SIZE="+this.packetSize}BX.SidePanel.Instance.open(n,{allowChangeHistory:false,cacheable:false,events:{onOpen:this.onSliderOpen.bind(this),onClose:this.onSliderClose.bind(this),onDestroy:this.onSliderDestroy.bind(this)}});BX.addCustomEvent("SidePanel.Slider:onMessage",this.onSliderMessageHandler)},close:function(){if(this.slider){this.slider.close()}},openConfigEditor:function(e){e=parseInt(e);if(e>0){BX.SidePanel.Instance.open("/telephony/edit.php?ID="+e,{cacheable:false,allowChangeHistory:false})}},openDocumentsUploader:function(){BX.SidePanel.Instance.open("/telephony/documents.php",{cacheable:false,allowChangeHistory:false})},onSuccessRent:function(e,n){var t;var i=[];var o;var s=Object.keys(n);var a=s.map(function(e){return n[e]["PHONE_NUMBER_FORMATTED"]}).join(", ");if(s.length===1&&n[s[0]]["VERIFICATION_STATUS"]==="REQUIRED"){t=BX.message("VI_NUMBER_RENT_NUMBER_RESERVED").replace("#NUMBER#",a);i.push(new BX.PopupWindowButton({id:"upload",text:BX.message("VI_NUMBER_RENT_UPLOAD_DOCUMENTS"),events:{click:function(){o.close();this.openDocumentsUploader()}.bind(this)}}))}else{if(s.length>1){t=BX.message("VI_NUMBER_RENT_NUMBERS_ATTACHED").replace("#NUMBERS#",a)}else{t=BX.message("VI_NUMBER_RENT_NUMBER_ATTACHED").replace("#NUMBER#",a)}i.push(new BX.PopupWindowButton({id:"configure",text:s.length>1?BX.message("VI_NUMBER_RENT_CONFIGURE_NUMBERS"):BX.message("VI_NUMBER_RENT_CONFIGURE_NUMBER"),events:{click:function(){o.close();this.openConfigEditor(e)}.bind(this)}}))}i.push(new BX.PopupWindowButton({id:"close",text:BX.message("VI_NUMBER_RENT_CLOSE"),events:{click:function(){o.close()}}}));o=new BX.PopupWindow("voximplant-rent-success",null,{closeIcon:true,closeByEsc:true,autoHide:false,titleBar:BX.message("VI_NUMBER_RENT_CONGRATULATIONS"),content:t,overlay:{color:"gray",opacity:30},buttons:i,events:{onPopupClose:function(){this.destroy()},onPopupDestroy:function(){o=null}}});o.show()},getNumbersInSubscription:function(e){return new Promise(function(n,t){BX.ajax.runAction("voximplant.subscription.getWithNumber",{data:{number:e}}).then(function(e){var t=e.data;n(t)}).catch(function(e){var n=e.errors[0];t(n.message)})})},waitNumberDeletionConfirmation:function(e){return new Promise(function(n){var t;if(e.length===1){t=BX.message("VI_NUMBER_NUMBER_DELETE_CONFIRM").replace("#NUMBER#",e[0])}else{t=BX.create("div",{children:[BX.create("span",{text:BX.message("VI_NUMBER_NUMBER_RENTED_IN_BUNDLE").replace("#COUNT#",e.length)}),BX.create("ul",{children:e.map(function(e){return BX.create("li",{text:e})})}),BX.create("span",{text:BX.message("VI_NUMBER_CONFIRM_BUNDLE_DISCONNECTION")})]})}BX.Voximplant.confirm(BX.message("VI_NUMBER_CONFIRM_ACTION"),t).then(function(e){if(e){n()}})})},enqueueForDeletion:function(e){return new Promise(function(n,t){BX.ajax.runAction("voximplant.subscription.enqueueDisconnect",{data:{subscriptionId:e}}).then(function(e){n()}).catch(function(e){var n=e.errors[0];t(n.message)})})},deleteNumber:function(e){return new Promise(function(n,t){BX.Voximplant.showLoader();var i;var o;this.getNumbersInSubscription(e).then(function(e){BX.Voximplant.hideLoader();o=e.subscriptionId;i=e.numbers;return this.waitNumberDeletionConfirmation(i)}.bind(this)).then(function(){BX.Voximplant.showLoader();return this.enqueueForDeletion(o)}.bind(this)).then(function(){BX.Voximplant.hideLoader();n()}.bind(this)).catch(function(e){console.error(e);BX.Voximplant.hideLoader();if(e){BX.Voximplant.alert(BX.message("VI_NUMBER_ERROR"),BX.message("VI_DELETE_NUMBER_ERROR"))}t()})}.bind(this))},cancelNumberDeletion:function(e){return new Promise(function(n,t){BX.Voximplant.showLoader();BX.ajax.runAction("voximplant.subscription.cancelDisconnect",{data:{number:e}}).then(function(e){BX.Voximplant.hideLoader();n()}.bind(this)).catch(function(e){var n=e.errors[0];BX.Voximplant.hideLoader();BX.Voximplant.alert(BX.message("VI_NUMBER_ERROR"),BX.message("VI_CANCEL_DELETE_NUMBER_ERROR"));t()})}.bind(this))},onSliderOpen:function(e){this.slider=e.slider},onSliderMessage:function(e){if(e.getEventId()==="BX.Voximplant.Rent::onSuccess"){var n=e.data;this.onSuccessRent(n.configId,n.numbers)}},onSliderClose:function(e){BX.removeCustomEvent("SidePanel.Slider:onMessage",this.onSliderMessageHandler);this.slider.destroy()},onSliderDestroy:function(e){this.slider=null}}})();
//# sourceMappingURL=voximplant.numberrent.map.js