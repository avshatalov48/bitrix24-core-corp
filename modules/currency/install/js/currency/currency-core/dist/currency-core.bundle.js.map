{"version":3,"file":"currency-core.bundle.js","sources":["../src/currency-item.js","../src/currency-core.js"],"sourcesContent":["// @flow\nexport class CurrencyItem\n{\n\t#currency = '';\n\t#format = {};\n\n\tconstructor(currency: string, format: {})\n\t{\n\t\tthis.#currency = currency;\n\t\tthis.#format = format;\n\t}\n\n\tgetCurrency(): string\n\t{\n\t\treturn this.#currency;\n\t}\n\n\tgetFormat(): {}\n\t{\n\t\treturn this.#format;\n\t}\n\n\tsetFormat(format: {}): void\n\t{\n\t\tthis.#format = format;\n\t}\n}","// @flow\n\nimport {Reflection, Type} from 'main.core';\nimport {CurrencyItem} from \"./currency-item\";\n\nexport class CurrencyCore\n{\n\tstatic currencies: CurrencyItem[] = [];\n\n\tstatic defaultFormat = {\n\t\t'FORMAT_STRING': '#',\n\t\t'DEC_POINT': '.',\n\t\t'THOUSANDS_SEP': ' ',\n\t\t'DECIMALS': 2,\n\t\t'HIDE_ZERO': 'N'\n\t};\n\n\tstatic getCurrencyList(): CurrencyItem[]\n\t{\n\t\treturn this.currencies;\n\t}\n\n\tstatic setCurrencyFormat(currency: string, format, replace: boolean): void\n\t{\n\t\tif (!Type.isStringFilled(currency) || !Type.isPlainObject(format))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst index = this.getCurrencyIndex(currency);\n\n\t\tif (index > -1 && !replace)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst innerFormat = {...this.defaultFormat, ...format};\n\n\t\tif (index === -1)\n\t\t{\n\t\t\tthis.currencies.push(new CurrencyItem(currency, innerFormat));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.currencies[index].setFormat(innerFormat);\n\t\t}\n\t}\n\n\tstatic setCurrencies(currencies: [], replace: boolean)\n\t{\n\t\tif (Type.isArray(currencies))\n\t\t{\n\t\t\tfor (let i = 0; i < currencies.length; i++)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\t!Type.isPlainObject(currencies[i])\n\t\t\t\t\t|| !Type.isStringFilled(currencies[i].CURRENCY)\n\t\t\t\t\t|| !Type.isPlainObject(currencies[i].FORMAT)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.setCurrencyFormat(currencies[i].CURRENCY, currencies[i].FORMAT, replace);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getCurrencyFormat(currency: string)\n\t{\n\t\tconst index = this.getCurrencyIndex(currency);\n\n\t\treturn (index > -1 ? this.getCurrencyList()[index].getFormat() : false);\n\t}\n\n\tstatic getCurrencyIndex(currency: string): number\n\t{\n\t\tconst currencyList = this.getCurrencyList();\n\n\t\tfor (let i = 0; i < currencyList.length; i++)\n\t\t{\n\t\t\tif (currencyList[i].getCurrency() === currency)\n\t\t\t{\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tstatic clearCurrency(currency)\n\t{\n\t\tconst index = this.getCurrencyIndex(currency);\n\t\tif (index > -1)\n\t\t{\n\t\t\tthis.currencies = BX.util.deleteFromArray(this.currencies, index);\n\t\t}\n\t}\n\n\tstatic clean()\n\t{\n\t\tthis.currencies = [];\n\t}\n\n\tstatic currencyFormat(price: number, currency: string, useTemplate: boolean)\n\t{\n\t\tlet result = '';\n\n\t\tconst format = this.getCurrencyFormat(currency);\n\t\tif (Type.isObject(format))\n\t\t{\n\t\t\tformat.CURRENT_DECIMALS = format.DECIMALS;\n\n\t\t\tif (format.HIDE_ZERO === 'Y' && price == parseInt(price, 10))\n\t\t\t{\n\t\t\t\tformat.CURRENT_DECIMALS = 0;\n\t\t\t}\n\n\t\t\tresult = BX.util.number_format(price, format.CURRENT_DECIMALS, format.DEC_POINT, format.THOUSANDS_SEP);\n\t\t\tif (useTemplate)\n\t\t\t{\n\t\t\t\tresult = format.FORMAT_STRING.replace(/(^|[^&])#/, '$1' + result);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tstatic loadCurrencyFormat(currency)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst index = this.getCurrencyIndex(currency);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tresolve(this.getCurrencyList()[index].getFormat());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.ajax.runAction(\"currency.format.get\", {data: {currencyId: currency}})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tconst format = response.data;\n\t\t\t\t\t\tthis.setCurrencyFormat(currency, format);\n\t\t\t\t\t\tresolve(format);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\treject(response.errors);\n\t\t\t\t\t});\n\t\t\t}\n\t\t})\n\t}\n}\n\n/** @deprecated use import { CurrencyCore } from 'currency.core' */\nReflection.namespace('BX.Currency').Core = CurrencyCore;"],"names":["CurrencyItem","currency","format","CurrencyCore","currencies","replace","Type","isStringFilled","isPlainObject","index","getCurrencyIndex","innerFormat","defaultFormat","push","setFormat","isArray","i","length","CURRENCY","FORMAT","setCurrencyFormat","getCurrencyList","getFormat","currencyList","getCurrency","BX","util","deleteFromArray","price","useTemplate","result","getCurrencyFormat","isObject","CURRENT_DECIMALS","DECIMALS","HIDE_ZERO","parseInt","number_format","DEC_POINT","THOUSANDS_SEP","FORMAT_STRING","Promise","resolve","reject","ajax","runAction","data","currencyId","then","response","catch","errors","Reflection","namespace","Core"],"mappings":"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"}