(function(){"use strict";BX.namespace("BX.Landing");BX.Landing.SiteDomainHelper=function(i){this.idDomainName=i.idDomainName;this.idDomainMessage=i.idDomainMessage;this.idDomainLoader=i.idDomainLoader;this.idDomainErrorAlert=i.idDomainErrorAlert;this.classes={dangerBorder:"ui-ctl-danger",successBorder:"ui-ctl-success",dangerAlert:"landing-domain-alert-danger",successAlert:"landing-domain-alert-success"};if(this.idDomainName){this.idDomainNameParent=this.idDomainName.parentNode}};BX.Landing.SiteDomainHelper.prototype={showLoader:function(){this.clearMessage();BX.show(this.idDomainLoader)},hideLoader:function(){BX.hide(this.idDomainLoader)},isLoaderShowed:function(){return this.idDomainLoader&&this.idDomainLoader.style.display!=="none"},setSuccess:function(i){if(this.idDomainErrorAlert){BX.hide(this.idDomainErrorAlert)}this.setMessage(i)},setError:function(i){this.setMessage(i,true)},isErrorShowed:function(){return this.idDomainMessage&&BX.hasClass(this.idDomainMessage,this.classes.dangerAlert)&&this.idDomainMessage.style.display!=="none"},setMessage:function(i,e){if(!this.idDomainMessage){return}e=!!e;this.clearMessage();if(i){if(this.idDomainNameParent){BX.addClass(this.idDomainNameParent,e?this.classes.dangerBorder:this.classes.successBorder)}BX.addClass(this.idDomainMessage,e?this.classes.dangerAlert:this.classes.successAlert);BX.show(this.idDomainMessage);this.idDomainMessage.innerHTML=i}},clearMessage:function(){if(!this.idDomainMessage){return}if(this.idDomainNameParent){BX.removeClass(this.idDomainNameParent,this.classes.dangerBorder);BX.removeClass(this.idDomainNameParent,this.classes.successBorder)}BX.removeClass(this.idDomainMessage,this.classes.dangerAlert);BX.removeClass(this.idDomainMessage,this.classes.successAlert);this.idDomainMessage.innerHTML=""}};BX.Landing.SiteDomainInput=function(i){this.domainId=i.domainId;this.domainName=i.domainName;this.domainPostfix=i.domainPostfix||"";this.idDomainName=i.idDomainName;this.idDomainINA=i.idDomainINA;this.idDomainDnsInfo=i.idDomainDnsInfo;this.idDomainSubmit=i.idDomainSubmit;this.previousDomainName=null;this.helper=new BX.Landing.SiteDomainHelper(i);this.classes={submit:"ui-btn-clock"};if(this.idDomainName){BX.bind(this.idDomainName,"keyup",BX.debounce(function(i){this.keyupCallback(i)}.bind(this),500,this))}if(this.idDomainSubmit){BX.bind(this.idDomainSubmit,"click",function(i){this.checkSubmit(i)}.bind(this))}this.fillDnsInstruction(this.domainName)};BX.Landing.SiteDomainInput.prototype={domainNameIsEmpty:function(){this.idDomainName.value=BX.util.trim(this.idDomainName.value);return this.idDomainName.value===""},checkSubmit:function(){if(BX.hasClass(this.idDomainSubmit,this.classes.submit)){BX.PreventDefault()}else if(this.domainNameIsEmpty()){this.helper.setError(BX.message("LANDING_TPL_ERROR_DOMAIN_EMPTY"));BX.PreventDefault()}else if(this.helper.isErrorShowed()){BX.PreventDefault()}else{BX.addClass(this.idDomainSubmit,this.classes.submit)}},keyupCallback:function(){this.idDomainName.value=BX.util.trim(this.idDomainName.value);if(this.idDomainName.value===""){this.helper.setError(BX.message("LANDING_TPL_ERROR_DOMAIN_EMPTY"));return}var i=this.idDomainName.value;if(this.previousDomainName===i){return}this.previousDomainName=i;this.helper.showLoader();BX.ajax({url:"/bitrix/tools/landing/ajax.php?action=Domain::check",method:"POST",data:{data:{domain:i+this.domainPostfix,filter:this.domainId?{"!ID":this.domainId}:{}},sessid:BX.message("bitrix_sessid")},dataType:"json",onsuccess:function(i){this.helper.hideLoader();if(i.type==="success"){if(!i.result.available){this.helper.setError(!!i.result.deleted?BX.message("LANDING_TPL_ERROR_DOMAIN_EXIST_DELETED"):BX.message("LANDING_TPL_ERROR_DOMAIN_EXIST"))}else if(!i.result.domain){this.helper.setError(BX.message("LANDING_TPL_ERROR_DOMAIN_INCORRECT"))}else{this.fillDnsInstruction(i.result.domain);this.helper.setSuccess(BX.message("LANDING_TPL_DOMAIN_AVAILABLE"))}if(i.result.dns&&this.idDomainINA){this.idDomainINA.textContent=i.result.dns["INA"]}}else{this.helper.setError("Error processing")}}.bind(this)})},fillDnsInstruction:function(i){if(!this.idDomainDnsInfo){return}if(!i){return}if(!this.idDomainDnsInfo.rows[1]){return}if(!this.idDomainDnsInfo.rows[2]){return}if(this.idDomainDnsInfo.rows[1].cells.length<3||this.idDomainDnsInfo.rows[2].cells.length<3){return}var e=this.idDomainDnsInfo.rows[1];var s=this.idDomainDnsInfo.rows[2];var t=i.split(".");var a=/^(com|net|org|co|kiev|spb|kharkov|msk|in)\.[a-z]{2}$/;s.style.display="none";e.cells[0].textContent=i?i:"landing.mydomain";if(t.length===2||t.length===3&&t[0]==="www"||t.length===3&&(t[1]+"."+t[2]).match(a)){s.style.display="table-row";if(t.length===3&&t[0]==="www"){s.cells[0].textContent=t[1]+"."+t[2]+"."}else{e.cells[0].textContent="www."+i+".";s.cells[0].textContent=i+"."}}}};BX.Landing.SiteDomainPrivate=function(i){new BX.Landing.SiteDomainInput(i)};BX.Landing.SiteDomainBitrix24=function(i){new BX.Landing.SiteDomainInput(i)};BX.Landing.SiteDomainFree=function(i){this.idDomainSubmit=i.idDomainSubmit;this.idDomainCheck=i.idDomainCheck;this.idDomainName=i.idDomainName;this.idDomainAnother=i.idDomainAnother;this.idDomainAnotherMore=i.idDomainAnotherMore;this.idDomainErrorAlert=i.idDomainErrorAlert;this.saveBlocker=i.saveBlocker;this.saveBlockerCallback=i.saveBlockerCallback;this.promoCloseIcon=i.promoCloseIcon;this.promoCloseLink=i.promoCloseLink;this.promoBlock=i.promoBlock;this.maxVisibleSuggested=parseInt(i.maxVisibleSuggested||10);this.tld=i.tld;this.helper=new BX.Landing.SiteDomainHelper(i);this.classes={submit:"ui-btn-clock"};if(this.promoCloseIcon&&this.promoCloseLink){BX.bind(this.promoCloseIcon,"click",this.closePromoBlock.bind(this));BX.bind(this.promoCloseLink,"click",this.closePromoBlock.bind(this))}if(this.idDomainAnotherMore){BX.bind(this.idDomainAnotherMore,"click",this.showMoreDomains.bind(this))}if(this.idDomainSubmit){BX.bind(this.idDomainSubmit,"click",function(i){this.checkSubmit(i)}.bind(this))}if(this.idDomainCheck&&this.idDomainName){BX.bind(this.idDomainCheck,"click",function(i){this.checkDomain(i)}.bind(this))}if(this.idDomainName){BX.bind(this.idDomainName,"keyup",BX.debounce(function(i){this.keyupCallback(i)}.bind(this),500,this))}};BX.Landing.SiteDomainFree.prototype={keyupCallback:function(){if(this.idDomainName.value===""){this.helper.setError(BX.message("LANDING_TPL_ERROR_DOMAIN_EMPTY"));return}this.helper.setSuccess("")},closePromoBlock:function(){this.promoBlock.remove()},showMoreDomains:function(){this.idDomainAnother.style.height=this.idDomainAnother.children[0].offsetHeight+"px";this.idDomainAnotherMore.classList.add("landing-domain-block-available-btn-hide")},checkSubmit:function(){if(BX.hasClass(this.idDomainSubmit,this.classes.submit)){BX.PreventDefault();return}this.checkDomainName();if(this.helper.isErrorShowed()){BX.PreventDefault()}else if(this.saveBlocker&&this.saveBlockerCallback){this.saveBlockerCallback();BX.PreventDefault()}else{BX.addClass(this.idDomainSubmit,this.classes.submit)}},selectSuggested:function(i){this.idDomainName.value=i;this.helper.setSuccess(BX.message("LANDING_TPL_DOMAIN_AVAILABLE"))},fillSuggest:function(i){if(!this.idDomainAnother){return}if(this.idDomainAnotherMore){if(i.length>this.maxVisibleSuggested){BX.show(this.idDomainAnotherMore);this.idDomainAnotherMore.classList.remove("landing-domain-block-available-btn-hide")}else{BX.hide(this.idDomainAnotherMore)}}if(i.length){BX.show(this.idDomainAnother.parentNode)}else{BX.hide(this.idDomainAnother.parentNode)}var e=[];for(var s=0,t=i.length;s<t;s++){e.push(BX.create("div",{props:{className:"landing-domain-block-available-item"},children:[BX.create("input",{props:{className:""},attrs:{name:"domain-edit-suggest",id:"domain-edit-suggest-"+s,type:"radio"},events:{click:function(e){this.selectSuggested(i[e])}.bind(this,s)}}),BX.create("label",{props:{className:"landing-domain-block-available-label"},attrs:{for:"domain-edit-suggest-"+s},text:i[s]})]}))}this.idDomainAnother.innerHTML="";this.idDomainAnother.appendChild(BX.create("div",{props:{className:"landing-domain-block-available-list"},children:e}));if(this.idDomainAnotherMore.style.display==="none"){this.idDomainAnother.style.height=this.idDomainAnother.children[0].offsetHeight+"px"}else{this.idDomainAnother.style.height=80+"px"}},checkDomainName:function(){this.idDomainName.value=BX.util.trim(this.idDomainName.value);var i=RegExp("^[a-z0-9-]+."+this.tld[0].toLowerCase()+"$");if(this.idDomainName.value===""){this.helper.setError(BX.message("LANDING_TPL_ERROR_DOMAIN_EMPTY"))}else if(!i.test(this.idDomainName.value.toLowerCase())){this.helper.setError(BX.message("LANDING_TPL_ERROR_DOMAIN_CHECK"))}else if(this.idDomainName.value.indexOf("--")!==-1||this.idDomainName.value.indexOf("-.")!==-1||this.idDomainName.value.indexOf("-")===0){this.helper.setError(BX.message("LANDING_TPL_ERROR_DOMAIN_CHECK_DASH"))}},checkDomain:function(){BX.PreventDefault();if(this.helper.isLoaderShowed()){return}this.checkDomainName();if(this.helper.isErrorShowed()){return}this.helper.showLoader();this.fillSuggest([]);BX.ajax({url:"/bitrix/tools/landing/ajax.php?action=Domain::whois",method:"POST",data:{data:{domainName:this.idDomainName.value,tld:this.tld},sessid:BX.message("bitrix_sessid")},dataType:"json",onsuccess:function(i){this.helper.hideLoader();if(i.type==="success"){var e=i.result;if(!e.enable){if(e.suggest){this.fillSuggest(e.suggest)}this.helper.setError(BX.message("LANDING_TPL_ERROR_DOMAIN_EXIST"))}else{this.helper.setSuccess(BX.message("LANDING_TPL_DOMAIN_AVAILABLE"))}}}.bind(this)})}}})();
//# sourceMappingURL=script.map.js