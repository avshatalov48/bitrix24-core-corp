this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};(function(e,n,t){"use strict";var a,i;var s=function(){function e(s){var o=this;babelHelpers.classCallCheck(this,e);this.siteId=s.siteId;this.landingId=s.landingId;this.type=s.type;this.pages=s.pages;this.container=document.getElementById(s.containerId);this.menu=document.getElementById(s.menuId);for(var r in this.pages){this.pages[r].container=n.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div class="landing-settings-page-container"></div>'])));n.Dom.append(this.pages[r].container,this.container)}this.loadingPages=[];this.loaderContainer=n.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['<div class="landing-settings-loader-container"></div>'])));n.Dom.insertAfter(this.loaderContainer,this.container);this.loader=new t.Loader({target:this.loaderContainer});this.links=[].slice.call(this.menu.querySelectorAll(e.PAGE_LINK_SELECTOR));var d=this.links[0];this.links.forEach((function(e){o.bindMenuLink(e);if(e.dataset.page&&o.pages[e.dataset.page]&&o.pages[e.dataset.page].current===true){d=e}}));if(d){this.onMenuLinkClick(d)}this.saveButton=document.getElementById(s.saveButtonId);this.onSave=this.onSave.bind(this);n.Event.bind(this.saveButton,"click",this.onSave)}babelHelpers.createClass(e,[{key:"showLoader",value:function e(){this.loader.show();n.Dom.show(this.loaderContainer)}},{key:"hideLoader",value:function e(){this.loader.hide();n.Dom.hide(this.loaderContainer)}},{key:"bindMenuLink",value:function e(t){var a=this;n.Event.bind(t,"click",(function(e){e.preventDefault();e.stopPropagation();a.onMenuLinkClick(t)}))}},{key:"bindPageLink",value:function e(t){if(t.dataset.page){var a=this.links.find((function(e){return e.dataset.page===t.dataset.page}));if(a){n.Event.bind(t,"click",(function(e){e.preventDefault();e.stopPropagation();a.click()}))}}}},{key:"onMenuLinkClick",value:function e(n){if(n.dataset.page){this.onPageChange(n.dataset.page)}else if(n.dataset.placement){if(typeof BX.rest!=="undefined"&&typeof BX.rest.Marketplace!=="undefined"){BX.rest.Marketplace.bindPageAnchors({})}BX.rest.AppLayout.openApplication(n.dataset.appId,{SITE_ID:this.siteId,LID:this.landingId},{PLACEMENT:n.dataset.placement,PLACEMENT_ID:n.dataset.placementId})}}},{key:"onPageChange",value:function t(a){var i=this;var s=this.pages[a];if(s){if(s.container.childNodes.length===0){this.showLoader();this.loadingPages.push(a);n.ajax.get(s.link,(function(n){s.container.innerHTML=n;i.loadingPages.splice(i.loadingPages.indexOf(a),1);if(i.loadingPages.length===0){i.hideLoader()}var t=s.container.querySelector("form.landing-form");if(t){s.form=t}var o=s.container.querySelectorAll(e.PAGE_LINK_SELECTOR);if(o.length>0){o.forEach((function(e){return i.bindPageLink(e)}))}if(i.currentPage){i.currentPage.container.hidden=true}i.currentPage=s;i.currentPage.container.hidden=false}))}else{if(this.currentPage){this.currentPage.container.hidden=true}this.currentPage=s;this.currentPage.container.hidden=false}}}},{key:"onSave",value:function e(){var n=this;this.showLoader();var t=[];for(var a in this.pages){var i=this.pages[a];if(i.form){t.push(fetch(i.linkToSave,{method:"POST",body:new FormData(i.form),headers:{"Bx-ajax":true}}))}}Promise.all(t).then((function(e){var t=true;e.forEach((function(e){t=t&&e.ok}));if(t){top.window["landingSettingsSaved"]=true;top.BX.onCustomEvent("BX.Landing.Filter:apply");n.hideLoader();if(n.type==="KNOWLEDGE"||n.type==="GROUP"){BX.SidePanel.Instance.close();BX.SidePanel.Instance.reload()}else{top.window.location.reload();BX.SidePanel.Instance.close()}}}))["catch"]((function(e){console.error(e)}))}}]);return e}();babelHelpers.defineProperty(s,"PAGE_LINK_SELECTOR","a[data-page], a[data-placement]");e.LandingSettings=s})(this.BX.Landing.Component=this.BX.Landing.Component||{},BX,BX);
//# sourceMappingURL=script.map.js