{"version":3,"file":"script.js","sources":["src/js/index.js"],"sourcesContent":["import { Dialog } from 'ui.entity-selector';\nimport { Tag, Event, Loc } from 'main.core';\n\nimport '../css/landing.selector.css';\n\ntype SelectorOptions = {\n\tnode: HTMLElement,\n\tinput: HTMLElement,\n\turlLandingAdd: ?string,\n\turlFolderAdd: ?string,\n\tsiteType: string,\n\tsiteId: number,\n\tfolderId: number,\n\tlandingId: number,\n\titems: Array<Item>,\n\tonSelect: () => {}\n};\n\ntype Item = {\n\tid: number,\n\tentityId: string,\n\ttabs: string,\n\ttitle: string,\n\tnodeOptions: ?{\n\t\tdynamic: boolean\n\t}\n};\n\nexport class Selector {\n\t#dialog: Dialog = null;\n\t#node: HTMLElement\n\t#input: HTMLElement\n\t#urlLandingAdd: ?string;\n\t#urlFolderAdd: ?string;\n\t#siteType: string;\n\t#siteId: number;\n\tfolderId: number;\n\tlandingId: number;\n\t#items: Array<Item>;\n\t#onSelect: () => {};\n\t#selectorContainer: HTMLElement\n\t#overlayElement: HTMLElement\n\t#overlayShown: boolean\n\n\tconstructor(options: SelectorOptions)\n\t{\n\t\tthis.#node = options.node;\n\t\tthis.#input = options.input;\n\t\tthis.#urlLandingAdd = options.urlLandingAdd || null;\n\t\tthis.#urlFolderAdd = options.urlFolderAdd || null;\n\t\tthis.#siteType = options.siteType;\n\t\tthis.#siteId = options.siteId;\n\t\tthis.folderId = options.folderId;\n\t\tthis.landingId = options.landingId;\n\t\tthis.#items = options.items || [];\n\t\tthis.#onSelect = options.onSelect;\n\t\tthis.#selectorContainer = BX('landing-selector');\n\n\t\tif (this.#node)\n\t\t{\n\t\t\tEvent.bind(this.#input, 'click', this.#handleSearchClick.bind(this));\n\t\t\tEvent.bind(this.#input, 'input', this.#onSearch.bind(this));\n\t\t}\n\t}\n\n\t#getDialog()\n\t{\n\t\tif (!this.#dialog)\n\t\t{\n\t\t\tthis.#dialog = new Dialog({\n\t\t\t\ttargetNode: this.#node,\n\t\t\t\twidth: 565,\n\t\t\t\theight: 300,\n\t\t\t\tenableSearch: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tshowAvatars: true,\n\t\t\t\tcompactView: false,\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tmultiple: false,\n\t\t\t\tcontext: 'landing',\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'landing',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tsiteType: this.#siteType,\n\t\t\t\t\t\t\tsiteId: this.#siteId,\n\t\t\t\t\t\t\tlandingId: this.landingId\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\titems: this.#items,\n\t\t\t\tevents: {\n\t\t\t\t\t'onHide': this.#hideSelector.bind(this),\n\t\t\t\t\t'Item:onSelect': this.#onSelect\n\t\t\t\t},\n\t\t\t\tfooter: [\n\t\t\t\t\tthis.#urlLandingAdd ? Tag.render`<a href=\"${this.#urlLandingAdd}\" class=\"ui-selector-footer-link ui-selector-footer-link-add\">${Loc.getMessage('LANDING_SELECTOR_ADD_PAGE')}</a>` : Tag.render``,\n\t\t\t\t\tthis.#urlLandingAdd ? Tag.render`<span class=\"ui-selector-footer-conjunction\">${Loc.getMessage('LANDING_SELECTOR_ADD_OR')}</span>` : Tag.render``,\n\t\t\t\t\tthis.#urlFolderAdd ? Tag.render`<a href=\"${this.#urlFolderAdd}\" class=\"ui-selector-footer-link\">${Loc.getMessage('LANDING_SELECTOR_ADD_FOLDER')}</a>` : Tag.render``\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\treturn this.#dialog;\n\t}\n\n\t#handleSearchClick()\n\t{\n\t\tthis.#showSelector();\n\t}\n\n\t#showSelector()\n\t{\n\t\tthis.#getDialog().show();\n\t\tthis.#showOverlay();\n\t\tBX.addClass(this.#node, 'landing-selector-active');\n\t}\n\n\t#hideSelector()\n\t{\n\t\tif (this.#overlayShown === true)\n\t\t{\n\t\t\tBX.addClass(this.#overlayElement, 'landing-selector-overlay-hiding');\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tBX.removeClass(this.#overlayElement, 'landing-selector-overlay-hiding');\n\t\t\t\tBX.remove(this.#overlayElement);\n\t\t\t}, 200);\n\n\t\t\tthis.#overlayShown = false;\n\t\t}\n\n\t\tBX.removeClass(this.#node, 'landing-selector-active');\n\t}\n\n\t#showOverlay()\n\t{\n\t\tif (!this.#overlayElement)\n\t\t{\n\t\t\tthis.#overlayElement = BX.create('div', {\n\t\t\t\tprops: {className: 'landing-selector-overlay'}\n\t\t\t});\n\t\t}\n\n\t\tif (this.#overlayShown !== true)\n\t\t{\n\t\t\tdocument.querySelector('.landing-ui-panel.landing-ui-panel-top').appendChild(this.#overlayElement);\n\t\t\tthis.#overlayShown = true\n\t\t}\n\t}\n\n\t#onSearch(event)\n\t{\n\t\tif (this.#dialog)\n\t\t{\n\t\t\tthis.#dialog.show();\n\t\t\tthis.#dialog.search(event.srcElement.value);\n\t\t}\n\t}\n\n\tonAddPage()\n\t{\n\t\talert(this.landingId);\n\t}\n\n\tonAddFolder()\n\t{\n\t\talert(this.folderId);\n\t}\n}\n"],"names":["Selector","options","node","input","urlLandingAdd","urlFolderAdd","siteType","siteId","folderId","landingId","items","onSelect","BX","Event","bind","alert","Dialog","targetNode","width","height","enableSearch","dropdownMode","showAvatars","compactView","dynamicLoad","multiple","context","entities","id","events","footer","Tag","render","Loc","getMessage","show","addClass","setTimeout","removeClass","remove","create","props","className","document","querySelector","appendChild","event","search","srcElement","value"],"mappings":"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"}