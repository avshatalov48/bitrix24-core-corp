(function(){"use strict";BX.namespace("BX.Landing");BX.Landing.EditDomainForm=function(e,t){this.domain=e.querySelector(".ui-domain-input-btn-js");this.postfix=e.querySelectorAll(".ui-postfix");this.domains=e.querySelectorAll(".ui-domainname");this.content=t.content||"";this.messages=t.messages||{};this.popup=BX.Landing.UI.Tool.ActionDialog.getInstance();BX.bind(this.domain,"click",BX.delegate(this.editDomain,this))};BX.Landing.EditDomainForm.prototype={editDomain:function(e){e.stopPropagation();var t=this.popup.show({title:this.messages.title,content:this.content,contentColor:"grey"});this.content.style.display="block";t.then(function(){var t="";for(var i=0,n=this.postfix.length;i<n;i++){if(this.postfix[i].checked&&typeof this.domains[i]!=="undefined"){this.domains[i].value=BX.util.trim(this.domains[i].value);if(this.domains[i].value!==""){t=this.domains[i].value+this.postfix[i].value}}}if(t===""){alert(this.messages.errorEmpty);this.editDomain(e)}else{BX("ui-domainname-title").textContent=t;BX("ui-domainname-text").value=t}}.bind(this),function(){})}};BX.Landing.EditTitleForm=function(e,t,i,n){this.btn=e.querySelector(".ui-title-input-btn-js");this.label=e.querySelector(".ui-editable-field-label-js");this.input=e.querySelector(".ui-editable-field-input-js");this.additionalWidth=t||0;this.input.IsWidthSet=false;this.display=n;this.hideInput=this.hideInput.bind(this);this.showInput=this.showInput.bind(this);if(i){BX.bind(e,"click",this.showInput)}else{BX.bind(this.btn,"click",this.showInput)}this.input.setAttribute("data-height",this.label.offsetHeight)};BX.Landing.EditTitleForm.prototype={showInput:function(e){e.stopPropagation();if(!this.input.IsWidthSet){this.input.style.width=this.label.offsetWidth+this.additionalWidth+17+"px"}if(this.input.tagName==="TEXTAREA"){this.input.style.height=this.input.getAttribute("data-height")+"px"}this.label.style.display="none";this.btn.style.display="none";this.input.style.display="block";this.input.focus();this.input.IsWidthSet=true;BX.bind(document,"click",this.hideInput)},hideInput:function(e){if(e.target===this.input)return;this.label.textContent=this.input.value;if(this.display){this.label.style.display="inline-block"}else{this.label.style.display="inline"}this.input.style.display="none";this.btn.style.display="inline-block";this.input.IsWidthSet=false;this.input.setAttribute("data-height",this.label.offsetHeight);BX.unbind(document,"click",this.hideInput)}};BX.Landing.ToggleFormFields=function(e){this.form=e;this.toggleBtn=e.querySelector(".landing-form-collapse-block-js");this.formInner=e.querySelector(".landing-form-inner-js");this.tableWparp=e.querySelector(".landing-form-table-wrap-js");this.startHeight=0;this.endHeight=0;this.isHidden=true;this.clickHandler=this.clickHandler.bind(this);this.setHeightAuto=this.setHeightAuto.bind(this);this.removeClassName=this.removeClassName.bind(this);BX.bind(this.toggleBtn,"click",this.clickHandler)};BX.Landing.ToggleFormFields.prototype={showRows:function(){this.startHeight=this.formInner.offsetHeight;this.formInner.style.height=this.startHeight+"px";this.form.classList.add("landing-form-collapsed-open");this.endHeight=this.tableWparp.offsetHeight+parseInt(BX.style(this.tableWparp,"marginBottom"));this.formInner.style.height=this.endHeight+"px";BX.bind(this.formInner,"transitionend",this.setHeightAuto);this.isHidden=false},closeRows:function(){this.formInner.style.height=this.endHeight+"px";setTimeout(function(){this.formInner.style.height=this.startHeight+"px"}.bind(this),70);BX.bind(this.formInner,"transitionend",this.removeClassName);this.isHidden=true},clickHandler:function(){if(this.isHidden)this.showRows();else this.closeRows()},setHeightAuto:function(){this.formInner.style.height="auto";BX.unbind(this.formInner,"transitionend",this.setHeightAuto)},removeClassName:function(){this.form.classList.remove("landing-form-collapsed-open");BX.unbind(this.formInner,"transitionend",this.removeClassName)}};BX.Landing.ColorPicker=function(e){this.picker=new BX.ColorPicker({bindElement:e,popupOptions:{angle:false,offsetTop:5},onColorSelected:this.onColorSelected.bind(this),colors:this.setColors()});this.colorPickerNode=e;this.colorIcon=e.querySelector(".ui-colorpicker-color-js");this.clearBtn=e.querySelector(".ui-colorpicker-clear");this.input=e.querySelector(".landing-colorpicker-inp-js");BX.bind(this.colorPickerNode,"click",this.show.bind(this));BX.bind(this.clearBtn,"click",this.clear.bind(this))};BX.Landing.ColorPicker.prototype={onColorSelected:function(e){this.colorPickerNode.classList.add("ui-colorpicker-selected");this.colorIcon.style.backgroundColor=e;this.input.value=e},show:function(e){if(e.target==this.clearBtn)return;this.picker.open()},clear:function(){this.colorPickerNode.classList.remove("ui-colorpicker-selected");this.input.value="";this.picker.setSelectedColor(null)},setColors:function(){return[["#f5f5f5","#eeeeee","#e0e0e0","#9e9e9e","#757575","#616161","#212121"],["#cfd8dc","#b0bec5","#90a4ae","#607d8b","#546e7a","#455a64","#263238"],["#d7ccc8","#bcaaa4","#a1887f","#795548","#6d4c41","#5d4037","#3e2723"],["#ffccbc","#ffab91","#ff8a65","#ff5722","#f4511e","#e64a19","#bf360c"],["#ffe0b2","#ffcc80","#ffb74d","#ff9800","#fb8c00","#f57c00","#e65100"],["#ffecb3","#ffe082","#ffd54f","#ffc107","#ffb300","#ffa000","#ff6f00"],["#fff9c4","#fff59d","#fff176","#ffeb3b","#fdd835","#fbc02d","#f57f17"],["#f0f4c3","#e6ee9c","#dce775","#cddc39","#c0ca33","#afb42b","#827717"],["#dcedc8","#c5e1a5","#aed581","#8bc34a","#7cb342","#689f38","#33691e"],["#c8e6c9","#a5d6a7","#81c784","#4caf50","#43a047","#388e3c","#1b5e20"],["#b2dfdb","#80cbc4","#4db6ac","#009688","#00897b","#00796b","#004d40"],["#b2ebf2","#80deea","#4dd0e1","#00bcd4","#00acc1","#0097a7","#006064"],["#b3e5fc","#81d4fa","#4fc3f7","#03a9f4","#039be5","#0288d1","#01579b"],["#bbdefb","#90caf9","#64b5f6","#2196f3","#1e88e5","#1976d2","#0d47a1"],["#c5cae9","#9fa8da","#7986cb","#3f51b5","#3949ab","#303f9f","#1a237e"],["#d1c4e9","#b39ddb","#9575cd","#673ab7","#5e35b1","#512da8","#311b92"],["#e1bee7","#ce93d8","#ba68c8","#9c27b0","#8e24aa","#7b1fa2","#4a148c"],["#f8bbd0","#f48fb1","#f06292","#e91e63","#d81b60","#c2185b","#880e4f"],["#ffcdd2","#ef9a9a","#e57373","#f44336","#e53935","#d32f2f","#b71c1c"]].map(function(e,t,i){return i.map(function(e){return e[t]})})}};BX.Landing.CustomFields=function(e){e.forEach(function(e){BX.bind(e.field,"keyup",function(){if(e.length){if(e.field.value.length<=e.length){e.node.textContent=e.field.value}else{e.node.textContent=e.field.value.substring(0,e.length)}}else{e.node.textContent=e.field.value}})})};BX.Landing.DomainNamePopup=function(e){var t=null;var i=null;var n=e.messages||{};var a=new BX.Landing.EditDomainForm(BX("ui-editable-domain"),{messages:{title:n.title||"",errorEmpty:n.errorEmpty||""},content:BX("ui-editable-domain-content")});BX.addCustomEvent(a.popup.popup,"onPopupShow",function(n){var a=n.contentContainer.querySelectorAll(".ui-domainname");var s=n.contentContainer.querySelector("#landing-form-domain-name-text");var o=n.contentContainer.querySelector("#landing-form-domain-any-name-text");var l=n.contentContainer.querySelectorAll(".ui-radio");var r=BX("action_dialog_confirm");var d=function(e){c(e.target.value,e.target)};var c=function(n,a){var d=n;var c=BX.data(a,"postfix");var u=function(e){var t=e.split(".");var i=/^(com|net|org)\.[a-z]{2}$/;o.parentNode.style.display="none";s.textContent=e?e:"landing.mydomain";if(t.length===2||t.length===3&&t[0]==="www"||t.length===3&&(t[1]+"."+t[2]).match(i)){o.parentNode.style.display="table-row";if(t.length===3&&t[0]==="www"){o.textContent=t[1]+"."+t[2]}else{s.textContent="www."+e;o.textContent=e}}s.textContent=BX.util.trim(s.textContent)+".";o.textContent=BX.util.trim(o.textContent)+"."};BX.ajax({url:"/bitrix/tools/landing/ajax.php?action=Domain::check",method:"POST",data:{data:{domain:d+c,filter:{"!ID":e.domainId}},sessid:BX.message("bitrix_sessid")},dataType:"json",onsuccess:function(e){if(e.result&&e.result.domain){u(e.result.domain)}t=e.result.available;i=e.result.deleted;for(var n=0,a=l.length;n<a;n++){if(l[n].checked){var s=l[n].nextElementSibling.querySelector(".ui-domainname");var o=l[n].nextElementSibling.querySelector(".landing-site-name-status");var d=s.getAttribute("maxlength");var c=e.result.domain.length;if(l[n].getAttribute("id")==="landing-domain-name-1"){var f=s.value;if(!(f==="")&&!/^[\w_\-]+$/.test(f)){B(s);o.textContent=BX.message("LANDING_DOMAIN_INCORRECT");return}else{X(s);o.textContent=""}}if(c>=d&&d!==null){B(s);o.textContent=BX.message("LANDING_DOMAIN_LIMIT_LENGTH")}else{r.classList.remove("btn-disabled");if(s.classList.contains("ui-domainname-unavailable")){s.classList.remove("ui-domainname-unavailable");o.textContent=""}b(t,i,s,o)}}}}})};for(var u=0,f=a.length;u<f;u++){var h=a[u];h.addEventListener("keyup",BX.debounce(d.bind(this),300));h.addEventListener("focus",function(e){e.target.parentNode.previousElementSibling.checked=true;var t=e.target.parentNode.querySelector(".landing-site-name-status");p(e.target,t)})}for(var m=0,g=l.length;m<g;m++){l[m].addEventListener("click",function(e){var t=e.target.nextElementSibling.querySelector(".ui-domainname");var i=e.target.nextElementSibling.querySelector(".landing-site-name-status");p(t,i)})}var p=function(e,n){v();t=null;i=null;c(e.value,e);if(t!==null&&i!==null){b(t,i,e,n)}};var b=function(e,t,i,n){if(e){i.classList.add("ui-domainname-available");X(i);n.textContent=""}else{if(t){n.textContent=BX.message("LANDING_DOMAIN_EXIST2")}else{n.textContent=BX.message("LANDING_DOMAIN_EXIST")}B(i);i.classList.remove("ui-domainname-available")}};var v=function(){for(var e=0,t=l.length;e<t;e++){if(!l[e].checked){var i=l[e].nextElementSibling.querySelector(".ui-domainname");var n=l[e].nextElementSibling.querySelector(".landing-site-name-status");y(i,n)}}};var y=function(e,t){e.classList.remove("ui-domainname-available");e.classList.remove("ui-domainname-unavailable");t.textContent=""};var B=function(e){e.classList.add("ui-domainname-unavailable");r.classList.add("btn-disabled")};var X=function(e){e.classList.remove("ui-domainname-unavailable");r.classList.remove("btn-disabled")};BX.fireEvent(h,"keyup");var k=n.contentContainer.querySelectorAll("input.ui-domainname");for(var u=0;u<k.length;u++){BX.bind(k[u],"focus",function(){this.parentNode.parentNode.querySelector("input").checked=true})}})};BX.Landing.Favicon=function(){var e=BX("landing-form-favicon-change");var t=BX("landing-form-favicon-input");var i=BX("landing-form-favicon-value");var n=BX("landing-form-favicon-form");var a=BX("landing-form-favicon-src");var s=BX("landing-form-favicon-error");if(!n||!t||!e){return}BX.bind(e,"click",function(e){BX.fireEvent(t,"click");BX.PreventDefault(e)});BX.bind(t,"change",function(e){BX.ajax.submitAjax(n,{method:"POST",dataType:"json",onsuccess:function(e){if(e.type==="success"&&typeof e.result!=="undefined"&&e.result!==false){i.value=e.result.id;a.setAttribute("src",e.result.src)}else{s.style.color="red"}}});BX.PreventDefault(e)})};BX.Landing.Custom404=function(){var e=BX("landing-form-404-select");BX.bind(e,"change",function(){if(this.value===""){this.parentNode.style.height=getComputedStyle(this.parentNode).height;BX("checkbox-404-use").checked=false}});BX.bind(BX("checkbox-404-use"),"change",function(){if(!this.checked){e.value=""}})};BX.Landing.Custom503=function(){var e=BX("landing-form-503-select");BX.bind(e,"change",function(){if(this.value===""){this.parentNode.style.height=getComputedStyle(this.parentNode).height;BX("checkbox-503-use").checked=false}});BX.bind(BX("checkbox-503-use"),"change",function(){if(!this.checked){e.value=""}})};BX.Landing.Copyright=function(){BX.bind(BX("checkbox-copyright"),"change",function(){var e=BX("landing-site-set-form").getAttribute("action");e=e.replace(/&feature_copyright=[YN]/,"");e+="&feature_copyright="+(this.checked?"Y":"N");BX("landing-site-set-form").setAttribute("action",e)})};BX.Landing.Layout=function(e){var t=document.querySelector(".landing-form-layout-block-container");var i=[];var n=document.querySelectorAll(".landing-form-layout-item");var a=document.querySelector(".landing-form-layout-detail");var s=document.querySelector(".landing-form-page-layout");n=Array.prototype.slice.call(n,0);e.messages=e.messages||{};d(n[0].dataset.block);n.forEach(function(e){e.addEventListener("click",o.bind(this))});function o(e){var t=e.target.parentNode;var i=document.querySelector(".landing-form-layout-item-selected");if(i){i.classList.remove("landing-form-layout-item-selected")}l(t.dataset.block,t.dataset.layout)}function l(e,t){s.classList.remove("landing-form-page-layout-short");a.classList.remove("landing-form-layout-detail-hidden");d(e);if(typeof t!=="undefined"){r(t)}BX("layout-tplrefs").value=""}if(typeof e.areasCount!=="undefined"){l(e.areasCount,e.current)}function r(e){var t=document.querySelectorAll(".landing-form-layout-img");for(var i=0;i<t.length;i++){if(t[i].dataset.layout===e){t[i].style.display="block"}else{t[i].style.display="none"}}}function d(n){var a=BX("layout-tplrefs").value.split(",");i=[];t.innerHTML="";for(var s=0;s<n;s++){var o=BX.create("div",{attrs:{className:"landing-form-layout-block-item"}});var l=s+1;var r="";if(typeof a[s]!=="undefined"&&a[s].indexOf(":")!==-1){r=parseInt(a[s].split(":")[1]);if(r>0){r="#landing"+r}else{r=""}}var d=new BX.Landing.UI.Field.LinkURL({title:e.messages.area+" #"+l,content:r,textOnly:true,disableCustomURL:true,disableBlocks:true,disallowType:true,enableAreas:true,allowedTypes:[BX.Landing.UI.Field.LinkURL.TYPE_PAGE],options:{siteId:e.siteId,landingId:e.landingId,filter:{"=TYPE":e.type}},onInput:function(){var e="";for(var t=0,n=i.length;t<n;t++){e+=t+1+":"+(i[t].getValue()?i[t].getValue().substr(8):0)+","}BX("layout-tplrefs").value=e}});i[s]=d;o.appendChild(d.layout);t.appendChild(o)}}var c=BX("layout-tplrefs-check");c.addEventListener("click",u.bind(this));function u(){BX("layout-tplrefs").value="";a.classList.add("landing-form-layout-detail--hidden");s.classList.add("landing-form-page-layout-short");var e=document.querySelectorAll(".layout-switcher");e=Array.prototype.slice.call(e,0);e.forEach(function(e){e.checked=false})}var f=document.querySelector(".landing-form-select-buttons");var h=document.querySelector(".landing-form-list-inner");var m=BX("layout-radio-6");f.addEventListener("click",g.bind(this));function g(e){if(e.target.classList.contains("landing-form-select-next")){h.classList.add("landing-form-list-inner-prev")}else{h.classList.remove("landing-form-list-inner-prev")}}if(m.checked){h.classList.add("landing-form-list-inner-prev")}};BX.Landing.Metrika=function(){var e=BX("field-gacounter_counter-use");var t=BX("field-gacounter_send_click-use");var i=BX("field-gacounter_send_show-use");if(e.value===""){t.disabled=true;i.disabled=true}e.addEventListener("input",n.bind(this));function n(){if(e.value===""){t.disabled=true;t.checked=false;i.disabled=true;i.checked=false}else{t.disabled=false;i.disabled=false}}};BX.Landing.SaveBtn=function(e){e.addEventListener("click",t.bind(this));function t(){e.classList.add("ui-btn-clock");e.style.cursor="default";e.style.pointerEvents="none"}};BX.Landing.IblockSelect=function(){this.section=BX("row_section_id");this.init(this.section)};BX.Landing.IblockSelect.prototype={init:function(e){if(!BX("settings_iblock_id").value){e.classList.add("landing-form-field-section-hidden")}else{e.classList.remove("landing-form-field-section-hidden")}}}})();
//# sourceMappingURL=landing-forms.map.js