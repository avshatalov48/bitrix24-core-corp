(function(){"use strict";BX.namespace("BX.Landing.Component.View");BX.Landing.Component.View=function(n){};BX.Landing.Component.View.instance=null;BX.Landing.Component.View.getInstance=function(){return BX.Landing.Component.View.instance};BX.Landing.Component.View.create=function(n,i){n.topInit=i===true;BX.Landing.Component.View.instance=new BX.Landing.Component.View(n);BX.Landing.Component.View.instance.setNewOptions(n);BX.Landing.Component.View.instance.init();return BX.Landing.Component.View.instance};BX.Landing.Component.View.prototype={setNewOptions:function(n){this.type=n.type||"";this.title=n.title||"";this.url=n.url||"";this.formEditor=n.specialType==="crm_forms";this.topInit=n.topInit||false;this.active=n.active||false;this.draftMode=n.draftMode||false;this.id=n.id||0;this.siteId=n.siteId||0;this.pagesCount=n.pagesCount||0;this.siteTitle=n.siteTitle||"";this.storeEnabled=n.storeEnabled||false;this.fullPublication=n.fullPublication||false;this.urls=n.urls||{};this.rights=n.rights||{};this.sliderConditions=n.sliderConditions||[];if(!this.popupMenuIds){this.popupMenuIds=[]}if(!this.placements){this.placements=n.placements||[]}for(var i=0,e=this.popupMenuIds.length;i<e;i++){var t=BX.PopupMenu.getMenuById(this.popupMenuIds[i]);if(t){t.destroy()}}this.popupMenuIds=[]},init:function(){var n=BX.Landing.Component.View.getInstance();if(typeof BX.rest!=="undefined"&&typeof BX.rest.Marketplace!=="undefined"){BX.rest.Marketplace.bindPageAnchors({})}BX.addCustomEvent(window,"Rest:AppLayout:ApplicationInstall",function(n){if(n){}});if(this.topInit){BX.addCustomEvent("SidePanel.Slider:onMessage",function(n){if(n.getEventId()==="landingEditClose"){setTimeout(function(){window.location.reload()},1e3)}})}if(!this.topInit){BX.addCustomEvent("BX.Landing.Block:init",function(i){if(i.data.requiredUserActionIsShown){BX.bind(i.data.button,"click",function(){n.onRequiredLinkClick(this)})}});var i=[].slice.call(document.querySelectorAll(".landing-required-link"));i.forEach(function(i,e){BX.bind(i,"click",function(){n.onRequiredLinkClick(this)})})}if(this.topInit){var e=BX.Landing.PageObject.getEditorWindow();var t=BX.Landing.PageObject.getRootWindow();e.addEventListener("load",function(){BX.Landing.UI.Panel.StylePanel.getInstance();t.BX.Landing.UI.Panel.Top.instance=null;BX.Landing.UI.Panel.Top.getInstance()});e.addEventListener("click",function(){this.closeAllPopupsMenu()}.bind(this));e.addEventListener("resize",BX.debounce(function(){this.closeAllPopupsMenu()}.bind(this),200))}if(this.topInit){this.buildTop();this.initSliders();this.loadEditor();this.hideEditorsPanelHandlers()}},initSliders:function(){if(typeof BX.SidePanel==="undefined"){return}var n=[];for(var i=0,e=this.sliderConditions.length;i<e;i++){n.push(this.sliderConditions[i])}if(n.length<=0){return}var t=top.BX.clone({rules:[{condition:n,stopParameters:["action","fields%5Bdelete%5D","nav"],options:{allowChangeHistory:false}}]});BX.SidePanel.Instance.bindAnchors(t)},loadEditor:function(){var n=document.querySelector(".landing-editor-loader-container");var i=document.querySelector(".landing-editor-required-user-action");if(n){var e=new BX.Loader({offset:{top:"-70px"}});e.show(n);BX.Landing.PageObject.getInstance().view().then(function(e){BX.bindOnce(e,"load",function(){var t=BX.Landing.Main.getInstance().options.requiredUserAction;if(BX.Landing.Utils.isPlainObject(t)&&!BX.Landing.Utils.isEmpty(t)){if(t.header){i.querySelector("h3").innerText=t.header}if(t.description){i.querySelector("p").innerText=t.description}if(t.href){i.querySelector("a").setAttribute("href",t.href)}if(t.text){i.querySelector("a").innerText=t.text}i.classList.add("landing-ui-user-action-show");document.querySelector(".landing-ui-panel-top-history").classList.add("landing-ui-disabled");document.querySelector(".landing-ui-panel-top-devices").classList.add("landing-ui-disabled");document.querySelector(".landing-ui-panel-top-chain-link.landing-ui-panel-top-menu-link-settings").classList.add("landing-ui-disabled");[].slice.call(document.querySelectorAll(".landing-ui-panel-top-menu-link:not(.landing-ui-panel-top-menu-link-help)")).forEach(function(n){n.classList.add("landing-ui-disabled")})}else{e.classList.add("landing-ui-view-show")}setTimeout(function(){BX.remove(n);BX.remove(i)},200)})})}},hideEditorsPanelHandlers:function(){BX.Landing.PageObject.getInstance().top().then(function(n){n.addEventListener("click",function(){BX.Landing.PageObject.getInstance().view().then(function(n){if(n.contentWindow.BX){if(n.contentWindow.BX.Landing.Block.Node.Text.currentNode){n.contentWindow.BX.Landing.Block.Node.Text.currentNode.disableEdit()}if(n.contentWindow.BX.Landing.UI.Field.BaseField.currentField){n.contentWindow.BX.Landing.UI.Field.BaseField.currentField.disableEdit()}n.contentWindow.BX.Landing.UI.Panel.EditorPanel.getInstance().hide()}})})})},onRequiredLinkClick:function(n){var i=n.getAttribute("href");if(i.substr(0,1)!=="#"){window.open(i,"_top")}var e=i.substr(1);var t={};var a="";if(e.indexOf("@")>0){a=e.split("@")[1];e=e.split("@")[0]}e=e.toUpperCase();if(e==="PAGE_URL_CATALOG_EDIT"){e="PAGE_URL_SITE_EDIT";t.tpl="catalog"}if(typeof landingParams[e]!=="undefined"&&typeof BX.SidePanel!=="undefined"){BX.SidePanel.Instance.open(BX.util.add_url_param(landingParams[e],t)+(a?"#"+a:""),{allowChangeHistory:false})}},publicationDialog:function(n){return;var i=new BX.Landing.Dialog.Publication.getInstance({landingId:this.id,siteId:this.siteId,url:this.url});i.publication(n!=="landing"?"site":"landing");BX.PreventDefault()},buildTop:function(n){n=n||{};for(var i in this.urls){var e=BX("landing-urls-"+i);if(e){e.setAttribute("href",this.urls[i])}}var t=[].slice.call(document.querySelectorAll(".landing-ui-panel-top-menu-link-settings"));t.forEach(function(n,i){n.addEventListener("click",function(){this.onSettingsClick(i,n)}.bind(this))}.bind(this));if(BX("landing-publication")){BX("landing-publication").setAttribute("href",this.fullPublication?this.urls["publicationAll"]:this.urls["publication"]);if(!this.rights.public){BX.addClass(BX("landing-publication").parentNode,"ui-btn-disabled")}else{BX.removeClass(BX("landing-publication").parentNode,"ui-btn-disabled")}if(BX("landing-publication-submenu")){BX("landing-publication-submenu").addEventListener("click",function(){var n=BX("landing-publication-submenu");if(!BX.hasClass(n.parentNode,"ui-btn-disabled")){this.onSubPublicationClick(n)}}.bind(this))}BX("landing-publication").addEventListener("click",function(){if(BX.hasClass(BX("landing-publication").parentNode,"ui-btn-disabled")){BX.PreventDefault()}else{this.publicationDialog("landing")}}.bind(this))}if(BX("landing-urls-preview")){BX("landing-urls-preview").addEventListener("click",function(){if(BX("landing-urls-preview").getAttribute("target")==="_self"){BX.SidePanel.Instance.open(BX("landing-urls-preview").getAttribute("href")+"&IFRAME=Y",{allowChangeHistory:false});BX.PreventDefault()}}.bind(this))}},onSubPublicationClick:function(n){if(BX.PopupMenu.getMenuById("landing-menu-publication")){var i=BX.PopupMenu.getMenuById("landing-menu-publication")}else{this.popupMenuIds.push("landing-menu-publication");var i=BX.Main.MenuManager.create({id:"landing-menu-publication",bindElement:n,autoHide:true,zIndex:1200,offsetLeft:20,angle:true,closeByEsc:true,items:[{href:this.urls["publication"],text:BX.message("LANDING_TPL_PUBLIC_URL_PAGE"),target:"_blank",dataset:{sliderIgnoreAutobinding:true},onclick:function(){this.publicationDialog("landing")}.bind(this)},{href:this.urls["publicationAll"],text:BX.message("LANDING_TPL_PUBLIC_URL_ALL"),target:"_blank",dataset:{sliderIgnoreAutobinding:true},onclick:function(){this.publicationDialog("site")}.bind(this)}]})}i.show()},onSettingsClick:function(n,i){if(BX.PopupMenu.getMenuById("landing-menu-settings"+n)){var e=BX.PopupMenu.getMenuById("landing-menu-settings"+n)}else{this.popupMenuIds.push("landing-menu-settings"+n);var t=[{href:this.urls["landingEdit"],text:BX.message("LANDING_TPL_SETTINGS_PAGE_URL"),disabled:!this.rights.settings},!this.formEditor?{href:this.urls["landingSiteEdit"],text:BX.message("LANDING_TPL_SETTINGS_SITE_URL"),disabled:!this.rights.settings}:null,this.storeEnabled?{href:this.urls["landingCatalogEdit"],text:BX.message("LANDING_TPL_SETTINGS_CATALOG_URL"),disabled:!this.rights.settings}:null,!this.draftMode&&!this.formEditor?{href:this.urls["unpublic"],text:BX.message("LANDING_TPL_SETTINGS_UNPUBLIC"),disabled:!this.rights.public||!this.active}:null];var a=this;for(var s=0,o=this.placements.length;s<o;s++){var l=this.placements[s];t.push({text:BX.util.htmlspecialchars(l.TITLE),onclick:function(){BX.rest.AppLayout.openApplication(this.APP_ID,{SITE_ID:a.siteId,LID:a.id},{PLACEMENT:this.PLACEMENT,PLACEMENT_ID:this.ID})}.bind(l,a)})}var e=BX.Main.MenuManager.create({id:"landing-menu-settings"+n,bindElement:BX("landing-panel-settings"),autoHide:true,zIndex:1200,offsetLeft:20,angle:true,closeByEsc:true,items:t})}e.show()},closeAllPopupsMenu:function(){this.popupMenuIds.forEach(function(n){var i=BX.PopupMenu.getMenuById(n);if(i){i.close()}})}};BX.Landing.Component.View.changeTop=function(n,i){i=i||{};if(typeof i.changeState==="undefined"){i.changeState=true}BX.ajax({url:BX.util.add_url_param(window.location.href,{action:"changeTop"}),method:"POST",data:{param:n,sessid:BX.message("bitrix_sessid"),actionType:"json"},dataType:"json",onsuccess:function(n){BX.Landing.Component.View.instance.closeAllPopupsMenu();BX.Landing.Component.View.instance.setNewOptions(n);BX.Landing.Component.View.instance.buildTop({changeState:i.changeState})}})}})();var landingAlertMessage=function n(i,e,t){if(e===true&&t==="PUBLIC_SITE_REACHED"){(function(){if(landingSiteType==="STORE"){top.BX.UI.InfoHelper.show("limit_shop_number")}else{top.BX.UI.InfoHelper.show("limit_sites_number")}})()}else if(e===true&&typeof BX.Landing.PaymentAlertShow!=="undefined"){BX.Landing.PaymentAlertShow({message:i})}else{var a=BX.Landing.UI.Tool.ActionDialog.getInstance();a.show({content:i,confirm:"OK",contentColor:"grey",type:"alert"})}};
//# sourceMappingURL=script.map.js