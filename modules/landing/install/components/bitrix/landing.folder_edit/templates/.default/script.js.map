{"version":3,"file":"script.js","sources":["src/js/index.js"],"sourcesContent":["import { Event, Dom } from 'main.core';\n\ntype FolderEditOptions = {\n\tsiteId: number,\n\tsiteType: string,\n\tfolderId: number,\n\tselectorCreateIndex: ?HTMLElement,\n\tselectorIndexMetaBlock: HTMLElement,\n\tselectorSelect: HTMLElement,\n\tselectorPageLink: HTMLElement,\n\tselectorFieldId: HTMLElement,\n\tselectorPreviewBlock: HTMLElement,\n\tselectorPreviewTitle: HTMLElement,\n\tselectorPreviewDescription: HTMLElement,\n\tselectorPreviewPicture: HTMLElement,\n\tselectorPreviewSrcPicture: HTMLElement,\n\tselectorPreviewPictureWrapper: HTMLElement,\n\tpathToLandingEdit: string,\n\tpathToLandingCreate: string\n};\n\nexport class FolderEdit\n{\n\t#siteId: number;\n\t#siteType: string;\n\t#folderId: number;\n\t#selectorCreateIndex: ?HTMLElement;\n\t#selectorIndexMetaBlock: HTMLElement;\n\t#selectorSelect: HTMLElement;\n\t#selectorPageLink: HTMLElement;\n\t#selectorFieldId: HTMLElement;\n\t#selectorPreviewBlock: HTMLElement;\n\t#selectorPreviewTitle: HTMLElement;\n\t#selectorPreviewDescription: HTMLElement;\n\t#selectorPreviewPicture: HTMLElement;\n\t#selectorPreviewSrcPicture: HTMLElement;\n\t#selectorPreviewPictureWrapper: HTMLElement;\n\t#pathToLandingEdit: string;\n\t#pathToLandingCreate: string;\n\t#linkUrlSelector: BX.Landing.UI.Field.LinkURL;\n\t#linkPictureSelector: BX.Landing.UI.Field.Image;\n\t#ajaxPathLoadPreview: string = '/bitrix/services/main/ajax.php?action=landing.api.landing.getById&landingId=#id#';\n\n\tconstructor(options: FolderEditOptions)\n\t{\n\t\tthis.#siteId = options.siteId;\n\t\tthis.#siteType = options.siteType;\n\t\tthis.#folderId = options.folderId;\n\t\tthis.#selectorCreateIndex = options.selectorCreateIndex;\n\t\tthis.#selectorIndexMetaBlock = options.selectorIndexMetaBlock;\n\t\tthis.#selectorSelect = options.selectorSelect;\n\t\tthis.#selectorPageLink = options.selectorPageLink;\n\t\tthis.#selectorFieldId = options.selectorFieldId;\n\t\tthis.#selectorPreviewBlock = options.selectorPreviewBlock;\n\t\tthis.#selectorPreviewTitle = options.selectorPreviewTitle;\n\t\tthis.#selectorPreviewDescription = options.selectorPreviewDescription;\n\t\tthis.#selectorPreviewPicture = options.selectorPreviewPicture;\n\t\tthis.#selectorPreviewSrcPicture = options.selectorPreviewSrcPicture;\n\t\tthis.#selectorPreviewPictureWrapper = options.selectorPreviewPictureWrapper;\n\t\tthis.#pathToLandingEdit = options.pathToLandingEdit;\n\t\tthis.#pathToLandingCreate = options.pathToLandingCreate;\n\n\t\tthis.#initSelector();\n\t\tthis.#initPicture();\n\n\t\tEvent.bind(this.#selectorSelect, 'click', this.#onClickSelect.bind(this));\n\n\t\tif (this.#selectorCreateIndex)\n\t\t{\n\t\t\tEvent.bind(this.#selectorCreateIndex, 'click', this.#onClickIndexCreate.bind(this));\n\t\t}\n\t}\n\n\t#initSelector()\n\t{\n\t\tthis.#linkUrlSelector = new BX.Landing.UI.Field.LinkURL({\n\t\t\ttitle: null,\n\t\t\tcontent: null,\n\t\t\tallowedTypes: [\n\t\t\t\tBX.Landing.UI.Field.LinkURL.TYPE_PAGE\n\t\t\t],\n\t\t\toptions: {\n\t\t\t\tsiteId: this.#siteId,\n\t\t\t\tcurrentSiteOnly: true,\n\t\t\t\tdisableAddPage: true,\n\t\t\t\tlandingId: -1,\n\t\t\t\tfilter: {\n\t\t\t\t\t'ID': this.#siteId,\n\t\t\t\t\t'=TYPE': this.#siteType\n\t\t\t\t},\n\t\t\t\tfilterLanding: {\n\t\t\t\t\t'FOLDER_ID': this.#folderId\n\t\t\t\t}\n\t\t\t},\n\t\t\tonInput: this.#onSelect.bind(this)\n\t\t});\n\t}\n\n\t#initPicture()\n\t{\n\t\tif (!this.#selectorPreviewSrcPicture)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#linkPictureSelector = new BX.Landing.UI.Field.Image({\n\t\t\tid: 'folderPicture',\n\t\t\tdisableLink: true,\n\t\t\tdisableAltField: true,\n\t\t\tallowClear: true,\n\t\t\tcontent: {\n\t\t\t\tsrc: this.#selectorPreviewSrcPicture.getAttribute('value'),\n\t\t\t\tid: this.#selectorPreviewPicture.getAttribute('value')\n\t\t\t},\n\t\t\tuploadParams: {\n\t\t\t\taction: 'Site::uploadFile',\n\t\t\t\tid: this.#siteId\n\t\t\t},\n\t\t\tdimensions: {\n\t\t\t\twidth: 1200,\n\t\t\t\theight: 1200\n\t\t\t}\n\t\t});\n\n\t\tDom.clean(this.#selectorPreviewPictureWrapper);\n\t\tDom.append(this.#linkPictureSelector['layout'], this.#selectorPreviewPictureWrapper);\n\n\t\tthis.#linkPictureSelector['layout'].addEventListener('input', () => {\n\t\t\tconst file = this.#linkPictureSelector.getValue();\n\t\t\tthis.#selectorPreviewPicture.setAttribute(\n\t\t\t\t'value',\n\t\t\t\tfile['id2x']\n\t\t\t);\n\t\t});\n\t}\n\n\t#onSelect(title)\n\t{\n\t\tconst id = this.#linkUrlSelector.getValue().substr(8);\n\t\tconst path = this.#pathToLandingEdit.replace('#landing_edit#', id);\n\n\t\tthis.#selectorPageLink.text = title;\n\t\tthis.#selectorPageLink.setAttribute('href', path);\n\t\tthis.#selectorFieldId.setAttribute('value', id);\n\n\t\tthis.#loadPreview(id);\n\t}\n\n\t#onClickSelect()\n\t{\n\t\tthis.#linkUrlSelector.onSelectButtonClick();\n\t}\n\n\t#onClickIndexCreate(e)\n\t{\n\t\tBX.SidePanel.Instance.open(this.#pathToLandingCreate, {\n\t\t\tallowChangeHistory: false,\n\t\t\tevents: {\n\t\t\t\tonClose: function()\n\t\t\t\t{\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tBX.PreventDefault(e);\n\t}\n\n\t#loadPreview(landingId)\n\t{\n\t\tthis.#selectorPreviewBlock.style.display = 'block';\n\t\tthis.#selectorIndexMetaBlock.style.display = 'flex';\n\n\t\tBX.ajax({\n\t\t\turl: this.#ajaxPathLoadPreview.replace('#id#', landingId),\n\t\t\tmethod: 'GET',\n\t\t\tdataType: 'json',\n\t\t\tonsuccess: result => {\n\n\t\t\t\tconst data = result.data;\n\n\t\t\t\tif (!data['ADDITIONAL_FIELDS'])\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst title = data['ADDITIONAL_FIELDS']['METAOG_TITLE'] || data['TITLE'];\n\t\t\t\tconst description = data['ADDITIONAL_FIELDS']['METAOG_DESCRIPTION'] || data['DESCRIPTION'] || '';\n\n\t\t\t\tthis.#selectorPreviewTitle.setAttribute('value', title);\n\t\t\t\tthis.#selectorPreviewDescription.setAttribute('value', description);\n\t\t\t\tthis.#selectorPreviewPicture.setAttribute('value', '');\n\n\t\t\t\tthis.#selectorPreviewPicture.setAttribute(\n\t\t\t\t\t'value',\n\t\t\t\t\tdata['ADDITIONAL_FIELDS']['~METAOG_IMAGE'] || ''\n\t\t\t\t);\n\t\t\t\tthis.#selectorPreviewSrcPicture.setAttribute(\n\t\t\t\t\t'value',\n\t\t\t\t\tdata['ADDITIONAL_FIELDS']['METAOG_IMAGE'] || ''\n\t\t\t\t);\n\n\t\t\t\tthis.#linkPictureSelector.setValue({\n\t\t\t\t\tsrc: data['ADDITIONAL_FIELDS']['METAOG_IMAGE'] || '',\n\t\t\t\t\tid: data['ADDITIONAL_FIELDS']['~METAOG_IMAGE'] || -1\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}\n"],"names":["FolderEdit","options","siteId","siteType","folderId","selectorCreateIndex","selectorIndexMetaBlock","selectorSelect","selectorPageLink","selectorFieldId","selectorPreviewBlock","selectorPreviewTitle","selectorPreviewDescription","selectorPreviewPicture","selectorPreviewSrcPicture","selectorPreviewPictureWrapper","pathToLandingEdit","pathToLandingCreate","Event","bind","BX","Landing","UI","Field","LinkURL","title","content","allowedTypes","TYPE_PAGE","currentSiteOnly","disableAddPage","landingId","filter","filterLanding","onInput","Image","id","disableLink","disableAltField","allowClear","src","getAttribute","uploadParams","action","dimensions","width","height","Dom","clean","append","addEventListener","file","getValue","setAttribute","substr","path","replace","text","onSelectButtonClick","e","SidePanel","Instance","open","allowChangeHistory","events","onClose","window","location","reload","PreventDefault","style","display","ajax","url","method","dataType","onsuccess","result","data","description","setValue"],"mappings":"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"}