(function(){"use strict";BX.addCustomEvent("BX.Landing.Block:init",function(e){var r=e.makeRelativeSelector(".bitrix24forms");if(e.block.querySelectorAll(r).length>0){if(typeof window["landingForms"]=="undefined"){window["landingForms"]={}}window["landingForms"][e.block.id]=new o(r,e.block);window["landingForms"][e.block.id].initForm()}});BX.addCustomEvent("BX.Landing.Block:updateStyle",function(o){var e=o.makeRelativeSelector(".bitrix24forms");if(o.block.querySelectorAll(e).length>0){var r=window["landingForms"][o.block.id];if(typeof o.node!="undefined"&&typeof o.data!="undefined"&&typeof r!="undefined"){if(r.readFormStylesFromNode(o.node[0])){r.createFormOptions();r.onFormReloadWithDebounce()}}}});BX.addCustomEvent("BX.Landing.Block:Node:updateAttr",function(o){var e=o.makeRelativeSelector(".bitrix24forms");if(o.block.querySelectorAll(e).length>0){var r=window["landingForms"][o.block.id];if(typeof o.data!="undefined"&&typeof r!="undefined"){for(var t in o.data){t=t.replace("data-","");if(t==r.dataFormId){r.onFormRemove();r.initForm()}else if(t==r.dataAttributeShowHeader){if(Object.keys(r.formOptions).length>0){r.formOptions.css.content=r.matchShowHeader(r.formOptions.css.content)}r.onFormReload()}else if(t==r.dataAttributeUseStyle){r.createFormOptions();r.onFormReload()}}}}});BX.addCustomEvent("BX.Landing.Block:remove",function(o){var e=o.makeRelativeSelector(".bitrix24forms");if(document.querySelectorAll(e).length>0){var r=window["landingForms"][o.block.id];if(typeof r!="undefined"){r.onFormRemove()}delete window["landingForms"][o.block.id]}});var o=function(o,e){this.dataFormId="b24form";this.dataAttributeDomain="b24form-original-domain";this.dataAttributePrefix="data-form-style-";this.dataAttributeUseStyle="b24form-use-style";this.dataAttributeShowHeader="b24form-show-header";this.dataAttributeIsConnector="b24form-connector";this.hideHeaderString=".crm-webform-header-container{display:none;}";this.hideBitrixLogoString=".crm-webform-bottom-link{display:none}.crm-webform-bottom-logo-container{height:0;margin:0;}";this.additionalCssString=".content{min-height:170px;}"+".crm-webform-fieldset-footer{padding-bottom:0;}"+".crm-webform-body{padding-bottom:0;padding-top:0;}"+".content-wrap{padding-bottom:0;}"+".crm-webform-block.crm-webform-default{margin-bottom:0;}"+".calendar-resbook-webform-block-date-item-inner{transition: border-color ease-in-out 0.5s;}";this.block=e;this.selector=o;this.iframe=null;var r=BX.findChild(this.block,{attribute:"data-"+this.dataAttributeDomain},true,false);if(r&&this.isFormChosen()){this.domain=BX.data(r,this.dataAttributeDomain);this.initFormLoader(window,document,this.createFullDomain()+"/bitrix/js/crm/form_loader.js","b24form")}this.styleParams={"wrapper-padding":{params:["padding-top"]},bg:{params:["background-color","background-image"]},"bg-content":{params:["background-color"]},"bg-block":{params:["background-color"]},"bg-as-text":{params:["background-color"]},"light-bg":{params:["background-color"]},"main-bg":{params:["background-color"]},"main-bg-light":{params:["background-color"]},"main-border-color":{params:["border-top-color","border-bottom-color","border-left-color","border-right-color"]},"main-font-family":{params:["font-family"]},"main-font-color":{params:["color"]},"main-font-color-hover":{params:["color"]},"main-font-weight":{params:["font-weight"]},"second-font-color":{params:["color"]},"icon-font-color":{params:["color"]},"button-font-color":{params:["color"]},"header-font-size":{params:["font-size"]},"header-font-weight":{params:["font-weight"]},"header-text-font-size":{params:["font-size"]},"label-font-size":{params:["font-size"]},"border-block":{params:["border-top-color","border-bottom-color","border-left-color","border-right-color","border-top-style","border-bottom-style","border-left-style","border-right-style","border-top-width","border-bottom-width","border-left-width","border-right-width"]},"input-bg":{params:["background-color"]},"input-box-shadow":{params:["box-shadow"]},"input-select-bg":{params:["background-color"]},"input-bg-light":{params:["background-color"]},"input-bg-light2":{params:["background-color"]},"input-bg-light3":{params:["background-color"]},"gradient-box-shadow":{params:["box-shadow"]},"input-border":{params:["border-top-color","border-bottom-color","border-left-color","border-right-color","border-top-style","border-bottom-style","border-left-style","border-right-style","border-top-width","border-bottom-width","border-left-width","border-right-width","border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius"]},"input-border-radius":{params:["border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius"]},"input-border-color":{params:["border-top-color","border-bottom-color","border-left-color","border-right-color"]},"input-border-hover":{params:["border-top-color","border-bottom-color","border-left-color","border-right-color","border-top-style","border-bottom-style","border-left-style","border-right-style","border-top-width","border-bottom-width","border-left-width","border-right-width"]},"agreement-label-font-size":{params:["font-size"]}};this.styles={};this.selectors={".crm-webform-wrapper, .content-wrap":["wrapper-padding"],"body.crm-webform-iframe":["bg"],".content, .page-theme-transparent .content":["bg-content"],".crm-webform-block, .page-theme-transparent .crm-webform-block":["bg-block","border-block"],".crm-webform-header-container":["bg-block","border-block","main-font-family","main-font-color","main-font-weight","header-text-font-size"],".crm-webform-header-container h2":["main-font-color","bg-block"],".crm-webform-resourcebooking-wrap-live":["bg-block"],".crm-webform-field-resourcebooking .crm-webform-label-content":["bg-block"],".crm-webform-inner-header":["main-font-color","main-font-family"],".crm-webform-mini-cart-title, .crm-webform-mini-cart-services-container":["main-font-color","main-font-family"],".crm-webform-header":["main-font-family","header-font-weight","header-font-size"],".crm-webform-label":["main-font-family","label-font-weight","label-font-size","second-font-color"],"button.crm-webform-submit-button, .crm-webform-file-upload .crm-webform-file-button":["main-bg","main-font-family","button-font-color","input-border-radius"],".crm-webform-label-content, .crm-webform-file-text-field":["input-bg"],".crm-webform-input-label":["input-box-shadow"],".crm-webform-input, .crm-webform-file-text-field":["main-font-family","main-font-weight","input-border","main-font-color"],".crm-webform-icon":["input-border-color","second-font-color","icon-font-color"],".crm-webform-desktop-font-style a":["second-font-color"],".crm-webform-desktop-font-style a:hover":["main-font-color"],".crm-webform-input option":["main-font-family","input-select-bg","main-font-color"],".crm-webform-active .crm-webform-input, .crm-webform-active mark, .crm-webform-input:hover":["input-border-hover"],".crm-webform-checkbox-container:hover i":["main-border-color"],".crm-webform-checkbox-name":["main-font-family","second-font-color"],".crm-webform-input+i:after":["main-font-color-hover"],".crm-webform-agreement-modifier .crm-webform-checkbox-name":["agreement-label-font-size"],".calendar-resbook-webform-block-input-dropdown":["input-bg","input-border","main-font-color"],".calendar-resbook-webform-block-strip":["input-bg"],".calendar-resbook-webform-block-strip-date":["main-font-color"],".calendar-resbook-webform-block-strip-day":["second-font-color"],'.popup-window[id^="calendar_popup"], .popup-window[id^="calendar_popup"] .popup-window-content':["light-bg"],".calendar-resbook-webform-block-input-dropdown:hover":["input-border-hover"],".calendar-resbook-webform-block-input-dropdown::before":["bg-as-text"],".popup-window, .popup-window .popup-window-content":["input-bg-light"],".popup-window .menu-popup-item-text":["main-font-color"],".popup-window .menu-popup-item:hover, .popup-window .menu-item-selected":["input-bg-light2"],".popup-window .popup-window-content .menu-popup-item:hover .menu-popup-item-text":["main-font-color"],".calendar-resbook-webform-block-inner .calendar-resbook-webform-block-title":["second-font-color"],".calendar-resbook-webform-block-date-item-select .calendar-resbook-webform-block-date-item-inner":["main-bg"],".calendar-resbook-webform-block-date-item-inner":["input-bg","input-border"],".calendar-resbook-webform-block-date-item-inner:hover":["input-border-hover"],".calendar-resbook-webform-block-date-number":["main-font-color"],".calendar-resbook-webform-block-date-item-select .calendar-resbook-webform-block-date-number":["button-font-color"],".calendar-resbook-webform-block-date-item-select .calendar-resbook-webform-block-date-day":["button-font-color"],".calendar-resbook-webform-block-arrow":["input-bg-light3","gradient-box-shadow"],".calendar-resbook-webform-block-col-item-inner":["main-bg-light"],".calendar-resbook-webform-block-col-item-select .calendar-resbook-webform-block-col-item-inner":["main-bg","button-font-color"],".calendar-resbook-webform-block-col-time:first-child":["main-font-color"],".calendar-resbook-webform-block-col-item-select .calendar-resbook-webform-block-col-time:first-child":["button-font-color"],".calendar-resbook-webform-block-result-inner, .page-theme-image .calendar-resbook-webform-block-result-inner":["input-bg","main-border-color","main-font-color"],".calendar-resbook-webform-block-result-text":["second-font-color"]};this.formParams={};this.formOptions={}};o.prototype={isFormChosen:function(){var o=document.querySelectorAll(this.selector);if(o.length>0){for(var e=0,r=o.length;e<r;e++){if(BX.data(o[e],this.dataFormId)){return true}}}return false},initFormLoader:function(o,e,r,t){if(typeof o["Bitrix24FormLoaderInitialised"]=="undefined"||o["Bitrix24FormLoaderInitialised"]!=true){o["Bitrix24FormObject"]=t;o[t]=o[t]||function(){arguments[0].ref=r;(o[t].forms=o[t].forms||[]).push(arguments[0])};if(o[t]["forms"])return;var i=e.createElement("script");var a=1*new Date;i.async=1;i.src=r+"?"+a;var n=e.getElementsByTagName("script")[0];n.parentNode.insertBefore(i,n);o["Bitrix24FormLoaderInitialised"]=true}},initForm:function(){if(!this.isFormChosen()){this.createNoFormMessage();return}if(!this.domain){this.createErrorDomainMessage();return}this.createFormParams();BX.addCustomEvent("onFormFrameLoad",BX.proxy(this.onFormFrameLoad,this));this.addFormInLoader();if(typeof Bitrix24FormLoader!="undefined"){if(typeof Bitrix24FormLoader.forms=="undefined"||Object.keys(Bitrix24FormLoader.forms).length==0){Bitrix24FormLoader.init()}else{Bitrix24FormLoader.preLoad(this.formParams)}}},createNoFormMessage:function(){var o=document.querySelector(this.selector);if(typeof BX.data(o,this.dataAttributeIsConnector)!="undefined"&&BX.data(o,this.dataAttributeIsConnector)=="Y"){this.createErrorMessage(BX.message("LANDING_BLOCK_WEBFORM_NO_FORM"),BX.message("LANDING_BLOCK_WEBFORM_NO_FORM_BUS"))}else{this.createErrorMessage(BX.message("LANDING_BLOCK_WEBFORM_NO_FORM"),BX.message("LANDING_BLOCK_WEBFORM_NO_FORM_CP"))}},createErrorDomainMessage:function(){this.createErrorMessage()},createErrorMessage:function(o,e){if(BX.Landing.getMode()=="view"){return}if(o===undefined||o===null||!o){o=BX.message("LANDING_BLOCK_WEBFORM_ERROR")}if(e===undefined||e===null||!e){e=BX.message("LANDING_BLOCK_WEBFORM_CONNECT_SUPPORT")}var r=document.querySelector(this.selector);if(r){t="";if(o!=""){var t='<h2 class="u-form-alert-title"><i class="fa fa-exclamation-triangle g-mr-15"></i>'+o+'</h2><hr class="u-form-alert-divider">'}t+='<p class="u-form-alert-text">'+e+"</p>";var i=BX.create("div",{props:{className:"u-form-alert"},html:t});BX.adjust(r,{children:[i]})}},createFormParams:function(){var o=document.querySelectorAll(this.selector);if(o.length>0){for(var e=0,r=o.length;e<r;e++){var t=BX.data(o[e],this.dataFormId);var i=t.split("|");var a=window.location.search.match(new RegExp("user_lang"+"=([^&=]+)"));if(i.length===2){this.formParams={id:i[0],lang:a?a[1]:BX.message("LANGUAGE_ID"),sec:i[1],type:"inline"+"_"+this.block.id,node:o[e]};this.createFormOptions()}}}},addFormInLoader:function(){if(Object.keys(this.formParams).length!=0){b24form(this.formParams)}},removeFormFromLoader:function(){if(!window.Bitrix24FormObject||!window[window.Bitrix24FormObject])return;if(!window[window.Bitrix24FormObject].forms)return;window[window.Bitrix24FormObject].forms.forEach(function(o,e){if(o.id==this.formParams.id&&o.node==this.formParams.node&&o.sec==this.formParams.sec){delete window[window.Bitrix24FormObject].forms[e]}},this)},sendFrameMessage:function(o,e){if(!this.iframe){return}var r=0;if(typeof window.postMessage==="function"&&!r){if(typeof o!="object"){o={}}var t=(this.createFullDomain()+"/").match(/((http|https):\/\/[^\/]+?)\//)[1];o.domain=t;if(e===undefined){e=this.type+"_"+this.id}o.uniqueLoadId=e;this.iframe.contentWindow.postMessage(JSON.stringify(o),t)}},onFormFrameLoad:function(o,e){if(o.id==this.formParams.id&&o.sec==this.formParams.sec&&o.type==this.formParams.type){this.iframe=o.iframe;this.sendFrameMessage({options:this.formOptions},e)}},onFormRemove:function(){if(typeof Bitrix24FormLoader!="undefined"){Bitrix24FormLoader.unload(this.formParams)}this.removeFormFromLoader()},onFormReload:function(){if(typeof Bitrix24FormLoader!="undefined"){Bitrix24FormLoader.unload(this.formParams);Bitrix24FormLoader.preLoad(this.formParams)}},onFormReloadWithDebounce:function(){return BX.debounce(this.onFormReload(),1e3,this)},createFullDomain:function(){var o=this.domain;if(!this.domain.match(/(http|https):/)){o="https://"+this.domain}return o},createFormOptions:function(){if(this.isUsingCustomStyle()){var o=this.createFormOptionsCss();var e=this.createFormOptionsCssFiles();if(o.length>0||e.length>0){this.formOptions.css={content:o,file:e}}}else{this.formOptions.css={content:""}}this.formOptions.css.content=this.matchShowHeader(this.formOptions.css.content);this.formOptions.css.content=this.createHideBitrixLabelCss(this.formOptions.css.content);this.formOptions.css.content=this.createAdditionalCss(this.formOptions.css.content)},createFormOptionsCssFiles:function(){var o=[];o.push("https://fonts.googleapis.com/css?family=Ek+Mukta:400,600,700");o.push("https://fonts.googleapis.com/css?family=Roboto:300,400,500,700");return o},createFormOptionsCss:function(){if(Object.keys(this.styles).length==0)this.readFormStyles();var o="";for(var e in this.selectors){var r="";this.selectors[e].forEach(function(o){if(typeof this.styles[o]!="undefined"){for(var e in this.styles[o]){r+=this.styles[o][e].param+":"+this.styles[o][e].value+";"}}},this);if(r.length>0){o+=e+"{"+r+"}"}}return o},createHideBitrixLabelCss:function(o){o=typeof o=="undefined"?"":o;return o+this.hideBitrixLogoString},createAdditionalCss:function(o){o=typeof o=="undefined"?"":o;return o+this.additionalCssString},isUsingCustomStyle:function(){var o=BX.findChild(this.block,{attribute:"data-"+this.dataAttributeUseStyle},true,false);if(o&&typeof BX.data(o,this.dataAttributeUseStyle)!="undefined"&&BX.data(o,this.dataAttributeUseStyle)=="N"){return false}else{return true}},matchShowHeader:function(o){o=typeof o=="undefined"?"":o;var e=BX.findChild(this.block,{attribute:"data-"+this.dataAttributeShowHeader},true,false);if(e&&typeof BX.data(e,this.dataAttributeShowHeader)!="undefined"&&BX.data(e,this.dataAttributeShowHeader)=="N"){o+=this.hideHeaderString}else{o=o.replace(this.hideHeaderString,"")}return o},readNodeStyles:function(o,e){this.styleParams[e].params.forEach(BX.delegate(function(r){var t=BX.style(o,r);if(t){if(typeof this.styles[e]=="undefined"){this.styles[e]={}}this.styles[e][r]={param:r,value:t}}}),this)},readFormStyles:function(){for(var o in this.styleParams){var e=BX.findChild(this.block,{attribute:this.dataAttributePrefix+o},true,false);if(e){this.readNodeStyles(e,o)}}},readFormStylesFromNode:function(o){var e=false;var r=o.attributes;for(var t=0;t<r.length;t++){var i=r[t].name.replace(this.dataAttributePrefix,"");if(typeof this.styleParams[i]!=="undefined"){e=true;this.readNodeStyles(o,i)}}return e}}})();
//# sourceMappingURL=form_init.map.js