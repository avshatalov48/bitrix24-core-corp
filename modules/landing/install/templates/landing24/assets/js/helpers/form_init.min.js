(function(){"use strict";BX.namespace("BX.Landing");BX.Landing.EmbedForms=function(){this.forms=[]};BX.Landing.EmbedForms.prototype={add:function(t){var e=new BX.Landing.EmbedFormEntry(t);this.forms.push(e);e.load()},remove:function(t){var e=this.getFormByNode(t);if(e){e.unload();this.forms=this.forms.filter(function(t){return t!==e})}},reload:function(t){this.remove(t);this.add(t)},getFormByNode:function(t){var e=null;this.forms.forEach(function(r){if(t===r.getNode()){e=r;return true}});return e}};BX.Landing.EmbedFormEntry=function(t){this.node=t;this.formObject=null;var e=this.node.dataset.b24form;e=e.split("|");if(e.length!==3){return}this.id=e[0];this.sec=e[1];this.url=e[2];this.useStyle=this.node.dataset[BX.Landing.EmbedFormEntry.ATTR_USE_STYLE]==="Y";this.design=this.node.dataset[BX.Landing.EmbedFormEntry.ATTR_DESIGN]?JSON.parse(this.node.dataset[BX.Landing.EmbedFormEntry.ATTR_DESIGN]):{};this.primaryOpacityMatcher=new RegExp("--primary([\\da-fA-F]{2})")};BX.Landing.EmbedFormEntry.ATTR_FORM_ID="b24form";BX.Landing.EmbedFormEntry.ATTR_FORM_ID_STR="data-b24form";BX.Landing.EmbedFormEntry.ATTR_USE_STYLE="b24formUseStyle";BX.Landing.EmbedFormEntry.ATTR_USE_STYLE_STR="data-b24form-use-style";BX.Landing.EmbedFormEntry.ATTR_DESIGN="b24formDesign";BX.Landing.EmbedFormEntry.prototype={load:function(){this.node.innerHTML="";this.loadScript()},unload:function(){if(!b24form||!b24form.App||!this.formObject){return}b24form.App.remove(this.formObject.getId())},getNode:function(){return this.node},setFormObject:function(t){this.formObject=t},loadScript:function(){var t=BX.Landing.getMode()==="edit"?Date.now()/1e3|0:Date.now()/6e4|0;var e=document.createElement("script");e.setAttribute("data-b24-form","inline/"+this.id+"/"+this.sec);e.setAttribute("data-skip-moving","true");e.innerText="(function(w,d,u){"+"var s=d.createElement('script');s.async=true;s.src=u+'?'+("+t+");"+"var h=d.getElementsByTagName('script')[0];h.parentNode.insertBefore(s,h);"+"})(window,document,'"+this.url+"')";this.node.append(e)},onFormLoad:function(t){this.setFormObject(t);if(this.useStyle){this.formObject.adjust(this.getParams())}},getParams:function(){var t={design:{shadow:false}};var e=getComputedStyle(document.documentElement).getPropertyValue("--primary").trim();var r=this.design;for(var n in r.color){if(r.color[n]==="--primary"||r.color[n].match(this.primaryOpacityMatcher)!==null){r.color[n]=r.color[n].replace("--primary",e)}}t.design=Object.assign(t.design,r);return t}};var t=new BX.Landing.EmbedForms;window.addEventListener("b24:form:init",function(e){var r=t.getFormByNode(e.detail.object.node.parentElement);if(!!r&&e.detail.object){r.onFormLoad(e.detail.object)}});BX.addCustomEvent("BX.Landing.Block:init",function(e){var r=e.block.querySelector(e.makeRelativeSelector(".bitrix24forms"));if(r){t.add(r)}});BX.addCustomEvent("BX.Landing.Block:remove",function(e){var r=e.block.querySelector(e.makeRelativeSelector(".bitrix24forms"));if(r){t.remove(r)}});BX.addCustomEvent("BX.Landing.Block:Node:updateAttr",function(e){var r=e.block.querySelector(e.makeRelativeSelector(".bitrix24forms"));if(r){t.reload(r)}})})();
//# sourceMappingURL=form_init.map.js