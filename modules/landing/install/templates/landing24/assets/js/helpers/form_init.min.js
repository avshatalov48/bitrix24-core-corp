(function(){"use strict";BX.namespace("BX.Landing");BX.Landing.EmbedForms=function(){this.forms=[]};BX.Landing.EmbedForms.prototype={add:function(e){var t=new BX.Landing.EmbedFormEntry(e);this.forms.push(t);t.init()},remove:function(e){var t=this.getFormByNode(e);if(t){t.unload();this.forms=this.forms.filter(function(e){return e!==t})}},reload:function(e){this.remove(e);this.add(e)},getFormByNode:function(e){var t=null;this.forms.forEach(function(r){if(e===r.getNode()){t=r;return true}});return t}};BX.Landing.EmbedFormEntry=function(e){this.node=e;this.formObject=null;this.init()};BX.Landing.EmbedFormEntry.ATTR_FORM_ID="b24form";BX.Landing.EmbedFormEntry.ATTR_FORM_ID_STR="data-b24form";BX.Landing.EmbedFormEntry.ATTR_USE_STYLE="b24formUseStyle";BX.Landing.EmbedFormEntry.ATTR_USE_STYLE_STR="data-b24form-use-style";BX.Landing.EmbedFormEntry.ATTR_DESIGN="b24formDesign";BX.Landing.EmbedFormEntry.ATTR_IS_CONNECTOR="b24formConnector";BX.Landing.EmbedFormEntry.prototype={init:function(){var e=this.node.dataset.b24form;if(!e){this.showNoFormsMessage();return}e=e.split("|");if(e.length!==3){this.showNoFormsMessage();return}this.id=e[0];this.sec=e[1];this.url=e[2];this.useStyle=this.node.dataset[BX.Landing.EmbedFormEntry.ATTR_USE_STYLE]==="Y";this.design=this.node.dataset[BX.Landing.EmbedFormEntry.ATTR_DESIGN]?JSON.parse(this.node.dataset[BX.Landing.EmbedFormEntry.ATTR_DESIGN]):{};this.primaryOpacityMatcher=new RegExp("--primary([\\da-fA-F]{2})");this.load()},showNoFormsMessage:function(){var e=this.node.dataset[BX.Landing.EmbedFormEntry.ATTR_IS_CONNECTOR]&&this.node.dataset[BX.Landing.EmbedFormEntry.ATTR_IS_CONNECTOR]==="Y"?BX.message("LANDING_BLOCK_WEBFORM_NO_FORM_BUS_NEW"):BX.message("LANDING_BLOCK_WEBFORM_NO_FORM_CP");this.node.innerHTML=this.createErrorMessage(BX.message("LANDING_BLOCK_WEBFORM_NO_FORM"),e)},createErrorMessage:function(e,t){if(BX.Landing.getMode()==="view"){return}if(e===undefined||e===null||!e){e=BX.message("LANDING_BLOCK_WEBFORM_ERROR")}if(t===undefined||t===null||!t){t=BX.message("LANDING_BLOCK_WEBFORM_CONNECT_SUPPORT")}var r='<h2 class="u-form-alert-title"><i class="fa fa-exclamation-triangle g-mr-15"></i>'+e+'</h2><hr class="u-form-alert-divider">'+'<p class="u-form-alert-text">'+t+"</p>";return'<div class="u-form-alert">'+r+"</div>"},load:function(){this.node.innerHTML="";this.loadScript()},unload:function(){if(!b24form||!b24form.App||!this.formObject){return}b24form.App.remove(this.formObject.getId())},getNode:function(){return this.node},setFormObject:function(e){this.formObject=e},loadScript:function(){var e=BX.Landing.getMode()==="edit"?Date.now()/1e3|0:Date.now()/6e4|0;var t=document.createElement("script");t.setAttribute("data-b24-form","inline/"+this.id+"/"+this.sec);t.setAttribute("data-skip-moving","true");t.innerText="(function(w,d,u){"+"var s=d.createElement('script');s.async=true;s.src=u+'?'+("+e+");"+"var h=d.getElementsByTagName('script')[0];h.parentNode.insertBefore(s,h);"+"})(window,document,'"+this.url+"')";this.node.append(t)},onFormLoad:function(e){this.setFormObject(e);if(this.useStyle){this.formObject.adjust(this.getParams())}},getParams:function(){var e={design:{shadow:false}};var t=getComputedStyle(document.documentElement).getPropertyValue("--primary").trim();var r=this.design;for(var n in r.color){if(r.color[n]==="--primary"||r.color[n].match(this.primaryOpacityMatcher)!==null){r.color[n]=r.color[n].replace("--primary",t)}}e.design=Object.assign(e.design,r);return e}};var e=new BX.Landing.EmbedForms;window.addEventListener("b24:form:init",function(t){var r=e.getFormByNode(t.detail.object.node.parentElement);if(!!r&&t.detail.object){r.onFormLoad(t.detail.object)}});BX.addCustomEvent("BX.Landing.Block:init",function(t){var r=t.block.querySelector(t.makeRelativeSelector(".bitrix24forms"));if(r){e.add(r)}});BX.addCustomEvent("BX.Landing.Block:remove",function(t){var r=t.block.querySelector(t.makeRelativeSelector(".bitrix24forms"));if(r){e.remove(r)}});BX.addCustomEvent("BX.Landing.Block:Node:updateAttr",function(t){var r=t.block.querySelector(t.makeRelativeSelector(".bitrix24forms"));if(r){e.reload(r)}})})();
//# sourceMappingURL=form_init.map.js