{"version":3,"file":"history.bundle.js","sources":["../src/internal/constants.js","../src/action/edit-node.js","../src/action/edit-text.js","../src/action/edit-embed.js","../src/action/edit-map.js","../src/action/edit-image.js","../src/action/edit-icon.js","../src/action/edit-link.js","../src/action/change-node-name.js","../src/action/sort-block.js","../src/action/add-block.js","../src/action/remove-block.js","../src/action/add-card.js","../src/action/remove-card.js","../src/action/add-node.js","../src/action/remove-node.js","../src/action/edit-style.js","../src/action/update-content.js","../src/action/multiply.js","../src/history-command.js","../src/internal/register-base-commands.js","../src/internal/async-json-parse.js","../src/internal/async-json-stringify.js","../src/internal/remove-page-history.js","../src/internal/load-stack.js","../src/internal/fetch-entities.js","../src/internal/remove-entities.js","../src/internal/clear.js","../src/internal/on-update.js","../src/internal/on-init.js","../src/history-entry.js","../src/history-highlight.js","../src/history.js"],"sourcesContent":["export const UNDO: string = 'undo';\nexport const REDO: string = 'redo';\nexport const INIT: string = 'init';\nexport const RESOLVED: string = 'resolved';\nexport const PENDING: string = 'pending';\nexport const MAX_ENTRIES_COUNT: number = 100;","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {object} entry\n * @return {Promise}\n */\nconst editNode = function (entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\tblock.forceInit();\n\t\t\tconst node = block.nodes.getBySelector(entry.selector);\n\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn scrollTo(node.node)\n\t\t\t\t.then(highlight.bind(null, node.node, editNode.useRangeRect))\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn node.setValue(entry.params.value, false, true);\n\t\t\t\t});\n\t\t});\n}\neditNode.useRangeRect = true;\n\nexport default editNode;","import editNode from './edit-node';\n\nconst editText = editNode;\n\nexport default editText;","import editNode from './edit-node';\n\nconst editEmbed = editNode;\n\nexport default editEmbed;","import editNode from './edit-node';\n\nconst editMap = editNode;\n\nexport default editMap;","import editNode from './edit-node';\n\nconst editImage = editNode;\neditImage.useRangeRect = false;\n\nexport default editImage;","import editImage from './edit-image';\n\nconst editIcon = editImage;\n\nexport default editIcon;","import editNode from './edit-node';\n\nconst editLink = editNode;\neditLink.useRangeRect = false;\n\nexport default editLink;","import {Type} from 'main.core';\n\nconst {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {object} entry\n * @return {Promise}\n */\nexport default function changeNodeName(entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\t\t\tblock.forceInit();\n\n\t\t\tconst node = block.nodes.getBySelector(entry.selector);\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn scrollTo(node.node)\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn highlight(node.node);\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (node.onChangeTag)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode.onChangeTag(entry.params.value, true);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {object} entry\n * @return {Promise}\n */\nexport default function sortBlock(entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tblock.forceInit();\n\n\t\t\treturn scrollTo(block.node)\n\t\t\t\t.then(highlight.bind(null, block.node))\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn block[entry.params.direction](true);\n\t\t\t\t});\n\t\t});\n}","import {PageObject} from 'landing.pageobject';\n\nconst {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {object} entry\n * @return {Promise}\n */\nexport default function addBlock(entry)\n{\n\treturn PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.params.currentBlock);\n\n\t\t\treturn new Promise(((resolve) => {\n\t\t\t\tif (block)\n\t\t\t\t{\n\t\t\t\t\tblock.forceInit();\n\t\t\t\t\treturn scrollTo(block.node)\n\t\t\t\t\t\t.then(highlight.bind(null, block.node, false, true))\n\t\t\t\t\t\t.then(resolve);\n\t\t\t\t}\n\n\t\t\t\tresolve();\n\t\t\t}))\n\t\t\t\t.then(() => {\n\t\t\t\t\tconst landing = BX.Landing.Main.getInstance();\n\t\t\t\t\tlanding.currentBlock = block;\n\n\t\t\t\t\treturn PageObject.getInstance().view().then((iframe) => {\n\t\t\t\t\t\tlanding.currentArea = iframe.contentDocument.body.querySelector(`[data-landing=\"${entry.params.lid}\"]`);\n\t\t\t\t\t\tlanding.insertBefore = entry.params.insertBefore;\n\n\t\t\t\t\t\treturn landing.onAddBlock(entry.params.code, entry.block, true);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {object} entry\n * @return {Promise}\n */\nexport default function removeBlock(entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tblock.forceInit();\n\n\t\t\treturn scrollTo(block.node)\n\t\t\t\t.then(() => {\n\t\t\t\t\thighlight(block.node);\n\t\t\t\t\treturn block.deleteBlock(true);\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function addCard(entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tif (block)\n\t\t\t{\n\t\t\t\tblock.forceInit();\n\t\t\t}\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn block;\n\t\t})\n\t\t.then((block) => {\n\t\t\treturn BX.Landing.PageObject.getInstance().view()\n\t\t\t\t.then((iframe) => {\n\t\t\t\t\tconst parentNode = iframe.contentDocument.querySelector(entry.params.selector).parentNode;\n\t\t\t\t\treturn [\n\t\t\t\t\t\tblock,\n\t\t\t\t\t\tparentNode,\n\t\t\t\t\t];\n\t\t\t\t});\n\t\t})\n\t\t.then((elements) => {\n\t\t\treturn scrollTo(elements[1])\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn elements;\n\t\t\t\t});\n\t\t})\n\t\t.then((elements) => {\n\t\t\tlet block = elements[0];\n\t\t\treturn block\n\t\t\t\t.addCard({\n\t\t\t\t\tindex: entry.params.position,\n\t\t\t\t\tcontainer: elements[1],\n\t\t\t\t\tcontent: entry.params.content,\n\t\t\t\t\tselector: entry.params.selector,\n\t\t\t\t}, true)\n\t\t\t\t.then(() => {\n\t\t\t\t\tconst card = block.cards.getBySelector(entry.params.selector);\n\t\t\t\t\tif (!card)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Promise.reject();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn highlight(card.node);\n\t\t\t\t})\n\t\t})\n\t\t.catch(() => {});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function removeCard(entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tblock.forceInit();\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\tconst relativeSelector = entry.params.selector + '@' + (entry.params.position + 1);\n\t\t\tconst card = block.cards.getBySelector(relativeSelector);\n\n\t\t\tif (!card)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn scrollTo(card.node)\n\t\t\t\t.then(highlight.bind(null, card.node))\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn block.removeCard(relativeSelector, true);\n\t\t\t\t});\n\t\t});\n}","/**\n * History entry action for add node.\n * @param {object} entry History entry.\n * @return {Promise}\n */\nexport default function addNode(entry)\n{\n\t// entry.block === null >> designer mode\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst tags = entry.params.tags || {};\n\t\ttop.BX.onCustomEvent(this, 'Landing:onHistoryAddNode', [tags]);\n\t\tresolve();\n\t});\n}","/**\n * History entry action for remove node.\n * @param {object} entry History entry.\n * @return {Promise}\n */\nexport default function removeNode(entry)\n{\n\t// entry.block === null >> designer mode\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst tags = entry.params.tags || {};\n\t\ttop.BX.onCustomEvent(this, 'Landing:onHistoryRemoveNode', [tags]);\n\t\tresolve();\n\t});\n}","const {scrollTo, slice} = BX.Landing.Utils;\n\n/**\n * @param {object} entry\n * @return {Promise}\n */\nexport default function editStyle(entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\tblock.forceInit();\n\t\t\tblock.initStyles();\n\t\t\treturn block;\n\t\t})\n\t\t.then((block) => {\n\t\t\treturn scrollTo(block.node)\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn block;\n\t\t\t\t});\n\t\t})\n\t\t.then((block) => {\n\t\t\tlet elements = slice(block.node.querySelectorAll(entry.selector));\n\n\t\t\tif (block.selector === entry.selector)\n\t\t\t{\n\t\t\t\telements = [block.content];\n\t\t\t}\n\n\t\t\telements.forEach((element) => {\n\t\t\t\telement.className = entry.params.value.className;\n\t\t\t\tif (entry.params.value.style && entry.params.value.style !== '')\n\t\t\t\t{\n\t\t\t\t\telement.style = entry.params.value.style;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\telement.removeAttribute('style');\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn block;\n\t\t})\n\t\t.then((block) => {\n\t\t\tconst form = block.forms.find((currentForm) => {\n\t\t\t\treturn (\n\t\t\t\t\tcurrentForm.selector === entry.selector\n\t\t\t\t\t|| currentForm.relativeSelector === entry.selector\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (form)\n\t\t\t{\n\t\t\t\tform.fields.forEach((field) => {\n\t\t\t\t\tfield.reset();\n\t\t\t\t\tfield.onFrameLoad();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// todo: relative selector? position?\n\t\t\tconst styleNode = block.styles.find((style) => {\n\t\t\t\treturn (\n\t\t\t\t\tstyle.selector === entry.selector\n\t\t\t\t\t|| style.relativeSelector === entry.selector\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (styleNode)\n\t\t\t{\n\t\t\t\tif (entry.params.affect && entry.params.affect.length > 0)\n\t\t\t\t{\n\t\t\t\t\tstyleNode.setAffects(entry.params.affect);\n\t\t\t\t}\n\t\t\t\tblock.onStyleInputWithDebounce({node: styleNode.node, data: styleNode.getValue()}, true);\n\t\t\t}\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {object} entry\n * @return {Promise}\n */\nexport default function updateContent(entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tblock.forceInit();\n\n\t\t\treturn scrollTo(block.node)\n\t\t\t\t.then(() => {\n\t\t\t\t\tvoid highlight(block.node);\n\t\t\t\t\treturn block.updateContent(entry.params.content, true);\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {object} entry\n * @return {Promise}\n */\nexport default function multiply(entry)\n{\n\tlet blockId = null;\n\tconst updateBlockStateData = {};\n\tentry.params.forEach(singleAction => {\n\t\tif (!blockId && singleAction.params.block)\n\t\t{\n\t\t\tblockId = singleAction.params.block;\n\t\t}\n\n\t\tif (\n\t\t\tsingleAction.command === 'editText'\n\t\t\t|| singleAction.command === 'editImage'\n\t\t\t|| singleAction.command === 'editEmbed'\n\t\t\t|| singleAction.command === 'editMap'\n\t\t\t|| singleAction.command === 'editIcon'\n\t\t\t|| singleAction.command === 'editLink'\n\t\t)\n\t\t{\n\t\t\tupdateBlockStateData[singleAction.params.selector] = singleAction.params.value;\n\t\t}\n\n\t\tif (singleAction.command === 'updateDynamic')\n\t\t{\n\t\t\tupdateBlockStateData.dynamicParams = singleAction.params.dynamicParams;\n\t\t\tupdateBlockStateData.dynamicState = singleAction.params.dynamicState;\n\t\t}\n\n\t\tif (singleAction.command === 'changeAnchor')\n\t\t{\n\t\t\tupdateBlockStateData.settings = {id: singleAction.params.value};\n\t\t}\n\t});\n\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(blockId);\n\t\t\tif (block)\n\t\t\t{\n\t\t\t\tblock.forceInit();\n\n\t\t\t\treturn scrollTo(block.node)\n\t\t\t\t\t.then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tvoid highlight(block.node);\n\t\t\t\t\t\tif (Object.keys(updateBlockStateData).length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblock.updateBlockState(updateBlockStateData, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t});\n}","import {Type} from 'main.core';\n\n/**\n * Implements interface for works with command of history\n * @param {{id: string, undo: function, redo: function}} options\n */\nexport default class Command\n{\n\tconstructor(options: {id: string, command: () => {}})\n\t{\n\t\tthis.id = Type.isStringFilled(options.id) ? options.id : '#invalidCommand';\n\t\tthis.command = Type.isFunction(options.command) ? options.command : (() => {});\n\t}\n}","import editText from '../action/edit-text';\nimport editEmbed from '../action/edit-embed';\nimport editMap from '../action/edit-map';\nimport editImage from '../action/edit-image';\nimport editIcon from '../action/edit-icon';\nimport editLink from '../action/edit-link';\nimport changeNodeName from '../action/change-node-name';\nimport sortBlock from '../action/sort-block';\nimport addBlock from '../action/add-block';\nimport removeBlock from '../action/remove-block';\nimport addCard from '../action/add-card';\nimport removeCard from '../action/remove-card';\nimport addNode from '../action/add-node';\nimport removeNode from '../action/remove-node';\nimport editStyle from '../action/edit-style';\nimport updateContent from '../action/update-content';\nimport multiply from '../action/multiply';\n\nimport Command from '../history-command';\n\nimport type {History} from '../history';\n\n/**\n * Registers base internal commands\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function registerBaseCommands(history: History)\n{\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editText',\n\t\t\tcommand: editText,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editImage',\n\t\t\tcommand: editImage,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editEmbed',\n\t\t\tcommand: editEmbed,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editMap',\n\t\t\tcommand: editMap,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editIcon',\n\t\t\tcommand: editIcon,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editLink',\n\t\t\tcommand: editLink,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'cnangeNodeName',\n\t\t\tcommand: changeNodeName,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'sortBlock',\n\t\t\tcommand: sortBlock,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'addBlock',\n\t\t\tcommand: addBlock,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'removeBlock',\n\t\t\tcommand: removeBlock,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'updateStyle',\n\t\t\tcommand: editStyle,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'addCard',\n\t\t\tcommand: addCard,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'removeCard',\n\t\t\tcommand: removeCard,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'addNode',\n\t\t\tcommand: addNode,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'removeNode',\n\t\t\tcommand: removeNode,\n\t\t}),\n\t);\n\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'updateContent',\n\t\t\tcommand: updateContent,\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'multiply',\n\t\t\tcommand: multiply,\n\t\t}),\n\t);\n\n\treturn Promise.resolve(history);\n}","const worker = new Worker(\n\t'/bitrix/js/landing/history/src/worker/json-parse-worker.js',\n);\n\n/**\n * Parses json string\n * @param {string} str\n * @return {Promise<?Object|array>}\n */\nexport default function asyncJsonParse(str): Promise<{[key: string]: any} | Array<any>>\n{\n\treturn new Promise(((resolve) => {\n\t\tworker.postMessage(str);\n\t\tworker.addEventListener('message', (event) => {\n\t\t\tresolve(event.data);\n\t\t});\n\t}));\n}\n","const worker = new Worker(\n\t'/bitrix/js/landing/history/src/worker/json-stringify-worker.js',\n);\n\n/**\n * Serializes object\n * @param {Object|array} obj\n * @return {Promise<?String>}\n */\nexport default function asyncJsonStringify(obj: {[key: string]: any} | Array<any>): Promise<?string>\n{\n\treturn new Promise(((resolve) => {\n\t\tworker.postMessage(obj);\n\t\tworker.addEventListener('message', (event) => {\n\t\t\tresolve(event.data);\n\t\t});\n\t}));\n}","import {Type} from 'main.core';\nimport asyncJsonParse from './async-json-parse';\nimport asyncJsonStringify from './async-json-stringify';\nimport type {History} from '../history';\n\n/**\n * Removes page history from storage\n * @param {int} pageId\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function removePageHistory(pageId, history: History): Promise<History>\n{\n\treturn asyncJsonParse(window.localStorage.history)\n\t\t.then((historyData) => {\n\t\t\treturn Type.isPlainObject(historyData) ? historyData : {};\n\t\t})\n\t\t.then((all) => {\n\t\t\tif (pageId in all)\n\t\t\t{\n\t\t\t\tdelete all[pageId];\n\t\t\t}\n\n\t\t\treturn all;\n\t\t})\n\t\t.then(asyncJsonStringify)\n\t\t.then((allString) => {\n\t\t\twindow.localStorage.history = allString;\n\t\t\treturn history;\n\t\t});\n}\n","import {Type, Text} from 'main.core';\nimport {Main} from 'landing.main';\nimport type {History} from '../history';\n\n/**\n * Loads history from storage\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function loadStack(history: History)\n{\n\tlet currentPageId;\n\n\ttry\n\t{\n\t\tcurrentPageId = Main.getInstance().id;\n\t}\n\tcatch (err)\n\t{\n\t\tcurrentPageId = -1;\n\t}\n\n\t// todo: if design - no?\n\n\treturn BX.Landing.Backend.getInstance()\n\t\t.action(\n\t\t\t\"History::getForLanding\",\n\t\t\t{lid: currentPageId},\n\t\t)\n\t\t.then((data: {stackCount: number, step: number}) => {\n\t\t\thistory.stack = Text.toNumber(data.stackCount);\n\t\t\thistory.step = Math.min(Text.toNumber(data.step), history.stack);\n\n\t\t\treturn history;\n\t\t})\n\t\t.catch((e) => {\n\t\t\treturn history;\n\t\t});\n}","/**\n * Fetches entities from entries\n * @param {BX.Landing.History.Entry[]} items\n * @return {Promise<any>}\n */\nexport default function fetchEntities(items): Promise<any>\n{\n\tconst entities = {blocks: [], images: []};\n\n\titems.forEach((item) => {\n\t\tif (item.command === 'addBlock')\n\t\t{\n\t\t\tentities.blocks.push(item.block);\n\t\t}\n\n\t\tif (item.command === 'editImage')\n\t\t{\n\t\t\tentities.images.push({block: item.block, id: item.redo.id});\n\t\t}\n\t});\n\n\treturn Promise.resolve(entities);\n}","import type {History} from '../history';\n\n/**\n * Makes request with removed entities\n * @param {{\n * \t\tblocks: int[],\n * \t\timages: {block: int, id: int}[]\n * \t}} entities\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function removeEntities(entities, history: History): Promise<History>\n{\n\t// if (entities.blocks.length || entities.images.length)\n\t// {\n\t// \treturn BX.Landing.Backend.getInstance().action(\"Landing::removeEntities\", {data: entities})\n\t// \t\t.then(function() {\n\t// \t\t\treturn onNewBranch(history);\n\t// \t\t})\n\t// \t\t.then(onUpdate);\n\t// }\n\n\treturn Promise.resolve(history);\n}","import {INIT, RESOLVED} from './constants';\nimport type {History} from '../history';\n\n/**\n * Clears history stack\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function clear(history: History): Promise<History>\n{\n\thistory.stack = [];\n \thistory.step = -1;\n\thistory.commandState = RESOLVED;\n\treturn Promise.resolve(history);\n}","import type {History} from '../history';\n\n/**\n * Calls on update history stack\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function onUpdate(history: History): Promise<History>\n{\n\tconst rootWindow = BX.Landing.PageObject.getRootWindow();\n\tBX.onCustomEvent(rootWindow.window, 'BX.Landing.History:update', [history]);\n\n\treturn Promise.resolve(history);\n}","import type {History} from '../history';\n\n/**\n * Calls on init history object\n * @param history\n * @return {Promise<History>}\n */\nexport default function onInit(history: History): Promise<History>\n{\n\tconst rootWindow = BX.Landing.PageObject.getRootWindow();\n\tBX.onCustomEvent(rootWindow.window, 'BX.Landing.History:init', [history]);\n\n\treturn Promise.resolve(history);\n}","import {Type} from 'main.core';\n\nexport default class Entry\n{\n\tconstructor(options)\n\t{\n\t\tthis.block = options.block;\n\t\tthis.selector = options.selector;\n\t\tthis.command = Type.isStringFilled(options.command) ? options.command : '#invalidCommand';\n\t\tthis.params = options.params;\n\t}\n}","import {PageObject} from 'landing.pageobject';\nimport {Highlight as HighlightNode} from 'landing.ui.highlight';\n\nexport default class Highlight extends HighlightNode\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.layout.classList.add('landing-ui-highlight-animation');\n\t\tthis.animationDuration = 300;\n\t}\n\n\tstatic getInstance()\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tif (!rootWindow.BX.Landing.History.Highlight.instance)\n\t\t{\n\t\t\trootWindow.BX.Landing.History.Highlight.instance = new Highlight();\n\t\t}\n\n\t\treturn rootWindow.BX.Landing.History.Highlight.instance;\n\t}\n\n\tshow(element, rect): Promise<any>\n\t{\n\t\tBX.Landing.UI.Highlight.prototype.show.call(this, element, rect);\n\n\t\treturn new Promise(((resolve) => {\n\t\t\tsetTimeout(resolve, this.animationDuration);\n\t\t\tthis.hide();\n\t\t}));\n\t}\n}","import {Event} from 'main.core';\nimport {PageObject} from 'landing.pageobject';\nimport {RESOLVED, PENDING} from './internal/constants';\nimport registerBaseCommands from './internal/register-base-commands';\nimport removePageHistory from './internal/remove-page-history';\nimport loadStack from './internal/load-stack';\nimport fetchEntities from './internal/fetch-entities';\nimport removeEntities from './internal/remove-entities';\nimport clear from './internal/clear';\nimport onUpdate from './internal/on-update';\nimport onInit from './internal/on-init';\nimport Command from './history-command';\nimport Entry from './history-entry';\nimport Highlight from './history-highlight';\nimport editText from './action/edit-text';\nimport editEmbed from './action/edit-embed';\nimport editMap from './action/edit-map';\nimport editImage from './action/edit-image';\nimport editIcon from './action/edit-icon';\nimport editLink from './action/edit-link';\nimport sortBlock from './action/sort-block';\nimport addBlock from './action/add-block';\nimport removeBlock from './action/remove-block';\nimport addCard from './action/add-card';\nimport removeCard from './action/remove-card';\nimport addNode from './action/add-node';\nimport removeNode from './action/remove-node';\nimport editStyle from './action/edit-style';\nimport updateContent from './action/update-content';\nimport {Main} from 'landing.main';\n\n/**\n * Implements interface for works with landing history\n * Implements singleton pattern use as BX.Landing.History.getInstance()\n * @memberOf BX.Landing\n */\nexport class History\n{\n\tstatic TYPE_LANDING = 'L';\n\tstatic TYPE_DESIGNER_BLOCK = 'D';\n\n\tstack: number;\n\tcommands: {};\n\t/**\n\t * From 1 to X. 0 - is state without any history\n\t * @type {number}\n\t */\n\tstep: number;\n\tcommandState: string;\n\tlandingId: number;\n\tdesignerBlockId: ?number = null;\n\n\tconstructor()\n\t{\n\t\tthis.type = History.TYPE_LANDING;\n\t\tthis.stack = 0;\n\t\tthis.commands = {};\n\t\tthis.step = 0;\n\t\tthis.commandState = RESOLVED;\n\t\tthis.onStorage = this.onStorage.bind(this);\n\n\t\ttry\n\t\t{\n\t\t\tthis.landingId = Main.getInstance().id;\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tthis.landingId = -1;\n\t\t}\n\n\t\tEvent.bind(window, 'storage', this.onStorage);\n\n\t\tregisterBaseCommands(this)\n\t\t\t.then(loadStack)\n\t\t\t.then(onInit);\n\t}\n\n\tstatic Command = Command;\n\tstatic Entry = Entry;\n\tstatic Highlight = Highlight;\n\t// todo: need?\n\t// static Action = {\n\t// \teditText,\n\t// \teditEmbed,\n\t// \teditMap,\n\t// \teditImage,\n\t// \teditIcon,\n\t// \teditLink,\n\t// \tsortBlock,\n\t// \taddBlock,\n\t// \tremoveBlock,\n\t// \taddCard,\n\t// \tremoveCard,\n\t// \teditStyle,\n\t// \taddNode,\n\t// \tremoveNode,\n\t// \tupdateContent\n\t// };\n\n\tstatic getInstance(): History\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tif (!rootWindow.BX.Landing.History.instance)\n\t\t{\n\t\t\trootWindow.BX.Landing.History.instance = new BX.Landing.History();\n\t\t}\n\n\t\treturn rootWindow.BX.Landing.History.instance;\n\t}\n\n\t/**\n\t * Set special type for designer block\n\t * @param blockId\n\t * @return {Promise<BX.Landing.History>|*}\n\t */\n\tsetTypeDesignerBlock(blockId: number): Promise<History>\n\t{\n\t\tthis.type = History.TYPE_DESIGNER_BLOCK;\n\t\tthis.designerBlockId = blockId;\n\n\t\treturn loadStack(this);\n\t}\n\n\tgetUndoAction(): string\n\t{\n\t\tif (this.type === History.TYPE_DESIGNER_BLOCK)\n\t\t{\n\t\t\treturn \"History::undoDesignerBlock\";\n\t\t}\n\n\t\treturn \"History::undoLanding\";\n\t}\n\n\tgetRedoAction(): string\n\t{\n\t\tif (this.type === History.TYPE_DESIGNER_BLOCK)\n\t\t{\n\t\t\treturn \"History::redoDesignerBlock\";\n\t\t}\n\n\t\treturn \"History::redoLanding\";\n\t}\n\n\tgetActionParams(): string\n\t{\n\t\tif (\n\t\t\tthis.type === History.TYPE_DESIGNER_BLOCK\n\t\t\t&& this.designerBlockId\n\t\t)\n\t\t{\n\t\t\treturn {\n\t\t\t\tblockId: this.designerBlockId,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tlid: this.landingId,\n\t\t};\n\t}\n\n\t/**\n\t * Applies preview history entry\n\t * @return {Promise}\n\t */\n\tundo()\n\t{\n\t\tif (this.canUndo())\n\t\t{\n\t\t\treturn BX.Landing.Backend.getInstance()\n\t\t\t\t.action(\n\t\t\t\t\tthis.getUndoAction(),\n\t\t\t\t\tthis.getActionParams(),\n\t\t\t\t)\n\t\t\t\t.then(command => {\n\t\t\t\t\tif (command)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst params = command.params;\n\t\t\t\t\t\tconst entry = new Entry({\n\t\t\t\t\t\t\tblock: params.block,\n\t\t\t\t\t\t\tselector: params.selector,\n\t\t\t\t\t\t\tcommand: command.command,\n\t\t\t\t\t\t\tparams: params,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this.runCommand(entry, -1);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.reject();\n\t\t\t\t})\n\t\t\t\t.then(res => {\n\t\t\t\t\treturn this.offset(-1).then(onUpdate);\n\t\t\t\t})\n\t\t}\n\n\t\treturn Promise.resolve(this);\n\t}\n\n\n\t/**\n\t * Applies preview next history entry\n\t * @return {Promise}\n\t */\n\tredo()\n\t{\n\t\tif (this.canRedo())\n\t\t{\n\t\t\treturn BX.Landing.Backend.getInstance()\n\t\t\t\t.action(\n\t\t\t\t\tthis.getRedoAction(),\n\t\t\t\t\tthis.getActionParams(),\n\t\t\t\t)\n\t\t\t\t.then(command => {\n\t\t\t\t\tif (command)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst params = command.params;\n\t\t\t\t\t\tconst entry = new Entry({\n\t\t\t\t\t\t\tblock: params.block,\n\t\t\t\t\t\t\tselector: params.selector,\n\t\t\t\t\t\t\tcommand: command.command,\n\t\t\t\t\t\t\tparams: params,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this.runCommand(entry, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.reject();\n\t\t\t\t})\n\t\t\t\t.then(res => {\n\t\t\t\t\treturn this.offset(1).then(onUpdate);\n\t\t\t\t})\n\t\t}\n\n\t\treturn Promise.resolve(this);\n\t}\n\n\toffset(offsetValue: number): Promise<History>\n\t{\n\t\tif (this.commandState === PENDING)\n\t\t{\n\t\t\treturn Promise.resolve(this);\n\t\t}\n\n\t\tlet step = this.step + offsetValue;\n\n\t\tif (step >= 0 && step <= this.stack)\n\t\t{\n\t\t\tthis.step = step;\n\t\t}\n\n\t\treturn Promise.resolve(this);\n\t}\n\n\trunCommand(entry: Entry, offsetValue: number)\n\t{\n\t\tif (entry)\n\t\t{\n\t\t\tconst command = this.commands[entry.command];\n\t\t\tif (command)\n\t\t\t{\n\t\t\t\tthis.commandState = PENDING;\n\n\t\t\t\treturn command.command(entry)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tthis.commandState = RESOLVED;\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\tthis.commandState = RESOLVED;\n\t\t\t\t\t\t// todo: how check and process error\n\t\t\t\t\t\treturn this.offset(offsetValue);\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\n\t/**\n\t * Check that there are actions to undo\n\t * @returns {boolean}\n\t */\n\tcanUndo()\n\t{\n\t\treturn (\n\t\t\tthis.commandState !== PENDING\n\t\t\t&& (this.step > 0 && this.stack > 0 && this.step <= this.stack)\n\t\t);\n\t}\n\n\n\t/**\n\t * Check that there are actions to redo\n\t * @returns {boolean}\n\t */\n\tcanRedo()\n\t{\n\t\treturn (\n\t\t\tthis.commandState !== PENDING\n\t\t\t&& (this.step < this.stack && this.step >= 0)\n\t\t);\n\t}\n\n\n\t/**\n\t * Adds entry to history stack\n\t * @param {BX.Landing.History.Entry} entry\n\t */\n\tpush(entry)\n\t{\n\t\tif (this.step < this.stack)\n\t\t{\n\t\t\tthis.stack = this.step;\n\t\t}\n\n\t\tthis.step++;\n\t\tthis.stack++;\n\n\t\tonUpdate(this);\n\t}\n\n\n\t/**\n\t * Registers unique history command\n\t * @param {Command} command\n\t */\n\tregisterCommand(command)\n\t{\n\t\tif (command instanceof Command)\n\t\t{\n\t\t\tthis.commands[command.id] = command;\n\t\t}\n\t}\n\n\n\t/**\n\t * Removes page history from storage\n\t * @param {int} pageId\n\t * @return {Promise<BX.Landing.History>}\n\t */\n\tremovePageHistory(pageId)\n\t{\n\t\t// todo: publication clear method\n\t\treturn removePageHistory(pageId, this)\n\t\t\t.then((history) => {\n\t\t\t\tlet currentPageId;\n\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tcurrentPageId = BX.Landing.Main.getInstance().id;\n\t\t\t\t}\n\t\t\t\tcatch (err)\n\t\t\t\t{\n\t\t\t\t\tcurrentPageId = -1;\n\t\t\t\t}\n\n\t\t\t\tif (currentPageId === pageId)\n\t\t\t\t{\n\t\t\t\t\treturn clear(history);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.reject();\n\t\t\t})\n\t\t\t.then(onUpdate)\n\t\t\t.catch(() => {});\n\t}\n\n\n\t/**\n\t * Handles storage event\n\t * @param {StorageEvent} event\n\t */\n\tonStorage(event)\n\t{\n\t\tif (event.key === null)\n\t\t{\n\t\t\tif (!window.localStorage.history)\n\t\t\t{\n\t\t\t\tclear(this).then(onUpdate);\n\t\t\t}\n\t\t}\n\t}\n\n\n\t/**\n\t * Handles new branch events\n\t * @param {BX.Landing.History.Entry[]} entries\n\t * @return {Promise<History>}\n\t */\n\tonNewBranch(entries)\n\t{\n\t\treturn fetchEntities(entries, this)\n\t\t\t.then((entities) => {\n\t\t\t\treturn removeEntities(entities, this);\n\t\t\t});\n\t}\n}"],"names":["RESOLVED","PENDING","BX","Landing","Utils","scrollTo","highlight","editNode","entry","PageObject","getInstance","blocks","then","block","get","Promise","reject","forceInit","node","nodes","getBySelector","selector","bind","useRangeRect","setValue","params","value","editText","editEmbed","editMap","editImage","editIcon","editLink","changeNodeName","onChangeTag","sortBlock","direction","addBlock","currentBlock","resolve","landing","Main","view","iframe","currentArea","contentDocument","body","querySelector","lid","insertBefore","onAddBlock","code","removeBlock","deleteBlock","addCard","parentNode","elements","index","position","container","content","card","cards","removeCard","relativeSelector","addNode","tags","top","onCustomEvent","removeNode","slice","editStyle","initStyles","querySelectorAll","forEach","element","className","style","removeAttribute","form","forms","find","currentForm","fields","field","reset","onFrameLoad","styleNode","styles","affect","length","setAffects","onStyleInputWithDebounce","data","getValue","updateContent","multiply","blockId","updateBlockStateData","singleAction","command","dynamicParams","dynamicState","settings","id","Object","keys","updateBlockState","Command","options","Type","isStringFilled","isFunction","registerBaseCommands","history","registerCommand","worker","Worker","asyncJsonParse","str","postMessage","addEventListener","event","asyncJsonStringify","obj","removePageHistory","pageId","window","localStorage","historyData","isPlainObject","all","allString","loadStack","currentPageId","err","Backend","action","stack","Text","toNumber","stackCount","step","Math","min","e","fetchEntities","items","entities","images","item","push","redo","removeEntities","clear","commandState","onUpdate","rootWindow","getRootWindow","onInit","Entry","Highlight","layout","classList","add","animationDuration","rect","UI","prototype","show","call","setTimeout","hide","History","instance","HighlightNode","type","TYPE_LANDING","commands","onStorage","landingId","Event","TYPE_DESIGNER_BLOCK","designerBlockId","canUndo","getUndoAction","getActionParams","runCommand","res","offset","canRedo","getRedoAction","offsetValue","key","entries"],"mappings":";;;;CAGO,IAAMA,QAAgB,GAAG,UAAzB;AACP,CAAO,IAAMC,OAAe,GAAG,SAAxB;;CCJP,wBAA8BC,EAAE,CAACC,OAAH,CAAWC,KAAzC;CAAA,IAAOC,QAAP,qBAAOA,QAAP;CAAA,IAAiBC,SAAjB,qBAAiBA,SAAjB;CAEA;CACA;CACA;CACA;;CACA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,CAAUC,KAAV,EACjB;GACC,OAAON,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBC,WAAtB,GAAoCC,MAApC,GACLC,IADK,CACA,UAACD,MAAD,EAAY;KACjB,IAAME,KAAK,GAAGF,MAAM,CAACG,GAAP,CAAWN,KAAK,CAACK,KAAjB,CAAd;;KAEA,IAAI,CAACA,KAAL,EACA;OACC,OAAOE,OAAO,CAACC,MAAR,EAAP;;;KAGDH,KAAK,CAACI,SAAN;KACA,IAAMC,IAAI,GAAGL,KAAK,CAACM,KAAN,CAAYC,aAAZ,CAA0BZ,KAAK,CAACa,QAAhC,CAAb;;KAEA,IAAI,CAACH,IAAL,EACA;OACC,OAAOH,OAAO,CAACC,MAAR,EAAP;;;KAGD,OAAOX,QAAQ,CAACa,IAAI,CAACA,IAAN,CAAR,CACLN,IADK,CACAN,SAAS,CAACgB,IAAV,CAAe,IAAf,EAAqBJ,IAAI,CAACA,IAA1B,EAAgCX,QAAQ,CAACgB,YAAzC,CADA,EAELX,IAFK,CAEA,YAAM;OACX,OAAOM,IAAI,CAACM,QAAL,CAAchB,KAAK,CAACiB,MAAN,CAAaC,KAA3B,EAAkC,KAAlC,EAAyC,IAAzC,CAAP;MAHK,CAAP;IAjBK,CAAP;CAuBA,CAzBD;;CA0BAnB,QAAQ,CAACgB,YAAT,GAAwB,IAAxB;;CC9BA,IAAMI,QAAQ,GAAGpB,QAAjB;;CCAA,IAAMqB,SAAS,GAAGrB,QAAlB;;CCAA,IAAMsB,OAAO,GAAGtB,QAAhB;;CCAA,IAAMuB,SAAS,GAAGvB,QAAlB;CACAuB,SAAS,CAACP,YAAV,GAAyB,KAAzB;;CCDA,IAAMQ,QAAQ,GAAGD,SAAjB;;CCAA,IAAME,QAAQ,GAAGzB,QAAjB;CACAyB,QAAQ,CAACT,YAAT,GAAwB,KAAxB;;CCDA,0BAA8BrB,EAAE,CAACC,OAAH,CAAWC,KAAzC;CAAA,IAAOC,UAAP,uBAAOA,QAAP;CAAA,IAAiBC,WAAjB,uBAAiBA,SAAjB;CAEA;CACA;CACA;CACA;;AACA,CAAe,SAAS2B,cAAT,CAAwBzB,KAAxB,EACf;GACC,OAAON,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBC,WAAtB,GAAoCC,MAApC,GACLC,IADK,CACA,UAACD,MAAD,EAAY;KACjB,IAAME,KAAK,GAAGF,MAAM,CAACG,GAAP,CAAWN,KAAK,CAACK,KAAjB,CAAd;;KACA,IAAI,CAACA,KAAL,EACA;OACC,OAAOE,OAAO,CAACC,MAAR,EAAP;;;KAEDH,KAAK,CAACI,SAAN;KAEA,IAAMC,IAAI,GAAGL,KAAK,CAACM,KAAN,CAAYC,aAAZ,CAA0BZ,KAAK,CAACa,QAAhC,CAAb;;KACA,IAAI,CAACH,IAAL,EACA;OACC,OAAOH,OAAO,CAACC,MAAR,EAAP;;;KAGD,OAAOX,UAAQ,CAACa,IAAI,CAACA,IAAN,CAAR,CACLN,IADK,CACA,YAAM;OACX,OAAON,WAAS,CAACY,IAAI,CAACA,IAAN,CAAhB;MAFK,EAILN,IAJK,CAIA,YAAM;OACX,IAAIM,IAAI,CAACgB,WAAT,EACA;SACChB,IAAI,CAACgB,WAAL,CAAiB1B,KAAK,CAACiB,MAAN,CAAaC,KAA9B,EAAqC,IAArC;;;OAGD,OAAO,IAAP;MAVK,CAAP;IAfK,CAAP;CA4BA;;CCtCD,0BAA8BxB,EAAE,CAACC,OAAH,CAAWC,KAAzC;CAAA,IAAOC,UAAP,uBAAOA,QAAP;CAAA,IAAiBC,WAAjB,uBAAiBA,SAAjB;CAEA;CACA;CACA;CACA;;AACA,CAAe,SAAS6B,SAAT,CAAmB3B,KAAnB,EACf;GACC,OAAON,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBC,WAAtB,GAAoCC,MAApC,GACLC,IADK,CACA,UAACD,MAAD,EAAY;KACjB,IAAME,KAAK,GAAGF,MAAM,CAACG,GAAP,CAAWN,KAAK,CAACK,KAAjB,CAAd;KACAA,KAAK,CAACI,SAAN;KAEA,OAAOZ,UAAQ,CAACQ,KAAK,CAACK,IAAP,CAAR,CACLN,IADK,CACAN,WAAS,CAACgB,IAAV,CAAe,IAAf,EAAqBT,KAAK,CAACK,IAA3B,CADA,EAELN,IAFK,CAEA,YAAM;OACX,OAAOC,KAAK,CAACL,KAAK,CAACiB,MAAN,CAAaW,SAAd,CAAL,CAA8B,IAA9B,CAAP;MAHK,CAAP;IALK,CAAP;CAWA;;CCjBD,0BAA8BlC,EAAE,CAACC,OAAH,CAAWC,KAAzC;CAAA,IAAOC,UAAP,uBAAOA,QAAP;CAAA,IAAiBC,WAAjB,uBAAiBA,SAAjB;CAEA;CACA;CACA;CACA;;AACA,CAAe,SAAS+B,QAAT,CAAkB7B,KAAlB,EACf;GACC,OAAOC,6BAAU,CAACC,WAAX,GAAyBC,MAAzB,GACLC,IADK,CACA,UAACD,MAAD,EAAY;KACjB,IAAME,KAAK,GAAGF,MAAM,CAACG,GAAP,CAAWN,KAAK,CAACiB,MAAN,CAAaa,YAAxB,CAAd;KAEA,OAAO,IAAIvB,OAAJ,CAAa,UAACwB,OAAD,EAAa;OAChC,IAAI1B,KAAJ,EACA;SACCA,KAAK,CAACI,SAAN;SACA,OAAOZ,UAAQ,CAACQ,KAAK,CAACK,IAAP,CAAR,CACLN,IADK,CACAN,WAAS,CAACgB,IAAV,CAAe,IAAf,EAAqBT,KAAK,CAACK,IAA3B,EAAiC,KAAjC,EAAwC,IAAxC,CADA,EAELN,IAFK,CAEA2B,OAFA,CAAP;;;OAKDA,OAAO;MATD,EAWL3B,IAXK,CAWA,YAAM;OACX,IAAM4B,OAAO,GAAGtC,EAAE,CAACC,OAAH,CAAWsC,IAAX,CAAgB/B,WAAhB,EAAhB;OACA8B,OAAO,CAACF,YAAR,GAAuBzB,KAAvB;OAEA,OAAOJ,6BAAU,CAACC,WAAX,GAAyBgC,IAAzB,GAAgC9B,IAAhC,CAAqC,UAAC+B,MAAD,EAAY;SACvDH,OAAO,CAACI,WAAR,GAAsBD,MAAM,CAACE,eAAP,CAAuBC,IAAvB,CAA4BC,aAA5B,2BAA4DvC,KAAK,CAACiB,MAAN,CAAauB,GAAzE,SAAtB;SACAR,OAAO,CAACS,YAAR,GAAuBzC,KAAK,CAACiB,MAAN,CAAawB,YAApC;SAEA,OAAOT,OAAO,CAACU,UAAR,CAAmB1C,KAAK,CAACiB,MAAN,CAAa0B,IAAhC,EAAsC3C,KAAK,CAACK,KAA5C,EAAmD,IAAnD,CAAP;QAJM,CAAP;MAfK,CAAP;IAJK,CAAP;CA2BA;;CCrCD,0BAA8BX,EAAE,CAACC,OAAH,CAAWC,KAAzC;CAAA,IAAOC,UAAP,uBAAOA,QAAP;CAAA,IAAiBC,WAAjB,uBAAiBA,SAAjB;CAEA;CACA;CACA;CACA;;AACA,CAAe,SAAS8C,WAAT,CAAqB5C,KAArB,EACf;GACC,OAAON,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBC,WAAtB,GAAoCC,MAApC,GACLC,IADK,CACA,UAACD,MAAD,EAAY;KACjB,IAAME,KAAK,GAAGF,MAAM,CAACG,GAAP,CAAWN,KAAK,CAACK,KAAjB,CAAd;KACAA,KAAK,CAACI,SAAN;KAEA,OAAOZ,UAAQ,CAACQ,KAAK,CAACK,IAAP,CAAR,CACLN,IADK,CACA,YAAM;OACXN,WAAS,CAACO,KAAK,CAACK,IAAP,CAAT;OACA,OAAOL,KAAK,CAACwC,WAAN,CAAkB,IAAlB,CAAP;MAHK,CAAP;IALK,CAAP;CAWA;;CCnBD,0BAA8BnD,EAAE,CAACC,OAAH,CAAWC,KAAzC;CAAA,IAAOC,UAAP,uBAAOA,QAAP;CAAA,IAAiBC,WAAjB,uBAAiBA,SAAjB;CAEA;CACA;CACA;CACA;CACA;;AACA,CAAe,SAASgD,OAAT,CAAiB9C,KAAjB,EACf;GACC,OAAON,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBC,WAAtB,GAAoCC,MAApC,GACLC,IADK,CACA,UAACD,MAAD,EAAY;KACjB,IAAME,KAAK,GAAGF,MAAM,CAACG,GAAP,CAAWN,KAAK,CAACK,KAAjB,CAAd;;KACA,IAAIA,KAAJ,EACA;OACCA,KAAK,CAACI,SAAN;;;KAGD,IAAI,CAACJ,KAAL,EACA;OACC,OAAOE,OAAO,CAACC,MAAR,EAAP;;;KAGD,OAAOH,KAAP;IAbK,EAeLD,IAfK,CAeA,UAACC,KAAD,EAAW;KAChB,OAAOX,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBC,WAAtB,GAAoCgC,IAApC,GACL9B,IADK,CACA,UAAC+B,MAAD,EAAY;OACjB,IAAMY,UAAU,GAAGZ,MAAM,CAACE,eAAP,CAAuBE,aAAvB,CAAqCvC,KAAK,CAACiB,MAAN,CAAaJ,QAAlD,EAA4DkC,UAA/E;OACA,OAAO,CACN1C,KADM,EAEN0C,UAFM,CAAP;MAHK,CAAP;IAhBK,EAyBL3C,IAzBK,CAyBA,UAAC4C,QAAD,EAAc;KACnB,OAAOnD,UAAQ,CAACmD,QAAQ,CAAC,CAAD,CAAT,CAAR,CACL5C,IADK,CACA,YAAM;OACX,OAAO4C,QAAP;MAFK,CAAP;IA1BK,EA+BL5C,IA/BK,CA+BA,UAAC4C,QAAD,EAAc;KACnB,IAAI3C,KAAK,GAAG2C,QAAQ,CAAC,CAAD,CAApB;KACA,OAAO3C,KAAK,CACVyC,OADK,CACG;OACRG,KAAK,EAAEjD,KAAK,CAACiB,MAAN,CAAaiC,QADZ;OAERC,SAAS,EAAEH,QAAQ,CAAC,CAAD,CAFX;OAGRI,OAAO,EAAEpD,KAAK,CAACiB,MAAN,CAAamC,OAHd;OAIRvC,QAAQ,EAAEb,KAAK,CAACiB,MAAN,CAAaJ;MALlB,EAMH,IANG,EAOLT,IAPK,CAOA,YAAM;OACX,IAAMiD,IAAI,GAAGhD,KAAK,CAACiD,KAAN,CAAY1C,aAAZ,CAA0BZ,KAAK,CAACiB,MAAN,CAAaJ,QAAvC,CAAb;;OACA,IAAI,CAACwC,IAAL,EACA;SACC,OAAO9C,OAAO,CAACC,MAAR,EAAP;;;OAGD,OAAOV,WAAS,CAACuD,IAAI,CAAC3C,IAAN,CAAhB;MAdK,CAAP;IAjCK,WAkDC,YAAM,EAlDP,CAAP;CAmDA;;CC5DD,0BAA8BhB,EAAE,CAACC,OAAH,CAAWC,KAAzC;CAAA,IAAOC,UAAP,uBAAOA,QAAP;CAAA,IAAiBC,WAAjB,uBAAiBA,SAAjB;CAEA;CACA;CACA;CACA;CACA;;AACA,CAAe,SAASyD,UAAT,CAAoBvD,KAApB,EACf;GACC,OAAON,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBC,WAAtB,GAAoCC,MAApC,GACLC,IADK,CACA,UAACD,MAAD,EAAY;KACjB,IAAME,KAAK,GAAGF,MAAM,CAACG,GAAP,CAAWN,KAAK,CAACK,KAAjB,CAAd;KACAA,KAAK,CAACI,SAAN;;KAEA,IAAI,CAACJ,KAAL,EACA;OACC,OAAOE,OAAO,CAACC,MAAR,EAAP;;;KAGD,IAAMgD,gBAAgB,GAAGxD,KAAK,CAACiB,MAAN,CAAaJ,QAAb,GAAwB,GAAxB,IAA+Bb,KAAK,CAACiB,MAAN,CAAaiC,QAAb,GAAwB,CAAvD,CAAzB;KACA,IAAMG,IAAI,GAAGhD,KAAK,CAACiD,KAAN,CAAY1C,aAAZ,CAA0B4C,gBAA1B,CAAb;;KAEA,IAAI,CAACH,IAAL,EACA;OACC,OAAO9C,OAAO,CAACC,MAAR,EAAP;;;KAGD,OAAOX,UAAQ,CAACwD,IAAI,CAAC3C,IAAN,CAAR,CACLN,IADK,CACAN,WAAS,CAACgB,IAAV,CAAe,IAAf,EAAqBuC,IAAI,CAAC3C,IAA1B,CADA,EAELN,IAFK,CAEA,YAAM;OACX,OAAOC,KAAK,CAACkD,UAAN,CAAiBC,gBAAjB,EAAmC,IAAnC,CAAP;MAHK,CAAP;IAlBK,CAAP;CAwBA;;CCjCD;CACA;CACA;CACA;CACA;AACA,CAAe,SAASC,OAAT,CAAiBzD,KAAjB,EACf;GAAA;;;GAGC,OAAO,IAAIO,OAAJ,CAAY,UAACwB,OAAD,EAAUvB,MAAV,EAAqB;KACvC,IAAMkD,IAAI,GAAG1D,KAAK,CAACiB,MAAN,CAAayC,IAAb,IAAqB,EAAlC;KACAC,GAAG,CAACjE,EAAJ,CAAOkE,aAAP,CAAqB,KAArB,EAA2B,0BAA3B,EAAuD,CAACF,IAAD,CAAvD;KACA3B,OAAO;IAHD,CAAP;CAKA;;CCdD;CACA;CACA;CACA;CACA;AACA,CAAe,SAAS8B,UAAT,CAAoB7D,KAApB,EACf;GAAA;;;GAGC,OAAO,IAAIO,OAAJ,CAAY,UAACwB,OAAD,EAAUvB,MAAV,EAAqB;KACvC,IAAMkD,IAAI,GAAG1D,KAAK,CAACiB,MAAN,CAAayC,IAAb,IAAqB,EAAlC;KACAC,GAAG,CAACjE,EAAJ,CAAOkE,aAAP,CAAqB,KAArB,EAA2B,6BAA3B,EAA0D,CAACF,IAAD,CAA1D;KACA3B,OAAO;IAHD,CAAP;CAKA;;CCdD,0BAA0BrC,EAAE,CAACC,OAAH,CAAWC,KAArC;CAAA,IAAOC,UAAP,uBAAOA,QAAP;CAAA,IAAiBiE,KAAjB,uBAAiBA,KAAjB;CAEA;CACA;CACA;CACA;;AACA,CAAe,SAASC,SAAT,CAAmB/D,KAAnB,EACf;GACC,OAAON,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBC,WAAtB,GAAoCC,MAApC,GACLC,IADK,CACA,UAACD,MAAD,EAAY;KACjB,IAAME,KAAK,GAAGF,MAAM,CAACG,GAAP,CAAWN,KAAK,CAACK,KAAjB,CAAd;;KAEA,IAAI,CAACA,KAAL,EACA;OACC,OAAOE,OAAO,CAACC,MAAR,EAAP;;;KAGDH,KAAK,CAACI,SAAN;KACAJ,KAAK,CAAC2D,UAAN;KACA,OAAO3D,KAAP;IAXK,EAaLD,IAbK,CAaA,UAACC,KAAD,EAAW;KAChB,OAAOR,UAAQ,CAACQ,KAAK,CAACK,IAAP,CAAR,CACLN,IADK,CACA,YAAM;OACX,OAAOC,KAAP;MAFK,CAAP;IAdK,EAmBLD,IAnBK,CAmBA,UAACC,KAAD,EAAW;KAChB,IAAI2C,QAAQ,GAAGc,KAAK,CAACzD,KAAK,CAACK,IAAN,CAAWuD,gBAAX,CAA4BjE,KAAK,CAACa,QAAlC,CAAD,CAApB;;KAEA,IAAIR,KAAK,CAACQ,QAAN,KAAmBb,KAAK,CAACa,QAA7B,EACA;OACCmC,QAAQ,GAAG,CAAC3C,KAAK,CAAC+C,OAAP,CAAX;;;KAGDJ,QAAQ,CAACkB,OAAT,CAAiB,UAACC,OAAD,EAAa;OAC7BA,OAAO,CAACC,SAAR,GAAoBpE,KAAK,CAACiB,MAAN,CAAaC,KAAb,CAAmBkD,SAAvC;;OACA,IAAIpE,KAAK,CAACiB,MAAN,CAAaC,KAAb,CAAmBmD,KAAnB,IAA4BrE,KAAK,CAACiB,MAAN,CAAaC,KAAb,CAAmBmD,KAAnB,KAA6B,EAA7D,EACA;SACCF,OAAO,CAACE,KAAR,GAAgBrE,KAAK,CAACiB,MAAN,CAAaC,KAAb,CAAmBmD,KAAnC;QAFD,MAKA;SACCF,OAAO,CAACG,eAAR,CAAwB,OAAxB;;MARF;KAWA,OAAOjE,KAAP;IAtCK,EAwCLD,IAxCK,CAwCA,UAACC,KAAD,EAAW;KAChB,IAAMkE,IAAI,GAAGlE,KAAK,CAACmE,KAAN,CAAYC,IAAZ,CAAiB,UAACC,WAAD,EAAiB;OAC9C,OACCA,WAAW,CAAC7D,QAAZ,KAAyBb,KAAK,CAACa,QAA/B,IACG6D,WAAW,CAAClB,gBAAZ,KAAiCxD,KAAK,CAACa,QAF3C;MADY,CAAb;;KAOA,IAAI0D,IAAJ,EACA;OACCA,IAAI,CAACI,MAAL,CAAYT,OAAZ,CAAoB,UAACU,KAAD,EAAW;SAC9BA,KAAK,CAACC,KAAN;SACAD,KAAK,CAACE,WAAN;QAFD;MAVe;;;KAiBhB,IAAMC,SAAS,GAAG1E,KAAK,CAAC2E,MAAN,CAAaP,IAAb,CAAkB,UAACJ,KAAD,EAAW;OAC9C,OACCA,KAAK,CAACxD,QAAN,KAAmBb,KAAK,CAACa,QAAzB,IACGwD,KAAK,CAACb,gBAAN,KAA2BxD,KAAK,CAACa,QAFrC;MADiB,CAAlB;;KAOA,IAAIkE,SAAJ,EACA;OACC,IAAI/E,KAAK,CAACiB,MAAN,CAAagE,MAAb,IAAuBjF,KAAK,CAACiB,MAAN,CAAagE,MAAb,CAAoBC,MAApB,GAA6B,CAAxD,EACA;SACCH,SAAS,CAACI,UAAV,CAAqBnF,KAAK,CAACiB,MAAN,CAAagE,MAAlC;;;OAED5E,KAAK,CAAC+E,wBAAN,CAA+B;SAAC1E,IAAI,EAAEqE,SAAS,CAACrE,IAAjB;SAAuB2E,IAAI,EAAEN,SAAS,CAACO,QAAV;QAA5D,EAAmF,IAAnF;;IAtEI,CAAP;CAyEA;;CCjFD,0BAA8B5F,EAAE,CAACC,OAAH,CAAWC,KAAzC;CAAA,IAAOC,UAAP,uBAAOA,QAAP;CAAA,IAAiBC,WAAjB,uBAAiBA,SAAjB;CAEA;CACA;CACA;CACA;;AACA,CAAe,SAASyF,aAAT,CAAuBvF,KAAvB,EACf;GACC,OAAON,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBC,WAAtB,GAAoCC,MAApC,GACLC,IADK,CACA,UAACD,MAAD,EAAY;KACjB,IAAME,KAAK,GAAGF,MAAM,CAACG,GAAP,CAAWN,KAAK,CAACK,KAAjB,CAAd;KACAA,KAAK,CAACI,SAAN;KAEA,OAAOZ,UAAQ,CAACQ,KAAK,CAACK,IAAP,CAAR,CACLN,IADK,CACA,YAAM;OACX,KAAKN,WAAS,CAACO,KAAK,CAACK,IAAP,CAAd;OACA,OAAOL,KAAK,CAACkF,aAAN,CAAoBvF,KAAK,CAACiB,MAAN,CAAamC,OAAjC,EAA0C,IAA1C,CAAP;MAHK,CAAP;IALK,CAAP;CAWA;;CCnBD,0BAA8B1D,EAAE,CAACC,OAAH,CAAWC,KAAzC;CAAA,IAAOC,UAAP,uBAAOA,QAAP;CAAA,IAAiBC,WAAjB,uBAAiBA,SAAjB;CAEA;CACA;CACA;CACA;;AACA,CAAe,SAAS0F,QAAT,CAAkBxF,KAAlB,EACf;GACC,IAAIyF,OAAO,GAAG,IAAd;GACA,IAAMC,oBAAoB,GAAG,EAA7B;GACA1F,KAAK,CAACiB,MAAN,CAAaiD,OAAb,CAAqB,UAAAyB,YAAY,EAAI;KACpC,IAAI,CAACF,OAAD,IAAYE,YAAY,CAAC1E,MAAb,CAAoBZ,KAApC,EACA;OACCoF,OAAO,GAAGE,YAAY,CAAC1E,MAAb,CAAoBZ,KAA9B;;;KAGD,IACCsF,YAAY,CAACC,OAAb,KAAyB,UAAzB,IACGD,YAAY,CAACC,OAAb,KAAyB,WAD5B,IAEGD,YAAY,CAACC,OAAb,KAAyB,WAF5B,IAGGD,YAAY,CAACC,OAAb,KAAyB,SAH5B,IAIGD,YAAY,CAACC,OAAb,KAAyB,UAJ5B,IAKGD,YAAY,CAACC,OAAb,KAAyB,UAN7B,EAQA;OACCF,oBAAoB,CAACC,YAAY,CAAC1E,MAAb,CAAoBJ,QAArB,CAApB,GAAqD8E,YAAY,CAAC1E,MAAb,CAAoBC,KAAzE;;;KAGD,IAAIyE,YAAY,CAACC,OAAb,KAAyB,eAA7B,EACA;OACCF,oBAAoB,CAACG,aAArB,GAAqCF,YAAY,CAAC1E,MAAb,CAAoB4E,aAAzD;OACAH,oBAAoB,CAACI,YAArB,GAAoCH,YAAY,CAAC1E,MAAb,CAAoB6E,YAAxD;;;KAGD,IAAIH,YAAY,CAACC,OAAb,KAAyB,cAA7B,EACA;OACCF,oBAAoB,CAACK,QAArB,GAAgC;SAACC,EAAE,EAAEL,YAAY,CAAC1E,MAAb,CAAoBC;QAAzD;;IA1BF;GA8BA,OAAOxB,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBC,WAAtB,GAAoCC,MAApC,GACLC,IADK,CACA,UAACD,MAAD,EAAY;KACjB,IAAME,KAAK,GAAGF,MAAM,CAACG,GAAP,CAAWmF,OAAX,CAAd;;KACA,IAAIpF,KAAJ,EACA;OACCA,KAAK,CAACI,SAAN;OAEA,OAAOZ,UAAQ,CAACQ,KAAK,CAACK,IAAP,CAAR,CACLN,IADK,CACA,YACN;SACC,KAAKN,WAAS,CAACO,KAAK,CAACK,IAAP,CAAd;;SACA,IAAIuF,MAAM,CAACC,IAAP,CAAYR,oBAAZ,EAAkCR,MAAlC,GAA2C,CAA/C,EACA;WACC7E,KAAK,CAAC8F,gBAAN,CAAuBT,oBAAvB,EAA6C,IAA7C;;QANI,CAAP;;IAPI,CAAP;CAkBA;;CCxDD;CACA;CACA;CACA;;KACqBU,UAEpB,iBAAYC,OAAZ,EACA;GAAA;GACC,KAAKL,EAAL,GAAUM,cAAI,CAACC,cAAL,CAAoBF,OAAO,CAACL,EAA5B,IAAkCK,OAAO,CAACL,EAA1C,GAA+C,iBAAzD;GACA,KAAKJ,OAAL,GAAeU,cAAI,CAACE,UAAL,CAAgBH,OAAO,CAACT,OAAxB,IAAmCS,OAAO,CAACT,OAA3C,GAAsD,YAAM,EAA3E;CACA;;CCUF;CACA;CACA;CACA;CACA;AACA,CAAe,SAASa,oBAAT,CAA8BC,OAA9B,EACf;GACCA,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,UADO;KAEXJ,OAAO,EAAEzE;IAFV,CADD;GAOAuF,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,WADO;KAEXJ,OAAO,EAAEtE;IAFV,CADD;GAOAoF,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,WADO;KAEXJ,OAAO,EAAExE;IAFV,CADD;GAOAsF,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,SADO;KAEXJ,OAAO,EAAEvE;IAFV,CADD;GAOAqF,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,UADO;KAEXJ,OAAO,EAAErE;IAFV,CADD;GAOAmF,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,UADO;KAEXJ,OAAO,EAAEpE;IAFV,CADD;GAOAkF,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,gBADO;KAEXJ,OAAO,EAAEnE;IAFV,CADD;GAOAiF,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,WADO;KAEXJ,OAAO,EAAEjE;IAFV,CADD;GAOA+E,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,UADO;KAEXJ,OAAO,EAAE/D;IAFV,CADD;GAOA6E,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,aADO;KAEXJ,OAAO,EAAEhD;IAFV,CADD;GAOA8D,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,aADO;KAEXJ,OAAO,EAAE7B;IAFV,CADD;GAOA2C,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,SADO;KAEXJ,OAAO,EAAE9C;IAFV,CADD;GAOA4D,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,YADO;KAEXJ,OAAO,EAAErC;IAFV,CADD;GAOAmD,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,SADO;KAEXJ,OAAO,EAAEnC;IAFV,CADD;GAOAiD,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,YADO;KAEXJ,OAAO,EAAE/B;IAFV,CADD;GAQA6C,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,eADO;KAEXJ,OAAO,EAAEL;IAFV,CADD;GAOAmB,OAAO,CAACC,eAAR,CACC,IAAIP,OAAJ,CAAY;KACXJ,EAAE,EAAE,UADO;KAEXJ,OAAO,EAAEJ;IAFV,CADD;GAOA,OAAOjF,OAAO,CAACwB,OAAR,CAAgB2E,OAAhB,CAAP;CACA;;CCtJD,IAAME,MAAM,GAAG,IAAIC,MAAJ,CACd,4DADc,CAAf;CAIA;CACA;CACA;CACA;CACA;;AACA,CAAe,SAASC,cAAT,CAAwBC,GAAxB,EACf;GACC,OAAO,IAAIxG,OAAJ,CAAa,UAACwB,OAAD,EAAa;KAChC6E,MAAM,CAACI,WAAP,CAAmBD,GAAnB;KACAH,MAAM,CAACK,gBAAP,CAAwB,SAAxB,EAAmC,UAACC,KAAD,EAAW;OAC7CnF,OAAO,CAACmF,KAAK,CAAC7B,IAAP,CAAP;MADD;IAFM,CAAP;CAMA;;CCjBD,IAAMuB,QAAM,GAAG,IAAIC,MAAJ,CACd,gEADc,CAAf;CAIA;CACA;CACA;CACA;CACA;;AACA,CAAe,SAASM,kBAAT,CAA4BC,GAA5B,EACf;GACC,OAAO,IAAI7G,OAAJ,CAAa,UAACwB,OAAD,EAAa;KAChC6E,QAAM,CAACI,WAAP,CAAmBI,GAAnB;KACAR,QAAM,CAACK,gBAAP,CAAwB,SAAxB,EAAmC,UAACC,KAAD,EAAW;OAC7CnF,OAAO,CAACmF,KAAK,CAAC7B,IAAP,CAAP;MADD;IAFM,CAAP;CAMA;;CCZD;CACA;CACA;CACA;CACA;CACA;AACA,CAAe,SAASgC,iBAAT,CAA2BC,MAA3B,EAAmCZ,OAAnC,EACf;GACC,OAAOI,cAAc,CAACS,MAAM,CAACC,YAAP,CAAoBd,OAArB,CAAd,CACLtG,IADK,CACA,UAACqH,WAAD,EAAiB;KACtB,OAAOnB,cAAI,CAACoB,aAAL,CAAmBD,WAAnB,IAAkCA,WAAlC,GAAgD,EAAvD;IAFK,EAILrH,IAJK,CAIA,UAACuH,GAAD,EAAS;KACd,IAAIL,MAAM,IAAIK,GAAd,EACA;OACC,OAAOA,GAAG,CAACL,MAAD,CAAV;;;KAGD,OAAOK,GAAP;IAVK,EAYLvH,IAZK,CAYA+G,kBAZA,EAaL/G,IAbK,CAaA,UAACwH,SAAD,EAAe;KACpBL,MAAM,CAACC,YAAP,CAAoBd,OAApB,GAA8BkB,SAA9B;KACA,OAAOlB,OAAP;IAfK,CAAP;CAiBA;;CC1BD;CACA;CACA;CACA;CACA;AACA,CAAe,SAASmB,SAAT,CAAmBnB,OAAnB,EACf;GACC,IAAIoB,aAAJ;;GAEA,IACA;KACCA,aAAa,GAAG7F,iBAAI,CAAC/B,WAAL,GAAmB8F,EAAnC;IAFD,CAIA,OAAO+B,GAAP,EACA;KACCD,aAAa,GAAG,CAAC,CAAjB;IATF;;;GAcC,OAAOpI,EAAE,CAACC,OAAH,CAAWqI,OAAX,CAAmB9H,WAAnB,GACL+H,MADK,CAEL,wBAFK,EAGL;KAACzF,GAAG,EAAEsF;IAHD,EAKL1H,IALK,CAKA,UAACiF,IAAD,EAA8C;KACnDqB,OAAO,CAACwB,KAAR,GAAgBC,cAAI,CAACC,QAAL,CAAc/C,IAAI,CAACgD,UAAnB,CAAhB;KACA3B,OAAO,CAAC4B,IAAR,GAAeC,IAAI,CAACC,GAAL,CAASL,cAAI,CAACC,QAAL,CAAc/C,IAAI,CAACiD,IAAnB,CAAT,EAAmC5B,OAAO,CAACwB,KAA3C,CAAf;KAEA,OAAOxB,OAAP;IATK,WAWC,UAAC+B,CAAD,EAAO;KACb,OAAO/B,OAAP;IAZK,CAAP;CAcA;;CCtCD;CACA;CACA;CACA;CACA;AACA,CAAe,SAASgC,aAAT,CAAuBC,KAAvB,EACf;GACC,IAAMC,QAAQ,GAAG;KAACzI,MAAM,EAAE,EAAT;KAAa0I,MAAM,EAAE;IAAtC;GAEAF,KAAK,CAACzE,OAAN,CAAc,UAAC4E,IAAD,EAAU;KACvB,IAAIA,IAAI,CAAClD,OAAL,KAAiB,UAArB,EACA;OACCgD,QAAQ,CAACzI,MAAT,CAAgB4I,IAAhB,CAAqBD,IAAI,CAACzI,KAA1B;;;KAGD,IAAIyI,IAAI,CAAClD,OAAL,KAAiB,WAArB,EACA;OACCgD,QAAQ,CAACC,MAAT,CAAgBE,IAAhB,CAAqB;SAAC1I,KAAK,EAAEyI,IAAI,CAACzI,KAAb;SAAoB2F,EAAE,EAAE8C,IAAI,CAACE,IAAL,CAAUhD;QAAvD;;IARF;GAYA,OAAOzF,OAAO,CAACwB,OAAR,CAAgB6G,QAAhB,CAAP;CACA;;CCpBD;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;AACA,CAAe,SAASK,cAAT,CAAwBL,QAAxB,EAAkClC,OAAlC,EACf;;;;;;;;;GAUC,OAAOnG,OAAO,CAACwB,OAAR,CAAgB2E,OAAhB,CAAP;CACA;;CCpBD;CACA;CACA;CACA;CACA;AACA,CAAe,SAASwC,KAAT,CAAexC,OAAf,EACf;GACCA,OAAO,CAACwB,KAAR,GAAgB,EAAhB;GACCxB,OAAO,CAAC4B,IAAR,GAAe,CAAC,CAAhB;GACD5B,OAAO,CAACyC,YAAR,GAAuB3J,QAAvB;GACA,OAAOe,OAAO,CAACwB,OAAR,CAAgB2E,OAAhB,CAAP;CACA;;CCZD;CACA;CACA;CACA;CACA;AACA,CAAe,SAAS0C,QAAT,CAAkB1C,OAAlB,EACf;GACC,IAAM2C,UAAU,GAAG3J,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBqJ,aAAtB,EAAnB;GACA5J,EAAE,CAACkE,aAAH,CAAiByF,UAAU,CAAC9B,MAA5B,EAAoC,2BAApC,EAAiE,CAACb,OAAD,CAAjE;GAEA,OAAOnG,OAAO,CAACwB,OAAR,CAAgB2E,OAAhB,CAAP;CACA;;CCXD;CACA;CACA;CACA;CACA;AACA,CAAe,SAAS6C,MAAT,CAAgB7C,OAAhB,EACf;GACC,IAAM2C,UAAU,GAAG3J,EAAE,CAACC,OAAH,CAAWM,UAAX,CAAsBqJ,aAAtB,EAAnB;GACA5J,EAAE,CAACkE,aAAH,CAAiByF,UAAU,CAAC9B,MAA5B,EAAoC,yBAApC,EAA+D,CAACb,OAAD,CAA/D;GAEA,OAAOnG,OAAO,CAACwB,OAAR,CAAgB2E,OAAhB,CAAP;CACA;;KCXoB8C,QAEpB,eAAYnD,OAAZ,EACA;GAAA;GACC,KAAKhG,KAAL,GAAagG,OAAO,CAAChG,KAArB;GACA,KAAKQ,QAAL,GAAgBwF,OAAO,CAACxF,QAAxB;GACA,KAAK+E,OAAL,GAAeU,cAAI,CAACC,cAAL,CAAoBF,OAAO,CAACT,OAA5B,IAAuCS,OAAO,CAACT,OAA/C,GAAyD,iBAAxE;GACA,KAAK3E,MAAL,GAAcoF,OAAO,CAACpF,MAAtB;CACA;;KCPmBwI;;;GAEpB,qBACA;KAAA;;KAAA;KACC;;KACA,MAAKC,MAAL,CAAYC,SAAZ,CAAsBC,GAAtB,CAA0B,gCAA1B;;KACA,MAAKC,iBAAL,GAAyB,GAAzB;KAHD;;;;;0BAiBK1F,SAAS2F,MACd;OAAA;;OACCpK,EAAE,CAACC,OAAH,CAAWoK,EAAX,CAAcN,SAAd,CAAwBO,SAAxB,CAAkCC,IAAlC,CAAuCC,IAAvC,CAA4C,IAA5C,EAAkD/F,OAAlD,EAA2D2F,IAA3D;OAEA,OAAO,IAAIvJ,OAAJ,CAAa,UAACwB,OAAD,EAAa;SAChCoI,UAAU,CAACpI,OAAD,EAAU,MAAI,CAAC8H,iBAAf,CAAV;;SACA,MAAI,CAACO,IAAL;QAFM,CAAP;;;;mCAdD;OACC,IAAMf,UAAU,GAAGpJ,6BAAU,CAACqJ,aAAX,EAAnB;;OACA,IAAI,CAACD,UAAU,CAAC3J,EAAX,CAAcC,OAAd,CAAsB0K,OAAtB,CAA8BZ,SAA9B,CAAwCa,QAA7C,EACA;SACCjB,UAAU,CAAC3J,EAAX,CAAcC,OAAd,CAAsB0K,OAAtB,CAA8BZ,SAA9B,CAAwCa,QAAxC,GAAmD,IAAIb,SAAJ,EAAnD;;;OAGD,OAAOJ,UAAU,CAAC3J,EAAX,CAAcC,OAAd,CAAsB0K,OAAtB,CAA8BZ,SAA9B,CAAwCa,QAA/C;;;;GAjBqCC;;CC4BvC;CACA;CACA;CACA;CACA;;AACA,KAAaF,OAAb;GAgBC,mBACA;KAAA;KAAA,qDAH2B,IAG3B;KACC,KAAKG,IAAL,GAAYH,OAAO,CAACI,YAApB;KACA,KAAKvC,KAAL,GAAa,CAAb;KACA,KAAKwC,QAAL,GAAgB,EAAhB;KACA,KAAKpC,IAAL,GAAY,CAAZ;KACA,KAAKa,YAAL,GAAoB3J,QAApB;KACA,KAAKmL,SAAL,GAAiB,KAAKA,SAAL,CAAe7J,IAAf,CAAoB,IAApB,CAAjB;;KAEA,IACA;OACC,KAAK8J,SAAL,GAAiB3I,iBAAI,CAAC/B,WAAL,GAAmB8F,EAApC;MAFD,CAIA,OAAO+B,GAAP,EACA;OACC,KAAK6C,SAAL,GAAiB,CAAC,CAAlB;;;KAGDC,eAAK,CAAC/J,IAAN,CAAWyG,MAAX,EAAmB,SAAnB,EAA8B,KAAKoD,SAAnC;KAEAlE,oBAAoB,CAAC,IAAD,CAApB,CACErG,IADF,CACOyH,SADP,EAEEzH,IAFF,CAEOmJ,MAFP;;;GApCF;KAAA;;;CA2EA;CACA;CACA;CACA;KA9EA,qCA+EsB9D,OA/EtB,EAgFC;OACC,KAAK+E,IAAL,GAAYH,OAAO,CAACS,mBAApB;OACA,KAAKC,eAAL,GAAuBtF,OAAvB;OAEA,OAAOoC,SAAS,CAAC,IAAD,CAAhB;;;KApFF;KAAA,gCAwFC;OACC,IAAI,KAAK2C,IAAL,KAAcH,OAAO,CAACS,mBAA1B,EACA;SACC,OAAO,4BAAP;;;OAGD,OAAO,sBAAP;;;KA9FF;KAAA,gCAkGC;OACC,IAAI,KAAKN,IAAL,KAAcH,OAAO,CAACS,mBAA1B,EACA;SACC,OAAO,4BAAP;;;OAGD,OAAO,sBAAP;;;KAxGF;KAAA,kCA4GC;OACC,IACC,KAAKN,IAAL,KAAcH,OAAO,CAACS,mBAAtB,IACG,KAAKC,eAFT,EAIA;SACC,OAAO;WACNtF,OAAO,EAAE,KAAKsF;UADf;;;OAKD,OAAO;SACNvI,GAAG,EAAE,KAAKoI;QADX;;;CAMF;CACA;CACA;;;KA/HA;KAAA,uBAiIC;OAAA;;OACC,IAAI,KAAKI,OAAL,EAAJ,EACA;SACC,OAAOtL,EAAE,CAACC,OAAH,CAAWqI,OAAX,CAAmB9H,WAAnB,GACL+H,MADK,CAEL,KAAKgD,aAAL,EAFK,EAGL,KAAKC,eAAL,EAHK,EAKL9K,IALK,CAKA,UAAAwF,OAAO,EAAI;WAChB,IAAIA,OAAJ,EACA;aACC,IAAM3E,MAAM,GAAG2E,OAAO,CAAC3E,MAAvB;aACA,IAAMjB,KAAK,GAAG,IAAIwJ,KAAJ,CAAU;eACvBnJ,KAAK,EAAEY,MAAM,CAACZ,KADS;eAEvBQ,QAAQ,EAAEI,MAAM,CAACJ,QAFM;eAGvB+E,OAAO,EAAEA,OAAO,CAACA,OAHM;eAIvB3E,MAAM,EAAEA;cAJK,CAAd;aAOA,OAAO,KAAI,CAACkK,UAAL,CAAgBnL,KAAhB,EAAuB,CAAC,CAAxB,CAAP;;;WAGD,OAAOO,OAAO,CAACC,MAAR,EAAP;UAnBK,EAqBLJ,IArBK,CAqBA,UAAAgL,GAAG,EAAI;WACZ,OAAO,KAAI,CAACC,MAAL,CAAY,CAAC,CAAb,EAAgBjL,IAAhB,CAAqBgJ,QAArB,CAAP;UAtBK,CAAP;;;OA0BD,OAAO7I,OAAO,CAACwB,OAAR,CAAgB,IAAhB,CAAP;;;CAKF;CACA;CACA;;;KArKA;KAAA,uBAuKC;OAAA;;OACC,IAAI,KAAKuJ,OAAL,EAAJ,EACA;SACC,OAAO5L,EAAE,CAACC,OAAH,CAAWqI,OAAX,CAAmB9H,WAAnB,GACL+H,MADK,CAEL,KAAKsD,aAAL,EAFK,EAGL,KAAKL,eAAL,EAHK,EAKL9K,IALK,CAKA,UAAAwF,OAAO,EAAI;WAChB,IAAIA,OAAJ,EACA;aACC,IAAM3E,MAAM,GAAG2E,OAAO,CAAC3E,MAAvB;aACA,IAAMjB,KAAK,GAAG,IAAIwJ,KAAJ,CAAU;eACvBnJ,KAAK,EAAEY,MAAM,CAACZ,KADS;eAEvBQ,QAAQ,EAAEI,MAAM,CAACJ,QAFM;eAGvB+E,OAAO,EAAEA,OAAO,CAACA,OAHM;eAIvB3E,MAAM,EAAEA;cAJK,CAAd;aAOA,OAAO,MAAI,CAACkK,UAAL,CAAgBnL,KAAhB,EAAuB,CAAvB,CAAP;;;WAGD,OAAOO,OAAO,CAACC,MAAR,EAAP;UAnBK,EAqBLJ,IArBK,CAqBA,UAAAgL,GAAG,EAAI;WACZ,OAAO,MAAI,CAACC,MAAL,CAAY,CAAZ,EAAejL,IAAf,CAAoBgJ,QAApB,CAAP;UAtBK,CAAP;;;OA0BD,OAAO7I,OAAO,CAACwB,OAAR,CAAgB,IAAhB,CAAP;;;KApMF;KAAA,uBAuMQyJ,WAvMR,EAwMC;OACC,IAAI,KAAKrC,YAAL,KAAsB1J,OAA1B,EACA;SACC,OAAOc,OAAO,CAACwB,OAAR,CAAgB,IAAhB,CAAP;;;OAGD,IAAIuG,IAAI,GAAG,KAAKA,IAAL,GAAYkD,WAAvB;;OAEA,IAAIlD,IAAI,IAAI,CAAR,IAAaA,IAAI,IAAI,KAAKJ,KAA9B,EACA;SACC,KAAKI,IAAL,GAAYA,IAAZ;;;OAGD,OAAO/H,OAAO,CAACwB,OAAR,CAAgB,IAAhB,CAAP;;;KArNF;KAAA,2BAwNY/B,KAxNZ,EAwN0BwL,WAxN1B,EAyNC;OAAA;;OACC,IAAIxL,KAAJ,EACA;SACC,IAAM4F,OAAO,GAAG,KAAK8E,QAAL,CAAc1K,KAAK,CAAC4F,OAApB,CAAhB;;SACA,IAAIA,OAAJ,EACA;WACC,KAAKuD,YAAL,GAAoB1J,OAApB;WAEA,OAAOmG,OAAO,CAACA,OAAR,CAAgB5F,KAAhB,EACLI,IADK,CACA,YAAM;aACX,MAAI,CAAC+I,YAAL,GAAoB3J,QAApB;aAEA,OAAO,MAAP;YAJK,WAMC,YAAM;aACZ,MAAI,CAAC2J,YAAL,GAAoB3J,QAApB,CADY;;aAGZ,OAAO,MAAI,CAAC6L,MAAL,CAAYG,WAAZ,CAAP;YATK,CAAP;;;;;CAiBJ;CACA;CACA;;;KApPA;KAAA,0BAsPC;OACC,OACC,KAAKrC,YAAL,KAAsB1J,OAAtB,IACI,KAAK6I,IAAL,GAAY,CAAZ,IAAiB,KAAKJ,KAAL,GAAa,CAA9B,IAAmC,KAAKI,IAAL,IAAa,KAAKJ,KAF1D;;;CAQF;CACA;CACA;;;KAjQA;KAAA,0BAmQC;OACC,OACC,KAAKiB,YAAL,KAAsB1J,OAAtB,IACI,KAAK6I,IAAL,GAAY,KAAKJ,KAAjB,IAA0B,KAAKI,IAAL,IAAa,CAF5C;;;CAQF;CACA;CACA;;;KA9QA;KAAA,qBA+QMtI,KA/QN,EAgRC;OACC,IAAI,KAAKsI,IAAL,GAAY,KAAKJ,KAArB,EACA;SACC,KAAKA,KAAL,GAAa,KAAKI,IAAlB;;;OAGD,KAAKA,IAAL;OACA,KAAKJ,KAAL;OAEAkB,QAAQ,CAAC,IAAD,CAAR;;;CAKF;CACA;CACA;;;KAhSA;KAAA,gCAiSiBxD,OAjSjB,EAkSC;OACC,IAAIA,OAAO,YAAYQ,OAAvB,EACA;SACC,KAAKsE,QAAL,CAAc9E,OAAO,CAACI,EAAtB,IAA4BJ,OAA5B;;;;CAMH;CACA;CACA;CACA;;;KA9SA;KAAA,qCA+SmB0B,MA/SnB,EAgTC;;OAEC,OAAOD,iBAAiB,CAACC,MAAD,EAAS,IAAT,CAAjB,CACLlH,IADK,CACA,UAACsG,OAAD,EAAa;SAClB,IAAIoB,aAAJ;;SAEA,IACA;WACCA,aAAa,GAAGpI,EAAE,CAACC,OAAH,CAAWsC,IAAX,CAAgB/B,WAAhB,GAA8B8F,EAA9C;UAFD,CAIA,OAAO+B,GAAP,EACA;WACCD,aAAa,GAAG,CAAC,CAAjB;;;SAGD,IAAIA,aAAa,KAAKR,MAAtB,EACA;WACC,OAAO4B,KAAK,CAACxC,OAAD,CAAZ;;;SAGD,OAAOnG,OAAO,CAACC,MAAR,EAAP;QAlBK,EAoBLJ,IApBK,CAoBAgJ,QApBA,WAqBC,YAAM,EArBP,CAAP;;;CA0BF;CACA;CACA;;;KA9UA;KAAA,0BA+UWlC,KA/UX,EAgVC;OACC,IAAIA,KAAK,CAACuE,GAAN,KAAc,IAAlB,EACA;SACC,IAAI,CAAClE,MAAM,CAACC,YAAP,CAAoBd,OAAzB,EACA;WACCwC,KAAK,CAAC,IAAD,CAAL,CAAY9I,IAAZ,CAAiBgJ,QAAjB;;;;;CAOJ;CACA;CACA;CACA;;;KA/VA;KAAA,4BAgWasC,OAhWb,EAiWC;OAAA;;OACC,OAAOhD,aAAa,CAACgD,OAAD,EAAU,IAAV,CAAb,CACLtL,IADK,CACA,UAACwI,QAAD,EAAc;SACnB,OAAOK,cAAc,CAACL,QAAD,EAAW,MAAX,CAArB;QAFK,CAAP;;;KAlWF;;;;;;;;;;;;;;;;;;;KAAA,8BAgEC;OACC,IAAMS,UAAU,GAAGpJ,6BAAU,CAACqJ,aAAX,EAAnB;;OACA,IAAI,CAACD,UAAU,CAAC3J,EAAX,CAAcC,OAAd,CAAsB0K,OAAtB,CAA8BC,QAAnC,EACA;SACCjB,UAAU,CAAC3J,EAAX,CAAcC,OAAd,CAAsB0K,OAAtB,CAA8BC,QAA9B,GAAyC,IAAI5K,EAAE,CAACC,OAAH,CAAW0K,OAAf,EAAzC;;;OAGD,OAAOhB,UAAU,CAAC3J,EAAX,CAAcC,OAAd,CAAsB0K,OAAtB,CAA8BC,QAArC;;;GAvEF;CAAA;6BAAaD,yBAEU;6BAFVA,gCAGiB;6BAHjBA,oBAyCKjE;6BAzCLiE,kBA0CGb;6BA1CHa,sBA2COZ;;;;;;;;"}