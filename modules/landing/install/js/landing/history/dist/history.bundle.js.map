{"version":3,"file":"history.bundle.js","sources":["../src/internal/constants.js","../src/action/edit-text.js","../src/action/edit-embed.js","../src/action/edit-map.js","../src/action/edit-image.js","../src/action/edit-icon.js","../src/action/edit-link.js","../src/action/sort-block.js","../src/action/add-block.js","../src/action/remove-block.js","../src/action/add-card.js","../src/action/remove-card.js","../src/action/edit-style.js","../src/action/update-block-state.js","../src/history-command.js","../src/internal/register-base-commands.js","../src/internal/async-json-parse.js","../src/internal/async-json-stringify.js","../src/internal/remove-page-history.js","../src/internal/load-stack.js","../src/internal/save-stack.js","../src/internal/fetch-entities.js","../src/internal/remove-entities.js","../src/internal/offset.js","../src/internal/clear.js","../src/internal/on-update.js","../src/internal/on-init.js","../src/history-entry.js","../src/history-highlight.js","../src/history.js"],"sourcesContent":["export const UNDO: string = 'undo';\nexport const REDO: string = 'redo';\nexport const INIT: string = 'init';\nexport const RESOLVED: string = 'resolved';\nexport const PENDING: string = 'pending';\nexport const MAX_ENTRIES_COUNT: number = 100;","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function editText(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\tblock.forceInit();\n\t\t\tconst node = block.nodes.getBySelector(entry.selector);\n\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn scrollTo(node.node)\n\t\t\t\t.then(highlight.bind(null, node.node, true))\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn node.setValue(entry[state], false, true);\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function editEmbed(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\tblock.forceInit();\n\t\t\tconst node = block.nodes.getBySelector(entry.selector);\n\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn scrollTo(node.node)\n\t\t\t\t.then(highlight.bind(null, node.node, true))\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn node.setValue(entry[state], false, true);\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function editMap(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\tblock.forceInit();\n\t\t\tconst node = block.nodes.getBySelector(entry.selector);\n\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn scrollTo(node.node)\n\t\t\t\t.then(highlight.bind(null, node.node, true))\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn node.setValue(entry[state], false, true);\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function editImage(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\tblock.forceInit();\n\t\t\tconst node = block.nodes.getBySelector(entry.selector);\n\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn scrollTo(node.node)\n\t\t\t\t.then(highlight.bind(null, node.node))\n\t\t\t\t.then(() => {\n\t\t\t\t\tentry[state].id = 0;\n\t\t\t\t\treturn node.setValue(entry[state], false, true);\n\t\t\t\t});\n\t\t});\n}","import editImage from './edit-image';\n\nconst editIcon = editImage;\n\nexport default editIcon;","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function editLink(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\tblock.forceInit();\n\t\t\tconst node = block.nodes.getBySelector(entry.selector);\n\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn scrollTo(node.node)\n\t\t\t\t.then(highlight.bind(null, node.node))\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn node.setValue(entry[state], false, true);\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function sortBlock(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tblock.forceInit();\n\n\t\t\treturn scrollTo(block.node)\n\t\t\t\t.then(highlight.bind(null, block.node))\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn block[entry[state]](true);\n\t\t\t\t});\n\t\t});\n}","import {PageObject} from 'landing.pageobject';\n\nconst {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function addBlock(state, entry)\n{\n\treturn PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry[state].currentBlock);\n\n\t\t\treturn new Promise(((resolve) => {\n\t\t\t\tif (block)\n\t\t\t\t{\n\t\t\t\t\tblock.forceInit();\n\t\t\t\t\treturn scrollTo(block.node)\n\t\t\t\t\t\t.then(highlight.bind(null, block.node, false, true))\n\t\t\t\t\t\t.then(resolve);\n\t\t\t\t}\n\n\t\t\t\tresolve();\n\t\t\t}))\n\t\t\t\t.then(() => {\n\t\t\t\t\tconst landing = BX.Landing.Main.getInstance();\n\t\t\t\t\tlanding.currentBlock = block;\n\n\t\t\t\t\treturn PageObject.getInstance().view().then((iframe) => {\n\t\t\t\t\t\tlanding.currentArea = iframe.contentDocument.body.querySelector(`[data-landing=\"${entry[state].lid}\"]`);\n\t\t\t\t\t\treturn landing.onAddBlock(entry[state].code, entry.block, true);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function removeBlock(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tblock.forceInit();\n\n\t\t\treturn scrollTo(block.node)\n\t\t\t\t.then(() => {\n\t\t\t\t\thighlight(block.node);\n\t\t\t\t\treturn block.deleteBlock(true);\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function addCard(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tif (block)\n\t\t\t{\n\t\t\t\tblock.forceInit();\n\t\t\t}\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn block;\n\t\t})\n\t\t.then((block) => {\n\t\t\treturn BX.Landing.PageObject.getInstance().view()\n\t\t\t\t.then((iframe) => {\n\t\t\t\t\treturn [\n\t\t\t\t\t\tblock,\n\t\t\t\t\t\tiframe.contentDocument.querySelector(entry[state].container),\n\t\t\t\t\t];\n\t\t\t\t});\n\t\t})\n\t\t.then((params) => {\n\t\t\treturn scrollTo(params[1])\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn params;\n\t\t\t\t});\n\t\t})\n\t\t.then((params) => {\n\t\t\tparams[0].addCard({\n\t\t\t\tindex: entry[state].index,\n\t\t\t\tcontainer: params[1],\n\t\t\t\tcontent: entry[state].html,\n\t\t\t\tselector: entry.selector,\n\t\t\t});\n\n\t\t\tconst card = params[0].cards.getBySelector(entry.selector);\n\n\t\t\tif (!card)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn highlight(card.node);\n\t\t})\n\t\t.catch(() => {});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function removeCard(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tblock.forceInit();\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\tconst card = block.cards.getBySelector(entry.selector);\n\n\t\t\tif (!card)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn scrollTo(card.node)\n\t\t\t\t.then(highlight.bind(null, card.node))\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn block.removeCard(entry.selector, true);\n\t\t\t\t});\n\t\t});\n}","const {scrollTo, slice} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function editStyle(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\n\t\t\tif (!block)\n\t\t\t{\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\tblock.forceInit();\n\t\t\tblock.initStyles();\n\t\t\treturn block;\n\t\t})\n\t\t.then((block) => {\n\t\t\treturn scrollTo(block.node)\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn block;\n\t\t\t\t});\n\t\t})\n\t\t.then((block) => {\n\t\t\tlet elements = slice(block.node.querySelectorAll(entry.selector));\n\n\t\t\tif (block.selector === entry.selector)\n\t\t\t{\n\t\t\t\telements = [block.content];\n\t\t\t}\n\n\t\t\telements.forEach((element) => {\n\t\t\t\telement.className = entry[state].className;\n\t\t\t\telement.style = entry[state].style;\n\t\t\t});\n\t\t\treturn block;\n\t\t})\n\t\t.then((block) => {\n\t\t\tconst form = block.forms.find((currentForm) => {\n\t\t\t\treturn (\n\t\t\t\t\tcurrentForm.selector === entry.selector\n\t\t\t\t\t|| currentForm.relativeSelector === entry.selector\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (form)\n\t\t\t{\n\t\t\t\tform.fields.forEach((field) => {\n\t\t\t\t\tfield.reset();\n\t\t\t\t\tfield.onFrameLoad();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst styleNode = block.styles.find((style) => {\n\t\t\t\treturn (\n\t\t\t\t\tstyle.selector === entry.selector\n\t\t\t\t\t|| style.relativeSelector === entry.selector\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (styleNode)\n\t\t\t{\n\t\t\t\tblock.onStyleInputWithDebounce({node: styleNode.node, data: styleNode.getValue()});\n\t\t\t}\n\t\t});\n}","const {scrollTo, highlight} = BX.Landing.Utils;\n\n/**\n * @param {string} state\n * @param {object} entry\n * @return {Promise}\n */\nexport default function updateBlockState(state, entry)\n{\n\treturn BX.Landing.PageObject.getInstance().blocks()\n\t\t.then((blocks) => {\n\t\t\tconst block = blocks.get(entry.block);\n\t\t\tblock.forceInit();\n\n\t\t\treturn scrollTo(block.node)\n\t\t\t\t.then(() => {\n\t\t\t\t\tvoid highlight(block.node);\n\t\t\t\t\tblock.updateBlockState(BX.clone(entry[state]), true);\n\t\t\t\t});\n\t\t});\n}","import {Type} from 'main.core';\n\n/**\n * Implements interface for works with command of history\n * @param {{id: string, undo: function, redo: function}} options\n */\nexport default class Command\n{\n\tconstructor(options: {id: string, undo: () => {}, redo: () => {}})\n\t{\n\t\tthis.id = Type.isStringFilled(options.id) ? options.id : '#invalidCommand';\n\t\tthis.undo = Type.isFunction(options.undo) ? options.undo : (() => {});\n\t\tthis.redo = Type.isFunction(options.redo) ? options.redo : (() => {});\n\t}\n}","import editText from '../action/edit-text';\nimport editEmbed from '../action/edit-embed';\nimport editMap from '../action/edit-map';\nimport editImage from '../action/edit-image';\nimport editIcon from '../action/edit-icon';\nimport editLink from '../action/edit-link';\nimport sortBlock from '../action/sort-block';\nimport addBlock from '../action/add-block';\nimport removeBlock from '../action/remove-block';\nimport addCard from '../action/add-card';\nimport removeCard from '../action/remove-card';\nimport editStyle from '../action/edit-style';\nimport updateBlockState from '../action/update-block-state';\n\nimport Command from '../history-command';\nimport {UNDO, REDO} from './constants';\n\nimport type {History} from '../history';\n\n/**\n * Registers base internal commands\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function registerBaseCommands(history: History)\n{\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editText',\n\t\t\tundo: editText.bind(null, UNDO),\n\t\t\tredo: editText.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editEmbed',\n\t\t\tundo: editEmbed.bind(null, UNDO),\n\t\t\tredo: editEmbed.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editMap',\n\t\t\tundo: editMap.bind(null, UNDO),\n\t\t\tredo: editMap.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editImage',\n\t\t\tundo: editImage.bind(null, UNDO),\n\t\t\tredo: editImage.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editIcon',\n\t\t\tundo: editIcon.bind(null, UNDO),\n\t\t\tredo: editIcon.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'editLink',\n\t\t\tundo: editLink.bind(null, UNDO),\n\t\t\tredo: editLink.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'sortBlock',\n\t\t\tundo: sortBlock.bind(null, UNDO),\n\t\t\tredo: sortBlock.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'addBlock',\n\t\t\tundo: removeBlock.bind(null, UNDO),\n\t\t\tredo: addBlock.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'removeBlock',\n\t\t\tundo: addBlock.bind(null, UNDO),\n\t\t\tredo: removeBlock.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'updateStyle',\n\t\t\tundo: editStyle.bind(null, UNDO),\n\t\t\tredo: editStyle.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'addCard',\n\t\t\tundo: removeCard.bind(null, UNDO),\n\t\t\tredo: addCard.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'removeCard',\n\t\t\tundo: addCard.bind(null, UNDO),\n\t\t\tredo: removeCard.bind(null, REDO),\n\t\t}),\n\t);\n\n\thistory.registerCommand(\n\t\tnew Command({\n\t\t\tid: 'updateBlockState',\n\t\t\tundo: updateBlockState.bind(null, UNDO),\n\t\t\tredo: updateBlockState.bind(null, REDO),\n\t\t}),\n\t);\n\n\treturn Promise.resolve(history);\n}","const worker = new Worker(\n\t'/bitrix/js/landing/history/src/worker/json-parse-worker.js',\n);\n\n/**\n * Parses json string\n * @param {string} str\n * @return {Promise<?Object|array>}\n */\nexport default function asyncJsonParse(str): Promise<{[key: string]: any} | Array<any>>\n{\n\treturn new Promise(((resolve) => {\n\t\tworker.postMessage(str);\n\t\tworker.addEventListener('message', (event) => {\n\t\t\tresolve(event.data);\n\t\t});\n\t}));\n}\n","const worker = new Worker(\n\t'/bitrix/js/landing/history/src/worker/json-stringify-worker.js',\n);\n\n/**\n * Serializes object\n * @param {Object|array} obj\n * @return {Promise<?String>}\n */\nexport default function asyncJsonStringify(obj: {[key: string]: any} | Array<any>): Promise<?string>\n{\n\treturn new Promise(((resolve) => {\n\t\tworker.postMessage(obj);\n\t\tworker.addEventListener('message', (event) => {\n\t\t\tresolve(event.data);\n\t\t});\n\t}));\n}","import {Type} from 'main.core';\nimport asyncJsonParse from './async-json-parse';\nimport asyncJsonStringify from './async-json-stringify';\nimport type {History} from '../history';\n\n/**\n * Removes page history from storage\n * @param {int} pageId\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function removePageHistory(pageId, history: History): Promise<History>\n{\n\treturn asyncJsonParse(window.localStorage.history)\n\t\t.then((historyData) => {\n\t\t\treturn Type.isPlainObject(historyData) ? historyData : {};\n\t\t})\n\t\t.then((all) => {\n\t\t\tif (pageId in all)\n\t\t\t{\n\t\t\t\tdelete all[pageId];\n\t\t\t}\n\n\t\t\treturn all;\n\t\t})\n\t\t.then(asyncJsonStringify)\n\t\t.then((allString) => {\n\t\t\twindow.localStorage.history = allString;\n\t\t\treturn history;\n\t\t});\n}\n","import {Type, Text} from 'main.core';\nimport {Main} from 'landing.main';\nimport asyncJsonParse from './async-json-parse';\nimport {MAX_ENTRIES_COUNT} from './constants';\nimport type {History} from '../history';\n\n/**\n * Loads history from storage\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function loadStack(history: History)\n{\n\tlet currentPageId;\n\n\ttry\n\t{\n\t\tcurrentPageId = Main.getInstance().id;\n\t}\n\tcatch (err)\n\t{\n\t\tcurrentPageId = -1;\n\t}\n\n\treturn asyncJsonParse(window.localStorage.history)\n\t\t.then((historyData) => {\n\t\t\tif (Type.isPlainObject(historyData) && currentPageId in historyData)\n\t\t\t{\n\t\t\t\treturn historyData[currentPageId];\n\t\t\t}\n\n\t\t\treturn Promise.reject();\n\t\t})\n\t\t.then((landingData) => {\n\t\t\tObject.keys(landingData.stack).forEach((key, index) => {\n\t\t\t\thistory.stack.push(new BX.Landing.History.Entry(landingData.stack[key]));\n\n\t\t\t\tif (index >= MAX_ENTRIES_COUNT)\n\t\t\t\t{\n\t\t\t\t\thistory.stack.shift();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\thistory.position = Math.min(Text.toNumber(landingData.position), history.stack.length - 1);\n\t\t\thistory.state = landingData.state;\n\t\t\treturn history;\n\t\t})\n\t\t.catch(() => {\n\t\t\treturn history;\n\t\t});\n}","import {Type} from 'main.core';\nimport {Main} from 'landing.main';\nimport asyncJsonParse from './async-json-parse';\nimport asyncJsonStringify from './async-json-stringify';\nimport type {History} from '../history';\n\n/**\n * Saves history to storage\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function saveStack(history: History): Promise<History>\n{\n\tlet currentPageId;\n\n\ttry\n\t{\n\t\tcurrentPageId = Main.getInstance().id;\n\t}\n\tcatch (err)\n\t{\n\t\tcurrentPageId = -1;\n\t}\n\n\treturn asyncJsonParse(window.localStorage.history)\n\t\t.then((historyData) => {\n\t\t\treturn Type.isPlainObject(historyData) ? historyData : {};\n\t\t})\n\t\t.then((all) => {\n\t\t\tall[currentPageId] = {};\n\t\t\tall[currentPageId].stack = history.stack;\n\t\t\tall[currentPageId].position = history.position;\n\t\t\tall[currentPageId].state = history.state;\n\t\t\treturn all;\n\t\t})\n\t\t.then(asyncJsonStringify)\n\t\t.then((allString) => {\n\t\t\twindow.localStorage.history = allString;\n\t\t\treturn history;\n\t\t});\n}","/**\n * Fetches entities from entries\n * @param {BX.Landing.History.Entry[]} items\n * @return {Promise<any>}\n */\nexport default function fetchEntities(items): Promise<any>\n{\n\tconst entities = {blocks: [], images: []};\n\n\titems.forEach((item) => {\n\t\tif (item.command === 'addBlock')\n\t\t{\n\t\t\tentities.blocks.push(item.block);\n\t\t}\n\n\t\tif (item.command === 'editImage')\n\t\t{\n\t\t\tentities.images.push({block: item.block, id: item.redo.id});\n\t\t}\n\t});\n\n\treturn Promise.resolve(entities);\n}","import type {History} from '../history';\n\n/**\n * Makes request with removed entities\n * @param {{\n * \t\tblocks: int[],\n * \t\timages: {block: int, id: int}[]\n * \t}} entities\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function removeEntities(entities, history: History): Promise<History>\n{\n\t// if (entities.blocks.length || entities.images.length)\n\t// {\n\t// \treturn BX.Landing.Backend.getInstance().action(\"Landing::removeEntities\", {data: entities})\n\t// \t\t.then(function() {\n\t// \t\t\treturn onNewBranch(history);\n\t// \t\t})\n\t// \t\t.then(onUpdate);\n\t// }\n\n\treturn Promise.resolve(history);\n}","import {PENDING, REDO, RESOLVED, UNDO} from './constants';\nimport type {History} from '../history';\n\n/**\n * Offsets history by offset length\n * @param {History} history\n * @param {Integer} offsetValue\n */\nexport default function offset(history: History, offsetValue: number): Promise<History>\n{\n\tif (history.commandState === PENDING)\n\t{\n\t\treturn Promise.resolve(history);\n\t}\n\n\tlet position = history.position + offsetValue;\n\tlet {state} = history;\n\n\tif (offsetValue < 0 && history.state !== UNDO)\n\t{\n\t\tposition += 1;\n\t\tstate = UNDO;\n\t}\n\n\tif (offsetValue > 0 && history.state !== REDO)\n\t{\n\t\tposition -= 1;\n\t\tstate = REDO;\n\t}\n\n\tif (position <= history.stack.length - 1 && position >= 0)\n\t{\n\t\thistory.position = position;\n\t\thistory.state = state;\n\n\t\tconst entry = history.stack[position];\n\n\t\tif (entry)\n\t\t{\n\t\t\tconst command = history.commands[entry.command];\n\n\t\t\tif (command)\n\t\t\t{\n\t\t\t\thistory.commandState = PENDING;\n\n\t\t\t\treturn command[state](entry)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\thistory.commandState = RESOLVED;\n\t\t\t\t\t\treturn history;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\thistory.commandState = RESOLVED;\n\t\t\t\t\t\treturn history[state === UNDO ? 'undo' : 'redo']();\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Promise.resolve(history);\n}","import {INIT, RESOLVED} from './constants';\nimport type {History} from '../history';\n\n/**\n * Clears history stack\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function clear(history: History): Promise<History>\n{\n\thistory.stack = [];\n\thistory.position = -1;\n\thistory.state = INIT;\n\thistory.commandState = RESOLVED;\n\treturn Promise.resolve(history);\n}","import type {History} from '../history';\n\n/**\n * Calls on update history stack\n * @param {History} history\n * @return {Promise<History>}\n */\nexport default function onUpdate(history: History): Promise<History>\n{\n\tconst rootWindow = BX.Landing.PageObject.getRootWindow();\n\tBX.onCustomEvent(rootWindow.window, 'BX.Landing.History:update', [history]);\n\treturn Promise.resolve(history);\n}","import type {History} from '../history';\n\n/**\n * Calls on init history object\n * @param history\n * @return {Promise<History>}\n */\nexport default function onInit(history: History): Promise<History>\n{\n\tconst rootWindow = BX.Landing.PageObject.getRootWindow();\n\tBX.onCustomEvent(rootWindow.window, 'BX.Landing.History:init', [history]);\n\treturn Promise.resolve(history);\n}","import {Type} from 'main.core';\n\nexport default class Entry\n{\n\tconstructor(options)\n\t{\n\t\tthis.block = options.block;\n\t\tthis.selector = options.selector;\n\t\tthis.command = Type.isStringFilled(options.command) ? options.command : '#invalidCommand';\n\t\tthis.undo = options.undo;\n\t\tthis.redo = options.redo;\n\t}\n}","import {PageObject} from 'landing.pageobject';\nimport {Highlight as HighlightNode} from 'landing.ui.highlight';\n\nexport default class Highlight extends HighlightNode\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.layout.classList.add('landing-ui-highlight-animation');\n\t\tthis.animationDuration = 300;\n\t}\n\n\tstatic getInstance()\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tif (!rootWindow.BX.Landing.History.Highlight.instance)\n\t\t{\n\t\t\trootWindow.BX.Landing.History.Highlight.instance = new Highlight();\n\t\t}\n\n\t\treturn rootWindow.BX.Landing.History.Highlight.instance;\n\t}\n\n\tshow(element, rect): Promise<any>\n\t{\n\t\tBX.Landing.UI.Highlight.prototype.show.call(this, element, rect);\n\n\t\treturn new Promise(((resolve) => {\n\t\t\tsetTimeout(resolve, this.animationDuration);\n\t\t\tthis.hide();\n\t\t}));\n\t}\n}","import {Event} from 'main.core';\nimport {PageObject} from 'landing.pageobject';\nimport {UNDO, REDO, INIT, RESOLVED, MAX_ENTRIES_COUNT} from './internal/constants';\nimport registerBaseCommands from './internal/register-base-commands';\nimport removePageHistory from './internal/remove-page-history';\nimport loadStack from './internal/load-stack';\nimport saveStack from './internal/save-stack';\nimport fetchEntities from './internal/fetch-entities';\nimport removeEntities from './internal/remove-entities';\nimport offset from './internal/offset';\nimport clear from './internal/clear';\nimport onUpdate from './internal/on-update';\nimport onInit from './internal/on-init';\nimport Command from './history-command';\nimport Entry from './history-entry';\nimport Highlight from './history-highlight';\nimport editText from './action/edit-text';\nimport editEmbed from './action/edit-embed';\nimport editMap from './action/edit-map';\nimport editImage from './action/edit-image';\nimport editIcon from './action/edit-icon';\nimport editLink from './action/edit-link';\nimport sortBlock from './action/sort-block';\nimport addBlock from './action/add-block';\nimport removeBlock from './action/remove-block';\nimport addCard from './action/add-card';\nimport removeCard from './action/remove-card';\nimport editStyle from './action/edit-style';\nimport updateBlockState from './action/update-block-state';\n\n/**\n * Implements interface for works with landing history\n * Implements singleton pattern use as BX.Landing.History.getInstance()\n * @memberOf BX.Landing\n */\nexport class History\n{\n\tconstructor()\n\t{\n\t\tthis.stack = [];\n\t\tthis.commands = {};\n\t\tthis.position = -1;\n\t\tthis.state = INIT;\n\t\tthis.commandState = RESOLVED;\n\t\tthis.onStorage = this.onStorage.bind(this);\n\n\t\tEvent.bind(window, 'storage', this.onStorage);\n\n\t\tregisterBaseCommands(this)\n\t\t\t.then(loadStack)\n\t\t\t.then(saveStack)\n\t\t\t.then(onInit);\n\t}\n\n\tstatic Command = Command;\n\tstatic Entry = Entry;\n\tstatic Highlight = Highlight;\n\tstatic Action = {\n\t\teditText,\n\t\teditEmbed,\n\t\teditMap,\n\t\teditImage,\n\t\teditIcon,\n\t\teditLink,\n\t\tsortBlock,\n\t\taddBlock,\n\t\tremoveBlock,\n\t\taddCard,\n\t\tremoveCard,\n\t\teditStyle,\n\t\tupdateBlockState,\n\t};\n\n\tstatic getInstance(): History\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tif (!rootWindow.BX.Landing.History.instance)\n\t\t{\n\t\t\trootWindow.BX.Landing.History.instance = new BX.Landing.History();\n\t\t}\n\n\t\treturn rootWindow.BX.Landing.History.instance;\n\t}\n\n\t/**\n\t * Applies preview history entry\n\t * @return {Promise}\n\t */\n\tundo()\n\t{\n\t\tif (this.canUndo())\n\t\t{\n\t\t\treturn offset(this, -1).then(saveStack).then(onUpdate);\n\t\t}\n\n\t\treturn Promise.resolve(this);\n\t}\n\n\n\t/**\n\t * Applies preview next history entry\n\t * @return {Promise}\n\t */\n\tredo()\n\t{\n\t\tif (this.canRedo())\n\t\t{\n\t\t\treturn offset(this, 1).then(saveStack).then(onUpdate);\n\t\t}\n\n\t\treturn Promise.resolve(this);\n\t}\n\n\n\t/**\n\t * Check that there are actions to undo\n\t * @returns {boolean}\n\t */\n\tcanUndo()\n\t{\n\t\treturn (\n\t\t\t(this.position > 0 && this.state === REDO)\n\t\t\t|| (this.position > 0 && this.state === UNDO)\n\t\t\t|| (this.position === 0 && this.state !== UNDO)\n\t\t);\n\t}\n\n\n\t/**\n\t * Check that there are actions to redo\n\t * @returns {boolean}\n\t */\n\tcanRedo()\n\t{\n\t\treturn (\n\t\t\t(this.position < this.stack.length - 1 && this.state !== INIT)\n\t\t\t|| (this.position !== -1 && this.position === this.stack.length - 1 && this.state !== REDO)\n\t\t);\n\t}\n\n\n\t/**\n\t * Adds entry to history stack\n\t * @param {BX.Landing.History.Entry} entry\n\t */\n\tpush(entry)\n\t{\n\t\tlet startIndex = this.position + 1;\n\t\tconst deleteCount = this.stack.length;\n\n\t\tif (this.state === UNDO)\n\t\t{\n\t\t\tstartIndex -= 1;\n\t\t}\n\n\t\tconst deletedEntries = this.stack.splice(startIndex, deleteCount, entry);\n\n\t\tif (this.stack.length > MAX_ENTRIES_COUNT)\n\t\t{\n\t\t\tdeletedEntries.push(this.stack.shift());\n\t\t}\n\n\t\tif (deletedEntries.length)\n\t\t{\n\t\t\tvoid this.onNewBranch(deletedEntries);\n\t\t}\n\n\t\tthis.position = this.stack.length - 1;\n\t\tthis.state = REDO;\n\t\tsaveStack(this).then(onUpdate);\n\t}\n\n\n\t/**\n\t * Registers unique history command\n\t * @param {Command} command\n\t */\n\tregisterCommand(command)\n\t{\n\t\tif (command instanceof Command)\n\t\t{\n\t\t\tthis.commands[command.id] = command;\n\t\t}\n\t}\n\n\n\t/**\n\t * Removes page history from storage\n\t * @param {int} pageId\n\t * @return {Promise<BX.Landing.History>}\n\t */\n\tremovePageHistory(pageId)\n\t{\n\t\treturn removePageHistory(pageId, this)\n\t\t\t.then((history) => {\n\t\t\t\tlet currentPageId;\n\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tcurrentPageId = BX.Landing.Main.getInstance().id;\n\t\t\t\t}\n\t\t\t\tcatch (err)\n\t\t\t\t{\n\t\t\t\t\tcurrentPageId = -1;\n\t\t\t\t}\n\n\t\t\t\tif (currentPageId === pageId)\n\t\t\t\t{\n\t\t\t\t\treturn clear(history);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.reject();\n\t\t\t})\n\t\t\t.then(onUpdate)\n\t\t\t.catch(() => {});\n\t}\n\n\n\t/**\n\t * Handles storage event\n\t * @param {StorageEvent} event\n\t */\n\tonStorage(event)\n\t{\n\t\tif (event.key === null)\n\t\t{\n\t\t\tif (!window.localStorage.history)\n\t\t\t{\n\t\t\t\tclear(this).then(onUpdate);\n\t\t\t}\n\t\t}\n\t}\n\n\n\t/**\n\t * Handles new branch events\n\t * @param {BX.Landing.History.Entry[]} entries\n\t * @return {Promise<History>}\n\t */\n\tonNewBranch(entries)\n\t{\n\t\treturn fetchEntities(entries, this)\n\t\t\t.then((entities) => {\n\t\t\t\treturn removeEntities(entities, this);\n\t\t\t});\n\t}\n}"],"names":["UNDO","REDO","INIT","RESOLVED","PENDING","MAX_ENTRIES_COUNT","BX","Landing","Utils","scrollTo","highlight","editText","state","entry","PageObject","getInstance","blocks","then","block","get","Promise","reject","forceInit","node","nodes","getBySelector","selector","bind","setValue","editEmbed","editMap","editImage","id","editIcon","editLink","sortBlock","addBlock","currentBlock","resolve","landing","Main","view","iframe","currentArea","contentDocument","body","querySelector","lid","onAddBlock","code","removeBlock","deleteBlock","addCard","container","params","index","content","html","card","cards","catch","removeCard","slice","editStyle","initStyles","elements","querySelectorAll","forEach","element","className","style","form","forms","find","currentForm","relativeSelector","fields","field","reset","onFrameLoad","styleNode","styles","onStyleInputWithDebounce","data","getValue","updateBlockState","clone","Command","options","Type","isStringFilled","undo","isFunction","redo","registerBaseCommands","history","registerCommand","worker","Worker","asyncJsonParse","str","postMessage","addEventListener","event","asyncJsonStringify","obj","removePageHistory","pageId","window","localStorage","historyData","isPlainObject","all","allString","loadStack","currentPageId","err","landingData","Object","keys","stack","key","push","History","Entry","shift","position","Math","min","Text","toNumber","length","saveStack","fetchEntities","items","entities","images","item","command","removeEntities","offset","offsetValue","commandState","commands","clear","onUpdate","rootWindow","getRootWindow","onCustomEvent","onInit","Highlight","layout","classList","add","animationDuration","rect","UI","prototype","show","call","setTimeout","hide","instance","HighlightNode","onStorage","Event","canUndo","canRedo","startIndex","deleteCount","deletedEntries","splice","onNewBranch","entries"],"mappings":"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"}