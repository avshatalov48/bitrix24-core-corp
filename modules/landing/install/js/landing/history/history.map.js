{"version":3,"sources":["history.js"],"names":["BX","namespace","UNDO","REDO","INIT","RESOLVED","PENDING","MAX_ENTRIES_COUNT","isPlainObject","Landing","Utils","bind","fireCustomEvent","History","this","stack","commands","position","state","commandState","onStorage","window","registerBaseCommands","then","load","save","onInit","instance","getInstance","top","history","registerCommand","Command","id","undo","Action","editText","redo","editEmbed","editMap","editImage","editIcon","editLink","sortBlock","removeBlock","addBlock","editStyle","removeCard","addCard","updateBlockState","Promise","resolve","asyncParse","str","worker","Worker","postMessage","addEventListener","event","data","asyncStringify","obj","currentPageId","Main","err","localStorage","historyData","reject","landingData","Object","keys","forEach","key","index","push","Entry","shift","Math","min","parseInt","length","catch","all","allString","clear","removePageHistory","pageId","offset","entry","command","onUpdate","onActualize","onNewBranch","removeEntities","entities","fetchEntities","items","blocks","images","item","block","prototype","canUndo","canRedo","startIndex","deleteCount","deletedEntries","splice","entries"],"mappings":"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","file":"history.map.js"}