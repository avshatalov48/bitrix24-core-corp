this.BX=this.BX||{};(function(e,t,r,o,i,a,n,l){"use strict";var s=new Map;s.set("business-light",{theme:"business-light",dark:false,style:"",color:{primary:"#0f58d0ff",primaryText:"#ffffffff",background:"#ffffffff",text:"#000000ff",fieldBackground:"#00000011",fieldFocusBackground:"#ffffffff",fieldBorder:"#00000016"},shadow:true,font:{uri:"",family:""},border:{left:false,top:false,bottom:true,right:false}});s.set("business-dark",{theme:"business-dark",dark:true,style:"",color:{primary:"#0f58d0ff",primaryText:"#ffffffff",background:"#282d30ff",text:"#ffffffff",fieldBackground:"#ffffff11",fieldFocusBackground:"#00000028",fieldBorder:"#ffffff16"},shadow:true,font:{uri:"",family:""},border:{left:false,top:false,bottom:true,right:false}});s.set("modern-light",{theme:"modern-light",dark:false,style:"modern",color:{primary:"#ffd110ff",primaryText:"#000000ff",background:"#ffffffff",text:"#000000ff",fieldBackground:"#00000000",fieldFocusBackground:"#00000000",fieldBorder:"#00000011"},shadow:true,font:{uri:"https://fonts.googleapis.com/css?family=Open+Sans:400,600&display=swap&subset=cyrillic",family:"Open Sans"},border:{left:false,top:false,bottom:true,right:false}});s.set("modern-dark",{theme:"modern-dark",dark:true,style:"modern",color:{primary:"#ffd110ff",primaryText:"#000000ff",background:"#282d30ff",text:"#ffffffff",fieldBackground:"#00000000",fieldFocusBackground:"#00000000",fieldBorder:"#ffffff11"},shadow:true,font:{uri:"https://fonts.googleapis.com/css?family=Open+Sans:400,600&display=swap&subset=cyrillic",family:"Open Sans"},border:{left:false,top:false,bottom:true,right:false}});s.set("classic-light",{theme:"classic-light",dark:false,style:"",color:{primary:"#000000ff",primaryText:"#ffffffff",background:"#ffffffff",text:"#000000ff",fieldBackground:"#00000011",fieldFocusBackground:"#0000000a",fieldBorder:"#00000011"},shadow:true,font:{uri:"https://fonts.googleapis.com/css?family=PT+Serif:400,700&display=swap&subset=cyrillic",family:"PT Serif"},border:{left:false,top:false,bottom:true,right:false}});s.set("classic-dark",{theme:"classic-dark",dark:true,style:"",color:{primary:"#ffffffff",primaryText:"#000000ff",background:"#000000ff",text:"#ffffffff",fieldBackground:"#ffffff11",fieldFocusBackground:"#ffffff0a",fieldBorder:"#ffffff11"},shadow:true,font:{uri:"https://fonts.googleapis.com/css?family=PT+Serif:400,700&display=swap&subset=cyrillic",family:"PT Serif"},border:{left:false,top:false,bottom:true,right:false}});s.set("fun-light",{theme:"fun-light",dark:false,style:"",color:{primary:"#f09b22ff",primaryText:"#000000ff",background:"#ffffffff",text:"#000000ff",fieldBackground:"#f09b2211",fieldFocusBackground:"#0000000a",fieldBorder:"#00000011"},shadow:true,font:{uri:"https://fonts.googleapis.com/css?family=Pangolin&display=swap&subset=cyrillic",family:"Pangolin"},border:{left:false,top:false,bottom:true,right:false}});s.set("fun-dark",{theme:"fun-dark",dark:true,style:"",color:{primary:"#f09b22ff",primaryText:"#000000ff",background:"#221400ff",text:"#ffffffff",fieldBackground:"#f09b2211",fieldFocusBackground:"#ffffff0a",fieldBorder:"#f09b220a"},shadow:true,font:{uri:"https://fonts.googleapis.com/css?family=Pangolin&display=swap&subset=cyrillic",family:"Pangolin"},border:{left:false,top:false,bottom:true,right:false}});s.set("pixel-light",{theme:"pixel-light",dark:true,style:"",color:{primary:"#00a74cff",primaryText:"#ffffffff",background:"#282d30ff",text:"#90ee90ff",fieldBackground:"#ffffff11",fieldFocusBackground:"#00000028",fieldBorder:"#ffffff16"},shadow:true,font:{uri:"https://fonts.googleapis.com/css?family=Press+Start+2P&display=swap&subset=cyrillic",family:"Press Start 2P"},border:{left:false,top:false,bottom:true,right:false}});s.set("pixel-dark",babelHelpers.objectSpread({},s.get("pixel-light"),{theme:"pixel-dark"}));var f=function(e){babelHelpers.inherits(r,e);function r(e){var o;babelHelpers.classCallCheck(this,r);o=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).call(this));o.setEventNamespace("BX.Landing.FormStyleAdapter");o.options=babelHelpers.objectSpread({},e);o.cache=new t.Cache.MemoryCache;o.onDebouncedFormChange=t.Runtime.debounce(o.onDebouncedFormChange,500);return o}babelHelpers.createClass(r,[{key:"setFormOptions",value:function e(t){this.cache.set("formOptions",babelHelpers.objectSpread({},t))}},{key:"getFormOptions",value:function e(){return this.cache.get("formOptions")}},{key:"load",value:function e(){var r=this;if(t.Text.capitalize(l.Env.getInstance().getOptions().params.type)==="SMN"){this.setFormOptions({data:{design:t.Runtime.clone(this.getCrmForm().design)}});return Promise.resolve(this)}return t.Runtime.loadExtension("crm.form.client").then(function(e){var o=e.FormClient;if(o){return o.getInstance().getOptions(r.options.formId).then(function(e){r.setFormOptions(t.Runtime.merge(t.Runtime.clone(e),{data:{design:t.Runtime.clone(r.getCrmForm().design)}}));return r})}return null})}},{key:"getThemeField",value:function e(){var r=this;return this.cache.remember("themeField",function(){var e=r.getFormOptions().data.design.theme;return new BX.Landing.UI.Field.Dropdown({selector:"theme",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_THEME_FIELD_TITLE"),content:t.Type.isString(e)?e.split("-")[0]:"",onChange:r.onThemeChange.bind(r),items:[{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_THEME_FIELD_ITEM_BUSINESS"),value:"business"},{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_THEME_FIELD_ITEM_MODERN"),value:"modern"},{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_THEME_FIELD_ITEM_CLASSIC"),value:"classic"},{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_THEME_FIELD_ITEM_FUN"),value:"fun"},{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_THEME_FIELD_ITEM_PIXEL"),value:"pixel"}]})})}},{key:"getDarkField",value:function e(){var r=this;return this.cache.remember("darkField",function(){var e=r.getFormOptions().data.design.theme;return new BX.Landing.UI.Field.Dropdown({selector:"dark",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_DARK_FIELD_TITLE"),content:t.Type.isString(e)?e.split("-")[1]:"",onChange:r.onThemeChange.bind(r),items:[{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_DARK_FIELD_ITEM_LIGHT"),value:"light"},{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_DARK_FIELD_ITEM_DARK"),value:"dark"}]})})}},{key:"onThemeChange",value:function e(){var r=this.getStyleForm().serialize().theme;var o=s.get(r);if(o){if(t.Type.isPlainObject(o.color)){this.getPrimaryColorField().setValue(o.color.primary,true);this.getPrimaryTextColorField().setValue(o.color.primaryText,true);this.getBackgroundColorField().setValue(o.color.background);this.getTextColorField().setValue(o.color.text,true);this.getFieldBackgroundColorField().setValue(o.color.fieldBackground,true);this.getFieldFocusBackgroundColorField().setValue(o.color.fieldFocusBackground,true);this.getFieldBorderColorField().setValue(o.color.fieldBorder)}this.getStyleField().setValue(o.style);if(t.Type.isBoolean(o.shadow)){this.getShadowField().setValue(o.shadow)}if(t.Type.isPlainObject(o.font)){var a=babelHelpers.objectSpread({},o.font);if(!t.Type.isStringFilled(a.family)){a.family=i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_FONT_DEFAULT")}this.getFontField().setValue(a)}if(t.Type.isPlainObject(o.border)){var n=Object.entries(o.border).reduce(function(e,t){var r=babelHelpers.slicedToArray(t,2),o=r[0],i=r[1];if(i){e.push(o)}return e},[]);this.getBorderField().setValue(n)}}}},{key:"getShadowField",value:function e(){var t=this;return this.cache.remember("shadow",function(){return new BX.Landing.UI.Field.Dropdown({selector:"shadow",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_SHADOW"),content:t.getFormOptions().data.design.shadow,items:[{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_SHADOW_USE"),value:true},{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_SHADOW_NOT_USE"),value:false}]})})}},{key:"getStyleField",value:function e(){var t=this;return this.cache.remember("styleField",function(){return new BX.Landing.UI.Field.Dropdown({selector:"style",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_STYLE_FIELD_TITLE"),content:t.getFormOptions().data.design.style,items:[{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_STYLE_FIELD_ITEM_STANDARD"),value:""},{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_STYLE_FIELD_ITEM_MODERN"),value:"modern"}]})})}},{key:"getPrimaryColorField",value:function e(){var t=this;return this.cache.remember("primaryColorField",function(){return new a.ColorPickerField({selector:"primary",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_PRIMARY_COLOR"),value:t.getFormOptions().data.design.color.primary})})}},{key:"getPrimaryTextColorField",value:function e(){var t=this;return this.cache.remember("primaryTextColorField",function(){return new a.ColorPickerField({selector:"primaryText",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_PRIMARY_TEXT_COLOR"),value:t.getFormOptions().data.design.color.primaryText})})}},{key:"getBackgroundColorField",value:function e(){var t=this;return this.cache.remember("backgroundColorField",function(){return new a.ColorPickerField({selector:"background",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_BACKGROUND_COLOR"),value:t.getFormOptions().data.design.color.background})})}},{key:"getTextColorField",value:function e(){var t=this;return this.cache.remember("textColorField",function(){return new a.ColorPickerField({selector:"text",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_TEXT_COLOR"),value:t.getFormOptions().data.design.color.text})})}},{key:"getFieldBackgroundColorField",value:function e(){var t=this;return this.cache.remember("fieldBackgroundColorField",function(){return new a.ColorPickerField({selector:"fieldBackground",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_FIELD_BACKGROUND_COLOR"),value:t.getFormOptions().data.design.color.fieldBackground})})}},{key:"getFieldFocusBackgroundColorField",value:function e(){var t=this;return this.cache.remember("fieldFocusBackgroundColorField",function(){return new a.ColorPickerField({selector:"fieldFocusBackground",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_FIELD_FOCUS_BACKGROUND_COLOR"),value:t.getFormOptions().data.design.color.fieldFocusBackground})})}},{key:"getFieldBorderColorField",value:function e(){var t=this;return this.cache.remember("fieldBorderColorField",function(){return new a.ColorPickerField({selector:"fieldBorder",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_FIELD_BORDER_COLOR"),value:t.getFormOptions().data.design.color.fieldBorder})})}},{key:"getFontField",value:function e(){var r=this;return this.cache.remember("fontField",function(){var e=babelHelpers.objectSpread({},r.getFormOptions().data.design.font);if(!t.Type.isStringFilled(e.family)){e.family=i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_FONT_DEFAULT")}return new BX.Landing.UI.Field.Font({selector:"font",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_FONT"),headlessMode:true,value:e})})}},{key:"getBorderField",value:function e(){var t=this;return this.cache.remember("borderField",function(){return new BX.Landing.UI.Field.Checkbox({selector:"border",title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_BORDER"),value:function(){var e=t.getFormOptions().data.design.border;return Object.entries(e).reduce(function(e,t){var r=babelHelpers.slicedToArray(t,2),o=r[0],i=r[1];if(i){e.push(o)}return e},[])}(),items:[{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_BORDER_LEFT"),value:"left"},{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_BORDER_RIGHT"),value:"right"},{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_BORDER_TOP"),value:"top"},{name:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_BORDER_BOTTOM"),value:"bottom"}]})})}},{key:"getStyleForm",value:function e(){var r=this;return this.cache.remember("styleForm",function(){return new o.StyleForm({title:i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_FORM_TITLE"),fields:[r.getThemeField(),r.getDarkField(),r.getStyleField(),r.getShadowField(),r.getPrimaryColorField(),r.getPrimaryTextColorField(),r.getBackgroundColorField(),r.getTextColorField(),r.getFieldBackgroundColorField(),r.getFieldFocusBackgroundColorField(),r.getFieldBorderColorField(),r.getFontField(),r.getBorderField()],onChange:t.Runtime.throttle(r.onFormChange.bind(r),16),serializeModifier:function e(r){r.theme="".concat(r.theme,"-").concat(r.dark);r.dark=r.dark==="dark";r.shadow=t.Text.toBoolean(r.shadow);r.color={primary:r.primary,primaryText:r.primaryText,text:r.text,background:r.background,fieldBackground:r.fieldBackground,fieldFocusBackground:r.fieldFocusBackground,fieldBorder:r.fieldBorder};r.border={left:r.border.includes("left"),right:r.border.includes("right"),top:r.border.includes("top"),bottom:r.border.includes("bottom")};if(r.font.family===i.Loc.getMessage("LANDING_FORM_STYLE_ADAPTER_FONT_DEFAULT")){delete r.font}delete r.primary;delete r.primaryText;delete r.text;delete r.background;delete r.fieldBackground;delete r.fieldFocusBackground;delete r.fieldBorder;return r}})})}},{key:"getCrmForm",value:function e(){var r=t.Reflection.getClass("b24form.App");if(r){if(this.options.instanceId){return r.get(this.options.instanceId)}return r.list()[0]}return null}},{key:"onFormChange",value:function e(r){var o=this.getFormOptions();var i={data:{design:r.getTarget().serialize()}};var a=t.Runtime.merge(o,i);this.setFormOptions(a);this.getCrmForm().adjust(a.data);this.onDebouncedFormChange()}},{key:"isCrmFormPage",value:function e(){return l.Env.getInstance().getOptions().specialType==="crm_forms"}},{key:"saveFormDesign",value:function e(){var r=this;return t.Runtime.loadExtension("crm.form.client").then(function(e){var t=e.FormClient;if(t){var o=t.getInstance();var i=r.getFormOptions();o.resetCache(i.id);return o.saveOptions(i)}return null})}},{key:"saveBlockDesign",value:function e(){var r=this;var o=this.options.currentBlock;var i=this.getFormOptions().data.design;var a=o.node.querySelector(".bitrix24forms");t.Dom.attr(a,{"data-b24form-design":i,"data-b24form-use-style":"Y"});t.Runtime.loadExtension("crm.form.client").then(function(e){var t=e.FormClient;if(t){var o=t.getInstance();var i=r.getFormOptions();o.resetCache(i.id)}});n.Backend.getInstance().action("Landing\\Block::updateNodes",{block:o.id,data:{".bitrix24forms":{attrs:{"data-b24form-design":JSON.stringify(i),"data-b24form-use-style":"Y"}}},lid:o.lid,siteId:o.siteId},{code:o.manifest.code})}},{key:"onDebouncedFormChange",value:function e(){var r=this;if(this.isCrmFormPage()){t.Runtime.loadExtension("landing.ui.panel.formsettingspanel").then(function(e){var t=e.FormSettingsPanel;var o=t.getInstance();o.setCurrentBlock(r.options.currentBlock);void r.saveFormDesign();if(o.useBlockDesign()){o.disableUseBlockDesign()}})}else{this.saveBlockDesign()}}}]);return r}(r.EventEmitter);e.FormStyleAdapter=f})(this.BX.Landing=this.BX.Landing||{},BX,BX.Event,BX.Landing.UI.Form,BX.Landing,BX.Landing.Ui.Field,BX.Landing,BX.Landing);
//# sourceMappingURL=formstyleadapter.bundle.map.js