{"version":3,"file":"uifilterconverter.bundle.js","sources":["../src/uifilterconverter.js"],"sourcesContent":["import {Type} from 'main.core';\nimport {Runtime} from 'main.core';\n\nexport class UiFilterConverter\n{\n\tconstructor(options = {\n\t\tfilterId: '',\n\t\tuseQuickSearch: false,\n\t\tquickSearchField: {\n\t\t\tname: '',\n\t\t\tfield: ''\n\t\t}\n\t})\n\t{\n\t\tthis.filterId = options.filterId;\n\t\tthis.useQuickSearch = options.useQuickSearch;\n\t\tthis.quickSearchField = options.quickSearchField;\n\n\t\tthis.filter = null; // BX.Main.filterManager.getById\n\n\t\tthis.currentPreset = [];\n\t\tthis.currentFields = [];\n\n\t\tthis.sourceFilter = [];\n\t}\n\n\tgetFilterId()\n\t{\n\t\treturn this.filterId;\n\t}\n\n\tgetFilter()\n\t{\n\t\tthis.sourceFilter = [];\n\t\tthis.initFilter();\n\t\tif (!Type.isNil(this.filter))\n\t\t{\n\t\t\tthis.parseFilterRows();\n\t\t\tthis.parseQuickSearchValue();\n\t\t}\n\t\treturn this.sourceFilter;\n\t}\n\n\tparseFilterRows()\n\t{\n\t\tconst searchFieldData = this.filter.getSearch().prepareSquaresData(\n\t\t\tthis.currentFields\n\t\t);\n\t\tthis.sourceFilter = searchFieldData.map((item) => {\n\t\t\tconst field = this.currentFields.find((currentField) => {\n\t\t\t\treturn (\n\t\t\t\t\tcurrentField.NAME === item.value\n\t\t\t\t\t&& !this.filter.getPreset().isEmptyField(currentField)\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tconst row = {\n\t\t\t\tname: item.name,\n\t\t\t\tkey: field.NAME,\n\t\t\t\tvalue: Runtime.clone(field.VALUE || field.VALUES)\n\t\t\t};\n\t\t\tif (Type.isString(row.value))\n\t\t\t{\n\t\t\t\trow.value = {VALUE: row.value};\n\t\t\t}\n\t\t\tif (Type.isPlainObject(field.SUB_TYPE))\n\t\t\t{\n\t\t\t\trow.value.SUB_TYPE = field.SUB_TYPE.VALUE;\n\t\t\t}\n\n\t\t\treturn row;\n\t\t});\n\t}\n\n\tparseQuickSearchValue()\n\t{\n\t\tif (this.useQuickSearch)\n\t\t{\n\t\t\tconst quickSearchValue = this.filter.getSearch().getSearchString();\n\n\t\t\tif (quickSearchValue !== '')\n\t\t\t{\n\t\t\t\tconst row = { VALUE: quickSearchValue, QUICK_SEARCH: 'Y' };\n\t\t\t\tconst name = `${this.quickSearchField.name}: ${quickSearchValue}`;\n\n\t\t\t\tlet found = false;\n\t\t\t\tif (this.sourceFilter.length > 0)\n\t\t\t\t{\n\t\t\t\t\tconst index = this.sourceFilter.findIndex(({key}) => key === this.quickSearchField.field);\n\t\t\t\t\tif (index > -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\tthis.sourceFilter[index].name = name;\n\t\t\t\t\t\tthis.sourceFilter[index].value = row;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!found)\n\t\t\t\t{\n\t\t\t\t\tthis.sourceFilter.push({\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\tkey: this.quickSearchField.field,\n\t\t\t\t\t\tvalue: row\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFilter()\n\t{\n\t\tif (this.filter === null)\n\t\t{\n\t\t\t// eslint-disable-next-line\n\t\t\tthis.filter = BX.Main.filterManager.getById(this.getFilterId());\n\t\t}\n\t\tif (!Type.isNil(this.filter))\n\t\t{\n\t\t\tthis.currentPreset = this.filter.getPreset().getCurrentPresetData();\n\t\t\tthis.currentFields = [...this.currentPreset.FIELDS, ...this.currentPreset.ADDITIONAL];\n\t\t}\n\t}\n}"],"names":["UiFilterConverter","options","filterId","useQuickSearch","quickSearchField","name","field","filter","currentPreset","currentFields","sourceFilter","initFilter","Type","isNil","parseFilterRows","parseQuickSearchValue","searchFieldData","getSearch","prepareSquaresData","map","item","find","currentField","NAME","value","getPreset","isEmptyField","row","key","Runtime","clone","VALUE","VALUES","isString","isPlainObject","SUB_TYPE","quickSearchValue","getSearchString","QUICK_SEARCH","found","length","index","findIndex","push","BX","Main","filterManager","getById","getFilterId","getCurrentPresetData","FIELDS","ADDITIONAL"],"mappings":"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"}