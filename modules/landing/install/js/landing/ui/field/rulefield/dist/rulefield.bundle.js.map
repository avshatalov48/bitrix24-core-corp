{"version":3,"file":"rulefield.bundle.js","sources":["../src/internal/field-element/field-element.js","../src/internal/field-rules/internal/rule-entry/internal/value-settings-items.js","../src/internal/field-rules/internal/rule-entry/rule-entry.js","../src/internal/field-rules/field-rules.js","../src/rulefield.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {Cache, Tag} from 'main.core';\nimport {IconButton} from 'landing.ui.component.iconbutton';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\n\nimport './css/style.css';\n\ntype FieldElementOptions = {\n\tid: string,\n\ttitle: string,\n\tremovable?: boolean,\n\tdraggable?: boolean,\n\tactionsLabel?: string,\n\tactionsList?: Array<{name: string, value: any}>,\n\tactionsValue?: any,\n\tonRemove?: () => void,\n\t// eslint-disable-next-line no-use-before-define\n\tcolor?: $Values<typeof FieldElement.Colors>\n};\n\nconst defaultOptions = {\n\tremovable: true,\n\tdraggable: false,\n\t// eslint-disable-next-line no-use-before-define\n\tcolor: 'blue',\n};\n\nexport class FieldElement extends EventEmitter\n{\n\tstatic Colors = {\n\t\tblue: 'blue',\n\t\tgreen: 'green',\n\t\tred: 'red',\n\t};\n\n\tconstructor(options: FieldElementOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.RuleField.FieldElement');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\t\tthis.options = {...defaultOptions, ...options};\n\t\tthis.cache = new Cache.MemoryCache();\n\t}\n\n\tgetDragButtonLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('dragButton', () => {\n\t\t\tconst button = new IconButton({\n\t\t\t\ttype: IconButton.Types.drag,\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '20px',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn button.getLayout();\n\t\t});\n\t}\n\n\tgetActionsDropdown(): BX.Landing.UI.Field.DropdownInline\n\t{\n\t\treturn this.cache.remember('actionsDropdown', () => {\n\t\t\tconst field = new window.top.BX.Landing.UI.Field.DropdownInline({\n\t\t\t\ttitle: this.options.actionsLabel,\n\t\t\t\titems: this.options.actionsList,\n\t\t\t\tcontent: this.options.actionsValue,\n\t\t\t});\n\n\t\t\tfield.subscribe('onChange', () => {\n\t\t\t\tthis.emit('onChange');\n\t\t\t});\n\n\t\t\treturn field;\n\t\t});\n\t}\n\n\tgetActionsLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('actionsLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-element-text-action\">\n\t\t\t\t\t${this.getActionsDropdown().getLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('titleLayout', () => {\n\t\t\treturn Tag.render`<div class=\"landing-ui-field-element-text-title\">${this.options.title}</div>`;\n\t\t});\n\t}\n\n\tgetRemoveButtonLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\tconst button = new IconButton({\n\t\t\t\ttype: IconButton.Types.remove,\n\t\t\t\tonClick: () => this.emit('onRemove'),\n\t\t\t\ticonSize: '9px',\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '20px',\n\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn button.getLayout();\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-element-${this.options.color}\">\n\t\t\t\t\t${this.options.draggable ? this.getDragButtonLayout() : ''}\n\t\t\t\t\t<div class=\"landing-ui-field-element-text\">\n\t\t\t\t\t\t${this.options.actionsLabel ? this.getActionsLayout() : ''}\n\t\t\t\t\t\t${this.getTitleLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.options.removable ? this.getRemoveButtonLayout() : ''}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n}","import {Loc} from 'landing.loc';\n\nexport const listValueSettingsItems = [\n\t{\n\t\tvalue: 'equal',\n\t\tlabel: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_SETTINGS_EQUAL'),\n\t},\n\t{\n\t\tvalue: 'not-equal',\n\t\tlabel: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_SETTINGS_NOT_EQUAL'),\n\t},\n];","import {Cache, Dom, Tag, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\nimport {IconButton} from 'landing.ui.component.iconbutton';\nimport {Loc} from 'landing.loc';\nimport {Popup} from 'main.popup';\nimport {Draggable} from 'ui.draganddrop.draggable';\nimport {PageObject} from 'landing.pageobject';\nimport {TextField} from 'landing.ui.field.textfield';\nimport {FieldElement} from '../../../field-element/field-element';\nimport {listValueSettingsItems} from './internal/value-settings-items';\nimport type {RuleEntryOptions} from '../../../../types/rule-field-options';\n\nimport './css/style.css';\n\ntype ExpressionEntry = {\n\tfield: string,\n\taction: 'show' | 'hide',\n};\n\ntype RuleEntryState = {\n\tcondition: {\n\t\tfield: string,\n\t\tvalue: any,\n\t\toperator: '=' | '!=',\n\t},\n\texpression: Array<ExpressionEntry>,\n};\n\nexport class RuleEntry extends EventEmitter\n{\n\tstate: RuleEntryState;\n\n\tconstructor(options: RuleEntryOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.RuleField.RuleEntry');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\t\tthis.options = {...options};\n\t\tthis.cache = new Cache.MemoryCache();\n\n\t\tthis.draggable = new Draggable({\n\t\t\tcontainer: this.getExpressionContainer(),\n\t\t\tdragElement: '.landing-ui-button-icon-drag',\n\t\t\tdraggable: '.landing-ui-field-element-green',\n\t\t\ttype: Draggable.HEADLESS,\n\t\t\tcontext: window.parent,\n\t\t\toffset: {\n\t\t\t\ty: -62,\n\t\t\t},\n\t\t});\n\n\t\tthis.draggable.subscribe('end', this.onDragEnd.bind(this));\n\n\t\tthis.state = {\n\t\t\tcondition: {\n\t\t\t\tfield: this.options.condition.field.id,\n\t\t\t\tvalue: this.options.condition.value,\n\t\t\t\toperator: this.options.condition.operator,\n\t\t\t},\n\t\t\texpression: this.options.expression.map((item) => {\n\t\t\t\treturn {\n\t\t\t\t\tfield: item.field.id,\n\t\t\t\t\taction: item.action,\n\t\t\t\t};\n\t\t\t}),\n\t\t};\n\n\t\tthis.options.expression.forEach((item) => {\n\t\t\tthis.addExpressionItem({\n\t\t\t\tid: item.field.id,\n\t\t\t\tlabel: item.field.label,\n\t\t\t\taction: item.action,\n\t\t\t\tpreventEvent: true,\n\t\t\t});\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\trenderSeparator(): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"value-settings-item-separator\"></div>\n\t\t`;\n\t}\n\n\trenderOperatorRadioButton({label, value, id, checked = false}): HTMLDivElement\n\t{\n\t\tconst onChanage = () => {\n\t\t\tif (value === 'equal')\n\t\t\t{\n\t\t\t\tthis.getOperatorLabelLayout().textContent = Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_EQUALS');\n\t\t\t\tthis.state.condition.operator = '=';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getOperatorLabelLayout().textContent = Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_NOT_EQUALS');\n\t\t\t\tthis.state.condition.operator = '!=';\n\t\t\t}\n\n\t\t\tthis.emit('onChange');\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"value-settings-item\">\n\t\t\t\t<input \n\t\t\t\t\ttype=\"radio\" \n\t\t\t\t\tid=\"operator_${id}_${value}\" \n\t\t\t\t\tname=\"operator_${id}_${this.options.condition.field.id}\"\n\t\t\t\t\tonchange=\"${onChanage}\"\n\t\t\t\t\t${checked ? 'checked' : ''}\n\t\t\t\t>\n\t\t\t\t<label for=\"operator_${id}_${value}\">${label}</label>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderValueRadioButton({label, value, id, checked}): HTMLDivElement\n\t{\n\t\tconst onChange = () => {\n\t\t\tthis.setValueLabelText(label);\n\t\t\tthis.state.condition.value = value;\n\n\t\t\tthis.emit('onChange');\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"value-settings-item value-settings-item-value\">\n\t\t\t\t<input \n\t\t\t\t\ttype=\"radio\" \n\t\t\t\t\tid=\"value_${id}_${value}\" \n\t\t\t\t\tname=\"value_${id}_${this.options.condition.field.id}\"\n\t\t\t\t\tonchange=\"${onChange}\"\n\t\t\t\t\t${checked ? 'checked' : ''}\n\t\t\t\t>\n\t\t\t\t<label for=\"value_${id}_${value}\">${label}</label>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetValueSettingsPopup(): Popup\n\t{\n\t\treturn this.cache.remember('valueSettingsPopup', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\tconst popupContent = Tag.render`<div class=\"value-settings-popup\"></div>`;\n\n\t\t\tconst random = Text.getRandom();\n\n\t\t\tif (\n\t\t\t\tthis.options.condition.field.type === 'list'\n\t\t\t\t|| this.options.condition.field.type === 'checkbox'\n\t\t\t\t|| this.options.condition.field.type === 'bool'\n\t\t\t)\n\t\t\t{\n\t\t\t\tlistValueSettingsItems.forEach((item, index) => {\n\t\t\t\t\tDom.append(\n\t\t\t\t\t\tthis.renderOperatorRadioButton({...item, id: random, checked: index === 0}),\n\t\t\t\t\t\tpopupContent,\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\tDom.append(this.renderSeparator(), popupContent);\n\n\t\t\t\tconst valueItems = (() => {\n\t\t\t\t\tif (this.options.condition.field.type === 'bool')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t{label: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_YES'), value: 'Y'},\n\t\t\t\t\t\t\t{label: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_NO'), value: 'N'},\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.options.condition.field.items;\n\t\t\t\t})();\n\n\t\t\t\tvalueItems.forEach((item) => {\n\t\t\t\t\tconst checked = this.options.condition.field.value === item.value;\n\t\t\t\t\tDom.append(\n\t\t\t\t\t\tDom.append(\n\t\t\t\t\t\t\tthis.renderValueRadioButton({...item, id: random, checked}),\n\t\t\t\t\t\t\tpopupContent,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tpopupContent,\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlistValueSettingsItems.forEach((item, index) => {\n\t\t\t\t\tDom.append(\n\t\t\t\t\t\tthis.renderOperatorRadioButton({...item, id: random, checked: index === 0}),\n\t\t\t\t\t\tpopupContent,\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\tDom.append(this.renderSeparator(), popupContent);\n\n\t\t\t\tconst inputField = new TextField({\n\t\t\t\t\ttextOnly: true,\n\t\t\t\t\tonValueChange: () => {\n\t\t\t\t\t\tconst conditionValue = (\n\t\t\t\t\t\t\tinputField.getValue()\n\t\t\t\t\t\t\t|| Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_EMPTY')\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.setValueLabelText(conditionValue);\n\t\t\t\t\t\tthis.state.condition.value = inputField.getValue();\n\t\t\t\t\t\tthis.emit('onChange');\n\t\t\t\t\t},\n\t\t\t\t\tcontent: this.options.condition.value,\n\t\t\t\t});\n\n\t\t\t\tDom.append(inputField.getLayout(), popupContent);\n\t\t\t}\n\n\t\t\treturn new rootWindow.BX.Main.Popup({\n\t\t\t\tbindElement: this.getConditionValueLayout(),\n\t\t\t\tcontent: popupContent,\n\t\t\t\twidth: 228,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: 8,\n\t\t\t\toffsetTop: 1,\n\t\t\t\tmaxHeight: 200,\n\t\t\t\tevents: {\n\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\tDom.addClass(\n\t\t\t\t\t\t\tthis.getConditionValueLayout(),\n\t\t\t\t\t\t\t'landing-ui-rule-entry-condition-value-active',\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.getValueSettingsPopup().adjustPosition({forceBindPosition: true});\n\t\t\t\t\t},\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tDom.removeClass(\n\t\t\t\t\t\t\tthis.getConditionValueLayout(),\n\t\t\t\t\t\t\t'landing-ui-rule-entry-condition-value-active',\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetOperatorLabelLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('operatorLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-condition-value-operator\">\n\t\t\t\t\t${Loc.getMessage(`LANDING_RULE_FIELD_CONDITION_VALUE_${this.options.condition.operator === '=' ? 'EQUALS' : 'NOT_EQUALS'}`)}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetValueLabel(): string\n\t{\n\t\tif (Type.isArray(this.options.condition.field.items))\n\t\t{\n\t\t\tconst valueItem = this.options.condition.field.items.find((item) => {\n\t\t\t\treturn item.value === this.options.condition.value;\n\t\t\t});\n\n\t\t\tif (valueItem && Type.isString(valueItem.label))\n\t\t\t{\n\t\t\t\treturn valueItem.label;\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isStringFilled(this.options.condition.value))\n\t\t{\n\t\t\tif (this.options.condition.value === 'Y')\n\t\t\t{\n\t\t\t\treturn Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_YES');\n\t\t\t}\n\n\t\t\tif (this.options.condition.value === 'N')\n\t\t\t{\n\t\t\t\treturn Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_NO');\n\t\t\t}\n\n\t\t\treturn this.options.condition.value;\n\t\t}\n\n\t\treturn Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_EMPTY');\n\t}\n\n\tgetValueLabelLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('valueLabelLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div \n\t\t\t\t\tclass=\"landing-ui-rule-entry-condition-value-value-label\"\n\t\t\t\t\tonclick=\"${this.onValueLabelClick.bind(this)}\"\n\t\t\t\t>\n\t\t\t\t\t${this.getValueLabel()}\n\t\t\t\t</div>\t\t\t\n\t\t\t`;\n\t\t});\n\t}\n\n\tsetValueLabelText(text: string)\n\t{\n\t\tthis.getValueLabelLayout().textContent = text;\n\t}\n\n\tonValueLabelClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst valueSettingsPopup = this.getValueSettingsPopup();\n\t\tif (!valueSettingsPopup.isShown())\n\t\t{\n\t\t\tvalueSettingsPopup.show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalueSettingsPopup.close();\n\t\t}\n\t}\n\n\tgetConditionValueLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('conditionValueLayout', () => {\n\t\t\t// const removeButton = new IconButton({\n\t\t\t// \ttype: IconButton.Types.remove,\n\t\t\t// \ticonSize: '9px',\n\t\t\t// \tstyle: {\n\t\t\t// \t\twidth: '19px',\n\t\t\t// \t\tmarginLeft: 'auto',\n\t\t\t// \t},\n\t\t\t// \tonClick: () => {\n\t\t\t// \t\tDom.remove(this.getLayout());\n\t\t\t// \t\tthis.emit('onRemove');\n\t\t\t// \t},\n\t\t\t// });\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-condition-value\">\n\t\t\t\t\t<div class=\"landing-ui-rule-entry-condition-value-text\">\n\t\t\t\t\t\t${this.getOperatorLabelLayout()}\n\t\t\t\t\t\t${this.getValueLabelLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetConditionContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('conditionContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-condition\">\n\t\t\t\t\t${this.getConditionValueLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetFieldsListMenu(): Menu\n\t{\n\t\treturn this.cache.remember('fieldsListMenu', () => {\n\t\t\treturn new window.top.BX.Main.Menu({\n\t\t\t\tbindElement: this.getAddFieldLink(),\n\t\t\t\tmaxHeight: 205,\n\t\t\t\titems: this.options.fieldsList\n\t\t\t\t\t.filter((field) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tfield.type !== 'page'\n\t\t\t\t\t\t\t&& field.type !== 'layout'\n\t\t\t\t\t\t);\n\t\t\t\t\t})\n\t\t\t\t\t.map((item) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\t\ttext: item.label,\n\t\t\t\t\t\t\tonclick: this.onAddExpressionField.bind(this, item),\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t});\n\t\t});\n\t}\n\n\tonExpressionItemRemove(event: BaseEvent)\n\t{\n\t\tconst target = event.getTarget();\n\n\t\tDom.remove(target.getLayout());\n\n\t\tif (this.getExpressionContainer().children.length === 1)\n\t\t{\n\t\t\tDom.removeClass(this.getLayout(), 'landing-ui-rule-entry-with-expression');\n\t\t}\n\n\t\tthis.state.expression = this.state.expression.filter((entry) => {\n\t\t\treturn entry.field !== target.options.id;\n\t\t});\n\n\t\tthis.emit('onChange');\n\t}\n\n\tonExpressionFieldChange(event: BaseEvent)\n\t{\n\t\tconst target = event.getTarget();\n\n\t\tconst expressionEntry = this.state.expression.find((currentEntry) => {\n\t\t\treturn currentEntry.field === target.options.id;\n\t\t});\n\n\t\tif (expressionEntry)\n\t\t{\n\t\t\texpressionEntry.action = target.getActionsDropdown().getValue();\n\t\t}\n\n\t\tthis.emit('onChange');\n\t}\n\n\taddExpressionItem(\n\t\toptions: {\n\t\t\tid: string,\n\t\t\tlabel: string,\n\t\t\taction: string,\n\t\t\tpreventEvent: boolean,\n\t\t},\n\t)\n\t{\n\t\tconst preparedOptions = {\n\t\t\tpreventEvent: false,\n\t\t\taction: 'show',\n\t\t\t...options,\n\t\t};\n\n\t\tconst fieldElement = new FieldElement({\n\t\t\tid: preparedOptions.id,\n\t\t\ttitle: preparedOptions.label,\n\t\t\tremovable: true,\n\t\t\tcolor: FieldElement.Colors.green,\n\t\t\tactionsLabel: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_FIELD_ACTION_LABEL'),\n\t\t\tactionsList: [\n\t\t\t\t{name: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_FIELD_ACTION_SHOW_LABEL'), value: 'show'},\n\t\t\t\t{name: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_FIELD_ACTION_HIDE_LABEL'), value: 'hide'},\n\t\t\t],\n\t\t\tactionsValue: preparedOptions.action,\n\t\t\tonRemove: this.onExpressionItemRemove.bind(this),\n\t\t\tonChange: this.onExpressionFieldChange.bind(this),\n\t\t});\n\n\t\tDom.insertBefore(fieldElement.getLayout(), this.getAddFieldLink());\n\n\t\tthis.state.expression.push({field: preparedOptions.id, action: 'show'});\n\t\tthis.state.expression = this.state.expression.reduce((acc, entry) => {\n\t\t\tif (!acc.find((accEntry) => accEntry.field === entry.field))\n\t\t\t{\n\t\t\t\tacc.push(entry);\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, []);\n\n\t\tthis.adjustExpressionItems();\n\n\t\tDom.addClass(this.getLayout(), 'landing-ui-rule-entry-with-expression');\n\n\t\tif (!preparedOptions.preventEvent)\n\t\t{\n\t\t\tthis.emit('onChange');\n\t\t}\n\t}\n\n\tonAddExpressionField(item: {id: string, label: string})\n\t{\n\t\tthis.addExpressionItem(item);\n\t\tthis.getFieldsListMenu().close();\n\t}\n\n\tadjustExpressionItems()\n\t{\n\t\t[...this.getExpressionContainer().children]\n\t\t\t.reverse()\n\t\t\t.forEach((element, index) => {\n\t\t\t\tif (!Dom.hasClass(element, 'landing-ui-rule-entry-expression-link'))\n\t\t\t\t{\n\t\t\t\t\tDom.style(element, 'z-index', index + 2);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tonAddFieldLinkClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst menu = this.getFieldsListMenu();\n\t\tconst expressionItems = this.state.expression;\n\t\tmenu.getMenuItems().forEach((item) => {\n\t\t\tconst isUsed = expressionItems.some((expressionItem) => {\n\t\t\t\treturn expressionItem.field === item.getId();\n\t\t\t});\n\n\t\t\tif (isUsed)\n\t\t\t{\n\t\t\t\tDom.addClass(item.getLayout().item, 'landing-ui-disabled');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(item.getLayout().item, 'landing-ui-disabled');\n\t\t\t}\n\t\t});\n\n\t\tthis.getFieldsListMenu().show();\n\t}\n\n\tgetAddFieldLink(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('addFieldLink', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-expression-link\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"landing-ui-rule-entry-expression-link-text\"\n\t\t\t\t\t\tonclick=\"${this.onAddFieldLinkClick.bind(this)}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('LANDING_RULE_FIELD_EXPRESSION_ADD_FIELD_LINK_LABEL')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"landing-ui-rule-entry-expression-link-sep\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetExpressionContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('expressionContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-expression\">\n\t\t\t\t\t${this.getAddFieldLink()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry\">\n\t\t\t\t\t${this.getConditionContainer()}\n\t\t\t\t\t${this.getExpressionContainer()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.state;\n\t}\n\n\tonDragEnd()\n\t{\n\t\tthis.adjustExpressionItems();\n\t\tthis.emit('onChange');\n\t}\n}","import {Cache, Dom, Tag} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Loc} from 'landing.loc';\nimport type {FieldRulesOptions, RuleEntryOptions} from '../../types/rule-field-options';\nimport {FieldElement} from '../field-element/field-element';\nimport {RuleEntry} from './internal/rule-entry/rule-entry';\n\nimport './css/style.css';\n\nexport class FieldRules extends EventEmitter\n{\n\tconstructor(options: FieldRulesOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.RuleField.FieldRow');\n\t\tthis.options = {...options};\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis.entries = [];\n\n\t\tthis.onEntryChange = this.onEntryChange.bind(this);\n\n\t\tthis.addRule(this.options);\n\t}\n\n\taddRule(ruleOptions: RuleEntryOptions)\n\t{\n\t\tconst entry = new RuleEntry({\n\t\t\t...ruleOptions,\n\t\t\tfieldsList: this.options.fields,\n\t\t});\n\t\tthis.entries.push(entry);\n\t\tentry.subscribe('onChange', this.onEntryChange);\n\t\tDom.append(entry.getLayout(), this.getListContainer());\n\t\tthis.emit('onChange');\n\t}\n\n\tonEntryChange()\n\t{\n\t\tthis.emit('onChange');\n\t}\n\n\tgetConditionFieldLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('conditionField', () => {\n\t\t\tconst fieldElement = new FieldElement({\n\t\t\t\ttitle: this.options.condition.field.label,\n\t\t\t\tremovable: true,\n\t\t\t\tonRemove: this.onConditionFieldRemoveClick.bind(this),\n\t\t\t});\n\n\t\t\treturn fieldElement.getLayout();\n\t\t});\n\t}\n\n\tonConditionFieldRemoveClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tDom.remove(this.getLayout());\n\t\tthis.entries = [];\n\t\tthis.emit('onChange');\n\t}\n\n\tgetFieldContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('fieldContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-rule-field-row-field-container\">\n\t\t\t\t\t<div class=\"landing-ui-field-rule-field-row-field-container-title\">\n\t\t\t\t\t\t${Loc.getMessage('LANDING_RULE_FIELD_CONDITION_FIELD_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getConditionFieldLayout()}\n\t\t\t\t\t<div class=\"landing-ui-field-rule-field-row-field-container-action-title\">\n\t\t\t\t\t\t${Loc.getMessage('LANDING_RULE_FIELD_CONDITION_FIELD_SHOW_ACTION_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetListContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('listContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-rule-field-row-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-rule-field-row\">\n\t\t\t\t\t${this.getFieldContainer()}\n\t\t\t\t\t${this.getListContainer()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.entries\n\t\t\t.map((entry) => entry.getValue());\n\t}\n}","import {Dom, Tag} from 'main.core';\nimport {BaseField} from 'landing.ui.field.basefield';\nimport {Loc} from 'landing.loc';\nimport {IconButton} from 'landing.ui.component.iconbutton';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport 'main.popup';\nimport type {FormField, RuleFieldOptions} from './types/rule-field-options';\nimport {FieldRules} from './internal/field-rules/field-rules';\n\nimport './css/style.css';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\n\n/**\n * @memberOf BX.Landing.UI.Field\n */\nexport class RuleField extends BaseField\n{\n\toptions: RuleFieldOptions;\n\n\tconstructor(options: RuleFieldOptions)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.RuleField');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\t\tthis.setLayoutClass('landing-ui-field-rule');\n\n\t\tthis.onRemoveClick = this.onRemoveClick.bind(this);\n\t\tthis.onRowChange = this.onRowChange.bind(this);\n\n\t\tDom.clean(this.layout);\n\t\tDom.append(this.getHeaderLayout(), this.getLayout());\n\t\tDom.append(this.getBodyLayout(), this.getLayout());\n\t\tDom.append(this.getFooterLayout(), this.getLayout());\n\n\t\tthis.rows = [];\n\n\t\tthis.options.rules.forEach((rule) => {\n\t\t\tthis.addRule(rule);\n\t\t});\n\n\t\tconst hideLabel = this.options.rules.some((rule) => {\n\t\t\treturn rule.expression.length > 0;\n\t\t});\n\n\t\tif (hideLabel)\n\t\t{\n\t\t\tconst label = this.rows[0].getFieldContainer()\n\t\t\t\t.querySelector('.landing-ui-field-rule-field-row-field-container-action-title');\n\t\t\tDom.hide(label);\n\t\t}\n\t}\n\n\taddRule(fieldRules: FieldRules)\n\t{\n\t\tconst row = new FieldRules({\n\t\t\t...fieldRules,\n\t\t\tfields: this.options.fields,\n\t\t});\n\t\tthis.rows.push(row);\n\n\t\trow.subscribe('onChange', this.onRowChange);\n\t\tDom.append(row.getLayout(), this.getBodyLayout());\n\t\tthis.emit('onChange');\n\t}\n\n\tonRowChange(event)\n\t{\n\t\tthis.emit('onChange');\n\n\t\tconst hideLabel = event.getTarget().getValue().some((rule) => {\n\t\t\treturn rule.expression.length > 0;\n\t\t});\n\n\t\tconst label = this.rows[0].getFieldContainer()\n\t\t\t.querySelector('.landing-ui-field-rule-field-row-field-container-action-title');\n\n\t\tif (hideLabel)\n\t\t{\n\t\t\tDom.hide(label);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(label);\n\t\t}\n\t}\n\n\tgetHeaderTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerTitleLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-rule-header-title\">${Loc.getMessage('LANDING_FIELDS_RULES_TYPE_1')}</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetRemoveButtonLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('removeButtonLayout', () => {\n\t\t\tconst button = new IconButton({\n\t\t\t\ttype: IconButton.Types.remove,\n\t\t\t\tonClick: this.onRemoveClick,\n\t\t\t\ttitle: Loc.getMessage('LANDING_RULE_FIELD_REMOVE_BUTTON_TITLE'),\n\t\t\t\tstyle: {\n\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn button.getLayout();\n\t\t});\n\t}\n\n\tgetHeaderLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-rule-header\">\n\t\t\t\t\t${this.getHeaderTitleLayout()}\n\t\t\t\t\t${this.getRemoveButtonLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetBodyLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('bodyLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-rule-body\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetFooterLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('footerLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-rule-footer\">\n\t\t\t\t\t${this.getFooterActionPanel().getLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonRemoveClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tDom.remove(this.getLayout());\n\t\tthis.emit('onRemove');\n\t\tthis.emit('onChange');\n\t}\n\n\tgetFooterActionPanel(): ActionPanel\n\t{\n\t\treturn this.cache.remember('footerActionPanel', () => {\n\t\t\treturn new ActionPanel({\n\t\t\t\tleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'selectField',\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_RULE_FIELD_EXPRESSION_ADD_FIELD_LINK_LABEL'),\n\t\t\t\t\t\tonClick: this.onAddFieldRulesLinkClick.bind(this),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFieldsListMenu()\n\t{\n\t\treturn this.cache.remember('fieldsMenu', () => {\n\t\t\treturn new window.top.BX.Main.Menu({\n\t\t\t\tbindElement: this.getFooterActionPanel().getLeftContainer().firstElementChild,\n\t\t\t\tmaxHeight: 205,\n\t\t\t\titems: this.options.fields\n\t\t\t\t\t.filter((field) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tfield.type !== 'page'\n\t\t\t\t\t\t\t&& field.type !== 'layout'\n\t\t\t\t\t\t);\n\t\t\t\t\t})\n\t\t\t\t\t.map((field) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tid: field.id,\n\t\t\t\t\t\t\ttext: field.label,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.onAddFieldRulesMenuItemClick(field);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t\tautoHide: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tonAddFieldRulesLinkClick()\n\t{\n\t\tthis.getFieldsListMenu().show();\n\t}\n\n\tonAddFieldRulesMenuItemClick(field: FormField)\n\t{\n\t\tthis.addRule({\n\t\t\tcondition: {\n\t\t\t\tfield,\n\t\t\t\tvalue: '',\n\t\t\t\toperator: '=',\n\t\t\t},\n\t\t\texpression: [],\n\t\t});\n\n\t\tthis.getFieldsListMenu().close();\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.rows.map((row) => row.getValue());\n\t}\n}"],"names":["defaultOptions","removable","draggable","color","FieldElement","options","setEventNamespace","subscribeFromOptions","fetchEventsFromOptions","cache","Cache","MemoryCache","remember","button","IconButton","type","Types","drag","style","width","getLayout","field","window","top","BX","Landing","UI","Field","DropdownInline","title","actionsLabel","items","actionsList","content","actionsValue","subscribe","emit","Tag","render","getActionsDropdown","remove","onClick","iconSize","marginLeft","getDragButtonLayout","getActionsLayout","getTitleLayout","getRemoveButtonLayout","EventEmitter","blue","green","red","listValueSettingsItems","value","label","Loc","getMessage","RuleEntry","Draggable","container","getExpressionContainer","dragElement","HEADLESS","context","parent","offset","y","onDragEnd","bind","state","condition","id","operator","expression","map","item","action","forEach","addExpressionItem","preventEvent","checked","onChanage","getOperatorLabelLayout","textContent","onChange","setValueLabelText","rootWindow","PageObject","getRootWindow","popupContent","random","Text","getRandom","index","Dom","append","renderOperatorRadioButton","renderSeparator","valueItems","renderValueRadioButton","inputField","TextField","textOnly","onValueChange","conditionValue","getValue","Main","Popup","bindElement","getConditionValueLayout","autoHide","offsetLeft","offsetTop","maxHeight","events","onShow","addClass","getValueSettingsPopup","adjustPosition","forceBindPosition","onClose","removeClass","Type","isArray","valueItem","find","isString","isStringFilled","onValueLabelClick","getValueLabel","text","getValueLabelLayout","event","preventDefault","valueSettingsPopup","isShown","show","close","Menu","getAddFieldLink","fieldsList","filter","onclick","onAddExpressionField","target","getTarget","children","length","entry","expressionEntry","currentEntry","preparedOptions","fieldElement","Colors","name","onRemove","onExpressionItemRemove","onExpressionFieldChange","insertBefore","push","reduce","acc","accEntry","adjustExpressionItems","getFieldsListMenu","reverse","element","hasClass","menu","expressionItems","getMenuItems","isUsed","some","expressionItem","getId","onAddFieldLinkClick","getConditionContainer","FieldRules","entries","onEntryChange","addRule","ruleOptions","fields","getListContainer","onConditionFieldRemoveClick","getConditionFieldLayout","getFieldContainer","RuleField","setLayoutClass","onRemoveClick","onRowChange","clean","layout","getHeaderLayout","getBodyLayout","getFooterLayout","rows","rules","rule","hideLabel","querySelector","hide","fieldRules","row","getHeaderTitleLayout","getFooterActionPanel","ActionPanel","left","onAddFieldRulesLinkClick","getLeftContainer","firstElementChild","onAddFieldRulesMenuItemClick","BaseField"],"mappings":"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"}