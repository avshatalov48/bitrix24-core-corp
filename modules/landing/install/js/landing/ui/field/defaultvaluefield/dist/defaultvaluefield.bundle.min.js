this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};this.BX.Landing.UI=this.BX.Landing.UI||{};(function(e,t,n,i,a,r,l,o,s,d,u,c,g){"use strict";function m(){var e=babelHelpers.taggedTemplateLiteral(['<div class="landing-ui-field-defaultvalue-list-container"></div>']);m=function t(){return e};return e}var L=function(e){babelHelpers.inherits(n,e);function n(e){var t;babelHelpers.classCallCheck(this,n);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,e));t.setEventNamespace("BX.Landing.UI.Field.DefaultValueField");t.subscribeFromOptions(a.fetchEventsFromOptions(e));t.onSelectFieldButtonClick=t.onSelectFieldButtonClick.bind(babelHelpers.assertThisInitialized(t));t.onItemRemove=t.onItemRemove.bind(babelHelpers.assertThisInitialized(t));t.onDragEnd=t.onDragEnd.bind(babelHelpers.assertThisInitialized(t));t.onFormChange=t.onFormChange.bind(babelHelpers.assertThisInitialized(t));t.items=[];t.actionPanel=new c.ActionPanel({renderTo:t.layout,left:[{id:"selectField",text:l.Loc.getMessage("LANDING_FIELDS_SELECT_FIELD_BUTTON_TITLE"),onClick:t.onSelectFieldButtonClick}]});t.draggable=new r.Draggable({context:window.parent,container:t.getListContainer(),draggable:".landing-ui-component-list-item",dragElement:".landing-ui-button-icon-drag",type:r.Draggable.MOVE,offset:{y:-62}});t.draggable.subscribe("end",t.onDragEnd);t.options.items.forEach(function(e){var n=t.prepareItemOptions({id:"".concat(e.entityName,"_").concat(e.fieldName),value:e.value});if(n){t.addItem(n)}});return t}babelHelpers.createClass(n,[{key:"prepareItemOptions",value:function e(n){var i=this;var a=this.getCrmFieldById(n.id);if(a){var r=function(){if(a.type==="list"){var e=a.items.find(function(e){return e.ID===n.value});if(e){return e.VALUE}}if(a.type==="checkbox"){if(t.Text.toBoolean(n.value)){return l.Loc.getMessage("LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_YES")}return l.Loc.getMessage("LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_NO")}if(t.Type.isStringFilled(n.value)){return n.value}return l.Loc.getMessage("LANDING_DEFAULT_VALUE_FIELD_DEFAULT_VALUE")}();var o=function(){var e=i.getCrmFieldCategoryById(a.entity_name);return"".concat(a.caption," \xb7 ").concat(e.CAPTION)}();return{field:a,value:n.value,displayedValue:r,displayedLabel:o}}return null}},{key:"getListContainer",value:function e(){return this.cache.remember("listContainer",function(){return t.Tag.render(m())})}},{key:"createInput",value:function e(){return this.getListContainer()}},{key:"getCrmFieldById",value:function e(t){return Object.values(this.options.crmFields).reduce(function(e,t){return[].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(t.FIELDS))},[]).find(function(e){return e.name===t})}},{key:"getCrmFieldCategoryById",value:function e(t){return this.options.crmFields[t]}},{key:"addItem",value:function e(t){this.items.push(new o.ListItem({id:t.field.name,title:t.displayedLabel,description:t.displayedValue,draggable:true,editable:true,removable:true,appendTo:this.getListContainer(),onRemove:this.onItemRemove,onFormChange:this.onFormChange,form:this.createItemForm(t)}))}},{key:"getItemById",value:function e(t){return this.items.find(function(e){return e.options.id===t})}},{key:"onItemRemove",value:function e(t){this.items=this.items.filter(function(e){return e!==t.getTarget()});this.emit("onChange",{skipPrepare:true})}},{key:"onFormChange",value:function e(t){var n=t.getTarget().getValue();var i=this.getItemById(n.name);var a=this.prepareItemOptions({id:n.name,value:n.label});if(i){i.setDescription(a.displayedValue)}this.emit("onChange",{skipPrepare:true})}},{key:"onDragEnd",value:function e(){var n=this;setTimeout(function(){n.items=babelHelpers.toConsumableArray(n.getListContainer().children).map(function(e){var i=t.Dom.attr(e,"data-id");return n.items.find(function(e){return e.options.id===i})});n.emit("onChange",{skipPrepare:true})})}},{key:"getValue",value:function e(){var t=this;return this.items.map(function(e){var n=e.getValue();var i=t.getCrmFieldById(n.name);return{entityName:i.entity_name,fieldName:i.entity_field_name,value:n.value}})}},{key:"onFieldsSelect",value:function e(t){var n=this;t.forEach(function(e){n.addItem(n.prepareItemOptions({id:e}))});this.emit("onChange",{skipPrepare:true})}},{key:"onSelectFieldButtonClick",value:function e(t){var n=this;t.preventDefault();d.FieldsPanel.getInstance({isLeadEnabled:this.options.isLeadEnabled}).show({isLeadEnabled:this.options.isLeadEnabled,allowedTypes:["string","list","checkbox","radio","text","integer","double","date","datetime","typed_string"]}).then(function(e){n.onFieldsSelect(e)})}},{key:"createItemForm",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=new u.FormSettingsForm({serializeModifier:function e(i){if(t.field.type==="list"||t.field.type==="checkbox"||t.field.type==="bool"){var a=n.fields[0].items.find(function(e){return e.value===i.value});i.label=a.name}else{i.label=i.value}return i}});if(t.field.type==="list"){n.addField(new BX.Landing.UI.Field.Dropdown({selector:"value",title:l.Loc.getMessage("LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE"),content:t.value,items:t.field.items.map(function(e){return{name:e.VALUE,value:e.ID}})}));return n}if(t.field.type==="bool"||t.field.type==="checkbox"){n.addField(new BX.Landing.UI.Field.Dropdown({selector:"value",title:l.Loc.getMessage("LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE"),content:t.value,items:[{name:l.Loc.getMessage("LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_YES"),value:"Y"},{name:l.Loc.getMessage("LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_NO"),value:"N"}]}));return n}if(t.field.type==="date"||t.field.type==="datetime"){n.addField(new i.DateTimeField({selector:"value",title:l.Loc.getMessage("LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE"),time:t.field.type==="datetime",content:t.value||""}));return n}n.addField(new g.VariablesField({selector:"value",title:l.Loc.getMessage("LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE"),variables:this.options.personalizationVariables,content:t.value||""}));return n}}]);return n}(n.BaseField);e.DefaultValueField=L})(this.BX.Landing.UI.Field=this.BX.Landing.UI.Field||{},BX,BX.Landing.UI.Field,BX.Landing.Ui.Field,BX.Landing.UI.Component,BX.UI.DragAndDrop,BX.Landing,BX.Landing.UI.Component,BX.Event,BX.Landing.UI.Panel,BX.Landing.UI.Form,BX.Landing.UI.Component,BX.Landing.UI.Field);
//# sourceMappingURL=defaultvaluefield.bundle.map.js