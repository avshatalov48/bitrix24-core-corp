{"version":3,"file":"defaultvaluefield.bundle.js","sources":["../src/defaultvaluefield.js"],"sourcesContent":["import {Dom, Tag, Text, Type, Runtime} from 'main.core';\nimport {BaseField} from 'landing.ui.field.basefield';\nimport {DateTimeField} from 'landing.ui.field.datetimefield';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\nimport {Draggable} from 'ui.draganddrop.draggable';\nimport {Loc} from 'landing.loc';\nimport {ListItem} from 'landing.ui.component.listitem';\nimport {BaseEvent} from 'main.core.events';\nimport {FieldsPanel} from 'landing.ui.panel.fieldspanel';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {VariablesField} from 'landing.ui.field.variablesfield';\n\ntype CrmField = {\n\ttype: 'list' | 'string' | 'checkbox' | 'date' | 'text' | 'typed_string' | 'file',\n\tentity_field_name: string,\n\tentity_name: string,\n\tname: string,\n\tcaption: string,\n\tmultiple: boolean,\n\trequired: boolean,\n\thidden: boolean,\n\titems: Array<{ID: any, VALUE: any}>,\n};\n\ntype CrmFieldCategory = {\n\tCAPTION: string,\n\tFIELDS: Array<CrmField>\n};\n\ntype ItemOptions = {\n\tfield: CrmField,\n\tvalue: any,\n\tdisplayedValue: string,\n\tdisplayedLabel: string,\n};\n\nexport class DefaultValueField extends BaseField\n{\n\tstatic isListField(field: CrmField): boolean\n\t{\n\t\treturn Type.isArray(field.items);\n\t}\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.DefaultValueField');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\n\t\tthis.onSelectFieldButtonClick = this.onSelectFieldButtonClick.bind(this);\n\t\tthis.onItemRemove = this.onItemRemove.bind(this);\n\t\tthis.onDragEnd = this.onDragEnd.bind(this);\n\t\tthis.onFormChange = this.onFormChange.bind(this);\n\n\t\tthis.items = [];\n\n\t\tthis.actionPanel = new ActionPanel({\n\t\t\trenderTo: this.layout,\n\t\t\tleft: [\n\t\t\t\t{\n\t\t\t\t\tid: 'selectField',\n\t\t\t\t\ttext: Loc.getMessage('LANDING_DEFAULT_VALUE_ADD_FIELD'),\n\t\t\t\t\tonClick: this.onSelectFieldButtonClick,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tthis.draggable = new Draggable({\n\t\t\tcontext: window.parent,\n\t\t\tcontainer: this.getListContainer(),\n\t\t\tdraggable: '.landing-ui-component-list-item',\n\t\t\tdragElement: '.landing-ui-button-icon-drag',\n\t\t\ttype: Draggable.MOVE,\n\t\t\toffset: {\n\t\t\t\ty: -62,\n\t\t\t},\n\t\t});\n\n\t\tthis.draggable.subscribe('end', this.onDragEnd);\n\n\t\tthis.options.items.forEach((item) => {\n\t\t\tconst itemOptions = this.prepareItemOptions({\n\t\t\t\tid: `${item.entityName}_${item.fieldName}`,\n\t\t\t\tvalue: item.value,\n\t\t\t});\n\n\t\t\tif (itemOptions)\n\t\t\t{\n\t\t\t\tthis.addItem(itemOptions);\n\t\t\t}\n\t\t});\n\t}\n\n\tprepareItemOptions(options: {id: string, value: any}): ?ItemOptions\n\t{\n\t\tconst crmField = this.getCrmFieldById(options.id);\n\t\tif (crmField)\n\t\t{\n\t\t\tconst displayedValue = (() => {\n\t\t\t\tif (DefaultValueField.isListField(crmField))\n\t\t\t\t{\n\t\t\t\t\tconst fieldItems = this.getFieldItems(crmField);\n\t\t\t\t\tconst item = fieldItems.find((currentItem) => {\n\t\t\t\t\t\treturn currentItem.ID === options.value;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (item)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn item.VALUE;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (Type.isArrayFilled(fieldItems))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn fieldItems[0].VALUE;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_DEFAULT_VALUE');\n\t\t\t\t}\n\n\t\t\t\tif (crmField.type === 'checkbox')\n\t\t\t\t{\n\t\t\t\t\tif (Text.toBoolean(options.value))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_YES');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_NO');\n\t\t\t\t}\n\n\t\t\t\tif (Type.isStringFilled(options.value))\n\t\t\t\t{\n\t\t\t\t\treturn options.value;\n\t\t\t\t}\n\n\t\t\t\treturn Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_DEFAULT_VALUE');\n\t\t\t})();\n\n\t\t\tconst displayedLabel = (() => {\n\t\t\t\tconst fieldCategory = this.getCrmFieldCategoryById(crmField.entity_name);\n\t\t\t\treturn `${crmField.caption} Â· ${fieldCategory.CAPTION}`;\n\t\t\t})();\n\n\t\t\treturn {\n\t\t\t\tfield: crmField,\n\t\t\t\tvalue: options.value,\n\t\t\t\tdisplayedValue,\n\t\t\t\tdisplayedLabel,\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetListContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('listContainer', () => {\n\t\t\treturn Tag.render`<div class=\"landing-ui-field-defaultvalue-list-container\"></div>`;\n\t\t});\n\t}\n\n\tcreateInput(): HTMLDivElement\n\t{\n\t\treturn this.getListContainer();\n\t}\n\n\tgetCrmFieldById(id: string): ?CrmField\n\t{\n\t\treturn Object.values(this.options.crmFields)\n\t\t\t.reduce((acc, category) => {\n\t\t\t\treturn [...acc, ...category.FIELDS];\n\t\t\t}, [])\n\t\t\t.find((currentField) => {\n\t\t\t\treturn currentField.name === id;\n\t\t\t});\n\t}\n\n\tgetCrmFieldCategoryById(id: string): ?CrmFieldCategory\n\t{\n\t\treturn this.options.crmFields[id];\n\t}\n\n\taddItem(options: ItemOptions)\n\t{\n\t\tthis.items.push(\n\t\t\tnew ListItem({\n\t\t\t\tid: options.field.name,\n\t\t\t\ttitle: options.displayedLabel,\n\t\t\t\tdescription: options.displayedValue,\n\t\t\t\tdraggable: true,\n\t\t\t\teditable: true,\n\t\t\t\tremovable: true,\n\t\t\t\tappendTo: this.getListContainer(),\n\t\t\t\tonRemove: this.onItemRemove,\n\t\t\t\tonFormChange: this.onFormChange,\n\t\t\t\tform: this.createItemForm(options),\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetItemById(id: string): ?ListItem\n\t{\n\t\treturn this.items.find((currentItem) => {\n\t\t\treturn currentItem.options.id === id;\n\t\t});\n\t}\n\n\tonItemRemove(event: BaseEvent)\n\t{\n\t\tthis.items = this.items.filter((item) => {\n\t\t\treturn item !== event.getTarget();\n\t\t});\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tonFormChange(event: BaseEvent)\n\t{\n\t\tconst value = event.getTarget().getValue();\n\t\tconst item = this.getItemById(value.name);\n\t\tconst options = this.prepareItemOptions({\n\t\t\tid: value.name,\n\t\t\tvalue: value.label,\n\t\t});\n\n\t\tif (item)\n\t\t{\n\t\t\titem.setDescription(options.displayedValue);\n\t\t}\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tonDragEnd()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tthis.items = [...this.getListContainer().children].map((itemNode) => {\n\t\t\t\tconst itemNodeId = Dom.attr(itemNode, 'data-id');\n\t\t\t\treturn this.items.find((item) => {\n\t\t\t\t\treturn item.options.id === itemNodeId;\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t});\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.items.map((item) => {\n\t\t\tconst sourceValue = item.getValue();\n\t\t\tconst crmField = this.getCrmFieldById(sourceValue.name);\n\n\t\t\treturn {\n\t\t\t\tentityName: crmField.entity_name,\n\t\t\t\tfieldName: crmField.entity_field_name,\n\t\t\t\tvalue: sourceValue.value,\n\t\t\t};\n\t\t});\n\t}\n\n\tonFieldsSelect(selectedFields: Array<string>)\n\t{\n\t\tselectedFields.forEach((fieldId) => {\n\t\t\tthis.addItem(\n\t\t\t\tthis.prepareItemOptions({\n\t\t\t\t\tid: fieldId,\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tgetAllowedCategories(): Array<string>\n\t{\n\t\tconst schemeId = this.options.formOptions.document.scheme;\n\t\tconst scheme = this.options.dictionary.document.schemes.find((item) => {\n\t\t\treturn String(schemeId) === String(item.id);\n\t\t});\n\n\t\tif (Type.isPlainObject(scheme))\n\t\t{\n\t\t\treturn Runtime.clone(scheme.entities);\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tonSelectFieldButtonClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tFieldsPanel\n\t\t\t.getInstance({isLeadEnabled: this.options.isLeadEnabled})\n\t\t\t.show({\n\t\t\t\tisLeadEnabled: this.options.isLeadEnabled,\n\t\t\t\tallowedCategories: this.getAllowedCategories(),\n\t\t\t\tallowedTypes: [\n\t\t\t\t\t'string',\n\t\t\t\t\t'list',\n\t\t\t\t\t'enumeration',\n\t\t\t\t\t'checkbox',\n\t\t\t\t\t'boolean',\n\t\t\t\t\t'radio',\n\t\t\t\t\t'text',\n\t\t\t\t\t'integer',\n\t\t\t\t\t'double',\n\t\t\t\t\t'date',\n\t\t\t\t\t'datetime',\n\t\t\t\t\t'typed_string',\n\t\t\t\t],\n\t\t\t})\n\t\t\t.then((selectedFields) => {\n\t\t\t\tthis.options.crmFields = FieldsPanel.getInstance().getOriginalCrmFields();\n\t\t\t\tthis.onFieldsSelect(selectedFields);\n\t\t\t});\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetFieldItems(field): ?Array<any>\n\t{\n\t\tif (field.entity_field_name === 'STAGE_ID')\n\t\t{\n\t\t\tif (\n\t\t\t\tType.isPlainObject(this.options.formOptions.document)\n\t\t\t\t&& Type.isPlainObject(this.options.formOptions.document.deal)\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst categoryId = Text.toNumber(\n\t\t\t\t\tthis.options.formOptions.document.deal.category,\n\t\t\t\t);\n\n\t\t\t\tif (categoryId > 0)\n\t\t\t\t{\n\t\t\t\t\treturn field.itemsByCategory[categoryId];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn field.items;\n\t}\n\n\tcreateItemForm(options = {}): FormSettingsForm\n\t{\n\t\tconst form = new FormSettingsForm({\n\t\t\tserializeModifier: (value) => {\n\t\t\t\tif (\n\t\t\t\t\toptions.field.type === 'list'\n\t\t\t\t\t|| options.field.type === 'checkbox'\n\t\t\t\t\t|| options.field.type === 'bool'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst valueItem = this.getFieldItems(form.fields[0]).find((item) => {\n\t\t\t\t\t\treturn item.value === value.value;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (valueItem)\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue.label = valueItem.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvalue.label = value.value;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\t\t});\n\n\t\tif (DefaultValueField.isListField(options.field))\n\t\t{\n\t\t\tform.addField(\n\t\t\t\tnew BX.Landing.UI.Field.Dropdown({\n\t\t\t\t\tselector: 'value',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\t\tcontent: options.value,\n\t\t\t\t\titems: this.getFieldItems(options.field).map((item) => {\n\t\t\t\t\t\treturn {name: item.VALUE, value: item.ID};\n\t\t\t\t\t}),\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn form;\n\t\t}\n\n\t\tif (\n\t\t\toptions.field.type === 'bool'\n\t\t\t|| options.field.type === 'checkbox'\n\t\t)\n\t\t{\n\t\t\tform.addField(\n\t\t\t\tnew BX.Landing.UI.Field.Dropdown({\n\t\t\t\t\tselector: 'value',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\t\tcontent: options.value,\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{name: Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_NO'), value: 'N'},\n\t\t\t\t\t\t{name: Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_YES'), value: 'Y'},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn form;\n\t\t}\n\n\t\tif (\n\t\t\toptions.field.type === 'date'\n\t\t\t|| options.field.type === 'datetime'\n\t\t)\n\t\t{\n\t\t\tform.addField(\n\t\t\t\tnew DateTimeField({\n\t\t\t\t\tselector: 'value',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\t\ttime: options.field.type === 'datetime',\n\t\t\t\t\tcontent: options.value || '',\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn form;\n\t\t}\n\n\t\tform.addField(\n\t\t\tnew VariablesField({\n\t\t\t\tselector: 'value',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\tvariables: this.options.personalizationVariables,\n\t\t\t\tcontent: options.value || '',\n\t\t\t}),\n\t\t);\n\n\t\treturn form;\n\t}\n}"],"names":["DefaultValueField","field","Type","isArray","items","options","setEventNamespace","subscribeFromOptions","fetchEventsFromOptions","onSelectFieldButtonClick","bind","onItemRemove","onDragEnd","onFormChange","actionPanel","ActionPanel","renderTo","layout","left","id","text","Loc","getMessage","onClick","draggable","Draggable","context","window","parent","container","getListContainer","dragElement","type","MOVE","offset","y","subscribe","forEach","item","itemOptions","prepareItemOptions","entityName","fieldName","value","addItem","crmField","getCrmFieldById","displayedValue","isListField","fieldItems","getFieldItems","find","currentItem","ID","VALUE","isArrayFilled","Text","toBoolean","isStringFilled","displayedLabel","fieldCategory","getCrmFieldCategoryById","entity_name","caption","CAPTION","cache","remember","Tag","render","Object","values","crmFields","reduce","acc","category","FIELDS","currentField","name","push","ListItem","title","description","editable","removable","appendTo","onRemove","form","createItemForm","event","filter","getTarget","emit","skipPrepare","getValue","getItemById","label","setDescription","setTimeout","children","map","itemNode","itemNodeId","Dom","attr","sourceValue","entity_field_name","selectedFields","fieldId","schemeId","formOptions","document","scheme","dictionary","schemes","String","isPlainObject","Runtime","clone","entities","preventDefault","FieldsPanel","getInstance","isLeadEnabled","show","allowedCategories","getAllowedCategories","allowedTypes","then","getOriginalCrmFields","onFieldsSelect","deal","categoryId","toNumber","itemsByCategory","FormSettingsForm","serializeModifier","valueItem","fields","addField","BX","Landing","UI","Field","Dropdown","selector","content","DateTimeField","time","VariablesField","variables","personalizationVariables","BaseField"],"mappings":";;;;;;;KAqCaA,iBAAb;CAAA;CAAA;CAAA;CAAA,gCAEoBC,KAFpB,EAGC;CACC,aAAOC,cAAI,CAACC,OAAL,CAAaF,KAAK,CAACG,KAAnB,CAAP;CACA;CALF;;CAOC,6BAAYC,OAAZ,EACA;CAAA;;CAAA;CACC,mHAAMA,OAAN;;CACA,UAAKC,iBAAL,CAAuB,uCAAvB;;CACA,UAAKC,oBAAL,CAA0BC,oDAAsB,CAACH,OAAD,CAAhD;;CAEA,UAAKI,wBAAL,GAAgC,MAAKA,wBAAL,CAA8BC,IAA9B,2CAAhC;CACA,UAAKC,YAAL,GAAoB,MAAKA,YAAL,CAAkBD,IAAlB,2CAApB;CACA,UAAKE,SAAL,GAAiB,MAAKA,SAAL,CAAeF,IAAf,2CAAjB;CACA,UAAKG,YAAL,GAAoB,MAAKA,YAAL,CAAkBH,IAAlB,2CAApB;CAEA,UAAKN,KAAL,GAAa,EAAb;CAEA,UAAKU,WAAL,GAAmB,IAAIC,4CAAJ,CAAgB;CAClCC,MAAAA,QAAQ,EAAE,MAAKC,MADmB;CAElCC,MAAAA,IAAI,EAAE,CACL;CACCC,QAAAA,EAAE,EAAE,aADL;CAECC,QAAAA,IAAI,EAAEC,eAAG,CAACC,UAAJ,CAAe,iCAAf,CAFP;CAGCC,QAAAA,OAAO,EAAE,MAAKd;CAHf,OADK;CAF4B,KAAhB,CAAnB;CAWA,UAAKe,SAAL,GAAiB,IAAIC,kCAAJ,CAAc;CAC9BC,MAAAA,OAAO,EAAEC,MAAM,CAACC,MADc;CAE9BC,MAAAA,SAAS,EAAE,MAAKC,gBAAL,EAFmB;CAG9BN,MAAAA,SAAS,EAAE,iCAHmB;CAI9BO,MAAAA,WAAW,EAAE,8BAJiB;CAK9BC,MAAAA,IAAI,EAAEP,kCAAS,CAACQ,IALc;CAM9BC,MAAAA,MAAM,EAAE;CACPC,QAAAA,CAAC,EAAE,CAAC;CADG;CANsB,KAAd,CAAjB;;CAWA,UAAKX,SAAL,CAAeY,SAAf,CAAyB,KAAzB,EAAgC,MAAKxB,SAArC;;CAEA,UAAKP,OAAL,CAAaD,KAAb,CAAmBiC,OAAnB,CAA2B,UAACC,IAAD,EAAU;CACpC,UAAMC,WAAW,GAAG,MAAKC,kBAAL,CAAwB;CAC3CrB,QAAAA,EAAE,YAAKmB,IAAI,CAACG,UAAV,cAAwBH,IAAI,CAACI,SAA7B,CADyC;CAE3CC,QAAAA,KAAK,EAAEL,IAAI,CAACK;CAF+B,OAAxB,CAApB;;CAKA,UAAIJ,WAAJ,EACA;CACC,cAAKK,OAAL,CAAaL,WAAb;CACA;CACD,KAVD;;CApCD;CA+CC;;CAvDF;CAAA;CAAA,uCAyDoBlC,OAzDpB,EA0DC;CAAA;;CACC,UAAMwC,QAAQ,GAAG,KAAKC,eAAL,CAAqBzC,OAAO,CAACc,EAA7B,CAAjB;;CACA,UAAI0B,QAAJ,EACA;CACC,YAAME,cAAc,GAAI,YAAM;CAC7B,cAAI/C,iBAAiB,CAACgD,WAAlB,CAA8BH,QAA9B,CAAJ,EACA;CACC,gBAAMI,UAAU,GAAG,MAAI,CAACC,aAAL,CAAmBL,QAAnB,CAAnB;;CACA,gBAAMP,IAAI,GAAGW,UAAU,CAACE,IAAX,CAAgB,UAACC,WAAD,EAAiB;CAC7C,qBAAOA,WAAW,CAACC,EAAZ,KAAmBhD,OAAO,CAACsC,KAAlC;CACA,aAFY,CAAb;;CAIA,gBAAIL,IAAJ,EACA;CACC,qBAAOA,IAAI,CAACgB,KAAZ;CACA;;CAED,gBAAIpD,cAAI,CAACqD,aAAL,CAAmBN,UAAnB,CAAJ,EACA;CACC,qBAAOA,UAAU,CAAC,CAAD,CAAV,CAAcK,KAArB;CACA;;CAED,mBAAOjC,eAAG,CAACC,UAAJ,CAAe,2CAAf,CAAP;CACA;;CAED,cAAIuB,QAAQ,CAACb,IAAT,KAAkB,UAAtB,EACA;CACC,gBAAIwB,cAAI,CAACC,SAAL,CAAepD,OAAO,CAACsC,KAAvB,CAAJ,EACA;CACC,qBAAOtB,eAAG,CAACC,UAAJ,CAAe,0CAAf,CAAP;CACA;;CAED,mBAAOD,eAAG,CAACC,UAAJ,CAAe,yCAAf,CAAP;CACA;;CAED,cAAIpB,cAAI,CAACwD,cAAL,CAAoBrD,OAAO,CAACsC,KAA5B,CAAJ,EACA;CACC,mBAAOtC,OAAO,CAACsC,KAAf;CACA;;CAED,iBAAOtB,eAAG,CAACC,UAAJ,CAAe,2CAAf,CAAP;CACA,SArCsB,EAAvB;;CAuCA,YAAMqC,cAAc,GAAI,YAAM;CAC7B,cAAMC,aAAa,GAAG,MAAI,CAACC,uBAAL,CAA6BhB,QAAQ,CAACiB,WAAtC,CAAtB;;CACA,2BAAUjB,QAAQ,CAACkB,OAAnB,mBAAgCH,aAAa,CAACI,OAA9C;CACA,SAHsB,EAAvB;;CAKA,eAAO;CACN/D,UAAAA,KAAK,EAAE4C,QADD;CAENF,UAAAA,KAAK,EAAEtC,OAAO,CAACsC,KAFT;CAGNI,UAAAA,cAAc,EAAdA,cAHM;CAINY,UAAAA,cAAc,EAAdA;CAJM,SAAP;CAMA;;CAED,aAAO,IAAP;CACA;CAnHF;CAAA;CAAA,uCAsHC;CACC,aAAO,KAAKM,KAAL,CAAWC,QAAX,CAAoB,eAApB,EAAqC,YAAM;CACjD,eAAOC,aAAG,CAACC,MAAX;CACA,OAFM,CAAP;CAGA;CA1HF;CAAA;CAAA,kCA6HC;CACC,aAAO,KAAKtC,gBAAL,EAAP;CACA;CA/HF;CAAA;CAAA,oCAiIiBX,EAjIjB,EAkIC;CACC,aAAOkD,MAAM,CAACC,MAAP,CAAc,KAAKjE,OAAL,CAAakE,SAA3B,EACLC,MADK,CACE,UAACC,GAAD,EAAMC,QAAN,EAAmB;CAC1B,wDAAWD,GAAX,kCAAmBC,QAAQ,CAACC,MAA5B;CACA,OAHK,EAGH,EAHG,EAILxB,IAJK,CAIA,UAACyB,YAAD,EAAkB;CACvB,eAAOA,YAAY,CAACC,IAAb,KAAsB1D,EAA7B;CACA,OANK,CAAP;CAOA;CA1IF;CAAA;CAAA,4CA4IyBA,EA5IzB,EA6IC;CACC,aAAO,KAAKd,OAAL,CAAakE,SAAb,CAAuBpD,EAAvB,CAAP;CACA;CA/IF;CAAA;CAAA,4BAiJSd,OAjJT,EAkJC;CACC,WAAKD,KAAL,CAAW0E,IAAX,CACC,IAAIC,sCAAJ,CAAa;CACZ5D,QAAAA,EAAE,EAAEd,OAAO,CAACJ,KAAR,CAAc4E,IADN;CAEZG,QAAAA,KAAK,EAAE3E,OAAO,CAACsD,cAFH;CAGZsB,QAAAA,WAAW,EAAE5E,OAAO,CAAC0C,cAHT;CAIZvB,QAAAA,SAAS,EAAE,IAJC;CAKZ0D,QAAAA,QAAQ,EAAE,IALE;CAMZC,QAAAA,SAAS,EAAE,IANC;CAOZC,QAAAA,QAAQ,EAAE,KAAKtD,gBAAL,EAPE;CAQZuD,QAAAA,QAAQ,EAAE,KAAK1E,YARH;CASZE,QAAAA,YAAY,EAAE,KAAKA,YATP;CAUZyE,QAAAA,IAAI,EAAE,KAAKC,cAAL,CAAoBlF,OAApB;CAVM,OAAb,CADD;CAcA;CAjKF;CAAA;CAAA,gCAmKac,EAnKb,EAoKC;CACC,aAAO,KAAKf,KAAL,CAAW+C,IAAX,CAAgB,UAACC,WAAD,EAAiB;CACvC,eAAOA,WAAW,CAAC/C,OAAZ,CAAoBc,EAApB,KAA2BA,EAAlC;CACA,OAFM,CAAP;CAGA;CAxKF;CAAA;CAAA,iCA0KcqE,KA1Kd,EA2KC;CACC,WAAKpF,KAAL,GAAa,KAAKA,KAAL,CAAWqF,MAAX,CAAkB,UAACnD,IAAD,EAAU;CACxC,eAAOA,IAAI,KAAKkD,KAAK,CAACE,SAAN,EAAhB;CACA,OAFY,CAAb;CAIA,WAAKC,IAAL,CAAU,UAAV,EAAsB;CAACC,QAAAA,WAAW,EAAE;CAAd,OAAtB;CACA;CAjLF;CAAA;CAAA,iCAmLcJ,KAnLd,EAoLC;CACC,UAAM7C,KAAK,GAAG6C,KAAK,CAACE,SAAN,GAAkBG,QAAlB,EAAd;CACA,UAAMvD,IAAI,GAAG,KAAKwD,WAAL,CAAiBnD,KAAK,CAACkC,IAAvB,CAAb;CACA,UAAMxE,OAAO,GAAG,KAAKmC,kBAAL,CAAwB;CACvCrB,QAAAA,EAAE,EAAEwB,KAAK,CAACkC,IAD6B;CAEvClC,QAAAA,KAAK,EAAEA,KAAK,CAACoD;CAF0B,OAAxB,CAAhB;;CAKA,UAAIzD,IAAJ,EACA;CACCA,QAAAA,IAAI,CAAC0D,cAAL,CAAoB3F,OAAO,CAAC0C,cAA5B;CACA;;CAED,WAAK4C,IAAL,CAAU,UAAV,EAAsB;CAACC,QAAAA,WAAW,EAAE;CAAd,OAAtB;CACA;CAlMF;CAAA;CAAA,gCAqMC;CAAA;;CACCK,MAAAA,UAAU,CAAC,YAAM;CAChB,QAAA,MAAI,CAAC7F,KAAL,GAAa,+BAAI,MAAI,CAAC0B,gBAAL,GAAwBoE,QAA5B,EAAsCC,GAAtC,CAA0C,UAACC,QAAD,EAAc;CACpE,cAAMC,UAAU,GAAGC,aAAG,CAACC,IAAJ,CAASH,QAAT,EAAmB,SAAnB,CAAnB;CACA,iBAAO,MAAI,CAAChG,KAAL,CAAW+C,IAAX,CAAgB,UAACb,IAAD,EAAU;CAChC,mBAAOA,IAAI,CAACjC,OAAL,CAAac,EAAb,KAAoBkF,UAA3B;CACA,WAFM,CAAP;CAGA,SALY,CAAb;;CAOA,QAAA,MAAI,CAACV,IAAL,CAAU,UAAV,EAAsB;CAACC,UAAAA,WAAW,EAAE;CAAd,SAAtB;CACA,OATS,CAAV;CAUA;CAhNF;CAAA;CAAA,+BAmNC;CAAA;;CACC,aAAO,KAAKxF,KAAL,CAAW+F,GAAX,CAAe,UAAC7D,IAAD,EAAU;CAC/B,YAAMkE,WAAW,GAAGlE,IAAI,CAACuD,QAAL,EAApB;;CACA,YAAMhD,QAAQ,GAAG,MAAI,CAACC,eAAL,CAAqB0D,WAAW,CAAC3B,IAAjC,CAAjB;;CAEA,eAAO;CACNpC,UAAAA,UAAU,EAAEI,QAAQ,CAACiB,WADf;CAENpB,UAAAA,SAAS,EAAEG,QAAQ,CAAC4D,iBAFd;CAGN9D,UAAAA,KAAK,EAAE6D,WAAW,CAAC7D;CAHb,SAAP;CAKA,OATM,CAAP;CAUA;CA9NF;CAAA;CAAA,mCAgOgB+D,cAhOhB,EAiOC;CAAA;;CACCA,MAAAA,cAAc,CAACrE,OAAf,CAAuB,UAACsE,OAAD,EAAa;CACnC,QAAA,MAAI,CAAC/D,OAAL,CACC,MAAI,CAACJ,kBAAL,CAAwB;CACvBrB,UAAAA,EAAE,EAAEwF;CADmB,SAAxB,CADD;CAKA,OAND;CAQA,WAAKhB,IAAL,CAAU,UAAV,EAAsB;CAACC,QAAAA,WAAW,EAAE;CAAd,OAAtB;CACA;CA3OF;CAAA;CAAA,2CA8OC;CACC,UAAMgB,QAAQ,GAAG,KAAKvG,OAAL,CAAawG,WAAb,CAAyBC,QAAzB,CAAkCC,MAAnD;CACA,UAAMA,MAAM,GAAG,KAAK1G,OAAL,CAAa2G,UAAb,CAAwBF,QAAxB,CAAiCG,OAAjC,CAAyC9D,IAAzC,CAA8C,UAACb,IAAD,EAAU;CACtE,eAAO4E,MAAM,CAACN,QAAD,CAAN,KAAqBM,MAAM,CAAC5E,IAAI,CAACnB,EAAN,CAAlC;CACA,OAFc,CAAf;;CAIA,UAAIjB,cAAI,CAACiH,aAAL,CAAmBJ,MAAnB,CAAJ,EACA;CACC,eAAOK,iBAAO,CAACC,KAAR,CAAcN,MAAM,CAACO,QAArB,CAAP;CACA;;CAED,aAAO,EAAP;CACA;CA1PF;CAAA;CAAA,6CA4P0B9B,KA5P1B,EA6PC;CAAA;;CACCA,MAAAA,KAAK,CAAC+B,cAAN;CAEAC,MAAAA,wCAAW,CACTC,WADF,CACc;CAACC,QAAAA,aAAa,EAAE,KAAKrH,OAAL,CAAaqH;CAA7B,OADd,EAEEC,IAFF,CAEO;CACLD,QAAAA,aAAa,EAAE,KAAKrH,OAAL,CAAaqH,aADvB;CAELE,QAAAA,iBAAiB,EAAE,KAAKC,oBAAL,EAFd;CAGLC,QAAAA,YAAY,EAAE,CACb,QADa,EAEb,MAFa,EAGb,aAHa,EAIb,UAJa,EAKb,SALa,EAMb,OANa,EAOb,MAPa,EAQb,SARa,EASb,QATa,EAUb,MAVa,EAWb,UAXa,EAYb,cAZa;CAHT,OAFP,EAoBEC,IApBF,CAoBO,UAACrB,cAAD,EAAoB;CACzB,QAAA,MAAI,CAACrG,OAAL,CAAakE,SAAb,GAAyBiD,wCAAW,CAACC,WAAZ,GAA0BO,oBAA1B,EAAzB;;CACA,QAAA,MAAI,CAACC,cAAL,CAAoBvB,cAApB;CACA,OAvBF;CAwBA;CAED;CACD;CACA;;CA5RA;CAAA;CAAA,kCA6RezG,KA7Rf,EA8RC;CACC,UAAIA,KAAK,CAACwG,iBAAN,KAA4B,UAAhC,EACA;CACC,YACCvG,cAAI,CAACiH,aAAL,CAAmB,KAAK9G,OAAL,CAAawG,WAAb,CAAyBC,QAA5C,KACG5G,cAAI,CAACiH,aAAL,CAAmB,KAAK9G,OAAL,CAAawG,WAAb,CAAyBC,QAAzB,CAAkCoB,IAArD,CAFJ,EAIA;CACC,cAAMC,UAAU,GAAG3E,cAAI,CAAC4E,QAAL,CAClB,KAAK/H,OAAL,CAAawG,WAAb,CAAyBC,QAAzB,CAAkCoB,IAAlC,CAAuCxD,QADrB,CAAnB;;CAIA,cAAIyD,UAAU,GAAG,CAAjB,EACA;CACC,mBAAOlI,KAAK,CAACoI,eAAN,CAAsBF,UAAtB,CAAP;CACA;CACD;CACD;;CAED,aAAOlI,KAAK,CAACG,KAAb;CACA;CAlTF;CAAA;CAAA,qCAqTC;CAAA;;CAAA,UADeC,OACf,uEADyB,EACzB;CACC,UAAMiF,IAAI,GAAG,IAAIgD,iDAAJ,CAAqB;CACjCC,QAAAA,iBAAiB,EAAE,2BAAC5F,KAAD,EAAW;CAC7B,cACCtC,OAAO,CAACJ,KAAR,CAAc+B,IAAd,KAAuB,MAAvB,IACG3B,OAAO,CAACJ,KAAR,CAAc+B,IAAd,KAAuB,UAD1B,IAEG3B,OAAO,CAACJ,KAAR,CAAc+B,IAAd,KAAuB,MAH3B,EAKA;CACC,gBAAMwG,SAAS,GAAG,MAAI,CAACtF,aAAL,CAAmBoC,IAAI,CAACmD,MAAL,CAAY,CAAZ,CAAnB,EAAmCtF,IAAnC,CAAwC,UAACb,IAAD,EAAU;CACnE,qBAAOA,IAAI,CAACK,KAAL,KAAeA,KAAK,CAACA,KAA5B;CACA,aAFiB,CAAlB;;CAIA,gBAAI6F,SAAJ,EACA;CACC7F,cAAAA,KAAK,CAACoD,KAAN,GAAcyC,SAAS,CAAC3D,IAAxB;CACA;CACD,WAdD,MAgBA;CACClC,YAAAA,KAAK,CAACoD,KAAN,GAAcpD,KAAK,CAACA,KAApB;CACA;;CAED,iBAAOA,KAAP;CACA;CAvBgC,OAArB,CAAb;;CA0BA,UAAI3C,iBAAiB,CAACgD,WAAlB,CAA8B3C,OAAO,CAACJ,KAAtC,CAAJ,EACA;CACCqF,QAAAA,IAAI,CAACoD,QAAL,CACC,IAAIC,EAAE,CAACC,OAAH,CAAWC,EAAX,CAAcC,KAAd,CAAoBC,QAAxB,CAAiC;CAChCC,UAAAA,QAAQ,EAAE,OADsB;CAEhChE,UAAAA,KAAK,EAAE3D,eAAG,CAACC,UAAJ,CAAe,uDAAf,CAFyB;CAGhC2H,UAAAA,OAAO,EAAE5I,OAAO,CAACsC,KAHe;CAIhCvC,UAAAA,KAAK,EAAE,KAAK8C,aAAL,CAAmB7C,OAAO,CAACJ,KAA3B,EAAkCkG,GAAlC,CAAsC,UAAC7D,IAAD,EAAU;CACtD,mBAAO;CAACuC,cAAAA,IAAI,EAAEvC,IAAI,CAACgB,KAAZ;CAAmBX,cAAAA,KAAK,EAAEL,IAAI,CAACe;CAA/B,aAAP;CACA,WAFM;CAJyB,SAAjC,CADD;CAWA,eAAOiC,IAAP;CACA;;CAED,UACCjF,OAAO,CAACJ,KAAR,CAAc+B,IAAd,KAAuB,MAAvB,IACG3B,OAAO,CAACJ,KAAR,CAAc+B,IAAd,KAAuB,UAF3B,EAIA;CACCsD,QAAAA,IAAI,CAACoD,QAAL,CACC,IAAIC,EAAE,CAACC,OAAH,CAAWC,EAAX,CAAcC,KAAd,CAAoBC,QAAxB,CAAiC;CAChCC,UAAAA,QAAQ,EAAE,OADsB;CAEhChE,UAAAA,KAAK,EAAE3D,eAAG,CAACC,UAAJ,CAAe,uDAAf,CAFyB;CAGhC2H,UAAAA,OAAO,EAAE5I,OAAO,CAACsC,KAHe;CAIhCvC,UAAAA,KAAK,EAAE,CACN;CAACyE,YAAAA,IAAI,EAAExD,eAAG,CAACC,UAAJ,CAAe,yCAAf,CAAP;CAAkEqB,YAAAA,KAAK,EAAE;CAAzE,WADM,EAEN;CAACkC,YAAAA,IAAI,EAAExD,eAAG,CAACC,UAAJ,CAAe,0CAAf,CAAP;CAAmEqB,YAAAA,KAAK,EAAE;CAA1E,WAFM;CAJyB,SAAjC,CADD;CAYA,eAAO2C,IAAP;CACA;;CAED,UACCjF,OAAO,CAACJ,KAAR,CAAc+B,IAAd,KAAuB,MAAvB,IACG3B,OAAO,CAACJ,KAAR,CAAc+B,IAAd,KAAuB,UAF3B,EAIA;CACCsD,QAAAA,IAAI,CAACoD,QAAL,CACC,IAAIQ,4CAAJ,CAAkB;CACjBF,UAAAA,QAAQ,EAAE,OADO;CAEjBhE,UAAAA,KAAK,EAAE3D,eAAG,CAACC,UAAJ,CAAe,uDAAf,CAFU;CAGjB6H,UAAAA,IAAI,EAAE9I,OAAO,CAACJ,KAAR,CAAc+B,IAAd,KAAuB,UAHZ;CAIjBiH,UAAAA,OAAO,EAAE5I,OAAO,CAACsC,KAAR,IAAiB;CAJT,SAAlB,CADD;CASA,eAAO2C,IAAP;CACA;;CAEDA,MAAAA,IAAI,CAACoD,QAAL,CACC,IAAIU,8CAAJ,CAAmB;CAClBJ,QAAAA,QAAQ,EAAE,OADQ;CAElBhE,QAAAA,KAAK,EAAE3D,eAAG,CAACC,UAAJ,CAAe,uDAAf,CAFW;CAGlB+H,QAAAA,SAAS,EAAE,KAAKhJ,OAAL,CAAaiJ,wBAHN;CAIlBL,QAAAA,OAAO,EAAE5I,OAAO,CAACsC,KAAR,IAAiB;CAJR,OAAnB,CADD;CASA,aAAO2C,IAAP;CACA;CA/YF;CAAA;CAAA,EAAuCiE,oCAAvC;;;;;;;;"}