{"version":3,"file":"defaultvaluefield.bundle.js","sources":["../src/defaultvaluefield.js"],"sourcesContent":["import {Dom, Tag, Text, Type} from 'main.core';\nimport {BaseField} from 'landing.ui.field.basefield';\nimport {DateTimeField} from 'landing.ui.field.datetimefield';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\nimport {Draggable} from 'ui.draganddrop.draggable';\nimport {Loc} from 'landing.loc';\nimport {ListItem} from 'landing.ui.component.listitem';\nimport {BaseEvent} from 'main.core.events';\nimport {FieldsPanel} from 'landing.ui.panel.fieldspanel';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {VariablesField} from 'landing.ui.field.variablesfield';\n\ntype CrmField = {\n\ttype: 'list' | 'string' | 'checkbox' | 'date' | 'text' | 'typed_string' | 'file',\n\tentity_field_name: string,\n\tentity_name: string,\n\tname: string,\n\tcaption: string,\n\tmultiple: boolean,\n\trequired: boolean,\n\thidden: boolean,\n\titems: Array<{ID: any, VALUE: any}>,\n};\n\ntype CrmFieldCategory = {\n\tCAPTION: string,\n\tFIELDS: Array<CrmField>\n};\n\ntype ItemOptions = {\n\tfield: CrmField,\n\tvalue: any,\n\tdisplayedValue: string,\n\tdisplayedLabel: string,\n};\n\nexport class DefaultValueField extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.DefaultValueField');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\n\t\tthis.onSelectFieldButtonClick = this.onSelectFieldButtonClick.bind(this);\n\t\tthis.onItemRemove = this.onItemRemove.bind(this);\n\t\tthis.onDragEnd = this.onDragEnd.bind(this);\n\t\tthis.onFormChange = this.onFormChange.bind(this);\n\n\t\tthis.items = [];\n\n\t\tthis.actionPanel = new ActionPanel({\n\t\t\trenderTo: this.layout,\n\t\t\tleft: [\n\t\t\t\t{\n\t\t\t\t\tid: 'selectField',\n\t\t\t\t\ttext: Loc.getMessage('LANDING_FIELDS_SELECT_FIELD_BUTTON_TITLE'),\n\t\t\t\t\tonClick: this.onSelectFieldButtonClick,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tthis.draggable = new Draggable({\n\t\t\tcontext: window.parent,\n\t\t\tcontainer: this.getListContainer(),\n\t\t\tdraggable: '.landing-ui-component-list-item',\n\t\t\tdragElement: '.landing-ui-button-icon-drag',\n\t\t\ttype: Draggable.MOVE,\n\t\t\toffset: {\n\t\t\t\ty: -62,\n\t\t\t},\n\t\t});\n\n\t\tthis.draggable.subscribe('end', this.onDragEnd);\n\n\t\tthis.options.items.forEach((item) => {\n\t\t\tconst itemOptions = this.prepareItemOptions({\n\t\t\t\tid: `${item.entityName}_${item.fieldName}`,\n\t\t\t\tvalue: item.value,\n\t\t\t});\n\n\t\t\tif (itemOptions)\n\t\t\t{\n\t\t\t\tthis.addItem(itemOptions);\n\t\t\t}\n\t\t});\n\t}\n\n\tprepareItemOptions(options: {id: string, value: any}): ?ItemOptions\n\t{\n\t\tconst crmField = this.getCrmFieldById(options.id);\n\t\tif (crmField)\n\t\t{\n\t\t\tconst displayedValue = (() => {\n\t\t\t\tif (crmField.type === 'list')\n\t\t\t\t{\n\t\t\t\t\tconst item = crmField.items.find((currentItem) => {\n\t\t\t\t\t\treturn currentItem.ID === options.value;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (item)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn item.VALUE;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (crmField.type === 'checkbox')\n\t\t\t\t{\n\t\t\t\t\tif (Text.toBoolean(options.value))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_YES');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_NO');\n\t\t\t\t}\n\n\t\t\t\tif (Type.isStringFilled(options.value))\n\t\t\t\t{\n\t\t\t\t\treturn options.value;\n\t\t\t\t}\n\n\t\t\t\treturn Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_DEFAULT_VALUE');\n\t\t\t})();\n\n\t\t\tconst displayedLabel = (() => {\n\t\t\t\tconst fieldCategory = this.getCrmFieldCategoryById(crmField.entity_name);\n\t\t\t\treturn `${crmField.caption} Â· ${fieldCategory.CAPTION}`;\n\t\t\t})();\n\n\t\t\treturn {\n\t\t\t\tfield: crmField,\n\t\t\t\tvalue: options.value,\n\t\t\t\tdisplayedValue,\n\t\t\t\tdisplayedLabel,\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetListContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('listContainer', () => {\n\t\t\treturn Tag.render`<div class=\"landing-ui-field-defaultvalue-list-container\"></div>`;\n\t\t});\n\t}\n\n\tcreateInput(): HTMLDivElement\n\t{\n\t\treturn this.getListContainer();\n\t}\n\n\tgetCrmFieldById(id: string): ?CrmField\n\t{\n\t\treturn Object.values(this.options.crmFields)\n\t\t\t.reduce((acc, category) => {\n\t\t\t\treturn [...acc, ...category.FIELDS];\n\t\t\t}, [])\n\t\t\t.find((currentField) => {\n\t\t\t\treturn currentField.name === id;\n\t\t\t});\n\t}\n\n\tgetCrmFieldCategoryById(id: string): ?CrmFieldCategory\n\t{\n\t\treturn this.options.crmFields[id];\n\t}\n\n\taddItem(options: ItemOptions)\n\t{\n\t\tthis.items.push(\n\t\t\tnew ListItem({\n\t\t\t\tid: options.field.name,\n\t\t\t\ttitle: options.displayedLabel,\n\t\t\t\tdescription: options.displayedValue,\n\t\t\t\tdraggable: true,\n\t\t\t\teditable: true,\n\t\t\t\tremovable: true,\n\t\t\t\tappendTo: this.getListContainer(),\n\t\t\t\tonRemove: this.onItemRemove,\n\t\t\t\tonFormChange: this.onFormChange,\n\t\t\t\tform: this.createItemForm(options),\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetItemById(id: string): ?ListItem\n\t{\n\t\treturn this.items.find((currentItem) => {\n\t\t\treturn currentItem.options.id === id;\n\t\t});\n\t}\n\n\tonItemRemove(event: BaseEvent)\n\t{\n\t\tthis.items = this.items.filter((item) => {\n\t\t\treturn item !== event.getTarget();\n\t\t});\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tonFormChange(event: BaseEvent)\n\t{\n\t\tconst value = event.getTarget().getValue();\n\t\tconst item = this.getItemById(value.name);\n\t\tconst options = this.prepareItemOptions({\n\t\t\tid: value.name,\n\t\t\tvalue: value.label,\n\t\t});\n\n\t\tif (item)\n\t\t{\n\t\t\titem.setDescription(options.displayedValue);\n\t\t}\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tonDragEnd()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tthis.items = [...this.getListContainer().children].map((itemNode) => {\n\t\t\t\tconst itemNodeId = Dom.attr(itemNode, 'data-id');\n\t\t\t\treturn this.items.find((item) => {\n\t\t\t\t\treturn item.options.id === itemNodeId;\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t});\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.items.map((item) => {\n\t\t\tconst sourceValue = item.getValue();\n\t\t\tconst crmField = this.getCrmFieldById(sourceValue.name);\n\n\t\t\treturn {\n\t\t\t\tentityName: crmField.entity_name,\n\t\t\t\tfieldName: crmField.entity_field_name,\n\t\t\t\tvalue: sourceValue.value,\n\t\t\t};\n\t\t});\n\t}\n\n\tonFieldsSelect(selectedFields: Array<string>)\n\t{\n\t\tselectedFields.forEach((fieldId) => {\n\t\t\tthis.addItem(\n\t\t\t\tthis.prepareItemOptions({\n\t\t\t\t\tid: fieldId,\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tonSelectFieldButtonClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tFieldsPanel\n\t\t\t.getInstance({isLeadEnabled: this.options.isLeadEnabled})\n\t\t\t.show({\n\t\t\t\tisLeadEnabled: this.options.isLeadEnabled,\n\t\t\t\tallowedTypes: [\n\t\t\t\t\t'string',\n\t\t\t\t\t'list',\n\t\t\t\t\t'checkbox',\n\t\t\t\t\t'radio',\n\t\t\t\t\t'text',\n\t\t\t\t\t'integer',\n\t\t\t\t\t'double',\n\t\t\t\t\t'date',\n\t\t\t\t\t'datetime',\n\t\t\t\t\t'typed_string',\n\t\t\t\t],\n\t\t\t})\n\t\t\t.then((selectedFields) => {\n\t\t\t\tthis.onFieldsSelect(selectedFields);\n\t\t\t});\n\t}\n\n\tcreateItemForm(options = {}): FormSettingsForm\n\t{\n\t\tconst form = new FormSettingsForm({\n\t\t\tserializeModifier: (value) => {\n\t\t\t\tif (\n\t\t\t\t\toptions.field.type === 'list'\n\t\t\t\t\t|| options.field.type === 'checkbox'\n\t\t\t\t\t|| options.field.type === 'bool'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst valueItem = form.fields[0].items.find((item) => {\n\t\t\t\t\t\treturn item.value === value.value;\n\t\t\t\t\t});\n\n\t\t\t\t\tvalue.label = valueItem.name;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvalue.label = value.value;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\t\t});\n\n\t\tif (options.field.type === 'list')\n\t\t{\n\t\t\tform.addField(\n\t\t\t\tnew BX.Landing.UI.Field.Dropdown({\n\t\t\t\t\tselector: 'value',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\t\tcontent: options.value,\n\t\t\t\t\titems: options.field.items.map((item) => {\n\t\t\t\t\t\treturn {name: item.VALUE, value: item.ID};\n\t\t\t\t\t}),\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn form;\n\t\t}\n\n\t\tif (\n\t\t\toptions.field.type === 'bool'\n\t\t\t|| options.field.type === 'checkbox'\n\t\t)\n\t\t{\n\t\t\tform.addField(\n\t\t\t\tnew BX.Landing.UI.Field.Dropdown({\n\t\t\t\t\tselector: 'value',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\t\tcontent: options.value,\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{name: Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_YES'), value: 'Y'},\n\t\t\t\t\t\t{name: Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_NO'), value: 'N'},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn form;\n\t\t}\n\n\t\tif (\n\t\t\toptions.field.type === 'date'\n\t\t\t|| options.field.type === 'datetime'\n\t\t)\n\t\t{\n\t\t\tform.addField(\n\t\t\t\tnew DateTimeField({\n\t\t\t\t\tselector: 'value',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\t\ttime: options.field.type === 'datetime',\n\t\t\t\t\tcontent: options.value || '',\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn form;\n\t\t}\n\n\t\tform.addField(\n\t\t\tnew VariablesField({\n\t\t\t\tselector: 'value',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\tvariables: this.options.personalizationVariables,\n\t\t\t\tcontent: options.value || '',\n\t\t\t}),\n\t\t);\n\n\t\treturn form;\n\t}\n}"],"names":["DefaultValueField","options","setEventNamespace","subscribeFromOptions","fetchEventsFromOptions","onSelectFieldButtonClick","bind","onItemRemove","onDragEnd","onFormChange","items","actionPanel","ActionPanel","renderTo","layout","left","id","text","Loc","getMessage","onClick","draggable","Draggable","context","window","parent","container","getListContainer","dragElement","type","MOVE","offset","y","subscribe","forEach","item","itemOptions","prepareItemOptions","entityName","fieldName","value","addItem","crmField","getCrmFieldById","displayedValue","find","currentItem","ID","VALUE","Text","toBoolean","Type","isStringFilled","displayedLabel","fieldCategory","getCrmFieldCategoryById","entity_name","caption","CAPTION","field","cache","remember","Tag","render","Object","values","crmFields","reduce","acc","category","FIELDS","currentField","name","push","ListItem","title","description","editable","removable","appendTo","onRemove","form","createItemForm","event","filter","getTarget","emit","skipPrepare","getValue","getItemById","label","setDescription","setTimeout","children","map","itemNode","itemNodeId","Dom","attr","sourceValue","entity_field_name","selectedFields","fieldId","preventDefault","FieldsPanel","getInstance","isLeadEnabled","show","allowedTypes","then","onFieldsSelect","FormSettingsForm","serializeModifier","valueItem","fields","addField","BX","Landing","UI","Field","Dropdown","selector","content","DateTimeField","time","VariablesField","variables","personalizationVariables","BaseField"],"mappings":"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"}