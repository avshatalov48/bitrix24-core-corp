{"version":3,"file":"defaultvaluefield.bundle.js","sources":["../src/defaultvaluefield.js"],"sourcesContent":["import {Dom, Tag, Text, Type, Runtime} from 'main.core';\nimport {BaseField} from 'landing.ui.field.basefield';\nimport {DateTimeField} from 'landing.ui.field.datetimefield';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\nimport {Draggable} from 'ui.draganddrop.draggable';\nimport {Loc} from 'landing.loc';\nimport {ListItem} from 'landing.ui.component.listitem';\nimport {BaseEvent} from 'main.core.events';\nimport {FieldsPanel} from 'landing.ui.panel.fieldspanel';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {VariablesField} from 'landing.ui.field.variablesfield';\n\ntype CrmField = {\n\ttype: 'list' | 'string' | 'checkbox' | 'date' | 'text' | 'typed_string' | 'file',\n\tentity_field_name: string,\n\tentity_name: string,\n\tname: string,\n\tcaption: string,\n\tmultiple: boolean,\n\trequired: boolean,\n\thidden: boolean,\n\titems: Array<{ID: any, VALUE: any}>,\n};\n\ntype CrmFieldCategory = {\n\tCAPTION: string,\n\tFIELDS: Array<CrmField>\n};\n\ntype ItemOptions = {\n\tfield: CrmField,\n\tvalue: any,\n\tdisplayedValue: string,\n\tdisplayedLabel: string,\n};\n\nexport class DefaultValueField extends BaseField\n{\n\tstatic isListField(field: CrmField): boolean\n\t{\n\t\treturn Type.isArray(field.items);\n\t}\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.DefaultValueField');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\n\t\tthis.onSelectFieldButtonClick = this.onSelectFieldButtonClick.bind(this);\n\t\tthis.onItemRemove = this.onItemRemove.bind(this);\n\t\tthis.onDragEnd = this.onDragEnd.bind(this);\n\t\tthis.onFormChange = this.onFormChange.bind(this);\n\n\t\tthis.items = [];\n\n\t\tthis.actionPanel = new ActionPanel({\n\t\t\trenderTo: this.layout,\n\t\t\tleft: [\n\t\t\t\t{\n\t\t\t\t\tid: 'selectField',\n\t\t\t\t\ttext: Loc.getMessage('LANDING_FIELDS_SELECT_FIELD_BUTTON_TITLE'),\n\t\t\t\t\tonClick: this.onSelectFieldButtonClick,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tthis.draggable = new Draggable({\n\t\t\tcontext: window.parent,\n\t\t\tcontainer: this.getListContainer(),\n\t\t\tdraggable: '.landing-ui-component-list-item',\n\t\t\tdragElement: '.landing-ui-button-icon-drag',\n\t\t\ttype: Draggable.MOVE,\n\t\t\toffset: {\n\t\t\t\ty: -62,\n\t\t\t},\n\t\t});\n\n\t\tthis.draggable.subscribe('end', this.onDragEnd);\n\n\t\tthis.options.items.forEach((item) => {\n\t\t\tconst itemOptions = this.prepareItemOptions({\n\t\t\t\tid: `${item.entityName}_${item.fieldName}`,\n\t\t\t\tvalue: item.value,\n\t\t\t});\n\n\t\t\tif (itemOptions)\n\t\t\t{\n\t\t\t\tthis.addItem(itemOptions);\n\t\t\t}\n\t\t});\n\t}\n\n\tprepareItemOptions(options: {id: string, value: any}): ?ItemOptions\n\t{\n\t\tconst crmField = this.getCrmFieldById(options.id);\n\t\tif (crmField)\n\t\t{\n\t\t\tconst displayedValue = (() => {\n\t\t\t\tif (DefaultValueField.isListField(crmField))\n\t\t\t\t{\n\t\t\t\t\tconst fieldItems = this.getFieldItems(crmField);\n\t\t\t\t\tconst item = fieldItems.find((currentItem) => {\n\t\t\t\t\t\treturn currentItem.ID === options.value;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (item)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn item.VALUE;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn fieldItems[0].VALUE;\n\t\t\t\t}\n\n\t\t\t\tif (crmField.type === 'checkbox')\n\t\t\t\t{\n\t\t\t\t\tif (Text.toBoolean(options.value))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_YES');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_NO');\n\t\t\t\t}\n\n\t\t\t\tif (Type.isStringFilled(options.value))\n\t\t\t\t{\n\t\t\t\t\treturn options.value;\n\t\t\t\t}\n\n\t\t\t\treturn Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_DEFAULT_VALUE');\n\t\t\t})();\n\n\t\t\tconst displayedLabel = (() => {\n\t\t\t\tconst fieldCategory = this.getCrmFieldCategoryById(crmField.entity_name);\n\t\t\t\treturn `${crmField.caption} Â· ${fieldCategory.CAPTION}`;\n\t\t\t})();\n\n\t\t\treturn {\n\t\t\t\tfield: crmField,\n\t\t\t\tvalue: options.value,\n\t\t\t\tdisplayedValue,\n\t\t\t\tdisplayedLabel,\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetListContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('listContainer', () => {\n\t\t\treturn Tag.render`<div class=\"landing-ui-field-defaultvalue-list-container\"></div>`;\n\t\t});\n\t}\n\n\tcreateInput(): HTMLDivElement\n\t{\n\t\treturn this.getListContainer();\n\t}\n\n\tgetCrmFieldById(id: string): ?CrmField\n\t{\n\t\treturn Object.values(this.options.crmFields)\n\t\t\t.reduce((acc, category) => {\n\t\t\t\treturn [...acc, ...category.FIELDS];\n\t\t\t}, [])\n\t\t\t.find((currentField) => {\n\t\t\t\treturn currentField.name === id;\n\t\t\t});\n\t}\n\n\tgetCrmFieldCategoryById(id: string): ?CrmFieldCategory\n\t{\n\t\treturn this.options.crmFields[id];\n\t}\n\n\taddItem(options: ItemOptions)\n\t{\n\t\tthis.items.push(\n\t\t\tnew ListItem({\n\t\t\t\tid: options.field.name,\n\t\t\t\ttitle: options.displayedLabel,\n\t\t\t\tdescription: options.displayedValue,\n\t\t\t\tdraggable: true,\n\t\t\t\teditable: true,\n\t\t\t\tremovable: true,\n\t\t\t\tappendTo: this.getListContainer(),\n\t\t\t\tonRemove: this.onItemRemove,\n\t\t\t\tonFormChange: this.onFormChange,\n\t\t\t\tform: this.createItemForm(options),\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetItemById(id: string): ?ListItem\n\t{\n\t\treturn this.items.find((currentItem) => {\n\t\t\treturn currentItem.options.id === id;\n\t\t});\n\t}\n\n\tonItemRemove(event: BaseEvent)\n\t{\n\t\tthis.items = this.items.filter((item) => {\n\t\t\treturn item !== event.getTarget();\n\t\t});\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tonFormChange(event: BaseEvent)\n\t{\n\t\tconst value = event.getTarget().getValue();\n\t\tconst item = this.getItemById(value.name);\n\t\tconst options = this.prepareItemOptions({\n\t\t\tid: value.name,\n\t\t\tvalue: value.label,\n\t\t});\n\n\t\tif (item)\n\t\t{\n\t\t\titem.setDescription(options.displayedValue);\n\t\t}\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tonDragEnd()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tthis.items = [...this.getListContainer().children].map((itemNode) => {\n\t\t\t\tconst itemNodeId = Dom.attr(itemNode, 'data-id');\n\t\t\t\treturn this.items.find((item) => {\n\t\t\t\t\treturn item.options.id === itemNodeId;\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t});\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.items.map((item) => {\n\t\t\tconst sourceValue = item.getValue();\n\t\t\tconst crmField = this.getCrmFieldById(sourceValue.name);\n\n\t\t\treturn {\n\t\t\t\tentityName: crmField.entity_name,\n\t\t\t\tfieldName: crmField.entity_field_name,\n\t\t\t\tvalue: sourceValue.value,\n\t\t\t};\n\t\t});\n\t}\n\n\tonFieldsSelect(selectedFields: Array<string>)\n\t{\n\t\tselectedFields.forEach((fieldId) => {\n\t\t\tthis.addItem(\n\t\t\t\tthis.prepareItemOptions({\n\t\t\t\t\tid: fieldId,\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tgetAllowedCategories(): Array<string>\n\t{\n\t\tconst schemeId = this.options.formOptions.document.scheme;\n\t\tconst scheme = this.options.dictionary.document.schemes.find((item) => {\n\t\t\treturn String(schemeId) === String(item.id);\n\t\t});\n\n\t\tif (Type.isPlainObject(scheme))\n\t\t{\n\t\t\treturn Runtime.clone(scheme.entities);\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tonSelectFieldButtonClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tFieldsPanel\n\t\t\t.getInstance({isLeadEnabled: this.options.isLeadEnabled})\n\t\t\t.show({\n\t\t\t\tisLeadEnabled: this.options.isLeadEnabled,\n\t\t\t\tallowedCategories: this.getAllowedCategories(),\n\t\t\t\tallowedTypes: [\n\t\t\t\t\t'string',\n\t\t\t\t\t'list',\n\t\t\t\t\t'checkbox',\n\t\t\t\t\t'radio',\n\t\t\t\t\t'text',\n\t\t\t\t\t'integer',\n\t\t\t\t\t'double',\n\t\t\t\t\t'date',\n\t\t\t\t\t'datetime',\n\t\t\t\t\t'typed_string',\n\t\t\t\t],\n\t\t\t})\n\t\t\t.then((selectedFields) => {\n\t\t\t\tthis.onFieldsSelect(selectedFields);\n\t\t\t});\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetFieldItems(field): ?Array<any>\n\t{\n\t\tif (field.entity_field_name === 'STAGE_ID')\n\t\t{\n\t\t\tif (\n\t\t\t\tType.isPlainObject(this.options.formOptions.document)\n\t\t\t\t&& Type.isPlainObject(this.options.formOptions.document.deal)\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst categoryId = Text.toNumber(\n\t\t\t\t\tthis.options.formOptions.document.deal.category,\n\t\t\t\t);\n\n\t\t\t\tif (categoryId > 0)\n\t\t\t\t{\n\t\t\t\t\treturn field.itemsByCategory[categoryId];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn field.items;\n\t}\n\n\tcreateItemForm(options = {}): FormSettingsForm\n\t{\n\t\tconst form = new FormSettingsForm({\n\t\t\tserializeModifier: (value) => {\n\t\t\t\tif (\n\t\t\t\t\toptions.field.type === 'list'\n\t\t\t\t\t|| options.field.type === 'checkbox'\n\t\t\t\t\t|| options.field.type === 'bool'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst valueItem = this.getFieldItems(form.fields[0]).find((item) => {\n\t\t\t\t\t\treturn item.value === value.value;\n\t\t\t\t\t});\n\n\t\t\t\t\tvalue.label = valueItem.name;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvalue.label = value.value;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\t\t});\n\n\t\tif (DefaultValueField.isListField(options.field))\n\t\t{\n\t\t\tform.addField(\n\t\t\t\tnew BX.Landing.UI.Field.Dropdown({\n\t\t\t\t\tselector: 'value',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\t\tcontent: options.value,\n\t\t\t\t\titems: this.getFieldItems(options.field).map((item) => {\n\t\t\t\t\t\treturn {name: item.VALUE, value: item.ID};\n\t\t\t\t\t}),\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn form;\n\t\t}\n\n\t\tif (\n\t\t\toptions.field.type === 'bool'\n\t\t\t|| options.field.type === 'checkbox'\n\t\t)\n\t\t{\n\t\t\tform.addField(\n\t\t\t\tnew BX.Landing.UI.Field.Dropdown({\n\t\t\t\t\tselector: 'value',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\t\tcontent: options.value,\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{name: Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_NO'), value: 'N'},\n\t\t\t\t\t\t{name: Loc.getMessage('LANDING_DEFAULT_VALUE_FIELD_CHECKBOX_YES'), value: 'Y'},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn form;\n\t\t}\n\n\t\tif (\n\t\t\toptions.field.type === 'date'\n\t\t\t|| options.field.type === 'datetime'\n\t\t)\n\t\t{\n\t\t\tform.addField(\n\t\t\t\tnew DateTimeField({\n\t\t\t\t\tselector: 'value',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\t\ttime: options.field.type === 'datetime',\n\t\t\t\t\tcontent: options.value || '',\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn form;\n\t\t}\n\n\t\tform.addField(\n\t\t\tnew VariablesField({\n\t\t\t\tselector: 'value',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DEFAULT_VALUE_VALUE_FIELD_TITLE'),\n\t\t\t\tvariables: this.options.personalizationVariables,\n\t\t\t\tcontent: options.value || '',\n\t\t\t}),\n\t\t);\n\n\t\treturn form;\n\t}\n}"],"names":["DefaultValueField","field","Type","isArray","items","options","setEventNamespace","subscribeFromOptions","fetchEventsFromOptions","onSelectFieldButtonClick","bind","onItemRemove","onDragEnd","onFormChange","actionPanel","ActionPanel","renderTo","layout","left","id","text","Loc","getMessage","onClick","draggable","Draggable","context","window","parent","container","getListContainer","dragElement","type","MOVE","offset","y","subscribe","forEach","item","itemOptions","prepareItemOptions","entityName","fieldName","value","addItem","crmField","getCrmFieldById","displayedValue","isListField","fieldItems","getFieldItems","find","currentItem","ID","VALUE","Text","toBoolean","isStringFilled","displayedLabel","fieldCategory","getCrmFieldCategoryById","entity_name","caption","CAPTION","cache","remember","Tag","render","Object","values","crmFields","reduce","acc","category","FIELDS","currentField","name","push","ListItem","title","description","editable","removable","appendTo","onRemove","form","createItemForm","event","filter","getTarget","emit","skipPrepare","getValue","getItemById","label","setDescription","setTimeout","children","map","itemNode","itemNodeId","Dom","attr","sourceValue","entity_field_name","selectedFields","fieldId","schemeId","formOptions","document","scheme","dictionary","schemes","String","isPlainObject","Runtime","clone","entities","preventDefault","FieldsPanel","getInstance","isLeadEnabled","show","allowedCategories","getAllowedCategories","allowedTypes","then","onFieldsSelect","deal","categoryId","toNumber","itemsByCategory","FormSettingsForm","serializeModifier","valueItem","fields","addField","BX","Landing","UI","Field","Dropdown","selector","content","DateTimeField","time","VariablesField","variables","personalizationVariables","BaseField"],"mappings":"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"}