{"version":3,"file":"icon.bundle.js","sources":["../src/icon.js"],"sourcesContent":["import {Dom, Runtime, Type} from 'main.core';\nimport {IconPanel} from 'landing.ui.panel.iconpanel';\nimport {Image} from 'landing.ui.field.image'\nimport {IconOptionsCard} from 'landing.ui.card.iconoptionscard';\n\n\nimport './css/style.css';\n\n/**\n * @memberOf BX.Landing.UI.Field\n */\nexport class Icon extends Image\n{\n\tconstructor(data)\n\t{\n\t\tsuper(data);\n\t\tthis.uploadButton.layout.innerText = BX.Landing.Loc.getMessage(\"LANDING_ICONS_FIELD_BUTTON_REPLACE\");\n\t\tthis.editButton.layout.hidden = true;\n\t\tthis.clearButton.layout.hidden = true;\n\n\t\tthis.dropzone.removeEventListener(\"dragover\", this.onDragOver);\n\t\tthis.dropzone.removeEventListener(\"dragleave\", this.onDragLeave);\n\t\tthis.dropzone.removeEventListener(\"drop\", this.onDrop);\n\t\tthis.preview.removeEventListener(\"dragenter\", this.onImageDragEnter);\n\n\t\tthis.options = new IconOptionsCard();\n\t\tDom.append(this.options.getLayout(), this.right);\n\t\tthis.onOptionClick = this.onOptionClick.bind(this);\n\t\tthis.options.subscribe('onChange', this.onOptionClick);\n\n\t\tconst sourceClassList = this.content.classList;\n\t\tconst newClassList = [];\n\t\tIconPanel\n\t\t\t.getLibraries()\n\t\t\t.then(function (libraries)\n\t\t\t{\n\t\t\t\tif (libraries.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.uploadButton.disable();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlibraries.forEach(library => {\n\t\t\t\t\t\tlibrary.categories.forEach(category => {\n\t\t\t\t\t\t\tcategory.items.forEach(item => {\n\t\t\t\t\t\t\t\tlet itemClasses = '';\n\t\t\t\t\t\t\t\tif (Type.isObject(item))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titemClasses = item.options.join(' ');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titemClasses = item;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconst iconClasses = itemClasses.split(\" \");\n\t\t\t\t\t\t\t\ticonClasses.forEach(iconClass => {\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tsourceClassList.indexOf(iconClass) !== -1\n\t\t\t\t\t\t\t\t\t\t&& newClassList.indexOf(iconClass) === -1\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tnewClassList.push(iconClass);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.icon.innerHTML = \"<span class=\\\"test \" + newClassList.join(\" \") + \"\\\"></span>\";\n\t\t\t\t}\n\n\t\t\t\tthis.options.setOptionsByItem(newClassList);\n\t\t\t}.bind(this));\n\t}\n\n\tonUploadClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tIconPanel\n\t\t\t.getInstance()\n\t\t\t.show()\n\t\t\t.then(result => {\n\t\t\t\tthis.options.setOptions(result.iconOptions, result.iconClassName);\n\t\t\t\tthis.setValue({\n\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\tclassList: result.iconClassName.split(\" \")\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tonOptionClick(event)\n\t{\n\t\tconst classList = event.getData().option.split(' ');\n\t\tthis.setValue({\n\t\t\ttype: 'icon',\n\t\t\tclassList\n\t\t});\n\t}\n\n\tisChanged()\n\t{\n\t\treturn this.getValue().classList.some(function (className)\n\t\t{\n\t\t\treturn this.content.classList.indexOf(className) === -1;\n\t\t}, this);\n\t}\n\n\tgetValue()\n\t{\n\t\tvar classList = this.classList;\n\n\t\tif (this.selector)\n\t\t{\n\t\t\tvar selectorClassname = this.selector.split(\"@\")[0].replace(\".\", \"\");\n\t\t\tclassList = Runtime.clone(this.classList).concat([selectorClassname]);\n\t\t\tclassList = BX.Landing.Utils.arrayUnique(classList);\n\t\t}\n\n\t\treturn {\n\t\t\ttype: \"icon\",\n\t\t\tsrc: \"\",\n\t\t\tid: -1,\n\t\t\talt: \"\",\n\t\t\tclassList: classList,\n\t\t\turl: Object.assign({}, this.url.getValue(), {enabled: this.urlCheckbox.checked}),\n\t\t};\n\t}\n\n\treset()\n\t{\n\t\tthis.setValue({\n\t\t\ttype: \"icon\",\n\t\t\tsrc: \"\",\n\t\t\tid: -1,\n\t\t\talt: \"\",\n\t\t\tclassList: [],\n\t\t\turl: '',\n\t\t});\n\t}\n}"],"names":["Icon","data","uploadButton","layout","innerText","BX","Landing","Loc","getMessage","editButton","hidden","clearButton","dropzone","removeEventListener","onDragOver","onDragLeave","onDrop","preview","onImageDragEnter","options","IconOptionsCard","Dom","append","getLayout","right","onOptionClick","bind","subscribe","sourceClassList","content","classList","newClassList","IconPanel","getLibraries","then","libraries","length","disable","forEach","library","categories","category","items","item","itemClasses","Type","isObject","join","iconClasses","split","iconClass","indexOf","push","icon","innerHTML","setOptionsByItem","event","preventDefault","getInstance","show","result","setOptions","iconOptions","iconClassName","setValue","type","getData","option","getValue","some","className","selector","selectorClassname","replace","Runtime","clone","concat","Utils","arrayUnique","src","id","alt","url","Object","assign","enabled","urlCheckbox","checked","Image"],"mappings":";;;;;;CAQA;CACA;CACA;;AACA,KAAaA,IAAb;CAAA;;CAEC,gBAAYC,IAAZ,EACA;CAAA;;CAAA;CACC,sGAAMA,IAAN;CACA,UAAKC,YAAL,CAAkBC,MAAlB,CAAyBC,SAAzB,GAAqCC,EAAE,CAACC,OAAH,CAAWC,GAAX,CAAeC,UAAf,CAA0B,oCAA1B,CAArC;CACA,UAAKC,UAAL,CAAgBN,MAAhB,CAAuBO,MAAvB,GAAgC,IAAhC;CACA,UAAKC,WAAL,CAAiBR,MAAjB,CAAwBO,MAAxB,GAAiC,IAAjC;;CAEA,UAAKE,QAAL,CAAcC,mBAAd,CAAkC,UAAlC,EAA8C,MAAKC,UAAnD;;CACA,UAAKF,QAAL,CAAcC,mBAAd,CAAkC,WAAlC,EAA+C,MAAKE,WAApD;;CACA,UAAKH,QAAL,CAAcC,mBAAd,CAAkC,MAAlC,EAA0C,MAAKG,MAA/C;;CACA,UAAKC,OAAL,CAAaJ,mBAAb,CAAiC,WAAjC,EAA8C,MAAKK,gBAAnD;;CAEA,UAAKC,OAAL,GAAe,IAAIC,+CAAJ,EAAf;CACAC,IAAAA,aAAG,CAACC,MAAJ,CAAW,MAAKH,OAAL,CAAaI,SAAb,EAAX,EAAqC,MAAKC,KAA1C;CACA,UAAKC,aAAL,GAAqB,MAAKA,aAAL,CAAmBC,IAAnB,2CAArB;;CACA,UAAKP,OAAL,CAAaQ,SAAb,CAAuB,UAAvB,EAAmC,MAAKF,aAAxC;;CAEA,QAAMG,eAAe,GAAG,MAAKC,OAAL,CAAaC,SAArC;CACA,QAAMC,YAAY,GAAG,EAArB;CACAC,IAAAA,oCAAS,CACPC,YADF,GAEEC,IAFF,CAEO,UAAUC,SAAV,EACN;CACC,UAAIA,SAAS,CAACC,MAAV,KAAqB,CAAzB,EACA;CACC,aAAKlC,YAAL,CAAkBmC,OAAlB;CACA,OAHD,MAKA;CACCF,QAAAA,SAAS,CAACG,OAAV,CAAkB,UAAAC,OAAO,EAAI;CAC5BA,UAAAA,OAAO,CAACC,UAAR,CAAmBF,OAAnB,CAA2B,UAAAG,QAAQ,EAAI;CACtCA,YAAAA,QAAQ,CAACC,KAAT,CAAeJ,OAAf,CAAuB,UAAAK,IAAI,EAAI;CAC9B,kBAAIC,WAAW,GAAG,EAAlB;;CACA,kBAAIC,cAAI,CAACC,QAAL,CAAcH,IAAd,CAAJ,EACA;CACCC,gBAAAA,WAAW,GAAGD,IAAI,CAACxB,OAAL,CAAa4B,IAAb,CAAkB,GAAlB,CAAd;CACA,eAHD,MAKA;CACCH,gBAAAA,WAAW,GAAGD,IAAd;CACA;;CAED,kBAAMK,WAAW,GAAGJ,WAAW,CAACK,KAAZ,CAAkB,GAAlB,CAApB;CACAD,cAAAA,WAAW,CAACV,OAAZ,CAAoB,UAAAY,SAAS,EAAI;CAChC,oBACCtB,eAAe,CAACuB,OAAhB,CAAwBD,SAAxB,MAAuC,CAAC,CAAxC,IACGnB,YAAY,CAACoB,OAAb,CAAqBD,SAArB,MAAoC,CAAC,CAFzC,EAIA;CACCnB,kBAAAA,YAAY,CAACqB,IAAb,CAAkBF,SAAlB;CACA;CACD,eARD;CASA,aArBD;CAsBA,WAvBD;CAwBA,SAzBD;CA2BA,aAAKG,IAAL,CAAUC,SAAV,GAAsB,wBAAwBvB,YAAY,CAACgB,IAAb,CAAkB,GAAlB,CAAxB,GAAiD,YAAvE;CACA;;CAED,WAAK5B,OAAL,CAAaoC,gBAAb,CAA8BxB,YAA9B;CACA,KAvCK,CAuCJL,IAvCI,2CAFP;CAlBD;CA4DC;;CA/DF;CAAA;CAAA,kCAiEe8B,KAjEf,EAkEC;CAAA;;CACCA,MAAAA,KAAK,CAACC,cAAN;CAEAzB,MAAAA,oCAAS,CACP0B,WADF,GAEEC,IAFF,GAGEzB,IAHF,CAGO,UAAA0B,MAAM,EAAI;CACf,QAAA,MAAI,CAACzC,OAAL,CAAa0C,UAAb,CAAwBD,MAAM,CAACE,WAA/B,EAA4CF,MAAM,CAACG,aAAnD;;CACA,QAAA,MAAI,CAACC,QAAL,CAAc;CACbC,UAAAA,IAAI,EAAE,MADO;CAEbnC,UAAAA,SAAS,EAAE8B,MAAM,CAACG,aAAP,CAAqBd,KAArB,CAA2B,GAA3B;CAFE,SAAd;CAIA,OATF;CAUA;CA/EF;CAAA;CAAA,kCAiFeO,KAjFf,EAkFC;CACC,UAAM1B,SAAS,GAAG0B,KAAK,CAACU,OAAN,GAAgBC,MAAhB,CAAuBlB,KAAvB,CAA6B,GAA7B,CAAlB;CACA,WAAKe,QAAL,CAAc;CACbC,QAAAA,IAAI,EAAE,MADO;CAEbnC,QAAAA,SAAS,EAATA;CAFa,OAAd;CAIA;CAxFF;CAAA;CAAA,gCA2FC;CACC,aAAO,KAAKsC,QAAL,GAAgBtC,SAAhB,CAA0BuC,IAA1B,CAA+B,UAAUC,SAAV,EACtC;CACC,eAAO,KAAKzC,OAAL,CAAaC,SAAb,CAAuBqB,OAAvB,CAA+BmB,SAA/B,MAA8C,CAAC,CAAtD;CACA,OAHM,EAGJ,IAHI,CAAP;CAIA;CAhGF;CAAA;CAAA,+BAmGC;CACC,UAAIxC,SAAS,GAAG,KAAKA,SAArB;;CAEA,UAAI,KAAKyC,QAAT,EACA;CACC,YAAIC,iBAAiB,GAAG,KAAKD,QAAL,CAActB,KAAd,CAAoB,GAApB,EAAyB,CAAzB,EAA4BwB,OAA5B,CAAoC,GAApC,EAAyC,EAAzC,CAAxB;CACA3C,QAAAA,SAAS,GAAG4C,iBAAO,CAACC,KAAR,CAAc,KAAK7C,SAAnB,EAA8B8C,MAA9B,CAAqC,CAACJ,iBAAD,CAArC,CAAZ;CACA1C,QAAAA,SAAS,GAAGzB,EAAE,CAACC,OAAH,CAAWuE,KAAX,CAAiBC,WAAjB,CAA6BhD,SAA7B,CAAZ;CACA;;CAED,aAAO;CACNmC,QAAAA,IAAI,EAAE,MADA;CAENc,QAAAA,GAAG,EAAE,EAFC;CAGNC,QAAAA,EAAE,EAAE,CAAC,CAHC;CAINC,QAAAA,GAAG,EAAE,EAJC;CAKNnD,QAAAA,SAAS,EAAEA,SALL;CAMNoD,QAAAA,GAAG,EAAEC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,KAAKF,GAAL,CAASd,QAAT,EAAlB,EAAuC;CAACiB,UAAAA,OAAO,EAAE,KAAKC,WAAL,CAAiBC;CAA3B,SAAvC;CANC,OAAP;CAQA;CArHF;CAAA;CAAA,4BAwHC;CACC,WAAKvB,QAAL,CAAc;CACbC,QAAAA,IAAI,EAAE,MADO;CAEbc,QAAAA,GAAG,EAAE,EAFQ;CAGbC,QAAAA,EAAE,EAAE,CAAC,CAHQ;CAIbC,QAAAA,GAAG,EAAE,EAJQ;CAKbnD,QAAAA,SAAS,EAAE,EALE;CAMboD,QAAAA,GAAG,EAAE;CANQ,OAAd;CAQA;CAjIF;CAAA;CAAA,EAA0BM,4BAA1B;;;;;;;;"}