{"version":3,"file":"agreementslist.bundle.js","sources":["../src/agreementslist.js"],"sourcesContent":["import {Dom, Loc, Reflection, Runtime, Tag, Type} from 'main.core';\nimport {Menu} from 'main.popup';\nimport {BaseField} from 'landing.ui.field.basefield';\nimport {Draggable} from 'ui.draganddrop.draggable';\nimport {RadioButtonField} from 'landing.ui.field.radiobuttonfield';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {FormClient} from 'crm.form.client';\nimport {ListItem} from 'landing.ui.component.listitem';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {BaseEvent} from 'main.core.events';\nimport {Loader} from 'main.loader';\nimport {Backend} from 'landing.backend';\n\nimport './css/style.css';\n\n\ntype Agreement = {\n\tid: string,\n\tchecked: boolean,\n\tlabel: string,\n\tname: string,\n\trequired: boolean,\n\tvalue: 'Y' | 'N',\n\tcontent: {\n\t\ttext: string,\n\t\ttitle: string,\n\t\turl: ?string,\n\t},\n};\n\ntype AgreementsListItem = {\n\tid: string | number,\n\tname: string,\n\tlabelText: string,\n};\n\n/**\n * @memberOf BX.Landing.UI.Field\n */\nexport class AgreementsList extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.AgreementsList');\n\n\t\tthis.onSelectAgreementClick = this.onSelectAgreementClick.bind(this);\n\t\tthis.onCreateAgreementClick = this.onCreateAgreementClick.bind(this);\n\t\tthis.onUserConsentEditSave = this.onUserConsentEditSave.bind(this);\n\t\tthis.onUserConsentEditCancel = this.onUserConsentEditCancel.bind(this);\n\t\tthis.onItemRemoveClick = this.onItemRemoveClick.bind(this);\n\t\tthis.onDragEnd = this.onDragEnd.bind(this);\n\n\t\tthis.items = [];\n\n\t\tDom.replace(this.input, this.getListContainer());\n\t\tDom.append(this.getActionsContainer(), this.layout);\n\n\t\tvoid this.showAgreementLoader();\n\n\t\tFormClient\n\t\t\t.getInstance()\n\t\t\t.prepareOptions(this.options.formOptions, this.options.value)\n\t\t\t.then((result) => {\n\t\t\t\treturn result.data.agreements.map((item, index) => {\n\t\t\t\t\treturn Runtime.merge(item, this.options.value[index]);\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then((agreements) => {\n\t\t\t\tvoid this.hideAgreementLoader();\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tagreements.forEach((agreement) => {\n\t\t\t\t\t\tthis.addItem(agreement);\n\t\t\t\t\t});\n\t\t\t\t}, 200);\n\t\t\t});\n\n\t\tthis.draggable = new Draggable({\n\t\t\tcontext: window.parent,\n\t\t\tcontainer: this.getListContainer(),\n\t\t\tdraggable: '.landing-ui-component-list-item',\n\t\t\tdragElement: '.landing-ui-button-icon-drag',\n\t\t\ttype: Draggable.MOVE,\n\t\t\toffset: {\n\t\t\t\ty: -62,\n\t\t\t},\n\t\t});\n\n\t\tthis.draggable\n\t\t\t.subscribe('end', this.onDragEnd);\n\n\t\tconst addCustomEvent = Reflection.getClass('top.BX.addCustomEvent');\n\t\taddCustomEvent(window.top, 'main-user-consent-to-list', this.onUserConsentEditCancel);\n\t\taddCustomEvent(window.top, 'main-user-consent-saved', this.onUserConsentEditSave);\n\t}\n\n\tgetAgreementsList(): Array<AgreementsListItem>\n\t{\n\t\treturn this.cache.remember('agreementsList', () => {\n\t\t\treturn this.options.agreementsList;\n\t\t});\n\t}\n\n\tsetAgreementsList(agreements: Array<AgreementsListItem>)\n\t{\n\t\tthis.cache.set('agreementsList', agreements);\n\t}\n\n\tloadAgreementsList(): Promise<Array<AgreementsListItem>>\n\t{\n\t\treturn Backend.getInstance()\n\t\t\t.action('Form::getAgreements')\n\t\t\t.then((agreements) => {\n\t\t\t\treturn Runtime.orderBy(agreements, ['id'], ['asc']);\n\t\t\t});\n\t}\n\n\tgetAgreementById(id: string | number): ?AgreementsListItem\n\t{\n\t\treturn this.getAgreementsList().find((agreement) => {\n\t\t\treturn String(id) === String(agreement.id);\n\t\t});\n\t}\n\n\taddItem(itemOptions)\n\t{\n\t\tconst item = this.createItem(itemOptions);\n\t\titem.appendTo(this.getListContainer());\n\n\t\tthis.items = this.items.filter((currentItem) => {\n\t\t\treturn String(currentItem.options.id) !== String(item.options.id);\n\t\t});\n\n\t\tthis.items.push(item);\n\t}\n\n\tgetListContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('listContainer', () => {\n\t\t\treturn Tag.render`<div class=\"landing-ui-field-agreements-list-container\"></div>`;\n\t\t});\n\t}\n\n\tgetActionsContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('actionsContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-agreements-list-actions-container\">\n\t\t\t\t\t${this.getSelectAgreementButton()}\n\t\t\t\t\t${this.getCreateAgreementButton()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSelectAgreementButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('selectAgreementButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"landing-ui-field-agreements-list-actions-button\" onclick=\"${this.onSelectAgreementClick}\">\n\t\t\t\t\t${Loc.getMessage('LANDING_AGREEMENT_LIST_SELECT_BUTTON_LABEL')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetCreateAgreementButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('createAgreementButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"landing-ui-field-agreements-list-actions-button\" onclick=\"${this.onCreateAgreementClick}\">\n\t\t\t\t\t${Loc.getMessage('LANDING_AGREEMENT_LIST_CREATE_BUTTON_LABEL')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSelectedAgreements(): Array<number>\n\t{\n\t\treturn [...this.getListContainer().children].map((item) => {\n\t\t\treturn Dom.attr(item, 'data-value');\n\t\t});\n\t}\n\n\tgetAgreementsMenu(): Menu\n\t{\n\t\treturn this.cache.remember('agreementsMenu', () => {\n\t\t\tconst menu = new Menu({\n\t\t\t\tbindElement: this.getSelectAgreementButton(),\n\t\t\t\tautoHide: true,\n\t\t\t\tmaxWidth: 400,\n\t\t\t\tmaxHeight: 205,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: () => {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tDom.style(menu.getMenuContainer(), {\n\t\t\t\t\t\t\t\tleft: '0px',\n\t\t\t\t\t\t\t\tright: 'auto',\n\t\t\t\t\t\t\t\ttop: '30px',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.getAgreementsList()\n\t\t\t\t.filter((agreement) => {\n\t\t\t\t\treturn !this.items.some((item) => {\n\t\t\t\t\t\treturn String(item.options.id) === String(agreement.id);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.forEach((agreement) => {\n\t\t\t\t\tmenu.addMenuItem({\n\t\t\t\t\t\tid: agreement.id,\n\t\t\t\t\t\ttext: agreement.name,\n\t\t\t\t\t\tonclick: this.onAgreementsMenuItemClick.bind(this, agreement),\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\tDom.append(menu.getMenuContainer(), this.getActionsContainer());\n\n\t\t\treturn menu;\n\t\t});\n\t}\n\n\trefreshAgreementsMenu()\n\t{\n\t\tconst agreementsMenu = this.getAgreementsMenu();\n\t\tagreementsMenu.close();\n\t\tagreementsMenu.destroy();\n\t\tthis.cache.delete('agreementsMenu');\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tcreateItemForm(agreement: Agreement)\n\t{\n\t\treturn new FormSettingsForm({\n\t\t\tid: agreement.id,\n\t\t\ttitle: Loc.getMessage('LANDING_AGREEMENT_FORM_TITLE'),\n\t\t\tonChange: () => {\n\t\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t\t},\n\t\t\tserializeModifier(value) {\n\t\t\t\tif (value.type === 'type1')\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tchecked: true,\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (value.type === 'type2')\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tchecked: false,\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (value.type === 'type3')\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tchecked: true,\n\t\t\t\t\t\trequired: false,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (value.type === 'type4')\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tchecked: false,\n\t\t\t\t\t\trequired: false,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t},\n\t\t\tfields: [\n\t\t\t\tnew RadioButtonField({\n\t\t\t\t\tselector: 'type',\n\t\t\t\t\tvalue: (() => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tagreement.checked === true\n\t\t\t\t\t\t\t&& agreement.required === true\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn 'type1';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tagreement.checked === false\n\t\t\t\t\t\t\t&& agreement.required === true\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn 'type2';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tagreement.checked === true\n\t\t\t\t\t\t\t&& agreement.required === false\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn 'type3';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tagreement.checked === false\n\t\t\t\t\t\t\t&& agreement.required === false\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn 'type4';\n\t\t\t\t\t\t}\n\t\t\t\t\t})(),\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'type1',\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_AGREEMENT_FORM_TYPE_FIELD_ITEM_1'),\n\t\t\t\t\t\t\ticon: 'landing-ui-agreement-type-1-icon',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'type2',\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_AGREEMENT_FORM_TYPE_FIELD_ITEM_2'),\n\t\t\t\t\t\t\ticon: 'landing-ui-agreement-type-2-icon',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'type3',\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_AGREEMENT_FORM_TYPE_FIELD_ITEM_3'),\n\t\t\t\t\t\t\ticon: 'landing-ui-agreement-type-3-icon',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'type4',\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_AGREEMENT_FORM_TYPE_FIELD_ITEM_4'),\n\t\t\t\t\t\t\ticon: 'landing-ui-agreement-type-4-icon',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tnew ActionPanel({\n\t\t\t\t\tleft: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'edit',\n\t\t\t\t\t\t\ttext: Loc.getMessage('LANDING_AGREEMENT_EDIT_BUTTON_LABEL'),\n\t\t\t\t\t\t\tonClick: () => this.editAgreement(agreement),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'list',\n\t\t\t\t\t\t\ttext: Loc.getMessage('LANDING_AGREEMENT_CONSENTS_BUTTON_LABEL'),\n\t\t\t\t\t\t\tonClick: () => this.openConsentsList(agreement),\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t}\n\n\tgetAgreementLoader(): Loader\n\t{\n\t\treturn this.cache.remember('agreementLoader', () => {\n\t\t\treturn new Loader({\n\t\t\t\tsize: 50,\n\t\t\t\tmode: 'inline',\n\t\t\t\toffset: {\n\t\t\t\t\ttop: '5px',\n\t\t\t\t\tleft: '225px',\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tshowAgreementLoader(): Promise\n\t{\n\t\tconst loader = this.getAgreementLoader();\n\t\tDom.append(loader.layout, this.getListContainer());\n\t\treturn this.getAgreementLoader().show(this.getListContainer());\n\t}\n\n\thideAgreementLoader(): Promise\n\t{\n\t\treturn this.getAgreementLoader().hide();\n\t}\n\n\tonAgreementsMenuItemClick(itemOptions)\n\t{\n\t\tvoid this.showAgreementLoader();\n\n\t\tFormClient\n\t\t\t.getInstance()\n\t\t\t.prepareOptions(this.options.formOptions, {agreements: [{id: itemOptions.id}]})\n\t\t\t.then((result) => {\n\t\t\t\tvoid this.hideAgreementLoader();\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.addItem(result.data.agreements[0]);\n\t\t\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t\t\t}, 200);\n\t\t\t});\n\n\t\tthis.refreshAgreementsMenu();\n\t}\n\n\tonSelectAgreementClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst menu = this.getAgreementsMenu();\n\t\tif (!menu.getPopupWindow().isShown())\n\t\t{\n\t\t\tmenu.show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmenu.close();\n\t\t}\n\t}\n\n\tonCreateAgreementClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.editAgreement({id: 0});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tonItemHeaderClick(agreement: Agreement, event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst {parentElement} = event.currentTarget;\n\n\t\tDom.toggleClass(parentElement, 'landing-ui-field-agreements-list-item-active');\n\t}\n\n\tcreateItem(options: Agreement): ListItem\n\t{\n\t\tconst agreementListItem = this.getAgreementById(options.id);\n\n\t\treturn new ListItem({\n\t\t\tid: options.id,\n\t\t\ttitle: agreementListItem.name,\n\t\t\tdescription: agreementListItem.labelText,\n\t\t\tsourceOptions: options,\n\t\t\tdraggable: true,\n\t\t\teditable: true,\n\t\t\tremovable: true,\n\t\t\tform: this.createItemForm(options),\n\t\t\tonRemove: this.onItemRemoveClick,\n\t\t});\n\t}\n\n\tsetCurrentlyEdited(agreement: Agreement)\n\t{\n\t\tthis.cache.set('setCurrentlyEdited', agreement);\n\t}\n\n\tgetCurrentlyEdited(): ?Agreement\n\t{\n\t\treturn this.cache.get('setCurrentlyEdited') || null;\n\t}\n\n\t// eslint-disable-next-line\n\tbuildEditPath(agreementId): string\n\t{\n\t\treturn `/settings/configs/userconsent/edit/${agreementId}/`;\n\t}\n\n\t// eslint-disable-next-line\n\tbuildConsentsListPath(agreementId)\n\t{\n\t\treturn `/settings/configs/userconsent/consents/${agreementId}/`;\n\t}\n\n\teditAgreement(agreement: Agreement)\n\t{\n\t\tthis.setCurrentlyEdited(agreement);\n\n\t\tconst editPath = this.buildEditPath(agreement.id);\n\t\tBX.SidePanel.Instance.open(\n\t\t\teditPath,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t},\n\t\t);\n\t}\n\n\tcloseEditAgreementSlider()\n\t{\n\t\tconst currentlyEdited = this.getCurrentlyEdited();\n\t\tif (Type.isPlainObject(currentlyEdited))\n\t\t{\n\t\t\tconst path = this.buildEditPath(currentlyEdited.id);\n\t\t\tconst slider = BX.SidePanel.Instance.getSlider(path);\n\t\t\tif (slider)\n\t\t\t{\n\t\t\t\tslider.close();\n\t\t\t}\n\t\t}\n\t}\n\n\topenConsentsList(agreement: Agreement)\n\t{\n\t\tconst editPath = this.buildConsentsListPath(agreement.id);\n\t\tBX.SidePanel.Instance.open(\n\t\t\teditPath,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t},\n\t\t);\n\t}\n\n\tonUserConsentEditCancel()\n\t{\n\t\tthis.closeEditAgreementSlider();\n\t}\n\n\tonUserConsentEditSave()\n\t{\n\t\tthis.closeEditAgreementSlider();\n\t\tvoid this.showAgreementLoader();\n\n\t\tconst value = this.getValue();\n\n\t\tthis.loadAgreementsList()\n\t\t\t.then((agreements) => {\n\t\t\t\tthis.setAgreementsList(agreements);\n\n\t\t\t\tconst currentlyEdited = this.getCurrentlyEdited();\n\t\t\t\tif (currentlyEdited && currentlyEdited.id === 0)\n\t\t\t\t{\n\t\t\t\t\tconst lastAgreement = [...agreements].pop();\n\t\t\t\t\tFormClient\n\t\t\t\t\t\t.getInstance()\n\t\t\t\t\t\t.prepareOptions(this.options.formOptions, {agreements: [lastAgreement]})\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tvoid this.hideAgreementLoader();\n\t\t\t\t\t\t\tthis.addItem(result.data.agreements[0]);\n\t\t\t\t\t\t\tthis.refreshAgreementsMenu();\n\t\t\t\t\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.clean(this.getListContainer());\n\t\t\t\t\tvoid this.showAgreementLoader();\n\n\t\t\t\t\tFormClient\n\t\t\t\t\t\t.getInstance()\n\t\t\t\t\t\t.prepareOptions(this.options.formOptions, {agreements: value})\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tvoid this.hideAgreementLoader();\n\t\t\t\t\t\t\tthis.items = [];\n\t\t\t\t\t\t\tvalue.forEach((agreement) => {\n\t\t\t\t\t\t\t\tconst resultAgreement = result.data.agreements.find((currentAgreement) => {\n\t\t\t\t\t\t\t\t\treturn String(currentAgreement.id) === String(agreement.id);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (resultAgreement)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.addItem({\n\t\t\t\t\t\t\t\t\t\t...resultAgreement,\n\t\t\t\t\t\t\t\t\t\tchecked: agreement.checked,\n\t\t\t\t\t\t\t\t\t\trequired: agreement.required,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.addItem(agreement);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.refreshAgreementsMenu();\n\t\t\t\t\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tonItemRemoveClick(event: BaseEvent)\n\t{\n\t\tconst value = event.getTarget().getValue();\n\n\t\tthis.items = this.items.filter((item) => {\n\t\t\treturn String(item.options.id) !== String(value.id);\n\t\t});\n\n\t\tthis.refreshAgreementsMenu();\n\t\tthis.emit('onItemRemove', {item: value});\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tonDragEnd()\n\t{\n\t\tconst items = this.items;\n\t\tthis.items = [];\n\n\t\t[...this.getListContainer().children].forEach((element) => {\n\t\t\tconst id = Dom.attr(element, 'data-id');\n\t\t\tconst item = items.find((currentItem) => {\n\t\t\t\treturn String(currentItem.options.id) === String(id);\n\t\t\t});\n\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\tthis.items.push(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tgetValue(): Array<Agreement>\n\t{\n\t\treturn this.items.map((item) => {\n\t\t\treturn item.getValue();\n\t\t});\n\t}\n}"],"names":["AgreementsList","options","setEventNamespace","onSelectAgreementClick","bind","onCreateAgreementClick","onUserConsentEditSave","onUserConsentEditCancel","onItemRemoveClick","onDragEnd","items","Dom","replace","input","getListContainer","append","getActionsContainer","layout","showAgreementLoader","FormClient","getInstance","prepareOptions","formOptions","value","then","result","data","agreements","map","item","index","Runtime","merge","hideAgreementLoader","setTimeout","forEach","agreement","addItem","draggable","Draggable","context","window","parent","container","dragElement","type","MOVE","offset","y","subscribe","addCustomEvent","Reflection","getClass","top","cache","remember","agreementsList","set","Backend","action","orderBy","id","getAgreementsList","find","String","itemOptions","createItem","appendTo","filter","currentItem","push","Tag","render","getSelectAgreementButton","getCreateAgreementButton","Loc","getMessage","children","attr","menu","Menu","bindElement","autoHide","maxWidth","maxHeight","events","onPopupShow","style","getMenuContainer","left","right","some","addMenuItem","text","name","onclick","onAgreementsMenuItemClick","agreementsMenu","getAgreementsMenu","close","destroy","delete","FormSettingsForm","title","onChange","emit","skipPrepare","serializeModifier","checked","required","fields","RadioButtonField","selector","icon","ActionPanel","onClick","editAgreement","openConsentsList","Loader","size","mode","loader","getAgreementLoader","show","hide","refreshAgreementsMenu","event","preventDefault","getPopupWindow","isShown","parentElement","currentTarget","toggleClass","agreementListItem","getAgreementById","ListItem","description","labelText","sourceOptions","editable","removable","form","createItemForm","onRemove","get","agreementId","setCurrentlyEdited","editPath","buildEditPath","BX","SidePanel","Instance","open","cacheable","allowChangeHistory","currentlyEdited","getCurrentlyEdited","Type","isPlainObject","path","slider","getSlider","buildConsentsListPath","closeEditAgreementSlider","getValue","loadAgreementsList","setAgreementsList","lastAgreement","pop","clean","resultAgreement","currentAgreement","getTarget","element","BaseField"],"mappings":"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"}