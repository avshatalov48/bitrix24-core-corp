{"version":3,"file":"image.bundle.js","sources":["../src/image.js"],"sourcesContent":["import {Dom, Type, Runtime} from 'main.core';\nimport {Loc} from 'landing.loc';\nimport {Main} from 'landing.main'\nimport {TextField} from 'landing.ui.field.textfield';\nimport {ImageUploader} from 'landing.imageuploader';\nimport {BaseButton} from 'landing.ui.button.basebutton';\nimport {ImageEditor} from 'landing.imageeditor';\n\nimport 'ui.fonts.opensans';\nimport './css/style.css';\n\nexport class Image extends TextField\n{\n\tconstructor(data)\n\t{\n\t\tsuper(data);\n\n\t\tthis.dimensions = typeof data.dimensions === \"object\" ? data.dimensions : null;\n\t\tthis.create2xByDefault = data.create2xByDefault !== false;\n\t\tthis.uploadParams = typeof data.uploadParams === \"object\" ? data.uploadParams : {};\n\t\tthis.onValueChangeHandler = data.onValueChange ? data.onValueChange : (() => {});\n\t\tthis.type = this.content.type || \"image\";\n\t\tthis.allowClear = data.allowClear;\n\t\tthis.input.innerText = this.content.src;\n\t\tthis.input.hidden = true;\n\t\tthis.input2x = this.createInput();\n\t\tthis.input2x.innerText = this.content.src2x;\n\t\tthis.input2x.hidden = true;\n\n\t\tthis.layout.classList.add(\"landing-ui-field-image\");\n\t\tif (data.compactMode === true)\n\t\t{\n\t\t\tthis.layout.classList.add(\"landing-ui-field-image--compact\");\n\t\t}\n\n\t\tthis.disableAltField = typeof data.disableAltField === \"boolean\" ? data.disableAltField : false;\n\n\t\tthis.fileInput = Image.createFileInput(this.selector);\n\t\tthis.fileInput.addEventListener(\"change\", this.onFileInputChange.bind(this));\n\n\t\tthis.linkInput = Image.createLinkInput();\n\t\tthis.linkInput.onInputHandler = Runtime.debounce(this.onLinkInput.bind(this), 777);\n\n\t\tthis.dropzone = Image.createDropzone(this.selector);\n\t\tthis.dropzone.hidden = true;\n\t\tthis.dropzone.insertBefore(this.fileInput, this.dropzone.firstElementChild);\n\n\t\tthis.onDragOver = this.onDragOver.bind(this);\n\t\tthis.onDragLeave = this.onDragLeave.bind(this);\n\t\tthis.onDrop = this.onDrop.bind(this);\n\n\t\tthis.dropzone.addEventListener(\"dragover\", this.onDragOver);\n\t\tthis.dropzone.addEventListener(\"dragleave\", this.onDragLeave);\n\t\tthis.dropzone.addEventListener(\"drop\", this.onDrop);\n\n\t\tthis.clearButton = Image.createClearButton();\n\t\tthis.clearButton.on(\"click\", this.onClearClick.bind(this));\n\n\t\tthis.preview = Image.createImagePreview();\n\t\tthis.preview.appendChild(this.clearButton.layout);\n\t\tthis.preview.style.backgroundImage = \"url(\" + this.input.innerText.trim() + \")\";\n\n\t\tthis.onImageDragEnter = this.onImageDragEnter.bind(this);\n\t\tthis.preview.addEventListener(\"dragenter\", this.onImageDragEnter);\n\n\t\tthis.loader = new BX.Loader({target: this.preview});\n\n\t\tthis.icon = Image.createIcon();\n\n\t\tthis.image = Image.createImageLayout();\n\t\tthis.image.appendChild(this.preview);\n\t\tthis.image.appendChild(this.icon);\n\t\tthis.image.dataset.fileid = this.content.id;\n\t\tthis.image.dataset.fileid2x = this.content.id2x;\n\n\t\tthis.hiddenImage = Dom.create(\"img\", {\n\t\t\tprops: {className: \"landing-ui-field-image-hidden\"},\n\t\t});\n\n\t\tif (Type.isPlainObject(this.content) && \"src\" in this.content)\n\t\t{\n\t\t\tthis.hiddenImage.src = this.content.src;\n\t\t}\n\n\t\tthis.altField = Image.createAltField();\n\t\tthis.altField.setValue(this.content.alt);\n\n\t\tthis.left = Image.createLeftLayout();\n\t\tthis.left.appendChild(this.dropzone);\n\t\tthis.left.appendChild(this.image);\n\t\tthis.left.appendChild(this.hiddenImage);\n\n\t\tif (this.description)\n\t\t{\n\t\t\tthis.left.appendChild(this.description);\n\t\t}\n\n\t\tthis.left.appendChild(this.altField.layout);\n\t\tthis.left.appendChild(this.linkInput.layout);\n\n\t\tthis.uploadButton = Image.createUploadButton();\n\t\tthis.uploadButton.on(\"click\", this.onUploadClick.bind(this));\n\n\t\tthis.editButton = Image.createEditButton();\n\t\tthis.editButton.on(\"click\", this.onEditClick.bind(this));\n\n\t\tthis.right = Image.createRightLayout();\n\t\tthis.right.appendChild(this.uploadButton.layout);\n\t\tthis.right.appendChild(this.editButton.layout);\n\n\t\tthis.form = Image.createForm();\n\t\tthis.form.appendChild(this.left);\n\t\tthis.form.appendChild(this.right);\n\n\t\tthis.layout.appendChild(this.form);\n\n\t\tthis.enableTextOnly();\n\n\t\tif (!this.input.innerText.trim() || this.input.innerText.trim() === window.location.toString())\n\t\t{\n\t\t\tthis.showDropzone();\n\t\t}\n\n\t\tif (this.disableAltField)\n\t\t{\n\t\t\tthis.altField.layout.hidden = true;\n\t\t\tthis.altField.layout.style.display = \"none\";\n\t\t\tthis.altField.layout.classList.add(\"landing-ui-hide\");\n\t\t}\n\n\t\tif (this.content.type === \"icon\")\n\t\t{\n\t\t\tthis.type = \"icon\";\n\t\t\tthis.classList = this.content.classList;\n\t\t\tthis.showPreview();\n\t\t\tthis.altField.layout.hidden = true;\n\t\t\tDom.addClass(this.layout, 'landing-ui-field-image-icon');\n\t\t}\n\n\t\tthis.makeAsLinkWrapper = Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-make-as-link-wrapper\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: \"landing-ui-field-image-make-as-link-button\"},\n\t\t\t\t\tchildren: [],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.url = new BX.Landing.UI.Field.Link({\n\t\t\tcontent: this.content.url || {\n\t\t\t\ttext: '',\n\t\t\t\thref: '',\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tsiteId: Main.getInstance().options.site_id,\n\t\t\t\tlandingId: Main.getInstance().id,\n\t\t\t},\n\t\t\tcontentRoot: this.contentRoot,\n\t\t});\n\n\t\tthis.isDisabledUrl = this.content.url && this.content.url.enabled === false;\n\t\tif (this.isDisabledUrl)\n\t\t{\n\t\t\tthis.content.url.href = '';\n\t\t}\n\n\t\tthis.url.left.hidden = true;\n\n\t\tthis.makeAsLinkWrapper.appendChild(this.url.layout);\n\n\t\tif (!data.disableLink)\n\t\t{\n\t\t\tthis.layout.appendChild(this.makeAsLinkWrapper);\n\t\t}\n\n\t\tthis.content = this.getValue();\n\t\tBX.DOM.write(function ()\n\t\t{\n\t\t\tthis.adjustPreviewBackgroundSize();\n\t\t}.bind(this));\n\n\t\tif (this.getValue().type === \"background\" || this.allowClear)\n\t\t{\n\t\t\tthis.clearButton.layout.classList.add(\"landing-ui-show\");\n\t\t}\n\n\t\tthis.uploader = new ImageUploader({\n\t\t\tuploadParams: this.uploadParams,\n\t\t\tadditionalParams: {context: 'imageeditor'},\n\t\t\tdimensions: this.dimensions,\n\t\t\tsizes: ['1x', '2x'],\n\t\t\tallowSvg: Main.getInstance().options.allow_svg === true,\n\t\t});\n\n\t\tthis.adjustEditButtonState();\n\t}\n\n\t/**\n\t * Creates file input\n\t * @return {Element}\n\t */\n\tstatic createFileInput(id)\n\t{\n\t\treturn Dom.create(\"input\", {\n\t\t\tprops: {className: \"landing-ui-field-image-dropzone-input\"},\n\t\t\tattrs: {accept: \"image/*\", type: \"file\", id: \"file_\" + id, name: \"picture\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates link input field\n\t * @return {TextField}\n\t */\n\tstatic createLinkInput(): TextField\n\t{\n\t\tvar field = new TextField({\n\t\t\tid: \"path_to_image\",\n\t\t\tplaceholder: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_LINK_LABEL\"),\n\t\t});\n\t\tfield.enableTextOnly();\n\t\tfield.layout.hidden = true;\n\t\treturn field;\n\t}\n\n\t/**\n\t * Creates dropzone\n\t * @param {string} id\n\t * @return {Element}\n\t */\n\tstatic createDropzone(id)\n\t{\n\t\treturn Dom.create(\"label\", {\n\t\t\tprops: {className: \"landing-ui-field-image-dropzone\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"landing-ui-field-image-dropzone-text\"},\n\t\t\t\t\thtml: (\n\t\t\t\t\t\t\"<div class=\\\"landing-ui-field-image-dropzone-title\\\">\" + Loc.getMessage(\n\t\t\t\t\t\t\t\"LANDING_IMAGE_DROPZONE_TITLE\") + \"</div>\" +\n\t\t\t\t\t\t\"<div class=\\\"landing-ui-field-image-dropzone-subtitle\\\">\" + Loc.getMessage(\n\t\t\t\t\t\t\t\"LANDING_IMAGE_DROPZONE_SUBTITLE\") + \"</div>\"\n\t\t\t\t\t),\n\t\t\t\t}),\n\t\t\t],\n\t\t\tattrs: {\"for\": \"file_\" + id},\n\t\t});\n\t}\n\n\t/**\n\t * Creates clear button\n\t * @return {BaseButton}\n\t */\n\tstatic createClearButton()\n\t{\n\t\treturn new BaseButton(\"clear\", {\n\t\t\tclassName: \"landing-ui-field-image-action-button-clear\",\n\t\t});\n\t}\n\n\t/**\n\t * Creates image preview\n\t * @return {Element}\n\t */\n\tstatic createImagePreview()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-preview-inner\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates icon layout\n\t * @return {Element}\n\t */\n\tstatic createIcon()\n\t{\n\t\treturn Dom.create(\"span\", {\n\t\t\tprops: {className: \"landing-ui-field-image-preview-icon\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates image layout\n\t * @return {Element}\n\t */\n\tstatic createImageLayout()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-preview\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates alt field\n\t * @return {TextField}\n\t */\n\tstatic createAltField()\n\t{\n\t\tvar field = new TextField({\n\t\t\tplaceholder: Loc.getMessage(\"LANDING_FIELD_IMAGE_ALT_PLACEHOLDER\"),\n\t\t\tclassName: \"landing-ui-field-image-alt\",\n\t\t\ttextOnly: true,\n\t\t});\n\t\treturn field;\n\t}\n\n\t/**\n\t * Creates left layout\n\t * @return {Element}\n\t */\n\tstatic createLeftLayout()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-left\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates upload button\n\t * @return {BaseButton}\n\t */\n\tstatic createUploadButton()\n\t{\n\t\treturn new BaseButton(\"upload\", {\n\t\t\ttext: Loc.getMessage(\"LANDING_FIELD_IMAGE_UPLOAD_BUTTON\"),\n\t\t\tclassName: \"landing-ui-field-image-action-button\",\n\t\t});\n\t}\n\n\t/**\n\t * Creates edit button\n\t * @return {BaseButton}\n\t */\n\tstatic createEditButton()\n\t{\n\t\tvar field = new BaseButton(\"edit\", {\n\t\t\ttext: Loc.getMessage(\"LANDING_FIELD_IMAGE_EDIT_BUTTON\"),\n\t\t\tclassName: \"landing-ui-field-image-action-button\",\n\t\t});\n\n\t\treturn field;\n\t}\n\n\t/**\n\t * Creates right layout\n\t * @return {Element}\n\t */\n\tstatic createRightLayout()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-right\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates form\n\t * @return {Element}\n\t */\n\tstatic createForm()\n\t{\n\t\treturn Dom.create(\"form\", {\n\t\t\tprops: {className: \"landing-ui-field-image-container\"},\n\t\t\tattrs: {method: \"post\", enctype: \"multipart/form-data\"},\n\t\t\tevents: {\n\t\t\t\tsubmit: function (event)\n\t\t\t\t{\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tonInputInput()\n\t{\n\t\tthis.preview.src = this.input.innerText.trim();\n\t}\n\n\tonImageDragEnter(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif (!this.imageHidden)\n\t\t{\n\t\t\tthis.showDropzone();\n\t\t\tthis.imageHidden = true;\n\t\t}\n\t}\n\n\tonDragOver(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.dropzone.classList.add(\"landing-ui-active\");\n\t}\n\n\tonDragLeave(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.dropzone.classList.remove(\"landing-ui-active\");\n\n\t\tif (this.imageHidden)\n\t\t{\n\t\t\tthis.imageHidden = false;\n\t\t\tthis.showPreview();\n\t\t}\n\t}\n\n\tonDrop(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.dropzone.classList.remove(\"landing-ui-active\");\n\t\tthis.onFileChange(event.dataTransfer.files[0]);\n\t\tthis.imageHidden = false;\n\t}\n\n\tonFileChange(file)\n\t{\n\t\tthis.showLoader();\n\n\t\tthis.upload(file)\n\t\t\t.then(this.setValue.bind(this))\n\t\t\t.then(this.hideLoader.bind(this))\n\t\t\t.catch(function (err)\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.hideLoader();\n\t\t\t}.bind(this));\n\t}\n\n\tonFileInputChange(event)\n\t{\n\t\tthis.onFileChange(event.currentTarget.files[0]);\n\t}\n\n\tonUploadClick(event)\n\t{\n\t\tthis.bindElement = event.currentTarget;\n\n\t\tevent.preventDefault();\n\n\t\tif (!this.uploadMenu)\n\t\t{\n\t\t\tthis.uploadMenu = BX.Main.MenuManager.create({\n\t\t\t\tid: \"upload_\" + this.selector + (+new Date()),\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t},\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_UNSPLASH\"),\n\t\t\t\t\t\tonclick: this.onUnsplashShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_GOOGLE\"),\n\t\t\t\t\t\tonclick: this.onGoogleShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t// {\n\t\t\t\t\t// \ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_PARTNER\"),\n\t\t\t\t\t// \tclassName: \"landing-ui-disabled\"\n\t\t\t\t\t// },\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_UPLOAD\"),\n\t\t\t\t\t\tonclick: this.onUploadShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_LINK\"),\n\t\t\t\t\t\tonclick: this.onLinkShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.bindElement.classList.remove(\"landing-ui-active\");\n\n\t\t\t\t\t\tif (this.uploadMenu)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.uploadMenu.destroy();\n\t\t\t\t\t\t\tthis.uploadMenu = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this),\n\t\t\t\t},\n\t\t\t\ttargetContainer: this.contentRoot,\n\t\t\t});\n\t\t\tif (!this.contentRoot)\n\t\t\t{\n\t\t\t\tthis.bindElement.parentNode.appendChild(this.uploadMenu.popupWindow.popupContainer);\n\t\t\t}\n\t\t}\n\n\t\tthis.bindElement.classList.add(\"landing-ui-active\");\n\t\tthis.uploadMenu.toggle();\n\n\t\tif (!this.contentRoot && this.uploadMenu)\n\t\t{\n\t\t\tvar rect = BX.pos(this.bindElement, this.bindElement.parentNode);\n\t\t\tthis.uploadMenu.popupWindow.popupContainer.style.top = rect.bottom + \"px\";\n\t\t\tthis.uploadMenu.popupWindow.popupContainer.style.left = \"auto\";\n\t\t\tthis.uploadMenu.popupWindow.popupContainer.style.right = \"5px\";\n\t\t}\n\t}\n\n\tonUnsplashShow()\n\t{\n\t\tthis.uploadMenu.close();\n\n\t\tBX.Landing.UI.Panel.Image.getInstance()\n\t\t\t.show(\"unsplash\", this.dimensions, this.loader, this.uploadParams)\n\t\t\t.then(this.upload.bind(this))\n\t\t\t.then(this.setValue.bind(this))\n\t\t\t.then(this.hideLoader.bind(this))\n\t\t\t.catch(function (err)\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.hideLoader();\n\t\t\t}.bind(this));\n\t}\n\n\tonGoogleShow()\n\t{\n\t\tthis.uploadMenu.close();\n\n\t\tBX.Landing.UI.Panel.Image.getInstance()\n\t\t\t.show(\"google\", this.dimensions, this.loader, this.uploadParams)\n\t\t\t.then(this.upload.bind(this))\n\t\t\t.then(this.setValue.bind(this))\n\t\t\t.then(this.hideLoader.bind(this))\n\t\t\t.catch(function (err)\n\t\t\t{\n\t\t\t\tBX.Landing.ErrorManager.getInstance().add({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\taction: 'BAD_IMAGE',\n\t\t\t\t\thideSupportLink: true,\n\t\t\t\t});\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.hideLoader();\n\t\t\t}.bind(this));\n\t}\n\n\tonUploadShow()\n\t{\n\t\tthis.uploadMenu.close();\n\t\tthis.fileInput.click();\n\t}\n\n\tonLinkShow()\n\t{\n\t\tthis.uploadMenu.close();\n\t\tthis.showLinkField();\n\t\tthis.linkInput.setValue(\"\");\n\t}\n\n\tonEditClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.edit({src: this.hiddenImage.src});\n\t}\n\n\tonClearClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.setValue({src: \"\"});\n\t\tthis.fileInput.value = \"\";\n\t\tthis.showDropzone();\n\t}\n\n\tshowDropzone()\n\t{\n\t\tthis.dropzone.hidden = false;\n\t\tthis.image.hidden = true;\n\t\tthis.altField.layout.hidden = true;\n\t\tthis.linkInput.layout.hidden = true;\n\t}\n\n\tshowPreview()\n\t{\n\t\tthis.dropzone.hidden = true;\n\t\tthis.image.hidden = false;\n\t\tthis.altField.layout.hidden = false;\n\t\tthis.linkInput.layout.hidden = true;\n\t}\n\n\tshowLinkField()\n\t{\n\t\tthis.dropzone.hidden = true;\n\t\tthis.image.hidden = true;\n\t\tthis.altField.layout.hidden = true;\n\t\tthis.linkInput.layout.hidden = false;\n\t}\n\n\tonLinkInput(value)\n\t{\n\t\tconst tmpImage = Dom.create(\"img\");\n\t\ttmpImage.src = value;\n\t\ttmpImage.onload = () => {\n\t\t\tthis.showPreview();\n\t\t\tthis.setValue({src: value, src2x: value});\n\t\t};\n\t}\n\n\tshowLoader()\n\t{\n\t\tif (this.dropzone && !this.dropzone.hidden)\n\t\t{\n\t\t\tthis.loader.show(this.dropzone);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loader.show(this.preview);\n\t}\n\n\thideLoader()\n\t{\n\t\tthis.loader.hide();\n\t}\n\n\t/**\n\t * Handles click event on input field\n\t * @param {MouseEvent} event\n\t */\n\tonInputClick(event)\n\t{\n\t\tevent.preventDefault();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t * @return {boolean}\n\t */\n\tisChanged()\n\t{\n\t\tvar lastValue = BX.Landing.Utils.clone(this.content);\n\t\tvar currentValue = BX.Landing.Utils.clone(this.getValue());\n\n\t\tif (lastValue.url && Type.isString(lastValue.url))\n\t\t{\n\t\t\tlastValue.url = BX.Landing.Utils.decodeDataValue(lastValue.url);\n\t\t}\n\n\t\tif (currentValue.url && Type.isString(currentValue.url))\n\t\t{\n\t\t\tcurrentValue.url = BX.Landing.Utils.decodeDataValue(currentValue.url);\n\t\t}\n\n\t\treturn JSON.stringify(lastValue) !== JSON.stringify(currentValue);\n\t}\n\n\t/**\n\t * Adjusts preview background image size\n\t */\n\tadjustPreviewBackgroundSize()\n\t{\n\t\tvar img = Dom.create(\"img\", {attrs: {src: this.getValue().src}});\n\n\t\timg.onload = function ()\n\t\t{\n\t\t\tvar preview = this.preview.getBoundingClientRect();\n\t\t\tvar position = \"cover\";\n\n\t\t\tif (img.width > preview.width || img.height > preview.height)\n\t\t\t{\n\t\t\t\tposition = \"contain\";\n\t\t\t}\n\n\t\t\tif (img.width < preview.width && img.height < preview.height)\n\t\t\t{\n\t\t\t\tposition = \"auto\";\n\t\t\t}\n\n\t\t\tBX.DOM.write(function ()\n\t\t\t{\n\t\t\t\tthis.preview.style.backgroundSize = position;\n\t\t\t}.bind(this));\n\t\t}.bind(this);\n\t}\n\n\t/**\n\t * @param {object} value\n\t * @param {boolean} [preventEvent = false]\n\t */\n\tsetValue(value, preventEvent)\n\t{\n\t\tif (value.type !== \"icon\")\n\t\t{\n\t\t\tif (!value || !value.src)\n\t\t\t{\n\t\t\t\tthis.input.innerText = \"\";\n\t\t\t\tthis.input2x.innerText = \"\";\n\t\t\t\tthis.preview.removeAttribute(\"style\");\n\t\t\t\tthis.input.dataset.ext = \"\";\n\t\t\t\tthis.showDropzone();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.input.innerText = value.src;\n\t\t\t\tthis.input2x.innerText = value.src2x || '';\n\t\t\t\tthis.preview.style.backgroundImage = \"url(\\\"\" + (value.src2x || value.src) + \"\\\")\";\n\t\t\t\tthis.preview.id = BX.util.getRandomString();\n\t\t\t\tthis.hiddenImage.src = value.src2x || value.src;\n\t\t\t\tthis.showPreview();\n\t\t\t}\n\n\t\t\tthis.image.dataset.fileid = value && value.id ? value.id : -1;\n\t\t\tthis.image.dataset.fileid2x = value && value.id2x ? value.id2x : -1;\n\n\t\t\tthis.classList = [];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.preview.style.backgroundImage = null;\n\t\t\tthis.classList = value.classList;\n\t\t\tthis.icon.innerHTML = \"<span class=\\\"\" + value.classList.join(\" \") + \"\\\"></span>\";\n\t\t\tthis.showPreview();\n\t\t\tthis.type = \"icon\";\n\t\t\tthis.altField.layout.hidden = true;\n\t\t\tthis.altField.setValue(\"\");\n\t\t\tthis.input.innerText = \"\";\n\t\t}\n\n\t\tif (value.url)\n\t\t{\n\t\t\tthis.url.setValue(value.url);\n\t\t}\n\n\t\tthis.adjustPreviewBackgroundSize();\n\t\tthis.adjustEditButtonState();\n\t\tthis.hideLoader();\n\n\t\tthis.onValueChangeHandler(this);\n\t\tBX.fireEvent(this.layout, \"input\");\n\n\t\tvar event = new BX.Event.BaseEvent({\n\t\t\tdata: {value: this.getValue()},\n\t\t\tcompatData: [this.getValue()],\n\t\t});\n\t\tif (!preventEvent)\n\t\t{\n\t\t\tthis.emit('change', event);\n\t\t}\n\t}\n\n\tadjustEditButtonState()\n\t{\n\t\tvar value = this.getValue();\n\t\tif (BX.Type.isStringFilled(value.src))\n\t\t{\n\t\t\tthis.editButton.enable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.editButton.disable();\n\t\t}\n\t}\n\n\treset()\n\t{\n\t\tthis.setValue({\n\t\t\ttype: this.getValue().type,\n\t\t\tid: -1,\n\t\t\tsrc: \"\",\n\t\t\talt: \"\",\n\t\t});\n\t}\n\n\t/**\n\t * Gets field value\n\t * @return {{src, [alt]: string, [title]: string, [url]: string, [type]: string}}\n\t */\n\tgetValue()\n\t{\n\t\tvar fileId = parseInt(this.image.dataset.fileid);\n\t\tvar fileId2x = parseInt(this.image.dataset.fileid2x);\n\t\tfileId = fileId === fileId ? fileId : -1;\n\t\tfileId2x = fileId2x === fileId2x ? fileId2x : -1;\n\n\t\tvar value = {type: \"\", src: \"\", id: fileId, id2x: fileId2x, src2x: \"\", alt: \"\", url: \"\"};\n\n\t\tif (this.type === \"background\")\n\t\t{\n\t\t\tvalue.type = \"background\";\n\t\t\tvalue.src = this.input.innerText.trim();\n\t\t\tvalue.src2x = this.input2x.innerText.trim();\n\t\t\tvalue.id = fileId;\n\t\t\tvalue.id2x = fileId2x;\n\t\t}\n\n\t\tif (this.type === \"image\")\n\t\t{\n\t\t\tvalue.type = \"image\";\n\t\t\tvalue.src = this.input.innerText.trim();\n\t\t\tvalue.src2x = this.input2x.innerText.trim();\n\t\t\tvalue.id = fileId;\n\t\t\tvalue.id2x = fileId2x;\n\t\t\tvalue.alt = this.altField.getValue();\n\t\t}\n\n\t\tif (this.type === \"icon\")\n\t\t{\n\t\t\tvalue.type = \"icon\";\n\t\t\tvalue.classList = this.classList;\n\t\t}\n\n\t\tvalue.url = Object.assign({}, this.url.getValue(), {enabled: true});\n\n\t\treturn value;\n\t}\n\n\tedit(data)\n\t{\n\t\tImageEditor\n\t\t\t.edit({\n\t\t\t\timage: data.src,\n\t\t\t\tdimensions: this.dimensions,\n\t\t\t})\n\t\t\t.then(function (file)\n\t\t\t{\n\t\t\t\treturn this.upload(file, {context: \"imageEditor\"});\n\t\t\t}.bind(this))\n\t\t\t.then(function (result)\n\t\t\t{\n\t\t\t\tthis.setValue(result);\n\t\t\t}.bind(this));\n\n\t\t// Analytics hack\n\t\tconst tmpImage = document.createElement('img');\n\t\tlet imageSrc = \"/bitrix/images/landing/close.svg\";\n\n\t\timageSrc = BX.util.add_url_param(imageSrc, {\n\t\t\taction: \"openImageEditor\",\n\t\t});\n\n\t\ttmpImage.src = imageSrc + \"?\" + (+new Date());\n\t}\n\n\t/**\n\t * @param {File|Blob} file\n\t * @param {object} [additionalParams]\n\t */\n\tupload(file, additionalParams)\n\t{\n\t\tif (file.type && (file.type.includes('text') || file.type.includes('html')))\n\t\t{\n\t\t\tBX.Landing.ErrorManager.getInstance().add({\n\t\t\t\ttype: \"error\",\n\t\t\t\taction: \"BAD_IMAGE\",\n\t\t\t});\n\n\t\t\treturn Promise.reject({\n\t\t\t\ttype: \"error\",\n\t\t\t\taction: \"BAD_IMAGE\",\n\t\t\t});\n\t\t}\n\n\t\tthis.showLoader();\n\n\t\tconst isPng = (\n\t\t\tType.isStringFilled(file.type)\n\t\t\t&& file.type.includes('png')\n\t\t);\n\n\t\tconst isSvg = (\n\t\t\tType.isStringFilled(file.type)\n\t\t\t&& file.type.includes('svg')\n\t\t);\n\n\t\tconst checkSize = new Promise(function (resolve)\n\t\t{\n\t\t\tlet sizes = (isPng || isSvg) ? ['2x'] : ['1x', '2x'];\n\n\t\t\tif (this.create2xByDefault === false)\n\t\t\t{\n\t\t\t\tconst image = document.createElement('img');\n\t\t\t\tconst objectUrl = URL.createObjectURL(file);\n\t\t\t\tconst dimensions = this.dimensions;\n\t\t\t\timage.onload = function ()\n\t\t\t\t{\n\t\t\t\t\tURL.revokeObjectURL(objectUrl);\n\t\t\t\t\tif (\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tthis.width >= dimensions.width\n\t\t\t\t\t\t\t|| this.height >= dimensions.height\n\t\t\t\t\t\t\t|| this.width >= dimensions.maxWidth\n\t\t\t\t\t\t\t|| this.height >= dimensions.maxHeight\n\t\t\t\t\t\t) === false\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tsizes = (isPng || isSvg) ? ['2x'] : ['1x'];\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(sizes);\n\t\t\t\t};\n\t\t\t\timage.src = objectUrl;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve(sizes);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn checkSize\n\t\t\t.then(function (allowedSizes)\n\t\t\t{\n\t\t\t\tvar sizes = (function ()\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.create2xByDefault === false\n\t\t\t\t\t\t&& BX.Type.isArrayFilled(allowedSizes)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn allowedSizes;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (isPng || isSvg) ? ['2x'] : ['1x', '2x'];\n\t\t\t\t}.bind(this))();\n\n\t\t\t\treturn this.uploader\n\t\t\t\t\t.setSizes(sizes)\n\t\t\t\t\t.upload(file, additionalParams)\n\t\t\t\t\t.then(function (result)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.hideLoader();\n\n\t\t\t\t\t\tif (sizes.length === 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn result[0];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Object.assign({}, result[0], {\n\t\t\t\t\t\t\tsrc2x: result[1].src,\n\t\t\t\t\t\t\tid2x: result[1].id,\n\t\t\t\t\t\t});\n\t\t\t\t\t}.bind(this));\n\t\t\t}.bind(this));\n\t}\n}"],"names":["Image","data","dimensions","create2xByDefault","uploadParams","onValueChangeHandler","onValueChange","type","content","allowClear","input","innerText","src","hidden","input2x","createInput","src2x","layout","classList","add","compactMode","disableAltField","fileInput","createFileInput","selector","addEventListener","onFileInputChange","bind","linkInput","createLinkInput","onInputHandler","Runtime","debounce","onLinkInput","dropzone","createDropzone","insertBefore","firstElementChild","onDragOver","onDragLeave","onDrop","clearButton","createClearButton","on","onClearClick","preview","createImagePreview","appendChild","style","backgroundImage","trim","onImageDragEnter","loader","BX","Loader","target","icon","createIcon","image","createImageLayout","dataset","fileid","id","fileid2x","id2x","hiddenImage","Dom","create","props","className","Type","isPlainObject","altField","createAltField","setValue","alt","left","createLeftLayout","description","uploadButton","createUploadButton","onUploadClick","editButton","createEditButton","onEditClick","right","createRightLayout","form","createForm","enableTextOnly","window","location","toString","showDropzone","display","showPreview","addClass","makeAsLinkWrapper","children","url","Landing","UI","Field","Link","text","href","options","siteId","Main","getInstance","site_id","landingId","contentRoot","isDisabledUrl","enabled","disableLink","getValue","DOM","write","adjustPreviewBackgroundSize","uploader","ImageUploader","additionalParams","context","sizes","allowSvg","allow_svg","adjustEditButtonState","event","preventDefault","stopPropagation","imageHidden","remove","onFileChange","dataTransfer","files","file","showLoader","upload","then","hideLoader","err","console","error","currentTarget","bindElement","uploadMenu","MenuManager","Date","bindOptions","forceBindPosition","items","Loc","getMessage","onclick","onUnsplashShow","onGoogleShow","onUploadShow","onLinkShow","events","onPopupClose","destroy","targetContainer","parentNode","popupWindow","popupContainer","toggle","rect","pos","top","bottom","close","Panel","show","ErrorManager","action","hideSupportLink","click","showLinkField","edit","value","tmpImage","onload","hide","lastValue","Utils","clone","currentValue","isString","decodeDataValue","JSON","stringify","img","attrs","getBoundingClientRect","position","width","height","backgroundSize","preventEvent","removeAttribute","ext","util","getRandomString","innerHTML","join","fireEvent","Event","BaseEvent","compatData","emit","isStringFilled","enable","disable","fileId","parseInt","fileId2x","Object","assign","ImageEditor","result","document","createElement","imageSrc","add_url_param","includes","Promise","reject","isPng","isSvg","checkSize","resolve","objectUrl","URL","createObjectURL","revokeObjectURL","maxWidth","maxHeight","allowedSizes","isArrayFilled","setSizes","length","accept","name","field","TextField","placeholder","html","BaseButton","textOnly","method","enctype","submit"],"mappings":"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"}