{"version":3,"file":"image.bundle.js","sources":["../src/image.js"],"sourcesContent":["import {Dom, Type} from 'main.core';\nimport {Loc} from 'landing.loc';\nimport {Main} from 'landing.main'\nimport {TextField} from 'landing.ui.field.textfield';\nimport {IconPanel} from 'landing.ui.panel.iconpanel';\nimport {ImageUploader} from 'landing.imageuploader';\nimport {BaseButton} from 'landing.ui.button.basebutton';\nimport {ImageEditor} from 'landing.imageeditor';\n\nimport './css/style.css';\n\nexport class Image extends TextField\n{\n\tconstructor(data)\n\t{\n\t\tsuper(data);\n\n\t\tthis.dimensions = typeof data.dimensions === \"object\" ? data.dimensions : null;\n\t\tthis.create2xByDefault = data.create2xByDefault !== false;\n\t\tthis.uploadParams = typeof data.uploadParams === \"object\" ? data.uploadParams : {};\n\t\tthis.onValueChangeHandler = data.onValueChange ? data.onValueChange : (() => {});\n\t\tthis.type = this.content.type || \"image\";\n\t\tthis.allowClear = data.allowClear;\n\t\tthis.input.innerText = this.content.src;\n\t\tthis.input.hidden = true;\n\t\tthis.input2x = this.createInput();\n\t\tthis.input2x.innerText = this.content.src2x;\n\t\tthis.input2x.hidden = true;\n\n\t\tthis.layout.classList.add(\"landing-ui-field-image\");\n\t\tif (data.compactMode === true)\n\t\t{\n\t\t\tthis.layout.classList.add(\"landing-ui-field-image--compact\");\n\t\t}\n\n\t\tthis.disableAltField = typeof data.disableAltField === \"boolean\" ? data.disableAltField : false;\n\n\t\tthis.fileInput = Image.createFileInput(this.selector);\n\t\tthis.fileInput.addEventListener(\"change\", this.onFileInputChange.bind(this));\n\n\t\tthis.linkInput = Image.createLinkInput();\n\t\tthis.linkInput.onInputHandler = this.onLinkInput.bind(this);\n\n\t\tthis.dropzone = Image.createDropzone(this.selector);\n\t\tthis.dropzone.hidden = true;\n\t\tthis.dropzone.insertBefore(this.fileInput, this.dropzone.firstElementChild);\n\n\t\tthis.onDragOver = this.onDragOver.bind(this);\n\t\tthis.onDragLeave = this.onDragLeave.bind(this);\n\t\tthis.onDrop = this.onDrop.bind(this);\n\n\t\tthis.dropzone.addEventListener(\"dragover\", this.onDragOver);\n\t\tthis.dropzone.addEventListener(\"dragleave\", this.onDragLeave);\n\t\tthis.dropzone.addEventListener(\"drop\", this.onDrop);\n\n\t\tthis.clearButton = Image.createClearButton();\n\t\tthis.clearButton.on(\"click\", this.onClearClick.bind(this));\n\n\t\tthis.preview = Image.createImagePreview();\n\t\tthis.preview.appendChild(this.clearButton.layout);\n\t\tthis.preview.style.backgroundImage = \"url(\" + this.input.innerText.trim() + \")\";\n\n\t\tthis.onImageDragEnter = this.onImageDragEnter.bind(this);\n\t\tthis.preview.addEventListener(\"dragenter\", this.onImageDragEnter);\n\n\t\tthis.loader = new BX.Loader({target: this.preview});\n\n\t\tthis.icon = Image.createIcon();\n\n\t\tthis.image = Image.createImageLayout();\n\t\tthis.image.appendChild(this.preview);\n\t\tthis.image.appendChild(this.icon);\n\t\tthis.image.dataset.fileid = this.content.id;\n\t\tthis.image.dataset.fileid2x = this.content.id2x;\n\n\t\tthis.hiddenImage = Dom.create(\"img\", {\n\t\t\tprops: {className: \"landing-ui-field-image-hidden\"},\n\t\t});\n\n\t\tif (Type.isPlainObject(this.content) && \"src\" in this.content)\n\t\t{\n\t\t\tthis.hiddenImage.src = this.content.src;\n\t\t}\n\n\t\tthis.altField = Image.createAltField();\n\t\tthis.altField.setValue(this.content.alt);\n\n\t\tthis.left = Image.createLeftLayout();\n\t\tthis.left.appendChild(this.dropzone);\n\t\tthis.left.appendChild(this.image);\n\t\tthis.left.appendChild(this.hiddenImage);\n\n\t\tif (this.description)\n\t\t{\n\t\t\tthis.left.appendChild(this.description);\n\t\t}\n\n\t\tthis.left.appendChild(this.altField.layout);\n\t\tthis.left.appendChild(this.linkInput.layout);\n\n\t\tthis.uploadButton = Image.createUploadButton();\n\t\tthis.uploadButton.on(\"click\", this.onUploadClick.bind(this));\n\n\t\tthis.editButton = Image.createEditButton();\n\t\tthis.editButton.on(\"click\", this.onEditClick.bind(this));\n\n\t\tthis.right = Image.createRightLayout();\n\t\tthis.right.appendChild(this.uploadButton.layout);\n\t\tthis.right.appendChild(this.editButton.layout);\n\n\t\tthis.form = Image.createForm();\n\t\tthis.form.appendChild(this.left);\n\t\tthis.form.appendChild(this.right);\n\n\t\tthis.layout.appendChild(this.form);\n\n\t\tthis.enableTextOnly();\n\n\t\tif (!this.input.innerText.trim() || this.input.innerText.trim() === window.location.toString())\n\t\t{\n\t\t\tthis.showDropzone();\n\t\t}\n\n\t\tif (this.disableAltField)\n\t\t{\n\t\t\tthis.altField.layout.hidden = true;\n\t\t\tthis.altField.layout.style.display = \"none\";\n\t\t\tthis.altField.layout.classList.add(\"landing-ui-hide\");\n\t\t}\n\n\t\tif (this.content.type === \"icon\")\n\t\t{\n\t\t\tthis.type = \"icon\";\n\t\t\tthis.classList = this.content.classList;\n\t\t\tthis.showPreview();\n\t\t\tthis.altField.layout.hidden = true;\n\t\t\tDom.addClass(this.layout, 'landing-ui-field-image-icon');\n\t\t}\n\n\t\tthis.makeAsLinkWrapper = Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-make-as-link-wrapper\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: \"landing-ui-field-image-make-as-link-button\"},\n\t\t\t\t\tchildren: [],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.url = new BX.Landing.UI.Field.Link({\n\t\t\tcontent: this.content.url || {\n\t\t\t\ttext: '',\n\t\t\t\thref: '',\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tsiteId: Main.getInstance().options.site_id,\n\t\t\t\tlandingId: Main.getInstance().id,\n\t\t\t},\n\t\t\tcontentRoot: this.contentRoot,\n\t\t});\n\n\t\tthis.urlCheckbox = Dom.create(\"input\", {\n\t\t\tprops: {type: \"checkbox\"},\n\t\t\tattrs: {style: \"margin-left: 4px;\"},\n\t\t});\n\n\t\tfunction onCheckboxChange(checkbox, layout)\n\t\t{\n\t\t\tif (checkbox.checked)\n\t\t\t{\n\t\t\t\tlayout.querySelector(\".landing-ui-field-link-right\").classList.remove(\"landing-ui-disabled\");\n\t\t\t\tlayout.querySelector(\".landing-ui-field-link-url-grid\").classList.remove(\"landing-ui-disabled\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlayout.querySelector(\".landing-ui-field-link-right\").classList.add(\"landing-ui-disabled\");\n\t\t\t\tlayout.querySelector(\".landing-ui-field-link-url-grid\").classList.add(\"landing-ui-disabled\");\n\t\t\t}\n\t\t}\n\n\t\tthis.urlCheckbox.addEventListener('change', function ()\n\t\t{\n\t\t\tonCheckboxChange(this.urlCheckbox, this.url.layout);\n\t\t}.bind(this));\n\n\t\tthis.urlCheckbox.checked = this.content.url && this.content.url.enabled;\n\n\t\tonCheckboxChange(this.urlCheckbox, this.url.layout);\n\n\t\tthis.url.hrefInput.header.appendChild(this.urlCheckbox);\n\t\tthis.url.left.hidden = true;\n\n\t\tthis.makeAsLinkWrapper.appendChild(this.url.layout);\n\n\t\tif (!data.disableLink)\n\t\t{\n\t\t\tthis.layout.appendChild(this.makeAsLinkWrapper);\n\t\t}\n\n\t\tthis.content = this.getValue();\n\t\tBX.DOM.write(function ()\n\t\t{\n\t\t\tthis.adjustPreviewBackgroundSize();\n\t\t}.bind(this));\n\n\t\tif (this.getValue().type === \"background\" || this.allowClear)\n\t\t{\n\t\t\tthis.clearButton.layout.classList.add(\"landing-ui-show\");\n\t\t}\n\n\t\tthis.uploader = new ImageUploader({\n\t\t\tuploadParams: this.uploadParams,\n\t\t\tadditionalParams: {context: 'imageeditor'},\n\t\t\tdimensions: this.dimensions,\n\t\t\tsizes: ['1x', '2x'],\n\t\t});\n\n\t\tthis.adjustEditButtonState();\n\t}\n\n\t/**\n\t * Creates file input\n\t * @return {Element}\n\t */\n\tstatic createFileInput(id)\n\t{\n\t\treturn Dom.create(\"input\", {\n\t\t\tprops: {className: \"landing-ui-field-image-dropzone-input\"},\n\t\t\tattrs: {accept: \"image/*\", type: \"file\", id: \"file_\" + id, name: \"picture\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates link input field\n\t * @return {TextField}\n\t */\n\tstatic createLinkInput(): TextField\n\t{\n\t\tvar field = new TextField({\n\t\t\tid: \"path_to_image\",\n\t\t\tplaceholder: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_LINK_LABEL\"),\n\t\t});\n\t\tfield.enableTextOnly();\n\t\tfield.layout.hidden = true;\n\t\treturn field;\n\t}\n\n\t/**\n\t * Creates dropzone\n\t * @param {string} id\n\t * @return {Element}\n\t */\n\tstatic createDropzone(id)\n\t{\n\t\treturn Dom.create(\"label\", {\n\t\t\tprops: {className: \"landing-ui-field-image-dropzone\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"landing-ui-field-image-dropzone-text\"},\n\t\t\t\t\thtml: (\n\t\t\t\t\t\t\"<div class=\\\"landing-ui-field-image-dropzone-title\\\">\" + Loc.getMessage(\n\t\t\t\t\t\t\t\"LANDING_IMAGE_DROPZONE_TITLE\") + \"</div>\" +\n\t\t\t\t\t\t\"<div class=\\\"landing-ui-field-image-dropzone-subtitle\\\">\" + Loc.getMessage(\n\t\t\t\t\t\t\t\"LANDING_IMAGE_DROPZONE_SUBTITLE\") + \"</div>\"\n\t\t\t\t\t),\n\t\t\t\t}),\n\t\t\t],\n\t\t\tattrs: {\"for\": \"file_\" + id},\n\t\t});\n\t}\n\n\t/**\n\t * Creates clear button\n\t * @return {BaseButton}\n\t */\n\tstatic createClearButton()\n\t{\n\t\treturn new BaseButton(\"clear\", {\n\t\t\tclassName: \"landing-ui-field-image-action-button-clear\",\n\t\t});\n\t}\n\n\t/**\n\t * Creates image preview\n\t * @return {Element}\n\t */\n\tstatic createImagePreview()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-preview-inner\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates icon layout\n\t * @return {Element}\n\t */\n\tstatic createIcon()\n\t{\n\t\treturn Dom.create(\"span\", {\n\t\t\tprops: {className: \"landing-ui-field-image-preview-icon\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates image layout\n\t * @return {Element}\n\t */\n\tstatic createImageLayout()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-preview\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates alt field\n\t * @return {TextField}\n\t */\n\tstatic createAltField()\n\t{\n\t\tvar field = new TextField({\n\t\t\tplaceholder: Loc.getMessage(\"LANDING_FIELD_IMAGE_ALT_PLACEHOLDER\"),\n\t\t\tclassName: \"landing-ui-field-image-alt\",\n\t\t\ttextOnly: true,\n\t\t});\n\t\treturn field;\n\t}\n\n\t/**\n\t * Creates left layout\n\t * @return {Element}\n\t */\n\tstatic createLeftLayout()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-left\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates upload button\n\t * @return {BaseButton}\n\t */\n\tstatic createUploadButton()\n\t{\n\t\treturn new BaseButton(\"upload\", {\n\t\t\ttext: Loc.getMessage(\"LANDING_FIELD_IMAGE_UPLOAD_BUTTON\"),\n\t\t\tclassName: \"landing-ui-field-image-action-button\",\n\t\t});\n\t}\n\n\t/**\n\t * Creates edit button\n\t * @return {BaseButton}\n\t */\n\tstatic createEditButton()\n\t{\n\t\tvar field = new BaseButton(\"edit\", {\n\t\t\ttext: Loc.getMessage(\"LANDING_FIELD_IMAGE_EDIT_BUTTON\"),\n\t\t\tclassName: \"landing-ui-field-image-action-button\",\n\t\t});\n\n\t\treturn field;\n\t}\n\n\t/**\n\t * Creates right layout\n\t * @return {Element}\n\t */\n\tstatic createRightLayout()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-right\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates form\n\t * @return {Element}\n\t */\n\tstatic createForm()\n\t{\n\t\treturn Dom.create(\"form\", {\n\t\t\tprops: {className: \"landing-ui-field-image-container\"},\n\t\t\tattrs: {method: \"post\", enctype: \"multipart/form-data\"},\n\t\t\tevents: {\n\t\t\t\tsubmit: function (event)\n\t\t\t\t{\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tonInputInput()\n\t{\n\t\tthis.preview.src = this.input.innerText.trim();\n\t}\n\n\tonImageDragEnter(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif (!this.imageHidden)\n\t\t{\n\t\t\tthis.showDropzone();\n\t\t\tthis.imageHidden = true;\n\t\t}\n\t}\n\n\tonDragOver(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.dropzone.classList.add(\"landing-ui-active\");\n\t}\n\n\tonDragLeave(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.dropzone.classList.remove(\"landing-ui-active\");\n\n\t\tif (this.imageHidden)\n\t\t{\n\t\t\tthis.imageHidden = false;\n\t\t\tthis.showPreview();\n\t\t}\n\t}\n\n\tonDrop(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.dropzone.classList.remove(\"landing-ui-active\");\n\t\tthis.onFileChange(event.dataTransfer.files[0]);\n\t\tthis.imageHidden = false;\n\t}\n\n\tonFileChange(file)\n\t{\n\t\tthis.showLoader();\n\n\t\tthis.upload(file)\n\t\t\t.then(this.setValue.bind(this))\n\t\t\t.then(this.hideLoader.bind(this))\n\t\t\t.catch(function (err)\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.hideLoader();\n\t\t\t}.bind(this));\n\t}\n\n\tonFileInputChange(event)\n\t{\n\t\tthis.onFileChange(event.currentTarget.files[0]);\n\t}\n\n\tonUploadClick(event)\n\t{\n\t\tthis.bindElement = event.currentTarget;\n\n\t\tevent.preventDefault();\n\n\t\tif (!this.uploadMenu)\n\t\t{\n\t\t\tthis.uploadMenu = BX.Main.MenuManager.create({\n\t\t\t\tid: \"upload_\" + this.selector + (+new Date()),\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t},\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_UNSPLASH\"),\n\t\t\t\t\t\tonclick: this.onUnsplashShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_GOOGLE\"),\n\t\t\t\t\t\tonclick: this.onGoogleShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t// {\n\t\t\t\t\t// \ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_PARTNER\"),\n\t\t\t\t\t// \tclassName: \"landing-ui-disabled\"\n\t\t\t\t\t// },\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_UPLOAD\"),\n\t\t\t\t\t\tonclick: this.onUploadShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_LINK\"),\n\t\t\t\t\t\tonclick: this.onLinkShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.bindElement.classList.remove(\"landing-ui-active\");\n\n\t\t\t\t\t\tif (this.uploadMenu)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.uploadMenu.destroy();\n\t\t\t\t\t\t\tthis.uploadMenu = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this),\n\t\t\t\t},\n\t\t\t\ttargetContainer: this.contentRoot,\n\t\t\t});\n\t\t\tif (!this.contentRoot)\n\t\t\t{\n\t\t\t\tthis.bindElement.parentNode.appendChild(this.uploadMenu.popupWindow.popupContainer);\n\t\t\t}\n\t\t}\n\n\t\tthis.bindElement.classList.add(\"landing-ui-active\");\n\t\tthis.uploadMenu.toggle();\n\n\t\tif (!this.contentRoot)\n\t\t{\n\t\t\tvar rect = BX.pos(this.bindElement, this.bindElement.parentNode);\n\t\t\tthis.uploadMenu.popupWindow.popupContainer.style.top = rect.bottom + \"px\";\n\t\t\tthis.uploadMenu.popupWindow.popupContainer.style.left = \"auto\";\n\t\t\tthis.uploadMenu.popupWindow.popupContainer.style.right = \"5px\";\n\t\t}\n\t}\n\n\tonUnsplashShow()\n\t{\n\t\tthis.uploadMenu.close();\n\n\t\tBX.Landing.UI.Panel.Image.getInstance()\n\t\t\t.show(\"unsplash\", this.dimensions, this.loader, this.uploadParams)\n\t\t\t.then(this.upload.bind(this))\n\t\t\t.then(this.setValue.bind(this))\n\t\t\t.then(this.hideLoader.bind(this))\n\t\t\t.catch(function (err)\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.hideLoader();\n\t\t\t}.bind(this));\n\t}\n\n\tonGoogleShow()\n\t{\n\t\tthis.uploadMenu.close();\n\n\t\tBX.Landing.UI.Panel.Image.getInstance()\n\t\t\t.show(\"google\", this.dimensions, this.loader, this.uploadParams)\n\t\t\t.then(this.upload.bind(this))\n\t\t\t.then(this.setValue.bind(this))\n\t\t\t.then(this.hideLoader.bind(this))\n\t\t\t.catch(function (err)\n\t\t\t{\n\t\t\t\tBX.Landing.ErrorManager.getInstance().add({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\taction: 'BAD_IMAGE',\n\t\t\t\t\thideSupportLink: true,\n\t\t\t\t});\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.hideLoader();\n\t\t\t}.bind(this));\n\t}\n\n\tonUploadShow()\n\t{\n\t\tthis.uploadMenu.close();\n\t\tthis.fileInput.click();\n\t}\n\n\tonLinkShow()\n\t{\n\t\tthis.uploadMenu.close();\n\t\tthis.showLinkField();\n\t\tthis.linkInput.setValue(\"\");\n\t}\n\n\tonEditClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.edit({src: this.hiddenImage.src});\n\t}\n\n\tonClearClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.setValue({src: \"\"});\n\t\tthis.fileInput.value = \"\";\n\t\tthis.showDropzone();\n\t}\n\n\tshowDropzone()\n\t{\n\t\tthis.dropzone.hidden = false;\n\t\tthis.image.hidden = true;\n\t\tthis.altField.layout.hidden = true;\n\t\tthis.linkInput.layout.hidden = true;\n\t}\n\n\tshowPreview()\n\t{\n\t\tthis.dropzone.hidden = true;\n\t\tthis.image.hidden = false;\n\t\tthis.altField.layout.hidden = false;\n\t\tthis.linkInput.layout.hidden = true;\n\t}\n\n\tshowLinkField()\n\t{\n\t\tthis.dropzone.hidden = true;\n\t\tthis.image.hidden = true;\n\t\tthis.altField.layout.hidden = true;\n\t\tthis.linkInput.layout.hidden = false;\n\t}\n\n\tonLinkInput(value)\n\t{\n\t\tvar tmpImage = Dom.create(\"img\");\n\t\ttmpImage.src = value;\n\t\ttmpImage.onload = function ()\n\t\t{\n\t\t\tthis.showPreview();\n\t\t\tthis.setValue({src: value, src2x: value});\n\t\t}.bind(this);\n\t}\n\n\tshowLoader()\n\t{\n\t\tif (this.dropzone && !this.dropzone.hidden)\n\t\t{\n\t\t\tthis.loader.show(this.dropzone);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loader.show(this.preview);\n\t}\n\n\thideLoader()\n\t{\n\t\tthis.loader.hide();\n\t}\n\n\t/**\n\t * Handles click event on input field\n\t * @param {MouseEvent} event\n\t */\n\tonInputClick(event)\n\t{\n\t\tevent.preventDefault();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t * @return {boolean}\n\t */\n\tisChanged()\n\t{\n\t\tvar lastValue = BX.Landing.Utils.clone(this.content);\n\t\tvar currentValue = BX.Landing.Utils.clone(this.getValue());\n\n\t\tif (lastValue.url && Type.isString(lastValue.url))\n\t\t{\n\t\t\tlastValue.url = BX.Landing.Utils.decodeDataValue(lastValue.url);\n\t\t}\n\n\t\tif (currentValue.url && Type.isString(currentValue.url))\n\t\t{\n\t\t\tcurrentValue.url = BX.Landing.Utils.decodeDataValue(currentValue.url);\n\t\t}\n\n\t\treturn JSON.stringify(lastValue) !== JSON.stringify(currentValue);\n\t}\n\n\t/**\n\t * Adjusts preview background image size\n\t */\n\tadjustPreviewBackgroundSize()\n\t{\n\t\tvar img = Dom.create(\"img\", {attrs: {src: this.getValue().src}});\n\n\t\timg.onload = function ()\n\t\t{\n\t\t\tvar preview = this.preview.getBoundingClientRect();\n\t\t\tvar position = \"cover\";\n\n\t\t\tif (img.width > preview.width || img.height > preview.height)\n\t\t\t{\n\t\t\t\tposition = \"contain\";\n\t\t\t}\n\n\t\t\tif (img.width < preview.width && img.height < preview.height)\n\t\t\t{\n\t\t\t\tposition = \"auto\";\n\t\t\t}\n\n\t\t\tBX.DOM.write(function ()\n\t\t\t{\n\t\t\t\tthis.preview.style.backgroundSize = position;\n\t\t\t}.bind(this));\n\t\t}.bind(this);\n\t}\n\n\t/**\n\t * @param {object} value\n\t * @param {boolean} [preventEvent = false]\n\t */\n\tsetValue(value, preventEvent)\n\t{\n\t\tif (value.type !== \"icon\")\n\t\t{\n\t\t\tif (!value || !value.src)\n\t\t\t{\n\t\t\t\tthis.input.innerText = \"\";\n\t\t\t\tthis.input2x.innerText = \"\";\n\t\t\t\tthis.preview.removeAttribute(\"style\");\n\t\t\t\tthis.input.dataset.ext = \"\";\n\t\t\t\tthis.showDropzone();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.input.innerText = value.src;\n\t\t\t\tthis.input2x.innerText = value.src2x || '';\n\t\t\t\tthis.preview.style.backgroundImage = \"url(\\\"\" + (value.src2x || value.src) + \"\\\")\";\n\t\t\t\tthis.preview.id = BX.util.getRandomString();\n\t\t\t\tthis.hiddenImage.src = value.src2x || value.src;\n\t\t\t\tthis.showPreview();\n\t\t\t}\n\n\t\t\tthis.image.dataset.fileid = value && value.id ? value.id : -1;\n\t\t\tthis.image.dataset.fileid2x = value && value.id2x ? value.id2x : -1;\n\n\t\t\tthis.classList = [];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.preview.style.backgroundImage = null;\n\t\t\tthis.classList = value.classList;\n\t\t\tthis.icon.innerHTML = \"<span class=\\\"\" + value.classList.join(\" \") + \"\\\"></span>\";\n\t\t\tthis.showPreview();\n\t\t\tthis.type = \"icon\";\n\t\t\tthis.altField.layout.hidden = true;\n\t\t\tthis.altField.setValue(\"\");\n\t\t\tthis.input.innerText = \"\";\n\t\t}\n\n\t\tif (value.url)\n\t\t{\n\t\t\tthis.url.setValue(value.url);\n\t\t}\n\n\t\tthis.adjustPreviewBackgroundSize();\n\t\tthis.adjustEditButtonState();\n\t\tthis.hideLoader();\n\n\t\tthis.onValueChangeHandler(this);\n\t\tBX.fireEvent(this.layout, \"input\");\n\n\t\tvar event = new BX.Event.BaseEvent({\n\t\t\tdata: {value: this.getValue()},\n\t\t\tcompatData: [this.getValue()],\n\t\t});\n\t\tif (!preventEvent)\n\t\t{\n\t\t\tthis.emit('change', event);\n\t\t}\n\t}\n\n\tadjustEditButtonState()\n\t{\n\t\tvar value = this.getValue();\n\t\tif (BX.Type.isStringFilled(value.src))\n\t\t{\n\t\t\tthis.editButton.enable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.editButton.disable();\n\t\t}\n\t}\n\n\treset()\n\t{\n\t\tthis.setValue({\n\t\t\ttype: this.getValue().type,\n\t\t\tid: -1,\n\t\t\tsrc: \"\",\n\t\t\talt: \"\",\n\t\t});\n\t}\n\n\t/**\n\t * Gets field value\n\t * @return {{src, [alt]: string, [title]: string, [url]: string, [type]: string}}\n\t */\n\tgetValue()\n\t{\n\t\tvar fileId = parseInt(this.image.dataset.fileid);\n\t\tvar fileId2x = parseInt(this.image.dataset.fileid2x);\n\t\tfileId = fileId === fileId ? fileId : -1;\n\t\tfileId2x = fileId2x === fileId2x ? fileId2x : -1;\n\n\t\tvar value = {type: \"\", src: \"\", id: fileId, id2x: fileId2x, src2x: \"\", alt: \"\", url: \"\"};\n\n\t\tif (this.type === \"background\")\n\t\t{\n\t\t\tvalue.type = \"background\";\n\t\t\tvalue.src = this.input.innerText.trim();\n\t\t\tvalue.src2x = this.input2x.innerText.trim();\n\t\t\tvalue.id = fileId;\n\t\t\tvalue.id2x = fileId2x;\n\t\t}\n\n\t\tif (this.type === \"image\")\n\t\t{\n\t\t\tvalue.type = \"image\";\n\t\t\tvalue.src = this.input.innerText.trim();\n\t\t\tvalue.src2x = this.input2x.innerText.trim();\n\t\t\tvalue.id = fileId;\n\t\t\tvalue.id2x = fileId2x;\n\t\t\tvalue.alt = this.altField.getValue();\n\t\t}\n\n\t\tif (this.type === \"icon\")\n\t\t{\n\t\t\tvalue.type = \"icon\";\n\t\t\tvalue.classList = this.classList;\n\t\t}\n\n\t\tvalue.url = Object.assign({}, this.url.getValue(), {enabled: this.urlCheckbox.checked});\n\n\t\treturn value;\n\t}\n\n\tedit(data)\n\t{\n\t\tImageEditor\n\t\t\t.edit({\n\t\t\t\timage: data.src,\n\t\t\t\tdimensions: this.dimensions,\n\t\t\t})\n\t\t\t.then(function (file)\n\t\t\t{\n\t\t\t\treturn this.upload(file, {context: \"imageEditor\"});\n\t\t\t}.bind(this))\n\t\t\t.then(function (result)\n\t\t\t{\n\t\t\t\tthis.setValue(result);\n\t\t\t}.bind(this));\n\n\t\t// Analytics hack\n\t\tconst tmpImage = document.createElement('img');\n\t\tlet imageSrc = \"/bitrix/images/landing/close.svg\";\n\n\t\timageSrc = BX.util.add_url_param(imageSrc, {\n\t\t\taction: \"openImageEditor\",\n\t\t});\n\n\t\ttmpImage.src = imageSrc + \"?\" + (+new Date());\n\t}\n\n\t/**\n\t * @param {File|Blob} file\n\t * @param {object} [additionalParams]\n\t */\n\tupload(file, additionalParams)\n\t{\n\t\tif (file.type && (file.type.includes('text') || file.type.includes('html')))\n\t\t{\n\t\t\tBX.Landing.ErrorManager.getInstance().add({\n\t\t\t\ttype: \"error\",\n\t\t\t\taction: \"BAD_IMAGE\",\n\t\t\t});\n\n\t\t\treturn Promise.reject({\n\t\t\t\ttype: \"error\",\n\t\t\t\taction: \"BAD_IMAGE\",\n\t\t\t});\n\t\t}\n\n\t\tthis.showLoader();\n\n\t\tconst isPng = (\n\t\t\tType.isStringFilled(file.type)\n\t\t\t&& file.type.includes('png')\n\t\t);\n\n\t\tconst checkSize = new Promise(function (resolve)\n\t\t{\n\t\t\tlet sizes = isPng ? ['2x'] : ['1x', '2x'];\n\n\t\t\tif (this.create2xByDefault === false)\n\t\t\t{\n\t\t\t\tconst image = document.createElement('img');\n\t\t\t\tconst objectUrl = URL.createObjectURL(file);\n\t\t\t\tconst dimensions = this.dimensions;\n\t\t\t\timage.onload = function ()\n\t\t\t\t{\n\t\t\t\t\tURL.revokeObjectURL(objectUrl);\n\t\t\t\t\tif (\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tthis.width >= dimensions.width\n\t\t\t\t\t\t\t|| this.height >= dimensions.height\n\t\t\t\t\t\t\t|| this.width >= dimensions.maxWidth\n\t\t\t\t\t\t\t|| this.height >= dimensions.maxHeight\n\t\t\t\t\t\t) === false\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tsizes = isPng ? ['2x'] : ['1x'];\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(sizes);\n\t\t\t\t};\n\t\t\t\timage.src = objectUrl;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve(sizes);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn checkSize\n\t\t\t.then(function (allowedSizes)\n\t\t\t{\n\t\t\t\tvar sizes = (function ()\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.create2xByDefault === false\n\t\t\t\t\t\t&& BX.Type.isArrayFilled(allowedSizes)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn allowedSizes;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn isPng ? ['2x'] : ['1x', '2x'];\n\t\t\t\t}.bind(this))();\n\n\t\t\t\treturn this.uploader\n\t\t\t\t\t.setSizes(sizes)\n\t\t\t\t\t.upload(file, additionalParams)\n\t\t\t\t\t.then(function (result)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.hideLoader();\n\n\t\t\t\t\t\tif (sizes.length === 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn result[0];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Object.assign({}, result[0], {\n\t\t\t\t\t\t\tsrc2x: result[1].src,\n\t\t\t\t\t\t\tid2x: result[1].id,\n\t\t\t\t\t\t});\n\t\t\t\t\t}.bind(this));\n\t\t\t}.bind(this));\n\t}\n}"],"names":["Image","data","dimensions","create2xByDefault","uploadParams","onValueChangeHandler","onValueChange","type","content","allowClear","input","innerText","src","hidden","input2x","createInput","src2x","layout","classList","add","compactMode","disableAltField","fileInput","createFileInput","selector","addEventListener","onFileInputChange","bind","linkInput","createLinkInput","onInputHandler","onLinkInput","dropzone","createDropzone","insertBefore","firstElementChild","onDragOver","onDragLeave","onDrop","clearButton","createClearButton","on","onClearClick","preview","createImagePreview","appendChild","style","backgroundImage","trim","onImageDragEnter","loader","BX","Loader","target","icon","createIcon","image","createImageLayout","dataset","fileid","id","fileid2x","id2x","hiddenImage","Dom","create","props","className","Type","isPlainObject","altField","createAltField","setValue","alt","left","createLeftLayout","description","uploadButton","createUploadButton","onUploadClick","editButton","createEditButton","onEditClick","right","createRightLayout","form","createForm","enableTextOnly","window","location","toString","showDropzone","display","showPreview","addClass","makeAsLinkWrapper","children","url","Landing","UI","Field","Link","text","href","options","siteId","Main","getInstance","site_id","landingId","contentRoot","urlCheckbox","attrs","onCheckboxChange","checkbox","checked","querySelector","remove","enabled","hrefInput","header","disableLink","getValue","DOM","write","adjustPreviewBackgroundSize","uploader","ImageUploader","additionalParams","context","sizes","adjustEditButtonState","event","preventDefault","stopPropagation","imageHidden","onFileChange","dataTransfer","files","file","showLoader","upload","then","hideLoader","err","console","error","currentTarget","bindElement","uploadMenu","MenuManager","Date","bindOptions","forceBindPosition","items","Loc","getMessage","onclick","onUnsplashShow","onGoogleShow","onUploadShow","onLinkShow","events","onPopupClose","destroy","targetContainer","parentNode","popupWindow","popupContainer","toggle","rect","pos","top","bottom","close","Panel","show","ErrorManager","action","hideSupportLink","click","showLinkField","edit","value","tmpImage","onload","hide","lastValue","Utils","clone","currentValue","isString","decodeDataValue","JSON","stringify","img","getBoundingClientRect","position","width","height","backgroundSize","preventEvent","removeAttribute","ext","util","getRandomString","innerHTML","join","fireEvent","Event","BaseEvent","compatData","emit","isStringFilled","enable","disable","fileId","parseInt","fileId2x","Object","assign","ImageEditor","result","document","createElement","imageSrc","add_url_param","includes","Promise","reject","isPng","checkSize","resolve","objectUrl","URL","createObjectURL","revokeObjectURL","maxWidth","maxHeight","allowedSizes","isArrayFilled","setSizes","length","accept","name","field","TextField","placeholder","html","BaseButton","textOnly","method","enctype","submit"],"mappings":"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"}