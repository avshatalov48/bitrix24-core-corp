{"version":3,"file":"fieldslistfield.bundle.js","sources":["../src/fieldslistfield.js"],"sourcesContent":["import {BaseField} from 'landing.ui.field.basefield';\nimport {Loc} from 'landing.loc';\nimport {Dom, Runtime, Tag, Type} from 'main.core';\nimport {Draggable} from 'ui.draganddrop.draggable';\nimport {FieldsPanel} from 'landing.ui.panel.fieldspanel';\nimport {ListItem} from 'landing.ui.component.listitem';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {TextField} from 'landing.ui.field.textfield';\nimport {BaseEvent} from 'main.core.events';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {FormClient} from 'crm.form.client';\nimport {ListSettingsField} from 'landing.ui.field.listsettingsfield';\nimport {SeparatorPanel} from 'landing.ui.panel.separatorpanel';\nimport {ResourcebookingUserfield} from 'calendar.resourcebookinguserfield';\nimport {PageObject} from 'landing.pageobject';\nimport type {ListItemOptions} from 'landing.ui.component.listitem';\nimport 'socnetlogdest';\n\nimport './css/style.css';\n\nexport class FieldsListField extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.FieldsListField');\n\t\tthis.setLayoutClass('landing-ui-field-fields-list');\n\n\t\tthis.onSelectFieldButtonClick = this.onSelectFieldButtonClick.bind(this);\n\t\tthis.onSelectProductButtonClick = this.onSelectProductButtonClick.bind(this);\n\t\tthis.onSelectSeparatorButtonClick = this.onSelectSeparatorButtonClick.bind(this);\n\t\tthis.onItemRemove = this.onItemRemove.bind(this);\n\t\tthis.onItemEdit = this.onItemEdit.bind(this);\n\t\tthis.onDragEnd = this.onDragEnd.bind(this);\n\t\tthis.onFormChange = this.onFormChange.bind(this);\n\n\t\tthis.items = [];\n\n\t\tthis.options.items.forEach((itemOptions) => {\n\t\t\tthis.addItem(itemOptions);\n\t\t});\n\n\t\tthis.actionPanel = new ActionPanel({\n\t\t\trenderTo: this.layout,\n\t\t\tleft: [\n\t\t\t\t{\n\t\t\t\t\tid: 'selectField',\n\t\t\t\t\ttext: Loc.getMessage('LANDING_FIELDS_SELECT_FIELD_BUTTON_TITLE'),\n\t\t\t\t\tonClick: this.onSelectFieldButtonClick,\n\t\t\t\t},\n\t\t\t],\n\t\t\tright: [\n\t\t\t\t{\n\t\t\t\t\tid: 'selectSeparator',\n\t\t\t\t\ttext: Loc.getMessage('LANDING_FIELDS_SELECT_SEPARATOR_BUTTON_TITLE'),\n\t\t\t\t\tonClick: this.onSelectSeparatorButtonClick,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tthis.draggable = new Draggable({\n\t\t\tcontext: window.parent,\n\t\t\tcontainer: this.getListContainer(),\n\t\t\tdraggable: '.landing-ui-component-list-item',\n\t\t\tdragElement: '.landing-ui-button-icon-drag',\n\t\t\ttype: Draggable.MOVE,\n\t\t\toffset: {\n\t\t\t\ty: -62,\n\t\t\t},\n\t\t});\n\n\t\tthis.draggable.subscribe('end', this.onDragEnd);\n\t}\n\n\tcreateInput(): HTMLDivElement\n\t{\n\t\treturn this.getListContainer();\n\t}\n\n\tgetCrmFieldById(id: string)\n\t{\n\t\treturn Object.values(this.options.crmFields)\n\t\t\t.reduce((acc, category) => {\n\t\t\t\treturn [...acc, ...category.FIELDS];\n\t\t\t}, [])\n\t\t\t.find((currentField) => {\n\t\t\t\treturn currentField.name === id;\n\t\t\t});\n\t}\n\n\tgetCrmFieldCategoryById(id: string)\n\t{\n\t\treturn this.options.crmFields[id];\n\t}\n\n\taddItem(itemOptions)\n\t{\n\t\treturn this.createItem(itemOptions)\n\t\t\t.then((item) => {\n\t\t\t\tthis.items.push(item);\n\t\t\t\tDom.append(item.getLayout(), this.getListContainer());\n\t\t\t});\n\t}\n\n\tprependItem(itemOptions)\n\t{\n\t\treturn this.createItem(itemOptions)\n\t\t\t.then((item) => {\n\t\t\t\tthis.items.unshift(item);\n\t\t\t\tDom.prepend(item.getLayout(), this.getListContainer());\n\t\t\t});\n\t}\n\n\tinsertItemAfterIndex(itemOptions, index)\n\t{\n\t\treturn this.createItem(itemOptions)\n\t\t\t.then((item) => {\n\t\t\t\tthis.items.splice((index + 1), 0, item);\n\t\t\t\tDom.insertAfter(item.getLayout(), this.getListContainer().childNodes[index]);\n\t\t\t});\n\t}\n\n\tstatic isSeparator(fieldId: ?string): boolean\n\t{\n\t\tif (Type.isStringFilled(fieldId))\n\t\t{\n\t\t\treturn (\n\t\t\t\tfieldId.startsWith('hr')\n\t\t\t\t|| fieldId.startsWith('section')\n\t\t\t\t|| fieldId.startsWith('page')\n\t\t\t);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tstatic getSeparatorTitle(fieldId: ?string): string\n\t{\n\t\tif (Type.isStringFilled(fieldId))\n\t\t{\n\t\t\tif (fieldId.startsWith('hr'))\n\t\t\t{\n\t\t\t\treturn Loc.getMessage('LANDING_SEPARATOR_SOLID_LINE');\n\t\t\t}\n\n\t\t\tif (fieldId.startsWith('section'))\n\t\t\t{\n\t\t\t\treturn Loc.getMessage('LANDING_SEPARATOR_HEADER');\n\t\t\t}\n\n\t\t\tif (fieldId.startsWith('page'))\n\t\t\t{\n\t\t\t\treturn Loc.getMessage('LANDING_SEPARATOR_PAGE');\n\t\t\t}\n\t\t}\n\n\t\treturn Loc.getMessage('LANDING_FIELDS_LIST_FIELD_SEPARATOR_TITLE');\n\t}\n\n\tisFieldAvailable(fieldId: ?string): boolean\n\t{\n\t\tif (Type.isStringFilled(fieldId))\n\t\t{\n\t\t\tif (fieldId.startsWith('product_'))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn Type.isPlainObject(\n\t\t\t\tthis.getCrmFieldById(fieldId),\n\t\t\t);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetFieldItemTitle(fieldId: ?string): string\n\t{\n\t\tif (this.isFieldAvailable(fieldId))\n\t\t{\n\t\t\tif (fieldId.startsWith('product_'))\n\t\t\t{\n\t\t\t\treturn Loc.getMessage('LANDING_FIELDS_LIST_FIELD_PRODUCTS_TITLE');\n\t\t\t}\n\n\t\t\tconst crmField = this.getCrmFieldById(fieldId);\n\t\t\tconst crmFieldCategory = this.getCrmFieldCategoryById(crmField.entity_name);\n\n\t\t\treturn `${crmField.caption} Â· ${crmFieldCategory.CAPTION}`;\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tcreateResourceBookingFieldController(options: {[key: string]: any})\n\t{\n\t\tif (options.type === 'resourcebooking')\n\t\t{\n\t\t\tconst root = PageObject.getRootWindow();\n\t\t\tconst crmField = this.getCrmFieldById(options.id);\n\t\t\treturn root.BX.Calendar.ResourcebookingUserfield.initCrmFormFieldController({\n\t\t\t\tfield: {\n\t\t\t\t\t...options,\n\t\t\t\t\tdict: crmField,\n\t\t\t\t\tnode: Tag.render`<div><div class=\"crm-webform-resourcebooking-wrap\"></div></div>`,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tcreateItem(\n\t\toptions: {\n\t\t\tid: string,\n\t\t\tlabel: string,\n\t\t\tdescription: string,\n\t\t\tcontent?: any,\n\t\t\ttype?: any,\n\t\t\tseparatorTitle?: any,\n\t\t},\n\t): Promise<ListItem>\n\t{\n\t\tconst listItemOptions: ListItemOptions = {\n\t\t\tid: options.id,\n\t\t\ttype: options.type ? options.type : '',\n\t\t\tcontent: options.content,\n\t\t\tsourceOptions: {...options},\n\t\t\tdraggable: true,\n\t\t\tremovable: true,\n\t\t\tonRemove: this.onItemRemove,\n\t\t\tonEdit: this.onItemEdit,\n\t\t\tonFormChange: this.onFormChange,\n\t\t\tform: this.createFieldSettingsForm(options),\n\t\t};\n\n\t\tif (!FieldsListField.isSeparator(options.id))\n\t\t{\n\t\t\tif (this.isFieldAvailable(options.id))\n\t\t\t{\n\t\t\t\tlistItemOptions.title = this.getFieldItemTitle(options.id);\n\n\t\t\t\tconst crmField = this.getCrmFieldById(options.id);\n\t\t\t\tlistItemOptions.description = options.label || crmField.caption;\n\t\t\t\tlistItemOptions.editable = true;\n\t\t\t\tlistItemOptions.isSeparator = false;\n\t\t\t\tlistItemOptions.fieldController = this.createResourceBookingFieldController(options);\n\n\t\t\t\tconst listItem = new ListItem(listItemOptions);\n\n\t\t\t\tif (listItemOptions.fieldController)\n\t\t\t\t{\n\t\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\t\tif (Type.isFunction(listItemOptions.fieldController.subscribe))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlistItemOptions.fieldController.subscribe('afterInit', (event) => {\n\t\t\t\t\t\t\t\toptions.booking.settings_data = event.getData().settings.data;\n\t\t\t\t\t\t\t\tresolve(listItem);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(listItem);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Promise.resolve(listItem);\n\t\t\t}\n\n\t\t\tlistItemOptions.editable = false;\n\t\t\tlistItemOptions.isSeparator = false;\n\t\t\tlistItemOptions.title = '';\n\t\t\tlistItemOptions.description = Loc.getMessage('LANDING_FIELDS_ITEM_FIELD_UNAVAILABLE');\n\t\t\tlistItemOptions.error = true;\n\n\t\t\tconst listItem = new ListItem(listItemOptions);\n\n\t\t\treturn Promise.resolve(listItem);\n\t\t}\n\n\t\tlistItemOptions.isSeparator = true;\n\t\tlistItemOptions.editable = !String(options.id).startsWith('hr_');\n\t\tlistItemOptions.title = FieldsListField.getSeparatorTitle(options.id);\n\n\t\tif (Type.isString(options.label))\n\t\t{\n\t\t\tlistItemOptions.description = options.label;\n\t\t}\n\t\telse if (String(options.id).startsWith('hr_'))\n\t\t{\n\t\t\tlistItemOptions.description = FieldsListField.getSeparatorTitle(options.id);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst crmField = this.getCrmFieldById(options.id);\n\t\t\tif (Type.isPlainObject(crmField) && Type.isString(crmField.caption))\n\t\t\t{\n\t\t\t\tlistItemOptions.description = crmField.caption;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlistItemOptions.description = '';\n\t\t\t}\n\t\t}\n\n\t\tconst listItem = new ListItem(listItemOptions);\n\n\t\treturn Promise.resolve(listItem);\n\t}\n\n\tcreateFieldSettingsForm(field)\n\t{\n\t\tconst fields = [];\n\n\t\tif (field.editing.hasLabel)\n\t\t{\n\t\t\tfields.push(\n\t\t\t\tnew TextField({\n\t\t\t\t\tselector: 'label',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FIELDS_ITEM_FORM_LABEL_FIELD_TITLE'),\n\t\t\t\t\tcontent: field.label,\n\t\t\t\t\ttextOnly: true,\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tif (field.editing.canBeRequired)\n\t\t{\n\t\t\tfields.push(\n\t\t\t\tnew BX.Landing.UI.Field.Checkbox({\n\t\t\t\t\tselector: 'required',\n\t\t\t\t\tcompact: true,\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: Loc.getMessage('LANDING_FIELDS_ITEM_FORM_REQUIRED_FIELD_TITLE'),\n\t\t\t\t\t\t\tvalue: 'required',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tvalue: field.required ? ['required'] : [],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tif (field.editing.canBeMultiple)\n\t\t{\n\t\t\tfields.push(\n\t\t\t\tnew BX.Landing.UI.Field.Checkbox({\n\t\t\t\t\tselector: 'multiple',\n\t\t\t\t\tcompact: true,\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: Loc.getMessage('LANDING_FIELDS_ITEM_FORM_MULTIPLE_FIELD_TITLE'),\n\t\t\t\t\t\t\tvalue: 'multiple',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tvalue: field.multiple ? ['multiple'] : [],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tif (field.editing.hasStringDefaultValue)\n\t\t{\n\t\t\tfields.push(\n\t\t\t\tnew TextField({\n\t\t\t\t\tselector: 'value',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FIELDS_ITEM_FORM_DEFAULT_VALUE_FIELD_TITLE'),\n\t\t\t\t\tcontent: field.value,\n\t\t\t\t\ttextOnly: true,\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tif (field.type === 'list' && field.editing.items.length > 0)\n\t\t{\n\t\t\tconst defaultValueField = new BX.Landing.UI.Field.Dropdown({\n\t\t\t\tselector: 'value',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FIELDS_ITEM_FORM_LIST_DEFAULT_VALUE_TITLE'),\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: Loc.getMessage('LANDING_FORM_DEFAULT_VALUE_NOT_SELECTED'),\n\t\t\t\t\t\tid: null,\n\t\t\t\t\t},\n\t\t\t\t\t...field.editing.items,\n\t\t\t\t].map((item) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.value,\n\t\t\t\t\t\tvalue: item.id,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t});\n\n\t\t\tfields.push(\n\t\t\t\tnew ListSettingsField({\n\t\t\t\t\tselector: 'items',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FIELDS_ITEM_FORM_LIST_SETTINGS_TITLE'),\n\t\t\t\t\titems: field.editing.items.map((item) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tname: item.value,\n\t\t\t\t\t\t\tvalue: item.id,\n\t\t\t\t\t\t\tchecked: true,\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tfields.push(defaultValueField);\n\t\t}\n\n\t\treturn new FormSettingsForm({\n\t\t\tfields,\n\t\t\tserializeModifier(value) {\n\t\t\t\tconst modifiedValue = {...value};\n\t\t\t\tif (Reflect.has(value, 'required'))\n\t\t\t\t{\n\t\t\t\t\tmodifiedValue.required = value.required.includes('required');\n\t\t\t\t}\n\n\t\t\t\tif (Reflect.has(value, 'multiple'))\n\t\t\t\t{\n\t\t\t\t\tmodifiedValue.multiple = value.multiple.includes('multiple');\n\t\t\t\t}\n\n\t\t\t\tif (Reflect.has(value, 'value') && Type.isArrayFilled(value.items))\n\t\t\t\t{\n\t\t\t\t\tmodifiedValue.items = modifiedValue.items.map((item) => {\n\t\t\t\t\t\titem.selected = (value.value === item.value);\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn modifiedValue;\n\t\t\t},\n\t\t});\n\t}\n\n\tgetListContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('listContainer', () => {\n\t\t\treturn Tag.render`<div class=\"landing-ui-field-fields-list-container\"></div>`;\n\t\t});\n\t}\n\n\tonSelectFieldButtonClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tFieldsPanel\n\t\t\t.getInstance({\n\t\t\t\tisLeadEnabled: this.options.isLeadEnabled,\n\t\t\t})\n\t\t\t.show({\n\t\t\t\tdisabledFields: this.items.map((item) => item.options.id),\n\t\t\t})\n\t\t\t.then((selectedFields) => {\n\t\t\t\tthis.onFieldsSelect(selectedFields);\n\t\t\t});\n\t}\n\n\tonFieldsSelect(selectedFields: Array<string>)\n\t{\n\t\tconst preparingOptions = {\n\t\t\tfields: selectedFields.map((fieldId) => {\n\t\t\t\treturn {name: fieldId};\n\t\t\t}),\n\t\t};\n\n\t\tFormClient.getInstance()\n\t\t\t.prepareOptions(this.options.formOptions, preparingOptions)\n\t\t\t.then((result) => {\n\t\t\t\tconst promises = result.data.fields.map((field) => {\n\t\t\t\t\treturn this.addItem(field);\n\t\t\t\t});\n\n\t\t\t\tPromise.all(promises)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.items.map((item) => {\n\t\t\treturn item.getValue();\n\t\t});\n\t}\n\n\tonSelectProductButtonClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t}\n\n\tonSelectSeparatorButtonClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tSeparatorPanel.getInstance()\n\t\t\t.show()\n\t\t\t.then((separator) => {\n\t\t\t\tconst fields = [separator];\n\n\t\t\t\tif (\n\t\t\t\t\tseparator.type === 'page'\n\t\t\t\t\t&& !this.items.find((item) => item.options.type === 'page')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tfields.push({...fields[0]});\n\t\t\t\t}\n\n\t\t\t\tFormClient.getInstance()\n\t\t\t\t\t.prepareOptions(this.options.formOptions, {fields})\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tlet separatorPromise = Promise.resolve();\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tseparator.type === 'page'\n\t\t\t\t\t\t\t&& !this.items.find((item) => item.options.type === 'page')\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresult.data.fields[0].label = Loc.getMessage('LANDING_FIELDS_ITEM_PAGE_TITLE')\n\t\t\t\t\t\t\t\t.replace('#number#', 1);\n\t\t\t\t\t\t\tresult.data.fields[1].label = Loc.getMessage('LANDING_FIELDS_ITEM_PAGE_TITLE')\n\t\t\t\t\t\t\t\t.replace('#number#', 2);\n\n\t\t\t\t\t\t\tseparatorPromise = Promise.all([\n\t\t\t\t\t\t\t\tthis.prependItem(result.data.fields[0]),\n\t\t\t\t\t\t\t\tthis.insertItemAfterIndex(result.data.fields[1], 1),\n\t\t\t\t\t\t\t]);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresult.data.fields.forEach((field) => {\n\t\t\t\t\t\t\t\tconst [type] = field.id.split('_');\n\t\t\t\t\t\t\t\tconst count = this.items.filter((item) => {\n\t\t\t\t\t\t\t\t\treturn item.options.id.startsWith(type);\n\t\t\t\t\t\t\t\t}).length;\n\n\t\t\t\t\t\t\t\tif (type === 'page')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfield.label = Loc.getMessage('LANDING_FIELDS_ITEM_PAGE_TITLE')\n\t\t\t\t\t\t\t\t\t\t.replace('#number#', count + 1);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (type === 'section')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfield.label = Loc.getMessage('LANDING_FIELDS_ITEM_SECTION_TITLE')\n\t\t\t\t\t\t\t\t\t\t.replace('#number#', count + 1);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (type === 'hr')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfield.label = Loc.getMessage('LANDING_FIELDS_ITEM_LINE_TITLE')\n\t\t\t\t\t\t\t\t\t\t.replace('#number#', count + 1);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tseparatorPromise = this.addItem(field);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tseparatorPromise.then(() => {\n\t\t\t\t\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tonItemRemove(event: BaseEvent)\n\t{\n\t\tthis.items = this.items.filter((item) => {\n\t\t\treturn item !== event.getTarget();\n\t\t});\n\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tonItemEdit(event: BaseEvent)\n\t{\n\t\tconst {options} = event.getTarget();\n\t\tif (options.fieldController)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\toptions.fieldController.showSettingsPopup();\n\t\t\tsetTimeout(() => {\n\t\t\t\toptions.fieldController.settingsPopup.subscribeOnce('onClose', () => {\n\t\t\t\t\toptions.sourceOptions.booking.settings_data = options.fieldController.getSettings().data;\n\n\t\t\t\t\tconst {settings_data} = options.sourceOptions.booking;\n\t\t\t\t\tObject.keys(settings_data).forEach((key) => {\n\t\t\t\t\t\tif (Type.isArray(settings_data[key].value))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsettings_data[key].value = settings_data[key].value.join('|');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t}\n\t}\n\n\tonFormChange(event: BaseEvent)\n\t{\n\t\tthis.emit('onChange', {skipPrepare: true});\n\n\t\tconst target = event.getTarget();\n\t\tconst value = target.getValue();\n\n\t\ttarget.setDescription(value.label);\n\t}\n\n\tonDragEnd()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tthis.items = [...this.getListContainer().children].map((itemNode) => {\n\t\t\t\tconst itemNodeId = Dom.attr(itemNode, 'data-id');\n\t\t\t\treturn this.items.find((item) => {\n\t\t\t\t\treturn item.options.id === itemNodeId;\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t});\n\t}\n}"],"names":["FieldsListField","options","setEventNamespace","setLayoutClass","onSelectFieldButtonClick","bind","onSelectProductButtonClick","onSelectSeparatorButtonClick","onItemRemove","onItemEdit","onDragEnd","onFormChange","items","forEach","itemOptions","addItem","actionPanel","ActionPanel","renderTo","layout","left","id","text","Loc","getMessage","onClick","right","draggable","Draggable","context","window","parent","container","getListContainer","dragElement","type","MOVE","offset","y","subscribe","Object","values","crmFields","reduce","acc","category","FIELDS","find","currentField","name","createItem","then","item","push","Dom","append","getLayout","unshift","prepend","index","splice","insertAfter","childNodes","fieldId","Type","isStringFilled","startsWith","isPlainObject","getCrmFieldById","isFieldAvailable","crmField","crmFieldCategory","getCrmFieldCategoryById","entity_name","caption","CAPTION","root","PageObject","getRootWindow","BX","Calendar","ResourcebookingUserfield","initCrmFormFieldController","field","dict","node","Tag","render","listItemOptions","content","sourceOptions","removable","onRemove","onEdit","form","createFieldSettingsForm","isSeparator","title","getFieldItemTitle","description","label","editable","fieldController","createResourceBookingFieldController","listItem","ListItem","Promise","resolve","isFunction","event","booking","settings_data","getData","settings","data","error","String","getSeparatorTitle","isString","fields","editing","hasLabel","TextField","selector","textOnly","canBeRequired","Landing","UI","Field","Checkbox","compact","value","required","canBeMultiple","multiple","hasStringDefaultValue","length","defaultValueField","Dropdown","map","ListSettingsField","checked","FormSettingsForm","serializeModifier","modifiedValue","Reflect","has","includes","isArrayFilled","selected","cache","remember","preventDefault","FieldsPanel","getInstance","isLeadEnabled","show","disabledFields","selectedFields","onFieldsSelect","preparingOptions","FormClient","prepareOptions","formOptions","result","promises","all","emit","skipPrepare","getValue","SeparatorPanel","separator","separatorPromise","replace","prependItem","insertItemAfterIndex","split","count","filter","getTarget","showSettingsPopup","setTimeout","settingsPopup","subscribeOnce","getSettings","keys","key","isArray","join","target","setDescription","children","itemNode","itemNodeId","attr","BaseField"],"mappings":"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"}