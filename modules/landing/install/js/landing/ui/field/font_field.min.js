(function(){"use strict";BX.namespace("BX.Landing.UI.Field");var t=BX.Landing.Utils.isFunction;var e=BX.Landing.Utils.isPlainObject;var i=BX.Landing.Utils.bind;var n=BX.Landing.Utils.proxy;var a=BX.Landing.Utils.escapeHtml;var s=BX.Landing.Utils.addClass;var l=BX.Landing.Utils.clone;BX.Landing.UI.Field.Font=function(l){BX.Landing.UI.Field.BaseField.apply(this,arguments);s(this.layout,"landing-ui-field-font");this.value=l.value;this.headlessMode=l.headlessMode===true;this.frame=l.frame;this.items=[];if(e(l.items)){var o=Object.keys(this.items);this.items=o.map(function(t){return{name:this.items[t],value:t}},this)}this.onChangeHandler=t(l.onChange)?l.onChange:function(){};this.onValueChangeHandler=t(l.onValueChange)?l.onValueChange:function(){};if(this.value){this.content=a(this.value.family);this.input.innerHTML=this.value.family}else{this.content=a(this.content);this.input.innerHTML=this.content}this.link=BX.create("a",{props:{className:"landing-ui-field-font-link",text:BX.Landing.Loc.getMessage("LANDING_EDIT_BLOCK_DEFAULT_FONT")}});if(this.frame){var r=this.frame.document.querySelectorAll(this.selector)[0];if(r){var h=BX.style(r,"font-family");if(h){h=h.replace(/['|"]/g,"");this.content=h.split(",")[0];this.input.innerHTML=this.content}}var r=this.frame.document.querySelectorAll(this.selector)[0];var c=r.classList.value;var u=/g-font-(?:(?!size|weight)\w)[a-z-]*/i;var f=/[a-z\s]*[a-z]/i;var d=c.match(u);var m;if(d){m=d[0]}if(r){var g=BX.style(r,"font-family");g=g.match(f);if(m){r.classList.remove(m)}var p=BX.style(r,"font-family");var v=p.match(f);if(m){r.classList.add(m)}}if(v[0]!==g[0]){this.layout.append(this.link);this.defaultFont=p}}i(this.input,"click",n(this.onInputClick,this));i(this.link,"click",n(this.onLinkClick,this))};function o(t){return"g-font-"+t.toLowerCase().replace(/ /g,"-")}BX.Landing.UI.Field.Font.prototype={constructor:BX.Landing.UI.Field.Font,__proto__:BX.Landing.UI.Field.BaseField.prototype,onInputClick:function(t){t.preventDefault();t.stopPropagation();BX.Landing.UI.Panel.GoogleFonts.getInstance().show().then(function(t){if(!this.response){this.response=l(BX.Landing.UI.Panel.GoogleFonts.getInstance().response);this.response.forEach(function(t){this.items.push({name:t.family,value:o(t.family)})},this)}this.setValue(t)}.bind(this))},onLinkClick:function(t){t.preventDefault();t.stopPropagation();var e=this.frame.document.querySelectorAll(this.selector)[0];var i=e.classList.value;var n=/g-font-(?:(?!size|weight)\w)[a-z-]*/i;var a=i.match(n);if(e){if(a[0]){e.classList.remove(a[0])}var s=this.defaultFont;if(s){s=s.replace(/['|"]/g,"");this.content=s.split(",")[0]}}var l={family:this.content};this.setValue(l)},setValue:function(t){if(e(t)){var i=o(t.family);var n=[300,400,500,600,700,900];var s=":wght@";var l=s+n.join(";");var r=t.family.replace(/ /g,"+");var h=r+l;var c=BX.Landing.UI.Panel.GoogleFonts.getInstance().client.makeUrl({family:h});if(this.headlessMode){this.value={family:t.family,public:"https://fonts.google.com/specimen/"+r,uri:c};this.input.innerHTML=a(t.family);this.emit("onChange")}else{var u=BX.Landing.UI.Tool.FontManager.getInstance();u.addFont({className:i,family:t.family,href:c,category:t.category},window);this.input.innerHTML=a(t.family);this.onChangeHandler(i,this.items,this.postfix,this.property);this.onValueChangeHandler(this);u.removeUnusedFonts();var f="";u.getUsedLoadedFonts().forEach(function(t){if(t.element){t.element.setAttribute("rel","stylesheet");t.element.removeAttribute("media");f+="<noscript>"+t.element.outerHTML+"</noscript>\n";t.element.setAttribute("rel","preload");t.element.setAttribute("onload","this.removeAttribute('onload');this.rel='stylesheet'");t.element.setAttribute("as","style");f+=t.element.outerHTML+"\n"}if(t.CSSDeclaration){f+=t.CSSDeclaration.outerHTML}});f=f.replace("async@load","all").replace(/data-loadcss="true"/g,"");BX.Landing.Backend.getInstance().action("Landing::updateHead",{content:f})}}},getValue:function(){return this.value}}})();
//# sourceMappingURL=font_field.map.js