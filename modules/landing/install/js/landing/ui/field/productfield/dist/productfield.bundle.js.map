{"version":3,"file":"productfield.bundle.js","sources":["../src/productfield.js"],"sourcesContent":["import {BaseField} from 'landing.ui.field.basefield';\nimport {ProductForm} from 'catalog.product-form';\nimport {DiscountType} from \"catalog.product-calculator\";\nimport {PageObject} from 'landing.pageobject';\nimport {Dom, Runtime, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\n\nimport './css/style.css';\n\nexport class ProductField extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.ProductField');\n\t\tthis.setLayoutClass('landing-ui-field-product');\n\n\t\tthis.onBasketChange = this.onBasketChange.bind(this);\n\n\t\tDom.append(this.getProductSelector().wrapper, this.input);\n\n\t\tthis.setProducts(this.options.items);\n\t\tconst root = PageObject.getRootWindow();\n\t\troot.BX.Event.EventEmitter\n\t\t\t.subscribe(this.getProductSelector(), 'ProductForm:onBasketChange', this.onBasketChange);\n\t}\n\n\tsetProducts(products)\n\t{\n\t\tthis.cache.set('products', Runtime.clone(products));\n\t}\n\n\tgetProducts(): Array<any>\n\t{\n\t\treturn this.cache.get('products') || [];\n\t}\n\n\tonBasketChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tthis.setProducts(data.basket);\n\t\tthis.emit('onChange', {skipPrepare: true});\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.getProducts().reduce((acc, item) => {\n\t\t\tif (!Type.isNil(item.fields.productId))\n\t\t\t{\n\t\t\t\tacc.push({\n\t\t\t\t\tlabel: item.fields.name,\n\t\t\t\t\tchangeablePrice: false,\n\t\t\t\t\tdiscount: item.fields.discount,\n\t\t\t\t\tpics: [],\n\t\t\t\t\tprice: item.fields.price,\n\t\t\t\t\tquantity: [],\n\t\t\t\t\tselected: false,\n\t\t\t\t\tvalue: item.fields.productId,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, []);\n\t}\n\n\tgetProductSelector(): ProductForm\n\t{\n\t\treturn this.cache.remember('productSelector', () => {\n\t\t\tconst root = PageObject.getRootWindow();\n\t\t\treturn new root.BX.Catalog.ProductForm({\n\t\t\t\tiblockId: this.options.iblockId,\n\t\t\t\tshowResults: false,\n\t\t\t\tallowedDiscountTypes: [DiscountType.MONETARY],\n\t\t\t\tbuttonsPosition: 'BOTTOM',\n\t\t\t\tnewItemPosition: 'BOTTOM',\n\t\t\t\tbasket: this.options.items,\n\t\t\t});\n\t\t});\n\t}\n}"],"names":["ProductField","options","setEventNamespace","setLayoutClass","onBasketChange","bind","Dom","append","getProductSelector","wrapper","input","setProducts","items","root","PageObject","getRootWindow","BX","Event","EventEmitter","subscribe","products","cache","set","Runtime","clone","get","event","data","getData","basket","emit","skipPrepare","getProducts","reduce","acc","item","Type","isNil","fields","productId","push","label","name","changeablePrice","discount","pics","price","quantity","selected","value","remember","Catalog","ProductForm","iblockId","showResults","allowedDiscountTypes","DiscountType","MONETARY","buttonsPosition","newItemPosition","BaseField"],"mappings":";;;;;;KASaA,YAAb;CAAA;;CAEC,wBAAYC,OAAZ,EACA;CAAA;;CAAA;CACC,8GAAMA,OAAN;;CACA,UAAKC,iBAAL,CAAuB,kCAAvB;;CACA,UAAKC,cAAL,CAAoB,0BAApB;;CAEA,UAAKC,cAAL,GAAsB,MAAKA,cAAL,CAAoBC,IAApB,2CAAtB;CAEAC,IAAAA,aAAG,CAACC,MAAJ,CAAW,MAAKC,kBAAL,GAA0BC,OAArC,EAA8C,MAAKC,KAAnD;;CAEA,UAAKC,WAAL,CAAiB,MAAKV,OAAL,CAAaW,KAA9B;;CACA,QAAMC,IAAI,GAAGC,6BAAU,CAACC,aAAX,EAAb;CACAF,IAAAA,IAAI,CAACG,EAAL,CAAQC,KAAR,CAAcC,YAAd,CACEC,SADF,CACY,MAAKX,kBAAL,EADZ,EACuC,4BADvC,EACqE,MAAKJ,cAD1E;CAXD;CAaC;;CAhBF;CAAA;CAAA,gCAkBagB,QAlBb,EAmBC;CACC,WAAKC,KAAL,CAAWC,GAAX,CAAe,UAAf,EAA2BC,iBAAO,CAACC,KAAR,CAAcJ,QAAd,CAA3B;CACA;CArBF;CAAA;CAAA,kCAwBC;CACC,aAAO,KAAKC,KAAL,CAAWI,GAAX,CAAe,UAAf,KAA8B,EAArC;CACA;CA1BF;CAAA;CAAA,mCA4BgBC,KA5BhB,EA6BC;CACC,UAAMC,IAAI,GAAGD,KAAK,CAACE,OAAN,EAAb;CACA,WAAKjB,WAAL,CAAiBgB,IAAI,CAACE,MAAtB;CACA,WAAKC,IAAL,CAAU,UAAV,EAAsB;CAACC,QAAAA,WAAW,EAAE;CAAd,OAAtB;CACA;CAjCF;CAAA;CAAA,+BAoCC;CACC,aAAO,KAAKC,WAAL,GAAmBC,MAAnB,CAA0B,UAACC,GAAD,EAAMC,IAAN,EAAe;CAC/C,YAAI,CAACC,cAAI,CAACC,KAAL,CAAWF,IAAI,CAACG,MAAL,CAAYC,SAAvB,CAAL,EACA;CACCL,UAAAA,GAAG,CAACM,IAAJ,CAAS;CACRC,YAAAA,KAAK,EAAEN,IAAI,CAACG,MAAL,CAAYI,IADX;CAERC,YAAAA,eAAe,EAAE,KAFT;CAGRC,YAAAA,QAAQ,EAAET,IAAI,CAACG,MAAL,CAAYM,QAHd;CAIRC,YAAAA,IAAI,EAAE,EAJE;CAKRC,YAAAA,KAAK,EAAEX,IAAI,CAACG,MAAL,CAAYQ,KALX;CAMRC,YAAAA,QAAQ,EAAE,EANF;CAORC,YAAAA,QAAQ,EAAE,KAPF;CAQRC,YAAAA,KAAK,EAAEd,IAAI,CAACG,MAAL,CAAYC;CARX,WAAT;CAUA;;CAED,eAAOL,GAAP;CACA,OAhBM,EAgBJ,EAhBI,CAAP;CAiBA;CAtDF;CAAA;CAAA,yCAyDC;CAAA;;CACC,aAAO,KAAKb,KAAL,CAAW6B,QAAX,CAAoB,iBAApB,EAAuC,YAAM;CACnD,YAAMrC,IAAI,GAAGC,6BAAU,CAACC,aAAX,EAAb;CACA,eAAO,IAAIF,IAAI,CAACG,EAAL,CAAQmC,OAAR,CAAgBC,WAApB,CAAgC;CACtCC,UAAAA,QAAQ,EAAE,MAAI,CAACpD,OAAL,CAAaoD,QADe;CAEtCC,UAAAA,WAAW,EAAE,KAFyB;CAGtCC,UAAAA,oBAAoB,EAAE,CAACC,sCAAY,CAACC,QAAd,CAHgB;CAItCC,UAAAA,eAAe,EAAE,QAJqB;CAKtCC,UAAAA,eAAe,EAAE,QALqB;CAMtC9B,UAAAA,MAAM,EAAE,MAAI,CAAC5B,OAAL,CAAaW;CANiB,SAAhC,CAAP;CAQA,OAVM,CAAP;CAWA;CArEF;CAAA;CAAA,EAAkCgD,oCAAlC;;;;;;;;"}