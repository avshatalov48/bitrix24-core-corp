{"version":3,"file":"paysystemsselectorfield.bundle.js","sources":["../src/image/default-pay-system-image.svg","../src/paysystemsselectorfield.js"],"sourcesContent":["export default \"/bitrix/js/landing/ui/field/paysystemsselectorfield/dist/image/default-pay-system-image.svg\"","import { BaseField } from 'landing.ui.field.basefield';\nimport { Loader } from 'main.loader';\nimport { Dom, Event, Tag, Text } from 'main.core';\nimport { Loc } from 'landing.loc';\n\nimport defaultPaySystemImage from './image/default-pay-system-image.svg';\nimport './css/style.css';\nimport { SmallSwitch } from 'landing.ui.field.smallswitch';\n\ntype PaySystemSelectorOptions = {\n\tdisabledPaySystems: Array<number>,\n\tonFetchPaySystemsError: Function,\n\tshowMorePaySystemsBtn: boolean,\n\tmorePaySystemsBtnSidePanelPath: string,\n}\n\ntype ActivePaySystemData = {\n\tid: number,\n\ttitle: string,\n\timage: ?string,\n}\n\ntype RecommendedPaySystemData = {\n\tid: string,\n\ttitle: string,\n\timage: string,\n\teditPath: string,\n}\n\ntype FetchPaySystemListResult = {\n\tactive: Array<ActivePaySystemData>,\n\trecommended: Array<RecommendedPaySystemData>,\n};\n\ntype UpdatePaySystemsResult = {\n\tpaySystems: FetchPaySystemListResult,\n\tisUpdated: boolean\n}\n\nexport class PaySystemsSelectorField extends BaseField\n{\n\t#disabledPaySystems: Array<number>;\n\t#allPaySystems: FetchPaySystemListResult = { active: [], recommended: [] };\n\t#onFetchPaySystemsError: Function;\n\t#showMorePaySystemsBtn: boolean;\n\t#morePaySystemsBtnSidePanelPath: string;\n\t// in milliseconds\n\t#minLoaderShowTime: number = 3000;\n\n\tconstructor(options: PaySystemSelectorOptions = {})\n\t{\n\t\tsuper(options);\n\t\tthis.#disabledPaySystems = Reflect.has(options, 'disabledPaySystems')\n\t\t\t? options.disabledPaySystems\n\t\t\t: [];\n\t\tthis.#onFetchPaySystemsError = Reflect.has(options, 'onFetchPaySystemsError')\n\t\t\t? options.onFetchPaySystemsError\n\t\t\t: () => {\n\t\t\t};\n\t\tthis.#showMorePaySystemsBtn = Reflect.has(options, 'showMorePaySystemsBtn')\n\t\t\t? options.showMorePaySystemsBtn\n\t\t\t: false;\n\t\tthis.#morePaySystemsBtnSidePanelPath = Reflect.has(options, 'morePaySystemsBtnSidePanelPath')\n\t\t\t? options.morePaySystemsBtnSidePanelPath\n\t\t\t: '';\n\n\t\tDom.clean(this.getLayout());\n\t\tthis.#updateAndRenderPaySystems(true);\n\t}\n\n\t#getPaySystemsList(): Promise<Array<FetchPaySystemListResult>>\n\t{\n\t\treturn BX.ajax.runAction('crm.api.form.paysystem.list', { json: {} }).then(\n\t\t\t(response) => {\n\t\t\t\treturn response.data;\n\t\t\t},\n\t\t);\n\t}\n\n\t#updatePaySystems(): Promise<UpdatePaySystemsResult>\n\t{\n\t\treturn this.#getPaySystemsList().then(\n\t\t\t(paySystems) => {\n\t\t\t\tconst oldPaySystemIds = this.#allPaySystems.active.map((ps) => ps.id).sort();\n\t\t\t\tconst newPaySystemIds = paySystems.active.map((ps) => ps.id).sort();\n\n\t\t\t\tthis.#allPaySystems = paySystems;\n\n\t\t\t\tconst result = {\n\t\t\t\t\tpaySystems: paySystems,\n\t\t\t\t\tisUpdated: false,\n\t\t\t\t};\n\n\t\t\t\tif (oldPaySystemIds.length !== newPaySystemIds.length)\n\t\t\t\t{\n\t\t\t\t\tresult.isUpdated = true;\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\n\t\t\t\tfor (let index = 0; index < oldPaySystemIds.length; index++)\n\t\t\t\t{\n\t\t\t\t\tif (oldPaySystemIds[index] !== newPaySystemIds[index])\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.isUpdated = true;\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\t\t).catch(\n\t\t\t(response) => {\n\t\t\t\tthis.#onFetchPaySystemsError(response.errors);\n\t\t\t},\n\t\t);\n\t}\n\n\t#updateAndRenderPaySystems(useLoaderOnFetchStart: boolean = true, minLoaderShowTime: number = 0):\n\t\tPromise<UpdatePaySystemsResult>\n\t{\n\t\tif (useLoaderOnFetchStart)\n\t\t{\n\t\t\tDom.clean(this.getLayout());\n\t\t\tthis.#getLoader().show();\n\t\t}\n\t\tlet loaderEndTime = useLoaderOnFetchStart ? Date.now() + minLoaderShowTime : null;\n\n\t\treturn this.#updatePaySystems().then(\n\t\t\tasync ({ paySystems, isUpdated }: UpdatePaySystemsResult) => {\n\t\t\t\tif (isUpdated)\n\t\t\t\t{\n\t\t\t\t\tDom.clean(this.getLayout());\n\t\t\t\t\tthis.#getLoader().show();\n\t\t\t\t\tloaderEndTime = loaderEndTime !== null ? loaderEndTime : Date.now() + minLoaderShowTime;\n\n\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, loaderEndTime - Date.now()));\n\t\t\t\t\tthis.#getLoader().hide();\n\t\t\t\t\tthis.#renderLayout();\n\t\t\t\t}\n\n\t\t\t\treturn paySystems;\n\t\t\t},\n\t\t);\n\t}\n\n\t#renderLayout(): void\n\t{\n\t\tDom.clean(this.getLayout());\n\t\tthis.#renderActivePaySystems();\n\t\tthis.#renderRecommendedPaySystems();\n\t\tif (this.#showMorePaySystemsBtn && this.#morePaySystemsBtnSidePanelPath)\n\t\t{\n\t\t\tthis.#renderShowMorePaySystemsBtn();\n\t\t}\n\t}\n\n\t#renderRecommendedPaySystems(): void\n\t{\n\t\tthis.#allPaySystems.recommended.forEach(\n\t\t\t(paySystem) => {\n\t\t\t\tDom.append(\n\t\t\t\t\tthis.#getRecommendedPaySystemsLayout(paySystem),\n\t\t\t\t\tthis.getLayout(),\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\t}\n\n\t#renderShowMorePaySystemsBtn(): void\n\t{\n\t\tDom.append(\n\t\t\tthis.#getShowMorePaySystemsBtn(),\n\t\t\tthis.getLayout(),\n\t\t);\n\t}\n\n\t#getShowMorePaySystemsBtn(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('showMorePaySystemsBtn', () => {\n\t\t\tconst btnLayout = Tag.render`\n\t\t\t<button type=\"button\" class=\"landing-ui-content-pay-system-more-ps\">\n\t\t\t\t<span class=\"landing-ui-content-pay-system-more-ps-text\">\n\t\t\t\t\t${Loc.getMessage('LANDING_FORM_PAY_SYSTEMS_CONNECT_OTHER_PAY_SYSTEM')}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t\t`;\n\t\t\tbtnLayout.onclick = () => {\n\t\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\t\tthis.#morePaySystemsBtnSidePanelPath,\n\t\t\t\t\t{\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonCloseComplete: (event) => this.#onMorePaySystemSliderClose(event),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t};\n\n\t\t\treturn btnLayout;\n\t\t});\n\t}\n\n\t#getRecommendedPaySystemsLayout(paySystemData: RecommendedPaySystemData): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('recommendedPaySystem:' + paySystemData.id,\n\t\t\t() => {\n\t\t\t\tconst paySystemLayout = this.#getDefaultPaySystemLayout(paySystemData.title, paySystemData.image);\n\t\t\t\tconst connectBtnLayout = Tag.render`\n\t\t\t\t\t<div class=\"landing-ui-field-pay-system-selector-connect-recommended\">\n\t\t\t\t\t\t${Loc.getMessage('LANDING_FORM_PAY_SYSTEMS_CONNECT_RECOMMENDED_PAY_SYSTEM_TEXT')}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconnectBtnLayout,\n\t\t\t\t\t'click',\n\t\t\t\t\t() =>\n\t\t\t\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\t\t\t\tpaySystemData.editPath,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tonCloseComplete: (event) => {\n\t\t\t\t\t\t\t\t\t\tthis.#onRecommendedSliderClose(event);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\tDom.append(\n\t\t\t\t\tconnectBtnLayout,\n\t\t\t\t\tpaySystemLayout,\n\t\t\t\t);\n\n\t\t\t\treturn paySystemLayout;\n\t\t\t});\n\t}\n\n\t#getActivePaySystemLayout(paySystemData: ActivePaySystemData): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('formPaySystem:' + paySystemData.id, () => {\n\t\t\tconst paySystemLayout = this.#getDefaultPaySystemLayout(\n\t\t\t\tpaySystemData.title,\n\t\t\t\tpaySystemData.image ?? defaultPaySystemImage,\n\t\t\t);\n\t\t\tconst switcher = new SmallSwitch({\n\t\t\t\tvalue: this.#isPaySystemActiveInForm(paySystemData.id),\n\t\t\t});\n\t\t\tDom.addClass(\n\t\t\t\tswitcher.getLayout(), 'landing-ui-field-pay-system-selector-ps-switch',\n\t\t\t);\n\t\t\tDom.append(\n\t\t\t\tswitcher.getLayout(),\n\t\t\t\tpaySystemLayout,\n\t\t\t);\n\t\t\tswitcher.subscribe('onChange', () => this.#onPaySystemSwitchChange(paySystemData));\n\n\t\t\treturn paySystemLayout;\n\t\t});\n\t}\n\n\tgetValue(): FetchPaySystemListResult\n\t{\n\t\treturn {\n\t\t\tallPaySystems: { ...this.#allPaySystems },\n\t\t\tdisabledPaySystems: [...this.#disabledPaySystems],\n\t\t};\n\t}\n\n\t#onRecommendedSliderClose(event): void\n\t{\n\t\tthis.#updateAndRenderPaySystems(false, this.#minLoaderShowTime);\n\t}\n\n\t#renderActivePaySystems(): void\n\t{\n\t\tconst paySystemSortRule = (paySystem1: ActivePaySystemData, paySystem2: ActivePaySystemData) => {\n\t\t\t// sort by active status\n\t\t\tconst paySystem1ActivationStatus = this.#isPaySystemActiveInForm(paySystem1.id);\n\t\t\tconst paySystem2ActivationStatus = this.#isPaySystemActiveInForm(paySystem2.id);\n\n\t\t\tif (paySystem1ActivationStatus !== paySystem2ActivationStatus)\n\t\t\t{\n\t\t\t\treturn paySystem1ActivationStatus ? -1 : 1;\n\t\t\t}\n\n\t\t\t// sort by id\n\t\t\treturn paySystem2.id - paySystem1.id;\n\t\t};\n\t\tthis.#allPaySystems.active.sort(paySystemSortRule).forEach(\n\t\t\t(paySystem) => {\n\t\t\t\tDom.append(\n\t\t\t\t\tthis.#getActivePaySystemLayout(paySystem),\n\t\t\t\t\tthis.getLayout(),\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\t}\n\n\t#isPaySystemActiveInForm(paySystemId: number): boolean\n\t{\n\t\treturn !this.#disabledPaySystems.includes(paySystemId);\n\t}\n\n\t#onPaySystemSwitchChange(paySystemData: ActivePaySystemData): void\n\t{\n\t\tif (this.#isPaySystemActiveInForm(paySystemData.id))\n\t\t{\n\t\t\tthis.#disabledPaySystems.push(paySystemData.id);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#disabledPaySystems.splice(\n\t\t\t\tthis.#disabledPaySystems.indexOf(paySystemData.id),\n\t\t\t\t1,\n\t\t\t);\n\t\t}\n\n\t\tthis.emit('onChange');\n\t}\n\n\t#getDefaultPaySystemLayout(title: string, image: string): HTMLDivElement\n\t{\n\t\tconst paySystemLayout = Tag.render`\n\t\t\t<div class=\"landing-ui-field-pay-system-selector-ps-wrapper\">\n\t\t\t\t<div class=\"landing-ui-field-pay-system-selector-ps-img\"></div>\n\t\t\t</div>\n\t\t`;\n\t\tDom.append(\n\t\t\tTag.render`<img src=\"${image}\">`,\n\t\t\tpaySystemLayout.children[0],\n\t\t);\n\t\tDom.append(\n\t\t\tTag.render`<div class=\"landing-ui-field-pay-system-ps-title\">${Text.encode(title)}</div>`,\n\t\t\tpaySystemLayout,\n\t\t);\n\t\treturn paySystemLayout;\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\treturn this.cache.remember(\n\t\t\t'loader',\n\t\t\t() => new Loader({\n\t\t\t\ttarget: this.layout,\n\t\t\t\tsize: 50,\n\t\t\t\tmode: 'inline',\n\t\t\t\toffset: {\n\t\t\t\t\ttop: '5px',\n\t\t\t\t\tleft: '250px',\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\t#onMorePaySystemSliderClose(event): void\n\t{\n\t\tthis.#updateAndRenderPaySystems(false, this.#minLoaderShowTime);\n\t}\n}"],"names":["PaySystemsSelectorField","options","active","recommended","Reflect","has","disabledPaySystems","onFetchPaySystemsError","showMorePaySystemsBtn","morePaySystemsBtnSidePanelPath","Dom","clean","getLayout","allPaySystems","BaseField","BX","ajax","runAction","json","then","response","data","paySystems","oldPaySystemIds","map","ps","id","sort","newPaySystemIds","result","isUpdated","length","index","errors","useLoaderOnFetchStart","minLoaderShowTime","show","loaderEndTime","Date","now","Promise","resolve","setTimeout","hide","forEach","paySystem","append","cache","remember","btnLayout","Tag","render","Loc","getMessage","onclick","SidePanel","Instance","open","events","onCloseComplete","event","paySystemData","paySystemLayout","title","image","connectBtnLayout","Event","bind","editPath","defaultPaySystemImage","switcher","SmallSwitch","value","addClass","subscribe","paySystemSortRule","paySystem1","paySystem2","paySystem1ActivationStatus","paySystem2ActivationStatus","paySystemId","includes","push","splice","indexOf","emit","children","Text","encode","Loader","target","layout","size","mode","offset","top","left"],"mappings":"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"}