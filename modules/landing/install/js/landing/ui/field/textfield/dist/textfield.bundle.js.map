{"version":3,"file":"textfield.bundle.js","sources":["../src/textfield.js"],"sourcesContent":["import {BaseField} from 'landing.ui.field.basefield';\nimport {Text, Type, Event, Dom, Runtime} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\n\nexport class TextField extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.TextField');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\n\t\tthis.bind = this.options.bind;\n\t\tthis.changeTagButton = this.options.changeTagButton;\n\t\tthis.onInputHandler = Type.isFunction(this.options.onInput) ? this.options.onInput : () => {};\n\t\tthis.onValueChangeHandler = Type.isFunction(this.options.onValueChange) ? this.options.onValueChange : () => {};\n\t\tthis.textOnly = Type.isBoolean(this.options.textOnly) ? this.options.textOnly : false;\n\t\tthis.content = this.textOnly ? Text.encode(this.content) : this.content;\n\t\tthis.input.innerHTML = this.content;\n\n\t\tthis.onInputClick = this.onInputClick.bind(this);\n\t\tthis.onInputMousedown = this.onInputMousedown.bind(this);\n\t\tthis.onDocumentMouseup = this.onDocumentMouseup.bind(this);\n\t\tthis.onInputInput = this.onInputInput.bind(this);\n\t\tthis.onDocumentClick = this.onDocumentClick.bind(this);\n\t\tthis.onDocumentKeydown = this.onDocumentKeydown.bind(this);\n\t\tthis.onInputKeydown = this.onInputKeydown.bind(this);\n\n\t\tEvent.bind(this.input, 'click', this.onInputClick);\n\t\tEvent.bind(this.input, 'mousedown', this.onInputMousedown);\n\t\tEvent.bind(this.input, 'input', this.onInputInput);\n\t\tEvent.bind(this.input, 'keydown', this.onInputKeydown);\n\n\t\tEvent.bind(document, 'click', this.onDocumentClick);\n\t\tEvent.bind(document, 'keydown', this.onDocumentKeydown);\n\t\tEvent.bind(document, 'mouseup', this.onDocumentMouseup);\n\t}\n\n\tonInputInput()\n\t{\n\t\tthis.onInputHandler(this.input.innerText);\n\t\tthis.onValueChangeHandler(this);\n\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {value: this.getValue()},\n\t\t\tcompatData: [this.getValue()],\n\t\t});\n\n\t\tthis.emit('onChange', event);\n\t}\n\n\tonDocumentKeydown(event)\n\t{\n\t\tif (event.keyCode === 27)\n\t\t{\n\t\t\tif (this.isEditable())\n\t\t\t{\n\t\t\t\tif (this === BX.Landing.UI.Field.BaseField.currentField)\n\t\t\t\t{\n\t\t\t\t\tBX.Landing.UI.Panel.EditorPanel.getInstance().hide();\n\t\t\t\t}\n\n\t\t\t\tthis.disableEdit();\n\t\t\t}\n\t\t}\n\t}\n\n\tonInputKeydown(event)\n\t{\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tif (this.isTextOnly())\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t}\n\n\tenableTextOnly()\n\t{\n\t\tthis.textOnly = true;\n\t\tthis.input.innerHTML = `${this.input.innerText}`.trim();\n\t}\n\n\tdisableTextOnly()\n\t{\n\t\tthis.textOnly = false;\n\t}\n\n\tisTextOnly()\n\t{\n\t\treturn this.textOnly;\n\t}\n\n\tonDocumentClick()\n\t{\n\t\tif (this.isEditable() && !this.fromInput)\n\t\t{\n\t\t\tif (this === BX.Landing.UI.Field.BaseField.currentField)\n\t\t\t{\n\t\t\t\tBX.Landing.UI.Panel.EditorPanel.getInstance().hide();\n\t\t\t}\n\n\t\t\tthis.disableEdit();\n\t\t}\n\n\t\tthis.fromInput = false;\n\t}\n\n\tonDocumentMouseup()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tthis.fromInput = false;\n\t\t}, 10);\n\t}\n\n\tonInputClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.fromInput = false;\n\t}\n\n\tonInputMousedown(event)\n\t{\n\t\tthis.enableEdit();\n\n\t\tBX.Landing.UI.Tool.ColorPicker.hideAll();\n\t\tBX.Landing.UI.Button.FontAction.hideAll();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tif (event.target.nodeName === 'A')\n\t\t\t{\n\t\t\t\tconst range = document.createRange();\n\t\t\t\trange.selectNode(event.target);\n\t\t\t\twindow.getSelection().removeAllRanges();\n\t\t\t\twindow.getSelection().addRange(range);\n\t\t\t}\n\t\t});\n\n\t\tthis.fromInput = true;\n\n\t\tevent.stopPropagation();\n\t}\n\n\tenableEdit()\n\t{\n\t\tif (!this.isEditable())\n\t\t{\n\t\t\tif (this !== BX.Landing.UI.Field.BaseField.currentField && BX.Landing.UI.Field.BaseField.currentField !== null)\n\t\t\t{\n\t\t\t\tBX.Landing.UI.Field.BaseField.currentField.disableEdit();\n\t\t\t}\n\n\t\t\tBX.Landing.UI.Field.BaseField.currentField = this;\n\n\t\t\tif (!this.isTextOnly())\n\t\t\t{\n\t\t\t\tif (this.changeTagButton)\n\t\t\t\t{\n\t\t\t\t\tthis.changeTagButton.onChangeHandler = this.onChangeTag.bind(this);\n\t\t\t\t}\n\n\t\t\t\tBX.Landing.UI.Panel.EditorPanel.getInstance().show(this.layout, null, this.changeTagButton ? [this.changeTagButton] : null);\n\t\t\t\tthis.input.contentEditable = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.Landing.UI.Panel.EditorPanel.getInstance().hide();\n\t\t\t\tthis.input.contentEditable = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tonChangeTag(value)\n\t{\n\t\tthis.tag = value;\n\t}\n\n\tdisableEdit()\n\t{\n\t\tthis.input.contentEditable = false;\n\t}\n\n\tisEditable()\n\t{\n\t\treturn this.input.isContentEditable;\n\t}\n\n\treset()\n\t{\n\t\tthis.setValue('');\n\t}\n\n\tadjustTags(element)\n\t{\n\t\tif (element.lastChild && element.lastChild.nodeName === 'BR')\n\t\t{\n\t\t\tDom.remove(element.lastChild);\n\t\t\tthis.adjustTags(element);\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tgetValue()\n\t{\n\t\tif (this.textOnly)\n\t\t{\n\t\t\treturn this.input.innerText;\n\t\t}\n\n\t\treturn this.adjustTags(Runtime.clone(this.input)).innerHTML.replace(/&nbsp;/g, '');\n\t}\n}\n\nexport {\n\tTextField as Text,\n};"],"names":["TextField","options","setEventNamespace","subscribeFromOptions","fetchEventsFromOptions","bind","changeTagButton","onInputHandler","Type","isFunction","onInput","onValueChangeHandler","onValueChange","textOnly","isBoolean","content","Text","encode","input","innerHTML","onInputClick","onInputMousedown","onDocumentMouseup","onInputInput","onDocumentClick","onDocumentKeydown","onInputKeydown","Event","document","innerText","event","BaseEvent","data","value","getValue","compatData","emit","keyCode","isEditable","BX","Landing","UI","Field","BaseField","currentField","Panel","EditorPanel","getInstance","hide","disableEdit","isTextOnly","preventDefault","trim","fromInput","setTimeout","stopPropagation","enableEdit","Tool","ColorPicker","hideAll","Button","FontAction","requestAnimationFrame","target","nodeName","range","createRange","selectNode","window","getSelection","removeAllRanges","addRange","onChangeHandler","onChangeTag","show","layout","contentEditable","tag","isContentEditable","setValue","element","lastChild","Dom","remove","adjustTags","Runtime","clone","replace"],"mappings":"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"}