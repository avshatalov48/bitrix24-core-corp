{"version":3,"file":"textfield.bundle.js","sources":["../src/textfield.js"],"sourcesContent":["import {BaseField} from 'landing.ui.field.basefield';\nimport {Text, Type, Event, Dom, Runtime} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\n\nexport class TextField extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.TextField');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\n\t\tthis.bind = this.options.bind;\n\t\tthis.changeTagButton = this.options.changeTagButton;\n\t\tthis.onInputHandler = Type.isFunction(this.options.onInput) ? this.options.onInput : () => {};\n\t\tthis.onValueChangeHandler = Type.isFunction(this.options.onValueChange) ? this.options.onValueChange : () => {};\n\t\tthis.textOnly = Type.isBoolean(this.options.textOnly) ? this.options.textOnly : false;\n\t\tthis.content = this.textOnly ? Text.encode(this.content) : this.content;\n\t\tthis.input.innerHTML = this.content;\n\n\t\tthis.onInputClick = this.onInputClick.bind(this);\n\t\tthis.onInputMousedown = this.onInputMousedown.bind(this);\n\t\tthis.onDocumentMouseup = this.onDocumentMouseup.bind(this);\n\t\tthis.onInputInput = this.onInputInput.bind(this);\n\t\tthis.onDocumentClick = this.onDocumentClick.bind(this);\n\t\tthis.onDocumentKeydown = this.onDocumentKeydown.bind(this);\n\t\tthis.onInputKeydown = this.onInputKeydown.bind(this);\n\n\t\tEvent.bind(this.input, 'click', this.onInputClick);\n\t\tEvent.bind(this.input, 'mousedown', this.onInputMousedown);\n\t\tEvent.bind(this.input, 'input', this.onInputInput);\n\t\tEvent.bind(this.input, 'keydown', this.onInputKeydown);\n\n\t\tEvent.bind(document, 'click', this.onDocumentClick);\n\t\tEvent.bind(document, 'keydown', this.onDocumentKeydown);\n\t\tEvent.bind(document, 'mouseup', this.onDocumentMouseup);\n\t}\n\n\tonInputInput()\n\t{\n\t\tthis.onInputHandler(this.input.innerText);\n\t\tthis.onValueChangeHandler(this);\n\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {value: this.getValue()},\n\t\t\tcompatData: [this.getValue()],\n\t\t});\n\n\t\tthis.emit('onChange', event);\n\t}\n\n\tonDocumentKeydown(event)\n\t{\n\t\tif (event.keyCode === 27)\n\t\t{\n\t\t\tif (this.isEditable())\n\t\t\t{\n\t\t\t\tif (this === BX.Landing.UI.Field.BaseField.currentField)\n\t\t\t\t{\n\t\t\t\t\tBX.Landing.UI.Panel.EditorPanel.getInstance().hide();\n\t\t\t\t}\n\n\t\t\t\tthis.disableEdit();\n\t\t\t}\n\t\t}\n\t}\n\n\tonInputKeydown(event)\n\t{\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tif (this.isTextOnly())\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t}\n\n\tenableTextOnly()\n\t{\n\t\tthis.textOnly = true;\n\t\tthis.input.innerHTML = `${this.input.innerText}`.trim();\n\t}\n\n\tdisableTextOnly()\n\t{\n\t\tthis.textOnly = false;\n\t}\n\n\tisTextOnly()\n\t{\n\t\treturn this.textOnly;\n\t}\n\n\tisContentEditable()\n\t{\n\t\treturn this.contentEditable !== false;\n\t}\n\n\tonDocumentClick()\n\t{\n\t\tif (this.isEditable() && !this.fromInput)\n\t\t{\n\t\t\tif (this === BX.Landing.UI.Field.BaseField.currentField)\n\t\t\t{\n\t\t\t\tBX.Landing.UI.Panel.EditorPanel.getInstance().hide();\n\t\t\t}\n\n\t\t\tthis.disableEdit();\n\t\t}\n\n\t\tthis.fromInput = false;\n\t}\n\n\tonDocumentMouseup()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tthis.fromInput = false;\n\t\t}, 10);\n\t}\n\n\tonInputClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.fromInput = false;\n\t}\n\n\tonInputMousedown(event)\n\t{\n\t\tthis.enableEdit();\n\n\t\tBX.Landing.UI.Tool.ColorPicker.hideAll();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tif (event.target.nodeName === 'A')\n\t\t\t{\n\t\t\t\tconst range = document.createRange();\n\t\t\t\trange.selectNode(event.target);\n\t\t\t\twindow.getSelection().removeAllRanges();\n\t\t\t\twindow.getSelection().addRange(range);\n\t\t\t}\n\t\t});\n\n\t\tthis.fromInput = true;\n\n\t\tevent.stopPropagation();\n\t}\n\n\tenableEdit()\n\t{\n\t\tif (!this.isEditable())\n\t\t{\n\t\t\tif (this !== BX.Landing.UI.Field.BaseField.currentField && BX.Landing.UI.Field.BaseField.currentField !== null)\n\t\t\t{\n\t\t\t\tBX.Landing.UI.Field.BaseField.currentField.disableEdit();\n\t\t\t}\n\n\t\t\tBX.Landing.UI.Field.BaseField.currentField = this;\n\n\t\t\tif (!this.isTextOnly())\n\t\t\t{\n\t\t\t\tif (this.changeTagButton)\n\t\t\t\t{\n\t\t\t\t\tthis.changeTagButton.onChangeHandler = this.onChangeTag.bind(this);\n\t\t\t\t}\n\n\t\t\t\tBX.Landing.UI.Panel.EditorPanel.getInstance().show(this.layout, null, this.changeTagButton ? [this.changeTagButton] : null);\n\t\t\t\tthis.input.contentEditable = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.Landing.UI.Panel.EditorPanel.getInstance().hide();\n\t\t\t\tthis.input.contentEditable = true;\n\t\t\t}\n\n\t\t\tif (!this.isContentEditable())\n\t\t\t{\n\t\t\t\tthis.input.contentEditable = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tonChangeTag(value)\n\t{\n\t\tthis.tag = value;\n\t}\n\n\tdisableEdit()\n\t{\n\t\tthis.input.contentEditable = false;\n\t}\n\n\tisEditable()\n\t{\n\t\treturn this.input.isContentEditable;\n\t}\n\n\treset()\n\t{\n\t\tthis.setValue('');\n\t}\n\n\tadjustTags(element)\n\t{\n\t\tif (element.lastChild && element.lastChild.nodeName === 'BR')\n\t\t{\n\t\t\tDom.remove(element.lastChild);\n\t\t\tthis.adjustTags(element);\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tgetValue()\n\t{\n\t\tif (this.textOnly)\n\t\t{\n\t\t\treturn this.input.innerText;\n\t\t}\n\n\t\treturn this.adjustTags(Runtime.clone(this.input)).innerHTML.replace(/&nbsp;/g, '');\n\t}\n}\n\nexport {\n\tTextField as Text,\n};"],"names":["TextField","options","setEventNamespace","subscribeFromOptions","fetchEventsFromOptions","bind","changeTagButton","onInputHandler","Type","isFunction","onInput","onValueChangeHandler","onValueChange","textOnly","isBoolean","content","Text","encode","input","innerHTML","onInputClick","onInputMousedown","onDocumentMouseup","onInputInput","onDocumentClick","onDocumentKeydown","onInputKeydown","Event","document","innerText","event","BaseEvent","data","value","getValue","compatData","emit","keyCode","isEditable","BX","Landing","UI","Field","BaseField","currentField","Panel","EditorPanel","getInstance","hide","disableEdit","isTextOnly","preventDefault","trim","contentEditable","fromInput","setTimeout","stopPropagation","enableEdit","Tool","ColorPicker","hideAll","requestAnimationFrame","target","nodeName","range","createRange","selectNode","window","getSelection","removeAllRanges","addRange","onChangeHandler","onChangeTag","show","layout","isContentEditable","tag","setValue","element","lastChild","Dom","remove","adjustTags","Runtime","clone","replace"],"mappings":"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"}