{"version":3,"file":"sourcefield.bundle.js","sources":["../src/internal/filter-stub.js","../src/internal/prepare-sources.js","../src/internal/prepare-value.js","../src/sourcefield.js"],"sourcesContent":["import {Loc} from 'landing.loc';\n\nexport default function getFilterStub(): {key: string, name: string, value: any}\n{\n\treturn {\n\t\tkey: 'filterStub',\n\t\tname: Loc.getMessage('LANDING_BLOCK__SOURCE_FILTER_STUB'),\n\t\tvalue: '',\n\t};\n}","import {Type, Runtime} from 'main.core';\nimport getFilterStub from './filter-stub';\n\nexport type SourceItem = {\n\tname: string,\n\tvalue: string,\n\tfilter?: Array<{key: string, name: string, value: any}>,\n\tsort?: {\n\t\titems: Array<{name: string, value: string}>,\n\t},\n\turl?: string,\n\tsettings?: {\n\t\tdetailPage?: boolean,\n\t},\n};\n\nexport default function prepareSources(sources: Array<SourceItem>)\n{\n\tif (Type.isArray(sources))\n\t{\n\t\treturn sources.reduce((acc, item) => {\n\t\t\tif (\n\t\t\t\tType.isPlainObject(item)\n\t\t\t\t&& Type.isString(item.name)\n\t\t\t\t&& Type.isString(item.value)\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst source = Runtime.clone(item);\n\n\t\t\t\tif (\n\t\t\t\t\t!Type.isArray(source.filter)\n\t\t\t\t\t|| source.filter.length <= 0\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tsource.filter = [Runtime.clone(getFilterStub())];\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t!Type.isPlainObject(source.sort)\n\t\t\t\t\t|| !Type.isArray(source.sort.items)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tsource.sort = {items: []};\n\t\t\t\t}\n\n\t\t\t\treturn [...acc, source];\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, []);\n\t}\n\n\treturn [];\n}","import {Type} from 'main.core';\nimport type {SourceItem} from './prepare-sources';\n\ntype Value = {\n\tsource: string,\n\tfilter: Array<{key: string, name: string, value: any}>,\n\tsort: {\n\t\tby: string,\n\t\torder: 'DESC' | 'ASC',\n\t},\n};\n\nfunction prepareFilter(filter, source)\n{\n\treturn filter.reduce((acc, field) => {\n\t\tif (Type.isPlainObject(field))\n\t\t{\n\t\t\treturn [...acc, {...field, url: source.url}];\n\t\t}\n\n\t\treturn acc;\n\t}, []);\n}\n\nexport default function prepareValue(value: any, sources: Array<SourceItem>): Value\n{\n\tconst [firstSource] = sources;\n\n\tif (!Type.isPlainObject(value))\n\t{\n\t\treturn {\n\t\t\tsource: firstSource.value,\n\t\t\tfilter: prepareFilter([...firstSource.filter], firstSource),\n\t\t\tsort: {\n\t\t\t\tby: firstSource.sort.items[0].key,\n\t\t\t\torder: 'DESC',\n\t\t\t},\n\t\t};\n\t}\n\n\tconst source = sources.find((item) => {\n\t\treturn item.value === value.source;\n\t});\n\n\tif (\n\t\t!Type.isArray(value.filter)\n\t\t|| value.filter.length <= 0\n\t)\n\t{\n\t\tif (source)\n\t\t{\n\t\t\tvalue.filter = [...source.filter];\n\t\t}\n\t}\n\n\tvalue.filter = prepareFilter(value.filter, source);\n\n\tif (!Type.isPlainObject(value.sort))\n\t{\n\t\tvalue.sort = {};\n\t}\n\n\tif (!Type.isString(value.sort.by))\n\t{\n\t\tif (source)\n\t\t{\n\t\t\tvalue.sort.by = source.sort.items[0].value;\n\t\t}\n\t}\n\n\tif (!Type.isString(value.sort.order))\n\t{\n\t\tvalue.sort.order = 'DESC';\n\t}\n\n\treturn value;\n}","import {Type, Dom, Event, Cache, Tag, Text, Runtime} from 'main.core';\nimport {Loc} from 'landing.loc';\nimport {Env} from 'landing.env';\nimport {BaseField} from 'landing.ui.field.basefield';\nimport prepareSources from './internal/prepare-sources';\nimport prepareValue from './internal/prepare-value';\nimport type {SourceItem} from './internal/prepare-sources';\nimport './css/style.css';\nimport getFilterStub from './internal/filter-stub';\n\n/**\n * @memberOf BX.Landing.UI.Field\n */\nexport class SourceField extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tDom.addClass(this.layout, 'landing-ui-field-source');\n\n\t\tthis.items = prepareSources(options.items);\n\t\tthis.value = prepareValue(options.value, this.items);\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis.onButtonClick = this.onButtonClick.bind(this);\n\t\tthis.onMenuItemClick = this.onMenuItemClick.bind(this);\n\t\tthis.onSliderMessage = this.onSliderMessage.bind(this);\n\t\tthis.onPlaceholderRemoveClick = this.onPlaceholderRemoveClick.bind(this);\n\t\tthis.onPlaceholderClick = this.onPlaceholderClick.bind(this);\n\n\t\tDom.append(this.getGrid(), this.layout);\n\t\tDom.append(this.getSortByField().layout, this.layout);\n\t\tDom.append(this.getSortOrderField().layout, this.layout);\n\t\tDom.append(this.getValueLayoutWrapper(), this.header);\n\n\t\tthis.setValue(this.value);\n\n\t\t// const rootWindow = BX.Landing.PageObject.getRootWindow();\n\t\twindow.top.BX.addCustomEvent('SidePanel.Slider:onMessage', this.onSliderMessage);\n\t}\n\n\tgetItem(value: string): ?SourceItem\n\t{\n\t\treturn this.items.find((item) => {\n\t\t\treturn item.value === value;\n\t\t});\n\t}\n\n\tgetButtonField(): BX.Landing.UI.Button.BaseButton\n\t{\n\t\treturn this.cache.remember('buttonField', () => {\n\t\t\treturn new BX.Landing.UI.Button.BaseButton('dropdown_button', {\n\t\t\t\ttext: Loc.getMessage('LINK_URL_SUGGESTS_SELECT'),\n\t\t\t\tclassName: 'landing-ui-button-select-link',\n\t\t\t\tonClick: this.onButtonClick,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSortByField(): BX.Landing.UI.Field.DropdownInline\n\t{\n\t\treturn this.cache.remember('sortByField', () => {\n\t\t\tconst item = this.getItem(this.value.source);\n\t\t\treturn new BX.Landing.UI.Field.DropdownInline({\n\t\t\t\ttitle: Loc.getMessage('LANDING_CARDS__SOURCE_FIELD_SORT_TITLE').toLowerCase(),\n\t\t\t\titems: item.sort.items,\n\t\t\t\tcontent: this.value.sort.by,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSortOrderField(): BX.Landing.UI.Field.DropdownInline\n\t{\n\t\treturn this.cache.remember('sortOrderField', () => {\n\t\t\treturn new BX.Landing.UI.Field.DropdownInline({\n\t\t\t\ttitle: ', ',\n\t\t\t\titems: [\n\t\t\t\t\t{name: Loc.getMessage('LANDING_CARDS__SOURCE_FIELD_SORT_DESC'), value: 'DESC'},\n\t\t\t\t\t{name: Loc.getMessage('LANDING_CARDS__SOURCE_FIELD_SORT_ASC'), value: 'ASC'},\n\t\t\t\t],\n\t\t\t\tcontent: this.value.sort.order,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetValueLayout(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('valueLayout', () => {\n\t\t\treturn Tag.render`<span></span>`;\n\t\t});\n\t}\n\n\tgetValueLayoutWrapper(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('valueLayoutWrapper', () => {\n\t\t\treturn Tag.render`<span>&nbsp;(${this.getValueLayout()})</span>`;\n\t\t});\n\t}\n\n\tgetInput(): HTMLDivElement\n\t{\n\t\treturn this.input;\n\t}\n\n\tgetGrid(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-source-grid\">\n\t\t\t\t\t<div class=\"landing-ui-field-source-grid-left\">${this.getInput()}</div>\n\t\t\t\t\t<div class=\"landing-ui-field-source-grid-right\">${this.getButtonField().layout}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonButtonClick()\n\t{\n\t\tthis.getMenu().show();\n\t}\n\n\tonMenuItemClick(item)\n\t{\n\t\tconst value = prepareValue({source: item.value}, this.items);\n\t\tthis.setValue(value);\n\t\tthis.getMenu().close();\n\t\tthis.openSourceFilterSlider(item.url);\n\t}\n\n\tonPlaceholderClick(item, event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.openSourceFilterSlider(item.url);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tonPlaceholderRemoveClick(item, event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst {currentTarget} = event;\n\n\t\tif (Type.isDomNode(currentTarget))\n\t\t{\n\t\t\tconst placeholder = currentTarget\n\t\t\t\t.closest('.landing-ui-field-source-placeholder');\n\n\t\t\tif (placeholder)\n\t\t\t{\n\t\t\t\tDom.remove(placeholder);\n\t\t\t}\n\n\t\t\tif (this.getPlaceholders().length <= 0)\n\t\t\t{\n\t\t\t\tconst value = prepareValue({source: this.getValue().source}, this.items);\n\t\t\t\tthis.value = value;\n\t\t\t\tthis.setFilter(value.filter);\n\t\t\t}\n\n\t\t\tthis.value.filter = this.getPlaceholders().map((placeholderNode) => {\n\t\t\t\treturn Dom.attr(placeholderNode, 'data-item');\n\t\t\t});\n\t\t}\n\t}\n\n\tonSliderMessage(event)\n\t{\n\t\tif (event.getEventId() === 'save')\n\t\t{\n\t\t\tconst sourceValue = {...this.getValue(), filter: event.getData().filter};\n\t\t\tconst value = prepareValue(sourceValue, this.items);\n\n\t\t\tthis.value = value;\n\t\t\tthis.setFilter(value.filter);\n\t\t}\n\t}\n\n\topenSourceFilterSlider(url)\n\t{\n\t\tif (Type.isString(url))\n\t\t{\n\t\t\tconst siteId = Env.getInstance().getOptions().site_id;\n\n\t\t\tBX.SidePanel.Instance.open(url, {\n\t\t\t\tcacheable: false,\n\t\t\t\trequestMethod: 'post',\n\t\t\t\trequestParams: {\n\t\t\t\t\tfilter: this.getValue().filter,\n\t\t\t\t\tlandingParams: {\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tgetMenuItems(): Array<{id: string, text: string, onclick: () => {}}>\n\t{\n\t\treturn this.cache.remember('menuItems', () => {\n\t\t\treturn this.items.map((item) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: item.value,\n\t\t\t\t\ttext: Text.encode(item.name),\n\t\t\t\t\tonclick: () => this.onMenuItemClick(item),\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tgetMenu(): BX.PopupMenuWindow\n\t{\n\t\treturn this.cache.remember('menu', () => {\n\t\t\tconst form = this.input.closest(\n\t\t\t\t'.landing-ui-field-source',\n\t\t\t);\n\n\t\t\tconst menu = new BX.PopupMenuWindow({\n\t\t\t\tid: `${this.selector}_${Text.getRandom()}`,\n\t\t\t\tbindElement: this.getButtonField().layout,\n\t\t\t\tautoHide: true,\n\t\t\t\titems: this.getMenuItems(),\n\t\t\t\tclassName: 'landing-ui-field-source-popup',\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: () => {\n\t\t\t\t\t\tconst buttonPosition = Dom.getRelativePosition(\n\t\t\t\t\t\t\tthis.getButtonField().layout,\n\t\t\t\t\t\t\tform,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tconst offsetX = 0;\n\t\t\t\t\t\tconst popupWindowTop = buttonPosition.bottom;\n\n\t\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\t\tDom.style(menu.popupWindow.popupContainer, {\n\t\t\t\t\t\t\t\ttop: `${popupWindowTop}px`,\n\t\t\t\t\t\t\t\tleft: 'auto',\n\t\t\t\t\t\t\t\tright: `${offsetX}px`,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tDom.append(menu.popupWindow.popupContainer, form);\n\n\t\t\treturn menu;\n\t\t});\n\t}\n\n\taddPlaceholder(options)\n\t{\n\t\tconst placeholder = Tag.render`\n\t\t\t<div class=\"landing-ui-field-source-placeholder\">\n\t\t\t\t<span class=\"landing-ui-field-source-placeholder-text\">${Text.encode(options.name)}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.attr(placeholder, {\n\t\t\t'data-item': options,\n\t\t\ttitle: options.name,\n\t\t});\n\n\t\tif (!options.url)\n\t\t{\n\t\t\tDom.addClass(placeholder.firstElementChild, 'landing-ui-field-source-placeholder-text-plain');\n\t\t}\n\n\t\tif (options.url)\n\t\t{\n\t\t\tconst removeButton = Tag.render`\n\t\t\t\t<span class=\"landing-ui-field-source-placeholder-remove\"></span>\n\t\t\t`;\n\n\t\t\tDom.append(removeButton, placeholder);\n\t\t\tEvent.bind(placeholder, 'click', this.onPlaceholderClick.bind(this, options));\n\t\t\tEvent.bind(removeButton, 'click', this.onPlaceholderRemoveClick.bind(this, options));\n\t\t}\n\n\t\tDom.append(placeholder, this.input);\n\t}\n\n\tgetPlaceholders(): Array<HTMLElement>\n\t{\n\t\treturn [...this.input.querySelectorAll('.landing-ui-field-source-placeholder')];\n\t}\n\n\tsetFilter(filter: Array<{key: string, name: string, value: any, url: ?string}>)\n\t{\n\t\tDom.clean(this.getInput());\n\n\t\tfilter.forEach((field) => {\n\t\t\tthis.addPlaceholder(field);\n\t\t});\n\t}\n\n\tsetSource({value, name}: SourceItem)\n\t{\n\t\tconst valueLayout = this.getValueLayout();\n\t\tDom.attr(valueLayout, 'data-value', value);\n\t\tvalueLayout.innerText = name;\n\t}\n\n\tsetSortByItems(items: {name: string, value: string})\n\t{\n\t\tif (Type.isArray(items))\n\t\t{\n\t\t\tthis.getSortByField().setItems(items);\n\t\t}\n\t}\n\n\tsetValue(value, preventEvent)\n\t{\n\t\tconst preparedValue = prepareValue(value, this.items);\n\t\tconst sourceItem = this.getItem(value.source);\n\n\t\tif (Type.isPlainObject(sourceItem))\n\t\t{\n\t\t\tif (\n\t\t\t\tpreparedValue.source !== this.value.source\n\t\t\t\t|| this.getPlaceholders().length <= 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.value = Runtime.clone(preparedValue);\n\n\t\t\t\tthis.setFilter(preparedValue.filter);\n\t\t\t\tthis.setSource(sourceItem);\n\n\t\t\t\tconst sortByField = this.getSortByField();\n\t\t\t\tsortByField.setItems(sourceItem.sort.items);\n\t\t\t\tsortByField.setValue(preparedValue.sort.by);\n\n\t\t\t\tconst orderByField = this.getSortOrderField();\n\t\t\t\torderByField.setValue(preparedValue.sort.order);\n\n\t\t\t\tif (!preventEvent)\n\t\t\t\t{\n\t\t\t\t\tthis.onValueChangeHandler(this);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetValue()\n\t{\n\t\tconst value = Runtime.clone(this.value);\n\n\t\tvalue.filter = value.filter\n\t\t\t.filter((field) => {\n\t\t\t\treturn field.key !== getFilterStub().key;\n\t\t\t})\n\t\t\t.map((field) => {\n\t\t\t\tReflect.deleteProperty(field, 'url');\n\t\t\t\treturn field;\n\t\t\t});\n\n\t\tvalue.sort.by = this.getSortByField().getValue();\n\t\tvalue.sort.order = this.getSortOrderField().getValue();\n\n\t\treturn value;\n\t}\n\n\tgetCurrentSource(): SourceItem\n\t{\n\t\tconst value = this.getValue();\n\t\treturn this.getItem(value.source);\n\t}\n\n\tisDetailPageAllowed()\n\t{\n\t\tconst source = this.getCurrentSource();\n\n\t\treturn (\n\t\t\t!Type.isPlainObject(source)\n\t\t\t|| !Type.isPlainObject(source.settings)\n\t\t\t|| source.settings.detailPage !== false\n\t\t);\n\t}\n}"],"names":["getFilterStub","key","name","Loc","getMessage","value","prepareSources","sources","Type","isArray","reduce","acc","item","isPlainObject","isString","source","Runtime","clone","filter","length","sort","items","prepareFilter","field","url","prepareValue","firstSource","by","order","find","SourceField","options","Dom","addClass","layout","cache","Cache","MemoryCache","onButtonClick","bind","onMenuItemClick","onSliderMessage","onPlaceholderRemoveClick","onPlaceholderClick","append","getGrid","getSortByField","getSortOrderField","getValueLayoutWrapper","header","setValue","window","top","BX","addCustomEvent","remember","Landing","UI","Button","BaseButton","text","className","onClick","getItem","Field","DropdownInline","title","toLowerCase","content","Tag","render","getValueLayout","input","getInput","getButtonField","getMenu","show","close","openSourceFilterSlider","event","preventDefault","stopPropagation","currentTarget","isDomNode","placeholder","closest","remove","getPlaceholders","getValue","setFilter","map","placeholderNode","attr","getEventId","sourceValue","getData","siteId","Env","getInstance","getOptions","site_id","SidePanel","Instance","open","cacheable","requestMethod","requestParams","landingParams","id","Text","encode","onclick","form","menu","PopupMenuWindow","selector","getRandom","bindElement","autoHide","getMenuItems","events","onPopupShow","buttonPosition","getRelativePosition","offsetX","popupWindowTop","bottom","requestAnimationFrame","style","popupWindow","popupContainer","left","right","firstElementChild","removeButton","Event","querySelectorAll","clean","forEach","addPlaceholder","valueLayout","innerText","setItems","preventEvent","preparedValue","sourceItem","setSource","sortByField","orderByField","onValueChangeHandler","Reflect","deleteProperty","getCurrentSource","settings","detailPage","BaseField"],"mappings":"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"}