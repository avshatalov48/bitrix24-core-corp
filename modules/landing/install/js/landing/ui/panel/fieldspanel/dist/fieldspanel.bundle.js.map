{"version":3,"file":"fieldspanel.bundle.js","sources":["../src/fieldspanel.js"],"sourcesContent":["import {Cache, Dom, Tag, Type} from 'main.core';\nimport {Content} from 'landing.ui.panel.content';\nimport {Loader} from 'main.loader';\nimport {Backend} from 'landing.backend';\nimport {PageObject} from 'landing.pageobject';\nimport {SidebarButton} from 'landing.ui.button.sidebarbutton';\nimport {Loc} from 'landing.loc';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {BaseButton} from 'landing.ui.button.basebutton';\nimport {Text} from 'landing.ui.field.textfield';\nimport {FormSettingsPanel} from 'landing.ui.panel.formsettingspanel';\nimport {FormClient} from 'crm.form.client';\nimport 'ui.userfieldfactory';\n\nimport './css/style.css';\n\ntype CrmField = {\n\ttype: 'list' | 'string' | 'checkbox' | 'date' | 'text' | 'typed_string' | 'file',\n\tentity_field_name: string,\n\tentity_name: string,\n\tname: string,\n\tcaption: string,\n\tmultiple: boolean,\n\trequired: boolean,\n\thidden: boolean,\n\titems: Array<{ID: any, VALUE: any}>,\n};\n\ntype CrmFieldsList = {\n\t[categoryId: string]: {\n\t\tCAPTION: string,\n\t\tFIELDS: Array<CrmField>\n\t},\n};\n\n/**\n * @memberOf BX.Landing.UI.Panel\n */\nexport class FieldsPanel extends Content\n{\n\tstatic getInstance(options): FieldsPanel\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tconst rootWindowPanel = rootWindow.BX.Landing.UI.Panel.FieldsPanel;\n\t\tif (!rootWindowPanel.instance && !FieldsPanel.instance)\n\t\t{\n\t\t\trootWindowPanel.instance = new FieldsPanel(options);\n\t\t}\n\n\t\tconst instance = (rootWindowPanel.instance || FieldsPanel.instance);\n\t\tinstance.options = options;\n\n\t\treturn instance;\n\t}\n\n\tadjustActionsPanels = false;\n\n\tconstructor(options = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FieldsPanel');\n\t\tthis.setLayoutClass('landing-ui-panel-fields');\n\t\tthis.setOverlayClass('landing-ui-panel-fields-overlay');\n\t\tthis.setTitle(Loc.getMessage('LANDING_FIELDS_PANEL_TITLE'));\n\n\t\tthis.onSaveClick = this.onSaveClick.bind(this);\n\t\tthis.onCancelClick = this.onCancelClick.bind(this);\n\n\t\tthis.options = options;\n\t\tthis.cache = new Cache.MemoryCache();\n\n\t\tDom.append(this.layout, this.getViewContainer());\n\t\tDom.append(this.overlay, this.getViewContainer());\n\t\tDom.insertAfter(this.getSearchContainer(), this.header);\n\t\tDom.append(this.getCreateFieldLayout(), this.body);\n\n\t\tthis.showLoader();\n\t\tthis.loadPromise = this.load()\n\t\t\t.then(() => {\n\t\t\t\tthis.hideLoader();\n\n\t\t\t\tObject.entries(this.getCrmFields())\n\t\t\t\t\t.forEach(([categoryId, category]) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tcategoryId !== 'CATALOG'\n\t\t\t\t\t\t\t&& categoryId !== 'ACTIVITY'\n\t\t\t\t\t\t\t&& categoryId !== 'INVOICE'\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tType.isPlainObject(options)\n\t\t\t\t\t\t\t\t&& Type.isBoolean(options.isLeadEnabled)\n\t\t\t\t\t\t\t\t&& !options.isLeadEnabled\n\t\t\t\t\t\t\t\t&& categoryId === 'LEAD'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst button = new SidebarButton({\n\t\t\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\t\t\ttext: category.CAPTION,\n\t\t\t\t\t\t\t\tchild: true,\n\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\tthis.onSidebarButtonClick(button);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.appendSidebarButton(button);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\n\t\tthis.appendFooterButton(\n\t\t\tnew BaseButton('save_settings', {\n\t\t\t\ttext: Loc.getMessage('LANDING_FIELDS_PANEL_ADD_SELECTED_BUTTON'),\n\t\t\t\tonClick: this.onSaveClick,\n\t\t\t\tclassName: 'landing-ui-button-content-save',\n\t\t\t\tattrs: {title: Loc.getMessage('LANDING_TITLE_OF_SLIDER_SAVE')},\n\t\t\t}),\n\t\t);\n\n\t\tthis.appendFooterButton(\n\t\t\tnew BaseButton('cancel_settings', {\n\t\t\t\ttext: Loc.getMessage('BLOCK_CANCEL'),\n\t\t\t\tonClick: this.onCancelClick,\n\t\t\t\tclassName: 'landing-ui-button-content-cancel',\n\t\t\t\tattrs: {title: Loc.getMessage('LANDING_TITLE_OF_SLIDER_CANCEL')},\n\t\t\t}),\n\t\t);\n\t}\n\n\tisMultiple(): boolean\n\t{\n\t\treturn this.cache.get('multiple', true);\n\t}\n\n\tsetMultiple(mode: boolean)\n\t{\n\t\tthis.cache.set('multiple', mode);\n\t}\n\n\tsetAllowedTypes(types: Array<string>)\n\t{\n\t\tthis.cache.set('allowedTypes', types);\n\t}\n\n\tgetAllowedTypes(): Array<string>\n\t{\n\t\treturn this.cache.get('allowedTypes', []);\n\t}\n\n\tsetDisabledFields(fields: Array<string>)\n\t{\n\t\tthis.cache.set('disabledFields', fields);\n\t}\n\n\tgetDisabledFields(): Array<string>\n\t{\n\t\treturn this.cache.get('disabledFields', []);\n\t}\n\n\tsetAllowedCategories(categories: Array<string>)\n\t{\n\t\tthis.cache.set('allowedCategories', categories);\n\t}\n\n\tgetAllowedCategories(): Array<string>\n\t{\n\t\treturn this.cache.get('allowedCategories', []);\n\t}\n\n\tresetFactoriesCache()\n\t{\n\t\tthis.cache.keys().forEach((key) => {\n\t\t\tif (key.startsWith('userFieldFactory_'))\n\t\t\t{\n\t\t\t\tthis.cache.delete(key);\n\t\t\t}\n\t\t});\n\t}\n\n\tshow(options = {}): Promise<any>\n\t{\n\t\tthis.getSearchField().input.textContent = '';\n\n\t\tthis.setMultiple(true);\n\t\tthis.setAllowedTypes([]);\n\t\tthis.setDisabledFields([]);\n\t\tthis.setAllowedCategories([]);\n\t\tthis.resetFactoriesCache();\n\n\t\tif (Type.isArrayFilled(options.disabledFields))\n\t\t{\n\t\t\tthis.setDisabledFields(options.disabledFields);\n\t\t}\n\n\t\tif (Type.isArrayFilled(options.allowedCategories))\n\t\t{\n\t\t\tthis.setAllowedCategories(options.allowedCategories);\n\t\t}\n\n\t\tif (Type.isArrayFilled(options.allowedTypes))\n\t\t{\n\t\t\tthis.setAllowedTypes(options.allowedTypes);\n\t\t}\n\n\t\tif (Type.isBoolean(options.multiple))\n\t\t{\n\t\t\tthis.setMultiple(options.multiple);\n\t\t}\n\n\t\tthis.loadPromise\n\t\t\t.then(() => {\n\t\t\t\tthis.sidebarButtons.forEach((button) => {\n\t\t\t\t\tDom.show(button.layout);\n\t\t\t\t});\n\n\t\t\t\tif (options.isLeadEnabled === false)\n\t\t\t\t{\n\t\t\t\t\tconst leadButton = this.sidebarButtons.get('LEAD');\n\t\t\t\t\tif (leadButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.hide(leadButton.layout);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (Type.isArrayFilled(options.allowedCategories))\n\t\t\t\t{\n\t\t\t\t\tthis.sidebarButtons.forEach((button) => {\n\t\t\t\t\t\tif (!options.allowedCategories.includes(button.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDom.hide(button.layout);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDom.show(button.layout);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.sidebarButtons.forEach((button) => {\n\t\t\t\t\t\tDom.show(button.layout);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst filteredFieldsTree = this.getFilteredFieldsTree();\n\t\t\t\tconst categories = Object.keys(filteredFieldsTree);\n\n\t\t\t\tthis.sidebarButtons.forEach((button) => {\n\t\t\t\t\tbutton.deactivate();\n\n\t\t\t\t\tif (categories.includes(button.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.show(button.getLayout());\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.hide(button.getLayout());\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (this.sidebarButtons.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.resetState();\n\n\t\t\t\t\tconst firstShowedButton = this.sidebarButtons.find((button) => {\n\t\t\t\t\t\treturn button.getLayout().hidden !== true;\n\t\t\t\t\t});\n\t\t\t\t\tif (firstShowedButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tfirstShowedButton.getLayout().click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\tsuper.show(options).then(() => {\n\t\t\tthis.getSearchField().enableEdit();\n\t\t\tthis.getSearchField().input.focus();\n\t\t});\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.promiseResolver = resolve;\n\t\t});\n\t}\n\n\thide()\n\t{\n\t\tthis.setCrmFields(this.getOriginalCrmFields());\n\t\treturn super.hide();\n\t}\n\n\tonSaveClick()\n\t{\n\t\tconst selectedFields = Object.values(this.getState())\n\t\t\t.reduce((acc, fields) => {\n\t\t\t\treturn [...acc, ...fields];\n\t\t\t}, []);\n\n\t\tthis.promiseResolver(selectedFields);\n\t\tvoid this.hide();\n\t\tthis.resetState();\n\t}\n\n\tonCancelClick()\n\t{\n\t\tvoid this.hide();\n\t\tthis.resetState();\n\t}\n\n\tgetViewContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('viewContainer', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\treturn rootWindow.document.querySelector('.landing-ui-view-container');\n\t\t});\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\treturn this.cache.remember('loader', () => {\n\t\t\treturn new Loader({\n\t\t\t\ttarget: this.body,\n\t\t\t});\n\t\t});\n\t}\n\n\tshowLoader()\n\t{\n\t\tthis.hideCreateFieldButton();\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader()\n\t{\n\t\tthis.showCreateFieldButton();\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tload(): Promise<any>\n\t{\n\t\treturn Backend.getInstance()\n\t\t\t.action('Form::getCrmFields')\n\t\t\t.then((result) => {\n\t\t\t\tthis.setOriginalCrmFields(result);\n\t\t\t\tthis.setCrmFields(result);\n\t\t\t\tObject.assign(FormSettingsPanel.getInstance().getCrmFields(), result);\n\n\t\t\t\treturn FormClient\n\t\t\t\t\t.getInstance()\n\t\t\t\t\t.getDictionary()\n\t\t\t\t\t.then((dictionary) => {\n\t\t\t\t\t\tthis.setFormDictionary(dictionary);\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tsetFormDictionary(dictionary)\n\t{\n\t\tthis.cache.set('formDictionary', dictionary);\n\t}\n\n\tgetFormDictionary(): {[key: string]: any}\n\t{\n\t\treturn this.cache.get('formDictionary', {});\n\t}\n\n\tsetOriginalCrmFields(fields)\n\t{\n\t\tthis.cache.set('originalFields', fields);\n\t}\n\n\tgetOriginalCrmFields(): CrmFieldsList\n\t{\n\t\treturn this.cache.get('originalFields') || {};\n\t}\n\n\tsetCrmFields(fields)\n\t{\n\t\tthis.cache.set('fields', fields);\n\t}\n\n\tgetCrmFields(): CrmFieldsList\n\t{\n\t\treturn this.cache.get('fields') || {};\n\t}\n\n\tsetState(state: {[categoryId: string]: Array<string>})\n\t{\n\t\tthis.cache.set('state', state);\n\t}\n\n\tgetState(): {[categoryId: string]: Array<string>}\n\t{\n\t\treturn this.cache.get('state') || {};\n\t}\n\n\tresetState()\n\t{\n\t\tthis.cache.delete('state');\n\t}\n\n\tonSidebarButtonClick(button: SidebarButton)\n\t{\n\t\tconst activeButton = this.sidebarButtons.getActive();\n\t\tif (activeButton)\n\t\t{\n\t\t\tactiveButton.deactivate();\n\t\t}\n\n\t\tbutton.activate();\n\n\t\tconst hideCreateButton = this.getAllowedTypes().every((type) => {\n\t\t\treturn Type.isPlainObject(type);\n\t\t});\n\t\tif (Type.isArrayFilled(this.getAllowedTypes()) && hideCreateButton)\n\t\t{\n\t\t\tthis.hideCreateFieldButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showCreateFieldButton();\n\t\t}\n\n\t\tconst crmFields = this.getCrmFields();\n\t\tif (Reflect.has(crmFields, button.id))\n\t\t{\n\t\t\tthis.clearContent();\n\n\t\t\tconst form = this.createFieldsListForm(button.id);\n\t\t\tthis.appendForm(form);\n\t\t}\n\t}\n\n\tgetFilteredFieldsTree()\n\t{\n\t\tconst searchString = String(this.getSearchField().getValue()).toLowerCase().trim();\n\t\tconst allowedCategories = this.getAllowedCategories();\n\t\tconst allowedTypes = this.getAllowedTypes();\n\n\t\treturn Object\n\t\t\t.entries(this.getCrmFields())\n\t\t\t.reduce((acc, [categoryId, category]) => {\n\t\t\t\tif (\n\t\t\t\t\t(\n\t\t\t\t\t\tcategoryId !== 'CATALOG'\n\t\t\t\t\t\t&& categoryId !== 'ACTIVITY'\n\t\t\t\t\t\t&& categoryId !== 'INVOICE'\n\t\t\t\t\t)\n\t\t\t\t\t&& (\n\t\t\t\t\t\t!Type.isArrayFilled(allowedCategories)\n\t\t\t\t\t\t|| allowedCategories.includes(categoryId)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst filteredFields = category.FIELDS.filter((field) => {\n\t\t\t\t\t\tconst fieldCaption = String(field.caption).toLowerCase().trim();\n\t\t\t\t\t\tif (Type.isArrayFilled(allowedTypes))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst isTypeAllowed = allowedTypes.some(allowedType => {\n\t\t\t\t\t\t\t\tif (!Type.isPlainObject(allowedType))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tallowedType = {type: allowedType};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tallowedType.entityFieldName\n\t\t\t\t\t\t\t\t\t&& allowedType.entityFieldName !== field.entity_field_name\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tType.isBoolean(allowedType.multiple)\n\t\t\t\t\t\t\t\t\t&& allowedType.multiple !== field.multiple\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn field.type === allowedType.type;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (!isTypeAllowed)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t!Type.isStringFilled(searchString)\n\t\t\t\t\t\t\t|| fieldCaption.includes(searchString)\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (Type.isArrayFilled(filteredFields))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[categoryId] = {\n\t\t\t\t\t\t\t...category,\n\t\t\t\t\t\t\tFIELDS: filteredFields,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t}\n\n\tcreateFieldsListForm(category: string): FormSettingsForm\n\t{\n\t\tconst fieldsListTree = this.getFilteredFieldsTree();\n\t\tconst disabledFields = this.getDisabledFields();\n\t\tconst fieldOptions = {\n\t\t\titems: fieldsListTree[category].FIELDS.map((field) => {\n\t\t\t\treturn {\n\t\t\t\t\tname: field.caption,\n\t\t\t\t\tvalue: field.name,\n\t\t\t\t\tdisabled: (\n\t\t\t\t\t\tType.isArrayFilled(disabledFields)\n\t\t\t\t\t\t&& disabledFields.includes(field.name)\n\t\t\t\t\t),\n\t\t\t\t};\n\t\t\t}),\n\t\t\tvalue: this.getState()[category] || [],\n\t\t\tonValueChange: (checkbox) => {\n\t\t\t\tconst state = {...this.getState()};\n\t\t\t\tstate[category] = checkbox.getValue();\n\t\t\t\tthis.setState(state);\n\t\t\t},\n\t\t};\n\n\t\treturn new FormSettingsForm({\n\t\t\tfields: [\n\t\t\t\tthis.isMultiple()\n\t\t\t\t\t? new BX.Landing.UI.Field.Checkbox(fieldOptions)\n\t\t\t\t\t: new BX.Landing.UI.Field.Radio(fieldOptions)\n\t\t\t\t,\n\t\t\t],\n\t\t});\n\t}\n\n\tonSearchChange()\n\t{\n\t\tconst filteredFieldsTree = this.getFilteredFieldsTree();\n\t\tconst categories = Object.keys(filteredFieldsTree);\n\n\t\tthis.sidebarButtons.forEach((button) => {\n\t\t\tbutton.deactivate();\n\n\t\t\tif (categories.includes(button.id))\n\t\t\t{\n\t\t\t\tDom.show(button.getLayout());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.hide(button.getLayout());\n\t\t\t}\n\t\t});\n\n\t\tthis.clearContent();\n\n\t\tconst [firstCategory] = categories;\n\t\tif (firstCategory)\n\t\t{\n\t\t\tconst firstCategoryButton = this.sidebarButtons.get(firstCategory);\n\t\t\tif (firstCategoryButton)\n\t\t\t{\n\t\t\t\tfirstCategoryButton.activate();\n\t\t\t}\n\n\t\t\tconst form = this.createFieldsListForm(firstCategory);\n\n\t\t\tthis.showCreateFieldButton();\n\t\t\tthis.appendForm(form);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideCreateFieldButton();\n\t\t}\n\t}\n\n\tgetSearchField(): Text\n\t{\n\t\treturn this.cache.remember('searchField', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\treturn new rootWindow.BX.Landing.UI.Field.Text({\n\t\t\t\tselector: 'search',\n\t\t\t\ttextOnly: true,\n\t\t\t\tplaceholder: Loc.getMessage('LANDING_FIELDS_PANEL_SEARCH'),\n\t\t\t\tonChange: this.onSearchChange.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSearchContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('searchLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-panel-content-element landing-ui-panel-content-search\">\n\t\t\t\t\t${this.getSearchField().getLayout()}\n\t\t\t\t\t<div class=\"landing-ui-panel-content-search-icon\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetUserFieldFactory(entityId: string)\n\t{\n\t\tconst factory = this.cache.remember(`userFieldFactory_${entityId}`, () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\tconst preparedEntityId = (() => {\n\t\t\t\tif (entityId.startsWith('DYNAMIC_'))\n\t\t\t\t{\n\t\t\t\t\treturn this.getCrmFields()[entityId].DYNAMIC_ID;\n\t\t\t\t}\n\n\t\t\t\treturn `CRM_${entityId}`;\n\t\t\t})();\n\n\t\t\treturn new rootWindow.BX.UI.UserFieldFactory.Factory(\n\t\t\t\tpreparedEntityId,\n\t\t\t\t{\n\t\t\t\t\tmoduleId: 'crm',\n\t\t\t\t\tbindElement: this.getCreateFieldButton(),\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\n\t\tif (Type.isArrayFilled(this.getAllowedTypes()))\n\t\t{\n\t\t\tfactory.types = factory.types.filter((type) => {\n\t\t\t\treturn this.getAllowedTypes().includes(type.name);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfactory.types = factory.types.filter((type) => {\n\t\t\t\treturn type.name !== 'employee';\n\t\t\t});\n\t\t}\n\n\t\treturn factory;\n\t}\n\n\tonCreateFieldClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst dictionary = this.getFormDictionary();\n\n\t\tif (\n\t\t\tType.isPlainObject(dictionary.permissions)\n\t\t\t&& Type.isPlainObject(dictionary.permissions.userField)\n\t\t\t&& dictionary.permissions.userField.add === false\n\t\t)\n\t\t{\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\trootWindow.BX.UI.Dialogs.MessageBox.alert(Loc.getMessage('LANDING_FORM_ADD_USER_FIELD_PERMISSION_DENIED'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst activeButton = this.sidebarButtons.getActive();\n\t\tconst currentCategoryId = activeButton.id;\n\n\t\tconst factory = this.getUserFieldFactory(currentCategoryId);\n\t\tconst menu = factory.getMenu();\n\n\t\tmenu.open((type) => {\n\t\t\tconst configurator = factory.getConfigurator({\n\t\t\t\tuserField: factory.createUserField(type),\n\t\t\t\tonSave: (userField) => {\n\t\t\t\t\tuserField\n\t\t\t\t\t\t.save()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\treturn this.load();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tthis.getSearchField()\n\t\t\t\t\t\t\t\t.setValue(userField.getData().editFormLabel[Loc.getMessage('LANGUAGE_ID')]);\n\t\t\t\t\t\t\tthis.showCreateFieldButton();\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t\tthis.showCreateFieldButton();\n\t\t\t\t\tthis.sidebarButtons.getActive().getLayout().click();\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.clearContent();\n\t\t\tDom.append(configurator.render(), this.content);\n\t\t\tthis.hideCreateFieldButton();\n\t\t});\n\t}\n\n\tgetCreateFieldButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('getCreateFieldButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"landing-ui-panel-content-create-field-button\"\n\t\t\t\t\tonclick=\"${this.onCreateFieldClick.bind(this)}\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('LANDING_FIELDS_PANEL_CREATE_FIELD')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetCreateFieldLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('createFieldLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-panel-content-create-field\">\n\t\t\t\t\t${this.getCreateFieldButton()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tisUserFieldEditorShowed(): boolean\n\t{\n\t\treturn Type.isDomNode(this.content.querySelector('.ui-userfieldfactory-configurator'));\n\t}\n\n\tshowCreateFieldButton()\n\t{\n\t\tDom.append(this.getCreateFieldLayout(), this.body);\n\t}\n\n\thideCreateFieldButton()\n\t{\n\t\tDom.remove(this.getCreateFieldLayout(), this.body);\n\t}\n}"],"names":["FieldsPanel","options","rootWindow","PageObject","getRootWindow","rootWindowPanel","BX","Landing","UI","Panel","instance","setEventNamespace","setLayoutClass","setOverlayClass","setTitle","Loc","getMessage","onSaveClick","bind","onCancelClick","cache","Cache","MemoryCache","Dom","append","layout","getViewContainer","overlay","insertAfter","getSearchContainer","header","getCreateFieldLayout","body","showLoader","loadPromise","load","then","hideLoader","Object","entries","getCrmFields","forEach","categoryId","category","Type","isPlainObject","isBoolean","isLeadEnabled","button","SidebarButton","id","text","CAPTION","child","onClick","onSidebarButtonClick","appendSidebarButton","appendFooterButton","BaseButton","className","attrs","title","get","mode","set","types","fields","categories","keys","key","startsWith","delete","getSearchField","input","textContent","setMultiple","setAllowedTypes","setDisabledFields","setAllowedCategories","resetFactoriesCache","isArrayFilled","disabledFields","allowedCategories","allowedTypes","multiple","sidebarButtons","show","leadButton","hide","includes","filteredFieldsTree","getFilteredFieldsTree","deactivate","getLayout","length","resetState","firstShowedButton","find","hidden","click","enableEdit","focus","Promise","resolve","promiseResolver","setCrmFields","getOriginalCrmFields","selectedFields","values","getState","reduce","acc","remember","document","querySelector","Loader","target","hideCreateFieldButton","getLoader","showCreateFieldButton","Backend","getInstance","action","result","setOriginalCrmFields","assign","FormSettingsPanel","FormClient","getDictionary","dictionary","setFormDictionary","state","activeButton","getActive","activate","hideCreateButton","getAllowedTypes","every","type","crmFields","Reflect","has","clearContent","form","createFieldsListForm","appendForm","searchString","String","getValue","toLowerCase","trim","getAllowedCategories","filteredFields","FIELDS","filter","field","fieldCaption","caption","isTypeAllowed","some","allowedType","entityFieldName","entity_field_name","isStringFilled","fieldsListTree","getDisabledFields","fieldOptions","items","map","name","value","disabled","onValueChange","checkbox","setState","FormSettingsForm","isMultiple","Field","Checkbox","Radio","firstCategory","firstCategoryButton","Text","selector","textOnly","placeholder","onChange","onSearchChange","Tag","render","entityId","factory","preparedEntityId","DYNAMIC_ID","UserFieldFactory","Factory","moduleId","bindElement","getCreateFieldButton","event","preventDefault","getFormDictionary","permissions","userField","add","Dialogs","MessageBox","alert","currentCategoryId","getUserFieldFactory","menu","getMenu","open","configurator","getConfigurator","createUserField","onSave","save","setValue","getData","editFormLabel","onCancel","content","onCreateFieldClick","isDomNode","remove","Content"],"mappings":"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"}