this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};this.BX.Landing.UI=this.BX.Landing.UI||{};(function(e,t,i,n,a,s,l,r,o,d){"use strict";var c=function(e){babelHelpers.inherits(i,e);babelHelpers.createClass(i,null,[{key:"getInstance",value:function e(t){var n=s.PageObject.getRootWindow();var a=n.BX.Landing.UI.Panel.FieldsPanel;if(!a.instance&&!i.instance){a.instance=new i(t)}var l=a.instance||i.instance;l.options=t;return l}}]);function i(){var e;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,i);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"adjustActionsPanels",false);e.setEventNamespace("BX.Landing.UI.Panel.FieldsPanel");e.setLayoutClass("landing-ui-panel-fields");e.setOverlayClass("landing-ui-panel-fields-overlay");e.setTitle(r.Loc.getMessage("LANDING_FIELDS_PANEL_TITLE"));e.onSaveClick=e.onSaveClick.bind(babelHelpers.assertThisInitialized(e));e.onCancelClick=e.onCancelClick.bind(babelHelpers.assertThisInitialized(e));e.options=n;e.cache=new t.Cache.MemoryCache;t.Dom.append(e.layout,e.getViewContainer());t.Dom.append(e.overlay,e.getViewContainer());e.showLoader();e.loadPromise=e.load().then(function(){e.hideLoader();Object.entries(e.getCrmFields()).forEach(function(i){var a=babelHelpers.slicedToArray(i,2),s=a[0],r=a[1];if(s!=="CATALOG"&&s!=="ACTIVITY"&&s!=="INVOICE"){if(t.Type.isPlainObject(n)&&t.Type.isBoolean(n.isLeadEnabled)&&!n.isLeadEnabled&&s==="LEAD"){return}var o=new l.SidebarButton({id:s,text:r.CAPTION,child:true,onClick:function t(){e.onSidebarButtonClick(o)}});e.appendSidebarButton(o)}});e.sidebarButtons[0].getLayout().click();e.appendFooterButton(new d.BaseButton("save_settings",{text:r.Loc.getMessage("BLOCK_SAVE"),onClick:e.onSaveClick,className:"landing-ui-button-content-save",attrs:{title:r.Loc.getMessage("LANDING_TITLE_OF_SLIDER_SAVE")}}));e.appendFooterButton(new d.BaseButton("cancel_settings",{text:r.Loc.getMessage("BLOCK_CANCEL"),onClick:e.onCancelClick,className:"landing-ui-button-content-cancel",attrs:{title:r.Loc.getMessage("LANDING_TITLE_OF_SLIDER_CANCEL")}}))});return e}babelHelpers.createClass(i,[{key:"show",value:function e(){var n=this;var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.disabledFields=[];if(t.Type.isArrayFilled(a.disabledFields)){this.disabledFields=a.disabledFields}this.loadPromise.then(function(){if(t.Type.isArray(a.allowedTypes)){n.originalCrmFields=n.getCrmFields();var e=t.Runtime.clone(n.originalCrmFields);var i=Object.entries(e).reduce(function(e,i){var n=babelHelpers.slicedToArray(i,2),s=n[0],l=n[1];var r=l.FIELDS.filter(function(e){return a.allowedTypes.includes(e.type)});if(t.Type.isArrayFilled(r)){e[s]=babelHelpers.objectSpread({},l,{FIELDS:r})}return e},{});n.setCrmFields(i)}n.sidebarButtons.forEach(function(e){t.Dom.show(e.layout)});if(a.isLeadEnabled===false){var s=n.sidebarButtons.get("LEAD");if(s){t.Dom.hide(s.layout)}}if(t.Type.isArrayFilled(a.allowedCategories)){n.sidebarButtons.forEach(function(e){if(!a.allowedCategories.includes(e.id)){t.Dom.hide(e.layout)}})}if(n.sidebarButtons.length>0){n.resetState();n.sidebarButtons[0].getLayout().click()}});void babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"show",this).call(this,a);return new Promise(function(e){n.promiseResolver=e})}},{key:"hide",value:function e(){if(t.Type.isArrayFilled(this.originalCrmFields)){this.setCrmFields(this.originalCrmFields);delete this.originalCrmFields}return babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"hide",this).call(this)}},{key:"onSaveClick",value:function e(){var t=Object.values(this.getState()).reduce(function(e,t){return[].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(t))},[]);this.promiseResolver(t);void this.hide();this.resetState()}},{key:"onCancelClick",value:function e(){void this.hide();this.resetState()}},{key:"getViewContainer",value:function e(){return this.cache.remember("viewContainer",function(){var e=s.PageObject.getRootWindow();return e.document.querySelector(".landing-ui-view-container")})}},{key:"getLoader",value:function e(){var t=this;return this.cache.remember("loader",function(){return new n.Loader({target:t.body})})}},{key:"showLoader",value:function e(){void this.getLoader().show()}},{key:"hideLoader",value:function e(){void this.getLoader().hide()}},{key:"load",value:function e(){var t=this;return a.Backend.getInstance().action("Form::getCrmFields").then(function(e){t.setCrmFields(e)})}},{key:"setCrmFields",value:function e(t){this.cache.set("fields",t)}},{key:"getCrmFields",value:function e(){return this.cache.get("fields")||{}}},{key:"setState",value:function e(t){this.cache.set("state",t)}},{key:"getState",value:function e(){return this.cache.get("state")||{}}},{key:"resetState",value:function e(){this.cache.delete("state")}},{key:"onSidebarButtonClick",value:function e(t){var i=this;var n=this.sidebarButtons.getActive();if(n){n.deactivate()}t.activate();var a=this.getCrmFields();if(Reflect.has(a,t.id)){this.clearContent();var s=a[t.id].FIELDS;var l=new o.FormSettingsForm({fields:[new BX.Landing.UI.Field.Checkbox({items:s.map(function(e){return{name:e.caption,value:e.name,disabled:i.disabledFields.includes(e.name)}}),value:this.getState()[t.id]||[],onValueChange:function e(n){var a=babelHelpers.objectSpread({},i.getState());a[t.id]=n.getValue();i.setState(a)}})]});this.appendForm(l)}}}]);return i}(i.Content);e.FieldsPanel=c})(this.BX.Landing.UI.Panel=this.BX.Landing.UI.Panel||{},BX,BX.Landing.UI.Panel,BX,BX.Landing,BX.Landing,BX.Landing.UI.Button,BX.Landing,BX.Landing.UI.Form,BX.Landing.UI.Button);
//# sourceMappingURL=fieldspanel.bundle.map.js