this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};this.BX.Landing.UI=this.BX.Landing.UI||{};(function(e,t,n,i,a,s,r,o,l,c,u,d,g,p,m,h,_,T,f,E,I,L,b,v,N,S,y,F,C,D,A,O,M){"use strict";var R="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/header-and-buttons/images/header-and-buttons-message-icon.svg";var k=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.HeaderAndButtonContent");var i=new b.HeaderCard({title:D.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_TITLE")});var a=new L.MessageCard({id:"headerAndButtonMessage",icon:R,header:D.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_MESSAGE_HEADER"),description:D.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_MESSAGE_DESCRIPTION_2"),restoreState:true,more:function e(){var t=D.Reflection.getClass("top.BX.Helper");if(t){BX.Helper.show("redirect=detail&code=12802786")}}});var s=new v.FormSettingsForm({id:"headers",title:D.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_HEADERS_FORM_TITLE"),toggleable:true,fields:[new m.VariablesField({selector:"title",title:D.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_HEADERS_FORM_HEADER_FIELD_TITLE"),textOnly:true,content:n.options.values.title,variables:n.options.personalizationVariables}),new m.VariablesField({selector:"desc",title:D.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_HEADERS_FORM_SUBHEADER_FIELD_TITLE"),textOnly:true,content:n.options.values.desc,variables:n.options.personalizationVariables}),new BX.Landing.UI.Field.Checkbox({selector:"hideDesc",items:[{value:"hideDesc",name:D.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_HEADERS_FORM_HIDE_SUBHEADER_FIELD_TITLE")}],compact:true})]});var r=new v.FormSettingsForm({id:"buttons",title:D.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_BUTTONS_FORM_TITLE"),fields:[new N.TextField({selector:"buttonCaption",title:D.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_BUTTONS_FORM_SEND_BUTTON_TITLE"),textOnly:true,content:n.options.values.buttonCaption})]});n.addItem(i);n.addItem(a);n.addItem(s);n.addItem(r);return n}babelHelpers.createClass(t,[{key:"valueReducer",value:function e(t){var n=Object.entries(t).reduce(function(e,t){var n=babelHelpers.slicedToArray(t,2),i=n[0],a=n[1];if(i==="hideDesc"){if(a.includes(i)){e.desc=""}delete e.hideDesc}if(i==="useSign"){e.useSign=a.includes("useSign")}return e},babelHelpers.objectSpread({},t));if(!this.items[2].getSwitch().getValue()){n.title="";n.desc=""}return n}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var B="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/agreements/images/message-icon.svg";var P=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.AgreementsContent");var i=new b.HeaderCard({title:O.Loc.getMessage("LANDING_AGREEMENTS_TITLE")});var a=new L.MessageCard({id:"agreementsMessage",header:O.Loc.getMessage("LANDING_AGREEMENTS_MESSAGE_HEADER"),description:O.Loc.getMessage("LANDING_AGREEMENTS_MESSAGE_DESCRIPTION"),icon:B,restoreState:true});var s=new v.FormSettingsForm({id:"agreementsList",fields:[new o.AgreementsList({selector:"agreements",formOptions:n.options.formOptions,agreementsList:n.options.agreementsList,value:n.options.values.agreements})]});if(!a.isShown()){D.Dom.style(i.getLayout(),"margin-bottom","0");D.Dom.style(s.getLayout(),"margin-top","-19px")}a.subscribe("onClose",function(){D.Dom.style(i.getLayout(),"margin-bottom","0");D.Dom.style(s.getLayout(),"margin-top","-19px")});n.addItem(i);n.addItem(a);n.addItem(s);return n}return t}(M.ContentWrapper);var G=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.SpamProtection");var i=new b.HeaderCard({title:O.Loc.getMessage("LANDING_SPAM_PROTECTION_TITLE")});var a=new v.FormSettingsForm({id:"type",description:null,fields:[new _.RadioButtonField({selector:"use",title:O.Loc.getMessage("LANDING_SPAM_PROTECTION_TABS_TITLE"),value:n.options.values.use?"hidden":"disabled",items:[{id:"disabled",title:O.Loc.getMessage("LANDING_SPAM_PROTECTION_TAB_DISABLED"),icon:"landing-ui-spam-protection-icon-disabled"},{id:"hidden",title:O.Loc.getMessage("LANDING_SPAM_PROTECTION_TAB_HIDDEN"),icon:"landing-ui-spam-protection-icon-hidden"}]})]});n.addItem(i);n.addItem(a);n.addItem(n.getKeysCheckbox());n.addItem(n.getKeysForm());var s=n.options.values.key&&n.options.values.secret;if(a.fields[0].getValue()==="disabled"){n.hideKeysCheckbox();n.hideKeysForm()}else{n.showKeysCheckbox();n.getKeysCheckbox().fields[0].setValue([s?"useCustomKeys":""]);if(s){n.showKeysForm()}else{n.hideKeysForm()}}a.subscribe("onChange",function(){if(a.fields[0].getValue()==="disabled"){n.hideKeysCheckbox();n.hideKeysForm()}else{n.showKeysCheckbox();n.getKeysCheckbox().fields[0].setValue([s?"useCustomKeys":""]);if(s){n.showKeysForm()}else{n.hideKeysForm()}}});n.getKeysCheckbox().subscribe("onChange",function(){if(n.getKeysCheckbox().fields[0].getValue().includes("useCustomKeys")){n.showKeysForm()}else{n.hideKeysForm()}});return n}babelHelpers.createClass(t,[{key:"getKeysCheckbox",value:function e(){return this.cache.remember("keysCheckbox",function(){return new v.FormSettingsForm({id:"customKeys",description:null,fields:[new BX.Landing.UI.Field.Checkbox({selector:"useCustomKeys",items:[{name:O.Loc.getMessage("LANDING_SPAM_PROTECTION_CUSTOM_KEYS_CHECKBOX_LABEL"),value:"useCustomKeys"}]})]})})}},{key:"showKeysCheckbox",value:function e(){this.getKeysCheckbox().getLayout().hidden=false}},{key:"hideKeysCheckbox",value:function e(){this.getKeysCheckbox().getLayout().hidden=true}},{key:"getKeysForm",value:function e(){var t=this;return this.cache.remember("keysForm",function(){return new v.FormSettingsForm({id:"keys",title:O.Loc.getMessage("LANDING_SPAM_PROTECTION_KEYS_FORM_TITLE"),help:{text:O.Loc.getMessage("LANDING_SPAM_PROTECTION_KEYS_FORM_HELP_TEXT"),href:O.Loc.getMessage("LANDING_SPAM_PROTECTION_KEYS_FORM_HELP_HREF")},fields:[new N.TextField({selector:"key",title:O.Loc.getMessage("LANDING_SPAM_PROTECTION_RECAPTCHA_KEY_FIELD_TITLE"),textOnly:true,content:t.options.values.key}),new N.TextField({selector:"secret",title:O.Loc.getMessage("LANDING_SPAM_PROTECTION_RECAPTCHA_SECRET_KEY_FIELD_TITLE"),textOnly:true,content:t.options.values.secret})]})})}},{key:"showKeysForm",value:function e(){this.getKeysForm().getLayout().hidden=false}},{key:"hideKeysForm",value:function e(){this.getKeysForm().getLayout().hidden=true}},{key:"valueReducer",value:function e(t){var n=t.useCustomKeys.length>0;return{recaptcha:{use:t.use==="hidden",key:n?t.key:"",secret:n?t.secret:""}}}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var H="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/analytics/images/yandex.svg";var w="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/analytics/images/google.svg";function U(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="landing-ui-content-table-cell">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);U=function t(){return e};return e}var x=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);this.options=babelHelpers.objectSpread({},t)}babelHelpers.createClass(e,[{key:"render",value:function e(){return D.Tag.render(U(),this.options.content)}}]);return e}();function X(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="landing-ui-content-table-row','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);X=function t(){return e};return e}var K=function(){function e(t){babelHelpers.classCallCheck(this,e);this.options=babelHelpers.objectSpread({},t)}babelHelpers.createClass(e,[{key:"render",value:function e(){var t=this.options.head?" landing-ui-content-table-row-head":"";return D.Tag.render(X(),t,this.options.columns.map(function(e){return e.render()}))}}]);return e}();function V(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="landing-ui-content-table-wrapper">\n\t\t\t\t\n\t\t\t\t<div class="landing-ui-content-table">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);V=function t(){return e};return e}function Y(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-content-table-title">',"</div>\n\t\t\t"]);Y=function t(){return e};return e}var j=function(){function e(t){babelHelpers.classCallCheck(this,e);this.options=babelHelpers.objectSpread({},t);this.headRow=new K({columns:this.options.columns.map(function(e){return new x(e)}),head:true});this.rows=this.options.rows.map(function(e){return new K({columns:e.columns.map(function(e){return new x(e)})})})}babelHelpers.createClass(e,[{key:"getTitleLayout",value:function e(){if(Type.isStringFilled(this.options.title)){return D.Tag.render(Y(),this.options.title)}return""}},{key:"render",value:function e(){return D.Tag.render(V(),this.headRow.render(),this.rows.map(function(e){return e.render()}))}}]);return e}();var W=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.AgreementsContent");var i=new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_TITLE")});var a=[];if(O.Loc.getMessage("LANGUAGE_ID")==="ru"){a.push({id:"yandex",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_ITEM_YANDEX_METRIKA"),icon:H,checked:true,switcher:false,content:n.getYandexTable()})}a.push({id:"google",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_ITEM_GOOGLE_ANALYTICS"),icon:w,checked:true,switcher:false,content:n.getGoogleTable()});var s=new l.AccordionField({selector:"analytics",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_ITEMS_FIELD_TITLE"),items:a});var r=new L.MessageCard({id:"analyticsMessage",header:O.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_MESSAGE_TITLE"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_MESSAGE_DESCRIPTION"),angle:false,restoreState:true});n.addItem(i);n.addItem(r);n.addItem(s);return n}babelHelpers.createClass(t,[{key:"getYandexTable",value:function e(){var t=new j({columns:[{id:"title",content:O.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_TABLE_NAME_COLUMN_TITLE")},{id:"id",content:O.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_TABLE_ID_COLUMN_TITLE")}],rows:this.options.events.map(function(e){return{columns:[{content:e.name},{content:e.event}]}})});return t.render()}},{key:"getGoogleTable",value:function e(){var t=new j({columns:[{id:"title",content:O.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_TABLE_NAME_COLUMN_TITLE")},{id:"id",content:O.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_TABLE_ID_COLUMN_TITLE")}],rows:this.options.events.map(function(e){return{columns:[{content:e.name},{content:e.code}]}})});return t.render()}}]);return t}(M.ContentWrapper);var z="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/fields/images/message-icon.svg";var Z=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.FieldsContent");var i=new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_FIELDS_TITLE")});var a=new L.MessageCard({id:"fieldsMessage",header:O.Loc.getMessage("LANDING_FORM_SETTINGS_FIELDS_MESSAGE_TITLE"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_FIELDS_MESSAGE_DESCRIPTION"),icon:z,restoreState:true});var s=new v.FormSettingsForm({fields:[new c.FieldsListField({selector:"fields",isLeadEnabled:n.options.isLeadEnabled,dictionary:n.options.dictionary,formOptions:babelHelpers.objectSpread({},n.options.formOptions),crmFields:babelHelpers.objectSpread({},n.options.crmFields),items:babelHelpers.toConsumableArray(n.options.values.fields)})]});if(!a.isShown()){s.setOffsetTop(-36)}a.subscribe("onClose",function(){s.setOffsetTop(-36)});n.addItem(i);n.addItem(a);n.addItem(s);return n}return t}(M.ContentWrapper);var q=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.FieldsRulesContent");n.addItem(n.getHeader());if(!Object.keys(n.options.values).length>0){n.addItem(n.getRuleTypeField())}else{n.addItem(n.getRulesForm());n.addItem(n.getActionPanel());var i=n.options.values.reduce(function(e,t){t.list.forEach(function(t){var i=e.find(function(e){return(e.condition.field===t.condition.target||e.condition.field.id===t.condition.target)&&e.condition.value===t.condition.value&&e.condition.operator===t.condition.operation});if(i){i.expression.push({field:n.options.fields.find(function(e){return e.id===t.action.target}),action:t.action.type})}else{e.push({condition:{field:n.options.fields.find(function(e){return e.name===t.condition.target}),value:t.condition.value,operator:t.condition.operation},expression:[{field:n.options.fields.find(function(e){return e.name===t.action.target}),action:t.action.type}]})}});return e},[]);n.getRulesForm().addField(new u.RuleField({fields:n.getFormFields(),rules:i,onRemove:n.onFieldRemove.bind(babelHelpers.assertThisInitialized(n)),dictionary:n.options.dictionary}))}return n}babelHelpers.createClass(t,[{key:"getFormFields",value:function e(){var t=this;var n=function(){if(!D.Type.isPlainObject(t.options.dictionary.deps.field)||!D.Type.isArrayFilled(t.options.dictionary.deps.field.disallowed)){return null}return t.options.dictionary.deps.field.disallowed}();return this.options.fields.filter(function(e){return!D.Type.isArrayFilled(n)||!n.includes(e.type)&&(!D.Type.isPlainObject(e.content)||n.includes(e.content.type))})}},{key:"onFieldRemove",value:function e(t){this.getRulesForm().removeField(t.getTarget());this.clear();var n=this.getHeader();n.setBottomMargin(true);this.addItem(n);this.addItem(this.getRuleTypeField())}},{key:"getRulesForm",value:function e(){return this.cache.remember("rulesForm",function(){return new v.FormSettingsForm({selector:"dependencies",description:null})})}},{key:"getActionPanel",value:function e(){return this.cache.remember("actionPanel",function(){return new d.ActionPanel({left:[]})})}},{key:"getHeader",value:function e(){return this.cache.remember("headerCard",function(){return new b.HeaderCard({title:D.Loc.getMessage("LANDING_FIELDS_RULES_TITLE")})})}},{key:"onCreateRule",value:function e(){this.clear();var t=this.getHeader();t.setBottomMargin(false);this.addItem(t);var n=this.getRulesForm();n.addField(new u.RuleField({fields:this.getFormFields(),rules:[],onRemove:this.onFieldRemove.bind(this),dictionary:this.options.dictionary}));this.addItem(n);this.addItem(this.getActionPanel())}},{key:"getRuleTypeField",value:function e(){var t=this;return this.cache.remember("ruleTypeField",function(){return new _.RadioButtonField({selector:"rules-type",items:[{id:"type1",icon:"landing-ui-rules-type1-icon",title:D.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_1"),button:{text:D.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_BUTTON"),onClick:t.onCreateRule.bind(t)}},{id:"type2",icon:"landing-ui-rules-type2-icon",title:D.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_2"),button:{text:D.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_BUTTON"),onClick:t.onCreateRule.bind(t)},disabled:true,soon:true},{id:"type3",icon:"landing-ui-rules-type3-icon",title:D.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_3"),button:{text:D.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_BUTTON"),onClick:t.onCreateRule.bind(t)},disabled:true,soon:true}]})})}},{key:"onAddRuleClick",value:function e(){var t=this.getRuleTypeField();this.insertBefore(t,this.items[this.items.length-1])}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}},{key:"valueReducer",value:function e(t){return{dependencies:Object.values(t).map(function(e){return{typeId:0,list:e.reduce(function(e,t){t.forEach(function(t){t.expression.forEach(function(n){e.push({condition:{target:t.condition.field,event:"change",value:t.condition.value,operation:t.condition.operator},action:{target:n.field,type:n.action,value:""}})})});return e},[])}})}}}]);return t}(M.ContentWrapper);function Q(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="'," ","-",'">\n\t\t\t\t<div class="','-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="','-inner">\n\t\t\t\t\t<div class="','-header">\n\t\t\t\t\t\t<span class="','-header-view" onclick="','">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="','-icon"></div>\n\t\t\t\t\t<div class="','-text" onclick="','" oninput="','">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="','-footer">\n\t\t\t\t\t\t<span class="','-footer-edit" onclick="','">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Q=function t(){return e};return e}var $=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Field.ActionPagesField");n.subscribeFromOptions(g.fetchEventsFromOptions(e));n.setLayoutClass("landing-ui-field-action-pages");D.Dom.append(n.getSuccess(),n.input);D.Dom.append(n.getFailure(),n.input);D.Event.bind(document,"click",n.onDocumentClick.bind(babelHelpers.assertThisInitialized(n)));D.Event.bind(window.top.document,"click",n.onDocumentClick.bind(babelHelpers.assertThisInitialized(n)));return n}babelHelpers.createClass(t,[{key:"onDocumentClick",value:function e(){var t=this.getSuccess().querySelector(".landing-ui-field-action-pages-page-text");var n=this.getFailure().querySelector(".landing-ui-field-action-pages-page-text");D.Dom.attr(t,"contenteditable",null);D.Dom.attr(n,"contenteditable",null)}},{key:"getSuccess",value:function e(){var n=this;return this.cache.remember("success",function(){return t.createPageBlock({type:"success",title:O.Loc.getMessage("LANDING_FORM_ACTIONS_EDIT_SUCCESS_PAGE_TITLE"),text:n.options.successText,onInput:function e(){n.emit("onChange")},onShowClick:function e(){n.emit("onShowSuccess")}})})}},{key:"getFailure",value:function e(){var n=this;return this.cache.remember("failure",function(){return t.createPageBlock({type:"failure",title:O.Loc.getMessage("LANDING_FORM_ACTIONS_EDIT_FAILURE_PAGE_TITLE"),text:n.options.failureText,onInput:function e(){n.emit("onChange")},onShowClick:function e(){n.emit("onShowFailure")}})})}},{key:"getSuccessText",value:function e(){return this.getSuccess().querySelector(".landing-ui-field-action-pages-page-text").innerText}},{key:"getFailureText",value:function e(){return this.getFailure().querySelector(".landing-ui-field-action-pages-page-text").innerText}},{key:"getValue",value:function e(){return{success:this.getSuccessText(),failure:this.getFailureText()}}}],[{key:"createPageBlock",value:function e(t){var n="landing-ui-field-action-pages-page";var i=function e(i){i.preventDefault();i.stopPropagation();var a=i.currentTarget.closest(".".concat(n,"-inner"));var s=a.querySelector(".".concat(n,"-text"));D.Dom.attr(s,"contenteditable",!s.isContentEditable);if(D.Type.isFunction(t.onEditClick)){t.onEditClick(i)}};var a=function e(t){t.stopPropagation()};var s=function e(n){n.preventDefault();if(D.Type.isFunction(t.onShowClick)){t.onShowClick(n)}};return D.Tag.render(Q(),n,n,t.type,n,t.title,n,n,n,s,O.Loc.getMessage("LANDING_FORM_ACTIONS_EDIT_PAGE_SHOW"),n,n,a,t.onInput,D.Text.encode(t.text),n,n,i,O.Loc.getMessage("LANDING_FORM_ACTIONS_EDIT_PAGE_EDIT"))}}]);return t}(y.BaseField);var J="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/actions/images/type1.svg";var ee="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/actions/images/type2.svg";var te=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.ActionsContent");D.Dom.addClass(n.getLayout(),"landing-ui-actions-content-wrapper");n.addItem(n.getHeader());n.addItem(n.getTypeButtons());n.getActionPages().subscribe("onShowSuccess",function(){n.emit("onShowSuccess")}).subscribe("onShowFailure",function(){n.emit("onShowFailure")});return n}babelHelpers.createClass(t,[{key:"getHeader",value:function e(){return this.cache.remember("header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_ACTIONS_TITLE")})})}},{key:"getTypeButtons",value:function e(){var t=this;return this.cache.remember("typeButtons",function(){return new _.RadioButtonField({selectable:true,value:function(){if(D.Type.isStringFilled(t.options.values.success.url)&&D.Type.isStringFilled(t.options.values.failure.url)){return"type2"}return"type1"}(),items:[{id:"type1",title:O.Loc.getMessage("LANDING_FORM_ACTIONS_TYPE_1"),icon:"landing-ui-form-actions-type1"},{id:"type2",title:O.Loc.getMessage("LANDING_FORM_ACTIONS_TYPE_2"),icon:"landing-ui-form-actions-type2"}],onChange:t.onTypeChange.bind(t)})})}},{key:"getCheckbox",value:function e(){return this.cache.remember("checkbox",function(){return new BX.Landing.UI.Field.Checkbox({items:[{name:O.Loc.getMessage("LANDING_FORM_ACTIONS_CHECKBOX_TITLE"),value:true}]})})}},{key:"getTypeDropdown",value:function e(){var t=this;return this.cache.remember("typeDropdown",function(){var e=new p.PresetField({events:{onClick:function e(){t.clear();t.addItem(t.getHeader());t.addItem(t.getTypeButtons())}}});e.setTitle(O.Loc.getMessage("LANDING_FORM_ACTIONS_TYPE_DROPDOWN_TITLE"));e.setIcon(J);return e})}},{key:"getSuccessLinkField",value:function e(){var t=this;return this.cache.remember("successLinkField",function(){return new N.TextField({title:O.Loc.getMessage("LANDING_FORM_ACTIONS_SUCCESS_FIELD_TITLE"),placeholder:"http://",textOnly:true,content:t.options.values.success.url,onInput:t.onChange.bind(t)})})}},{key:"getFailureLinkField",value:function e(){var t=this;return this.cache.remember("failureLinkField",function(){return new N.TextField({title:O.Loc.getMessage("LANDING_FORM_ACTIONS_FAILURE_FIELD_TITLE"),placeholder:"http://",textOnly:true,content:t.options.values.failure.url,onInput:t.onChange.bind(t)})})}},{key:"getDelayField",value:function e(){var t=this;return this.cache.remember("delayField",function(){return new BX.Landing.UI.Field.Dropdown({selector:"redirectDelay",title:O.Loc.getMessage("LANDING_FORM_ACTIONS_DELAY_TITLE"),content:t.options.values.redirectDelay,items:Array.from({length:11},function(e,t){return{name:"".concat(t," ").concat(O.Loc.getMessage("LANDING_FORM_ACTIONS_DELAY_ITEM")),value:t}})})})}},{key:"onChange",value:function e(){this.emit("onChange",{skipPrepare:true})}},{key:"getActionPages",value:function e(){var t=this;return this.cache.remember("actionPages",function(){return new $({successText:t.options.values.success.text,failureText:t.options.values.failure.text,onChange:t.onChange.bind(t)})})}},{key:"onTypeChange",value:function e(t){var n=t.getData();var i=this.getTypeDropdown();this.clear();this.addItem(this.getHeader());this.addItem(i);i.setLinkText(n.item.title.replace(/&nbsp;/," "));if(n.item.id==="type1"){i.setIcon(J);this.addItem(this.getActionPages())}if(n.item.id==="type2"){i.setIcon(ee);this.addItem(this.getSuccessLinkField());this.addItem(this.getFailureLinkField());this.addItem(this.getDelayField())}}},{key:"getValue",value:function e(){var t=this.getActionPages().getValue();var n=this.getTypeButtons().getValue()==="type2";return{result:{success:{text:t.success,url:n?D.Text.decode(this.getSuccessLinkField().getValue()):""},failure:{text:t.failure,url:n?D.Text.decode(this.getFailureLinkField().getValue()):""},redirectDelay:this.getDelayField().getValue()}}}}]);return t}(M.ContentWrapper);function ne(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-field-embed-header">\n\t\t\t\t\t<div class="landing-ui-field-embed-header-button">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);ne=function t(){return e};return e}var ie=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Field.EmbedField");n.setLayoutClass("landing-ui-field-embed");D.Dom.clean(n.layout);D.Dom.append(n.getHeader(),n.layout);D.Dom.append(n.input,n.layout);D.Event.bind(n.input,"click",n.onInputClick.bind(babelHelpers.assertThisInitialized(n)));return n}babelHelpers.createClass(t,[{key:"getCopyButton",value:function e(){var t=this;return this.cache.remember("copyButton",function(){return new f.Button({text:O.Loc.getMessage("LANDING_FORM_EMBED_COPY_BUTTON_LABEL"),size:f.Button.Size.SMALL,color:f.Button.Color.PRIMARY,onclick:t.onCopyButtonClick.bind(t)})})}},{key:"onCopyButtonClick",value:function e(){this.selectCode();var t=C.PageObject.getRootWindow();t.document.execCommand("copy");t.getSelection().removeAllRanges();var n=this.getCopyButton();n.setColor(f.Button.Color.LINK);n.setIcon(f.Button.Icon.DONE);n.setText(O.Loc.getMessage("LANDING_FORM_EMBED_COPIED_BUTTON_LABEL"));D.Dom.addClass(this.getHeader(),"landing-ui-field-embed-header-copied")}},{key:"onInputClick",value:function e(t){t.preventDefault();this.selectCode()}},{key:"selectCode",value:function e(){C.PageObject.getRootWindow().getSelection().selectAllChildren(this.input)}},{key:"getHeader",value:function e(){var t=this;return this.cache.remember("header",function(){return D.Tag.render(ne(),t.getCopyButton().render())})}},{key:"setValue",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";this.input.innerHTML=D.Text.encode(t)}}]);return t}(y.BaseField);function ae(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-filed-widget-wrapper">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);ae=function t(){return e};return e}var se=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Filed.WidgetField");n.setLayoutClass("landing-ui-filed-widget");D.Dom.append(n.getInputWrapper(),n.layout);return n}babelHelpers.createClass(t,[{key:"getInputWrapper",value:function e(){var t=this;return this.cache.remember("inputWrapper",function(){return D.Tag.render(ae(),t.input,t.getSettingsButton().render())})}},{key:"getSettingsButton",value:function e(){return this.cache.remember("settingsButton",function(){return new f.Button({text:O.Loc.getMessage("LANDING_FORM_EMBED_WIDGET_BUTTON_LABEL"),color:f.Button.Color.LIGHT_BORDER,icon:f.Button.Icon.SETTING})})}}]);return t}(y.BaseField);function re(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-field-copy-link-preview">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);re=function t(){return e};return e}var oe=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setLayoutClass("landing-ui-field-copy-link");D.Dom.clean(n.layout);D.Dom.append(n.getLink(),n.layout);D.Dom.append(n.getCopyButton().render(),n.layout);return n}babelHelpers.createClass(t,[{key:"getLink",value:function e(){var t=this;return this.cache.remember("link",function(){var e=new h.Link({text:t.options.link,href:t.options.link,target:"_blank"});return D.Tag.render(re(),e.getLayout())})}},{key:"getCopyButton",value:function e(){var t=this;return this.cache.remember("copyButton",function(){return new f.Button({color:f.Button.Color.PRIMARY,size:f.Button.Size.SMALL,text:O.Loc.getMessage("LANDING_FORM_EMBED_PUB_COPY_LINK_BUTTON_LABEL"),onclick:t.onCopyButtonClick.bind(t)})})}},{key:"selectCode",value:function e(){C.PageObject.getRootWindow().getSelection().selectAllChildren(this.getLink())}},{key:"onCopyButtonClick",value:function e(){this.selectCode();var t=C.PageObject.getRootWindow();t.document.execCommand("copy");t.getSelection().removeAllRanges();var n=this.getCopyButton();n.setColor(f.Button.Color.LINK);n.setIcon(f.Button.Icon.DONE);n.setText(O.Loc.getMessage("LANDING_FORM_EMBED_PUB_COPIED_LINK_BUTTON_LABEL"))}}]);return t}(y.BaseField);function le(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-position-fields-inner"></div>\n\t\t\t']);le=function t(){return e};return e}var ce=function(e){babelHelpers.inherits(t,e);function t(){var e;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,n));e.horizontal=new BX.Landing.UI.Field.Dropdown({selector:"horizontal",content:n.value.horizontal,items:[{name:O.Loc.getMessage("LANDING_FORM_EMBED_POSITION_LEFT"),value:"left"},{name:O.Loc.getMessage("LANDING_FORM_EMBED_POSITION_CENTER"),value:"center"},{name:O.Loc.getMessage("LANDING_FORM_EMBED_POSITION_RIGHT"),value:"right"}]});e.vertical=new BX.Landing.UI.Field.Dropdown({selector:"vertical",content:n.value.vertical,items:[{name:O.Loc.getMessage("LANDING_FORM_EMBED_POSITION_TOP"),value:"top"},{name:O.Loc.getMessage("LANDING_FORM_EMBED_POSITION_BOTTOM"),value:"bottom"}]});e.horizontal.subscribe("onChange",function(){e.emit("onChange")});e.vertical.subscribe("onChange",function(){e.emit("onChange")});var i=e.getFieldsInner();D.Dom.append(e.horizontal.getLayout(),i);D.Dom.append(e.vertical.getLayout(),i);D.Dom.replace(e.input,i);return e}babelHelpers.createClass(t,[{key:"getFieldsInner",value:function e(){return this.cache.remember("fieldsInner",function(){return D.Tag.render(le())})}},{key:"getValue",value:function e(){return{vertical:this.vertical.getValue(),horizontal:this.horizontal.getValue()}}},{key:"setValue",value:function e(t){this.vertical.setValue(t.vertical);this.horizontal.setValue(t.horizontal)}}]);return t}(y.BaseField);var ue="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type1.svg";var de="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type2.svg";var ge="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type3.svg";var pe="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type4.svg";var me="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type5.svg";var he="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type6.svg";var _e=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.EmbedContent");D.Dom.addClass(n.getLayout(),"landing-ui-embed-content-wrapper");n.addItem(n.getHeader());n.addItem(n.getTypeButtons());return n}babelHelpers.createClass(t,[{key:"getHeader",value:function e(){return this.cache.remember("header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_EMBED_TITLE")})})}},{key:"getTypeButtons",value:function e(){var t=this;return this.cache.remember("typeButtons",function(){return new _.RadioButtonField({title:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_FIELD_TITLE"),items:[1,3,4,2,5,6].map(function(e){return{id:"type".concat(e),title:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_".concat(e)),icon:"landing-ui-form-embed-type".concat(e),soon:[2,5,6].includes(e),disabled:[2,5,6].includes(e)}}),onChange:t.onTypeChange.bind(t),selectable:false})})}},{key:"getTypeDropdown",value:function e(){var t=this;return this.cache.remember("typeDropdown",function(){var e=new p.PresetField({events:{onClick:function e(){t.clear();t.addItem(t.getHeader());t.addItem(t.getTypeButtons())}}});e.setTitle(O.Loc.getMessage("LANDING_FORM_ACTIONS_TYPE_DROPDOWN_TITLE"));return e})}},{key:"getType1Message",value:function e(){return this.cache.remember("type1Message",function(){return new L.MessageCard({header:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_1_MESSAGE_TITLE"),description:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_1_MESSAGE_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"getType3Message",value:function e(){return this.cache.remember("type3Message",function(){return new L.MessageCard({header:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_3_MESSAGE_TITLE"),description:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_3_MESSAGE_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"getType4Message",value:function e(){return this.cache.remember("type4Message",function(){return new L.MessageCard({header:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_4_MESSAGE_TITLE"),description:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_4_MESSAGE_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"getType5Message",value:function e(){return this.cache.remember("type5Message",function(){return new L.MessageCard({header:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_4_MESSAGE_TITLE"),description:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_4_MESSAGE_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"getType8Message",value:function e(){return this.cache.remember("type8Message",function(){return new L.MessageCard({header:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_8_MESSAGE_TITLE"),description:O.Loc.getMessage("LANDING_FORM_EMBED_TYPE_8_MESSAGE_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"getEmbedField",value:function e(){return this.cache.remember("embedField",function(){return new ie({})})}},{key:"getType2Header",value:function e(){return this.cache.remember("type2header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_EMBED_LINK_SETTINGS_HEADER"),level:2})})}},{key:"getType3Header",value:function e(){return this.cache.remember("type3header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_EMBED_CLICK_SETTINGS_HEADER"),level:2,description:O.Loc.getMessage("LANDING_FORM_EMBED_SHOW_SETTINGS_DESCRIPTION")})})}},{key:"getType4Header",value:function e(){return this.cache.remember("type4header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_EMBED_AUTO_SHOW_SETTINGS_HEADER"),level:2,description:O.Loc.getMessage("LANDING_FORM_EMBED_SHOW_SETTINGS_DESCRIPTION")})})}},{key:"getLinkTextField",value:function e(){return this.cache.remember("linkTextField",function(){return new m.VariablesField({title:O.Loc.getMessage("LANDING_FORM_EMBED_LINK_TEXT_SETTINGS_FIELD_TITLE"),variables:[{name:"Test",value:"test"}]})})}},{key:"getType4Checkbox",value:function e(){var t=this;return this.cache.remember("type4checkbox",function(){var e=new BX.Landing.UI.Field.Radio({items:[{name:O.Loc.getMessage("LANDING_FORM_EMBED_SHOW_AFTER_PAGE_LOADED"),value:"pageLoaded"},{html:O.Loc.getMessage("LANDING_FORM_EMBED_SHOW_AFTER_TIME"),value:"afterTime"}],value:function(){if(t.options.values.views.auto.delay>0){return["afterTime"]}return["pageLoaded"]}()});D.Dom.replace(e.layout.querySelector(".delay_time"),t.getDelayDropdown().getLayout());return e})}},{key:"getWidgetField",value:function e(){return this.cache.remember("widgetField",function(){return new se({title:O.Loc.getMessage("LANDING_FORM_EMBED_WIDGET_FIELD_TITLE"),placeholder:O.Loc.getMessage("LANDING_FORM_EMBED_WIDGET_FIELD_PLACEHOLDER")})})}},{key:"getCopyLinkField",value:function e(){return this.cache.remember("copyLinkField",function(){return new oe({link:"https://bitrix24.io/pub/my/form/link"})})}},{key:"getDelayDropdown",value:function e(){var t=this;return this.cache.remember("delayDropdown",function(){return new BX.Landing.UI.Field.DropdownInline({selector:"showDelay",content:t.options.values.views.auto.delay,items:[{name:"5c",value:"5"},{name:"10c",value:"10"},{name:"15c",value:"15"}],onChange:t.onChange.bind(t),skipInitialEvent:true})})}},{key:"getType3PositionField",value:function e(){var t=this;return this.cache.remember("type3PositionField",function(){return new ce({title:O.Loc.getMessage("LANDING_FORM_EMBED_POSITION_FIELD_TITLE"),value:{vertical:t.options.values.views.click.vertical,horizontal:t.options.values.views.click.position}})})}},{key:"getType4PositionField",value:function e(){var t=this;return this.cache.remember("type4PositionField",function(){return new ce({title:O.Loc.getMessage("LANDING_FORM_EMBED_POSITION_FIELD_TITLE"),value:{vertical:t.options.values.views.auto.vertical,horizontal:t.options.values.views.auto.position}})})}},{key:"getType3ShowTypeField",value:function e(){var t=this;return this.cache.remember("type3ShowTypeField",function(){return new BX.Landing.UI.Field.Dropdown({title:O.Loc.getMessage("LANDING_FORM_EMBED_SHOW_TYPE"),selector:"type",items:[{name:O.Loc.getMessage("LANDING_FORM_EMBED_SHOW_POPUP"),value:"popup"},{name:O.Loc.getMessage("LANDING_FORM_EMBED_SHOW_SLIDER"),value:"panel"}],content:t.options.values.views.click.type})})}},{key:"getType4ShowTypeField",value:function e(){var t=this;return this.cache.remember("type4ShowTypeField",function(){return new BX.Landing.UI.Field.Dropdown({title:O.Loc.getMessage("LANDING_FORM_EMBED_SHOW_TYPE"),selector:"type",items:[{name:O.Loc.getMessage("LANDING_FORM_EMBED_SHOW_POPUP"),value:"popup"},{name:O.Loc.getMessage("LANDING_FORM_EMBED_SHOW_SLIDER"),value:"panel"}],content:t.options.values.views.auto.type})})}},{key:"onTypeChange",value:function e(t){var n=t.getData();var i=this.getTypeDropdown();if(/type[1-6]$/.test(n.item.id)){this.clear();this.addItem(this.getHeader());this.addItem(i)}i.setLinkText(n.item.title.replace(/&nbsp;/," "));var a=this.getEmbedField();if(n.item.id==="type1"){i.setIcon(ue);this.addItem(this.getType1Message());a.setValue(this.options.values.scripts.inline.text);this.addItem(a)}if(n.item.id==="type2"){i.setIcon(de);a.setValue(this.options.values.scripts.click.text);this.addItem(a)}if(n.item.id==="type3"){i.setIcon(ge);a.setValue(this.options.values.scripts.click.text);var s=this.getType3PositionField();s.setValue({vertical:this.options.values.views.click.vertical,horizontal:this.options.values.views.click.position});this.addItem(this.getType3Message());this.addItem(this.getType3Header());this.addItem(s);this.addItem(this.getType3ShowTypeField());this.addItem(a)}if(n.item.id==="type4"){i.setIcon(pe);this.addItem(this.getType4Message());this.addItem(this.getType4Header());this.addItem(this.getType4Checkbox());var r=this.getType4PositionField();r.setValue({vertical:this.options.values.views.auto.vertical,horizontal:this.options.values.views.auto.position});this.addItem(r);this.addItem(this.getType4ShowTypeField());a.setValue(this.options.values.scripts.auto.text);this.addItem(a)}if(n.item.id==="type5"){i.setIcon(me);this.addItem(this.getType5Message());this.addItem(this.getWidgetField());a.setValue(this.options.values.scripts.auto.text);this.addItem(a)}if(n.item.id==="type6"){i.setIcon(he);this.addItem(this.getCopyLinkField())}}},{key:"onChange",value:function e(t){this.emit("onChange",{skipPrepare:true})}},{key:"getValue",value:function e(){var t=this;var n=this.getType3PositionField().getValue();var i=this.getType4PositionField().getValue();return{embedding:{views:{auto:{delay:function(){if(t.getType4Checkbox().getValue().includes("pageLoaded")){return 0}return t.getDelayDropdown().getValue()}(),position:i.horizontal,vertical:i.vertical,type:this.getType4ShowTypeField().getValue()},click:{position:n.horizontal,vertical:n.vertical,type:this.getType3ShowTypeField().getValue()}}}}}}]);return t}(M.ContentWrapper);var Te="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/identify/images/icon.svg";var fe=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.Identify");var i=new b.HeaderCard({title:O.Loc.getMessage("LANDING_IDENTIFY_HEADER")});var a=new L.MessageCard({header:O.Loc.getMessage("LANDING_IDENTIFY_MESSAGE_HEADER"),description:O.Loc.getMessage("LANDING_IDENTIFY_MESSAGE_DESCRIPTION"),icon:Te,angle:false,closeable:false,more:function e(){var t=D.Reflection.getClass("top.BX.Helper");if(t){BX.Helper.show("redirect=detail&code=12802786")}}});n.addItem(i);n.addItem(a);return n}return t}(M.ContentWrapper);function Ee(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-field-stages">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);Ee=function t(){return e};return e}var Ie=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));D.Dom.replace(n.input,n.getInner());return n}babelHelpers.createClass(t,[{key:"getInner",value:function e(){var t=this;return this.cache.remember("inner",function(){return D.Tag.render(Ee(),t.getCategoriesDropdown().getLayout())})}},{key:"getCategoriesDropdown",value:function e(){var t=this;return this.cache.remember("categoriesDropdown",function(){return new BX.Landing.UI.Field.Dropdown({title:t.options.listTitle||O.Loc.getMessage("LANDING_FORM_SETTINGS_CATEGORIES_FIELD_TITLE"),content:t.options.value.category,items:t.options.categories.map(function(e){return{name:e.NAME||e.name,value:e.ID||e.id}}),onChange:t.onCategoryChange.bind(t)})})}},{key:"getCurrentCategory",value:function e(){var t=this.getCategoriesDropdown().getValue();return this.options.categories.find(function(e){return String(e.ID||e.id)===String(t)})}},{key:"onCategoryChange",value:function e(){var t=this.getStagesDropdown();this.cache.delete("stagesDropdown");if(t.popup){t.popup.destroy()}var n=this.getStagesDropdown();D.Dom.replace(t.getLayout(),n.getLayout());this.emit("onChange")}},{key:"getStagesDropdown",value:function e(){var t=this;return this.cache.remember("stagesDropdown",function(){var e=t.getCurrentCategory().STAGES||t.getCurrentCategory().stages;return new BX.Landing.UI.Field.Dropdown({title:t.options.listTitle||O.Loc.getMessage("LANDING_FORM_SETTINGS_STAGES_FIELD_TITLE"),items:e.map(function(e){return{name:e.NAME||e.name,value:e.ID||e.id}})})})}},{key:"getValue",value:function e(){return{category:this.getCategoriesDropdown().getValue(),stage:this.getStagesDropdown().getValue()}}}]);return t}(y.BaseField);var Le="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/crm/images/message-icon.svg";var be=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.CrmContent");n.addItem(n.getHeader());n.addItem(n.getTypesField());if(n.isDynamicAvailable()){n.addItem(n.getDynamicEntitySettingsForm())}n.addItem(n.getExpertSettingsForm());n.addItem(n.getOrderSettingsForm());return n}babelHelpers.createClass(t,[{key:"isDynamicAvailable",value:function e(){return D.Type.isArrayFilled(this.options.formDictionary.document.dynamic)}},{key:"getHeader",value:function e(){return this.cache.remember("header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TITLE")})})}},{key:"getDuplicatesField",value:function e(){var t=this;return this.cache.remember("duplicatesField",function(){return new BX.Landing.UI.Field.Radio({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_DUPLICATES_FIELD_TITLE"),selector:"duplicateMode",value:[t.options.values.duplicateMode?t.options.values.duplicateMode:"ALLOW"],items:[{name:O.Loc.getMessage("LANDING_FORM_SETTINGS_DUPLICATES_ALLOW"),value:"ALLOW"},{name:O.Loc.getMessage("LANDING_FORM_SETTINGS_DUPLICATES_REPLACE"),value:"REPLACE"},{name:O.Loc.getMessage("LANDING_FORM_SETTINGS_DUPLICATES_MERGE"),value:"MERGE"}]})})}},{key:"getPaymentField",value:function e(){var t=this;return this.cache.remember("paymentField",function(){return new BX.Landing.UI.Field.Checkbox({selector:"payment",value:[t.options.values.payment],items:[{name:O.Loc.getMessage("LANDING_FORM_SETTINGS_ORDER_SHOW_PAYMENT"),value:true}]})})}},{key:"getOrderSettingsForm",value:function e(){var t=this;return this.cache.remember("formSettingsForm",function(){var e=t.getSchemeById(t.options.values.scheme);var n=function(){if(e&&e.dynamic===true){return String(e.id).endsWith("1")}return D.Text.toNumber(t.options.values.scheme)>4}();return new v.FormSettingsForm({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_ORDER_HEADER"),toggleable:true,opened:n,fields:[t.getPaymentField(),new L.MessageCard({id:"orderMessage",header:O.Loc.getMessage("LANDING_FORM_SETTINGS_ORDER_MESSAGE_HEADER"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_ORDER_MESSAGE_DESCRIPTION"),angle:false,icon:Le,restoreState:true})]})})}},{key:"getType1Header",value:function e(){return this.cache.remember("type1header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_1").replace("&nbsp;"," "),level:2})})}},{key:"getType2Header",value:function e(){return this.cache.remember("type2header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_2").replace("&nbsp;"," "),level:2})})}},{key:"getType3Header",value:function e(){return this.cache.remember("type3header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_3").replace("&nbsp;"," "),level:2})})}},{key:"getType4Header",value:function e(){return this.cache.remember("type4header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_4").replace("&nbsp;"," "),level:2})})}},{key:"getDynamicHeader",value:function e(t){var n=this.cache.remember("dynamicHeader",function(){return new b.HeaderCard({title:"",level:2})});if(D.Type.isString(t)){n.setTitle(t)}return n}},{key:"getDynamicEntitiesField",value:function e(){var t=this;return this.cache.remember("dynamicEntitiesField",function(){var e=t.getSchemeById(t.options.values.scheme);return new BX.Landing.UI.Field.Dropdown({selector:"dynamicScheme",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_SMART_ENTITY_LIST"),items:t.options.formDictionary.document.dynamic.map(function(e){return{name:e.name,value:e.id}}),content:e.mainEntity,onChange:function e(){t.onTypeChange(new S.BaseEvent({data:{item:{id:t.getSelectedSchemeId()}}}))}})})}},{key:"getDynamicEntitySettingsForm",value:function e(){var t=this;return this.cache.remember("dynamicEntitySettingsForm",function(){return new v.FormSettingsForm({opened:true,hidden:true,fields:[t.getDynamicEntitiesField()]})})}},{key:"getExpertSettingsForm",value:function e(){var t=this;return this.cache.remember("expertSettingsForm",function(){return new v.FormSettingsForm({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_EXPERT_MODE"),toggleable:true,toggleableType:v.FormSettingsForm.ToggleableType.Link,opened:false,fields:[new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_1").replace("&nbsp;"," "),level:2}),t.getDuplicatesField()]})})}},{key:"getTypesField",value:function e(){var t=this;return this.cache.remember("typesField",function(){setTimeout(function(){t.onTypeChange(new S.BaseEvent({data:{item:{id:t.options.values.scheme}}}))});var e=[{id:"2",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_2"),icon:"landing-ui-crm-entity-type2"},{id:"3",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_3"),icon:"landing-ui-crm-entity-type3"},{id:"4",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_4"),icon:"landing-ui-crm-entity-type4"}];if(t.isDynamicAvailable()){e.push({id:"smart",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_5"),icon:"landing-ui-crm-entity-type5"})}if(t.options.isLeadEnabled){e.unshift({id:"1",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_1"),icon:"landing-ui-crm-entity-type1"})}return new _.RadioButtonField({selector:"scheme",value:function(){if(String(t.options.values.scheme)==="8"){return 1}if(String(t.options.values.scheme)==="5"){return 2}if(String(t.options.values.scheme)==="6"){return 3}if(String(t.options.values.scheme)==="7"){return 4}var e=t.getSchemeById(t.options.values.scheme);if(D.Type.isPlainObject(e)&&e.dynamic===true){return"smart"}return t.options.values.scheme}(),items:e,onChange:t.onTypeChange.bind(t)})})}},{key:"getStagesField",value:function e(){var t=this;return this.cache.remember("stagesField",function(){return new Ie({categories:t.options.categories,value:{category:t.options.values.category}})})}},{key:"getDynamicCategoriesField",value:function e(t){var n=this;return this.cache.remember("dynamicCategories#".concat(t),function(){var e=n.getDynamicSchemeById(t);return new Ie({listTitle:O.Loc.getMessage("LANDING_FORM_SETTINGS_SMART_STAGES_FIELD_TITLE"),categories:e.categories,value:{category:n.options.values.dynamicCategory}})})}},{key:"getDuplicatesEnabledField",value:function e(){var t=this;return this.cache.remember("duplicatesEnabledField",function(){return new BX.Landing.UI.Field.Checkbox({selector:"duplicatesEnabled",compact:true,value:[t.options.values.duplicatesEnabled],items:[{name:O.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_DUPLICATES_ENABLED"),value:true}]})})}},{key:"getSchemeById",value:function e(t){return this.options.formDictionary.document.schemes.find(function(e){return String(e.id)===String(t)||t==="smart"&&e.dynamic})}},{key:"getDynamicSchemeById",value:function e(t){var n=this.getSchemeById(t),i=n.mainEntity;return this.options.formDictionary.document.dynamic.find(function(e){return String(e.id)===String(i)})}},{key:"onTypeChange",value:function e(t){var n=t.getData(),i=n.item;var a=this.getSchemeById(i.id);this.clear();this.addItem(this.getHeader());this.addItem(this.getTypesField());if(this.isDynamicAvailable()){this.addItem(this.getDynamicEntitySettingsForm());this.getDynamicEntitySettingsForm().hide()}var s=this.getExpertSettingsForm();s.clear();if(String(i.id)==="1"||String(i.id)==="8"){s.addField(this.getType1Header());s.addField(this.getDuplicatesField())}if(String(i.id)==="2"||String(i.id)==="5"){s.addField(this.getType2Header());s.addField(this.getDuplicatesField())}if(String(i.id)==="3"||String(i.id)==="6"){s.addField(this.getType3Header());s.addField(this.getStagesField());s.addField(this.getDuplicatesEnabledField());s.addField(this.getDuplicatesField())}if(String(i.id)==="4"||String(i.id)==="7"){s.addField(this.getType4Header());s.addField(this.getDuplicatesField())}if(D.Text.toNumber(i.id)>4&&D.Type.isPlainObject(a)&&a.dynamic!==true||this.getOrderSettingsForm().isOpened()){this.getOrderSettingsForm().onSwitchChange(true)}if(D.Type.isPlainObject(a)&&(String(i.id)==="smart"||a.dynamic===true)&&this.isDynamicAvailable()){s.addField(this.getDynamicHeader(a.name));s.addField(this.getDynamicCategoriesField(a.id));s.addField(this.getDuplicatesField());if(String(a.id).endsWith("1")){this.getOrderSettingsForm().onSwitchChange(true)}this.getDynamicEntitySettingsForm().show()}this.addItem(s);this.addItem(this.getOrderSettingsForm())}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}},{key:"getSelectedSchemeId",value:function e(){var t=this.getTypesField().getValue();if(String(t)==="smart"){var n=this.getDynamicEntitiesField().getValue();if(this.getOrderSettingsForm().isOpened()){return"".concat(n,"1")}return"".concat(n,"0")}return t}},{key:"valueReducer",value:function e(t){var n=this.getDuplicatesField().getValue()[0];var i={duplicateMode:n==="ALLOW"?"":n,scheme:this.getSelectedSchemeId(),deal:{duplicatesEnabled:D.Text.toBoolean(this.getDuplicatesEnabledField().getValue()[0])},payment:{use:this.getPaymentField().getValue().length>0},dynamic:{category:null}};if(this.getOrderSettingsForm().isOpened()){if(String(i.scheme)==="1"){i.scheme="8"}if(String(i.scheme)==="2"){i.scheme="5"}if(String(i.scheme)==="3"){i.scheme="6"}if(String(i.scheme)==="4"){i.scheme="7"}}if(String(i.scheme)==="3"||String(i.scheme)==="6"){i.deal.category=this.getStagesField().getValue().category}var a=this.getSchemeById(i.scheme);if(D.Type.isPlainObject(a)&&a.dynamic){i.dynamic.category=this.getDynamicCategoriesField(a.id).getValue().category}return{document:i}}}]);return t}(M.ContentWrapper);var ve=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.DefaultValues");var i=new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_DEFAULT_VALUE_TITLE")});var a=new L.MessageCard({id:"defaultValueMessage",header:O.Loc.getMessage("LANDING_FORM_SETTINGS_DEFAULT_VALUE_MESSAGE_TITLE"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_DEFAULT_VALUE_MESSAGE_DESCRIPTION"),restoreState:true});var s=new v.FormSettingsForm({fields:[new T.DefaultValueField({selector:"presetFields",isLeadEnabled:n.options.isLeadEnabled,personalizationVariables:n.options.personalizationVariables,formOptions:babelHelpers.objectSpread({},n.options.formOptions),crmFields:babelHelpers.objectSpread({},n.options.crmFields),dictionary:babelHelpers.objectSpread({},n.options.dictionary),items:babelHelpers.toConsumableArray(n.options.values.fields)})]});if(!a.isShown()){s.setOffsetTop(-36)}a.subscribe("onClose",function(){s.setOffsetTop(-36)});n.addItem(i);n.addItem(a);n.addItem(s);return n}babelHelpers.createClass(t,[{key:"getLayout",value:function e(){var n=babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"getLayout",this).call(this);D.Dom.addClass(n,"landing-ui-default-fields-values");return n}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var Ne=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.FacebookContent");n.addItem(new b.HeaderCard({title:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_FACEBOOK")}));if(n.options.formOptions.integration.canUse){var i=new E.BaseCard;var a=new f.Button({text:n.prepareButtonText(n.options.formOptions),color:f.Button.Color.LIGHT_BORDER,onclick:function e(){BX.SidePanel.Instance.open("/crm/webform/ads/".concat(n.options.formOptions.id,"/?type=facebook"),{cacheable:false,events:{onClose:function e(){var t=I.FormClient.getInstance();t.resetCache(n.options.formOptions.id);t.getOptions(n.options.formOptions.id).then(function(e){a.setText(n.prepareButtonText(e))})}}})}});D.Dom.style(i.getLayout(),{padding:0,margin:0});D.Dom.append(a.render(),i.getBody());n.addItem(i)}else{n.addItem(new L.MessageCard({header:O.Loc.getMessage("LANDING_CRM_FORM_INTEGRATION_SEO_NOT_INSTALLED_HEADER"),description:O.Loc.getMessage("LANDING_CRM_FORM_INTEGRATION_SEO_NOT_INSTALLED_FB_TEXT"),angle:false,closeable:false}))}return n}babelHelpers.createClass(t,[{key:"prepareButtonText",value:function e(t){var n=t.integration.cases.some(function(e){return e.providerCode==="facebook"});if(n){return O.Loc.getMessage("LANDING_FORM_SETTINGS_FACEBOOK_BUTTON_ENABLED")}return O.Loc.getMessage("LANDING_FORM_SETTINGS_FACEBOOK_BUTTON")}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var Se=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.VkContent");n.addItem(new b.HeaderCard({title:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_VK")}));if(n.options.formOptions.integration.canUse){var i=new E.BaseCard;var a=new f.Button({text:n.prepareButtonText(n.options.formOptions),color:f.Button.Color.LIGHT_BORDER,onclick:function e(){BX.SidePanel.Instance.open("/crm/webform/ads/".concat(n.options.formOptions.id,"/?type=vkontakte"),{cacheable:false,events:{onClose:function e(){var t=I.FormClient.getInstance();t.resetCache(n.options.formOptions.id);t.getOptions(n.options.formOptions.id).then(function(e){a.setText(n.prepareButtonText(e))})}}})}});D.Dom.style(i.getLayout(),{padding:0,margin:0});D.Dom.append(a.render(),i.getBody());n.addItem(i)}else{n.addItem(new L.MessageCard({header:O.Loc.getMessage("LANDING_CRM_FORM_INTEGRATION_SEO_NOT_INSTALLED_HEADER"),description:O.Loc.getMessage("LANDING_CRM_FORM_INTEGRATION_SEO_NOT_INSTALLED_VK_TEXT"),angle:false,closeable:false}))}return n}babelHelpers.createClass(t,[{key:"prepareButtonText",value:function e(t){var n=t.integration.cases.some(function(e){return e.providerCode==="vkontakte"});if(n){return O.Loc.getMessage("LANDING_FORM_SETTINGS_VK_BUTTON_ENABLED")}return O.Loc.getMessage("LANDING_FORM_SETTINGS_VK_BUTTON")}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var ye=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.Callback");n.addItem(n.getHeader());if(!n.isAvailable()){n.addItem(n.getWarningMessage());n.getSettingsForm().disable()}n.addItem(n.getSettingsForm());return n}babelHelpers.createClass(t,[{key:"getHeader",value:function e(){return this.cache.remember("header",function(){return new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CALLBACK_TITLE")})})}},{key:"getWarningMessage",value:function e(){return this.cache.remember("warningMessage",function(){return new L.MessageCard({header:O.Loc.getMessage("LANDING_FORM_CALLBACK_WARNING_HEADER"),description:O.Loc.getMessage("LANDING_FORM_CALLBACK_WARNING_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"isAvailable",value:function e(){var t=this;return this.cache.remember("isAvailable",function(){return t.options.dictionary.callback.from.length>0})}},{key:"getSettingsForm",value:function e(){var t=this;return this.cache.remember("settingsForm",function(){return new v.FormSettingsForm({title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CALLBACK_USE_CHECKBOX_LABEL"),toggleable:true,toggleableType:v.FormSettingsForm.ToggleableType.Switch,opened:t.isAvailable()&&D.Text.toBoolean(t.options.values.use),fields:[t.getPhoneListField(),t.getTextField()]})})}},{key:"getUseCheckboxField",value:function e(){var t=this;return this.cache.remember("useCheckboxField",function(){return new BX.Landing.UI.Field.Checkbox({selector:"use",compact:true,value:[D.Text.toBoolean(t.options.values.use)],items:[{name:O.Loc.getMessage("LANDING_FORM_SETTINGS_CALLBACK_USE_CHECKBOX_LABEL"),value:true}]})})}},{key:"getPhoneListField",value:function e(){var t=this;return this.cache.remember("phoneListField",function(){return new BX.Landing.UI.Field.Dropdown({selector:"from",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CALLBACK_PHONE_TITLE"),content:t.options.values.from,items:[{name:O.Loc.getMessage("LANDING_FORM_DEFAULT_PHONE_NOT_SELECTED"),value:""}].concat(babelHelpers.toConsumableArray(t.options.dictionary.callback.from.map(function(e){return{name:e.name,value:e.id}})))})})}},{key:"getTextField",value:function e(){var t=this;return this.cache.remember("textField",function(){return new N.TextField({selector:"text",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_CALLBACK_TEXT_TITLE"),content:t.options.values.text,textOnly:true})})}},{key:"valueReducer",value:function e(t){return{callback:babelHelpers.objectSpread({},t,{use:this.getSettingsForm().isOpened()})}}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var Fe=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));D.Dom.removeClass(n.input,"landing-ui-field-input");n.getTagSelector().renderTo(n.input);return n}babelHelpers.createClass(t,[{key:"getTagSelector",value:function e(){var t=this;return this.cache.remember("tagSelector",function(){var e=C.PageObject.getRootWindow();return new e.BX.UI.EntitySelector.TagSelector({id:"user-selector",dialogOptions:{id:"user-selector",entities:[{id:"user",options:{activeUsers:true}}],preselectedItems:t.options.value,events:{"Item:onSelect":function e(){t.emit("onChange",{skipPrepare:true})},"Item:onDeselect":function e(){t.emit("onChange",{skipPrepare:true})}}}})})}},{key:"getValue",value:function e(){return this.getTagSelector().getDialog().getSelectedItems().map(function(e){return e.id})}}]);return t}(y.BaseField);var Ce=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.SpamProtection");var i=new b.HeaderCard({title:O.Loc.getMessage("LANDING_FORM_OTHER_TITLE")});var a=new v.FormSettingsForm({id:"other",description:null,fields:[n.getNameField(),n.getUserSelectorField(),n.getLanguageField(),n.getUseSignField()]});n.addItem(i);n.addItem(a);return n}babelHelpers.createClass(t,[{key:"canRemoveCopyrights",value:function e(){return this.options.dictionary.sign.canRemove}},{key:"getNameField",value:function e(){var t=this;return this.cache.remember("nameField",function(){return new N.TextField({title:O.Loc.getMessage("LANDING_FORM_OTHER_TITLE_NAME_TITLE"),selector:"name",textOnly:true,content:t.options.values.name})})}},{key:"getUseSignField",value:function e(){var t=this;return this.cache.remember("useSignField",function(){return new BX.Landing.UI.Field.Checkbox({selector:"useSign",value:t.options.values.useSign?["useSign"]:[],items:[{value:"useSign",html:"".concat(O.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_SHOW_SIGN")).concat(t.createCopyRight())}],compact:true})})}},{key:"getUserSelectorField",value:function e(){var t=this;return this.cache.remember("userSelectorField",function(){return new Fe({selector:"users",title:O.Loc.getMessage("LANDING_CRM_FORM_USER"),value:t.options.values.users.reduce(function(e,t){if(D.Type.isStringFilled(t)||D.Type.isNumber(t)){e.push(["user",t])}return e},[])})})}},{key:"getLanguageField",value:function e(){var t=this;return this.cache.remember("language",function(){return new BX.Landing.UI.Field.Dropdown({selector:"language",title:O.Loc.getMessage("LANDING_CRM_FORM_LANGUAGE"),items:t.options.dictionary.languages.map(function(e){return{name:e.name,value:e.id}}),content:t.options.values.language})})}},{key:"createCopyRight",value:function e(){return'\n\t\t\t<span class="landing-ui-signin">\n\t\t\t\t<span class="landing-ui-sign">'.concat(O.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_BUTTONS_SIGN"),'</span>\n\t\t\t\t<span class="landing-ui-sign-in">').concat(O.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_BUTTONS_SIGN_BY"),'</span>\n\t\t\t\t<span class="landing-ui-sign-24">24</span>\n\t\t\t</span>\n\t\t')}},{key:"valueReducer",value:function e(t){return{name:t.name,data:{language:this.getLanguageField().getValue(),useSign:t.useSign.includes("useSign")},responsible:{users:t.users}}}},{key:"onChange",value:function e(t){if(!this.canRemoveCopyrights()){var n=this.getUseSignField();if(!n.getValue().includes("useSign")){n.setValue(["useSign"]);if(D.Type.isStringFilled(this.options.dictionary.restriction.helper)){var i=D.Reflection.getClass("BX.evalGlobal");if(D.Type.isFunction(i)){i(this.options.dictionary.restriction.helper)}}}}this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var De=[new A.SidebarButton({id:"fields",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_FIELDS"),child:true}),new A.SidebarButton({id:"agreements",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_AGREEMENT"),child:true,important:true}),new A.SidebarButton({id:"crm",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_ENTITY"),child:true}),new A.SidebarButton({id:"identify",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_CLIENT_IDENTIFY"),child:true}),new A.SidebarButton({id:"button_and_header",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_HEADER_AND_BUTTON"),child:true}),new A.SidebarButton({id:"spam_protection",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_SPAM_PROTECTION"),child:true}),new A.SidebarButton({id:"fields_rules",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_FIELDS_RULES"),child:true}),new A.SidebarButton({id:"actions",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_ACTIONS"),child:true}),new A.SidebarButton({id:"default_values",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_DEFAULT_VALUES"),child:true}),new A.SidebarButton({id:"analytics",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_DEFAULT_ANALYTICS"),child:true}),new A.SidebarButton({id:"facebook",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_FACEBOOK"),child:true}),new A.SidebarButton({id:"vk",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_VK"),child:true}),new A.SidebarButton({id:"callback",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CALLBACK"),child:true}),new A.SidebarButton({id:"embed",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_EMBED"),child:true}),new A.SidebarButton({id:"more",text:O.Loc.getMessage("LANDING_FORM_SETTINGS_MORE_BUTTON_TEXT"),className:"landing-ui-button-sidebar-more",child:true}),new A.SidebarButton({id:"other",text:O.Loc.getMessage("LANDING_SIDEBAR_BUTTON_OTHER"),child:true})];var Ae=[new M.PresetCategory({id:"crm",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CATEGORY_CRM")}),new M.PresetCategory({id:"products",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CATEGORY_PRODUCTS_2")}),new M.PresetCategory({id:"social",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CATEGORY_SOCIAL")}),new M.PresetCategory({id:"crm_automation",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CATEGORY_CRM_AUTOMATION")})];var Oe="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/integration.svg";var Me="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/autoshow.svg";var Re="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/revertcall.svg";var ke="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/vk.svg";var Be="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/facebook.svg";var Pe="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/crm.svg";var Ge="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/service.svg";var He="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/products1.svg";var we="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/products2.svg";var Ue="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/products3.svg";var xe="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/products4.svg";var Xe=[new M.Preset({id:"contacts",category:"crm",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS_DESCRIPTION"),icon:Oe,items:["fields","agreements","crm","embed","other"],options:{templateId:"contacts",name:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS"),agreements:{use:true},data:{title:"",desc:"",buttonCaption:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS_BUTTON"),fields:[{name:"LEAD_NAME"},{name:"LEAD_LAST_NAME"},{name:"LEAD_PHONE"},{name:"LEAD_EMAIL"}],agreements:[{checked:true}],dependencies:[],recaptcha:{use:false}},captcha:{key:"",secret:""},result:{success:{text:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS_SUCCESS_TEXT")},failure:{text:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS_FAILURE_TEXT")}},document:{scheme:1}}}),new M.Preset({id:"feedback",category:"crm",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_DESCRIPTION"),icon:Me,items:["fields","agreements","crm","embed","other"],options:{templateId:"feedback",name:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK"),agreements:{use:true},data:{title:"",desc:"",buttonCaption:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_BUTTON"),fields:[{name:"LEAD_NAME"},{name:"LEAD_PHONE"},{name:"LEAD_EMAIL"},{name:"LEAD_COMMENTS"}],agreements:[{checked:true}],dependencies:[],recaptcha:{use:false}},captcha:{key:"",secret:""},result:{success:{text:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_SUCCESS_TEXT")},failure:{text:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_FAILURE_TEXT")}},document:{scheme:1}}}),new M.Preset({id:"callback",category:"crm",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK_DESCRIPTION"),icon:Re,defaultSection:"callback",items:["fields","agreements","crm","embed","callback","other"],options:{templateId:"callback",name:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK"),agreements:{use:true},data:{title:"",desc:"",buttonCaption:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK_BUTTON"),fields:[{name:"LEAD_PHONE"}],agreements:[{checked:true}],dependencies:[],recaptcha:{use:false}},captcha:{key:"",secret:""},result:{success:{text:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK_SUCCESS_TEXT")},failure:{text:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK_FAILURE_TEXT")}},document:{scheme:1}}}),new M.Preset({id:"expert",category:"crm",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_EXPERT"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_EXPERT_DESCRIPTION"),icon:Ge,items:["fields","agreements","crm","identify","button_and_header","spam_protection","fields_rules","actions","default_values","analytics","facebook","vk","callback","embed","other"],options:{templateId:"expert",name:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_EXPERT"),agreements:{use:true},result:{success:{text:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_SUCCESS_TEXT")},failure:{text:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_FAILURE_TEXT")}}}}),new M.Preset({id:"products1",category:"products",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_1"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_1_DESCRIPTION"),icon:He,items:["fields","agreements","crm","embed","other"],options:{templateId:"products1",name:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_1"),agreements:{use:true},data:{title:"",desc:"",fields:[{name:"LEAD_NAME"},{name:"LEAD_PHONE"},{name:"LEAD_EMAIL"},{type:"product",bigPic:false}],agreements:[{checked:true}],dependencies:[],recaptcha:{use:false}},captcha:{key:"",secret:""},document:{scheme:1}}}),new M.Preset({id:"products2",category:"products",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_2"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_2_DESCRIPTION"),icon:we,items:["fields","agreements","crm","embed","other"],options:{templateId:"products2",name:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_2"),agreements:{use:true},data:{title:"",desc:"",fields:[{name:"LEAD_NAME"},{name:"LEAD_PHONE"},{name:"LEAD_EMAIL"},{type:"product",bigPic:false}],agreements:[{checked:true}],dependencies:[],recaptcha:{use:false}},captcha:{key:"",secret:""},document:{scheme:8},payment:{use:true}}}),new M.Preset({id:"products3",category:"products",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_3"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_3_DESCRIPTION"),icon:Ue,items:["fields","agreements","crm","embed","other"],options:{templateId:"products3",name:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_3"),agreements:{use:true},data:{title:"",desc:"",fields:[{name:"LEAD_NAME"},{name:"LEAD_PHONE"},{name:"LEAD_EMAIL"},{type:"product",bigPic:false}],agreements:[{checked:true}],dependencies:[],recaptcha:{use:false}},captcha:{key:"",secret:""},document:{scheme:1}}}),new M.Preset({id:"products4",category:"products",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_4"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_4_DESCRIPTION"),icon:xe,items:["fields","agreements","crm","embed","other"],options:{templateId:"products4",name:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCT_4"),agreements:{use:true},data:{title:"",desc:"",fields:[{name:"LEAD_NAME"},{name:"LEAD_PHONE"},{name:"LEAD_EMAIL"},{type:"product",bigPic:true}],agreements:[{checked:true}],dependencies:[],recaptcha:{use:false}},captcha:{key:"",secret:""},document:{scheme:1}}}),new M.Preset({id:"vk",category:"social",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_VK"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_VK_DESCRIPTION"),icon:ke,items:["fields","embed","other"],disabled:true,soon:true}),new M.Preset({id:"facebook",category:"social",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FB"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FB_DESCRIPTION"),icon:Be,items:["embed","other"],disabled:true,soon:true}),new M.Preset({id:"personalisation",category:"crm_automation",title:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PERSONALIZATION"),description:O.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PERSONALIZATION_DESCRIPTION"),icon:Pe,items:["embed","other"],disabled:true,soon:true})];function Ke(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-access-error-message">\n\t\t\t\t\t<div class="landing-ui-access-error-message-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);Ke=function t(){return e};return e}var Ve=function(e){babelHelpers.inherits(s,e);babelHelpers.createClass(s,null,[{key:"getInstance",value:function e(){var t=C.PageObject.getRootWindow();var n=t.BX.Landing.UI.Panel.FormSettingsPanel;if(!n.instance&&!s.instance){n.instance=new s}return n.instance||s.instance}}]);function s(){var e;babelHelpers.classCallCheck(this,s);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));e.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel");e.setTitle(O.Loc.getMessage("LANDING_FORM_SETTINGS_PANEL_TITLE"));e.disableOverlay();var t=De.filter(function(t){return e.isCrmFormPage()||t.id!=="embed"});e.setSidebarButtons(t);e.setCategories(Ae);var n=Xe.filter(function(e){return O.Loc.getMessage("LANGUAGE_ID")==="ru"||O.Loc.getMessage("LANGUAGE_ID")!=="ru"&&e.options.id!=="vk"});e.setPresets(n);if(!e.isCrmFormPage()){D.Dom.append(e.getBlockSettingsButton().render(),e.getRightHeaderControls())}e.subscribe("onCancel",e.onCancelClick.bind(babelHelpers.assertThisInitialized(e)));return e}babelHelpers.createClass(s,[{key:"isCrmFormPage",value:function e(){return i.Env.getInstance().getOptions().specialType==="crm_forms"}},{key:"getBlockSettingsButton",value:function e(){var t=this;return this.cache.remember("blockSettingsButton",function(){return new f.Button({text:O.Loc.getMessage("LANDING_FORM_SETTINGS_BLOCK_SETTINGS_BUTTON_TEXT"),color:f.Button.Color.LIGHT_BORDER,onclick:t.onBlockSettingsButtonClick.bind(t),size:f.Button.Size.SMALL})})}},{key:"onBlockSettingsButtonClick",value:function e(){var t=this;if(this.getCurrentBlock()){this.hide().then(function(){t.getCurrentBlock().showContentPanel()})}}},{key:"getLoader",value:function e(){var t=this;return this.cache.remember("loader",function(){return new n.Loader({target:t.body})})}},{key:"showLoader",value:function e(){void this.getLoader().show();D.Dom.hide(this.sidebar);D.Dom.hide(this.content);D.Dom.hide(this.getPresetField().getLayout())}},{key:"hideLoader",value:function e(){this.getLoader().hide();D.Dom.show(this.sidebar);D.Dom.show(this.content);D.Dom.show(this.getPresetField().getLayout())}},{key:"load",value:function e(){var n=this;var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(a.showWithOptions){var s=i.Env.getInstance().getOptions().formEditorData;this.setCrmFields(s.crmFields);this.setCrmCompanies(s.crmCompanies);this.setCrmCategories(s.crmCategories);this.setAgreements(s.agreements);var r=D.Runtime.clone(s.formOptions);if(r.agreements.use!==true){r.agreements.use=true;r.data.agreements=[]}this.setFormOptions(r);this.setFormDictionary(s.dictionary);return Promise.resolve()}var o=t.Backend.getInstance().batch("Form::getCrmFields",{crmFields:{action:"Form::getCrmFields",data:null},crmCompanies:{action:"Form::getCrmCompanies",data:null},crmCategories:{action:"Form::getCrmCategories",data:null},agreements:{action:"Form::getAgreements",data:null}}).then(function(e){n.setCrmFields(e.crmFields.result);n.setCrmCompanies(e.crmCompanies.result);n.setCrmCategories(e.crmCategories.result);n.setAgreements(e.agreements.result)});var l=I.FormClient.getInstance().getOptions(this.getCurrentFormId()).then(function(e){var t=D.Runtime.clone(e);if(t.agreements.use!==true){t.agreements.use=true;t.data.agreements=[]}n.setFormOptions(t)});var c=I.FormClient.getInstance().getDictionary().then(function(e){n.setFormDictionary(e)});return Promise.all([o,l,c])}},{key:"setAgreements",value:function e(t){this.cache.set("agreements",D.Runtime.orderBy(t,["id"],["asc"]))}},{key:"getAgreements",value:function e(){return this.cache.get("agreements")}},{key:"isLeadEnabled",value:function e(){return this.getFormDictionary().document.lead.enabled}},{key:"setCurrentBlock",value:function e(t){this.cache.set("currentBlock",t)}},{key:"getCurrentBlock",value:function e(){return this.cache.get("currentBlock")}},{key:"show",value:function e(){var t=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{formOptions:{}};if(!this.layout.parentNode){this.enableToggleMode()}if(!this.isFormCreated()){this.disableTransparentMode()}this.setCurrentBlock(n.block);this.setCurrentFormId(n.formId);this.setCurrentFormInstanceId(n.instanceId);this.showLoader();this.load(n).then(function(){t.hideLoader();var e=t.getFormOptions();if(!t.isLeadEnabled()){var i=t.getPresets().map(function(e){if(D.Type.isPlainObject(e.options.options)&&D.Type.isPlainObject(e.options.options.data)){if(D.Type.isArrayFilled(e.options.options.data.fields)){e.options.options.data.fields=e.options.options.data.fields.map(function(e){var t=babelHelpers.objectSpread({},e);if(D.Type.isStringFilled(e.name)){t.name=e.name.replace(/^LEAD_/,"CONTACT_")}return t})}if(D.Type.isPlainObject(e.options.options.document)){e.options.options.document.scheme=3}}return e});t.setPresets(i)}if(D.Type.isPlainObject(n.formOptions)){var a=D.Runtime.merge(t.getFormOptions(),n.formOptions);t.setFormOptions(a)}if(n.state==="presets"&&e.templateId!=="callback"){t.onPresetFieldClick();t.activatePreset(e.templateId)}else{var s=t.getPresets().find(function(t){return t.options.id===e.templateId});if(!s){s=t.getPresets().find(function(e){return e.options.id==="expert"})}if(t.isFormCreated()&&e.templateId!=="callback"){t.applyPreset(s)}else{t.applyPreset(s,true)}}t.setInitialFormOptions(D.Runtime.clone(t.getFormOptions()))}).catch(function(e){if(D.Type.isArrayFilled(e)){var n=510;var i=e.some(function(e){return String(e.code)===String(n)});if(i){t.getLoader().hide();D.Dom.show(t.sidebar);D.Dom.show(t.content);D.Dom.hide(t.footer);D.Dom.append(t.getAccessError(),t.content)}}console.error(e)});void a.StylePanel.getInstance().hide();return babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"show",this).call(this,n)}},{key:"getAccessError",value:function e(){return this.cache.remember("accessErrorMessage",function(){return D.Tag.render(Ke(),O.Loc.getMessage("LANDING_CRM_ACCESS_ERROR_MESSAGE"))})}},{key:"isFormCreated",value:function e(){var t=new D.Uri(window.location.origin);return D.Text.toBoolean(t.getQueryParam("formCreated"))}},{key:"setCurrentFormId",value:function e(t){this.cache.set("currentFormId",D.Text.toNumber(t))}},{key:"getCurrentFormId",value:function e(){return this.cache.get("currentFormId")}},{key:"setCurrentFormInstanceId",value:function e(t){this.cache.set("currentFormInstanceId",t)}},{key:"getCurrentFormInstanceId",value:function e(){return this.cache.get("currentFormInstanceId")}},{key:"setCrmFields",value:function e(t){this.cache.set("fields",t)}},{key:"getCrmFields",value:function e(){return this.cache.get("fields")||{}}},{key:"setCrmCompanies",value:function e(t){this.cache.set("companies",t)}},{key:"getCrmCompanies",value:function e(){return this.cache.get("companies")||[]}},{key:"setCrmCategories",value:function e(t){this.cache.set("crmCategories",t)}},{key:"getCrmCategories",value:function e(){return this.cache.get("crmCategories")||[]}},{key:"setFormOptions",value:function e(t){this.cache.set("formOptions",t)}},{key:"getFormOptions",value:function e(){return D.Runtime.clone(this.cache.get("formOptions")||{})}},{key:"setFormDictionary",value:function e(t){this.cache.set("formDictionary",t)}},{key:"getFormDictionary",value:function e(){return this.cache.get("formDictionary")||{}}},{key:"setInitialFormOptions",value:function e(t){this.cache.set("initialFormOptions",D.Runtime.clone(t))}},{key:"getInitialFormOptions",value:function e(){return this.cache.get("initialFormOptions")}},{key:"getCrmForm",value:function e(){var t=D.Reflection.getClass("b24form.App");if(t){if(this.getCurrentFormInstanceId()){return t.get(this.getCurrentFormInstanceId())}return t.list()[0]}return null}},{key:"onChange",value:function e(t){var n=this;var i=t.getData();var a=t.getTarget().getValue();Promise.resolve(a).then(function(e){if(i.skipPrepare){var t=n.getFormOptions();if(D.Type.isArrayFilled(t.data.dependencies)&&D.Type.isArrayFilled(e.fields)){var a=t.data.dependencies;t.data.dependencies=a.reduce(function(t,n){var i=babelHelpers.objectSpread({},n);i.list=i.list.filter(function(t){return e.fields.some(function(e){return e.id===t.condition.target})&&e.fields.some(function(e){return e.id===t.action.target})});if(i.list.length>0){t.push(i)}return t},[])}if(Reflect.has(e,"presetFields")||Reflect.has(e,"document")||Reflect.has(e,"result")){var s={};if(Reflect.has(e,"document")){s.payment=e.document.payment;delete e.document.payment}return babelHelpers.objectSpread({},t,e,s)}if(Reflect.has(e,"embedding")||Reflect.has(e,"callback")||Reflect.has(e,"name")&&Reflect.has(e,"data")&&Reflect.has(e.data,"useSign")){var r=D.Runtime.merge(t,e);if(Reflect.has(e,"responsible")){r.responsible.users=e.responsible.users}return r}if(Reflect.has(e,"recaptcha")){var o=e.recaptcha,l=o.key,c=o.secret;delete e.recaptcha.key;delete e.recaptcha.secret;var u={key:l,secret:c};return babelHelpers.objectSpread({},t,{captcha:u,data:babelHelpers.objectSpread({},t.data,e)})}return babelHelpers.objectSpread({},t,{data:babelHelpers.objectSpread({},t.data,e)})}return I.FormClient.getInstance().prepareOptions(n.getFormOptions(),e).then(function(t){if(e.agreements){t.data=D.Runtime.merge(t.data,e)}if(e.fields){t.data.fields=t.data.fields.map(function(t,n){return D.Runtime.merge(t,e.fields[n])})}return t})}).then(function(e){n.setFormOptions(e);n.getCrmForm().adjust(D.Runtime.clone(e.data))})}},{key:"getPersonalizationVariables",value:function e(){var t=this;return this.cache.remember("personalizationVariables",function(){return t.getFormDictionary().personalization.list.map(function(e){return{name:e.name,value:e.id}})})}},{key:"getDefaultValuesVariables",value:function e(){var t=this;return this.cache.remember("personalizationVariables",function(){var e=t.getFormDictionary(),n=e.properties;if(D.Type.isPlainObject(n)&&D.Type.isArrayFilled(n.list)){return n.list.map(function(e){return{name:e.name,value:e.id}})}return[]})}},{key:"getContent",value:function e(t){var n=this;var i=this.getCrmForm();if(i){i.sent=false;i.error=false}if(t==="button_and_header"){return new k({personalizationVariables:this.getPersonalizationVariables(),values:{title:s.sanitize(this.getFormOptions().data.title),desc:s.sanitize(this.getFormOptions().data.desc),buttonCaption:this.getFormOptions().data.buttonCaption}})}if(t==="spam_protection"){return new G({values:{key:this.getFormOptions().captcha.key,secret:this.getFormOptions().captcha.secret,use:D.Text.toBoolean(this.getFormOptions().data.recaptcha.use)}})}if(t==="agreements"){return new P({formOptions:this.getFormOptions(),agreementsList:this.getAgreements(),values:{agreements:this.getFormOptions().data.agreements}})}if(t==="analytics"){return new W({events:this.getFormOptions().analytics.steps,values:{}})}if(t==="fields"){return new Z({crmFields:this.getCrmFields(),formOptions:this.getFormOptions(),dictionary:this.getFormDictionary(),isLeadEnabled:this.isLeadEnabled(),values:{fields:this.getFormOptions().data.fields}})}if(t==="fields_rules"){return new q({fields:this.getFormOptions().data.fields,values:this.getFormOptions().data.dependencies,dictionary:this.getFormDictionary()})}if(t==="actions"){var a=new te({fields:this.getFormOptions().data.fields,values:this.getFormOptions().result});a.subscribe("onShowSuccess",function(){i.stateText=n.getFormOptions().result.success.text;i.sent=!i.sent;i.error=false}).subscribe("onShowFailure",function(){i.stateText=n.getFormOptions().result.failure.text;i.error=!i.error;i.sent=false});return a}if(t==="embed"){return new _e({fields:this.getFormOptions().data.fields,values:this.getFormOptions().embedding})}if(t==="identify"){return new fe({fields:this.getFormOptions().data.fields,values:{}})}if(t==="crm"){return new be({fields:this.getFormOptions().data.fields,companies:this.getCrmCompanies(),categories:this.getCrmCategories(),isLeadEnabled:this.isLeadEnabled(),formDictionary:this.getFormDictionary(),values:{scheme:this.getFormOptions().document.scheme,duplicatesEnabled:this.getFormOptions().document.deal.duplicatesEnabled||"Y",category:this.getFormOptions().document.deal.category,dynamicCategory:this.getFormOptions().document.dynamic.category,payment:this.getFormOptions().payment.use,duplicateMode:this.getFormOptions().document.duplicateMode}})}if(t==="default_values"){return new ve({crmFields:this.getCrmFields(),formOptions:this.getFormOptions(),dictionary:this.getFormDictionary(),isLeadEnabled:this.isLeadEnabled(),personalizationVariables:this.getDefaultValuesVariables(),values:{fields:this.getFormOptions().presetFields}})}if(t==="facebook"){return new Ne({formOptions:this.getFormOptions()})}if(t==="vk"){return new Se({formOptions:this.getFormOptions()})}if(t==="callback"){return new ye({dictionary:this.getFormDictionary(),values:this.getFormOptions().callback})}if(t==="other"){return new Ce({formOptions:this.getFormOptions(),dictionary:this.getFormDictionary(),values:{name:this.getFormOptions().name,useSign:this.getFormOptions().data.useSign,users:this.getFormOptions().responsible.users,language:this.getFormOptions().data.language}})}return null}},{key:"applyPreset",value:function e(t){var n=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.getPresets().forEach(function(e){e.deactivate()});t.activate();if(D.Type.isPlainObject(t.options.options)&&!i){this.showLoader();var a=babelHelpers.objectSpread({data:{}},D.Runtime.clone(t.options.options));var r=[];if(Reflect.has(a.data,"agreements")){var o=this.getAgreements();r=babelHelpers.toConsumableArray(a.data.agreements);a.data.agreements=a.data.agreements.map(function(e,t){return o[t].id})}I.FormClient.getInstance().prepareOptions(this.getFormOptions(),a.data).then(function(e){if(Reflect.has(a.data,"fields")){delete a.data.fields}if(Reflect.has(a.data,"agreements")){delete a.data.agreements}var i=D.Runtime.merge({},e,a);i.data.agreements=i.data.agreements.map(function(e,t){return babelHelpers.objectSpread({},e,r[t])});n.setFormOptions(i);n.getCrmForm().adjust(D.Runtime.clone(i.data));babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"applyPreset",n).call(n,t);n.hideLoader()})}else{babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"applyPreset",this).call(this,t)}}},{key:"getFormNode",value:function e(){var t=this;return this.cache.remember("formNode",function(){return t.getCurrentBlock().node.querySelector("[data-b24form-use-style]")})}},{key:"useBlockDesign",value:function e(){var t=this;return this.cache.remember("useBlockDesign",function(){return D.Text.toBoolean(D.Dom.attr(t.getFormNode(),"data-b24form-use-style"))})}},{key:"getCurrentCrmEntityName",value:function e(){var t=this.getFormOptions().document.scheme;var n=this.getFormDictionary().document.schemes.find(function(e){return String(t)===String(e.id)});return n.name}},{key:"getNotSynchronizedFields",value:function e(){return I.FormClient.getInstance().checkFields(this.getFormOptions()).then(function(e){return e})}},{key:"showSynchronizationPopup",value:function e(t){var n=this;return new Promise(function(e){var i=function t(n){n.close();e(true)};var a=function t(n){n.close();e(false)};var s=function(){var e=O.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_ENTITY_TEMPLATE").replace("{entityName}",n.getCurrentCrmEntityName());return O.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_DESCRIPTION").replace("{entityName}",e)}();var r=function(){var e=babelHelpers.toConsumableArray(t).map(function(e){return O.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_FIELD_TEMPLATE").replace("{fieldName}",e)});if(t.length>1){var n=e.pop();return O.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_TEXT").replace("{fieldsList}",e.join(", ")).replace("{lastField}",n)}return O.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_TEXT_1").replace("{field}",e.join(", "))}();window.top.BX.UI.Dialogs.MessageBox.confirm("".concat(s,"<br><br>").concat(r),O.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_TITLE"),i,O.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_OK_BUTTON_LABEL"),a)})}},{key:"showSynchronizationErrorPopup",value:function e(t){var n=t.reduce(function(e,t){return"".concat(e,"\n\n").concat(t)},"");window.top.BX.UI.Dialogs.MessageBox.alert(n)}},{key:"onSaveClick",value:function e(){var t=this;D.Dom.addClass(this.getSaveButton().layout,"ui-btn-wait");this.getNotSynchronizedFields().then(function(e){if(D.Type.isPlainObject(e.sync)){if(D.Type.isArrayFilled(e.sync.errors)){t.showSynchronizationErrorPopup(e.sync.errors);return false}if(D.Type.isArrayFilled(e.sync.fields)){var n=e.sync.fields.map(function(e){return e.label});return t.showSynchronizationPopup(n)}}return true}).then(function(e){if(e){var n=new D.Uri(window.top.location.toString());n.removeQueryParam("formCreated");window.top.history.replaceState(null,document.title,n.toString());var i=t.getInitialFormOptions();var a=t.getFormOptions();var s=function(){if(!t.isCrmFormPage()){var e=D.Runtime.clone(a);e.data.design=D.Runtime.clone(i.data.design);return e}return a}();void I.FormClient.getInstance().saveOptions(s).then(function(e){t.setFormOptions(e);I.FormClient.getInstance().resetCache(e.id);D.Dom.removeClass(t.getSaveButton().layout,"ui-btn-wait");void t.hide()});if(t.useBlockDesign()&&t.isCrmFormPage()){t.disableUseBlockDesign()}}else{D.Dom.removeClass(t.getSaveButton().layout,"ui-btn-wait")}})}},{key:"disableUseBlockDesign",value:function e(){D.Dom.attr(this.getFormNode(),"data-b24form-use-style","N");this.cache.set("useBlockDesign",false);t.Backend.getInstance().action("Landing\\Block::updateNodes",{block:this.getCurrentBlock().id,data:{".bitrix24forms":{attrs:{"data-b24form-use-style":"N"}}},lid:this.getCurrentBlock().lid,siteId:this.getCurrentBlock().siteId},{code:this.getCurrentBlock().manifest.code})}},{key:"onCancelClick",value:function e(){this.getCrmForm().adjust(this.getInitialFormOptions().data);void this.hide()}}],[{key:"sanitize",value:function e(t){if(D.Type.isStringFilled(t)){return D.Text.decode(t).replace(/<style[^>]*>.*<\/style>/gm,"").replace(/<script[^>]*>.*<\/script>/gm,"").replace(/<[^>]+>/gm,"")}return t}}]);return s}(M.BasePresetPanel);e.FormSettingsPanel=Ve})(this.BX.Landing.UI.Panel=this.BX.Landing.UI.Panel||{},BX.Landing,BX,BX.Landing,BX.Landing.UI.Panel,BX.UI.Dialogs,BX,BX.Landing.UI.Field,BX.Landing.UI.Field,BX.Landing.UI.Field,BX.Landing.UI.Field,BX.Landing.UI.Component,BX.Landing.UI.Component,BX.Landing.UI.Field,BX.Landing.UI.Field,BX.Landing.UI.Component,BX.Landing.UI.Field,BX.Landing.UI.Field,BX.UI,BX.Landing.UI.Card,BX.Crm.Form,BX.Landing.UI.Card,BX.Landing.UI.Card,BX.Landing.UI.Form,BX.Landing.UI.Field,BX.Event,BX.Landing.UI.Field,BX.UI.EntitySelector,BX.Landing,BX,BX.Landing.UI.Button,BX.Landing,BX.Landing.UI.Panel);
//# sourceMappingURL=formsettingspanel.bundle.map.js