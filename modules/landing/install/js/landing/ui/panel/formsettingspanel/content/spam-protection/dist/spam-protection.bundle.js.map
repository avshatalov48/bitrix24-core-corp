{"version":3,"file":"spam-protection.bundle.js","sources":["../src/internal/keys-form.js","../src/spam-protection.js"],"sourcesContent":["import {FormSettingsForm} from 'landing.ui.form.formsettingsform';\n\nimport './keys-form.css';\nimport {Dom, Runtime, Type} from 'main.core';\nimport {Button, ButtonColor} from 'ui.buttons';\nimport {FormSettingsPanel} from 'landing.ui.panel.formsettingspanel';\n\nexport default class KeysForm extends FormSettingsForm\n{\n\tconstructor(options: {[key: string]: any})\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.Content.SpamProtection.KeysForm');\n\t\tDom.addClass(this.layout, 'landing-ui-form-form-keys-settings');\n\n\t\tthis.getButton().renderTo(this.layout);\n\n\t\tthis.value = {};\n\t}\n\n\tgetButton(): Button\n\t{\n\t\treturn this.cache.remember('button', () => {\n\t\t\treturn new Button({\n\t\t\t\ttext: this.options.buttonLabel,\n\t\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.getButton().setWaiting(true);\n\n\t\t\t\t\tRuntime\n\t\t\t\t\t\t.loadExtension('crm.form.captcha')\n\t\t\t\t\t\t.then(({Captcha}) => {\n\t\t\t\t\t\t\tthis.getButton().setWaiting(false);\n\t\t\t\t\t\t\treturn Captcha.open();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tthis.value = {...result};\n\t\t\t\t\t\t\tconst formSettingsPanel = FormSettingsPanel.getInstance();\n\t\t\t\t\t\t\tformSettingsPanel.getFormDictionary().captcha.hasKeys = (\n\t\t\t\t\t\t\t\tType.isStringFilled(result.key) && Type.isStringFilled(result.secret)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tconst activeButton = formSettingsPanel.getSidebarButtons().find((button) => {\n\t\t\t\t\t\t\t\treturn button.isActive();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (activeButton)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tactiveButton.getLayout().click();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.emit('onChange');\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tserialize(): { [p: string]: * }\n\t{\n\t\treturn this.value;\n\t}\n}","import {HeaderCard} from 'landing.ui.card.headercard';\nimport {Loc} from 'landing.loc';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {RadioButtonField} from 'landing.ui.field.radiobuttonfield';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {Dom, Text} from 'main.core';\nimport KeysForm from './internal/keys-form';\nimport {MessageCard} from 'landing.ui.card.messagecard';\n\nimport './css/style.css';\n\nexport default class SpamProtection extends ContentWrapper\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.SpamProtection');\n\n\t\tconst header = new HeaderCard({\n\t\t\ttitle: Loc.getMessage('LANDING_SPAM_PROTECTION_TITLE'),\n\t\t});\n\n\t\tconst message = new MessageCard({\n\t\t\theader: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_MESSAGE_TITLE'),\n\t\t\tdescription: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_MESSAGE_TEXT'),\n\t\t\tangle: false,\n\t\t});\n\n\t\tconst captchaTypeForm = new FormSettingsForm({\n\t\t\tid: 'type',\n\t\t\tdescription: null,\n\t\t\tfields: [\n\t\t\t\tnew MessageCard({\n\t\t\t\t\tselector: 'warning-captcha',\n\t\t\t\t\tcontext: 'warning',\n\t\t\t\t\tdescription: Loc.getMessage('LANDING_SPAM_PROTECTION_MESSAGE_WARNING_RECAPTCHA')\n\t\t\t\t\t\t.replace('#URL_POLICIES_PRIVACY#', \"https://policies.google.com/privacy\")\n\t\t\t\t\t\t.replace('#URL_POLICIES_TERMS#', 'https://policies.google.com/terms')\n\t\t\t\t\t,\n\t\t\t\t\tangle: false,\n\t\t\t\t\tcloseable: false,\n\t\t\t\t}),\n\t\t\t\tnew RadioButtonField({\n\t\t\t\t\tselector: 'use',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_SPAM_PROTECTION_TABS_TITLE'),\n\t\t\t\t\tvalue: Text.toBoolean(this.options.formOptions.data.recaptcha.use) ? 'hidden' : 'disabled',\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'disabled',\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_SPAM_PROTECTION_TAB_DISABLED'),\n\t\t\t\t\t\t\ticon: 'landing-ui-spam-protection-icon-disabled',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'hidden',\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_SPAM_PROTECTION_TAB_HIDDEN'),\n\t\t\t\t\t\t\ticon: 'landing-ui-spam-protection-icon-hidden',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.addItem(header);\n\t\tthis.addItem(message);\n\t\tthis.addItem(captchaTypeForm);\n\n\t\tcaptchaTypeForm.subscribe('onChange', this.onTypeChange.bind(this));\n\t\tthis.onTypeChange();\n\t}\n\n\thasDefaultsCaptchaKeys(): boolean\n\t{\n\t\treturn Text.toBoolean(this.options.formOptions.captcha.hasDefaults);\n\t}\n\n\thasCustomKeys(): boolean\n\t{\n\t\treturn Text.toBoolean(this.options.dictionary.captcha.hasKeys);\n\t}\n\n\tonTypeChange()\n\t{\n\t\tDom.remove(this.getCustomKeysForm().getLayout());\n\t\tDom.remove(this.getRequiredKeysForm().getLayout());\n\t\tDom.remove(this.getKeysSettingsForm().getLayout());\n\n\t\tif (this.getValue().recaptcha.use)\n\t\t{\n\t\t\tif (!this.hasDefaultsCaptchaKeys() && !this.hasCustomKeys())\n\t\t\t{\n\t\t\t\tthis.addItem(this.getRequiredKeysForm());\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(!this.hasDefaultsCaptchaKeys() && this.hasCustomKeys())\n\t\t\t\t|| (this.hasDefaultsCaptchaKeys() && this.hasCustomKeys())\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.addItem(this.getKeysSettingsForm());\n\t\t\t}\n\n\t\t\tif (this.hasDefaultsCaptchaKeys() && !this.hasCustomKeys())\n\t\t\t{\n\t\t\t\tthis.addItem(this.getCustomKeysForm());\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCustomKeysForm(): KeysForm\n\t{\n\t\treturn this.cache.remember('customKeysForm', () => {\n\t\t\treturn new KeysForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_TITLE'),\n\t\t\t\tbuttonLabel: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_CUSTOM_BUTTON_LABEL'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetRequiredKeysForm()\n\t{\n\t\treturn this.cache.remember('requiredKeysForm', () => {\n\t\t\treturn new KeysForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_TITLE'),\n\t\t\t\tbuttonLabel: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_BUTTON_LABEL'),\n\t\t\t\tdescription: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_REQUIRED_DESCRIPTION'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetKeysSettingsForm(): KeysForm\n\t{\n\t\treturn this.cache.remember('keysSettingsForm', () => {\n\t\t\treturn new KeysForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_TITLE'),\n\t\t\t\tbuttonLabel: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_CHANGE_BUTTON_LABEL'),\n\t\t\t});\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tvalueReducer(sourceValue: {[p: string]: any}): {[p: string]: any}\n\t{\n\t\treturn {\n\t\t\trecaptcha: {\n\t\t\t\tuse: sourceValue.use === 'hidden',\n\t\t\t\t...this.getKeysSettingsForm().serialize(),\n\t\t\t\t...this.getCustomKeysForm().serialize(),\n\t\t\t\t...this.getRequiredKeysForm().serialize(),\n\t\t\t},\n\t\t};\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n}\n"],"names":["KeysForm","options","setEventNamespace","Dom","addClass","layout","getButton","renderTo","value","cache","remember","Button","text","buttonLabel","color","ButtonColor","LIGHT_BORDER","onclick","setWaiting","Runtime","loadExtension","then","Captcha","open","result","formSettingsPanel","FormSettingsPanel","getInstance","getFormDictionary","captcha","hasKeys","Type","isStringFilled","key","secret","activeButton","getSidebarButtons","find","button","isActive","getLayout","click","emit","FormSettingsForm","SpamProtection","header","HeaderCard","title","Loc","getMessage","message","MessageCard","description","angle","captchaTypeForm","id","fields","selector","context","replace","closeable","RadioButtonField","Text","toBoolean","formOptions","data","recaptcha","use","items","icon","addItem","subscribe","onTypeChange","bind","hasDefaults","dictionary","remove","getCustomKeysForm","getRequiredKeysForm","getKeysSettingsForm","getValue","hasDefaultsCaptchaKeys","hasCustomKeys","sourceValue","serialize","event","getData","skipPrepare","ContentWrapper"],"mappings":"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"}