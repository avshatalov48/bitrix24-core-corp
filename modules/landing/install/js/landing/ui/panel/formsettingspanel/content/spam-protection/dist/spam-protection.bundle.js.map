{"version":3,"file":"spam-protection.bundle.js","sources":["../src/internal/keys-form.js","../src/spam-protection.js"],"sourcesContent":["import {FormSettingsForm} from 'landing.ui.form.formsettingsform';\n\nimport './keys-form.css';\nimport {Dom, Runtime, Type} from 'main.core';\nimport {Button, ButtonColor} from 'ui.buttons';\nimport {FormSettingsPanel} from 'landing.ui.panel.formsettingspanel';\n\nexport default class KeysForm extends FormSettingsForm\n{\n\tconstructor(options: {[key: string]: any})\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.Content.SpamProtection.KeysForm');\n\t\tDom.addClass(this.layout, 'landing-ui-form-form-keys-settings');\n\n\t\tthis.getButton().renderTo(this.layout);\n\n\t\tthis.value = {};\n\t}\n\n\tgetButton(): Button\n\t{\n\t\treturn this.cache.remember('button', () => {\n\t\t\treturn new Button({\n\t\t\t\ttext: this.options.buttonLabel,\n\t\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.getButton().setWaiting(true);\n\n\t\t\t\t\tRuntime\n\t\t\t\t\t\t.loadExtension('crm.form.captcha')\n\t\t\t\t\t\t.then(({Captcha}) => {\n\t\t\t\t\t\t\tthis.getButton().setWaiting(false);\n\t\t\t\t\t\t\treturn Captcha.open();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tthis.value = {...result};\n\t\t\t\t\t\t\tconst formSettingsPanel = FormSettingsPanel.getInstance();\n\t\t\t\t\t\t\tformSettingsPanel.getFormDictionary().captcha.hasKeys = (\n\t\t\t\t\t\t\t\tType.isStringFilled(result.key) && Type.isStringFilled(result.secret)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tconst activeButton = formSettingsPanel.getSidebarButtons().find((button) => {\n\t\t\t\t\t\t\t\treturn button.isActive();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (activeButton)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tactiveButton.getLayout().click();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.emit('onChange');\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tserialize(): { [p: string]: * }\n\t{\n\t\treturn this.value;\n\t}\n}","import {HeaderCard} from 'landing.ui.card.headercard';\nimport {Loc} from 'landing.loc';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {RadioButtonField} from 'landing.ui.field.radiobuttonfield';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {Dom, Text} from 'main.core';\nimport KeysForm from './internal/keys-form';\nimport {MessageCard} from 'landing.ui.card.messagecard';\n\nimport './css/style.css';\n\nexport default class SpamProtection extends ContentWrapper\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.SpamProtection');\n\n\t\tconst header = new HeaderCard({\n\t\t\ttitle: Loc.getMessage('LANDING_SPAM_PROTECTION_TITLE'),\n\t\t});\n\n\t\tconst message = new MessageCard({\n\t\t\theader: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_MESSAGE_TITLE'),\n\t\t\tdescription: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_MESSAGE_TEXT'),\n\t\t\tangle: false,\n\t\t});\n\n\t\tconst captchaTypeForm = new FormSettingsForm({\n\t\t\tid: 'type',\n\t\t\tdescription: null,\n\t\t\tfields: [\n\t\t\t\tnew RadioButtonField({\n\t\t\t\t\tselector: 'use',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_SPAM_PROTECTION_TABS_TITLE'),\n\t\t\t\t\tvalue: Text.toBoolean(this.options.formOptions.data.recaptcha.use) ? 'hidden' : 'disabled',\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'disabled',\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_SPAM_PROTECTION_TAB_DISABLED'),\n\t\t\t\t\t\t\ticon: 'landing-ui-spam-protection-icon-disabled',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'hidden',\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_SPAM_PROTECTION_TAB_HIDDEN'),\n\t\t\t\t\t\t\ticon: 'landing-ui-spam-protection-icon-hidden',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.addItem(header);\n\t\tthis.addItem(message);\n\t\tthis.addItem(captchaTypeForm);\n\n\t\tcaptchaTypeForm.subscribe('onChange', this.onTypeChange.bind(this));\n\t\tthis.onTypeChange();\n\t}\n\n\thasDefaultsCaptchaKeys(): boolean\n\t{\n\t\treturn Text.toBoolean(this.options.formOptions.captcha.hasDefaults);\n\t}\n\n\thasCustomKeys(): boolean\n\t{\n\t\treturn Text.toBoolean(this.options.dictionary.captcha.hasKeys);\n\t}\n\n\tonTypeChange()\n\t{\n\t\tDom.remove(this.getCustomKeysForm().getLayout());\n\t\tDom.remove(this.getRequiredKeysForm().getLayout());\n\t\tDom.remove(this.getKeysSettingsForm().getLayout());\n\n\t\tif (this.getValue().recaptcha.use)\n\t\t{\n\t\t\tif (!this.hasDefaultsCaptchaKeys() && !this.hasCustomKeys())\n\t\t\t{\n\t\t\t\tthis.addItem(this.getRequiredKeysForm());\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(!this.hasDefaultsCaptchaKeys() && this.hasCustomKeys())\n\t\t\t\t|| (this.hasDefaultsCaptchaKeys() && this.hasCustomKeys())\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.addItem(this.getKeysSettingsForm());\n\t\t\t}\n\n\t\t\tif (this.hasDefaultsCaptchaKeys() && !this.hasCustomKeys())\n\t\t\t{\n\t\t\t\tthis.addItem(this.getCustomKeysForm());\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCustomKeysForm(): KeysForm\n\t{\n\t\treturn this.cache.remember('customKeysForm', () => {\n\t\t\treturn new KeysForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_TITLE'),\n\t\t\t\tbuttonLabel: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_CUSTOM_BUTTON_LABEL'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetRequiredKeysForm()\n\t{\n\t\treturn this.cache.remember('requiredKeysForm', () => {\n\t\t\treturn new KeysForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_TITLE'),\n\t\t\t\tbuttonLabel: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_BUTTON_LABEL'),\n\t\t\t\tdescription: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_REQUIRED_DESCRIPTION'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetKeysSettingsForm(): KeysForm\n\t{\n\t\treturn this.cache.remember('keysSettingsForm', () => {\n\t\t\treturn new KeysForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_TITLE'),\n\t\t\t\tbuttonLabel: Loc.getMessage('LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_CHANGE_BUTTON_LABEL'),\n\t\t\t});\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tvalueReducer(sourceValue: {[p: string]: any}): {[p: string]: any}\n\t{\n\t\treturn {\n\t\t\trecaptcha: {\n\t\t\t\tuse: sourceValue.use === 'hidden',\n\t\t\t\t...this.getKeysSettingsForm().serialize(),\n\t\t\t\t...this.getCustomKeysForm().serialize(),\n\t\t\t\t...this.getRequiredKeysForm().serialize(),\n\t\t\t},\n\t\t};\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n}"],"names":["KeysForm","options","setEventNamespace","Dom","addClass","layout","getButton","renderTo","value","cache","remember","Button","text","buttonLabel","color","ButtonColor","LIGHT_BORDER","onclick","setWaiting","Runtime","loadExtension","then","Captcha","open","result","formSettingsPanel","FormSettingsPanel","getInstance","getFormDictionary","captcha","hasKeys","Type","isStringFilled","key","secret","activeButton","getSidebarButtons","find","button","isActive","getLayout","click","emit","FormSettingsForm","SpamProtection","header","HeaderCard","title","Loc","getMessage","message","MessageCard","description","angle","captchaTypeForm","id","fields","RadioButtonField","selector","Text","toBoolean","formOptions","data","recaptcha","use","items","icon","addItem","subscribe","onTypeChange","bind","hasDefaults","dictionary","remove","getCustomKeysForm","getRequiredKeysForm","getKeysSettingsForm","getValue","hasDefaultsCaptchaKeys","hasCustomKeys","sourceValue","serialize","event","getData","skipPrepare","ContentWrapper"],"mappings":"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"}