{"version":3,"file":"whatsapp.bundle.js","sources":["../src/whatsapp.js"],"sourcesContent":["import {Dom, Text, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Loc} from 'landing.loc';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {HeaderCard} from 'landing.ui.card.headercard';\nimport {TextField} from 'landing.ui.field.textfield';\nimport {MessageCard} from 'landing.ui.card.messagecard';\nimport {FormClient} from 'crm.form.client';\nimport {FormSettingsPanel} from 'landing.ui.panel.formsettingspanel';\n\nexport default class Whatsapp extends ContentWrapper\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.Whatsapp');\n\n\t\tthis.addItem(this.getHeader());\n\n\t\tif (this.options.dictionary.whatsapp.setup.completed)\n\t\t{\n\t\t\tthis.addItem(this.getSettingsForm());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addItem(this.getWarningMessage());\n\t\t}\n\t}\n\n\tgetHeader(): HeaderCard\n\t{\n\t\treturn this.cache.remember('header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_WHATSAPP_TITLE'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetWarningMessage()\n\t{\n\t\treturn this.cache.remember('warningMessage', () => {\n\t\t\treturn new MessageCard({\n\t\t\t\theader: Loc.getMessage('LANDING_FORM_WHATSAPP_WARNING_HEADER'),\n\t\t\t\tdescription: Loc.getMessage('LANDING_FORM_WHATSAPP_WARNING_TEXT'),\n\t\t\t\tangle: false,\n\t\t\t\tcloseable: false,\n\t\t\t\tmore: () => {\n\t\t\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\t\t\tthis.options.dictionary.whatsapp.setup.link,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\t\t\tFormClient\n\t\t\t\t\t\t\t\t\t\t.getInstance()\n\t\t\t\t\t\t\t\t\t\t.getDictionary()\n\t\t\t\t\t\t\t\t\t\t.then((dictionary) => {\n\t\t\t\t\t\t\t\t\t\t\tthis.options.dictionary = dictionary;\n\t\t\t\t\t\t\t\t\t\t\tFormSettingsPanel.getInstance().setFormDictionary(dictionary);\n\n\t\t\t\t\t\t\t\t\t\t\tthis.clear();\n\n\t\t\t\t\t\t\t\t\t\t\tthis.addItem(this.getHeader());\n\n\t\t\t\t\t\t\t\t\t\t\tif (this.options.dictionary.whatsapp.setup.completed)\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tthis.addItem(this.getSettingsForm());\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tthis.addItem(this.getWarningMessage());\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('settingsForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_WHATSAPP_USE_CHECKBOX_LABEL'),\n\t\t\t\tfields: [\n\t\t\t\t\tthis.getTextField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetUseCheckboxField(): BX.Landing.UI.Field.Checkbox\n\t{\n\t\treturn this.cache.remember('useCheckboxField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Checkbox({\n\t\t\t\tselector: 'use',\n\t\t\t\tcompact: true,\n\t\t\t\tvalue: [Text.toBoolean(this.options.formOptions.whatsapp.use)],\n\t\t\t\titems: [\n\t\t\t\t\t{name: Loc.getMessage('LANDING_FORM_SETTINGS_CALLBACK_USE_CHECKBOX_LABEL'), value: true},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTextField()\n\t{\n\t\treturn this.cache.remember('textField', () => {\n\t\t\tconst textItem = this.options.dictionary.whatsapp.messages.find((item) => {\n\t\t\t\treturn String(item.langId) === String(this.options.data.language);\n\t\t\t});\n\t\t\tconst text = Type.isPlainObject(textItem) ? textItem.text : '';\n\n\t\t\tconst field = new TextField({\n\t\t\t\tselector: 'text',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_WHATSAPP_TEXT_TITLE'),\n\t\t\t\tcontent: text,\n\t\t\t\ttextOnly: true,\n\t\t\t});\n\n\t\t\tDom.addClass(field.input, 'landing-ui-disabled');\n\n\t\t\treturn field;\n\t\t});\n\t}\n\n\tvalueReducer(value: {[key: string]: any}): {[key: string]: any}\n\t{\n\t\treturn {\n\t\t\twhatsapp: {\n\t\t\t\tuse: this.getSettingsForm().isOpened(),\n\t\t\t},\n\t\t};\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n}"],"names":["Whatsapp","options","setEventNamespace","addItem","getHeader","dictionary","whatsapp","setup","completed","getSettingsForm","getWarningMessage","cache","remember","HeaderCard","title","Loc","getMessage","MessageCard","header","description","angle","closeable","more","BX","SidePanel","Instance","open","link","events","onClose","FormClient","getInstance","getDictionary","then","FormSettingsPanel","setFormDictionary","clear","FormSettingsForm","fields","getTextField","Landing","UI","Field","Checkbox","selector","compact","value","Text","toBoolean","formOptions","use","items","name","textItem","messages","find","item","String","langId","data","language","text","Type","isPlainObject","field","TextField","content","textOnly","Dom","addClass","input","isOpened","event","emit","getData","skipPrepare","ContentWrapper"],"mappings":"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"}