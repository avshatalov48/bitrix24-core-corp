{"version":3,"file":"whatsapp.bundle.js","sources":["../src/whatsapp.js"],"sourcesContent":["import {Dom, Text, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Loc} from 'landing.loc';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {HeaderCard} from 'landing.ui.card.headercard';\nimport {TextField} from 'landing.ui.field.textfield';\nimport {MessageCard} from 'landing.ui.card.messagecard';\nimport {FormClient} from 'crm.form.client';\nimport {FormSettingsPanel} from 'landing.ui.panel.formsettingspanel';\n\nexport default class Whatsapp extends ContentWrapper\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.Whatsapp');\n\n\t\tthis.addItem(this.getHeader());\n\n\t\tif (this.options.dictionary.whatsapp.setup.completed)\n\t\t{\n\t\t\tthis.addItem(this.getSettingsForm());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addItem(this.getWarningMessage());\n\t\t}\n\t}\n\n\tgetHeader(): HeaderCard\n\t{\n\t\treturn this.cache.remember('header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_WHATSAPP_TITLE'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetWarningMessage()\n\t{\n\t\treturn this.cache.remember('warningMessage', () => {\n\t\t\treturn new MessageCard({\n\t\t\t\theader: Loc.getMessage('LANDING_FORM_WHATSAPP_WARNING_HEADER'),\n\t\t\t\tdescription: Loc.getMessage('LANDING_FORM_WHATSAPP_WARNING_TEXT'),\n\t\t\t\tangle: false,\n\t\t\t\tcloseable: false,\n\t\t\t\tmore: () => {\n\t\t\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\t\t\tthis.options.dictionary.whatsapp.setup.link,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\t\t\tFormClient\n\t\t\t\t\t\t\t\t\t\t.getInstance()\n\t\t\t\t\t\t\t\t\t\t.getDictionary()\n\t\t\t\t\t\t\t\t\t\t.then((dictionary) => {\n\t\t\t\t\t\t\t\t\t\t\tthis.options.dictionary = dictionary;\n\t\t\t\t\t\t\t\t\t\t\tFormSettingsPanel.getInstance().setFormDictionary(dictionary);\n\n\t\t\t\t\t\t\t\t\t\t\tthis.clear();\n\n\t\t\t\t\t\t\t\t\t\t\tthis.addItem(this.getHeader());\n\n\t\t\t\t\t\t\t\t\t\t\tif (this.options.dictionary.whatsapp.setup.completed)\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tthis.addItem(this.getSettingsForm());\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tthis.addItem(this.getWarningMessage());\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('settingsForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_WHATSAPP_USE_CHECKBOX_LABEL'),\n\t\t\t\tfields: [\n\t\t\t\t\tthis.getTextField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetUseCheckboxField(): BX.Landing.UI.Field.Checkbox\n\t{\n\t\treturn this.cache.remember('useCheckboxField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Checkbox({\n\t\t\t\tselector: 'use',\n\t\t\t\tcompact: true,\n\t\t\t\tvalue: [Text.toBoolean(this.options.formOptions.whatsapp.use)],\n\t\t\t\titems: [\n\t\t\t\t\t{name: Loc.getMessage('LANDING_FORM_SETTINGS_CALLBACK_USE_CHECKBOX_LABEL'), value: true},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTextField()\n\t{\n\t\treturn this.cache.remember('textField', () => {\n\t\t\tconst textItem = this.options.dictionary.whatsapp.messages.find((item) => {\n\t\t\t\treturn String(item.langId) === String(this.options.data.language);\n\t\t\t});\n\t\t\tconst text = Type.isPlainObject(textItem) ? textItem.text : '';\n\n\t\t\tconst field = new TextField({\n\t\t\t\tselector: 'text',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_WHATSAPP_TEXT_TITLE'),\n\t\t\t\tcontent: text,\n\t\t\t\ttextOnly: true,\n\t\t\t});\n\n\t\t\tDom.addClass(field.input, 'landing-ui-disabled');\n\n\t\t\treturn field;\n\t\t});\n\t}\n\n\tvalueReducer(value: {[key: string]: any}): {[key: string]: any}\n\t{\n\t\treturn {\n\t\t\twhatsapp: {\n\t\t\t\tuse: this.getSettingsForm().isOpened(),\n\t\t\t},\n\t\t};\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n}"],"names":["Whatsapp","options","setEventNamespace","addItem","getHeader","dictionary","whatsapp","setup","completed","getSettingsForm","getWarningMessage","cache","remember","HeaderCard","title","Loc","getMessage","MessageCard","header","description","angle","closeable","more","BX","SidePanel","Instance","open","link","events","onClose","FormClient","getInstance","getDictionary","then","FormSettingsPanel","setFormDictionary","clear","FormSettingsForm","fields","getTextField","Landing","UI","Field","Checkbox","selector","compact","value","Text","toBoolean","formOptions","use","items","name","textItem","messages","find","item","String","langId","data","language","text","Type","isPlainObject","field","TextField","content","textOnly","Dom","addClass","input","isOpened","event","emit","getData","skipPrepare","ContentWrapper"],"mappings":"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"}