{"version":3,"file":"whatsapp.bundle.js","sources":["../src/whatsapp.js"],"sourcesContent":["import {Dom, Text, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Loc} from 'landing.loc';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {HeaderCard} from 'landing.ui.card.headercard';\nimport {TextField} from 'landing.ui.field.textfield';\nimport {MessageCard} from 'landing.ui.card.messagecard';\nimport {FormClient} from 'crm.form.client';\nimport {FormSettingsPanel} from 'landing.ui.panel.formsettingspanel';\n\nexport default class Whatsapp extends ContentWrapper\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.Whatsapp');\n\n\t\tthis.addItem(this.getHeader());\n\n\t\tif (this.options.dictionary.whatsapp.setup.completed)\n\t\t{\n\t\t\tthis.addItem(this.getSettingsForm());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addItem(this.getWarningMessage());\n\t\t}\n\t}\n\n\tgetHeader(): HeaderCard\n\t{\n\t\treturn this.cache.remember('header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_WHATSAPP_TITLE'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetWarningMessage()\n\t{\n\t\treturn this.cache.remember('warningMessage', () => {\n\t\t\treturn new MessageCard({\n\t\t\t\theader: Loc.getMessage('LANDING_FORM_WHATSAPP_WARNING_HEADER'),\n\t\t\t\tdescription: Loc.getMessage('LANDING_FORM_WHATSAPP_WARNING_TEXT'),\n\t\t\t\tangle: false,\n\t\t\t\tcloseable: false,\n\t\t\t\tmore: () => {\n\t\t\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\t\t\tthis.options.dictionary.whatsapp.setup.link,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\t\t\tFormClient\n\t\t\t\t\t\t\t\t\t\t.getInstance()\n\t\t\t\t\t\t\t\t\t\t.getDictionary()\n\t\t\t\t\t\t\t\t\t\t.then((dictionary) => {\n\t\t\t\t\t\t\t\t\t\t\tthis.options.dictionary = dictionary;\n\t\t\t\t\t\t\t\t\t\t\tFormSettingsPanel.getInstance().setFormDictionary(dictionary);\n\n\t\t\t\t\t\t\t\t\t\t\tthis.clear();\n\n\t\t\t\t\t\t\t\t\t\t\tthis.addItem(this.getHeader());\n\n\t\t\t\t\t\t\t\t\t\t\tif (this.options.dictionary.whatsapp.setup.completed)\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tthis.addItem(this.getSettingsForm());\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tthis.addItem(this.getWarningMessage());\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('settingsForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_WHATSAPP_USE_CHECKBOX_LABEL'),\n\t\t\t\tfields: [\n\t\t\t\t\tthis.getTextField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetUseCheckboxField(): BX.Landing.UI.Field.Checkbox\n\t{\n\t\treturn this.cache.remember('useCheckboxField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Checkbox({\n\t\t\t\tselector: 'use',\n\t\t\t\tcompact: true,\n\t\t\t\tvalue: [Text.toBoolean(this.options.formOptions.whatsapp.use)],\n\t\t\t\titems: [\n\t\t\t\t\t{name: Loc.getMessage('LANDING_FORM_SETTINGS_CALLBACK_USE_CHECKBOX_LABEL'), value: true},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTextField()\n\t{\n\t\treturn this.cache.remember('textField', () => {\n\t\t\tconst textItem = this.options.dictionary.whatsapp.messages.find((item) => {\n\t\t\t\treturn String(item.langId) === String(this.options.data.language);\n\t\t\t});\n\t\t\tconst text = Type.isPlainObject(textItem) ? textItem.text : '';\n\n\t\t\tconst field = new TextField({\n\t\t\t\tselector: 'text',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_WHATSAPP_TEXT_TITLE'),\n\t\t\t\tcontent: text,\n\t\t\t\ttextOnly: true,\n\t\t\t});\n\n\t\t\tDom.addClass(field.input, 'landing-ui-disabled');\n\n\t\t\treturn field;\n\t\t});\n\t}\n\n\tvalueReducer(value: {[key: string]: any}): {[key: string]: any}\n\t{\n\t\treturn {\n\t\t\twhatsapp: {\n\t\t\t\tuse: this.getSettingsForm().isOpened(),\n\t\t\t},\n\t\t};\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n}"],"names":["Whatsapp","options","setEventNamespace","addItem","getHeader","dictionary","whatsapp","setup","completed","getSettingsForm","getWarningMessage","cache","remember","HeaderCard","title","Loc","getMessage","MessageCard","header","description","angle","closeable","more","BX","SidePanel","Instance","open","link","events","onClose","FormClient","getInstance","getDictionary","then","FormSettingsPanel","setFormDictionary","clear","FormSettingsForm","fields","getTextField","Landing","UI","Field","Checkbox","selector","compact","value","Text","toBoolean","formOptions","use","items","name","textItem","messages","find","item","String","langId","data","language","text","Type","isPlainObject","field","TextField","content","textOnly","Dom","addClass","input","isOpened","event","emit","getData","skipPrepare","ContentWrapper"],"mappings":"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"}