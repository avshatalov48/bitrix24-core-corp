{"version":3,"file":"fields-rules.bundle.js","sources":["../src/rule-type.js","../src/internal/field-element/field-element.js","../src/internal/field-value-element/field-value-element.js","../src/internal/type-separator/type-separator.js","../src/internal/rule-entry/rule-entry.js","../src/internal/field-action-panel/field-action-panel.js","../src/internal/rule-group/rule-group.js","../src/fields-rules.js"],"sourcesContent":["export default class RuleType\n{\n\tstatic TYPE_0 = 0;\n\tstatic TYPE_1 = 1;\n\tstatic TYPE_2 = 2;\n}","import 'ui.design-tokens';\n\nimport {EventEmitter} from 'main.core.events';\nimport {Cache, Tag, Text} from 'main.core';\nimport {IconButton} from 'landing.ui.component.iconbutton';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\nimport type {FormDictionary} from 'crm.form.type';\nimport type {CrmField} from '../../types';\n\nimport './css/style.css';\n\ntype FieldElementOptions = {\n\tid: string,\n\ttitle: string,\n\tremovable?: boolean,\n\tdraggable?: boolean,\n\tactionsLabel?: string,\n\tactionsList?: Array<{name: string, value: any}>,\n\tactionsValue?: any,\n\tonRemove?: () => void,\n\t// eslint-disable-next-line no-use-before-define\n\tcolor?: $Values<typeof FieldElement.Colors>,\n\tdictionary: FormDictionary,\n\tfields: CrmField,\n};\n\nconst defaultOptions = {\n\tremovable: true,\n\tdraggable: false,\n\t// eslint-disable-next-line no-use-before-define\n\tcolor: 'blue',\n};\n\nexport class FieldElement extends EventEmitter\n{\n\tstatic Colors = {\n\t\tblue: 'blue',\n\t\tgreen: 'green',\n\t\tred: 'red',\n\t};\n\n\tconstructor(options: FieldElementOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.RuleField.FieldElement');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\t\tthis.options = {...defaultOptions, ...options};\n\t\tthis.cache = new Cache.MemoryCache();\n\t}\n\n\tgetDragButtonLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('dragButton', () => {\n\t\t\tconst button = new IconButton({\n\t\t\t\ttype: IconButton.Types.drag,\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '20px',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn button.getLayout();\n\t\t});\n\t}\n\n\tgetActionsDropdown(): BX.Landing.UI.Field.DropdownInline\n\t{\n\t\treturn this.cache.remember('actionsDropdown', () => {\n\t\t\tconst field = new window.top.BX.Landing.UI.Field.DropdownInline({\n\t\t\t\ttitle: this.options.actionsLabel,\n\t\t\t\titems: this.options.actionsList,\n\t\t\t\tcontent: this.options.actionsValue,\n\t\t\t});\n\n\t\t\tfield.subscribe('onChange', () => {\n\t\t\t\tthis.emit('onChange');\n\t\t\t});\n\n\t\t\treturn field;\n\t\t});\n\t}\n\n\tgetActionsLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('actionsLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-element-text-action\">\n\t\t\t\t\t${this.getActionsDropdown().getLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('titleLayout', () => {\n\t\t\treturn Tag.render`<div class=\"landing-ui-field-element-text-title\">${Text.encode(this.options.title)}</div>`;\n\t\t});\n\t}\n\n\tgetRemoveButtonLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\tconst button = new IconButton({\n\t\t\t\ttype: IconButton.Types.remove,\n\t\t\t\tonClick: () => this.emit('onRemove'),\n\t\t\t\ticonSize: '9px',\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '20px',\n\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn button.getLayout();\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"landing-ui-field-element-${this.options.color}\"\n\t\t\t\t\tdata-field-id=\"${Text.encode(this.options.id)}\"\n\t\t\t\t>\n\t\t\t\t\t${this.options.draggable ? this.getDragButtonLayout() : ''}\n\t\t\t\t\t<div class=\"landing-ui-field-element-text\">\n\t\t\t\t\t\t${this.options.actionsLabel ? this.getActionsLayout() : ''}\n\t\t\t\t\t\t${this.getTitleLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.options.removable ? this.getRemoveButtonLayout() : ''}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n}\n","import 'ui.design-tokens';\n\nimport {EventEmitter} from 'main.core.events';\nimport {Cache, Dom, Tag, Text, Type} from 'main.core';\nimport {IconButton} from 'landing.ui.component.iconbutton';\nimport {Popup, Menu, MenuItem} from 'main.popup';\nimport {PageObject} from 'landing.pageobject';\nimport {Loc} from 'landing.loc';\nimport {TextField} from 'landing.ui.field.textfield';\nimport type {FormDictionary} from 'crm.form.type';\nimport {CrmField} from '../../types';\n\nimport './css/style.css';\n\ntype FieldValueState = {\n\toperation: string,\n\ttarget: string,\n\tvalue: any,\n}\n\ntype FieldValueElementOptions = {\n\tremovable: boolean,\n\tdictionary: FormDictionary,\n\tfields: Array<any>,\n\tdata: FieldValueState,\n};\n\nexport default class FieldValueElement extends EventEmitter\n{\n\toptions: FieldValueElementOptions;\n\tcache = new Cache.MemoryCache();\n\tstate: FieldValueState;\n\n\tconstructor(options: FieldValueElementOptions)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.ValueElement');\n\t\tthis.options = {...options};\n\t\tthis.state = {...this.options.data};\n\t}\n\n\tgetOperatorLabelLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('operatorLabelLayout', () => {\n\t\t\tconst text = this.getOperatorLabelText(this.options.data.operation);\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"landing-ui-rule-value-operator-label\"\n\t\t\t\t\tonclick=\"${this.onOperatorLabelClick.bind(this)}\"\n\t\t\t\t>${text}</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonOperatorLabelClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.getOperatorSettingsPopup().show();\n\t}\n\n\tgetTargetContainer()\n\t{\n\t\treturn this.cache.remember('targetContainer', () => {\n\t\t\treturn this.getLayout().closest('.landing-ui-panel-content-body-content') || this.getLayout();\n\t\t});\n\t}\n\n\tgetOperatorSettingsPopup()\n\t{\n\t\treturn this.cache.remember('operatorSettingsPopup', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\treturn new rootWindow.BX.Main.Popup({\n\t\t\t\tbindElement: this.getLayout(),\n\t\t\t\ttargetContainer: this.getTargetContainer(),\n\t\t\t\tcontent: this.getOperatorField().getLayout(),\n\t\t\t\tautoHide: true,\n\t\t\t\tminWidth: 160,\n\t\t\t\toffsetLeft: 20,\n\t\t\t\toffsetTop: 3,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetValueLabelLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('valueLabelLayout', () => {\n\t\t\tconst text = this.getValueLabelText(this.options.data.value);\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"landing-ui-rule-value-value-label\"\n\t\t\t\t\tonclick=\"${this.onValueLabelClick.bind(this)}\"\n\t\t\t\t>\n\t\t\t\t\t<span class=\"landing-ui-rule-value-value-label-inner\">${Text.encode(text)}</span>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tif (\n\t\t\t\tthis.options.data.operation === 'any'\n\t\t\t\t|| this.options.data.operation === 'empty'\n\t\t\t)\n\t\t\t{\n\t\t\t\tDom.hide(layout);\n\t\t\t}\n\n\t\t\treturn layout;\n\t\t});\n\t}\n\n\tsetValueLabelText(text: string)\n\t{\n\t\tthis.getValueLabelLayout().firstElementChild.textContent = text;\n\t}\n\n\tonValueLabelClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.getValueSettingsPopup().show();\n\t}\n\n\tgetValueSettingsPopup(): Popup\n\t{\n\t\treturn this.cache.remember('valueSettingsPopup', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\tconst popupContent = Tag.render`<div class=\"value-settings-popup\"></div>`;\n\t\t\tconst random = Text.getRandom();\n\t\t\tconst targetField = this.getTargetField();\n\n\t\t\tif (\n\t\t\t\ttargetField.type === 'list'\n\t\t\t\t|| targetField.type === 'product'\n\t\t\t\t|| targetField.type === 'checkbox'\n\t\t\t\t|| targetField.type === 'radio'\n\t\t\t\t|| targetField.type === 'bool'\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst valueItems = (() => {\n\t\t\t\t\tif (targetField.type === 'bool')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t{label: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_YES'), value: 'Y'},\n\t\t\t\t\t\t\t{label: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_NO'), value: 'N'},\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn targetField.items;\n\t\t\t\t})();\n\n\t\t\t\tvalueItems.forEach((item) => {\n\t\t\t\t\tconst checked = String(targetField.value) === String(item.value);\n\t\t\t\t\tDom.append(\n\t\t\t\t\t\tDom.append(\n\t\t\t\t\t\t\tthis.renderValueRadioButton({...item, id: random, checked}),\n\t\t\t\t\t\t\tpopupContent,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tpopupContent,\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst value = (() => {\n\t\t\t\t\tif (Type.isStringFilled(this.options.data.value))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.getValueLabelText(this.options.data.value);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn '';\n\t\t\t\t})();\n\t\t\t\tconst inputField = new TextField({\n\t\t\t\t\ttextOnly: true,\n\t\t\t\t\tonValueChange: () => {\n\t\t\t\t\t\tconst conditionValue = (\n\t\t\t\t\t\t\tinputField.getValue()\n\t\t\t\t\t\t\t|| Loc.getMessage('LANDING_RULE_CONDITION_VALUE_EMPTY_MSGVER_1')\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.setValueLabelText(conditionValue);\n\t\t\t\t\t\tthis.state.value = inputField.getValue();\n\t\t\t\t\t\tthis.emit('onChange');\n\t\t\t\t\t},\n\t\t\t\t\tcontent: value,\n\t\t\t\t});\n\n\t\t\t\tDom.append(inputField.getLayout(), popupContent);\n\t\t\t}\n\n\t\t\treturn new rootWindow.BX.Main.Popup({\n\t\t\t\tbindElement: this.getLayout(),\n\t\t\t\ttargetContainer: this.getTargetContainer(),\n\t\t\t\tcontent: popupContent,\n\t\t\t\twidth: 228,\n\t\t\t\tautoHide: true,\n\t\t\t\tmaxHeight: 200,\n\t\t\t\toffsetLeft: 20,\n\t\t\t\toffsetTop: 3,\n\t\t\t\tevents: {\n\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\tDom.addClass(\n\t\t\t\t\t\t\tthis.getLayout(),\n\t\t\t\t\t\t\t'landing-ui-rule-value-active',\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tDom.removeClass(\n\t\t\t\t\t\t\tthis.getLayout(),\n\t\t\t\t\t\t\t'landing-ui-rule-value-active',\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\trenderValueRadioButton({label, value, id, checked}): HTMLDivElement\n\t{\n\t\tconst onChange = () => {\n\t\t\tthis.setValueLabelText(label);\n\t\t\tthis.state.value = value;\n\n\t\t\tthis.emit('onChange');\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"value-settings-item value-settings-item-value\">\n\t\t\t\t<input\n\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\tid=\"value_${id}_${value}\"\n\t\t\t\t\tname=\"value_${id}_${this.options.data.target}\"\n\t\t\t\t\tonchange=\"${onChange}\"\n\t\t\t\t\t${checked ? 'checked' : ''}\n\t\t\t\t>\n\t\t\t\t<label for=\"value_${id}_${value}\">${Text.encode(label)}</label>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetOperatorField(): BX.Landing.UI.Field.Dropdown\n\t{\n\t\treturn this.cache.remember('operatorField', () => {\n\t\t\tconst {condition} = this.options.dictionary.deps;\n\t\t\tconst targetField = this.getTargetField();\n\t\t\treturn new BX.Landing.UI.Field.Radio({\n\t\t\t\tselector: 'operation',\n\t\t\t\tvalue: [this.state.operation],\n\t\t\t\titems: condition.operations\n\t\t\t\t\t.filter((item) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\t!Type.isArrayFilled(item.fieldTypes)\n\t\t\t\t\t\t\t\t|| item.fieldTypes.includes(targetField.type)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t\t!Type.isArrayFilled(item.excludeFieldTypes)\n\t\t\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\t\t\tType.isArrayFilled(item.excludeFieldTypes)\n\t\t\t\t\t\t\t\t\t&& !item.excludeFieldTypes.includes(targetField.type)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t})\n\t\t\t\t\t.map((item) => {\n\t\t\t\t\t\treturn {name: item.name, value: item.id};\n\t\t\t\t\t}),\n\t\t\t\tonChange: this.onOperationChange.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tsetOperationLabelText(text: string)\n\t{\n\t\tthis.getOperatorLabelLayout().textContent = text;\n\t}\n\n\tonOperationChange()\n\t{\n\t\tconst operatorField = this.getOperatorField();\n\t\tconst [value] = operatorField.getValue();\n\n\t\tif (\n\t\t\tvalue === 'empty'\n\t\t\t|| value === 'any'\n\t\t)\n\t\t{\n\t\t\tDom.hide(this.getValueLabelLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.getValueLabelLayout());\n\t\t}\n\n\t\tthis.setOperationLabelText(this.getOperatorLabelText(value));\n\t\tthis.state.operation = value;\n\t\tthis.emit('onChange');\n\t}\n\n\tgetRemoveButton()\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\treturn new IconButton({\n\t\t\t\ttype: IconButton.Types.remove,\n\t\t\t\ticonSize: '9px',\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '19px',\n\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t},\n\t\t\t\tonClick: () => {\n\t\t\t\t\tthis.emit('onRemove');\n\t\t\t\t\tthis.emit('onChange');\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"landing-ui-rule-value\"\n\t\t\t\t\tdata-target=\"${Text.encode(this.options.data.target)}\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"landing-ui-rule-value-text\">\n\t\t\t\t\t\t${this.getOperatorLabelLayout()}\n\t\t\t\t\t\t${this.getValueLabelLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"landing-ui-rule-value-actions\">\n\t\t\t\t\t\t${this.options.removable ? this.getRemoveButton().getLayout() : ''}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"landing-ui-rule-decoration\">\n\t\t\t\t\t\t<div class=\"landing-ui-rule-decoration-v-line\"></div>\n\t\t\t\t\t\t<div class=\"landing-ui-rule-decoration-h-line\"></div>\n\t\t\t\t\t\t<div class=\"landing-ui-rule-decoration-arrow\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetOperatorLabelText(operatorValue: string): string\n\t{\n\t\treturn this.options.dictionary.deps.condition.operations.reduce((acc, item) => {\n\t\t\tif (item.id === operatorValue)\n\t\t\t{\n\t\t\t\treturn item.name;\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, this.options.dictionary.deps.condition.operations[0].name);\n\t}\n\n\tgetTargetField(): CrmField\n\t{\n\t\treturn this.cache.remember('targetField', () => {\n\t\t\treturn this.options.fields.find((field) => {\n\t\t\t\treturn String(field.id) === String(this.options.data.target);\n\t\t\t});\n\t\t});\n\t}\n\n\tgetValueLabelText(value: string): string\n\t{\n\t\tconst targetField = this.getTargetField();\n\t\tif (Type.isPlainObject(targetField))\n\t\t{\n\t\t\tif (Type.isArrayFilled(targetField.items))\n\t\t\t{\n\t\t\t\tconst item = targetField.items.find((currentItem) => {\n\t\t\t\t\treturn String(currentItem.value) === String(value);\n\t\t\t\t});\n\n\t\t\t\tif (Type.isPlainObject(item))\n\t\t\t\t{\n\t\t\t\t\treturn item.label;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(value))\n\t\t\t{\n\t\t\t\tif (value === 'Y')\n\t\t\t\t{\n\t\t\t\t\treturn Loc.getMessage('LANDING_RULE_CONDITION_VALUE_YES');\n\t\t\t\t}\n\n\t\t\t\tif (value === 'N')\n\t\t\t\t{\n\t\t\t\t\treturn Loc.getMessage('LANDING_RULE_CONDITION_VALUE_NO');\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\treturn Loc.getMessage('LANDING_RULE_CONDITION_VALUE_EMPTY_MSGVER_1');\n\t}\n\n\tgetValue(): FieldValueState\n\t{\n\t\treturn {...this.state};\n\t}\n}\n","import 'ui.design-tokens';\n\nimport {Cache, Tag} from 'main.core';\nimport {Loc} from 'landing.loc';\n\nimport './css/style.css';\n\ntype TypeSeparatorOptions = {\n\ttypeId: number,\n};\n\nexport default class TypeSeparator\n{\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(options: TypeSeparatorOptions)\n\t{\n\t\tthis.options = {...options};\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-type-separator\">\n\t\t\t\t\t<div class=\"landing-ui-rule-entry-type-separator-inner\">\n\t\t\t\t\t\t${this.getSeparatorLabel()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSeparatorLabel(): string\n\t{\n\t\tif (String(this.options.typeId) === String(2))\n\t\t{\n\t\t\treturn Loc.getMessage('LANDING_RULE_TYPE_SEPARATOR_TYPE_2');\n\t\t}\n\n\t\treturn Loc.getMessage('LANDING_RULE_TYPE_SEPARATOR_TYPE_1');\n\t}\n}","import {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Cache, Dom, Tag, Type} from 'main.core';\nimport {Loc} from 'landing.loc';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {FieldElement} from '../field-element/field-element';\nimport FieldValueElement from '../field-value-element/field-value-element';\nimport TypeSeparator from '../type-separator/type-separator';\n\nimport './css/style.css';\n\ntype RuleEntryOptions = {\n\tenableHeader?: boolean,\n\ttypeId: number,\n\tfields: Array<any>,\n\tconditions: Array<FieldElement>,\n\texpressions: Array<FieldElement>,\n};\n\nexport default class RuleEntry extends EventEmitter\n{\n\toptions: RuleEntryOptions;\n\tconditions: Array<FieldElement | FieldValueElement> = [];\n\texpressions: Array<FieldElement> = [];\n\n\tconstructor(options: RuleEntryOptions) {\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.RuleEntry');\n\n\t\tthis.options = {enableHeader: true, expressions: [], ...options};\n\t\tthis.cache = new Cache.MemoryCache();\n\n\t\tthis.onConditionFieldValueRemove = this.onConditionFieldValueRemove.bind(this);\n\t\tthis.onConditionFieldRemove = this.onConditionFieldRemove.bind(this);\n\n\t\tif (Type.isArrayFilled(this.options.conditions))\n\t\t{\n\t\t\tthis.options.conditions.forEach((item) => {\n\t\t\t\tthis.addCondition(item);\n\t\t\t});\n\n\t\t\tthis.options.expressions.forEach((item) => {\n\t\t\t\tthis.addExpression(item);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetConditionsLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('conditionsLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-conditions\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetExpressionsLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('expressionsLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-expressions\">\n\t\t\t\t\t${this.getAddExpresionFieldLinkLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetHeaderLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-header\">${Loc.getMessage('LANDING_RULE_ENTRY_HEADER')}</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry\">\n\t\t\t\t\t${this.options.enableHeader ? this.getHeaderLayout() : ''}\n\t\t\t\t\t<div class=\"landing-ui-rule-entry-body\">\n\t\t\t\t\t\t${this.getConditionsLayout()}\n\t\t\t\t\t\t${this.getExpressionsLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonConditionFieldRemove(event: BaseEvent)\n\t{\n\t\tconst target: FieldElement = event.getTarget();\n\t\tconst targetLayout = target.getLayout();\n\n\t\tthis.conditions = this.conditions.filter((item) => {\n\t\t\treturn item !== target;\n\t\t});\n\n\t\tlet nextNode = targetLayout.nextElementSibling;\n\t\twhile (\n\t\t\tType.isDomNode(nextNode)\n\t\t\t&& !nextNode.matches('[class*=\"landing-ui-field-element\"]')\n\t\t)\n\t\t{\n\t\t\tthis.conditions = this.conditions.filter((item) => {\n\t\t\t\treturn item.getLayout() !== nextNode;\n\t\t\t});\n\n\t\t\tDom.remove(nextNode);\n\t\t\tnextNode = targetLayout.nextElementSibling;\n\t\t}\n\n\t\tif (!Type.isDomNode(nextNode))\n\t\t{\n\t\t\tconst prevNode = targetLayout.previousElementSibling;\n\t\t\tif (\n\t\t\t\tType.isDomNode(prevNode)\n\t\t\t\t&& Dom.hasClass(prevNode, 'landing-ui-rule-entry-type-separator')\n\t\t\t)\n\t\t\t{\n\t\t\t\tDom.remove(prevNode);\n\t\t\t}\n\t\t}\n\n\t\tDom.remove(targetLayout);\n\n\t\tthis.emit('onChange');\n\t}\n\n\tonConditionFieldValueRemove(event: BaseEvent)\n\t{\n\t\tconst target: FieldValueElement = event.getTarget();\n\t\tconst targetLayout = target.getLayout();\n\n\t\tthis.conditions = this.conditions.filter((item) => {\n\t\t\treturn item !== target;\n\t\t});\n\n\t\tif (Dom.hasClass(targetLayout.nextElementSibling, 'landing-ui-rule-entry-type-separator'))\n\t\t{\n\t\t\tDom.remove(targetLayout.nextElementSibling);\n\t\t}\n\t\telse if (Dom.hasClass(targetLayout.previousElementSibling, 'landing-ui-rule-entry-type-separator'))\n\t\t{\n\t\t\tDom.remove(targetLayout.previousElementSibling);\n\t\t}\n\n\t\tDom.remove(targetLayout);\n\t}\n\n\taddCondition(element: FieldValueElement)\n\t{\n\t\tif (!this.conditions.includes(element))\n\t\t{\n\t\t\tthis.conditions.push(element);\n\n\t\t\tif (element instanceof FieldValueElement)\n\t\t\t{\n\t\t\t\telement.subscribe('onRemove', this.onConditionFieldValueRemove);\n\t\t\t\telement.subscribe('onChange', () => this.emit('onChange'));\n\n\t\t\t\tconst conditionsNodes = [...this.getConditionsLayout().childNodes];\n\t\t\t\tconst lastElement = conditionsNodes.reduce((acc, node) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tDom.hasClass(node, 'landing-ui-rule-value')\n\t\t\t\t\t\t\t&& String(Dom.attr(node, 'data-target')) === String(element.options.data.target)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\tnode.matches('[class*=\"landing-ui-field-element\"]')\n\t\t\t\t\t\t\t&& String(Dom.attr(node, 'data-field-id')) === String(element.options.data.target)\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, null);\n\n\t\t\t\tif (Type.isDomNode(lastElement))\n\t\t\t\t{\n\t\t\t\t\tDom.insertAfter(element.getLayout(), lastElement);\n\n\t\t\t\t\tif (Dom.hasClass(lastElement, 'landing-ui-rule-value'))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst separator = new TypeSeparator({\n\t\t\t\t\t\t\ttypeId: this.options.typeId,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tDom.insertBefore(separator.getLayout(), element.getLayout());\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (element instanceof FieldElement)\n\t\t\t{\n\t\t\t\telement.subscribe('onRemove', this.onConditionFieldRemove);\n\t\t\t\telement.subscribe('onChange', () => this.emit('onChange'));\n\n\t\t\t\tif ([...this.getConditionsLayout().childNodes].length > 0)\n\t\t\t\t{\n\t\t\t\t\tconst separator = new TypeSeparator({\n\t\t\t\t\t\ttypeId: this.options.typeId,\n\t\t\t\t\t});\n\n\t\t\t\t\tDom.append(separator.getLayout(), this.getConditionsLayout());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tDom.append(\n\t\t\t\telement.getLayout(),\n\t\t\t\tthis.getConditionsLayout(),\n\t\t\t);\n\n\t\t\tthis.emit('onChange');\n\t\t}\n\t}\n\n\tgetExpressionActionPanel(): ActionPanel\n\t{\n\t\treturn this.cache.remember('expressionActionPanel', () => {\n\t\t\treturn new ActionPanel({\n\t\t\t\tleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'addField',\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_RULE_ENTRY_ADD_FIELD_LABEL'),\n\t\t\t\t\t\tonClick: this.onAddExpressionFieldClick.bind(this),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tonAddExpressionFieldClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst menu = this.getFieldsListMenu();\n\t\tmenu.getMenuItems().forEach((item) => {\n\t\t\tconst isUsed = this.expressions.some((expressionItem) => {\n\t\t\t\treturn String(expressionItem.options.id) === String(item.getId());\n\t\t\t});\n\n\t\t\tif (isUsed)\n\t\t\t{\n\t\t\t\tDom.addClass(item.getLayout().item, 'landing-ui-disabled');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(item.getLayout().item, 'landing-ui-disabled');\n\t\t\t}\n\t\t});\n\n\t\tthis.getFieldsListMenu().show();\n\t}\n\n\tgetExpressionAllowedFieldsList(): Array<any>\n\t{\n\t\tconst disallowedTypes = ['page', 'layout'];\n\t\treturn this.options.fields.filter((field) => {\n\t\t\tif (!disallowedTypes.includes(field.type))\n\t\t\t{\n\t\t\t\treturn !this.conditions.find((condition) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tType.isPlainObject(condition.options)\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tType.isPlainObject(condition.options.data)\n\t\t\t\t\t\t\t\t&& String(condition.options.data.target) === String(field.id)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t|| String(condition.options.id) === String(field.id)\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tgetFieldsListMenu()\n\t{\n\t\treturn this.cache.remember('fieldsListMenu', () => {\n\t\t\treturn new window.top.BX.Main.Menu({\n\t\t\t\tbindElement: this.getExpressionActionPanel().getLayout(),\n\t\t\t\tmaxHeight: 205,\n\t\t\t\titems: this.getExpressionAllowedFieldsList()\n\t\t\t\t\t.map((item) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\t\ttext: item.label,\n\t\t\t\t\t\t\tonclick: this.onAddExpressionField.bind(this, item),\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetAddExpresionFieldLinkLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('addExpressionFieldLinkLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-add-expression-field-link\">\n\t\t\t\t\t<div class=\"landing-ui-rule-entry-add-expression-field-link-action-panel\">\n\t\t\t\t\t\t${this.getExpressionActionPanel().getLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"landing-ui-rule-entry-add-expression-field-link-separator\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonAddExpressionField(field)\n\t{\n\t\tconst element = new FieldElement({\n\t\t\tid: field.id,\n\t\t\ttitle: field.label,\n\t\t\tremovable: true,\n\t\t\tcolor: FieldElement.Colors.green,\n\t\t\tactionsLabel: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_LABEL'),\n\t\t\tactionsList: [\n\t\t\t\t{name: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_SHOW_LABEL'), value: 'show'},\n\t\t\t\t{name: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_HIDE_LABEL'), value: 'hide'},\n\t\t\t],\n\t\t\tactionsValue: 'show',\n\t\t});\n\n\t\tthis.addExpression(element);\n\n\t\tthis.getFieldsListMenu().close();\n\n\t\tthis.emit('onChange');\n\t}\n\n\tonExpressionFieldRemove(event: BaseEvent)\n\t{\n\t\tconst target = event.getTarget();\n\n\t\tDom.remove(target.getLayout());\n\n\t\tthis.expressions = this.expressions.filter((field) => {\n\t\t\treturn String(field.options.id) !== String(target.options.id);\n\t\t});\n\n\t\tthis.adjustExpressionFieldsZIndexes();\n\n\t\tthis.emit('onChange');\n\t}\n\n\tonExpressionFieldChange()\n\t{\n\t\tthis.emit('onChange');\n\t}\n\n\tadjustExpressionFieldsZIndexes()\n\t{\n\t\t[...this.getExpressionsLayout().children]\n\t\t\t.reverse()\n\t\t\t.forEach((node, index) => {\n\t\t\t\tif (node.matches('[class*=\"landing-ui-field-element\"]'))\n\t\t\t\t{\n\t\t\t\t\tDom.style(node, 'z-index', index + 2);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\taddExpression(element: FieldElement)\n\t{\n\t\tif (!this.expressions.includes(element))\n\t\t{\n\t\t\tthis.expressions.push(element);\n\n\t\t\telement.subscribe('onRemove', this.onExpressionFieldRemove.bind(this));\n\t\t\telement.subscribe('onChange', this.onExpressionFieldChange.bind(this));\n\n\t\t\t// @todo: refactoring\n\t\t\tvoid this.getLayout();\n\n\t\t\tDom.insertBefore(element.getLayout(), this.getAddExpresionFieldLinkLayout());\n\n\t\t\tthis.adjustExpressionFieldsZIndexes();\n\t\t}\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.conditions\n\t\t\t.filter((item) => item instanceof FieldValueElement)\n\t\t\t.reduce((acc, conditionsItem: FieldValueElement) => {\n\t\t\t\treturn [\n\t\t\t\t\t...acc,\n\t\t\t\t\t...this.expressions.map((expressionItem) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcondition: {\n\t\t\t\t\t\t\t\t...conditionsItem.getValue(),\n\t\t\t\t\t\t\t\tevent: 'change',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\taction: {\n\t\t\t\t\t\t\t\ttarget: expressionItem.options.id,\n\t\t\t\t\t\t\t\ttype: expressionItem.getActionsDropdown().getValue(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t\t];\n\t\t\t}, []);\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport {Cache, Tag, Type, Dom} from 'main.core';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {Loc} from 'landing.loc';\n\nimport './css/style.css';\n\nexport default class FieldActionPanel extends EventEmitter\n{\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.FormSettingsPanel.FieldRules.FieldActionPanel');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\n\t\tif (Type.isPlainObject(options.style))\n\t\t{\n\t\t\tDom.style(this.getLayout(), options.style);\n\t\t}\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-field-action-panel\">\n\t\t\t\t\t${this.getActionPanel().getLayout()}\n\t\t\t\t\t<div class=\"landing-ui-rule-field-action-panel-decoration\">\n\t\t\t\t\t\t<div class=\"landing-ui-rule-field-action-panel-decoration-v-line\"></div>\n\t\t\t\t\t\t<div class=\"landing-ui-rule-field-action-panel-decoration-h-line\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetActionPanel(): ActionPanel\n\t{\n\t\treturn this.cache.remember('actionPanel', () => {\n\t\t\treturn new ActionPanel({\n\t\t\t\tleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'addCondition',\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_RULE_GROUP_ADD_FIELD_CONDITION'),\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tthis.emit('onAddCondition');\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n}\n","import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport {Dom, Tag, Text, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {BaseField} from 'landing.ui.field.basefield';\nimport {Loc} from 'landing.loc';\nimport {IconButton} from 'landing.ui.component.iconbutton';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\nimport type {RuleGroupOptions} from '../../types';\nimport RuleEntry from '../rule-entry/rule-entry';\nimport RuleType from '../../rule-type';\nimport {FieldElement} from '../field-element/field-element';\nimport FieldValueElement from '../field-value-element/field-value-element';\nimport FieldActionPanel from '../field-action-panel/field-action-panel';\n\nimport './css/style.css';\n\nexport default class RuleGroup extends BaseField\n{\n\toptions: RuleGroupOptions;\n\n\tconstructor(options: RuleGroupOptions)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.Content.FieldRules.RuleGroup');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\t\tthis.setLayoutClass('landing-ui-rule-group');\n\n\t\tconst layout = this.getLayout();\n\t\tDom.clean(layout);\n\t\tDom.append(this.getHeaderLayout(), layout);\n\t\tDom.append(this.getBodyLayout(), layout);\n\t\tDom.append(this.getFooterLayout(), layout);\n\n\t\tif (Type.isArrayFilled(this.options.data.list))\n\t\t{\n\t\t\tconst filteredDataList = this.options.data.list.filter((item) => {\n\t\t\t\tconst conditionTarget = this.getField(item.condition.target);\n\t\t\t\tconst actionTarget = this.getField(item.action.target);\n\t\t\t\treturn conditionTarget && actionTarget;\n\t\t\t});\n\n\t\t\tif (this.getTypeId() === RuleType.TYPE_0)\n\t\t\t{\n\t\t\t\tconst groupedList = filteredDataList.reduce((acc, item) => {\n\t\t\t\t\tconst {target, operation, value} = item.condition;\n\t\t\t\t\tif (!Type.isArray(acc[`${target}${operation}${value}`]))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[`${target}${operation}${value}`] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tacc[`${target}${operation}${value}`].push(item);\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {});\n\n\t\t\t\tObject.values(groupedList).forEach((group, index) => {\n\t\t\t\t\tconst [firstItem] = group;\n\t\t\t\t\tif (Type.isPlainObject(firstItem))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst targetField = this.getField(firstItem.condition.target);\n\t\t\t\t\t\tconst entry = new RuleEntry({\n\t\t\t\t\t\t\tenableHeader: index === 0,\n\t\t\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\t\tonChange: () => this.emit('onChange'),\n\t\t\t\t\t\t\tconditions: [\n\t\t\t\t\t\t\t\tnew FieldElement({\n\t\t\t\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\t\t\t\tid: targetField.id,\n\t\t\t\t\t\t\t\t\ttitle: targetField.label,\n\t\t\t\t\t\t\t\t\tcolor: FieldElement.Colors.blue,\n\t\t\t\t\t\t\t\t\tonRemove: () => {\n\t\t\t\t\t\t\t\t\t\tthis.onConditionFieldRemove(entry);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tnew FieldValueElement({\n\t\t\t\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\t\t\t\tremovable: false,\n\t\t\t\t\t\t\t\t\tdata: group[0].condition,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\texpressions: group.map((groupItem) => {\n\t\t\t\t\t\t\t\tconst targetField = this.getField(groupItem.action.target);\n\t\t\t\t\t\t\t\treturn new FieldElement({\n\t\t\t\t\t\t\t\t\tid: targetField.id,\n\t\t\t\t\t\t\t\t\ttitle: targetField.label,\n\t\t\t\t\t\t\t\t\tremovable: true,\n\t\t\t\t\t\t\t\t\tcolor: FieldElement.Colors.green,\n\t\t\t\t\t\t\t\t\tactionsLabel: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_LABEL'),\n\t\t\t\t\t\t\t\t\tactionsList: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_SHOW_LABEL'),\n\t\t\t\t\t\t\t\t\t\t\tvalue: 'show',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_HIDE_LABEL'),\n\t\t\t\t\t\t\t\t\t\t\tvalue: 'hide',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tactionsValue: groupItem.action.type,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.addEntry(entry);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.getTypeId() === RuleType.TYPE_1\n\t\t\t\t|| this.getTypeId() === RuleType.TYPE_2\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst entry = new RuleEntry({\n\t\t\t\t\tenableHeader: true,\n\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\tonChange: () => this.emit('onChange'),\n\t\t\t\t});\n\n\t\t\t\tconst groupedList = filteredDataList.reduce((acc, item) => {\n\t\t\t\t\tconst {target} = item.condition;\n\t\t\t\t\tif (!Type.isArray(acc[target]))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[target] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tacc[target].push(item);\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {});\n\n\t\t\t\tObject.values(groupedList).forEach((group) => {\n\t\t\t\t\tconst [firstItem] = group;\n\t\t\t\t\tif (Type.isPlainObject(firstItem))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst targetField = this.getField(firstItem.condition.target);\n\n\t\t\t\t\t\tconst allowedMultipleConditions = (\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tthis.getTypeId() === RuleType.TYPE_2\n\t\t\t\t\t\t\t\t&& targetField.multiple\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t|| this.getTypeId() === RuleType.TYPE_1\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tentry.addCondition(\n\t\t\t\t\t\t\tnew FieldElement({\n\t\t\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\t\t\tid: targetField.id,\n\t\t\t\t\t\t\t\ttitle: targetField.label,\n\t\t\t\t\t\t\t\tcolor: FieldElement.Colors.blue,\n\t\t\t\t\t\t\t\tonRemove: () => {\n\t\t\t\t\t\t\t\t\tthis.onConditionFieldRemove(entry);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tconst groupedConditions = group.reduce((acc, item) => {\n\t\t\t\t\t\t\tacc[`${item.condition.operation}${item.condition.value}`] = item;\n\t\t\t\t\t\t\treturn acc;\n\t\t\t\t\t\t}, {});\n\n\t\t\t\t\t\tObject.values(groupedConditions).forEach((item) => {\n\t\t\t\t\t\t\tentry.addCondition(\n\t\t\t\t\t\t\t\tnew FieldValueElement({\n\t\t\t\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\t\t\t\tremovable: allowedMultipleConditions,\n\t\t\t\t\t\t\t\t\tdata: item.condition,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tentry.addCondition(\n\t\t\t\t\t\t\tnew FieldActionPanel({\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\tdisplay: allowedMultipleConditions ? null : 'none',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonAddCondition: () => {\n\t\t\t\t\t\t\t\t\tthis.onAddFieldCondition(\n\t\t\t\t\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\tentry,\n\t\t\t\t\t\t\t\t\t\t\t\ttarget: targetField.id,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tconst groupedExpressions = Object.values(filteredDataList).reduce((acc, item) => {\n\t\t\t\t\tconst {target, type} = item.action;\n\t\t\t\t\tacc[`${target}${type}`] = item;\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {});\n\n\t\t\t\tObject.values(groupedExpressions).forEach((item) => {\n\t\t\t\t\tconst targetField = this.getField(item.action.target);\n\t\t\t\t\tconst element = new FieldElement({\n\t\t\t\t\t\tid: targetField.id,\n\t\t\t\t\t\ttitle: targetField.label,\n\t\t\t\t\t\tremovable: true,\n\t\t\t\t\t\tcolor: FieldElement.Colors.green,\n\t\t\t\t\t\tactionsLabel: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_LABEL'),\n\t\t\t\t\t\tactionsList: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_SHOW_LABEL'),\n\t\t\t\t\t\t\t\tvalue: 'show',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_HIDE_LABEL'),\n\t\t\t\t\t\t\t\tvalue: 'hide',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\tactionsValue: item.action.type,\n\t\t\t\t\t});\n\n\t\t\t\t\tentry.addExpression(element);\n\t\t\t\t});\n\n\t\t\t\tthis.addEntry(entry);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetEntries(): Array<RuleEntry>\n\t{\n\t\treturn this.cache.remember('entries', () => []);\n\t}\n\n\tsetEntries(entries: Array<RuleEntry>)\n\t{\n\t\tthis.cache.set('entries', entries);\n\t}\n\n\taddEntry(entry: RuleEntry)\n\t{\n\t\tif (entry)\n\t\t{\n\t\t\tconst entries = this.getEntries();\n\t\t\tif (!entries.includes(entry))\n\t\t\t{\n\t\t\t\tentry.subscribe('onChange', () => this.emit('onChange'));\n\n\t\t\t\tentries.push(entry);\n\t\t\t\tDom.append(entry.getLayout(), this.getBodyLayout());\n\n\t\t\t\tthis.emit('onChange');\n\t\t\t}\n\t\t}\n\t}\n\n\tgetHeaderLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-group-header\">\n\t\t\t\t\t${this.getHeaderTitleLayout()}\n\t\t\t\t\t${this.getRemoveButtonLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetHeaderTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerTitleLayout', () => {\n\t\t\tconst titleOfRuleType = Loc.getMessage(`LANDING_FIELDS_RULES_TYPE_${this.getTypeId() + 1}`);\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-group-header-title\">${titleOfRuleType}</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetRemoveButtonLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('removeButtonLayout', () => {\n\t\t\tconst button = new IconButton({\n\t\t\t\ttype: IconButton.Types.remove,\n\t\t\t\tonClick: this.onRemoveClick.bind(this),\n\t\t\t\ttitle: Loc.getMessage('LANDING_RULE_GROUP_REMOVE_BUTTON_TITLE'),\n\t\t\t\tstyle: {\n\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn button.getLayout();\n\t\t});\n\t}\n\n\tonRemoveClick()\n\t{\n\t\tDom.remove(this.getLayout());\n\t\tthis.emit('onRemove');\n\t\tthis.emit('onChange');\n\t}\n\n\tgetBodyLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('bodyLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-group-body\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetFooterLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('footerLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-group-footer\">\n\t\t\t\t\t${this.getFooterActionPanel().getLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetFooterActionPanel(): ActionPanel\n\t{\n\t\treturn this.cache.remember('footerActionPanel', () => {\n\t\t\treturn new ActionPanel({\n\t\t\t\tleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'selectField',\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_RULE_ENTRY_ADD_FIELD_LABEL'),\n\t\t\t\t\t\tonClick: this.onAddFieldClick.bind(this),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tonAddFieldClick(event: BaseEvent)\n\t{\n\t\tconst menu = this.getFieldsListMenu();\n\t\tmenu.getPopupWindow().setBindElement(event.currentTarget);\n\t\tmenu.show();\n\t}\n\n\tgetFieldsListMenu(): BX.Main.Menu\n\t{\n\t\treturn this.cache.remember('fieldsMenu', () => {\n\t\t\treturn new window.top.BX.Main.Menu({\n\t\t\t\tmaxHeight: 205,\n\t\t\t\titems: (\n\t\t\t\t\tthis.options.fields\n\t\t\t\t\t\t.map((field) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: field.id,\n\t\t\t\t\t\t\t\ttext: field.label,\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.onFieldsListMenuItemClick(field);\n\t\t\t\t\t\t\t\t\tthis.getFieldsListMenu().close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t})\n\t\t\t\t),\n\t\t\t\tautoHide: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDefaultValueState(fieldId: string): string\n\t{\n\t\tconst targetField = this.options.fields.find((field) => {\n\t\t\treturn String(field.id) === String(fieldId);\n\t\t});\n\n\t\tif (targetField)\n\t\t{\n\t\t\tconst filteredOperations = this.options.dictionary.deps.condition.operations.filter((operation) => {\n\t\t\t\treturn (\n\t\t\t\t\t(\n\t\t\t\t\t\t!Type.isArrayFilled(operation.fieldTypes)\n\t\t\t\t\t\t|| operation.fieldTypes.includes(targetField.type)\n\t\t\t\t\t)\n\t\t\t\t\t&& (\n\t\t\t\t\t\t!Type.isArrayFilled(operation.excludeFieldTypes)\n\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\tType.isArrayFilled(operation.excludeFieldTypes)\n\t\t\t\t\t\t\t&& !operation.excludeFieldTypes.includes(targetField.type)\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (Type.isArrayFilled(filteredOperations))\n\t\t\t{\n\t\t\t\treturn filteredOperations[0].id;\n\t\t\t}\n\t\t}\n\n\t\treturn '=';\n\t}\n\n\tonAddFieldCondition(event: BaseEvent)\n\t{\n\t\tconst {target, entry}: {target: string, entry: RuleEntry} = event.getData();\n\t\tentry.addCondition(\n\t\t\tnew FieldValueElement({\n\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\tfields: this.options.fields,\n\t\t\t\tremovable: true,\n\t\t\t\tdata: {\n\t\t\t\t\ttarget,\n\t\t\t\t\toperation: this.getDefaultValueState(target),\n\t\t\t\t\tvalue: null,\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\tonConditionFieldRemove(entry: RuleEntry)\n\t{\n\t\tconst fieldElements = entry.conditions.filter((item) => {\n\t\t\treturn item instanceof FieldElement;\n\t\t});\n\n\t\tif (fieldElements.length === 1)\n\t\t{\n\t\t\tconst entries = this.getEntries().filter((item) => {\n\t\t\t\treturn entry !== item;\n\t\t\t});\n\n\t\t\tthis.setEntries(entries);\n\n\t\t\tDom.remove(entry.getLayout());\n\t\t}\n\t}\n\n\tonFieldsListMenuItemClick(field)\n\t{\n\t\tif (this.getTypeId() === RuleType.TYPE_0)\n\t\t{\n\t\t\tconst enableHeader = this.getEntries().length === 0;\n\t\t\tconst entry = new RuleEntry({\n\t\t\t\tenableHeader,\n\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\tfields: this.options.fields,\n\t\t\t\tconditions: [\n\t\t\t\t\tnew FieldElement({\n\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\tid: field.id,\n\t\t\t\t\t\ttitle: field.label,\n\t\t\t\t\t\tcolor: FieldElement.Colors.blue,\n\t\t\t\t\t\tonRemove: () => {\n\t\t\t\t\t\t\tthis.onConditionFieldRemove(entry);\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew FieldValueElement({\n\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\tremovable: false,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\ttarget: field.id,\n\t\t\t\t\t\t\toperation: this.getDefaultValueState(field.id),\n\t\t\t\t\t\t\tvalue: null,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tonChange: () => this.emit('onChange'),\n\t\t\t});\n\n\t\t\tthis.addEntry(entry);\n\t\t}\n\n\t\tif (\n\t\t\tthis.getTypeId() === RuleType.TYPE_1\n\t\t\t|| this.getTypeId() === RuleType.TYPE_2\n\t\t)\n\t\t{\n\t\t\tconst allowedMultipleConditions = (\n\t\t\t\t(\n\t\t\t\t\tthis.getTypeId() === RuleType.TYPE_2\n\t\t\t\t\t&& field.multiple\n\t\t\t\t)\n\t\t\t\t|| this.getTypeId() === RuleType.TYPE_1\n\t\t\t);\n\n\t\t\tconst items = [\n\t\t\t\tnew FieldElement({\n\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\tid: field.id,\n\t\t\t\t\ttitle: field.label,\n\t\t\t\t\tcolor: FieldElement.Colors.blue,\n\t\t\t\t\tonRemove: () => {\n\t\t\t\t\t\tthis.onConditionFieldRemove(this.getEntries()[0]);\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew FieldValueElement({\n\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\tremovable: allowedMultipleConditions,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttarget: field.id,\n\t\t\t\t\t\toperation: this.getDefaultValueState(field.id),\n\t\t\t\t\t\tvalue: null,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t];\n\n\t\t\tif (\n\t\t\t\tthis.getTypeId() === RuleType.TYPE_1\n\t\t\t\t|| this.getTypeId() === RuleType.TYPE_2\n\t\t\t)\n\t\t\t{\n\t\t\t\titems.push(\n\t\t\t\t\tnew FieldActionPanel({\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tdisplay: allowedMultipleConditions ? null : 'none',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonAddCondition: () => {\n\t\t\t\t\t\t\tthis.onAddFieldCondition(\n\t\t\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\tentry: this.getEntries()[0],\n\t\t\t\t\t\t\t\t\t\ttarget: field.id,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst [entry] = this.getEntries();\n\t\t\tif (entry)\n\t\t\t{\n\t\t\t\titems.forEach((item) => {\n\t\t\t\t\tentry.addCondition(item);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst newEntry = new RuleEntry({\n\t\t\t\t\tenableHeader: true,\n\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\tconditions: items,\n\t\t\t\t\tonChange: () => this.emit('onChange'),\n\t\t\t\t});\n\n\t\t\t\tthis.addEntry(newEntry);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetId(): number\n\t{\n\t\tif (!Type.isNil(this.options.data.id))\n\t\t{\n\t\t\treturn this.options.data.id;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tgetTypeId(): number\n\t{\n\t\treturn Text.toNumber(this.options.data.typeId);\n\t}\n\n\tgetLogic(): 'or' | 'and'\n\t{\n\t\treturn this.getTypeId() === RuleType.TYPE_2 ? 'and' : 'or';\n\t}\n\n\tgetValue()\n\t{\n\t\tconst list = this.getEntries().reduce((acc, entry) => {\n\t\t\treturn [...acc, ...entry.getValue()];\n\t\t}, []);\n\n\t\treturn {\n\t\t\tid: this.getId(),\n\t\t\ttypeId: this.getTypeId(),\n\t\t\tlogic: this.getLogic(),\n\t\t\tlist,\n\t\t};\n\t}\n\n\tgetField(fieldId: string)\n\t{\n\t\treturn this.options.fields.find((item) => {\n\t\t\treturn String(item.id) === String(fieldId);\n\t\t});\n\t}\n}\n","import {Loc, Type, Dom} from 'main.core';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {HeaderCard} from 'landing.ui.card.headercard';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {RadioButtonField} from 'landing.ui.field.radiobuttonfield';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {BaseEvent} from 'main.core.events';\nimport RuleType from './rule-type';\nimport RuleGroup from './internal/rule-group/rule-group';\n\nimport './css/style.css';\n\nexport default class FieldsRules extends ContentWrapper\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.FieldsRulesContent');\n\n\t\tthis.addItem(this.getHeader());\n\n\t\tif (!Type.isArrayFilled(this.options.formOptions.data.dependencies))\n\t\t{\n\t\t\tthis.addItem(this.getRuleTypeField());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addItem(this.getRulesForm());\n\t\t\tthis.addItem(this.getActionPanel());\n\t\t}\n\t}\n\n\tgetHeader(): HeaderCard\n\t{\n\t\treturn this.cache.remember('headerCard', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FIELDS_RULES_TITLE'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetRulesForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('rulesForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\tselector: 'dependencies',\n\t\t\t\tdescription: null,\n\t\t\t\tfields: this.options.formOptions.data.dependencies.map((groupData) => {\n\t\t\t\t\treturn new RuleGroup({\n\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\tfields: this.getFormFields(),\n\t\t\t\t\t\tdata: groupData,\n\t\t\t\t\t\tonRemove: this.onRuleGroupRemove.bind(this),\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetActionPanel(): ActionPanel\n\t{\n\t\treturn this.cache.remember('actionPanel', () => {\n\t\t\treturn new ActionPanel({\n\t\t\t\tleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_FIELDS_ADD_NEW_RULE_LINK_LABEL'),\n\t\t\t\t\t\tonClick: this.onAddRuleClick.bind(this),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tonAddRuleClick()\n\t{\n\t\tthis.insertBefore(this.getRuleTypeField(), this.getActionPanel());\n\t\tthis.items.remove(this.getActionPanel());\n\t\tDom.remove(this.getActionPanel().getLayout());\n\t\tthis.getActionPanel().unsubscribe('onChange', this.onChange);\n\t}\n\n\tgetRuleTypeField(): RadioButtonField\n\t{\n\t\treturn this.cache.remember('ruleTypeField', () => {\n\t\t\treturn new RadioButtonField({\n\t\t\t\tselector: 'rules-type',\n\t\t\t\titems: Object.entries(RuleType).map(([, value]) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: `ruleType${value}`,\n\t\t\t\t\t\ticon: `landing-ui-rules-type${value + 1}-icon`,\n\t\t\t\t\t\ttitle: Loc.getMessage(`LANDING_FIELDS_RULES_TYPE_${value + 1}`),\n\t\t\t\t\t\tbutton: {\n\t\t\t\t\t\t\ttext: Loc.getMessage('LANDING_FIELDS_RULES_TYPE_BUTTON'),\n\t\t\t\t\t\t\tonClick: this.onCreateRuleButtonClick.bind(this, {type: value}),\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFormFields()\n\t{\n\t\tconst disallowedTypes = (() => {\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(this.options.dictionary.deps.field)\n\t\t\t\t|| !Type.isArrayFilled(this.options.dictionary.deps.field.disallowed)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.options.dictionary.deps.field.disallowed;\n\t\t})();\n\n\t\treturn this.options.formOptions.data.fields.filter((field) => {\n\t\t\treturn (\n\t\t\t\t!Type.isArrayFilled(disallowedTypes)\n\t\t\t\t|| (\n\t\t\t\t\t!disallowedTypes.includes(field.type)\n\t\t\t\t\t&& (\n\t\t\t\t\t\t!Type.isPlainObject(field.content)\n\t\t\t\t\t\t|| disallowedTypes.includes(field.content.type)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t);\n\t\t});\n\t}\n\n\tonCreateRuleButtonClick({type})\n\t{\n\t\tthis.clear();\n\n\t\tconst header = this.getHeader();\n\t\theader.setBottomMargin(false);\n\t\tthis.addItem(header);\n\n\t\tconst ruleForm = this.getRulesForm();\n\n\t\truleForm.addField(\n\t\t\tnew RuleGroup({\n\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\tfields: this.getFormFields(),\n\t\t\t\tdata: {\n\t\t\t\t\tid: 0,\n\t\t\t\t\ttypeId: type,\n\t\t\t\t\tlist: [],\n\t\t\t\t\tlogic: type === RuleType.TYPE_2 ? 'and' : 'or',\n\t\t\t\t},\n\t\t\t\tonRemove: this.onRuleGroupRemove.bind(this),\n\t\t\t}),\n\t\t);\n\n\t\tthis.addItem(ruleForm);\n\t\tthis.addItem(this.getActionPanel());\n\t}\n\n\tonRuleGroupRemove(event: BaseEvent)\n\t{\n\t\tthis.onChange(event);\n\n\t\tthis.getRulesForm().removeField(event.getTarget());\n\t\tevent.getTarget().unsubscribe('onChange', this.onChange);\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n\n\tvalueReducer(value: {[p: string]: any}): {[p: string]: any}\n\t{\n\t\treturn {\n\t\t\tdependencies: Object.values(value).filter((group) => {\n\t\t\t\treturn Type.isArrayFilled(group.list);\n\t\t\t}),\n\t\t};\n\t}\n}\n"],"names":["RuleType","defaultOptions","removable","draggable","color","FieldElement","options","setEventNamespace","subscribeFromOptions","fetchEventsFromOptions","cache","Cache","MemoryCache","remember","button","IconButton","type","Types","drag","style","width","getLayout","field","window","top","BX","Landing","UI","Field","DropdownInline","title","actionsLabel","items","actionsList","content","actionsValue","subscribe","emit","Tag","render","getActionsDropdown","Text","encode","remove","onClick","iconSize","marginLeft","id","getDragButtonLayout","getActionsLayout","getTitleLayout","getRemoveButtonLayout","EventEmitter","blue","green","red","FieldValueElement","state","data","text","getOperatorLabelText","operation","onOperatorLabelClick","bind","event","preventDefault","getOperatorSettingsPopup","show","closest","rootWindow","PageObject","getRootWindow","Main","Popup","bindElement","targetContainer","getTargetContainer","getOperatorField","autoHide","minWidth","offsetLeft","offsetTop","bindOptions","position","getValueLabelText","value","layout","onValueLabelClick","Dom","hide","getValueLabelLayout","firstElementChild","textContent","getValueSettingsPopup","popupContent","random","getRandom","targetField","getTargetField","valueItems","label","Loc","getMessage","forEach","item","checked","String","append","renderValueRadioButton","Type","isStringFilled","inputField","TextField","textOnly","onValueChange","conditionValue","getValue","setValueLabelText","maxHeight","events","onShow","addClass","onClose","removeClass","onChange","target","condition","dictionary","deps","Radio","selector","operations","filter","isArrayFilled","fieldTypes","includes","excludeFieldTypes","map","name","onOperationChange","getOperatorLabelLayout","operatorField","setOperationLabelText","getRemoveButton","operatorValue","reduce","acc","fields","find","isPlainObject","currentItem","TypeSeparator","getSeparatorLabel","typeId","RuleEntry","enableHeader","expressions","onConditionFieldValueRemove","onConditionFieldRemove","conditions","addCondition","addExpression","getAddExpresionFieldLinkLayout","getHeaderLayout","getConditionsLayout","getExpressionsLayout","getTarget","targetLayout","nextNode","nextElementSibling","isDomNode","matches","prevNode","previousElementSibling","hasClass","element","push","conditionsNodes","childNodes","lastElement","node","attr","insertAfter","separator","insertBefore","length","ActionPanel","left","onAddExpressionFieldClick","menu","getFieldsListMenu","getMenuItems","isUsed","some","expressionItem","getId","disallowedTypes","Menu","getExpressionActionPanel","getExpressionAllowedFieldsList","onclick","onAddExpressionField","Colors","close","adjustExpressionFieldsZIndexes","children","reverse","index","onExpressionFieldRemove","onExpressionFieldChange","conditionsItem","action","FieldActionPanel","getActionPanel","RuleGroup","setLayoutClass","clean","getBodyLayout","getFooterLayout","list","filteredDataList","conditionTarget","getField","actionTarget","getTypeId","TYPE_0","groupedList","isArray","Object","values","group","firstItem","entry","onRemove","groupItem","addEntry","TYPE_1","TYPE_2","allowedMultipleConditions","multiple","groupedConditions","display","onAddCondition","onAddFieldCondition","BaseEvent","groupedExpressions","entries","set","getEntries","getHeaderTitleLayout","titleOfRuleType","onRemoveClick","getFooterActionPanel","onAddFieldClick","getPopupWindow","setBindElement","currentTarget","onFieldsListMenuItemClick","fieldId","filteredOperations","getData","getDefaultValueState","fieldElements","setEntries","newEntry","isNil","toNumber","logic","getLogic","BaseField","FieldsRules","addItem","getHeader","formOptions","dependencies","getRuleTypeField","getRulesForm","HeaderCard","FormSettingsForm","description","groupData","getFormFields","onRuleGroupRemove","onAddRuleClick","unsubscribe","RadioButtonField","icon","onCreateRuleButtonClick","disallowed","clear","header","setBottomMargin","ruleForm","addField","removeField","skipPrepare","ContentWrapper"],"mappings":"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"}