{"version":3,"file":"fields-rules.bundle.js","sources":["../src/rule-type.js","../src/internal/field-element/field-element.js","../src/internal/field-value-element/field-value-element.js","../src/internal/type-separator/type-separator.js","../src/internal/rule-entry/rule-entry.js","../src/internal/field-action-panel/field-action-panel.js","../src/internal/rule-group/rule-group.js","../src/fields-rules.js"],"sourcesContent":["export default class RuleType\n{\n\tstatic TYPE_0 = 0;\n\tstatic TYPE_1 = 1;\n\tstatic TYPE_2 = 2;\n}","import 'ui.design-tokens';\n\nimport {EventEmitter} from 'main.core.events';\nimport {Cache, Tag, Text} from 'main.core';\nimport {IconButton} from 'landing.ui.component.iconbutton';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\nimport type {FormDictionary} from 'crm.form.type';\nimport type {CrmField} from '../../types';\n\nimport './css/style.css';\n\ntype FieldElementOptions = {\n\tid: string,\n\ttitle: string,\n\tremovable?: boolean,\n\tdraggable?: boolean,\n\tactionsLabel?: string,\n\tactionsList?: Array<{name: string, value: any}>,\n\tactionsValue?: any,\n\tonRemove?: () => void,\n\t// eslint-disable-next-line no-use-before-define\n\tcolor?: $Values<typeof FieldElement.Colors>,\n\tdictionary: FormDictionary,\n\tfields: CrmField,\n};\n\nconst defaultOptions = {\n\tremovable: true,\n\tdraggable: false,\n\t// eslint-disable-next-line no-use-before-define\n\tcolor: 'blue',\n};\n\nexport class FieldElement extends EventEmitter\n{\n\tstatic Colors = {\n\t\tblue: 'blue',\n\t\tgreen: 'green',\n\t\tred: 'red',\n\t};\n\n\tconstructor(options: FieldElementOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.UI.Field.RuleField.FieldElement');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\t\tthis.options = {...defaultOptions, ...options};\n\t\tthis.cache = new Cache.MemoryCache();\n\t}\n\n\tgetDragButtonLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('dragButton', () => {\n\t\t\tconst button = new IconButton({\n\t\t\t\ttype: IconButton.Types.drag,\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '20px',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn button.getLayout();\n\t\t});\n\t}\n\n\tgetActionsDropdown(): BX.Landing.UI.Field.DropdownInline\n\t{\n\t\treturn this.cache.remember('actionsDropdown', () => {\n\t\t\tconst field = new window.top.BX.Landing.UI.Field.DropdownInline({\n\t\t\t\ttitle: this.options.actionsLabel,\n\t\t\t\titems: this.options.actionsList,\n\t\t\t\tcontent: this.options.actionsValue,\n\t\t\t});\n\n\t\t\tfield.subscribe('onChange', () => {\n\t\t\t\tthis.emit('onChange');\n\t\t\t});\n\n\t\t\treturn field;\n\t\t});\n\t}\n\n\tgetActionsLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('actionsLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-element-text-action\">\n\t\t\t\t\t${this.getActionsDropdown().getLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('titleLayout', () => {\n\t\t\treturn Tag.render`<div class=\"landing-ui-field-element-text-title\">${Text.encode(this.options.title)}</div>`;\n\t\t});\n\t}\n\n\tgetRemoveButtonLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\tconst button = new IconButton({\n\t\t\t\ttype: IconButton.Types.remove,\n\t\t\t\tonClick: () => this.emit('onRemove'),\n\t\t\t\ticonSize: '9px',\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '20px',\n\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn button.getLayout();\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"landing-ui-field-element-${this.options.color}\"\n\t\t\t\t\tdata-field-id=\"${Text.encode(this.options.id)}\"\n\t\t\t\t>\n\t\t\t\t\t${this.options.draggable ? this.getDragButtonLayout() : ''}\n\t\t\t\t\t<div class=\"landing-ui-field-element-text\">\n\t\t\t\t\t\t${this.options.actionsLabel ? this.getActionsLayout() : ''}\n\t\t\t\t\t\t${this.getTitleLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.options.removable ? this.getRemoveButtonLayout() : ''}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n}\n","import 'ui.design-tokens';\n\nimport {EventEmitter} from 'main.core.events';\nimport {Cache, Dom, Tag, Text, Type} from 'main.core';\nimport {IconButton} from 'landing.ui.component.iconbutton';\nimport {Popup, Menu, MenuItem} from 'main.popup';\nimport {PageObject} from 'landing.pageobject';\nimport {Loc} from 'landing.loc';\nimport {TextField} from 'landing.ui.field.textfield';\nimport type {FormDictionary} from 'crm.form.type';\nimport {CrmField} from '../../types';\n\nimport './css/style.css';\n\ntype FieldValueState = {\n\toperation: string,\n\ttarget: string,\n\tvalue: any,\n}\n\ntype FieldValueElementOptions = {\n\tremovable: boolean,\n\tdictionary: FormDictionary,\n\tfields: Array<any>,\n\tdata: FieldValueState,\n};\n\nexport default class FieldValueElement extends EventEmitter\n{\n\toptions: FieldValueElementOptions;\n\tcache = new Cache.MemoryCache();\n\tstate: FieldValueState;\n\n\tconstructor(options: FieldValueElementOptions)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.ValueElement');\n\t\tthis.options = {...options};\n\t\tthis.state = {...this.options.data};\n\t}\n\n\tgetOperatorLabelLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('operatorLabelLayout', () => {\n\t\t\tconst text = this.getOperatorLabelText(this.options.data.operation);\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"landing-ui-rule-value-operator-label\"\n\t\t\t\t\tonclick=\"${this.onOperatorLabelClick.bind(this)}\"\n\t\t\t\t>${text}</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonOperatorLabelClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.getOperatorSettingsPopup().show();\n\t}\n\n\tgetTargetContainer()\n\t{\n\t\treturn this.cache.remember('targetContainer', () => {\n\t\t\treturn this.getLayout().closest('.landing-ui-panel-content-body-content') || this.getLayout();\n\t\t});\n\t}\n\n\tgetOperatorSettingsPopup()\n\t{\n\t\treturn this.cache.remember('operatorSettingsPopup', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\treturn new rootWindow.BX.Main.Popup({\n\t\t\t\tbindElement: this.getLayout(),\n\t\t\t\ttargetContainer: this.getTargetContainer(),\n\t\t\t\tcontent: this.getOperatorField().getLayout(),\n\t\t\t\tautoHide: true,\n\t\t\t\tminWidth: 160,\n\t\t\t\toffsetLeft: 20,\n\t\t\t\toffsetTop: 3,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetValueLabelLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('valueLabelLayout', () => {\n\t\t\tconst text = this.getValueLabelText(this.options.data.value);\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"landing-ui-rule-value-value-label\"\n\t\t\t\t\tonclick=\"${this.onValueLabelClick.bind(this)}\"\n\t\t\t\t>\n\t\t\t\t\t<span class=\"landing-ui-rule-value-value-label-inner\">${Text.encode(text)}</span>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tif (\n\t\t\t\tthis.options.data.operation === 'any'\n\t\t\t\t|| this.options.data.operation === 'empty'\n\t\t\t)\n\t\t\t{\n\t\t\t\tDom.hide(layout);\n\t\t\t}\n\n\t\t\treturn layout;\n\t\t});\n\t}\n\n\tsetValueLabelText(text: string)\n\t{\n\t\tthis.getValueLabelLayout().firstElementChild.textContent = text;\n\t}\n\n\tonValueLabelClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.getValueSettingsPopup().show();\n\t}\n\n\tgetValueSettingsPopup(): Popup\n\t{\n\t\treturn this.cache.remember('valueSettingsPopup', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\tconst popupContent = Tag.render`<div class=\"value-settings-popup\"></div>`;\n\t\t\tconst random = Text.getRandom();\n\t\t\tconst targetField = this.getTargetField();\n\n\t\t\tif (\n\t\t\t\ttargetField.type === 'list'\n\t\t\t\t|| targetField.type === 'product'\n\t\t\t\t|| targetField.type === 'checkbox'\n\t\t\t\t|| targetField.type === 'radio'\n\t\t\t\t|| targetField.type === 'bool'\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst valueItems = (() => {\n\t\t\t\t\tif (targetField.type === 'bool')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t{label: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_YES'), value: 'Y'},\n\t\t\t\t\t\t\t{label: Loc.getMessage('LANDING_RULE_FIELD_CONDITION_VALUE_NO'), value: 'N'},\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn targetField.items;\n\t\t\t\t})();\n\n\t\t\t\tvalueItems.forEach((item) => {\n\t\t\t\t\tconst checked = String(targetField.value) === String(item.value);\n\t\t\t\t\tDom.append(\n\t\t\t\t\t\tDom.append(\n\t\t\t\t\t\t\tthis.renderValueRadioButton({...item, id: random, checked}),\n\t\t\t\t\t\t\tpopupContent,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tpopupContent,\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst value = (() => {\n\t\t\t\t\tif (Type.isStringFilled(this.options.data.value))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.getValueLabelText(this.options.data.value);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn '';\n\t\t\t\t})();\n\t\t\t\tconst inputField = new TextField({\n\t\t\t\t\ttextOnly: true,\n\t\t\t\t\tonValueChange: () => {\n\t\t\t\t\t\tconst conditionValue = (\n\t\t\t\t\t\t\tinputField.getValue()\n\t\t\t\t\t\t\t|| Loc.getMessage('LANDING_RULE_CONDITION_VALUE_EMPTY')\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.setValueLabelText(conditionValue);\n\t\t\t\t\t\tthis.state.value = inputField.getValue();\n\t\t\t\t\t\tthis.emit('onChange');\n\t\t\t\t\t},\n\t\t\t\t\tcontent: value,\n\t\t\t\t});\n\n\t\t\t\tDom.append(inputField.getLayout(), popupContent);\n\t\t\t}\n\n\t\t\treturn new rootWindow.BX.Main.Popup({\n\t\t\t\tbindElement: this.getLayout(),\n\t\t\t\ttargetContainer: this.getTargetContainer(),\n\t\t\t\tcontent: popupContent,\n\t\t\t\twidth: 228,\n\t\t\t\tautoHide: true,\n\t\t\t\tmaxHeight: 200,\n\t\t\t\toffsetLeft: 20,\n\t\t\t\toffsetTop: 3,\n\t\t\t\tevents: {\n\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\tDom.addClass(\n\t\t\t\t\t\t\tthis.getLayout(),\n\t\t\t\t\t\t\t'landing-ui-rule-value-active',\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tDom.removeClass(\n\t\t\t\t\t\t\tthis.getLayout(),\n\t\t\t\t\t\t\t'landing-ui-rule-value-active',\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\trenderValueRadioButton({label, value, id, checked}): HTMLDivElement\n\t{\n\t\tconst onChange = () => {\n\t\t\tthis.setValueLabelText(label);\n\t\t\tthis.state.value = value;\n\n\t\t\tthis.emit('onChange');\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"value-settings-item value-settings-item-value\">\n\t\t\t\t<input\n\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\tid=\"value_${id}_${value}\"\n\t\t\t\t\tname=\"value_${id}_${this.options.data.target}\"\n\t\t\t\t\tonchange=\"${onChange}\"\n\t\t\t\t\t${checked ? 'checked' : ''}\n\t\t\t\t>\n\t\t\t\t<label for=\"value_${id}_${value}\">${Text.encode(label)}</label>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetOperatorField(): BX.Landing.UI.Field.Dropdown\n\t{\n\t\treturn this.cache.remember('operatorField', () => {\n\t\t\tconst {condition} = this.options.dictionary.deps;\n\t\t\tconst targetField = this.getTargetField();\n\t\t\treturn new BX.Landing.UI.Field.Radio({\n\t\t\t\tselector: 'operation',\n\t\t\t\tvalue: [this.state.operation],\n\t\t\t\titems: condition.operations\n\t\t\t\t\t.filter((item) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\t!Type.isArrayFilled(item.fieldTypes)\n\t\t\t\t\t\t\t\t|| item.fieldTypes.includes(targetField.type)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t\t!Type.isArrayFilled(item.excludeFieldTypes)\n\t\t\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\t\t\tType.isArrayFilled(item.excludeFieldTypes)\n\t\t\t\t\t\t\t\t\t&& !item.excludeFieldTypes.includes(targetField.type)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t})\n\t\t\t\t\t.map((item) => {\n\t\t\t\t\t\treturn {name: item.name, value: item.id};\n\t\t\t\t\t}),\n\t\t\t\tonChange: this.onOperationChange.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tsetOperationLabelText(text: string)\n\t{\n\t\tthis.getOperatorLabelLayout().textContent = text;\n\t}\n\n\tonOperationChange()\n\t{\n\t\tconst operatorField = this.getOperatorField();\n\t\tconst [value] = operatorField.getValue();\n\n\t\tif (\n\t\t\tvalue === 'empty'\n\t\t\t|| value === 'any'\n\t\t)\n\t\t{\n\t\t\tDom.hide(this.getValueLabelLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.getValueLabelLayout());\n\t\t}\n\n\t\tthis.setOperationLabelText(this.getOperatorLabelText(value));\n\t\tthis.state.operation = value;\n\t\tthis.emit('onChange');\n\t}\n\n\tgetRemoveButton()\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\treturn new IconButton({\n\t\t\t\ttype: IconButton.Types.remove,\n\t\t\t\ticonSize: '9px',\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '19px',\n\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t},\n\t\t\t\tonClick: () => {\n\t\t\t\t\tthis.emit('onRemove');\n\t\t\t\t\tthis.emit('onChange');\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"landing-ui-rule-value\"\n\t\t\t\t\tdata-target=\"${Text.encode(this.options.data.target)}\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"landing-ui-rule-value-text\">\n\t\t\t\t\t\t${this.getOperatorLabelLayout()}\n\t\t\t\t\t\t${this.getValueLabelLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"landing-ui-rule-value-actions\">\n\t\t\t\t\t\t${this.options.removable ? this.getRemoveButton().getLayout() : ''}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"landing-ui-rule-decoration\">\n\t\t\t\t\t\t<div class=\"landing-ui-rule-decoration-v-line\"></div>\n\t\t\t\t\t\t<div class=\"landing-ui-rule-decoration-h-line\"></div>\n\t\t\t\t\t\t<div class=\"landing-ui-rule-decoration-arrow\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetOperatorLabelText(operatorValue: string): string\n\t{\n\t\treturn this.options.dictionary.deps.condition.operations.reduce((acc, item) => {\n\t\t\tif (item.id === operatorValue)\n\t\t\t{\n\t\t\t\treturn item.name;\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, this.options.dictionary.deps.condition.operations[0].name);\n\t}\n\n\tgetTargetField(): CrmField\n\t{\n\t\treturn this.cache.remember('targetField', () => {\n\t\t\treturn this.options.fields.find((field) => {\n\t\t\t\treturn String(field.id) === String(this.options.data.target);\n\t\t\t});\n\t\t});\n\t}\n\n\tgetValueLabelText(value: string): string\n\t{\n\t\tconst targetField = this.getTargetField();\n\t\tif (Type.isPlainObject(targetField))\n\t\t{\n\t\t\tif (Type.isArrayFilled(targetField.items))\n\t\t\t{\n\t\t\t\tconst item = targetField.items.find((currentItem) => {\n\t\t\t\t\treturn String(currentItem.value) === String(value);\n\t\t\t\t});\n\n\t\t\t\tif (Type.isPlainObject(item))\n\t\t\t\t{\n\t\t\t\t\treturn item.label;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(value))\n\t\t\t{\n\t\t\t\tif (value === 'Y')\n\t\t\t\t{\n\t\t\t\t\treturn Loc.getMessage('LANDING_RULE_CONDITION_VALUE_YES');\n\t\t\t\t}\n\n\t\t\t\tif (value === 'N')\n\t\t\t\t{\n\t\t\t\t\treturn Loc.getMessage('LANDING_RULE_CONDITION_VALUE_NO');\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\treturn Loc.getMessage('LANDING_RULE_CONDITION_VALUE_EMPTY');\n\t}\n\n\tgetValue(): FieldValueState\n\t{\n\t\treturn {...this.state};\n\t}\n}\n","import 'ui.design-tokens';\n\nimport {Cache, Tag} from 'main.core';\nimport {Loc} from 'landing.loc';\n\nimport './css/style.css';\n\ntype TypeSeparatorOptions = {\n\ttypeId: number,\n};\n\nexport default class TypeSeparator\n{\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(options: TypeSeparatorOptions)\n\t{\n\t\tthis.options = {...options};\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-type-separator\">\n\t\t\t\t\t<div class=\"landing-ui-rule-entry-type-separator-inner\">\n\t\t\t\t\t\t${this.getSeparatorLabel()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSeparatorLabel(): string\n\t{\n\t\tif (String(this.options.typeId) === String(2))\n\t\t{\n\t\t\treturn Loc.getMessage('LANDING_RULE_TYPE_SEPARATOR_TYPE_2');\n\t\t}\n\n\t\treturn Loc.getMessage('LANDING_RULE_TYPE_SEPARATOR_TYPE_1');\n\t}\n}","import {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Cache, Dom, Tag, Type} from 'main.core';\nimport {Loc} from 'landing.loc';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {FieldElement} from '../field-element/field-element';\nimport FieldValueElement from '../field-value-element/field-value-element';\nimport TypeSeparator from '../type-separator/type-separator';\n\nimport './css/style.css';\n\ntype RuleEntryOptions = {\n\tenableHeader?: boolean,\n\ttypeId: number,\n\tfields: Array<any>,\n\tconditions: Array<FieldElement>,\n\texpressions: Array<FieldElement>,\n};\n\nexport default class RuleEntry extends EventEmitter\n{\n\toptions: RuleEntryOptions;\n\tconditions: Array<FieldElement | FieldValueElement> = [];\n\texpressions: Array<FieldElement> = [];\n\n\tconstructor(options: RuleEntryOptions) {\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.RuleEntry');\n\n\t\tthis.options = {enableHeader: true, expressions: [], ...options};\n\t\tthis.cache = new Cache.MemoryCache();\n\n\t\tthis.onConditionFieldValueRemove = this.onConditionFieldValueRemove.bind(this);\n\t\tthis.onConditionFieldRemove = this.onConditionFieldRemove.bind(this);\n\n\t\tif (Type.isArrayFilled(this.options.conditions))\n\t\t{\n\t\t\tthis.options.conditions.forEach((item) => {\n\t\t\t\tthis.addCondition(item);\n\t\t\t});\n\n\t\t\tthis.options.expressions.forEach((item) => {\n\t\t\t\tthis.addExpression(item);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetConditionsLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('conditionsLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-conditions\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetExpressionsLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('expressionsLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-expressions\">\n\t\t\t\t\t${this.getAddExpresionFieldLinkLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetHeaderLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-header\">${Loc.getMessage('LANDING_RULE_ENTRY_HEADER')}</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry\">\n\t\t\t\t\t${this.options.enableHeader ? this.getHeaderLayout() : ''}\n\t\t\t\t\t<div class=\"landing-ui-rule-entry-body\">\n\t\t\t\t\t\t${this.getConditionsLayout()}\n\t\t\t\t\t\t${this.getExpressionsLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonConditionFieldRemove(event: BaseEvent)\n\t{\n\t\tconst target: FieldElement = event.getTarget();\n\t\tconst targetLayout = target.getLayout();\n\n\t\tthis.conditions = this.conditions.filter((item) => {\n\t\t\treturn item !== target;\n\t\t});\n\n\t\tlet nextNode = targetLayout.nextElementSibling;\n\t\twhile (\n\t\t\tType.isDomNode(nextNode)\n\t\t\t&& !nextNode.matches('[class*=\"landing-ui-field-element\"]')\n\t\t)\n\t\t{\n\t\t\tthis.conditions = this.conditions.filter((item) => {\n\t\t\t\treturn item.getLayout() !== nextNode;\n\t\t\t});\n\n\t\t\tDom.remove(nextNode);\n\t\t\tnextNode = targetLayout.nextElementSibling;\n\t\t}\n\n\t\tif (!Type.isDomNode(nextNode))\n\t\t{\n\t\t\tconst prevNode = targetLayout.previousElementSibling;\n\t\t\tif (\n\t\t\t\tType.isDomNode(prevNode)\n\t\t\t\t&& Dom.hasClass(prevNode, 'landing-ui-rule-entry-type-separator')\n\t\t\t)\n\t\t\t{\n\t\t\t\tDom.remove(prevNode);\n\t\t\t}\n\t\t}\n\n\t\tDom.remove(targetLayout);\n\n\t\tthis.emit('onChange');\n\t}\n\n\tonConditionFieldValueRemove(event: BaseEvent)\n\t{\n\t\tconst target: FieldValueElement = event.getTarget();\n\t\tconst targetLayout = target.getLayout();\n\n\t\tthis.conditions = this.conditions.filter((item) => {\n\t\t\treturn item !== target;\n\t\t});\n\n\t\tif (Dom.hasClass(targetLayout.nextElementSibling, 'landing-ui-rule-entry-type-separator'))\n\t\t{\n\t\t\tDom.remove(targetLayout.nextElementSibling);\n\t\t}\n\t\telse if (Dom.hasClass(targetLayout.previousElementSibling, 'landing-ui-rule-entry-type-separator'))\n\t\t{\n\t\t\tDom.remove(targetLayout.previousElementSibling);\n\t\t}\n\n\t\tDom.remove(targetLayout);\n\t}\n\n\taddCondition(element: FieldValueElement)\n\t{\n\t\tif (!this.conditions.includes(element))\n\t\t{\n\t\t\tthis.conditions.push(element);\n\n\t\t\tif (element instanceof FieldValueElement)\n\t\t\t{\n\t\t\t\telement.subscribe('onRemove', this.onConditionFieldValueRemove);\n\t\t\t\telement.subscribe('onChange', () => this.emit('onChange'));\n\n\t\t\t\tconst conditionsNodes = [...this.getConditionsLayout().childNodes];\n\t\t\t\tconst lastElement = conditionsNodes.reduce((acc, node) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tDom.hasClass(node, 'landing-ui-rule-value')\n\t\t\t\t\t\t\t&& String(Dom.attr(node, 'data-target')) === String(element.options.data.target)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\tnode.matches('[class*=\"landing-ui-field-element\"]')\n\t\t\t\t\t\t\t&& String(Dom.attr(node, 'data-field-id')) === String(element.options.data.target)\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, null);\n\n\t\t\t\tif (Type.isDomNode(lastElement))\n\t\t\t\t{\n\t\t\t\t\tDom.insertAfter(element.getLayout(), lastElement);\n\n\t\t\t\t\tif (Dom.hasClass(lastElement, 'landing-ui-rule-value'))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst separator = new TypeSeparator({\n\t\t\t\t\t\t\ttypeId: this.options.typeId,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tDom.insertBefore(separator.getLayout(), element.getLayout());\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (element instanceof FieldElement)\n\t\t\t{\n\t\t\t\telement.subscribe('onRemove', this.onConditionFieldRemove);\n\t\t\t\telement.subscribe('onChange', () => this.emit('onChange'));\n\n\t\t\t\tif ([...this.getConditionsLayout().childNodes].length > 0)\n\t\t\t\t{\n\t\t\t\t\tconst separator = new TypeSeparator({\n\t\t\t\t\t\ttypeId: this.options.typeId,\n\t\t\t\t\t});\n\n\t\t\t\t\tDom.append(separator.getLayout(), this.getConditionsLayout());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tDom.append(\n\t\t\t\telement.getLayout(),\n\t\t\t\tthis.getConditionsLayout(),\n\t\t\t);\n\n\t\t\tthis.emit('onChange');\n\t\t}\n\t}\n\n\tgetExpressionActionPanel(): ActionPanel\n\t{\n\t\treturn this.cache.remember('expressionActionPanel', () => {\n\t\t\treturn new ActionPanel({\n\t\t\t\tleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'addField',\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_RULE_ENTRY_ADD_FIELD_LABEL'),\n\t\t\t\t\t\tonClick: this.onAddExpressionFieldClick.bind(this),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tonAddExpressionFieldClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst menu = this.getFieldsListMenu();\n\t\tmenu.getMenuItems().forEach((item) => {\n\t\t\tconst isUsed = this.expressions.some((expressionItem) => {\n\t\t\t\treturn String(expressionItem.options.id) === String(item.getId());\n\t\t\t});\n\n\t\t\tif (isUsed)\n\t\t\t{\n\t\t\t\tDom.addClass(item.getLayout().item, 'landing-ui-disabled');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(item.getLayout().item, 'landing-ui-disabled');\n\t\t\t}\n\t\t});\n\n\t\tthis.getFieldsListMenu().show();\n\t}\n\n\tgetExpressionAllowedFieldsList(): Array<any>\n\t{\n\t\tconst disallowedTypes = ['page', 'layout'];\n\t\treturn this.options.fields.filter((field) => {\n\t\t\tif (!disallowedTypes.includes(field.type))\n\t\t\t{\n\t\t\t\treturn !this.conditions.find((condition) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tType.isPlainObject(condition.options)\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tType.isPlainObject(condition.options.data)\n\t\t\t\t\t\t\t\t&& String(condition.options.data.target) === String(field.id)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t|| String(condition.options.id) === String(field.id)\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tgetFieldsListMenu()\n\t{\n\t\treturn this.cache.remember('fieldsListMenu', () => {\n\t\t\treturn new window.top.BX.Main.Menu({\n\t\t\t\tbindElement: this.getExpressionActionPanel().getLayout(),\n\t\t\t\tmaxHeight: 205,\n\t\t\t\titems: this.getExpressionAllowedFieldsList()\n\t\t\t\t\t.map((item) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\t\ttext: item.label,\n\t\t\t\t\t\t\tonclick: this.onAddExpressionField.bind(this, item),\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetAddExpresionFieldLinkLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('addExpressionFieldLinkLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-entry-add-expression-field-link\">\n\t\t\t\t\t<div class=\"landing-ui-rule-entry-add-expression-field-link-action-panel\">\n\t\t\t\t\t\t${this.getExpressionActionPanel().getLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"landing-ui-rule-entry-add-expression-field-link-separator\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonAddExpressionField(field)\n\t{\n\t\tconst element = new FieldElement({\n\t\t\tid: field.id,\n\t\t\ttitle: field.label,\n\t\t\tremovable: true,\n\t\t\tcolor: FieldElement.Colors.green,\n\t\t\tactionsLabel: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_LABEL'),\n\t\t\tactionsList: [\n\t\t\t\t{name: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_SHOW_LABEL'), value: 'show'},\n\t\t\t\t{name: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_HIDE_LABEL'), value: 'hide'},\n\t\t\t],\n\t\t\tactionsValue: 'show',\n\t\t});\n\n\t\tthis.addExpression(element);\n\n\t\tthis.getFieldsListMenu().close();\n\n\t\tthis.emit('onChange');\n\t}\n\n\tonExpressionFieldRemove(event: BaseEvent)\n\t{\n\t\tconst target = event.getTarget();\n\n\t\tDom.remove(target.getLayout());\n\n\t\tthis.expressions = this.expressions.filter((field) => {\n\t\t\treturn String(field.options.id) !== String(target.options.id);\n\t\t});\n\n\t\tthis.adjustExpressionFieldsZIndexes();\n\n\t\tthis.emit('onChange');\n\t}\n\n\tonExpressionFieldChange()\n\t{\n\t\tthis.emit('onChange');\n\t}\n\n\tadjustExpressionFieldsZIndexes()\n\t{\n\t\t[...this.getExpressionsLayout().children]\n\t\t\t.reverse()\n\t\t\t.forEach((node, index) => {\n\t\t\t\tif (node.matches('[class*=\"landing-ui-field-element\"]'))\n\t\t\t\t{\n\t\t\t\t\tDom.style(node, 'z-index', index + 2);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\taddExpression(element: FieldElement)\n\t{\n\t\tif (!this.expressions.includes(element))\n\t\t{\n\t\t\tthis.expressions.push(element);\n\n\t\t\telement.subscribe('onRemove', this.onExpressionFieldRemove.bind(this));\n\t\t\telement.subscribe('onChange', this.onExpressionFieldChange.bind(this));\n\n\t\t\t// @todo: refactoring\n\t\t\tvoid this.getLayout();\n\n\t\t\tDom.insertBefore(element.getLayout(), this.getAddExpresionFieldLinkLayout());\n\n\t\t\tthis.adjustExpressionFieldsZIndexes();\n\t\t}\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.conditions\n\t\t\t.filter((item) => item instanceof FieldValueElement)\n\t\t\t.reduce((acc, conditionsItem: FieldValueElement) => {\n\t\t\t\treturn [\n\t\t\t\t\t...acc,\n\t\t\t\t\t...this.expressions.map((expressionItem) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcondition: {\n\t\t\t\t\t\t\t\t...conditionsItem.getValue(),\n\t\t\t\t\t\t\t\tevent: 'change',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\taction: {\n\t\t\t\t\t\t\t\ttarget: expressionItem.options.id,\n\t\t\t\t\t\t\t\ttype: expressionItem.getActionsDropdown().getValue(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t\t];\n\t\t\t}, []);\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport {Cache, Tag, Type, Dom} from 'main.core';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {Loc} from 'landing.loc';\n\nimport './css/style.css';\n\nexport default class FieldActionPanel extends EventEmitter\n{\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.FormSettingsPanel.FieldRules.FieldActionPanel');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\n\t\tif (Type.isPlainObject(options.style))\n\t\t{\n\t\t\tDom.style(this.getLayout(), options.style);\n\t\t}\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-field-action-panel\">\n\t\t\t\t\t${this.getActionPanel().getLayout()}\n\t\t\t\t\t<div class=\"landing-ui-rule-field-action-panel-decoration\">\n\t\t\t\t\t\t<div class=\"landing-ui-rule-field-action-panel-decoration-v-line\"></div>\n\t\t\t\t\t\t<div class=\"landing-ui-rule-field-action-panel-decoration-h-line\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetActionPanel(): ActionPanel\n\t{\n\t\treturn this.cache.remember('actionPanel', () => {\n\t\t\treturn new ActionPanel({\n\t\t\t\tleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'addCondition',\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_RULE_GROUP_ADD_FIELD_CONDITION'),\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tthis.emit('onAddCondition');\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n}\n","import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport {Dom, Tag, Text, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {BaseField} from 'landing.ui.field.basefield';\nimport {Loc} from 'landing.loc';\nimport {IconButton} from 'landing.ui.component.iconbutton';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\nimport type {RuleGroupOptions} from '../../types';\nimport RuleEntry from '../rule-entry/rule-entry';\nimport RuleType from '../../rule-type';\nimport {FieldElement} from '../field-element/field-element';\nimport FieldValueElement from '../field-value-element/field-value-element';\nimport FieldActionPanel from '../field-action-panel/field-action-panel';\n\nimport './css/style.css';\n\nexport default class RuleGroup extends BaseField\n{\n\toptions: RuleGroupOptions;\n\n\tconstructor(options: RuleGroupOptions)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.Content.FieldRules.RuleGroup');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\t\tthis.setLayoutClass('landing-ui-rule-group');\n\n\t\tconst layout = this.getLayout();\n\t\tDom.clean(layout);\n\t\tDom.append(this.getHeaderLayout(), layout);\n\t\tDom.append(this.getBodyLayout(), layout);\n\t\tDom.append(this.getFooterLayout(), layout);\n\n\t\tif (Type.isArrayFilled(this.options.data.list))\n\t\t{\n\t\t\tconst filteredDataList = this.options.data.list.filter((item) => {\n\t\t\t\tconst conditionTarget = this.getField(item.condition.target);\n\t\t\t\tconst actionTarget = this.getField(item.action.target);\n\t\t\t\treturn conditionTarget && actionTarget;\n\t\t\t});\n\n\t\t\tif (this.getTypeId() === RuleType.TYPE_0)\n\t\t\t{\n\t\t\t\tconst groupedList = filteredDataList.reduce((acc, item) => {\n\t\t\t\t\tconst {target, operation, value} = item.condition;\n\t\t\t\t\tif (!Type.isArray(acc[`${target}${operation}${value}`]))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[`${target}${operation}${value}`] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tacc[`${target}${operation}${value}`].push(item);\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {});\n\n\t\t\t\tObject.values(groupedList).forEach((group, index) => {\n\t\t\t\t\tconst [firstItem] = group;\n\t\t\t\t\tif (Type.isPlainObject(firstItem))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst targetField = this.getField(firstItem.condition.target);\n\t\t\t\t\t\tconst entry = new RuleEntry({\n\t\t\t\t\t\t\tenableHeader: index === 0,\n\t\t\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\t\tonChange: () => this.emit('onChange'),\n\t\t\t\t\t\t\tconditions: [\n\t\t\t\t\t\t\t\tnew FieldElement({\n\t\t\t\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\t\t\t\tid: targetField.id,\n\t\t\t\t\t\t\t\t\ttitle: targetField.label,\n\t\t\t\t\t\t\t\t\tcolor: FieldElement.Colors.blue,\n\t\t\t\t\t\t\t\t\tonRemove: () => {\n\t\t\t\t\t\t\t\t\t\tthis.onConditionFieldRemove(entry);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tnew FieldValueElement({\n\t\t\t\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\t\t\t\tremovable: false,\n\t\t\t\t\t\t\t\t\tdata: group[0].condition,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\texpressions: group.map((groupItem) => {\n\t\t\t\t\t\t\t\tconst targetField = this.getField(groupItem.action.target);\n\t\t\t\t\t\t\t\treturn new FieldElement({\n\t\t\t\t\t\t\t\t\tid: targetField.id,\n\t\t\t\t\t\t\t\t\ttitle: targetField.label,\n\t\t\t\t\t\t\t\t\tremovable: true,\n\t\t\t\t\t\t\t\t\tcolor: FieldElement.Colors.green,\n\t\t\t\t\t\t\t\t\tactionsLabel: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_LABEL'),\n\t\t\t\t\t\t\t\t\tactionsList: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_SHOW_LABEL'),\n\t\t\t\t\t\t\t\t\t\t\tvalue: 'show',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_HIDE_LABEL'),\n\t\t\t\t\t\t\t\t\t\t\tvalue: 'hide',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tactionsValue: groupItem.action.type,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.addEntry(entry);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.getTypeId() === RuleType.TYPE_1\n\t\t\t\t|| this.getTypeId() === RuleType.TYPE_2\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst entry = new RuleEntry({\n\t\t\t\t\tenableHeader: true,\n\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\tonChange: () => this.emit('onChange'),\n\t\t\t\t});\n\n\t\t\t\tconst groupedList = filteredDataList.reduce((acc, item) => {\n\t\t\t\t\tconst {target} = item.condition;\n\t\t\t\t\tif (!Type.isArray(acc[target]))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[target] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tacc[target].push(item);\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {});\n\n\t\t\t\tObject.values(groupedList).forEach((group) => {\n\t\t\t\t\tconst [firstItem] = group;\n\t\t\t\t\tif (Type.isPlainObject(firstItem))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst targetField = this.getField(firstItem.condition.target);\n\n\t\t\t\t\t\tconst allowedMultipleConditions = (\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tthis.getTypeId() === RuleType.TYPE_2\n\t\t\t\t\t\t\t\t&& targetField.multiple\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t|| this.getTypeId() === RuleType.TYPE_1\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tentry.addCondition(\n\t\t\t\t\t\t\tnew FieldElement({\n\t\t\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\t\t\tid: targetField.id,\n\t\t\t\t\t\t\t\ttitle: targetField.label,\n\t\t\t\t\t\t\t\tcolor: FieldElement.Colors.blue,\n\t\t\t\t\t\t\t\tonRemove: () => {\n\t\t\t\t\t\t\t\t\tthis.onConditionFieldRemove(entry);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tconst groupedConditions = group.reduce((acc, item) => {\n\t\t\t\t\t\t\tacc[`${item.condition.operation}${item.condition.value}`] = item;\n\t\t\t\t\t\t\treturn acc;\n\t\t\t\t\t\t}, {});\n\n\t\t\t\t\t\tObject.values(groupedConditions).forEach((item) => {\n\t\t\t\t\t\t\tentry.addCondition(\n\t\t\t\t\t\t\t\tnew FieldValueElement({\n\t\t\t\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\t\t\t\tremovable: allowedMultipleConditions,\n\t\t\t\t\t\t\t\t\tdata: item.condition,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tentry.addCondition(\n\t\t\t\t\t\t\tnew FieldActionPanel({\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\tdisplay: allowedMultipleConditions ? null : 'none',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonAddCondition: () => {\n\t\t\t\t\t\t\t\t\tthis.onAddFieldCondition(\n\t\t\t\t\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\tentry,\n\t\t\t\t\t\t\t\t\t\t\t\ttarget: targetField.id,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tconst groupedExpressions = Object.values(filteredDataList).reduce((acc, item) => {\n\t\t\t\t\tconst {target, type} = item.action;\n\t\t\t\t\tacc[`${target}${type}`] = item;\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {});\n\n\t\t\t\tObject.values(groupedExpressions).forEach((item) => {\n\t\t\t\t\tconst targetField = this.getField(item.action.target);\n\t\t\t\t\tconst element = new FieldElement({\n\t\t\t\t\t\tid: targetField.id,\n\t\t\t\t\t\ttitle: targetField.label,\n\t\t\t\t\t\tremovable: true,\n\t\t\t\t\t\tcolor: FieldElement.Colors.green,\n\t\t\t\t\t\tactionsLabel: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_LABEL'),\n\t\t\t\t\t\tactionsList: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_SHOW_LABEL'),\n\t\t\t\t\t\t\t\tvalue: 'show',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: Loc.getMessage('LANDING_RULE_EXPRESSION_FIELD_ACTION_HIDE_LABEL'),\n\t\t\t\t\t\t\t\tvalue: 'hide',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\tactionsValue: item.action.type,\n\t\t\t\t\t});\n\n\t\t\t\t\tentry.addExpression(element);\n\t\t\t\t});\n\n\t\t\t\tthis.addEntry(entry);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetEntries(): Array<RuleEntry>\n\t{\n\t\treturn this.cache.remember('entries', () => []);\n\t}\n\n\tsetEntries(entries: Array<RuleEntry>)\n\t{\n\t\tthis.cache.set('entries', entries);\n\t}\n\n\taddEntry(entry: RuleEntry)\n\t{\n\t\tif (entry)\n\t\t{\n\t\t\tconst entries = this.getEntries();\n\t\t\tif (!entries.includes(entry))\n\t\t\t{\n\t\t\t\tentry.subscribe('onChange', () => this.emit('onChange'));\n\n\t\t\t\tentries.push(entry);\n\t\t\t\tDom.append(entry.getLayout(), this.getBodyLayout());\n\n\t\t\t\tthis.emit('onChange');\n\t\t\t}\n\t\t}\n\t}\n\n\tgetHeaderLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-group-header\">\n\t\t\t\t\t${this.getHeaderTitleLayout()}\n\t\t\t\t\t${this.getRemoveButtonLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetHeaderTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerTitleLayout', () => {\n\t\t\tconst titleOfRuleType = Loc.getMessage(`LANDING_FIELDS_RULES_TYPE_${this.getTypeId() + 1}`);\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-group-header-title\">${titleOfRuleType}</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetRemoveButtonLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('removeButtonLayout', () => {\n\t\t\tconst button = new IconButton({\n\t\t\t\ttype: IconButton.Types.remove,\n\t\t\t\tonClick: this.onRemoveClick.bind(this),\n\t\t\t\ttitle: Loc.getMessage('LANDING_RULE_GROUP_REMOVE_BUTTON_TITLE'),\n\t\t\t\tstyle: {\n\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn button.getLayout();\n\t\t});\n\t}\n\n\tonRemoveClick()\n\t{\n\t\tDom.remove(this.getLayout());\n\t\tthis.emit('onRemove');\n\t\tthis.emit('onChange');\n\t}\n\n\tgetBodyLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('bodyLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-group-body\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetFooterLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('footerLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-rule-group-footer\">\n\t\t\t\t\t${this.getFooterActionPanel().getLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetFooterActionPanel(): ActionPanel\n\t{\n\t\treturn this.cache.remember('footerActionPanel', () => {\n\t\t\treturn new ActionPanel({\n\t\t\t\tleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'selectField',\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_RULE_ENTRY_ADD_FIELD_LABEL'),\n\t\t\t\t\t\tonClick: this.onAddFieldClick.bind(this),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tonAddFieldClick(event: BaseEvent)\n\t{\n\t\tconst menu = this.getFieldsListMenu();\n\t\tmenu.getPopupWindow().setBindElement(event.currentTarget);\n\t\tmenu.show();\n\t}\n\n\tgetFieldsListMenu(): BX.Main.Menu\n\t{\n\t\treturn this.cache.remember('fieldsMenu', () => {\n\t\t\treturn new window.top.BX.Main.Menu({\n\t\t\t\tmaxHeight: 205,\n\t\t\t\titems: (\n\t\t\t\t\tthis.options.fields\n\t\t\t\t\t\t.map((field) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: field.id,\n\t\t\t\t\t\t\t\ttext: field.label,\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.onFieldsListMenuItemClick(field);\n\t\t\t\t\t\t\t\t\tthis.getFieldsListMenu().close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t})\n\t\t\t\t),\n\t\t\t\tautoHide: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDefaultValueState(fieldId: string): string\n\t{\n\t\tconst targetField = this.options.fields.find((field) => {\n\t\t\treturn String(field.id) === String(fieldId);\n\t\t});\n\n\t\tif (targetField)\n\t\t{\n\t\t\tconst filteredOperations = this.options.dictionary.deps.condition.operations.filter((operation) => {\n\t\t\t\treturn (\n\t\t\t\t\t(\n\t\t\t\t\t\t!Type.isArrayFilled(operation.fieldTypes)\n\t\t\t\t\t\t|| operation.fieldTypes.includes(targetField.type)\n\t\t\t\t\t)\n\t\t\t\t\t&& (\n\t\t\t\t\t\t!Type.isArrayFilled(operation.excludeFieldTypes)\n\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\tType.isArrayFilled(operation.excludeFieldTypes)\n\t\t\t\t\t\t\t&& !operation.excludeFieldTypes.includes(targetField.type)\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (Type.isArrayFilled(filteredOperations))\n\t\t\t{\n\t\t\t\treturn filteredOperations[0].id;\n\t\t\t}\n\t\t}\n\n\t\treturn '=';\n\t}\n\n\tonAddFieldCondition(event: BaseEvent)\n\t{\n\t\tconst {target, entry}: {target: string, entry: RuleEntry} = event.getData();\n\t\tentry.addCondition(\n\t\t\tnew FieldValueElement({\n\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\tfields: this.options.fields,\n\t\t\t\tremovable: true,\n\t\t\t\tdata: {\n\t\t\t\t\ttarget,\n\t\t\t\t\toperation: this.getDefaultValueState(target),\n\t\t\t\t\tvalue: null,\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\tonConditionFieldRemove(entry: RuleEntry)\n\t{\n\t\tconst fieldElements = entry.conditions.filter((item) => {\n\t\t\treturn item instanceof FieldElement;\n\t\t});\n\n\t\tif (fieldElements.length === 1)\n\t\t{\n\t\t\tconst entries = this.getEntries().filter((item) => {\n\t\t\t\treturn entry !== item;\n\t\t\t});\n\n\t\t\tthis.setEntries(entries);\n\n\t\t\tDom.remove(entry.getLayout());\n\t\t}\n\t}\n\n\tonFieldsListMenuItemClick(field)\n\t{\n\t\tif (this.getTypeId() === RuleType.TYPE_0)\n\t\t{\n\t\t\tconst enableHeader = this.getEntries().length === 0;\n\t\t\tconst entry = new RuleEntry({\n\t\t\t\tenableHeader,\n\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\tfields: this.options.fields,\n\t\t\t\tconditions: [\n\t\t\t\t\tnew FieldElement({\n\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\tid: field.id,\n\t\t\t\t\t\ttitle: field.label,\n\t\t\t\t\t\tcolor: FieldElement.Colors.blue,\n\t\t\t\t\t\tonRemove: () => {\n\t\t\t\t\t\t\tthis.onConditionFieldRemove(entry);\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew FieldValueElement({\n\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\t\tremovable: false,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\ttarget: field.id,\n\t\t\t\t\t\t\toperation: this.getDefaultValueState(field.id),\n\t\t\t\t\t\t\tvalue: null,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tonChange: () => this.emit('onChange'),\n\t\t\t});\n\n\t\t\tthis.addEntry(entry);\n\t\t}\n\n\t\tif (\n\t\t\tthis.getTypeId() === RuleType.TYPE_1\n\t\t\t|| this.getTypeId() === RuleType.TYPE_2\n\t\t)\n\t\t{\n\t\t\tconst allowedMultipleConditions = (\n\t\t\t\t(\n\t\t\t\t\tthis.getTypeId() === RuleType.TYPE_2\n\t\t\t\t\t&& field.multiple\n\t\t\t\t)\n\t\t\t\t|| this.getTypeId() === RuleType.TYPE_1\n\t\t\t);\n\n\t\t\tconst items = [\n\t\t\t\tnew FieldElement({\n\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\tid: field.id,\n\t\t\t\t\ttitle: field.label,\n\t\t\t\t\tcolor: FieldElement.Colors.blue,\n\t\t\t\t\tonRemove: () => {\n\t\t\t\t\t\tthis.onConditionFieldRemove(this.getEntries()[0]);\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew FieldValueElement({\n\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\tremovable: allowedMultipleConditions,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttarget: field.id,\n\t\t\t\t\t\toperation: this.getDefaultValueState(field.id),\n\t\t\t\t\t\tvalue: null,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t];\n\n\t\t\tif (\n\t\t\t\tthis.getTypeId() === RuleType.TYPE_1\n\t\t\t\t|| this.getTypeId() === RuleType.TYPE_2\n\t\t\t)\n\t\t\t{\n\t\t\t\titems.push(\n\t\t\t\t\tnew FieldActionPanel({\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tdisplay: allowedMultipleConditions ? null : 'none',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonAddCondition: () => {\n\t\t\t\t\t\t\tthis.onAddFieldCondition(\n\t\t\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\tentry: this.getEntries()[0],\n\t\t\t\t\t\t\t\t\t\ttarget: field.id,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst [entry] = this.getEntries();\n\t\t\tif (entry)\n\t\t\t{\n\t\t\t\titems.forEach((item) => {\n\t\t\t\t\tentry.addCondition(item);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst newEntry = new RuleEntry({\n\t\t\t\t\tenableHeader: true,\n\t\t\t\t\ttypeId: this.getTypeId(),\n\t\t\t\t\tfields: this.options.fields,\n\t\t\t\t\tconditions: items,\n\t\t\t\t\tonChange: () => this.emit('onChange'),\n\t\t\t\t});\n\n\t\t\t\tthis.addEntry(newEntry);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetId(): number\n\t{\n\t\tif (!Type.isNil(this.options.data.id))\n\t\t{\n\t\t\treturn this.options.data.id;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tgetTypeId(): number\n\t{\n\t\treturn Text.toNumber(this.options.data.typeId);\n\t}\n\n\tgetLogic(): 'or' | 'and'\n\t{\n\t\treturn this.getTypeId() === RuleType.TYPE_2 ? 'and' : 'or';\n\t}\n\n\tgetValue()\n\t{\n\t\tconst list = this.getEntries().reduce((acc, entry) => {\n\t\t\treturn [...acc, ...entry.getValue()];\n\t\t}, []);\n\n\t\treturn {\n\t\t\tid: this.getId(),\n\t\t\ttypeId: this.getTypeId(),\n\t\t\tlogic: this.getLogic(),\n\t\t\tlist,\n\t\t};\n\t}\n\n\tgetField(fieldId: string)\n\t{\n\t\treturn this.options.fields.find((item) => {\n\t\t\treturn String(item.id) === String(fieldId);\n\t\t});\n\t}\n}\n","import {Loc, Type, Dom} from 'main.core';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {HeaderCard} from 'landing.ui.card.headercard';\nimport {ActionPanel} from 'landing.ui.component.actionpanel';\nimport {RadioButtonField} from 'landing.ui.field.radiobuttonfield';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {BaseEvent} from 'main.core.events';\nimport RuleType from './rule-type';\nimport RuleGroup from './internal/rule-group/rule-group';\n\nimport './css/style.css';\n\nexport default class FieldsRules extends ContentWrapper\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.FieldsRulesContent');\n\n\t\tthis.addItem(this.getHeader());\n\n\t\tif (!Type.isArrayFilled(this.options.formOptions.data.dependencies))\n\t\t{\n\t\t\tthis.addItem(this.getRuleTypeField());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addItem(this.getRulesForm());\n\t\t\tthis.addItem(this.getActionPanel());\n\t\t}\n\t}\n\n\tgetHeader(): HeaderCard\n\t{\n\t\treturn this.cache.remember('headerCard', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FIELDS_RULES_TITLE'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetRulesForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('rulesForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\tselector: 'dependencies',\n\t\t\t\tdescription: null,\n\t\t\t\tfields: this.options.formOptions.data.dependencies.map((groupData) => {\n\t\t\t\t\treturn new RuleGroup({\n\t\t\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\t\t\tfields: this.getFormFields(),\n\t\t\t\t\t\tdata: groupData,\n\t\t\t\t\t\tonRemove: this.onRuleGroupRemove.bind(this),\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetActionPanel(): ActionPanel\n\t{\n\t\treturn this.cache.remember('actionPanel', () => {\n\t\t\treturn new ActionPanel({\n\t\t\t\tleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_FIELDS_ADD_NEW_RULE_LINK_LABEL'),\n\t\t\t\t\t\tonClick: this.onAddRuleClick.bind(this),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tonAddRuleClick()\n\t{\n\t\tthis.insertBefore(this.getRuleTypeField(), this.getActionPanel());\n\t\tthis.items.remove(this.getActionPanel());\n\t\tDom.remove(this.getActionPanel().getLayout());\n\t\tthis.getActionPanel().unsubscribe('onChange', this.onChange);\n\t}\n\n\tgetRuleTypeField(): RadioButtonField\n\t{\n\t\treturn this.cache.remember('ruleTypeField', () => {\n\t\t\treturn new RadioButtonField({\n\t\t\t\tselector: 'rules-type',\n\t\t\t\titems: Object.entries(RuleType).map(([, value]) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: `ruleType${value}`,\n\t\t\t\t\t\ticon: `landing-ui-rules-type${value + 1}-icon`,\n\t\t\t\t\t\ttitle: Loc.getMessage(`LANDING_FIELDS_RULES_TYPE_${value + 1}`),\n\t\t\t\t\t\tbutton: {\n\t\t\t\t\t\t\ttext: Loc.getMessage('LANDING_FIELDS_RULES_TYPE_BUTTON'),\n\t\t\t\t\t\t\tonClick: this.onCreateRuleButtonClick.bind(this, {type: value}),\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFormFields()\n\t{\n\t\tconst disallowedTypes = (() => {\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(this.options.dictionary.deps.field)\n\t\t\t\t|| !Type.isArrayFilled(this.options.dictionary.deps.field.disallowed)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.options.dictionary.deps.field.disallowed;\n\t\t})();\n\n\t\treturn this.options.formOptions.data.fields.filter((field) => {\n\t\t\treturn (\n\t\t\t\t!Type.isArrayFilled(disallowedTypes)\n\t\t\t\t|| (\n\t\t\t\t\t!disallowedTypes.includes(field.type)\n\t\t\t\t\t&& (\n\t\t\t\t\t\t!Type.isPlainObject(field.content)\n\t\t\t\t\t\t|| disallowedTypes.includes(field.content.type)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t);\n\t\t});\n\t}\n\n\tonCreateRuleButtonClick({type})\n\t{\n\t\tthis.clear();\n\n\t\tconst header = this.getHeader();\n\t\theader.setBottomMargin(false);\n\t\tthis.addItem(header);\n\n\t\tconst ruleForm = this.getRulesForm();\n\n\t\truleForm.addField(\n\t\t\tnew RuleGroup({\n\t\t\t\tdictionary: this.options.dictionary,\n\t\t\t\tfields: this.getFormFields(),\n\t\t\t\tdata: {\n\t\t\t\t\tid: 0,\n\t\t\t\t\ttypeId: type,\n\t\t\t\t\tlist: [],\n\t\t\t\t\tlogic: type === RuleType.TYPE_2 ? 'and' : 'or',\n\t\t\t\t},\n\t\t\t\tonRemove: this.onRuleGroupRemove.bind(this),\n\t\t\t}),\n\t\t);\n\n\t\tthis.addItem(ruleForm);\n\t\tthis.addItem(this.getActionPanel());\n\t}\n\n\tonRuleGroupRemove(event: BaseEvent)\n\t{\n\t\tthis.onChange(event);\n\n\t\tthis.getRulesForm().removeField(event.getTarget());\n\t\tevent.getTarget().unsubscribe('onChange', this.onChange);\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n\n\tvalueReducer(value: {[p: string]: any}): {[p: string]: any}\n\t{\n\t\treturn {\n\t\t\tdependencies: Object.values(value).filter((group) => {\n\t\t\t\treturn Type.isArrayFilled(group.list);\n\t\t\t}),\n\t\t};\n\t}\n}\n"],"names":["RuleType","defaultOptions","removable","draggable","color","FieldElement","options","setEventNamespace","subscribeFromOptions","fetchEventsFromOptions","cache","Cache","MemoryCache","remember","button","IconButton","type","Types","drag","style","width","getLayout","field","window","top","BX","Landing","UI","Field","DropdownInline","title","actionsLabel","items","actionsList","content","actionsValue","subscribe","emit","Tag","render","getActionsDropdown","Text","encode","remove","onClick","iconSize","marginLeft","id","getDragButtonLayout","getActionsLayout","getTitleLayout","getRemoveButtonLayout","EventEmitter","blue","green","red","FieldValueElement","state","data","text","getOperatorLabelText","operation","onOperatorLabelClick","bind","event","preventDefault","getOperatorSettingsPopup","show","closest","rootWindow","PageObject","getRootWindow","Main","Popup","bindElement","targetContainer","getTargetContainer","getOperatorField","autoHide","minWidth","offsetLeft","offsetTop","bindOptions","position","getValueLabelText","value","layout","onValueLabelClick","Dom","hide","getValueLabelLayout","firstElementChild","textContent","getValueSettingsPopup","popupContent","random","getRandom","targetField","getTargetField","valueItems","label","Loc","getMessage","forEach","item","checked","String","append","renderValueRadioButton","Type","isStringFilled","inputField","TextField","textOnly","onValueChange","conditionValue","getValue","setValueLabelText","maxHeight","events","onShow","addClass","onClose","removeClass","onChange","target","condition","dictionary","deps","Radio","selector","operations","filter","isArrayFilled","fieldTypes","includes","excludeFieldTypes","map","name","onOperationChange","getOperatorLabelLayout","operatorField","setOperationLabelText","getRemoveButton","operatorValue","reduce","acc","fields","find","isPlainObject","currentItem","TypeSeparator","getSeparatorLabel","typeId","RuleEntry","enableHeader","expressions","onConditionFieldValueRemove","onConditionFieldRemove","conditions","addCondition","addExpression","getAddExpresionFieldLinkLayout","getHeaderLayout","getConditionsLayout","getExpressionsLayout","getTarget","targetLayout","nextNode","nextElementSibling","isDomNode","matches","prevNode","previousElementSibling","hasClass","element","push","conditionsNodes","childNodes","lastElement","node","attr","insertAfter","separator","insertBefore","length","ActionPanel","left","onAddExpressionFieldClick","menu","getFieldsListMenu","getMenuItems","isUsed","some","expressionItem","getId","disallowedTypes","Menu","getExpressionActionPanel","getExpressionAllowedFieldsList","onclick","onAddExpressionField","Colors","close","adjustExpressionFieldsZIndexes","children","reverse","index","onExpressionFieldRemove","onExpressionFieldChange","conditionsItem","action","FieldActionPanel","getActionPanel","RuleGroup","setLayoutClass","clean","getBodyLayout","getFooterLayout","list","filteredDataList","conditionTarget","getField","actionTarget","getTypeId","TYPE_0","groupedList","isArray","Object","values","group","firstItem","entry","onRemove","groupItem","addEntry","TYPE_1","TYPE_2","allowedMultipleConditions","multiple","groupedConditions","display","onAddCondition","onAddFieldCondition","BaseEvent","groupedExpressions","entries","set","getEntries","getHeaderTitleLayout","titleOfRuleType","onRemoveClick","getFooterActionPanel","onAddFieldClick","getPopupWindow","setBindElement","currentTarget","onFieldsListMenuItemClick","fieldId","filteredOperations","getData","getDefaultValueState","fieldElements","setEntries","newEntry","isNil","toNumber","logic","getLogic","BaseField","FieldsRules","addItem","getHeader","formOptions","dependencies","getRuleTypeField","getRulesForm","HeaderCard","FormSettingsForm","description","groupData","getFormFields","onRuleGroupRemove","onAddRuleClick","unsubscribe","RadioButtonField","icon","onCreateRuleButtonClick","disallowed","clear","header","setBottomMargin","ruleForm","addField","removeField","skipPrepare","ContentWrapper"],"mappings":";;;;;;;;KAAqBA;;;;6BAAAA,oBAEJ;6BAFIA,oBAGJ;6BAHIA,oBAIJ;;;;;;;CCsBjB,IAAMC,cAAc,GAAG;GACtBC,SAAS,EAAE,IADW;GAEtBC,SAAS,EAAE,KAFW;;GAItBC,KAAK,EAAE;CAJe,CAAvB;AAOA,KAAaC,YAAb;GAAA;;GAQC,sBAAYC,OAAZ,EACA;KAAA;;KAAA;KACC;;KACA,MAAKC,iBAAL,CAAuB,4CAAvB;;KACA,MAAKC,oBAAL,CAA0BC,oDAAsB,CAACH,OAAD,CAAhD;;KACA,MAAKA,OAAL,mCAAmBL,cAAnB,GAAsCK,OAAtC;KACA,MAAKI,KAAL,GAAa,IAAIC,eAAK,CAACC,WAAV,EAAb;KALD;;;GATD;KAAA;KAAA,sCAkBC;OACC,OAAO,KAAKF,KAAL,CAAWG,QAAX,CAAoB,YAApB,EAAkC,YAAM;SAC9C,IAAMC,MAAM,GAAG,IAAIC,0CAAJ,CAAe;WAC7BC,IAAI,EAAED,0CAAU,CAACE,KAAX,CAAiBC,IADM;WAE7BC,KAAK,EAAE;aACNC,KAAK,EAAE;;UAHM,CAAf;SAOA,OAAON,MAAM,CAACO,SAAP,EAAP;QARM,CAAP;;;KAnBF;KAAA,qCAgCC;OAAA;;OACC,OAAO,KAAKX,KAAL,CAAWG,QAAX,CAAoB,iBAApB,EAAuC,YAAM;SACnD,IAAMS,KAAK,GAAG,IAAIC,MAAM,CAACC,GAAP,CAAWC,EAAX,CAAcC,OAAd,CAAsBC,EAAtB,CAAyBC,KAAzB,CAA+BC,cAAnC,CAAkD;WAC/DC,KAAK,EAAE,MAAI,CAACxB,OAAL,CAAayB,YAD2C;WAE/DC,KAAK,EAAE,MAAI,CAAC1B,OAAL,CAAa2B,WAF2C;WAG/DC,OAAO,EAAE,MAAI,CAAC5B,OAAL,CAAa6B;UAHT,CAAd;SAMAb,KAAK,CAACc,SAAN,CAAgB,UAAhB,EAA4B,YAAM;WACjC,MAAI,CAACC,IAAL,CAAU,UAAV;UADD;SAIA,OAAOf,KAAP;QAXM,CAAP;;;KAjCF;KAAA,mCAiDC;OAAA;;OACC,OAAO,KAAKZ,KAAL,CAAWG,QAAX,CAAoB,eAApB,EAAqC,YAAM;SACjD,OAAOyB,aAAG,CAACC,MAAX,wLAEI,MAAI,CAACC,kBAAL,GAA0BnB,SAA1B,EAFJ;QADM,CAAP;;;KAlDF;KAAA,iCA4DC;OAAA;;OACC,OAAO,KAAKX,KAAL,CAAWG,QAAX,CAAoB,aAApB,EAAmC,YAAM;SAC/C,OAAOyB,aAAG,CAACC,MAAX,iJAAqEE,cAAI,CAACC,MAAL,CAAY,MAAI,CAACpC,OAAL,CAAawB,KAAzB,CAArE;QADM,CAAP;;;KA7DF;KAAA,wCAmEC;OAAA;;OACC,OAAO,KAAKpB,KAAL,CAAWG,QAAX,CAAoB,cAApB,EAAoC,YAAM;SAChD,IAAMC,MAAM,GAAG,IAAIC,0CAAJ,CAAe;WAC7BC,IAAI,EAAED,0CAAU,CAACE,KAAX,CAAiB0B,MADM;WAE7BC,OAAO,EAAE;aAAA,OAAM,MAAI,CAACP,IAAL,CAAU,UAAV,CAAN;YAFoB;WAG7BQ,QAAQ,EAAE,KAHmB;WAI7B1B,KAAK,EAAE;aACNC,KAAK,EAAE,MADD;aAEN0B,UAAU,EAAE;;UANC,CAAf;SAUA,OAAOhC,MAAM,CAACO,SAAP,EAAP;QAXM,CAAP;;;KApEF;KAAA,4BAoFC;OAAA;;OACC,OAAO,KAAKX,KAAL,CAAWG,QAAX,CAAoB,QAApB,EAA8B,YAAM;SAC1C,OAAOyB,aAAG,CAACC,MAAX,yWAEoC,MAAI,CAACjC,OAAL,CAAaF,KAFjD,EAGmBqC,cAAI,CAACC,MAAL,CAAY,MAAI,CAACpC,OAAL,CAAayC,EAAzB,CAHnB,EAKI,MAAI,CAACzC,OAAL,CAAaH,SAAb,GAAyB,MAAI,CAAC6C,mBAAL,EAAzB,GAAsD,EAL1D,EAOK,MAAI,CAAC1C,OAAL,CAAayB,YAAb,GAA4B,MAAI,CAACkB,gBAAL,EAA5B,GAAsD,EAP3D,EAQK,MAAI,CAACC,cAAL,EARL,EAUI,MAAI,CAAC5C,OAAL,CAAaJ,SAAb,GAAyB,MAAI,CAACiD,qBAAL,EAAzB,GAAwD,EAV5D;QADM,CAAP;;;GArFF;CAAA,EAAkCC,6BAAlC;6BAAa/C,wBAEI;GACfgD,IAAI,EAAE,MADS;GAEfC,KAAK,EAAE,OAFQ;GAGfC,GAAG,EAAE;CAHU;;;;;;;;KCRIC;;;GAMpB,2BAAYlD,OAAZ,EACA;KAAA;;KAAA;KACC,+GAAMA,OAAN;KADD,gFAJQ,IAAIK,eAAK,CAACC,WAAV,EAIR;;KAEC,MAAKL,iBAAL,CAAuB,oDAAvB;;KACA,MAAKD,OAAL,uBAAmBA,OAAnB;KACA,MAAKmD,KAAL,uBAAiB,MAAKnD,OAAL,CAAaoD,IAA9B;KAJD;;;;;8CAQA;OAAA;;OACC,OAAO,KAAKhD,KAAL,CAAWG,QAAX,CAAoB,qBAApB,EAA2C,YAAM;SACvD,IAAM8C,IAAI,GAAG,MAAI,CAACC,oBAAL,CAA0B,MAAI,CAACtD,OAAL,CAAaoD,IAAb,CAAkBG,SAA5C,CAAb;;SACA,OAAOvB,aAAG,CAACC,MAAX,uNAGa,MAAI,CAACuB,oBAAL,CAA0BC,IAA1B,CAA+B,MAA/B,CAHb,EAIIJ,IAJJ;QAFM,CAAP;;;;0CAWoBK,OACrB;OACCA,KAAK,CAACC,cAAN;OACA,KAAKC,wBAAL,GAAgCC,IAAhC;;;;0CAID;OAAA;;OACC,OAAO,KAAKzD,KAAL,CAAWG,QAAX,CAAoB,iBAApB,EAAuC,YAAM;SACnD,OAAO,MAAI,CAACQ,SAAL,GAAiB+C,OAAjB,CAAyB,wCAAzB,KAAsE,MAAI,CAAC/C,SAAL,EAA7E;QADM,CAAP;;;;gDAMD;OAAA;;OACC,OAAO,KAAKX,KAAL,CAAWG,QAAX,CAAoB,uBAApB,EAA6C,YAAM;SACzD,IAAMwD,UAAU,GAAGC,6BAAU,CAACC,aAAX,EAAnB;SACA,OAAO,IAAIF,UAAU,CAAC5C,EAAX,CAAc+C,IAAd,CAAmBC,KAAvB,CAA6B;WACnCC,WAAW,EAAE,MAAI,CAACrD,SAAL,EADsB;WAEnCsD,eAAe,EAAE,MAAI,CAACC,kBAAL,EAFkB;WAGnC1C,OAAO,EAAE,MAAI,CAAC2C,gBAAL,GAAwBxD,SAAxB,EAH0B;WAInCyD,QAAQ,EAAE,IAJyB;WAKnCC,QAAQ,EAAE,GALyB;WAMnCC,UAAU,EAAE,EANuB;WAOnCC,SAAS,EAAE,CAPwB;WAQnCC,WAAW,EAAE;aACZC,QAAQ,EAAE;;UATL,CAAP;QAFM,CAAP;;;;2CAkBD;OAAA;;OACC,OAAO,KAAKzE,KAAL,CAAWG,QAAX,CAAoB,kBAApB,EAAwC,YAAM;SACpD,IAAM8C,IAAI,GAAG,MAAI,CAACyB,iBAAL,CAAuB,MAAI,CAAC9E,OAAL,CAAaoD,IAAb,CAAkB2B,KAAzC,CAAb;;SACA,IAAMC,MAAM,GAAGhD,aAAG,CAACC,MAAP,2SAGC,MAAI,CAACgD,iBAAL,CAAuBxB,IAAvB,CAA4B,MAA5B,CAHD,EAK8CtB,cAAI,CAACC,MAAL,CAAYiB,IAAZ,CAL9C,CAAZ;;SASA,IACC,MAAI,CAACrD,OAAL,CAAaoD,IAAb,CAAkBG,SAAlB,KAAgC,KAAhC,IACG,MAAI,CAACvD,OAAL,CAAaoD,IAAb,CAAkBG,SAAlB,KAAgC,OAFpC,EAIA;WACC2B,aAAG,CAACC,IAAJ,CAASH,MAAT;;;SAGD,OAAOA,MAAP;QAnBM,CAAP;;;;uCAuBiB3B,MAClB;OACC,KAAK+B,mBAAL,GAA2BC,iBAA3B,CAA6CC,WAA7C,GAA2DjC,IAA3D;;;;uCAGiBK,OAClB;OACCA,KAAK,CAACC,cAAN;OACA,KAAK4B,qBAAL,GAA6B1B,IAA7B;;;;6CAID;OAAA;;OACC,OAAO,KAAKzD,KAAL,CAAWG,QAAX,CAAoB,oBAApB,EAA0C,YAAM;SACtD,IAAMwD,UAAU,GAAGC,6BAAU,CAACC,aAAX,EAAnB;SACA,IAAMuB,YAAY,GAAGxD,aAAG,CAACC,MAAP,iIAAlB;SACA,IAAMwD,MAAM,GAAGtD,cAAI,CAACuD,SAAL,EAAf;;SACA,IAAMC,WAAW,GAAG,MAAI,CAACC,cAAL,EAApB;;SAEA,IACCD,WAAW,CAACjF,IAAZ,KAAqB,MAArB,IACGiF,WAAW,CAACjF,IAAZ,KAAqB,SADxB,IAEGiF,WAAW,CAACjF,IAAZ,KAAqB,UAFxB,IAGGiF,WAAW,CAACjF,IAAZ,KAAqB,OAHxB,IAIGiF,WAAW,CAACjF,IAAZ,KAAqB,MALzB,EAOA;WACC,IAAMmF,UAAU,GAAI,YAAM;aACzB,IAAIF,WAAW,CAACjF,IAAZ,KAAqB,MAAzB,EACA;eACC,OAAO,CACN;iBAACoF,KAAK,EAAEC,eAAG,CAACC,UAAJ,CAAe,wCAAf,CAAR;iBAAkEjB,KAAK,EAAE;gBADnE,EAEN;iBAACe,KAAK,EAAEC,eAAG,CAACC,UAAJ,CAAe,uCAAf,CAAR;iBAAiEjB,KAAK,EAAE;gBAFlE,CAAP;;;aAMD,OAAOY,WAAW,CAACjE,KAAnB;YATkB,EAAnB;;WAYAmE,UAAU,CAACI,OAAX,CAAmB,UAACC,IAAD,EAAU;aAC5B,IAAMC,OAAO,GAAGC,MAAM,CAACT,WAAW,CAACZ,KAAb,CAAN,KAA8BqB,MAAM,CAACF,IAAI,CAACnB,KAAN,CAApD;aACAG,aAAG,CAACmB,MAAJ,CACCnB,aAAG,CAACmB,MAAJ,CACC,MAAI,CAACC,sBAAL,qCAAgCJ,IAAhC;eAAsCzD,EAAE,EAAEgD,MAA1C;eAAkDU,OAAO,EAAPA;gBADnD,EAECX,YAFD,CADD,EAKCA,YALD;YAFD;UApBD,MAgCA;WACC,IAAMT,KAAK,GAAI,YAAM;aACpB,IAAIwB,cAAI,CAACC,cAAL,CAAoB,MAAI,CAACxG,OAAL,CAAaoD,IAAb,CAAkB2B,KAAtC,CAAJ,EACA;eACC,OAAO,MAAI,CAACD,iBAAL,CAAuB,MAAI,CAAC9E,OAAL,CAAaoD,IAAb,CAAkB2B,KAAzC,CAAP;;;aAGD,OAAO,EAAP;YANa,EAAd;;WAQA,IAAM0B,UAAU,GAAG,IAAIC,oCAAJ,CAAc;aAChCC,QAAQ,EAAE,IADsB;aAEhCC,aAAa,EAAE,yBAAM;eACpB,IAAMC,cAAc,GACnBJ,UAAU,CAACK,QAAX,MACGf,eAAG,CAACC,UAAJ,CAAe,oCAAf,CAFJ;;eAIA,MAAI,CAACe,iBAAL,CAAuBF,cAAvB;;eACA,MAAI,CAAC1D,KAAL,CAAW4B,KAAX,GAAmB0B,UAAU,CAACK,QAAX,EAAnB;;eACA,MAAI,CAAC/E,IAAL,CAAU,UAAV;cAT+B;aAWhCH,OAAO,EAAEmD;YAXS,CAAnB;WAcAG,aAAG,CAACmB,MAAJ,CAAWI,UAAU,CAAC1F,SAAX,EAAX,EAAmCyE,YAAnC;;;SAGD,OAAO,IAAIzB,UAAU,CAAC5C,EAAX,CAAc+C,IAAd,CAAmBC,KAAvB,CAA6B;WACnCC,WAAW,EAAE,MAAI,CAACrD,SAAL,EADsB;WAEnCsD,eAAe,EAAE,MAAI,CAACC,kBAAL,EAFkB;WAGnC1C,OAAO,EAAE4D,YAH0B;WAInC1E,KAAK,EAAE,GAJ4B;WAKnC0D,QAAQ,EAAE,IALyB;WAMnCwC,SAAS,EAAE,GANwB;WAOnCtC,UAAU,EAAE,EAPuB;WAQnCC,SAAS,EAAE,CARwB;WASnCsC,MAAM,EAAE;aACPC,MAAM,EAAE,kBAAM;eACbhC,aAAG,CAACiC,QAAJ,CACC,MAAI,CAACpG,SAAL,EADD,EAEC,8BAFD;cAFM;aAOPqG,OAAO,EAAE,mBAAM;eACdlC,aAAG,CAACmC,WAAJ,CACC,MAAI,CAACtG,SAAL,EADD,EAEC,8BAFD;;;UAjBI,CAAP;QAhEM,CAAP;;;;kDA4FD;OAAA;;OAAA,IADwB+E,KACxB,QADwBA,KACxB;WAD+Bf,KAC/B,QAD+BA,KAC/B;WADsCtC,EACtC,QADsCA,EACtC;WAD0C0D,OAC1C,QAD0CA,OAC1C;;OACC,IAAMmB,QAAQ,GAAG,SAAXA,QAAW,GAAM;SACtB,MAAI,CAACP,iBAAL,CAAuBjB,KAAvB;;SACA,MAAI,CAAC3C,KAAL,CAAW4B,KAAX,GAAmBA,KAAnB;;SAEA,MAAI,CAAChD,IAAL,CAAU,UAAV;QAJD;;OAOA,OAAOC,aAAG,CAACC,MAAX,0YAIeQ,EAJf,EAIqBsC,KAJrB,EAKiBtC,EALjB,EAKuB,KAAKzC,OAAL,CAAaoD,IAAb,CAAkBmE,MALzC,EAMeD,QANf,EAOKnB,OAAO,GAAG,SAAH,GAAe,EAP3B,EASsB1D,EATtB,EAS4BsC,KAT5B,EASsC5C,cAAI,CAACC,MAAL,CAAY0D,KAAZ,CATtC;;;;wCAeD;OAAA;;OACC,OAAO,KAAK1F,KAAL,CAAWG,QAAX,CAAoB,eAApB,EAAqC,YAAM;SACjD,IAAOiH,SAAP,GAAoB,MAAI,CAACxH,OAAL,CAAayH,UAAb,CAAwBC,IAA5C,CAAOF,SAAP;;SACA,IAAM7B,WAAW,GAAG,MAAI,CAACC,cAAL,EAApB;;SACA,OAAO,IAAIzE,EAAE,CAACC,OAAH,CAAWC,EAAX,CAAcC,KAAd,CAAoBqG,KAAxB,CAA8B;WACpCC,QAAQ,EAAE,WAD0B;WAEpC7C,KAAK,EAAE,CAAC,MAAI,CAAC5B,KAAL,CAAWI,SAAZ,CAF6B;WAGpC7B,KAAK,EAAE8F,SAAS,CAACK,UAAV,CACLC,MADK,CACE,UAAC5B,IAAD,EAAU;aACjB,OACC,CACC,CAACK,cAAI,CAACwB,aAAL,CAAmB7B,IAAI,CAAC8B,UAAxB,CAAD,IACG9B,IAAI,CAAC8B,UAAL,CAAgBC,QAAhB,CAAyBtC,WAAW,CAACjF,IAArC,CAFJ,MAKC,CAAC6F,cAAI,CAACwB,aAAL,CAAmB7B,IAAI,CAACgC,iBAAxB,CAAD,IAEC3B,cAAI,CAACwB,aAAL,CAAmB7B,IAAI,CAACgC,iBAAxB,KACG,CAAChC,IAAI,CAACgC,iBAAL,CAAuBD,QAAvB,CAAgCtC,WAAW,CAACjF,IAA5C,CARN,CADD;YAFK,EAgBLyH,GAhBK,CAgBD,UAACjC,IAAD,EAAU;aACd,OAAO;eAACkC,IAAI,EAAElC,IAAI,CAACkC,IAAZ;eAAkBrD,KAAK,EAAEmB,IAAI,CAACzD;cAArC;YAjBK,CAH6B;WAsBpC6E,QAAQ,EAAE,MAAI,CAACe,iBAAL,CAAuB5E,IAAvB,CAA4B,MAA5B;UAtBJ,CAAP;QAHM,CAAP;;;;2CA8BqBJ,MACtB;OACC,KAAKiF,sBAAL,GAA8BhD,WAA9B,GAA4CjC,IAA5C;;;;yCAID;OACC,IAAMkF,aAAa,GAAG,KAAKhE,gBAAL,EAAtB;;OACA,4BAAgBgE,aAAa,CAACzB,QAAd,EAAhB;;WAAO/B,KAAP;;OAEA,IACCA,KAAK,KAAK,OAAV,IACGA,KAAK,KAAK,KAFd,EAIA;SACCG,aAAG,CAACC,IAAJ,CAAS,KAAKC,mBAAL,EAAT;QALD,MAQA;SACCF,aAAG,CAACrB,IAAJ,CAAS,KAAKuB,mBAAL,EAAT;;;OAGD,KAAKoD,qBAAL,CAA2B,KAAKlF,oBAAL,CAA0ByB,KAA1B,CAA3B;OACA,KAAK5B,KAAL,CAAWI,SAAX,GAAuBwB,KAAvB;OACA,KAAKhD,IAAL,CAAU,UAAV;;;;uCAID;OAAA;;OACC,OAAO,KAAK3B,KAAL,CAAWG,QAAX,CAAoB,cAApB,EAAoC,YAAM;SAChD,OAAO,IAAIE,0CAAJ,CAAe;WACrBC,IAAI,EAAED,0CAAU,CAACE,KAAX,CAAiB0B,MADF;WAErBE,QAAQ,EAAE,KAFW;WAGrB1B,KAAK,EAAE;aACNC,KAAK,EAAE,MADD;aAEN0B,UAAU,EAAE;YALQ;WAOrBF,OAAO,EAAE,mBAAM;aACd,MAAI,CAACP,IAAL,CAAU,UAAV;;aACA,MAAI,CAACA,IAAL,CAAU,UAAV;;UATK,CAAP;QADM,CAAP;;;;iCAiBD;OAAA;;OACC,OAAO,KAAK3B,KAAL,CAAWG,QAAX,CAAoB,QAApB,EAA8B,YAAM;SAC1C,OAAOyB,aAAG,CAACC,MAAX,+qBAGiBE,cAAI,CAACC,MAAL,CAAY,OAAI,CAACpC,OAAL,CAAaoD,IAAb,CAAkBmE,MAA9B,CAHjB,EAMK,OAAI,CAACe,sBAAL,EANL,EAOK,OAAI,CAAClD,mBAAL,EAPL,EAUK,OAAI,CAACpF,OAAL,CAAaJ,SAAb,GAAyB,OAAI,CAAC6I,eAAL,GAAuB1H,SAAvB,EAAzB,GAA8D,EAVnE;QADM,CAAP;;;;0CAuBoB2H,eACrB;OACC,OAAO,KAAK1I,OAAL,CAAayH,UAAb,CAAwBC,IAAxB,CAA6BF,SAA7B,CAAuCK,UAAvC,CAAkDc,MAAlD,CAAyD,UAACC,GAAD,EAAM1C,IAAN,EAAe;SAC9E,IAAIA,IAAI,CAACzD,EAAL,KAAYiG,aAAhB,EACA;WACC,OAAOxC,IAAI,CAACkC,IAAZ;;;SAGD,OAAOQ,GAAP;QANM,EAOJ,KAAK5I,OAAL,CAAayH,UAAb,CAAwBC,IAAxB,CAA6BF,SAA7B,CAAuCK,UAAvC,CAAkD,CAAlD,EAAqDO,IAPjD,CAAP;;;;sCAWD;OAAA;;OACC,OAAO,KAAKhI,KAAL,CAAWG,QAAX,CAAoB,aAApB,EAAmC,YAAM;SAC/C,OAAO,OAAI,CAACP,OAAL,CAAa6I,MAAb,CAAoBC,IAApB,CAAyB,UAAC9H,KAAD,EAAW;WAC1C,OAAOoF,MAAM,CAACpF,KAAK,CAACyB,EAAP,CAAN,KAAqB2D,MAAM,CAAC,OAAI,CAACpG,OAAL,CAAaoD,IAAb,CAAkBmE,MAAnB,CAAlC;UADM,CAAP;QADM,CAAP;;;;uCAOiBxC,OAClB;OACC,IAAMY,WAAW,GAAG,KAAKC,cAAL,EAApB;;OACA,IAAIW,cAAI,CAACwC,aAAL,CAAmBpD,WAAnB,CAAJ,EACA;SACC,IAAIY,cAAI,CAACwB,aAAL,CAAmBpC,WAAW,CAACjE,KAA/B,CAAJ,EACA;WACC,IAAMwE,IAAI,GAAGP,WAAW,CAACjE,KAAZ,CAAkBoH,IAAlB,CAAuB,UAACE,WAAD,EAAiB;aACpD,OAAO5C,MAAM,CAAC4C,WAAW,CAACjE,KAAb,CAAN,KAA8BqB,MAAM,CAACrB,KAAD,CAA3C;YADY,CAAb;;WAIA,IAAIwB,cAAI,CAACwC,aAAL,CAAmB7C,IAAnB,CAAJ,EACA;aACC,OAAOA,IAAI,CAACJ,KAAZ;;;;SAIF,IAAIS,cAAI,CAACC,cAAL,CAAoBzB,KAApB,CAAJ,EACA;WACC,IAAIA,KAAK,KAAK,GAAd,EACA;aACC,OAAOgB,eAAG,CAACC,UAAJ,CAAe,kCAAf,CAAP;;;WAGD,IAAIjB,KAAK,KAAK,GAAd,EACA;aACC,OAAOgB,eAAG,CAACC,UAAJ,CAAe,iCAAf,CAAP;;;WAGD,OAAOjB,KAAP;;;;OAIF,OAAOgB,eAAG,CAACC,UAAJ,CAAe,oCAAf,CAAP;;;;gCAID;OACC,2BAAW,KAAK7C,KAAhB;;;;GApX6CL;;;;;;;;KChB1BmG;GAIpB,uBAAYjJ,OAAZ,EACA;KAAA;KAAA,2CAHQ,IAAIK,eAAK,CAACC,WAAV,EAGR;KACC,KAAKN,OAAL,uBAAmBA,OAAnB;;;;;iCAID;OAAA;;OACC,OAAO,KAAKI,KAAL,CAAWG,QAAX,CAAoB,QAApB,EAA8B,YAAM;SAC1C,OAAOyB,aAAG,CAACC,MAAX,sRAGK,KAAI,CAACiH,iBAAL,EAHL;QADM,CAAP;;;;yCAYD;OACC,IAAI9C,MAAM,CAAC,KAAKpG,OAAL,CAAamJ,MAAd,CAAN,KAAgC/C,MAAM,CAAC,CAAD,CAA1C,EACA;SACC,OAAOL,eAAG,CAACC,UAAJ,CAAe,oCAAf,CAAP;;;OAGD,OAAOD,eAAG,CAACC,UAAJ,CAAe,oCAAf,CAAP;;;;;;;;;;;;KCtBmBoD;;;GAMpB,mBAAYpJ,OAAZ,EAAuC;KAAA;;KAAA;KACtC,uGAAMA,OAAN;KADsC,qFAHe,EAGf;KAAA,sFAFJ,EAEI;;KAEtC,MAAKC,iBAAL,CAAuB,iDAAvB;;KAEA,MAAKD,OAAL;OAAgBqJ,YAAY,EAAE,IAA9B;OAAoCC,WAAW,EAAE;QAAOtJ,OAAxD;KACA,MAAKI,KAAL,GAAa,IAAIC,eAAK,CAACC,WAAV,EAAb;KAEA,MAAKiJ,2BAAL,GAAmC,MAAKA,2BAAL,CAAiC9F,IAAjC,2CAAnC;KACA,MAAK+F,sBAAL,GAA8B,MAAKA,sBAAL,CAA4B/F,IAA5B,2CAA9B;;KAEA,IAAI8C,cAAI,CAACwB,aAAL,CAAmB,MAAK/H,OAAL,CAAayJ,UAAhC,CAAJ,EACA;OACC,MAAKzJ,OAAL,CAAayJ,UAAb,CAAwBxD,OAAxB,CAAgC,UAACC,IAAD,EAAU;SACzC,MAAKwD,YAAL,CAAkBxD,IAAlB;QADD;;OAIA,MAAKlG,OAAL,CAAasJ,WAAb,CAAyBrD,OAAzB,CAAiC,UAACC,IAAD,EAAU;SAC1C,MAAKyD,aAAL,CAAmBzD,IAAnB;QADD;;;KAhBqC;;;;;2CAuBvC;OACC,OAAO,KAAK9F,KAAL,CAAWG,QAAX,CAAoB,kBAApB,EAAwC,YAAM;SACpD,OAAOyB,aAAG,CAACC,MAAX;QADM,CAAP;;;;4CAQD;OAAA;;OACC,OAAO,KAAK7B,KAAL,CAAWG,QAAX,CAAoB,mBAApB,EAAyC,YAAM;SACrD,OAAOyB,aAAG,CAACC,MAAX,2LAEI,MAAI,CAAC2H,8BAAL,EAFJ;QADM,CAAP;;;;uCAUD;OACC,OAAO,KAAKxJ,KAAL,CAAWG,QAAX,CAAoB,cAApB,EAAoC,YAAM;SAChD,OAAOyB,aAAG,CAACC,MAAX,gKAC6C8D,eAAG,CAACC,UAAJ,CAAe,2BAAf,CAD7C;QADM,CAAP;;;;iCAQD;OAAA;;OACC,OAAO,KAAK5F,KAAL,CAAWG,QAAX,CAAoB,QAApB,EAA8B,YAAM;SAC1C,OAAOyB,aAAG,CAACC,MAAX,2RAEI,MAAI,CAACjC,OAAL,CAAaqJ,YAAb,GAA4B,MAAI,CAACQ,eAAL,EAA5B,GAAqD,EAFzD,EAIK,MAAI,CAACC,mBAAL,EAJL,EAKK,MAAI,CAACC,oBAAL,EALL;QADM,CAAP;;;;4CAasBrG,OACvB;OACC,IAAM6D,MAAoB,GAAG7D,KAAK,CAACsG,SAAN,EAA7B;OACA,IAAMC,YAAY,GAAG1C,MAAM,CAACxG,SAAP,EAArB;OAEA,KAAK0I,UAAL,GAAkB,KAAKA,UAAL,CAAgB3B,MAAhB,CAAuB,UAAC5B,IAAD,EAAU;SAClD,OAAOA,IAAI,KAAKqB,MAAhB;QADiB,CAAlB;OAIA,IAAI2C,QAAQ,GAAGD,YAAY,CAACE,kBAA5B;;OACA,OACC5D,cAAI,CAAC6D,SAAL,CAAeF,QAAf,KACG,CAACA,QAAQ,CAACG,OAAT,CAAiB,qCAAjB,CAFL,EAIA;SACC,KAAKZ,UAAL,GAAkB,KAAKA,UAAL,CAAgB3B,MAAhB,CAAuB,UAAC5B,IAAD,EAAU;WAClD,OAAOA,IAAI,CAACnF,SAAL,OAAqBmJ,QAA5B;UADiB,CAAlB;SAIAhF,aAAG,CAAC7C,MAAJ,CAAW6H,QAAX;SACAA,QAAQ,GAAGD,YAAY,CAACE,kBAAxB;;;OAGD,IAAI,CAAC5D,cAAI,CAAC6D,SAAL,CAAeF,QAAf,CAAL,EACA;SACC,IAAMI,QAAQ,GAAGL,YAAY,CAACM,sBAA9B;;SACA,IACChE,cAAI,CAAC6D,SAAL,CAAeE,QAAf,KACGpF,aAAG,CAACsF,QAAJ,CAAaF,QAAb,EAAuB,sCAAvB,CAFJ,EAIA;WACCpF,aAAG,CAAC7C,MAAJ,CAAWiI,QAAX;;;;OAIFpF,aAAG,CAAC7C,MAAJ,CAAW4H,YAAX;OAEA,KAAKlI,IAAL,CAAU,UAAV;;;;iDAG2B2B,OAC5B;OACC,IAAM6D,MAAyB,GAAG7D,KAAK,CAACsG,SAAN,EAAlC;OACA,IAAMC,YAAY,GAAG1C,MAAM,CAACxG,SAAP,EAArB;OAEA,KAAK0I,UAAL,GAAkB,KAAKA,UAAL,CAAgB3B,MAAhB,CAAuB,UAAC5B,IAAD,EAAU;SAClD,OAAOA,IAAI,KAAKqB,MAAhB;QADiB,CAAlB;;OAIA,IAAIrC,aAAG,CAACsF,QAAJ,CAAaP,YAAY,CAACE,kBAA1B,EAA8C,sCAA9C,CAAJ,EACA;SACCjF,aAAG,CAAC7C,MAAJ,CAAW4H,YAAY,CAACE,kBAAxB;QAFD,MAIK,IAAIjF,aAAG,CAACsF,QAAJ,CAAaP,YAAY,CAACM,sBAA1B,EAAkD,sCAAlD,CAAJ,EACL;SACCrF,aAAG,CAAC7C,MAAJ,CAAW4H,YAAY,CAACM,sBAAxB;;;OAGDrF,aAAG,CAAC7C,MAAJ,CAAW4H,YAAX;;;;kCAGYQ,SACb;OAAA;;OACC,IAAI,CAAC,KAAKhB,UAAL,CAAgBxB,QAAhB,CAAyBwC,OAAzB,CAAL,EACA;SACC,KAAKhB,UAAL,CAAgBiB,IAAhB,CAAqBD,OAArB;;SAEA,IAAIA,OAAO,YAAYvH,iBAAvB,EACA;WACCuH,OAAO,CAAC3I,SAAR,CAAkB,UAAlB,EAA8B,KAAKyH,2BAAnC;WACAkB,OAAO,CAAC3I,SAAR,CAAkB,UAAlB,EAA8B;aAAA,OAAM,MAAI,CAACC,IAAL,CAAU,UAAV,CAAN;YAA9B;WAEA,IAAM4I,eAAe,kCAAO,KAAKb,mBAAL,GAA2Bc,UAAlC,CAArB;WACA,IAAMC,WAAW,GAAGF,eAAe,CAAChC,MAAhB,CAAuB,UAACC,GAAD,EAAMkC,IAAN,EAAe;aACzD,IAEE5F,aAAG,CAACsF,QAAJ,CAAaM,IAAb,EAAmB,uBAAnB,KACG1E,MAAM,CAAClB,aAAG,CAAC6F,IAAJ,CAASD,IAAT,EAAe,aAAf,CAAD,CAAN,KAA0C1E,MAAM,CAACqE,OAAO,CAACzK,OAAR,CAAgBoD,IAAhB,CAAqBmE,MAAtB,CAFpD,IAKCuD,IAAI,CAACT,OAAL,CAAa,qCAAb,KACGjE,MAAM,CAAClB,aAAG,CAAC6F,IAAJ,CAASD,IAAT,EAAe,eAAf,CAAD,CAAN,KAA4C1E,MAAM,CAACqE,OAAO,CAACzK,OAAR,CAAgBoD,IAAhB,CAAqBmE,MAAtB,CAPvD,EAUA;eACC,OAAOuD,IAAP;;;aAGD,OAAOlC,GAAP;YAfmB,EAgBjB,IAhBiB,CAApB;;WAkBA,IAAIrC,cAAI,CAAC6D,SAAL,CAAeS,WAAf,CAAJ,EACA;aACC3F,aAAG,CAAC8F,WAAJ,CAAgBP,OAAO,CAAC1J,SAAR,EAAhB,EAAqC8J,WAArC;;aAEA,IAAI3F,aAAG,CAACsF,QAAJ,CAAaK,WAAb,EAA0B,uBAA1B,CAAJ,EACA;eACC,IAAMI,SAAS,GAAG,IAAIhC,aAAJ,CAAkB;iBACnCE,MAAM,EAAE,KAAKnJ,OAAL,CAAamJ;gBADJ,CAAlB;eAIAjE,aAAG,CAACgG,YAAJ,CAAiBD,SAAS,CAAClK,SAAV,EAAjB,EAAwC0J,OAAO,CAAC1J,SAAR,EAAxC;;;aAED;;;;SAIF,IAAI0J,OAAO,YAAY1K,YAAvB,EACA;WACC0K,OAAO,CAAC3I,SAAR,CAAkB,UAAlB,EAA8B,KAAK0H,sBAAnC;WACAiB,OAAO,CAAC3I,SAAR,CAAkB,UAAlB,EAA8B;aAAA,OAAM,MAAI,CAACC,IAAL,CAAU,UAAV,CAAN;YAA9B;;WAEA,IAAI,+BAAI,KAAK+H,mBAAL,GAA2Bc,UAA/B,EAA2CO,MAA3C,GAAoD,CAAxD,EACA;aACC,IAAMF,UAAS,GAAG,IAAIhC,aAAJ,CAAkB;eACnCE,MAAM,EAAE,KAAKnJ,OAAL,CAAamJ;cADJ,CAAlB;;aAIAjE,aAAG,CAACmB,MAAJ,CAAW4E,UAAS,CAAClK,SAAV,EAAX,EAAkC,KAAK+I,mBAAL,EAAlC;;;;SAIF5E,aAAG,CAACmB,MAAJ,CACCoE,OAAO,CAAC1J,SAAR,EADD,EAEC,KAAK+I,mBAAL,EAFD;SAKA,KAAK/H,IAAL,CAAU,UAAV;;;;;gDAKF;OAAA;;OACC,OAAO,KAAK3B,KAAL,CAAWG,QAAX,CAAoB,uBAApB,EAA6C,YAAM;SACzD,OAAO,IAAI6K,4CAAJ,CAAgB;WACtBC,IAAI,EAAE,CACL;aACC5I,EAAE,EAAE,UADL;aAECY,IAAI,EAAE0C,eAAG,CAACC,UAAJ,CAAe,oCAAf,CAFP;aAGC1D,OAAO,EAAE,MAAI,CAACgJ,yBAAL,CAA+B7H,IAA/B,CAAoC,MAApC;YAJL;UADA,CAAP;QADM,CAAP;;;;+CAayBC,OAC1B;OAAA;;OACCA,KAAK,CAACC,cAAN;OAEA,IAAM4H,IAAI,GAAG,KAAKC,iBAAL,EAAb;OACAD,IAAI,CAACE,YAAL,GAAoBxF,OAApB,CAA4B,UAACC,IAAD,EAAU;SACrC,IAAMwF,MAAM,GAAG,MAAI,CAACpC,WAAL,CAAiBqC,IAAjB,CAAsB,UAACC,cAAD,EAAoB;WACxD,OAAOxF,MAAM,CAACwF,cAAc,CAAC5L,OAAf,CAAuByC,EAAxB,CAAN,KAAsC2D,MAAM,CAACF,IAAI,CAAC2F,KAAL,EAAD,CAAnD;UADc,CAAf;;SAIA,IAAIH,MAAJ,EACA;WACCxG,aAAG,CAACiC,QAAJ,CAAajB,IAAI,CAACnF,SAAL,GAAiBmF,IAA9B,EAAoC,qBAApC;UAFD,MAKA;WACChB,aAAG,CAACmC,WAAJ,CAAgBnB,IAAI,CAACnF,SAAL,GAAiBmF,IAAjC,EAAuC,qBAAvC;;QAXF;OAeA,KAAKsF,iBAAL,GAAyB3H,IAAzB;;;;sDAID;OAAA;;OACC,IAAMiI,eAAe,GAAG,CAAC,MAAD,EAAS,QAAT,CAAxB;OACA,OAAO,KAAK9L,OAAL,CAAa6I,MAAb,CAAoBf,MAApB,CAA2B,UAAC9G,KAAD,EAAW;SAC5C,IAAI,CAAC8K,eAAe,CAAC7D,QAAhB,CAAyBjH,KAAK,CAACN,IAA/B,CAAL,EACA;WACC,OAAO,CAAC,MAAI,CAAC+I,UAAL,CAAgBX,IAAhB,CAAqB,UAACtB,SAAD,EAAe;aAC3C,OACCjB,cAAI,CAACwC,aAAL,CAAmBvB,SAAS,CAACxH,OAA7B,MAGEuG,cAAI,CAACwC,aAAL,CAAmBvB,SAAS,CAACxH,OAAV,CAAkBoD,IAArC,KACGgD,MAAM,CAACoB,SAAS,CAACxH,OAAV,CAAkBoD,IAAlB,CAAuBmE,MAAxB,CAAN,KAA0CnB,MAAM,CAACpF,KAAK,CAACyB,EAAP,CAFpD,IAIG2D,MAAM,CAACoB,SAAS,CAACxH,OAAV,CAAkByC,EAAnB,CAAN,KAAiC2D,MAAM,CAACpF,KAAK,CAACyB,EAAP,CAN3C,CADD;YADO,CAAR;;;SAcD,OAAO,IAAP;QAjBM,CAAP;;;;yCAsBD;OAAA;;OACC,OAAO,KAAKrC,KAAL,CAAWG,QAAX,CAAoB,gBAApB,EAAsC,YAAM;SAClD,OAAO,IAAIU,MAAM,CAACC,GAAP,CAAWC,EAAX,CAAc+C,IAAd,CAAmB6H,IAAvB,CAA4B;WAClC3H,WAAW,EAAE,MAAI,CAAC4H,wBAAL,GAAgCjL,SAAhC,EADqB;WAElCiG,SAAS,EAAE,GAFuB;WAGlCtF,KAAK,EAAE,MAAI,CAACuK,8BAAL,GACL9D,GADK,CACD,UAACjC,IAAD,EAAU;aACd,OAAO;eACNzD,EAAE,EAAEyD,IAAI,CAACzD,EADH;eAENY,IAAI,EAAE6C,IAAI,CAACJ,KAFL;eAGNoG,OAAO,EAAE,MAAI,CAACC,oBAAL,CAA0B1I,IAA1B,CAA+B,MAA/B,EAAqCyC,IAArC;cAHV;YAFK;UAHD,CAAP;QADM,CAAP;;;;sDAiBD;OAAA;;OACC,OAAO,KAAK9F,KAAL,CAAWG,QAAX,CAAoB,8BAApB,EAAoD,YAAM;SAChE,OAAOyB,aAAG,CAACC,MAAX,gZAGK,MAAI,CAAC+J,wBAAL,GAAgCjL,SAAhC,EAHL;QADM,CAAP;;;;0CAYoBC,OACrB;OACC,IAAMyJ,OAAO,GAAG,IAAI1K,YAAJ,CAAiB;SAChC0C,EAAE,EAAEzB,KAAK,CAACyB,EADsB;SAEhCjB,KAAK,EAAER,KAAK,CAAC8E,KAFmB;SAGhClG,SAAS,EAAE,IAHqB;SAIhCE,KAAK,EAAEC,YAAY,CAACqM,MAAb,CAAoBpJ,KAJK;SAKhCvB,YAAY,EAAEsE,eAAG,CAACC,UAAJ,CAAe,4CAAf,CALkB;SAMhCrE,WAAW,EAAE,CACZ;WAACyG,IAAI,EAAErC,eAAG,CAACC,UAAJ,CAAe,iDAAf,CAAP;WAA0EjB,KAAK,EAAE;UADrE,EAEZ;WAACqD,IAAI,EAAErC,eAAG,CAACC,UAAJ,CAAe,iDAAf,CAAP;WAA0EjB,KAAK,EAAE;UAFrE,CANmB;SAUhClD,YAAY,EAAE;QAVC,CAAhB;OAaA,KAAK8H,aAAL,CAAmBc,OAAnB;OAEA,KAAKe,iBAAL,GAAyBa,KAAzB;OAEA,KAAKtK,IAAL,CAAU,UAAV;;;;6CAGuB2B,OACxB;OACC,IAAM6D,MAAM,GAAG7D,KAAK,CAACsG,SAAN,EAAf;OAEA9E,aAAG,CAAC7C,MAAJ,CAAWkF,MAAM,CAACxG,SAAP,EAAX;OAEA,KAAKuI,WAAL,GAAmB,KAAKA,WAAL,CAAiBxB,MAAjB,CAAwB,UAAC9G,KAAD,EAAW;SACrD,OAAOoF,MAAM,CAACpF,KAAK,CAAChB,OAAN,CAAcyC,EAAf,CAAN,KAA6B2D,MAAM,CAACmB,MAAM,CAACvH,OAAP,CAAeyC,EAAhB,CAA1C;QADkB,CAAnB;OAIA,KAAK6J,8BAAL;OAEA,KAAKvK,IAAL,CAAU,UAAV;;;;+CAID;OACC,KAAKA,IAAL,CAAU,UAAV;;;;sDAID;OACC,+BAAI,KAAKgI,oBAAL,GAA4BwC,QAAhC,EACEC,OADF,GAEEvG,OAFF,CAEU,UAAC6E,IAAD,EAAO2B,KAAP,EAAiB;SACzB,IAAI3B,IAAI,CAACT,OAAL,CAAa,qCAAb,CAAJ,EACA;WACCnF,aAAG,CAACrE,KAAJ,CAAUiK,IAAV,EAAgB,SAAhB,EAA2B2B,KAAK,GAAG,CAAnC;;QALH;;;;mCAUahC,SACd;OACC,IAAI,CAAC,KAAKnB,WAAL,CAAiBrB,QAAjB,CAA0BwC,OAA1B,CAAL,EACA;SACC,KAAKnB,WAAL,CAAiBoB,IAAjB,CAAsBD,OAAtB;SAEAA,OAAO,CAAC3I,SAAR,CAAkB,UAAlB,EAA8B,KAAK4K,uBAAL,CAA6BjJ,IAA7B,CAAkC,IAAlC,CAA9B;SACAgH,OAAO,CAAC3I,SAAR,CAAkB,UAAlB,EAA8B,KAAK6K,uBAAL,CAA6BlJ,IAA7B,CAAkC,IAAlC,CAA9B,EAJD;;SAOC,KAAK,KAAK1C,SAAL,EAAL;SAEAmE,aAAG,CAACgG,YAAJ,CAAiBT,OAAO,CAAC1J,SAAR,EAAjB,EAAsC,KAAK6I,8BAAL,EAAtC;SAEA,KAAK0C,8BAAL;;;;;gCAKF;OAAA;;OACC,OAAO,KAAK7C,UAAL,CACL3B,MADK,CACE,UAAC5B,IAAD;SAAA,OAAUA,IAAI,YAAYhD,iBAA1B;QADF,EAELyF,MAFK,CAEE,UAACC,GAAD,EAAMgE,cAAN,EAA4C;SACnD,gDACIhE,GADJ,kCAEI,OAAI,CAACU,WAAL,CAAiBnB,GAAjB,CAAqB,UAACyD,cAAD,EAAoB;WAC3C,OAAO;aACNpE,SAAS,sCACLoF,cAAc,CAAC9F,QAAf,EADK;eAERpD,KAAK,EAAE;eAHF;aAKNmJ,MAAM,EAAE;eACPtF,MAAM,EAAEqE,cAAc,CAAC5L,OAAf,CAAuByC,EADxB;eAEP/B,IAAI,EAAEkL,cAAc,CAAC1J,kBAAf,GAAoC4E,QAApC;;YAPR;UADE,CAFJ;QAHK,EAkBH,EAlBG,CAAP;;;;GAnXqChE;;;;KCVlBgK;;;GAIpB,0BAAY9M,OAAZ,EACA;KAAA;;KAAA;KACC,8GAAMA,OAAN;KADD,gFAHQ,IAAIK,eAAK,CAACC,WAAV,EAGR;;KAEC,MAAKL,iBAAL,CAAuB,6DAAvB;;KACA,MAAKC,oBAAL,CAA0BC,oDAAsB,CAACH,OAAD,CAAhD;;KAEA,IAAIuG,cAAI,CAACwC,aAAL,CAAmB/I,OAAO,CAACa,KAA3B,CAAJ,EACA;OACCqE,aAAG,CAACrE,KAAJ,CAAU,MAAKE,SAAL,EAAV,EAA4Bf,OAAO,CAACa,KAApC;;;KAPF;;;;;iCAYA;OAAA;;OACC,OAAO,KAAKT,KAAL,CAAWG,QAAX,CAAoB,QAApB,EAA8B,YAAM;SAC1C,OAAOyB,aAAG,CAACC,MAAX,qcAEI,MAAI,CAAC8K,cAAL,GAAsBhM,SAAtB,EAFJ;QADM,CAAP;;;;sCAcD;OAAA;;OACC,OAAO,KAAKX,KAAL,CAAWG,QAAX,CAAoB,aAApB,EAAmC,YAAM;SAC/C,OAAO,IAAI6K,4CAAJ,CAAgB;WACtBC,IAAI,EAAE,CACL;aACC5I,EAAE,EAAE,cADL;aAECY,IAAI,EAAE0C,eAAG,CAACC,UAAJ,CAAe,wCAAf,CAFP;aAGC1D,OAAO,EAAE,mBAAM;eACd,MAAI,CAACP,IAAL,CAAU,gBAAV;;YALG;UADA,CAAP;QADM,CAAP;;;;GAjC4Ce;;;;KCWzBkK;;;GAIpB,mBAAYhN,OAAZ,EACA;KAAA;;KAAA;KACC,uGAAMA,OAAN;;KACA,MAAKC,iBAAL,CAAuB,oEAAvB;;KACA,MAAKC,oBAAL,CAA0BC,oDAAsB,CAACH,OAAD,CAAhD;;KACA,MAAKiN,cAAL,CAAoB,uBAApB;;KAEA,IAAMjI,MAAM,GAAG,MAAKjE,SAAL,EAAf;;KACAmE,aAAG,CAACgI,KAAJ,CAAUlI,MAAV;KACAE,aAAG,CAACmB,MAAJ,CAAW,MAAKwD,eAAL,EAAX,EAAmC7E,MAAnC;KACAE,aAAG,CAACmB,MAAJ,CAAW,MAAK8G,aAAL,EAAX,EAAiCnI,MAAjC;KACAE,aAAG,CAACmB,MAAJ,CAAW,MAAK+G,eAAL,EAAX,EAAmCpI,MAAnC;;KAEA,IAAIuB,cAAI,CAACwB,aAAL,CAAmB,MAAK/H,OAAL,CAAaoD,IAAb,CAAkBiK,IAArC,CAAJ,EACA;OACC,IAAMC,gBAAgB,GAAG,MAAKtN,OAAL,CAAaoD,IAAb,CAAkBiK,IAAlB,CAAuBvF,MAAvB,CAA8B,UAAC5B,IAAD,EAAU;SAChE,IAAMqH,eAAe,GAAG,MAAKC,QAAL,CAActH,IAAI,CAACsB,SAAL,CAAeD,MAA7B,CAAxB;;SACA,IAAMkG,YAAY,GAAG,MAAKD,QAAL,CAActH,IAAI,CAAC2G,MAAL,CAAYtF,MAA1B,CAArB;;SACA,OAAOgG,eAAe,IAAIE,YAA1B;QAHwB,CAAzB;;OAMA,IAAI,MAAKC,SAAL,OAAqBhO,QAAQ,CAACiO,MAAlC,EACA;SACC,IAAMC,WAAW,GAAGN,gBAAgB,CAAC3E,MAAjB,CAAwB,UAACC,GAAD,EAAM1C,IAAN,EAAe;WAC1D,sBAAmCA,IAAI,CAACsB,SAAxC;eAAOD,MAAP,mBAAOA,MAAP;eAAehE,SAAf,mBAAeA,SAAf;eAA0BwB,KAA1B,mBAA0BA,KAA1B;;WACA,IAAI,CAACwB,cAAI,CAACsH,OAAL,CAAajF,GAAG,WAAIrB,MAAJ,SAAahE,SAAb,SAAyBwB,KAAzB,EAAhB,CAAL,EACA;aACC6D,GAAG,WAAIrB,MAAJ,SAAahE,SAAb,SAAyBwB,KAAzB,EAAH,GAAuC,EAAvC;;;WAGD6D,GAAG,WAAIrB,MAAJ,SAAahE,SAAb,SAAyBwB,KAAzB,EAAH,CAAqC2F,IAArC,CAA0CxE,IAA1C;WAEA,OAAO0C,GAAP;UATmB,EAUjB,EAViB,CAApB;SAYAkF,MAAM,CAACC,MAAP,CAAcH,WAAd,EAA2B3H,OAA3B,CAAmC,UAAC+H,KAAD,EAAQvB,KAAR,EAAkB;WACpD,wCAAoBuB,KAApB;eAAOC,SAAP;;WACA,IAAI1H,cAAI,CAACwC,aAAL,CAAmBkF,SAAnB,CAAJ,EACA;aACC,IAAMtI,WAAW,GAAG,MAAK6H,QAAL,CAAcS,SAAS,CAACzG,SAAV,CAAoBD,MAAlC,CAApB;;aACA,IAAM2G,KAAK,GAAG,IAAI9E,SAAJ,CAAc;eAC3BC,YAAY,EAAEoD,KAAK,KAAK,CADG;eAE3BtD,MAAM,EAAE,MAAKuE,SAAL,EAFmB;eAG3B7E,MAAM,EAAE,MAAK7I,OAAL,CAAa6I,MAHM;eAI3BvB,QAAQ,EAAE;iBAAA,OAAM,MAAKvF,IAAL,CAAU,UAAV,CAAN;gBAJiB;eAK3B0H,UAAU,EAAE,CACX,IAAI1J,YAAJ,CAAiB;iBAChB0H,UAAU,EAAE,MAAKzH,OAAL,CAAayH,UADT;iBAEhBoB,MAAM,EAAE,MAAK7I,OAAL,CAAa6I,MAFL;iBAGhBpG,EAAE,EAAEkD,WAAW,CAAClD,EAHA;iBAIhBjB,KAAK,EAAEmE,WAAW,CAACG,KAJH;iBAKhBhG,KAAK,EAAEC,YAAY,CAACqM,MAAb,CAAoBrJ,IALX;iBAMhBoL,QAAQ,EAAE,oBAAM;mBACf,MAAK3E,sBAAL,CAA4B0E,KAA5B;;gBAPF,CADW,EAWX,IAAIhL,iBAAJ,CAAsB;iBACrBuE,UAAU,EAAE,MAAKzH,OAAL,CAAayH,UADJ;iBAErBoB,MAAM,EAAE,MAAK7I,OAAL,CAAa6I,MAFA;iBAGrBjJ,SAAS,EAAE,KAHU;iBAIrBwD,IAAI,EAAE4K,KAAK,CAAC,CAAD,CAAL,CAASxG;gBAJhB,CAXW,CALe;eAuB3B8B,WAAW,EAAE0E,KAAK,CAAC7F,GAAN,CAAU,UAACiG,SAAD,EAAe;iBACrC,IAAMzI,WAAW,GAAG,MAAK6H,QAAL,CAAcY,SAAS,CAACvB,MAAV,CAAiBtF,MAA/B,CAApB;;iBACA,OAAO,IAAIxH,YAAJ,CAAiB;mBACvB0C,EAAE,EAAEkD,WAAW,CAAClD,EADO;mBAEvBjB,KAAK,EAAEmE,WAAW,CAACG,KAFI;mBAGvBlG,SAAS,EAAE,IAHY;mBAIvBE,KAAK,EAAEC,YAAY,CAACqM,MAAb,CAAoBpJ,KAJJ;mBAKvBvB,YAAY,EAAEsE,eAAG,CAACC,UAAJ,CAAe,4CAAf,CALS;mBAMvBrE,WAAW,EAAE,CACZ;qBACCyG,IAAI,EAAErC,eAAG,CAACC,UAAJ,CAAe,iDAAf,CADP;qBAECjB,KAAK,EAAE;oBAHI,EAKZ;qBACCqD,IAAI,EAAErC,eAAG,CAACC,UAAJ,CAAe,iDAAf,CADP;qBAECjB,KAAK,EAAE;oBAPI,CANU;mBAgBvBlD,YAAY,EAAEuM,SAAS,CAACvB,MAAV,CAAiBnM;kBAhBzB,CAAP;gBAFY;cAvBA,CAAd;;aA8CA,MAAK2N,QAAL,CAAcH,KAAd;;UAnDF;;;OAwDD,IACC,MAAKR,SAAL,OAAqBhO,QAAQ,CAAC4O,MAA9B,IACG,MAAKZ,SAAL,OAAqBhO,QAAQ,CAAC6O,MAFlC,EAIA;SACC,IAAML,KAAK,GAAG,IAAI9E,SAAJ,CAAc;WAC3BC,YAAY,EAAE,IADa;WAE3BF,MAAM,EAAE,MAAKuE,SAAL,EAFmB;WAG3B7E,MAAM,EAAE,MAAK7I,OAAL,CAAa6I,MAHM;WAI3BvB,QAAQ,EAAE;aAAA,OAAM,MAAKvF,IAAL,CAAU,UAAV,CAAN;;UAJG,CAAd;;SAOA,IAAM6L,YAAW,GAAGN,gBAAgB,CAAC3E,MAAjB,CAAwB,UAACC,GAAD,EAAM1C,IAAN,EAAe;WAC1D,IAAOqB,MAAP,GAAiBrB,IAAI,CAACsB,SAAtB,CAAOD,MAAP;;WACA,IAAI,CAAChB,cAAI,CAACsH,OAAL,CAAajF,GAAG,CAACrB,MAAD,CAAhB,CAAL,EACA;aACCqB,GAAG,CAACrB,MAAD,CAAH,GAAc,EAAd;;;WAGDqB,GAAG,CAACrB,MAAD,CAAH,CAAYmD,IAAZ,CAAiBxE,IAAjB;WAEA,OAAO0C,GAAP;UATmB,EAUjB,EAViB,CAApB;;SAYAkF,MAAM,CAACC,MAAP,CAAcH,YAAd,EAA2B3H,OAA3B,CAAmC,UAAC+H,KAAD,EAAW;WAC7C,yCAAoBA,KAApB;eAAOC,SAAP;;WACA,IAAI1H,cAAI,CAACwC,aAAL,CAAmBkF,SAAnB,CAAJ,EACA;aACC,IAAMtI,WAAW,GAAG,MAAK6H,QAAL,CAAcS,SAAS,CAACzG,SAAV,CAAoBD,MAAlC,CAApB;;aAEA,IAAMiH,yBAAyB,GAE7B,MAAKd,SAAL,OAAqBhO,QAAQ,CAAC6O,MAA9B,IACG5I,WAAW,CAAC8I,QAFhB,IAIG,MAAKf,SAAL,OAAqBhO,QAAQ,CAAC4O,MALlC;aAQAJ,KAAK,CAACxE,YAAN,CACC,IAAI3J,YAAJ,CAAiB;eAChB0H,UAAU,EAAE,MAAKzH,OAAL,CAAayH,UADT;eAEhBoB,MAAM,EAAE,MAAK7I,OAAL,CAAa6I,MAFL;eAGhBpG,EAAE,EAAEkD,WAAW,CAAClD,EAHA;eAIhBjB,KAAK,EAAEmE,WAAW,CAACG,KAJH;eAKhBhG,KAAK,EAAEC,YAAY,CAACqM,MAAb,CAAoBrJ,IALX;eAMhBoL,QAAQ,EAAE,oBAAM;iBACf,MAAK3E,sBAAL,CAA4B0E,KAA5B;;cAPF,CADD;aAaA,IAAMQ,iBAAiB,GAAGV,KAAK,CAACrF,MAAN,CAAa,UAACC,GAAD,EAAM1C,IAAN,EAAe;eACrD0C,GAAG,WAAI1C,IAAI,CAACsB,SAAL,CAAejE,SAAnB,SAA+B2C,IAAI,CAACsB,SAAL,CAAezC,KAA9C,EAAH,GAA4DmB,IAA5D;eACA,OAAO0C,GAAP;cAFyB,EAGvB,EAHuB,CAA1B;aAKAkF,MAAM,CAACC,MAAP,CAAcW,iBAAd,EAAiCzI,OAAjC,CAAyC,UAACC,IAAD,EAAU;eAClDgI,KAAK,CAACxE,YAAN,CACC,IAAIxG,iBAAJ,CAAsB;iBACrBuE,UAAU,EAAE,MAAKzH,OAAL,CAAayH,UADJ;iBAErBoB,MAAM,EAAE,MAAK7I,OAAL,CAAa6I,MAFA;iBAGrBjJ,SAAS,EAAE4O,yBAHU;iBAIrBpL,IAAI,EAAE8C,IAAI,CAACsB;gBAJZ,CADD;cADD;aAWA0G,KAAK,CAACxE,YAAN,CACC,IAAIoD,gBAAJ,CAAqB;eACpBjM,KAAK,EAAE;iBACN8N,OAAO,EAAEH,yBAAyB,GAAG,IAAH,GAAU;gBAFzB;eAIpBI,cAAc,EAAE,0BAAM;iBACrB,MAAKC,mBAAL,CACC,IAAIC,0BAAJ,CAAc;mBACb1L,IAAI,EAAE;qBACL8K,KAAK,EAALA,KADK;qBAEL3G,MAAM,EAAE5B,WAAW,CAAClD;;kBAHtB,CADD;;cALF,CADD;;UA3CF;SA+DA,IAAMsM,kBAAkB,GAAGjB,MAAM,CAACC,MAAP,CAAcT,gBAAd,EAAgC3E,MAAhC,CAAuC,UAACC,GAAD,EAAM1C,IAAN,EAAe;WAChF,mBAAuBA,IAAI,CAAC2G,MAA5B;eAAOtF,MAAP,gBAAOA,MAAP;eAAe7G,IAAf,gBAAeA,IAAf;WACAkI,GAAG,WAAIrB,MAAJ,SAAa7G,IAAb,EAAH,GAA0BwF,IAA1B;WACA,OAAO0C,GAAP;UAH0B,EAIxB,EAJwB,CAA3B;SAMAkF,MAAM,CAACC,MAAP,CAAcgB,kBAAd,EAAkC9I,OAAlC,CAA0C,UAACC,IAAD,EAAU;WACnD,IAAMP,WAAW,GAAG,MAAK6H,QAAL,CAActH,IAAI,CAAC2G,MAAL,CAAYtF,MAA1B,CAApB;;WACA,IAAMkD,OAAO,GAAG,IAAI1K,YAAJ,CAAiB;aAChC0C,EAAE,EAAEkD,WAAW,CAAClD,EADgB;aAEhCjB,KAAK,EAAEmE,WAAW,CAACG,KAFa;aAGhClG,SAAS,EAAE,IAHqB;aAIhCE,KAAK,EAAEC,YAAY,CAACqM,MAAb,CAAoBpJ,KAJK;aAKhCvB,YAAY,EAAEsE,eAAG,CAACC,UAAJ,CAAe,4CAAf,CALkB;aAMhCrE,WAAW,EAAE,CACZ;eACCyG,IAAI,EAAErC,eAAG,CAACC,UAAJ,CAAe,iDAAf,CADP;eAECjB,KAAK,EAAE;cAHI,EAKZ;eACCqD,IAAI,EAAErC,eAAG,CAACC,UAAJ,CAAe,iDAAf,CADP;eAECjB,KAAK,EAAE;cAPI,CANmB;aAgBhClD,YAAY,EAAEqE,IAAI,CAAC2G,MAAL,CAAYnM;YAhBX,CAAhB;WAmBAwN,KAAK,CAACvE,aAAN,CAAoBc,OAApB;UArBD;;SAwBA,MAAK4D,QAAL,CAAcH,KAAd;;;;KA/MH;;;;;kCAqNA;OACC,OAAO,KAAK9N,KAAL,CAAWG,QAAX,CAAoB,SAApB,EAA+B;SAAA,OAAM,EAAN;QAA/B,CAAP;;;;gCAGUyO,SACX;OACC,KAAK5O,KAAL,CAAW6O,GAAX,CAAe,SAAf,EAA0BD,OAA1B;;;;8BAGQd,OACT;OAAA;;OACC,IAAIA,KAAJ,EACA;SACC,IAAMc,OAAO,GAAG,KAAKE,UAAL,EAAhB;;SACA,IAAI,CAACF,OAAO,CAAC/G,QAAR,CAAiBiG,KAAjB,CAAL,EACA;WACCA,KAAK,CAACpM,SAAN,CAAgB,UAAhB,EAA4B;aAAA,OAAM,MAAI,CAACC,IAAL,CAAU,UAAV,CAAN;YAA5B;WAEAiN,OAAO,CAACtE,IAAR,CAAawD,KAAb;WACAhJ,aAAG,CAACmB,MAAJ,CAAW6H,KAAK,CAACnN,SAAN,EAAX,EAA8B,KAAKoM,aAAL,EAA9B;WAEA,KAAKpL,IAAL,CAAU,UAAV;;;;;;uCAMH;OAAA;;OACC,OAAO,KAAK3B,KAAL,CAAWG,QAAX,CAAoB,cAApB,EAAoC,YAAM;SAChD,OAAOyB,aAAG,CAACC,MAAX,oMAEI,MAAI,CAACkN,oBAAL,EAFJ,EAGI,MAAI,CAACtM,qBAAL,EAHJ;QADM,CAAP;;;;4CAWD;OAAA;;OACC,OAAO,KAAKzC,KAAL,CAAWG,QAAX,CAAoB,mBAApB,EAAyC,YAAM;SACrD,IAAM6O,eAAe,GAAGrJ,eAAG,CAACC,UAAJ,qCAA4C,MAAI,CAAC0H,SAAL,KAAmB,CAA/D,EAAxB;SACA,OAAO1L,aAAG,CAACC,MAAX,sKACmDmN,eADnD;QAFM,CAAP;;;;6CASD;OAAA;;OACC,OAAO,KAAKhP,KAAL,CAAWG,QAAX,CAAoB,oBAApB,EAA0C,YAAM;SACtD,IAAMC,MAAM,GAAG,IAAIC,0CAAJ,CAAe;WAC7BC,IAAI,EAAED,0CAAU,CAACE,KAAX,CAAiB0B,MADM;WAE7BC,OAAO,EAAE,MAAI,CAAC+M,aAAL,CAAmB5L,IAAnB,CAAwB,MAAxB,CAFoB;WAG7BjC,KAAK,EAAEuE,eAAG,CAACC,UAAJ,CAAe,wCAAf,CAHsB;WAI7BnF,KAAK,EAAE;aACN2B,UAAU,EAAE;;UALC,CAAf;SASA,OAAOhC,MAAM,CAACO,SAAP,EAAP;QAVM,CAAP;;;;qCAeD;OACCmE,aAAG,CAAC7C,MAAJ,CAAW,KAAKtB,SAAL,EAAX;OACA,KAAKgB,IAAL,CAAU,UAAV;OACA,KAAKA,IAAL,CAAU,UAAV;;;;qCAID;OACC,OAAO,KAAK3B,KAAL,CAAWG,QAAX,CAAoB,YAApB,EAAkC,YAAM;SAC9C,OAAOyB,aAAG,CAACC,MAAX;QADM,CAAP;;;;uCAQD;OAAA;;OACC,OAAO,KAAK7B,KAAL,CAAWG,QAAX,CAAoB,cAApB,EAAoC,YAAM;SAChD,OAAOyB,aAAG,CAACC,MAAX,sLAEI,MAAI,CAACqN,oBAAL,GAA4BvO,SAA5B,EAFJ;QADM,CAAP;;;;4CAUD;OAAA;;OACC,OAAO,KAAKX,KAAL,CAAWG,QAAX,CAAoB,mBAApB,EAAyC,YAAM;SACrD,OAAO,IAAI6K,4CAAJ,CAAgB;WACtBC,IAAI,EAAE,CACL;aACC5I,EAAE,EAAE,aADL;aAECY,IAAI,EAAE0C,eAAG,CAACC,UAAJ,CAAe,oCAAf,CAFP;aAGC1D,OAAO,EAAE,MAAI,CAACiN,eAAL,CAAqB9L,IAArB,CAA0B,MAA1B;YAJL;UADA,CAAP;QADM,CAAP;;;;qCAaeC,OAChB;OACC,IAAM6H,IAAI,GAAG,KAAKC,iBAAL,EAAb;OACAD,IAAI,CAACiE,cAAL,GAAsBC,cAAtB,CAAqC/L,KAAK,CAACgM,aAA3C;OACAnE,IAAI,CAAC1H,IAAL;;;;yCAID;OAAA;;OACC,OAAO,KAAKzD,KAAL,CAAWG,QAAX,CAAoB,YAApB,EAAkC,YAAM;SAC9C,OAAO,IAAIU,MAAM,CAACC,GAAP,CAAWC,EAAX,CAAc+C,IAAd,CAAmB6H,IAAvB,CAA4B;WAClC/E,SAAS,EAAE,GADuB;WAElCtF,KAAK,EACJ,MAAI,CAAC1B,OAAL,CAAa6I,MAAb,CACEV,GADF,CACM,UAACnH,KAAD,EAAW;aACf,OAAO;eACNyB,EAAE,EAAEzB,KAAK,CAACyB,EADJ;eAENY,IAAI,EAAErC,KAAK,CAAC8E,KAFN;eAGNoG,OAAO,EAAE,mBAAM;iBACd,MAAI,CAACyD,yBAAL,CAA+B3O,KAA/B;;iBACA,MAAI,CAACwK,iBAAL,GAAyBa,KAAzB;;cALF;YAFF,CAHiC;WAelC7H,QAAQ,EAAE;UAfJ,CAAP;QADM,CAAP;;;;0CAqBoBoL,SACrB;OACC,IAAMjK,WAAW,GAAG,KAAK3F,OAAL,CAAa6I,MAAb,CAAoBC,IAApB,CAAyB,UAAC9H,KAAD,EAAW;SACvD,OAAOoF,MAAM,CAACpF,KAAK,CAACyB,EAAP,CAAN,KAAqB2D,MAAM,CAACwJ,OAAD,CAAlC;QADmB,CAApB;;OAIA,IAAIjK,WAAJ,EACA;SACC,IAAMkK,kBAAkB,GAAG,KAAK7P,OAAL,CAAayH,UAAb,CAAwBC,IAAxB,CAA6BF,SAA7B,CAAuCK,UAAvC,CAAkDC,MAAlD,CAAyD,UAACvE,SAAD,EAAe;WAClG,OACC,CACC,CAACgD,cAAI,CAACwB,aAAL,CAAmBxE,SAAS,CAACyE,UAA7B,CAAD,IACGzE,SAAS,CAACyE,UAAV,CAAqBC,QAArB,CAA8BtC,WAAW,CAACjF,IAA1C,CAFJ,MAKC,CAAC6F,cAAI,CAACwB,aAAL,CAAmBxE,SAAS,CAAC2E,iBAA7B,CAAD,IAEC3B,cAAI,CAACwB,aAAL,CAAmBxE,SAAS,CAAC2E,iBAA7B,KACG,CAAC3E,SAAS,CAAC2E,iBAAV,CAA4BD,QAA5B,CAAqCtC,WAAW,CAACjF,IAAjD,CARN,CADD;UAD0B,CAA3B;;SAgBA,IAAI6F,cAAI,CAACwB,aAAL,CAAmB8H,kBAAnB,CAAJ,EACA;WACC,OAAOA,kBAAkB,CAAC,CAAD,CAAlB,CAAsBpN,EAA7B;;;;OAIF,OAAO,GAAP;;;;yCAGmBiB,OACpB;OACC,qBAA4DA,KAAK,CAACoM,OAAN,EAA5D;WAAOvI,MAAP,kBAAOA,MAAP;WAAe2G,KAAf,kBAAeA,KAAf;;OACAA,KAAK,CAACxE,YAAN,CACC,IAAIxG,iBAAJ,CAAsB;SACrBuE,UAAU,EAAE,KAAKzH,OAAL,CAAayH,UADJ;SAErBoB,MAAM,EAAE,KAAK7I,OAAL,CAAa6I,MAFA;SAGrBjJ,SAAS,EAAE,IAHU;SAIrBwD,IAAI,EAAE;WACLmE,MAAM,EAANA,MADK;WAELhE,SAAS,EAAE,KAAKwM,oBAAL,CAA0BxI,MAA1B,CAFN;WAGLxC,KAAK,EAAE;;QAPT,CADD;;;;4CAcsBmJ,OACvB;OACC,IAAM8B,aAAa,GAAG9B,KAAK,CAACzE,UAAN,CAAiB3B,MAAjB,CAAwB,UAAC5B,IAAD,EAAU;SACvD,OAAOA,IAAI,YAAYnG,YAAvB;QADqB,CAAtB;;OAIA,IAAIiQ,aAAa,CAAC7E,MAAd,KAAyB,CAA7B,EACA;SACC,IAAM6D,OAAO,GAAG,KAAKE,UAAL,GAAkBpH,MAAlB,CAAyB,UAAC5B,IAAD,EAAU;WAClD,OAAOgI,KAAK,KAAKhI,IAAjB;UADe,CAAhB;SAIA,KAAK+J,UAAL,CAAgBjB,OAAhB;SAEA9J,aAAG,CAAC7C,MAAJ,CAAW6L,KAAK,CAACnN,SAAN,EAAX;;;;;+CAIwBC,OAC1B;OAAA;;OACC,IAAI,KAAK0M,SAAL,OAAqBhO,QAAQ,CAACiO,MAAlC,EACA;SACC,IAAMtE,YAAY,GAAG,KAAK6F,UAAL,GAAkB/D,MAAlB,KAA6B,CAAlD;SACA,IAAM+C,KAAK,GAAG,IAAI9E,SAAJ,CAAc;WAC3BC,YAAY,EAAZA,YAD2B;WAE3BF,MAAM,EAAE,KAAKuE,SAAL,EAFmB;WAG3B7E,MAAM,EAAE,KAAK7I,OAAL,CAAa6I,MAHM;WAI3BY,UAAU,EAAE,CACX,IAAI1J,YAAJ,CAAiB;aAChB0H,UAAU,EAAE,KAAKzH,OAAL,CAAayH,UADT;aAEhBoB,MAAM,EAAE,KAAK7I,OAAL,CAAa6I,MAFL;aAGhBpG,EAAE,EAAEzB,KAAK,CAACyB,EAHM;aAIhBjB,KAAK,EAAER,KAAK,CAAC8E,KAJG;aAKhBhG,KAAK,EAAEC,YAAY,CAACqM,MAAb,CAAoBrJ,IALX;aAMhBoL,QAAQ,EAAE,oBAAM;eACf,MAAI,CAAC3E,sBAAL,CAA4B0E,KAA5B;;YAPF,CADW,EAWX,IAAIhL,iBAAJ,CAAsB;aACrBuE,UAAU,EAAE,KAAKzH,OAAL,CAAayH,UADJ;aAErBoB,MAAM,EAAE,KAAK7I,OAAL,CAAa6I,MAFA;aAGrBjJ,SAAS,EAAE,KAHU;aAIrBwD,IAAI,EAAE;eACLmE,MAAM,EAAEvG,KAAK,CAACyB,EADT;eAELc,SAAS,EAAE,KAAKwM,oBAAL,CAA0B/O,KAAK,CAACyB,EAAhC,CAFN;eAGLsC,KAAK,EAAE;;YAPT,CAXW,CAJe;WA0B3BuC,QAAQ,EAAE;aAAA,OAAM,MAAI,CAACvF,IAAL,CAAU,UAAV,CAAN;;UA1BG,CAAd;SA6BA,KAAKsM,QAAL,CAAcH,KAAd;;;OAGD,IACC,KAAKR,SAAL,OAAqBhO,QAAQ,CAAC4O,MAA9B,IACG,KAAKZ,SAAL,OAAqBhO,QAAQ,CAAC6O,MAFlC,EAIA;SACC,IAAMC,yBAAyB,GAE7B,KAAKd,SAAL,OAAqBhO,QAAQ,CAAC6O,MAA9B,IACGvN,KAAK,CAACyN,QAFV,IAIG,KAAKf,SAAL,OAAqBhO,QAAQ,CAAC4O,MALlC;SAQA,IAAM5M,KAAK,GAAG,CACb,IAAI3B,YAAJ,CAAiB;WAChB0H,UAAU,EAAE,KAAKzH,OAAL,CAAayH,UADT;WAEhBoB,MAAM,EAAE,KAAK7I,OAAL,CAAa6I,MAFL;WAGhBpG,EAAE,EAAEzB,KAAK,CAACyB,EAHM;WAIhBjB,KAAK,EAAER,KAAK,CAAC8E,KAJG;WAKhBhG,KAAK,EAAEC,YAAY,CAACqM,MAAb,CAAoBrJ,IALX;WAMhBoL,QAAQ,EAAE,oBAAM;aACf,MAAI,CAAC3E,sBAAL,CAA4B,MAAI,CAAC0F,UAAL,GAAkB,CAAlB,CAA5B;;UAPF,CADa,EAWb,IAAIhM,iBAAJ,CAAsB;WACrBuE,UAAU,EAAE,KAAKzH,OAAL,CAAayH,UADJ;WAErBoB,MAAM,EAAE,KAAK7I,OAAL,CAAa6I,MAFA;WAGrBjJ,SAAS,EAAE4O,yBAHU;WAIrBpL,IAAI,EAAE;aACLmE,MAAM,EAAEvG,KAAK,CAACyB,EADT;aAELc,SAAS,EAAE,KAAKwM,oBAAL,CAA0B/O,KAAK,CAACyB,EAAhC,CAFN;aAGLsC,KAAK,EAAE;;UAPT,CAXa,CAAd;;SAuBA,IACC,KAAK2I,SAAL,OAAqBhO,QAAQ,CAAC4O,MAA9B,IACG,KAAKZ,SAAL,OAAqBhO,QAAQ,CAAC6O,MAFlC,EAIA;WACC7M,KAAK,CAACgJ,IAAN,CACC,IAAIoC,gBAAJ,CAAqB;aACpBjM,KAAK,EAAE;eACN8N,OAAO,EAAEH,yBAAyB,GAAG,IAAH,GAAU;cAFzB;aAIpBI,cAAc,EAAE,0BAAM;eACrB,MAAI,CAACC,mBAAL,CACC,IAAIC,0BAAJ,CAAc;iBACb1L,IAAI,EAAE;mBACL8K,KAAK,EAAE,MAAI,CAACgB,UAAL,GAAkB,CAAlB,CADF;mBAEL3H,MAAM,EAAEvG,KAAK,CAACyB;;gBAHhB,CADD;;YALF,CADD;;;SAmBD,uBAAgB,KAAKyM,UAAL,EAAhB;;aAAOhB,MAAP;;SACA,IAAIA,MAAJ,EACA;WACCxM,KAAK,CAACuE,OAAN,CAAc,UAACC,IAAD,EAAU;aACvBgI,MAAK,CAACxE,YAAN,CAAmBxD,IAAnB;YADD;UAFD,MAOA;WACC,IAAMgK,QAAQ,GAAG,IAAI9G,SAAJ,CAAc;aAC9BC,YAAY,EAAE,IADgB;aAE9BF,MAAM,EAAE,KAAKuE,SAAL,EAFsB;aAG9B7E,MAAM,EAAE,KAAK7I,OAAL,CAAa6I,MAHS;aAI9BY,UAAU,EAAE/H,KAJkB;aAK9B4F,QAAQ,EAAE;eAAA,OAAM,MAAI,CAACvF,IAAL,CAAU,UAAV,CAAN;;YALM,CAAjB;WAQA,KAAKsM,QAAL,CAAc6B,QAAd;;;;;;6BAMH;OACC,IAAI,CAAC3J,cAAI,CAAC4J,KAAL,CAAW,KAAKnQ,OAAL,CAAaoD,IAAb,CAAkBX,EAA7B,CAAL,EACA;SACC,OAAO,KAAKzC,OAAL,CAAaoD,IAAb,CAAkBX,EAAzB;;;OAGD,OAAO,CAAP;;;;iCAID;OACC,OAAON,cAAI,CAACiO,QAAL,CAAc,KAAKpQ,OAAL,CAAaoD,IAAb,CAAkB+F,MAAhC,CAAP;;;;gCAID;OACC,OAAO,KAAKuE,SAAL,OAAqBhO,QAAQ,CAAC6O,MAA9B,GAAuC,KAAvC,GAA+C,IAAtD;;;;gCAID;OACC,IAAMlB,IAAI,GAAG,KAAK6B,UAAL,GAAkBvG,MAAlB,CAAyB,UAACC,GAAD,EAAMsF,KAAN,EAAgB;SACrD,gDAAWtF,GAAX,kCAAmBsF,KAAK,CAACpH,QAAN,EAAnB;QADY,EAEV,EAFU,CAAb;OAIA,OAAO;SACNrE,EAAE,EAAE,KAAKoJ,KAAL,EADE;SAEN1C,MAAM,EAAE,KAAKuE,SAAL,EAFF;SAGN2C,KAAK,EAAE,KAAKC,QAAL,EAHD;SAINjD,IAAI,EAAJA;QAJD;;;;8BAQQuC,SACT;OACC,OAAO,KAAK5P,OAAL,CAAa6I,MAAb,CAAoBC,IAApB,CAAyB,UAAC5C,IAAD,EAAU;SACzC,OAAOE,MAAM,CAACF,IAAI,CAACzD,EAAN,CAAN,KAAoB2D,MAAM,CAACwJ,OAAD,CAAjC;QADM,CAAP;;;;GAjkBqCW;;;;;;KCPlBC;;;GAEpB,qBAAYxQ,OAAZ,EACA;KAAA;;KAAA;KACC,yGAAMA,OAAN;;KACA,MAAKC,iBAAL,CAAuB,0DAAvB;;KAEA,MAAKwQ,OAAL,CAAa,MAAKC,SAAL,EAAb;;KAEA,IAAI,CAACnK,cAAI,CAACwB,aAAL,CAAmB,MAAK/H,OAAL,CAAa2Q,WAAb,CAAyBvN,IAAzB,CAA8BwN,YAAjD,CAAL,EACA;OACC,MAAKH,OAAL,CAAa,MAAKI,gBAAL,EAAb;MAFD,MAKA;OACC,MAAKJ,OAAL,CAAa,MAAKK,YAAL,EAAb;;OACA,MAAKL,OAAL,CAAa,MAAK1D,cAAL,EAAb;;;KAbF;;;;;iCAkBA;OACC,OAAO,KAAK3M,KAAL,CAAWG,QAAX,CAAoB,YAApB,EAAkC,YAAM;SAC9C,OAAO,IAAIwQ,qCAAJ,CAAe;WACrBvP,KAAK,EAAEuE,aAAG,CAACC,UAAJ,CAAe,4BAAf;UADD,CAAP;QADM,CAAP;;;;oCAQD;OAAA;;OACC,OAAO,KAAK5F,KAAL,CAAWG,QAAX,CAAoB,WAApB,EAAiC,YAAM;SAC7C,OAAO,IAAIyQ,iDAAJ,CAAqB;WAC3BpJ,QAAQ,EAAE,cADiB;WAE3BqJ,WAAW,EAAE,IAFc;WAG3BpI,MAAM,EAAE,MAAI,CAAC7I,OAAL,CAAa2Q,WAAb,CAAyBvN,IAAzB,CAA8BwN,YAA9B,CAA2CzI,GAA3C,CAA+C,UAAC+I,SAAD,EAAe;aACrE,OAAO,IAAIlE,SAAJ,CAAc;eACpBvF,UAAU,EAAE,MAAI,CAACzH,OAAL,CAAayH,UADL;eAEpBoB,MAAM,EAAE,MAAI,CAACsI,aAAL,EAFY;eAGpB/N,IAAI,EAAE8N,SAHc;eAIpB/C,QAAQ,EAAE,MAAI,CAACiD,iBAAL,CAAuB3N,IAAvB,CAA4B,MAA5B;cAJJ,CAAP;YADO;UAHF,CAAP;QADM,CAAP;;;;sCAiBD;OAAA;;OACC,OAAO,KAAKrD,KAAL,CAAWG,QAAX,CAAoB,aAApB,EAAmC,YAAM;SAC/C,OAAO,IAAI6K,4CAAJ,CAAgB;WACtBC,IAAI,EAAE,CACL;aACChI,IAAI,EAAE0C,aAAG,CAACC,UAAJ,CAAe,wCAAf,CADP;aAEC1D,OAAO,EAAE,MAAI,CAAC+O,cAAL,CAAoB5N,IAApB,CAAyB,MAAzB;YAHL;UADA,CAAP;QADM,CAAP;;;;sCAaD;OACC,KAAKyH,YAAL,CAAkB,KAAK2F,gBAAL,EAAlB,EAA2C,KAAK9D,cAAL,EAA3C;OACA,KAAKrL,KAAL,CAAWW,MAAX,CAAkB,KAAK0K,cAAL,EAAlB;OACA7H,aAAG,CAAC7C,MAAJ,CAAW,KAAK0K,cAAL,GAAsBhM,SAAtB,EAAX;OACA,KAAKgM,cAAL,GAAsBuE,WAAtB,CAAkC,UAAlC,EAA8C,KAAKhK,QAAnD;;;;wCAID;OAAA;;OACC,OAAO,KAAKlH,KAAL,CAAWG,QAAX,CAAoB,eAApB,EAAqC,YAAM;SACjD,OAAO,IAAIgR,kDAAJ,CAAqB;WAC3B3J,QAAQ,EAAE,YADiB;WAE3BlG,KAAK,EAAEoM,MAAM,CAACkB,OAAP,CAAetP,QAAf,EAAyByI,GAAzB,CAA6B,gBAAe;aAAA;iBAAXpD,KAAW;;aAClD,OAAO;eACNtC,EAAE,oBAAasC,KAAb,CADI;eAENyM,IAAI,iCAA0BzM,KAAK,GAAG,CAAlC,UAFE;eAGNvD,KAAK,EAAEuE,aAAG,CAACC,UAAJ,qCAA4CjB,KAAK,GAAG,CAApD,EAHD;eAINvE,MAAM,EAAE;iBACP6C,IAAI,EAAE0C,aAAG,CAACC,UAAJ,CAAe,kCAAf,CADC;iBAEP1D,OAAO,EAAE,MAAI,CAACmP,uBAAL,CAA6BhO,IAA7B,CAAkC,MAAlC,EAAwC;mBAAC/C,IAAI,EAAEqE;kBAA/C;;cANX;YADM;UAFD,CAAP;QADM,CAAP;;;;qCAmBD;OAAA;;OACC,IAAM+G,eAAe,GAAI,YAAM;SAC9B,IACC,CAACvF,cAAI,CAACwC,aAAL,CAAmB,MAAI,CAAC/I,OAAL,CAAayH,UAAb,CAAwBC,IAAxB,CAA6B1G,KAAhD,CAAD,IACG,CAACuF,cAAI,CAACwB,aAAL,CAAmB,MAAI,CAAC/H,OAAL,CAAayH,UAAb,CAAwBC,IAAxB,CAA6B1G,KAA7B,CAAmC0Q,UAAtD,CAFL,EAIA;WACC,OAAO,IAAP;;;SAGD,OAAO,MAAI,CAAC1R,OAAL,CAAayH,UAAb,CAAwBC,IAAxB,CAA6B1G,KAA7B,CAAmC0Q,UAA1C;QATuB,EAAxB;;OAYA,OAAO,KAAK1R,OAAL,CAAa2Q,WAAb,CAAyBvN,IAAzB,CAA8ByF,MAA9B,CAAqCf,MAArC,CAA4C,UAAC9G,KAAD,EAAW;SAC7D,OACC,CAACuF,cAAI,CAACwB,aAAL,CAAmB+D,eAAnB,CAAD,IAEC,CAACA,eAAe,CAAC7D,QAAhB,CAAyBjH,KAAK,CAACN,IAA/B,CAAD,KAEC,CAAC6F,cAAI,CAACwC,aAAL,CAAmB/H,KAAK,CAACY,OAAzB,CAAD,IACGkK,eAAe,CAAC7D,QAAhB,CAAyBjH,KAAK,CAACY,OAAN,CAAclB,IAAvC,CAHJ,CAHF;QADM,CAAP;;;;oDAeD;OAAA,IADyBA,IACzB,SADyBA,IACzB;OACC,KAAKiR,KAAL;OAEA,IAAMC,MAAM,GAAG,KAAKlB,SAAL,EAAf;OACAkB,MAAM,CAACC,eAAP,CAAuB,KAAvB;OACA,KAAKpB,OAAL,CAAamB,MAAb;OAEA,IAAME,QAAQ,GAAG,KAAKhB,YAAL,EAAjB;OAEAgB,QAAQ,CAACC,QAAT,CACC,IAAI/E,SAAJ,CAAc;SACbvF,UAAU,EAAE,KAAKzH,OAAL,CAAayH,UADZ;SAEboB,MAAM,EAAE,KAAKsI,aAAL,EAFK;SAGb/N,IAAI,EAAE;WACLX,EAAE,EAAE,CADC;WAEL0G,MAAM,EAAEzI,IAFH;WAGL2M,IAAI,EAAE,EAHD;WAILgD,KAAK,EAAE3P,IAAI,KAAKhB,QAAQ,CAAC6O,MAAlB,GAA2B,KAA3B,GAAmC;UAP9B;SASbJ,QAAQ,EAAE,KAAKiD,iBAAL,CAAuB3N,IAAvB,CAA4B,IAA5B;QATX,CADD;OAcA,KAAKgN,OAAL,CAAaqB,QAAb;OACA,KAAKrB,OAAL,CAAa,KAAK1D,cAAL,EAAb;;;;uCAGiBrJ,OAClB;OACC,KAAK4D,QAAL,CAAc5D,KAAd;OAEA,KAAKoN,YAAL,GAAoBkB,WAApB,CAAgCtO,KAAK,CAACsG,SAAN,EAAhC;OACAtG,KAAK,CAACsG,SAAN,GAAkBsH,WAAlB,CAA8B,UAA9B,EAA0C,KAAKhK,QAA/C;;;;8BAGQ5D,OACT;OACC,KAAK3B,IAAL,CAAU,UAAV,sCAA0B2B,KAAK,CAACoM,OAAN,EAA1B;SAA2CmC,WAAW,EAAE;;;;;kCAG5ClN,OACb;OACC,OAAO;SACN6L,YAAY,EAAE9C,MAAM,CAACC,MAAP,CAAchJ,KAAd,EAAqB+C,MAArB,CAA4B,UAACkG,KAAD,EAAW;WACpD,OAAOzH,cAAI,CAACwB,aAAL,CAAmBiG,KAAK,CAACX,IAAzB,CAAP;UADa;QADf;;;;GAhKuC6E;;;;;;;;"}