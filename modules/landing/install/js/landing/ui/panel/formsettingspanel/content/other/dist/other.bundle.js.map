{"version":3,"file":"other.bundle.js","sources":["../src/internal/userselectorfield/userselectorfield.js","../src/other.js"],"sourcesContent":["import {BaseField} from 'landing.ui.field.basefield';\nimport {TagSelector} from 'ui.entity-selector';\nimport {PageObject} from 'landing.pageobject';\nimport {Dom} from 'main.core';\n\nexport default class UserSelectorField extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tDom.removeClass(this.input, 'landing-ui-field-input');\n\n\t\tthis.getTagSelector().renderTo(this.input);\n\t}\n\n\tgetTagSelector(): TagSelector\n\t{\n\t\treturn this.cache.remember('tagSelector', () => {\n\t\t\tconst root = PageObject.getRootWindow();\n\t\t\treturn new root.BX.UI.EntitySelector.TagSelector({\n\t\t\t\tid: 'user-selector',\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tid: 'user-selector',\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tactiveUsers: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreselectedItems: this.options.value,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onSelect': () => {\n\t\t\t\t\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'Item:onDeselect': () => {\n\t\t\t\t\t\t\tthis.emit('onChange', {skipPrepare: true});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetValue(): Array<number>\n\t{\n\t\treturn this.getTagSelector().getDialog().getSelectedItems().map((item) => {\n\t\t\treturn item.id;\n\t\t});\n\t}\n}","import {HeaderCard} from 'landing.ui.card.headercard';\nimport {Loc} from 'landing.loc';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {TextField} from 'landing.ui.field.textfield';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {BaseEvent} from 'main.core.events';\nimport {Dom, Reflection, Type, Tag} from 'main.core';\nimport UserSelectorField from './internal/userselectorfield/userselectorfield';\nimport {BaseCard} from \"landing.ui.card.basecard\";\nimport './css/style.css';\n\n\nexport default class Other extends ContentWrapper\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.SpamProtection');\n\n\t\tconst header = new HeaderCard({\n\t\t\ttitle: Loc.getMessage('LANDING_FORM_OTHER_TITLE'),\n\t\t});\n\n\t\tconst otherForm = new FormSettingsForm({\n\t\t\tid: 'other',\n\t\t\tdescription: null,\n\t\t\tfields: [\n\t\t\t\tthis.getNameField(),\n\t\t\t\tthis.getUserSelectorField(),\n\t\t\t\tthis.getCheckWorkTimeField(),\n\t\t\t\tthis.getLanguageField(),\n\t\t\t\tthis.getUseSignField(),\n\t\t\t],\n\t\t});\n\n\t\tthis.addItem(header);\n\t\tthis.addItem(otherForm);\n\n\t\tconst idCard = new BaseCard();\n\t\tDom.style(idCard.getLayout(), {\n\t\t\tpadding: 0,\n\t\t\tmargin: 0,\n\t\t});\n\t\tconst id = this.options.formOptions.id;\n\t\tDom.append(\n\t\t\tTag.render`<div>${Loc.getMessage('LANDING_CRM_FORM_ID')}: ${id}</div>`,\n\t\t\tidCard.getBody()\n\t\t);\n\t\tthis.addItem(idCard);\n\t}\n\n\tcanRemoveCopyrights(): boolean\n\t{\n\t\treturn this.options.dictionary.sign.canRemove;\n\t}\n\n\tgetNameField(): TextField\n\t{\n\t\treturn this.cache.remember('nameField', () => {\n\t\t\treturn new TextField({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_OTHER_TITLE_NAME_TITLE'),\n\t\t\t\tselector: 'name',\n\t\t\t\ttextOnly: true,\n\t\t\t\tcontent: this.options.formOptions.name,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetUseSignField(): BX.Landing.UI.Field.Checkbox\n\t{\n\t\treturn this.cache.remember('useSignField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Checkbox({\n\t\t\t\tselector: 'useSign',\n\t\t\t\tvalue: this.options.formOptions.data.useSign ? ['useSign'] : [],\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'useSign',\n\t\t\t\t\t\thtml: `${Loc.getMessage('LANDING_HEADER_AND_BUTTONS_SHOW_SIGN')}${this.createCopyRight()}`,\n\t\t\t\t\t\tname: '',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tcompact: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetUserSelectorField()\n\t{\n\t\treturn this.cache.remember('userSelectorField', () => {\n\t\t\treturn new UserSelectorField({\n\t\t\t\tselector: 'users',\n\t\t\t\ttitle: Loc.getMessage('LANDING_CRM_FORM_USER'),\n\t\t\t\tvalue: this.options.formOptions.responsible.users.reduce((acc, item) => {\n\t\t\t\t\tif (Type.isStringFilled(item) || Type.isNumber(item))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc.push(['user', item]);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, []),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCheckWorkTimeField(): BX.Landing.UI.Field.Checkbox\n\t{\n\t\treturn this.cache.remember('checkWorkTimeField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Checkbox({\n\t\t\t\tselector: 'checkWorkTime',\n\t\t\t\tcompact: true,\n\t\t\t\tvalue: [this.options.formOptions.responsible.checkWorkTime ? 'Y' : 'N'],\n\t\t\t\titems: [\n\t\t\t\t\t{name: Loc.getMessage('LANDING_FORM_OTHER_CHECK_WORK_TIME'), value: 'Y'},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetLanguageField(): BX.Landing.UI.Field.Dropdown\n\t{\n\t\treturn this.cache.remember('language', () => {\n\t\t\treturn new BX.Landing.UI.Field.Dropdown({\n\t\t\t\tselector: 'language',\n\t\t\t\ttitle: Loc.getMessage('LANDING_CRM_FORM_LANGUAGE'),\n\t\t\t\titems: this.options.dictionary.languages.map((item) => {\n\t\t\t\t\treturn {name: item.name, value: item.id};\n\t\t\t\t}),\n\t\t\t\tcontent: this.options.formOptions.data.language,\n\t\t\t});\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tcreateCopyRight(): string\n\t{\n\t\treturn `\n\t\t\t<span class=\"landing-ui-signin\">\n\t\t\t\t<span class=\"landing-ui-sign\">${Loc.getMessage('LANDING_HEADER_AND_BUTTONS_BUTTONS_SIGN')}</span>\n\t\t\t\t<span class=\"landing-ui-sign-in\">${Loc.getMessage('LANDING_HEADER_AND_BUTTONS_BUTTONS_SIGN_BY')}</span>\n\t\t\t\t<span class=\"landing-ui-sign-24\">24</span>\n\t\t\t</span>\n\t\t`;\n\t}\n\n\tvalueReducer(value: {[key: string]: any}): {[key: string]: any}\n\t{\n\t\treturn {\n\t\t\tname: value.name,\n\t\t\tdata: {\n\t\t\t\tlanguage: this.getLanguageField().getValue(),\n\t\t\t\tuseSign: value.useSign.includes('useSign'),\n\t\t\t},\n\t\t\tresponsible: {\n\t\t\t\tusers: value.users,\n\t\t\t\tcheckWorkTime: value.checkWorkTime[0] === 'Y',\n\t\t\t},\n\t\t};\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tif (!this.canRemoveCopyrights())\n\t\t{\n\t\t\tconst checkbox = this.getUseSignField();\n\n\t\t\tif (!checkbox.getValue().includes('useSign'))\n\t\t\t{\n\t\t\t\tcheckbox.setValue(['useSign']);\n\t\t\t\tif (Type.isStringFilled(this.options.dictionary.restriction.helper))\n\t\t\t\t{\n\t\t\t\t\tconst evalGlobal = Reflection.getClass('BX.evalGlobal');\n\t\t\t\t\tif (Type.isFunction(evalGlobal))\n\t\t\t\t\t{\n\t\t\t\t\t\tevalGlobal(this.options.dictionary.restriction.helper);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n}"],"names":["UserSelectorField","options","Dom","removeClass","input","getTagSelector","renderTo","cache","remember","root","PageObject","getRootWindow","BX","UI","EntitySelector","TagSelector","id","dialogOptions","entities","activeUsers","preselectedItems","value","events","emit","skipPrepare","getDialog","getSelectedItems","map","item","BaseField","Other","setEventNamespace","header","HeaderCard","title","Loc","getMessage","otherForm","FormSettingsForm","description","fields","getNameField","getUserSelectorField","getCheckWorkTimeField","getLanguageField","getUseSignField","addItem","idCard","BaseCard","style","getLayout","padding","margin","formOptions","append","Tag","render","getBody","dictionary","sign","canRemove","TextField","selector","textOnly","content","name","Landing","Field","Checkbox","data","useSign","items","html","createCopyRight","compact","responsible","users","reduce","acc","Type","isStringFilled","isNumber","push","checkWorkTime","Dropdown","languages","language","getValue","includes","event","canRemoveCopyrights","checkbox","setValue","restriction","helper","evalGlobal","Reflection","getClass","isFunction","getData","ContentWrapper"],"mappings":"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"}