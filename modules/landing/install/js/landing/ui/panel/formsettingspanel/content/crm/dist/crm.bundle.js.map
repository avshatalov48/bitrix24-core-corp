{"version":3,"file":"crm.bundle.js","sources":["../src/internal/stagefield/stagefield.js","../src/crm.js"],"sourcesContent":["import {BaseField} from 'landing.ui.field.basefield';\nimport {Loc} from 'landing.loc';\nimport {Dom, Tag, Type} from 'main.core';\n\nimport './css/style.css';\n\nconst fetchId = (item) => {\n\treturn !Type.isNil(item.ID) ? item.ID : item.id;\n};\n\nconst fetchName = (item) => {\n\treturn !Type.isNil(item.NAME) ? item.NAME : item.name;\n};\n\nexport default class StageField extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tDom.replace(this.input, this.getInner());\n\t}\n\n\tgetInner()\n\t{\n\t\treturn this.cache.remember('inner', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-stages\">\n\t\t\t\t\t${this.getCategoriesDropdown().getLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetCategoriesDropdown(): BX.Landing.UI.Field.Dropdown\n\t{\n\t\treturn this.cache.remember('categoriesDropdown', () => {\n\t\t\treturn new BX.Landing.UI.Field.Dropdown({\n\t\t\t\ttitle: this.options.listTitle || Loc.getMessage('LANDING_FORM_SETTINGS_CATEGORIES_FIELD_TITLE'),\n\t\t\t\tcontent: this.options.value.category,\n\t\t\t\titems: this.options.categories.map((category) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: fetchName(category),\n\t\t\t\t\t\tvalue: fetchId(category),\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tonChange: this.onCategoryChange.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCurrentCategory()\n\t{\n\t\tconst currentCategoryId = this.getCategoriesDropdown().getValue();\n\n\t\treturn this.options.categories.find((category) => {\n\t\t\treturn String(fetchId(category)) === String(currentCategoryId);\n\t\t});\n\t}\n\n\tonCategoryChange()\n\t{\n\t\tthis.emit('onChange');\n\t}\n\n\tgetValue()\n\t{\n\t\treturn {\n\t\t\tcategory: this.getCategoriesDropdown().getValue(),\n\t\t\tstage: '',\n\t\t};\n\t}\n\n\tsetValue(value, preventEvent = false)\n\t{\n\t\tthis.getCategoriesDropdown().setValue(value.category);\n\n\t\tif (!preventEvent)\n\t\t{\n\t\t\tthis.emit('onChange');\n\t\t}\n\t}\n}","import {Loc} from 'landing.loc';\nimport {HeaderCard} from 'landing.ui.card.headercard';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {RadioButtonField} from 'landing.ui.field.radiobuttonfield';\nimport {BaseEvent} from 'main.core.events';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {Text, Type} from 'main.core';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport StageField from './internal/stagefield/stagefield';\nimport { SchemeManager } from 'landing.ui.panel.formsettingspanel.content.crm.schememanager';\n\nimport './css/style.css';\n\ntype CrmField = {\n\ttype: 'list' | 'string' | 'checkbox' | 'date' | 'text' | 'typed_string' | 'file',\n\tentity_field_name: string,\n\tentity_name: string,\n\tname: string,\n\tcaption: string,\n\tmultiple: boolean,\n\trequired: boolean,\n\thidden: boolean,\n\titems: Array<{ID: any, VALUE: any}>,\n};\n\nexport default class CrmContent extends ContentWrapper\n{\n\t#schemeManager: SchemeManager;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.CrmContent');\n\n\t\tthis.#schemeManager = new SchemeManager([ ...options.dictionary.document.schemes ]);\n\n\t\tthis.addItem(this.getHeader());\n\t\tthis.addItem(this.getTypesField());\n\t\tif (this.isDynamicAvailable())\n\t\t{\n\t\t\tthis.addItem(this.getDynamicEntitySettingsForm());\n\t\t}\n\n\t\tthis.addItem(this.getExpertSettingsForm());\n\t\tthis.addItem(this.getOrderSettingsForm());\n\n\t\tthis.setLastScheme(this.options.formOptions.document.scheme);\n\t\tthis.setLastDealCategory(this.options.formOptions.document.deal.category);\n\t}\n\n\tisDynamicAvailable(): boolean\n\t{\n\t\treturn Type.isArrayFilled(this.options.dictionary.document.dynamic);\n\t}\n\n\tgetHeader(): HeaderCard\n\t{\n\t\treturn this.cache.remember('header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TITLE'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDuplicatesField(): BX.Landing.UI.Field.Radio\n\t{\n\t\treturn this.cache.remember('duplicatesField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Radio({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_FIELD_TITLE'),\n\t\t\t\tselector: 'duplicateMode',\n\t\t\t\tvalue: [this.options.formOptions.document.duplicateMode ? this.options.formOptions.document.duplicateMode : 'ALLOW'],\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_ALLOW'),\n\t\t\t\t\t\tvalue: 'ALLOW',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_REPLACE'),\n\t\t\t\t\t\tvalue: 'REPLACE',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_MERGE'),\n\t\t\t\t\t\tvalue: 'MERGE',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetOrderSettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('formSettingsForm', () => {\n\t\t\tconst scheme = this.getSchemeById(this.options.formOptions.document.scheme);\n\t\t\tconst isOpened = (() => {\n\t\t\t\tif (scheme && scheme.dynamic === true)\n\t\t\t\t{\n\t\t\t\t\treturn String(scheme.id).endsWith('1');\n\t\t\t\t}\n\n\t\t\t\treturn Text.toNumber(this.options.formOptions.document.scheme) > 4;\n\t\t\t})();\n\n\t\t\treturn new FormSettingsForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_ORDER_HEADER'),\n\t\t\t\ttoggleable: true,\n\t\t\t\topened: isOpened,\n\t\t\t\tfields: [],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType1Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type1header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_1').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType2Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type2header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_2').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType3Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type3header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_3').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType4Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type4header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_4').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType6Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type6header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_6').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDynamicHeader(headerText: string): HeaderCard\n\t{\n\t\tconst header = this.cache.remember('dynamicHeader', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: '',\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\n\t\tif (Type.isString(headerText))\n\t\t{\n\t\t\theader.setTitle(headerText);\n\t\t}\n\n\t\treturn header;\n\t}\n\n\tgetDynamicEntitiesField(): BX.Landing.UI.Field.Dropdown\n\t{\n\t\treturn this.cache.remember('dynamicEntitiesField', () => {\n\t\t\tconst currentScheme = this.getSchemeById(this.options.formOptions.document.scheme);\n\n\t\t\treturn new BX.Landing.UI.Field.Dropdown({\n\t\t\t\tselector: 'dynamicScheme',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_SMART_ENTITY_LIST'),\n\t\t\t\titems: this.options.dictionary.document.dynamic.map((scheme) => {\n\t\t\t\t\treturn {name: scheme.name, value: scheme.id};\n\t\t\t\t}),\n\t\t\t\tcontent: currentScheme.mainEntity,\n\t\t\t\tonChange: () => {\n\t\t\t\t\tthis.onTypeChange(\n\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\t\t\tid: this.getSelectedSchemeId(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDynamicEntitySettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('dynamicEntitySettingsForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\topened: true,\n\t\t\t\thidden: true,\n\t\t\t\tfields: [\n\t\t\t\t\tthis.getDynamicEntitiesField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetExpertSettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('expertSettingsForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_EXPERT_MODE'),\n\t\t\t\ttoggleable: true,\n\t\t\t\ttoggleableType: FormSettingsForm.ToggleableType.Link,\n\t\t\t\topened: false,\n\t\t\t\tfields: [\n\t\t\t\t\tnew HeaderCard({\n\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_1').replace('&nbsp;', ' '),\n\t\t\t\t\t\tlevel: 2,\n\t\t\t\t\t}),\n\t\t\t\t\tthis.getDuplicatesField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTypesField(): RadioButtonField\n\t{\n\t\treturn this.cache.remember('typesField', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.onTypeChange(\n\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\t\tid: this.options.formOptions.document.scheme,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tconst items = [\n\t\t\t\t{\n\t\t\t\t\tid: '2',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_2'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type2',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: '3',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_3'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type3',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: '4',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_4'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type4',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: '310',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_310'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type310',\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tif (this.isDynamicAvailable())\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\tid: 'smart',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_5'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type5',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.options.isLeadEnabled)\n\t\t\t{\n\t\t\t\titems.unshift({\n\t\t\t\t\tid: '1',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_1'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type1',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn new RadioButtonField({\n\t\t\t\tselector: 'scheme',\n\t\t\t\tvalue: (() => {\n\t\t\t\t\tconst schemeId = Text.toNumber(this.options.formOptions.document.scheme);\n\t\t\t\t\tif (this.#schemeManager.isDefaultScheme(schemeId) && this.#schemeManager.isInvoice(schemeId))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.#schemeManager.getSpecularSchemeId(schemeId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (String(this.options.formOptions.document.scheme) === '310')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 310;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst scheme = this.getSchemeById(this.options.formOptions.document.scheme);\n\t\t\t\t\tif (Type.isPlainObject(scheme) && scheme.dynamic === true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 'smart';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn String(schemeId);\n\t\t\t\t})(),\n\t\t\t\titems,\n\t\t\t\tonChange: this.onTypeChange.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDealCategoryField()\n\t{\n\t\treturn this.cache.remember('dealCategoryField', () => {\n\t\t\treturn new StageField({\n\t\t\t\tcategories: this.options.categories,\n\t\t\t\tvalue: {\n\t\t\t\t\tcategory: this.options.formOptions.document.deal.category,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDynamicCategoriesField(schemeId: string | number)\n\t{\n\t\treturn this.cache.remember(`dynamicCategories#${schemeId}`, () => {\n\t\t\tconst scheme = this.getDynamicSchemeById(schemeId);\n\t\t\treturn new StageField({\n\t\t\t\tlistTitle: Loc.getMessage('LANDING_FORM_SETTINGS_SMART_STAGES_FIELD_TITLE'),\n\t\t\t\tcategories: scheme.categories,\n\t\t\t\tvalue: {\n\t\t\t\t\tcategory: this.options.formOptions.document.dynamic.category,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDuplicatesEnabledField()\n\t{\n\t\treturn this.cache.remember('duplicatesEnabledField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Checkbox({\n\t\t\t\tselector: 'duplicatesEnabled',\n\t\t\t\tcompact: true,\n\t\t\t\tvalue: [this.options.formOptions.document.deal.duplicatesEnabled || 'Y'],\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_DUPLICATES_ENABLED'),\n\t\t\t\t\t\tvalue: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSchemeById(id: number)\n\t{\n\t\treturn this.options.dictionary.document.schemes.find((scheme) => {\n\t\t\treturn (\n\t\t\t\t(String(scheme.id) === String(id))\n\t\t\t\t|| (\n\t\t\t\t\tid === 'smart'\n\t\t\t\t\t&& scheme.dynamic\n\t\t\t\t\t&& String(scheme.id) === String(this.getSelectedSchemeId())\n\t\t\t\t)\n\t\t\t);\n\t\t});\n\t}\n\n\tgetDynamicSchemeById(id: number)\n\t{\n\t\tconst {mainEntity} = this.getSchemeById(id);\n\t\treturn this.options.dictionary.document.dynamic.find((scheme) => {\n\t\t\treturn String(scheme.id) === String(mainEntity);\n\t\t});\n\t}\n\n\tsetLastScheme(schemeId: number)\n\t{\n\t\tthis.cache.set('lastScheme', schemeId);\n\t}\n\n\tgetLastScheme(): number\n\t{\n\t\treturn this.cache.get('lastScheme');\n\t}\n\n\tsetLastDealCategory(categoryId: number)\n\t{\n\t\tthis.cache.set('lastDealCategory', categoryId);\n\t}\n\n\tgetLastDealCategory(): ?number\n\t{\n\t\treturn this.cache.get('lastDealCategory', null);\n\t}\n\n\tonTypeChange(event: BaseEvent)\n\t{\n\t\tconst {item} = event.getData();\n\t\tconst scheme = this.getSchemeById(item.id);\n\n\t\tthis.clear();\n\n\t\tthis.addItem(this.getHeader());\n\t\tthis.addItem(this.getTypesField());\n\t\tif (this.isDynamicAvailable())\n\t\t{\n\t\t\tthis.addItem(this.getDynamicEntitySettingsForm());\n\t\t\tthis.getDynamicEntitySettingsForm().hide();\n\t\t}\n\n\t\tconst expertSettingsForm = this.getExpertSettingsForm();\n\t\texpertSettingsForm.clear();\n\n\t\tif (String(item.id) === '1' || String(item.id) === '8')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType1Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (String(item.id) === '2' || String(item.id) === '5')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType2Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (String(item.id) === '3' || String(item.id) === '6')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType3Header());\n\t\t\texpertSettingsForm.addField(this.getDealCategoryField());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesEnabledField());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (String(item.id) === '4' || String(item.id) === '7')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType4Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\t\tif (String(item.id) === '310')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType6Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (\n\t\t\t(\n\t\t\t\tText.toNumber(item.id) > 4\n\t\t\t\t&& Type.isPlainObject(scheme)\n\t\t\t\t&& scheme.dynamic !== true && String(item.id)  !== '9'\n\t\t\t)\n\t\t\t|| this.getOrderSettingsForm().isOpened()\n\t\t)\n\t\t{\n\t\t\tthis.getOrderSettingsForm().onSwitchChange(true);\n\t\t}\n\n\t\tif (\n\t\t\tType.isPlainObject(scheme)\n\t\t\t&& (String(item.id) === 'smart' || scheme.dynamic === true)\n\t\t\t&& this.isDynamicAvailable()\n\t\t)\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getDynamicHeader(scheme.name));\n\t\t\tconst dynamicScheme = this.getDynamicSchemeById(scheme.id);\n\t\t\tif (dynamicScheme && dynamicScheme.categories)\n\t\t\t{\n\t\t\t\texpertSettingsForm.addField(this.getDynamicCategoriesField(scheme.id));\n\t\t\t}\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\n\t\t\tif (String(scheme.id).endsWith('1'))\n\t\t\t{\n\t\t\t\tthis.getOrderSettingsForm().onSwitchChange(true);\n\t\t\t}\n\n\t\t\tthis.getDynamicEntitySettingsForm().show();\n\t\t}\n\n\t\tthis.addItem(expertSettingsForm);\n\t\tif (String(item.id) !== '310')\n\t\t{\n\t\t\tthis.addItem(this.getOrderSettingsForm());\n\t\t}\n\t}\n\n\tsetAdditionalValue(value: {[key: string]: any})\n\t{\n\t\tthis.cache.set('additionalValue', value);\n\t}\n\n\tgetAdditionalValue(): {[key: string]: any}\n\t{\n\t\treturn this.cache.get('additionalValue', {});\n\t}\n\n\tgetEntityChangeConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('entityChangeConfirm', () => {\n\t\t\treturn new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDealCategoryChangeConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('dealCategoryChangeConfirm', () => {\n\t\t\treturn new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCreateOrderChangeConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('createOrderChangeConfirm', () => {\n\t\t\treturn new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t});\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tconst value = this.getValue();\n\t\tconst scheme = this.getSchemeById(value.document.scheme);\n\n\t\tif (Type.isPlainObject(scheme))\n\t\t{\n\t\t\tconst allowedEntities = scheme.entities;\n\t\t\tconst removedFields = this.options.formOptions.presetFields\n\t\t\t\t.filter((presetField) => {\n\t\t\t\t\treturn !allowedEntities.includes(presetField.entityName);\n\t\t\t\t})\n\t\t\t\t.map((presetField) => {\n\t\t\t\t\treturn this.getCrmFieldById(\n\t\t\t\t\t\t`${presetField.entityName}_${presetField.fieldName}`,\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\tif (Type.isArrayFilled(removedFields))\n\t\t\t{\n\t\t\t\tconst itemTemplate = Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_ITEM_TEMPLATE');\n\t\t\t\tconst entityName = Text.encode(itemTemplate.replace('{text}', scheme.name));\n\n\t\t\t\tconst messageText = (() => {\n\t\t\t\t\tconst fields = removedFields.map((field) => {\n\t\t\t\t\t\treturn itemTemplate.replace('{text}', Text.encode(field.caption));\n\t\t\t\t\t});\n\n\t\t\t\t\tif (removedFields.length > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst lastField = fields.pop();\n\n\t\t\t\t\t\treturn Loc\n\t\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TEXT')\n\t\t\t\t\t\t\t.replace('{fieldsList}', fields.join(', '))\n\t\t\t\t\t\t\t.replace('{lastField}', Text.encode(lastField))\n\t\t\t\t\t\t\t.replaceAll('{entityName}', entityName);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Loc\n\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TEXT_1')\n\t\t\t\t\t\t.replace('{fieldName}', fields.join(', '))\n\t\t\t\t\t\t.replaceAll('{entityName}', entityName);\n\t\t\t\t})();\n\n\t\t\t\tconst entityChangeConfirm = this.getEntityChangeConfirm();\n\n\t\t\t\tentityChangeConfirm.setOkCallback(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tentityChangeConfirm.close();\n\t\t\t\t\t\tentityChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\tentityChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\tconst filteredFields = this.options.formOptions.presetFields.filter((presetField) => {\n\t\t\t\t\t\t\treturn allowedEntities.includes(presetField.entityName);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.setLastScheme(scheme.id);\n\t\t\t\t\t\tthis.setAdditionalValue({\n\t\t\t\t\t\t\tpresetFields: filteredFields,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.options.formOptions.presetFields = filteredFields;\n\n\t\t\t\t\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\n\t\t\t\t\t\tthis.setAdditionalValue({});\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tentityChangeConfirm.setCancelCallback(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tentityChangeConfirm.close();\n\t\t\t\t\t\tentityChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\tentityChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\tconst lastScheme = this.getSchemeById(this.getLastScheme());\n\n\t\t\t\t\t\tif (lastScheme.dynamic)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getTypesField().setValue('smart', true);\n\t\t\t\t\t\t\tthis.getDynamicEntitiesField().setValue(lastScheme.mainEntity, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getTypesField().setValue(lastScheme.id);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.onTypeChange(\n\t\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\t\t\t\tid: lastScheme.id,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tentityChangeConfirm.setMessage(messageText);\n\n\t\t\t\tentityChangeConfirm.show();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tString(scheme.id) === '3'\n\t\t\t\t|| String(scheme.id) === '6'\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst lastDealCategory = this.getLastDealCategory();\n\t\t\t\tif (Text.toNumber(value.document.deal.category) !== Text.toNumber(lastDealCategory))\n\t\t\t\t{\n\t\t\t\t\tconst dealStageField = this.options.formOptions.presetFields.find((presetField) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tpresetField.entityName === 'DEAL'\n\t\t\t\t\t\t\t&& presetField.fieldName === 'STAGE_ID'\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (dealStageField)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst crmField = this.getCrmFieldById('DEAL_STAGE_ID');\n\t\t\t\t\t\tconst dealCategoryChangeConfirm = this.getDealCategoryChangeConfirm();\n\n\t\t\t\t\t\tconst fieldName = Loc\n\t\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_ITEM_TEMPLATE')\n\t\t\t\t\t\t\t.replace('{text}', Text.encode(crmField.caption));\n\t\t\t\t\t\tconst messageText = Loc\n\t\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_CATEGORY_CHANGE_CONFIRM_TEXT')\n\t\t\t\t\t\t\t.replace('{fieldName}', fieldName);\n\n\t\t\t\t\t\tdealCategoryChangeConfirm.setMessage(messageText);\n\t\t\t\t\t\tdealCategoryChangeConfirm.setOkCallback(\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.close();\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\t\t\tconst filteredFields = (\n\t\t\t\t\t\t\t\t\tthis.options.formOptions.presetFields.filter((presetField) => {\n\t\t\t\t\t\t\t\t\t\treturn presetField !== dealStageField;\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tthis.options.formOptions.presetFields = filteredFields;\n\n\t\t\t\t\t\t\t\tthis.setLastDealCategory(value.document.deal.category);\n\t\t\t\t\t\t\t\tthis.setAdditionalValue({\n\t\t\t\t\t\t\t\t\tpresetFields: filteredFields,\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t\t\t\t\t\t\t\tthis.setAdditionalValue({});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tdealCategoryChangeConfirm.setCancelCallback(\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.close();\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\t\t\tthis.getDealCategoryField().setValue({\n\t\t\t\t\t\t\t\t\tcategory: this.getLastDealCategory(),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.setAdditionalValue({});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tdealCategoryChangeConfirm.show();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!this.#schemeManager.isInvoice(scheme.id) && value.document.payment.use)\n\t\t{\n\t\t\tconst createOrderMessageBox = this.getCreateOrderChangeConfirm();\n\t\t\tcreateOrderMessageBox.setMessage(\n\t\t\t\tLoc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_CREATE_ORDER_MESSAGE_BOX_TITLE')\n\t\t\t);\n\n\t\t\tcreateOrderMessageBox.setOkCallback((messageBox: MessageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tmessageBox.getOkButton().setDisabled(false);\n\n\t\t\t\tthis.options.formOptions.payment.use = false;\n\n\t\t\t\tthis.onChange(event);\n\t\t\t})\n\t\t\tcreateOrderMessageBox.setCancelCallback((messageBox: MessageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tmessageBox.getCancelButton().setDisabled(false);\n\n\t\t\t\tconst orderSettingsSwitch = this.getOrderSettingsForm().getSwitch();\n\t\t\t\torderSettingsSwitch.setValue(true);\n\t\t\t\torderSettingsSwitch.onChange();\n\n\t\t\t\tthis.onChange(event);\n\t\t\t})\n\t\t\tcreateOrderMessageBox.show();\n\t\t}\n\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n\n\tgetCrmFieldById(id: string): ?CrmField\n\t{\n\t\treturn Object.values(this.options.crmFields)\n\t\t\t.reduce((acc, category) => {\n\t\t\t\treturn [...acc, ...category.FIELDS];\n\t\t\t}, [])\n\t\t\t.find((currentField) => {\n\t\t\t\treturn currentField.name === id;\n\t\t\t});\n\t}\n\n\tgetSelectedSchemeId(): number\n\t{\n\t\tconst typeId = this.getTypesField().getValue();\n\t\tif (String(typeId) === 'smart')\n\t\t{\n\t\t\tconst entityId = this.getDynamicEntitiesField().getValue();\n\t\t\tif (this.getOrderSettingsForm().isOpened())\n\t\t\t{\n\t\t\t\treturn `${entityId}1`;\n\t\t\t}\n\n\t\t\treturn `${entityId}0`;\n\t\t}\n\n\t\treturn typeId;\n\t}\n\n\tvalueReducer(value: {[p: string]: any}): {[p: string]: any}\n\t{\n\t\tconst duplicateMode = this.getDuplicatesField().getValue()[0];\n\t\tconst reducedValue = {\n\t\t\tduplicateMode: duplicateMode === 'ALLOW' ? '' : duplicateMode,\n\t\t\tscheme: this.getSelectedSchemeId(),\n\t\t\tdeal: {\n\t\t\t\tduplicatesEnabled: Text.toBoolean(this.getDuplicatesEnabledField().getValue()[0]),\n\t\t\t},\n\t\t\tpayment: {\n\t\t\t\tuse: this.options.formOptions.payment.use,\n\t\t\t\tpayer: this.options.formOptions.payment.payer,\n\t\t\t\tdisabledSystems: this.options.formOptions.payment.disabledSystems,\n\t\t\t},\n\t\t\tdynamic: {\n\t\t\t\tcategory: null,\n\t\t\t},\n\t\t};\n\n\t\tif (this.getOrderSettingsForm().isOpened())\n\t\t{\n\t\t\tif (String(reducedValue.scheme) === '1')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '8';\n\t\t\t}\n\n\t\t\tif (String(reducedValue.scheme) === '2')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '5';\n\t\t\t}\n\n\t\t\tif (String(reducedValue.scheme) === '3')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '6';\n\t\t\t}\n\n\t\t\tif (String(reducedValue.scheme) === '4')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '7';\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tString(reducedValue.scheme) === '3'\n\t\t\t|| String(reducedValue.scheme) === '6'\n\t\t)\n\t\t{\n\t\t\treducedValue.deal.category = this.getDealCategoryField().getValue().category;\n\t\t}\n\n\t\tconst scheme = this.getSchemeById(reducedValue.scheme);\n\t\tconst dynamicScheme = this.getDynamicSchemeById(reducedValue.scheme);\n\t\tif (Type.isPlainObject(scheme) && scheme.dynamic && dynamicScheme && dynamicScheme.categories)\n\t\t{\n\t\t\treducedValue.dynamic.category = this.getDynamicCategoriesField(scheme.id).getValue().category;\n\t\t}\n\n\t\treturn {\n\t\t\tdocument: reducedValue,\n\t\t\t...this.getAdditionalValue(),\n\t\t};\n\t}\n}"],"names":["fetchId","item","Type","isNil","ID","id","fetchName","NAME","name","StageField","options","Dom","replace","input","getInner","cache","remember","Tag","render","getCategoriesDropdown","getLayout","BX","Landing","UI","Field","Dropdown","title","listTitle","Loc","getMessage","content","value","category","items","categories","map","onChange","onCategoryChange","bind","currentCategoryId","getValue","find","String","emit","stage","preventEvent","setValue","BaseField","CrmContent","setEventNamespace","SchemeManager","dictionary","document","schemes","addItem","getHeader","getTypesField","isDynamicAvailable","getDynamicEntitySettingsForm","getExpertSettingsForm","getOrderSettingsForm","setLastScheme","formOptions","scheme","setLastDealCategory","deal","isArrayFilled","dynamic","HeaderCard","Radio","selector","duplicateMode","getSchemeById","isOpened","endsWith","Text","toNumber","FormSettingsForm","toggleable","opened","fields","level","headerText","header","isString","setTitle","currentScheme","mainEntity","onTypeChange","BaseEvent","data","getSelectedSchemeId","hidden","getDynamicEntitiesField","toggleableType","ToggleableType","Link","getDuplicatesField","setTimeout","icon","push","isLeadEnabled","unshift","RadioButtonField","schemeId","isDefaultScheme","isInvoice","getSpecularSchemeId","isPlainObject","getDynamicSchemeById","Checkbox","compact","duplicatesEnabled","set","get","categoryId","event","getData","clear","hide","expertSettingsForm","addField","getType1Header","getType2Header","getType3Header","getDealCategoryField","getDuplicatesEnabledField","getType4Header","getType6Header","onSwitchChange","getDynamicHeader","dynamicScheme","getDynamicCategoriesField","show","MessageBox","buttons","MessageBoxButtons","OK_CANCEL","allowedEntities","entities","removedFields","presetFields","filter","presetField","includes","entityName","getCrmFieldById","fieldName","itemTemplate","encode","messageText","field","caption","length","lastField","pop","join","replaceAll","entityChangeConfirm","getEntityChangeConfirm","setOkCallback","close","getOkButton","setDisabled","getCancelButton","filteredFields","setAdditionalValue","skipPrepare","setCancelCallback","lastScheme","getLastScheme","setMessage","lastDealCategory","getLastDealCategory","dealStageField","crmField","dealCategoryChangeConfirm","getDealCategoryChangeConfirm","payment","use","createOrderMessageBox","getCreateOrderChangeConfirm","messageBox","orderSettingsSwitch","getSwitch","Object","values","crmFields","reduce","acc","FIELDS","currentField","typeId","entityId","reducedValue","toBoolean","payer","disabledSystems","getAdditionalValue","ContentWrapper"],"mappings":"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"}