{"version":3,"file":"pay-systems.bundle.js","sources":["../src/images/message-icon.svg","../src/pay-systems.js"],"sourcesContent":["export default \"/bitrix/js/landing/ui/panel/formsettingspanel/content/pay-systems/dist/images/message-icon.svg\"","import { Loc } from 'landing.loc';\nimport { HeaderCard } from 'landing.ui.card.headercard';\nimport { MessageCard } from 'landing.ui.card.messagecard';\nimport { ContentWrapper } from 'landing.ui.panel.basepresetpanel';\nimport { Dom, Tag, Text } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { PaySystemsSelectorField } from 'landing.ui.field.paysystemsselectorfield';\nimport { FormSettingsForm } from 'landing.ui.form.formsettingsform';\nimport { SchemeManager } from 'landing.ui.panel.formsettingspanel.content.crm.schememanager';\n\nimport './css/style.css';\nimport 'ui.sidepanel-content';\n\nimport messageIcon from './images/message-icon.svg';\n\nexport default class PaySystems extends ContentWrapper\n{\n\t#moduleNotIncludedErrorCode = 'MODULE_NOT_INCLUDED';\n\t#schemeManager: SchemeManager;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.PaySystemContent');\n\n\t\tthis.#schemeManager = new SchemeManager([...options.dictionary.document.schemes]);\n\n\t\tthis.addItem(this.#getHeaderCard());\n\t\tthis.addItem(this.#getMessageCard());\n\t\tthis.addItem(this.#getPaySystemsSelectorForm());\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => Tag.render`<div class=\"landing-ui-content-pay-system\"></div>`);\n\t}\n\n\t#showErrorPlaceholder(title: string, subtitle: string = ''): void\n\t{\n\t\tDom.clean(this.getLayout());\n\t\tDom.append(\n\t\t\tthis.getErrorPlaceholderLayout(title, subtitle),\n\t\t\tthis.getLayout(),\n\t\t);\n\t}\n\n\tgetErrorPlaceholderLayout(title: string, subtitle: string = ''): HTMLDivElement\n\t{\n\t\treturn this.cache.remember(`errorTitle`, () => Tag.render`\n\t\t\t<div class=\"ui-slider-no-access\">\n\t\t\t\t<div class=\"ui-slider-no-access-inner\">\n\t\t\t\t\t<div class=\"ui-slider-no-access-title\">${title}</div>\n\t\t\t\t\t<div class=\"ui-slider-no-access-subtitle\">${subtitle}</div>\n\t\t\t\t\t<div class=\"ui-slider-no-access-img\">\n\t\t\t\t\t\t<div class=\"ui-slider-no-access-img-inner\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,\n\t\t);\n\t}\n\n\t#getHeaderCard(): HeaderCard\n\t{\n\t\treturn new HeaderCard({\n\t\t\ttitle: Loc.getMessage('LANDING_FORM_PAY_SYSTEMS_TITLE'),\n\t\t});\n\t}\n\n\t#getMessageCard(): MessageCard\n\t{\n\t\treturn new MessageCard({\n\t\t\tid: 'paymentMessage',\n\t\t\theader: Loc.getMessage('LANDING_FORM_PAY_SYSTEMS_MESSAGE_HEADER'),\n\t\t\tdescription: Loc.getMessage('LANDING_FORM_PAY_SYSTEMS_MESSAGE_DESCRIPTION'),\n\t\t\ticon: messageIcon,\n\t\t\trestoreState: true,\n\t\t});\n\t}\n\n\t#getPaySystemsSelectorForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('paySystemsSelectorForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\tid: 'paySystemsForm',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_PAY_SYSTEMS_GET_PAYMENT'),\n\t\t\t\ttoggleable: true,\n\t\t\t\topened: this.options.formOptions.payment.use,\n\t\t\t\tfields: [\n\t\t\t\t\tthis.#getPaySystemsSelectorField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\t#getPaySystemsSelectorField(): PaySystemsSelectorField\n\t{\n\t\treturn this.cache.remember('paySystemSelectorField',\n\t\t\t() => new PaySystemsSelectorField({\n\t\t\t\tid: 'paySystemsSelector',\n\t\t\t\tselector: 'paySystemsSelector',\n\t\t\t\tdisabledPaySystems: [...this.options.formOptions.payment.disabledSystems],\n\t\t\t\tonFetchPaySystemsError: (errors) => this.onFetchPaySystemsError(errors),\n\t\t\t\tshowMorePaySystemsBtn: true,\n\t\t\t\tmorePaySystemsBtnSidePanelPath: this.options.dictionary.payment.moreSystemSliderPath,\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetValue(): { [p: string]: * }\n\t{\n\t\tconst schemeId = Text.toNumber(this.options.formOptions.document.scheme);\n\t\tconst usePayment = this.#getPaySystemsSelectorForm().isOpened();\n\n\t\tif (!this.#schemeManager.isInvoice(schemeId) && usePayment)\n\t\t{\n\t\t\tthis.options.formOptions.document.scheme = this.#schemeManager.getSpecularSchemeId(schemeId);\n\t\t}\n\n\t\treturn super.getValue();\n\t}\n\n\tvalueReducer(value)\n\t{\n\t\tconst paySystemsSelectorData = value.paySystemsSelector;\n\t\tconst payment = this.options.formOptions.payment;\n\t\tconst document = this.options.formOptions.document;\n\n\t\tpayment.disabledSystems = paySystemsSelectorData.disabledPaySystems;\n\t\tpayment.use = this.#getPaySystemsSelectorForm().isOpened();\n\n\t\tif (document.payment)\n\t\t{\n\t\t\tdocument.payment = { ...document.payment, ...payment };\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdocument.payment = payment;\n\t\t}\n\n\t\treturn { document };\n\t}\n\n\tonChange(event: BaseEvent): void\n\t{\n\t\tthis.emit('onChange', { skipPrepare: true });\n\t}\n\n\tonFetchPaySystemsError(errors): void\n\t{\n\t\tconst firstError = errors[0];\n\t\tif (firstError.code === this.#moduleNotIncludedErrorCode)\n\t\t{\n\t\t\tthis.#showErrorPlaceholder(firstError.message);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showErrorPlaceholder('Network error');\n\t\t}\n\t}\n}"],"names":["PaySystems","options","setEventNamespace","SchemeManager","dictionary","document","schemes","addItem","cache","remember","Tag","render","title","subtitle","schemeId","Text","toNumber","formOptions","scheme","usePayment","isOpened","isInvoice","getSpecularSchemeId","value","paySystemsSelectorData","paySystemsSelector","payment","disabledSystems","disabledPaySystems","use","event","emit","skipPrepare","errors","firstError","code","message","ContentWrapper","Dom","clean","getLayout","append","getErrorPlaceholderLayout","HeaderCard","Loc","getMessage","MessageCard","id","header","description","icon","messageIcon","restoreState","FormSettingsForm","toggleable","opened","fields","PaySystemsSelectorField","selector","onFetchPaySystemsError","showMorePaySystemsBtn","morePaySystemsBtnSidePanelPath","moreSystemSliderPath"],"mappings":"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"}