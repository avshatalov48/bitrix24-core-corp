{"version":3,"file":"pay-systems.bundle.js","sources":["../src/images/message-icon.svg","../src/pay-systems.js"],"sourcesContent":["export default \"/bitrix/js/landing/ui/panel/formsettingspanel/content/pay-systems/dist/images/message-icon.svg\"","import { Loc } from 'landing.loc';\nimport { HeaderCard } from 'landing.ui.card.headercard';\nimport { MessageCard } from 'landing.ui.card.messagecard';\nimport { ContentWrapper } from 'landing.ui.panel.basepresetpanel';\nimport { Dom, Tag, Text } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { PaySystemsSelectorField } from 'landing.ui.field.paysystemsselectorfield';\nimport { FormSettingsForm } from 'landing.ui.form.formsettingsform';\nimport { SchemeManager } from 'landing.ui.panel.formsettingspanel.content.crm.schememanager';\n\nimport './css/style.css';\nimport 'ui.sidepanel-content';\n\nimport messageIcon from './images/message-icon.svg';\n\nexport default class PaySystems extends ContentWrapper\n{\n\t#moduleNotIncludedErrorCode = 'MODULE_NOT_INCLUDED';\n\t#schemeManager: SchemeManager;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.PaySystemContent');\n\n\t\tthis.#schemeManager = new SchemeManager([...options.dictionary.document.schemes]);\n\n\t\tthis.addItem(this.#getHeaderCard());\n\t\tthis.addItem(this.#getMessageCard());\n\t\tthis.addItem(this.#getPaySystemsSelectorForm());\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('layout', () => Tag.render`<div class=\"landing-ui-content-pay-system\"></div>`);\n\t}\n\n\t#showErrorPlaceholder(title: string, subtitle: string = ''): void\n\t{\n\t\tDom.clean(this.getLayout());\n\t\tDom.append(\n\t\t\tthis.getErrorPlaceholderLayout(title, subtitle),\n\t\t\tthis.getLayout(),\n\t\t);\n\t}\n\n\tgetErrorPlaceholderLayout(title: string, subtitle: string = ''): HTMLDivElement\n\t{\n\t\treturn this.cache.remember(`errorTitle`, () => Tag.render`\n\t\t\t<div class=\"ui-slider-no-access\">\n\t\t\t\t<div class=\"ui-slider-no-access-inner\">\n\t\t\t\t\t<div class=\"ui-slider-no-access-title\">${title}</div>\n\t\t\t\t\t<div class=\"ui-slider-no-access-subtitle\">${subtitle}</div>\n\t\t\t\t\t<div class=\"ui-slider-no-access-img\">\n\t\t\t\t\t\t<div class=\"ui-slider-no-access-img-inner\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,\n\t\t);\n\t}\n\n\t#getHeaderCard(): HeaderCard\n\t{\n\t\treturn new HeaderCard({\n\t\t\ttitle: Loc.getMessage('LANDING_FORM_PAY_SYSTEMS_TITLE'),\n\t\t});\n\t}\n\n\t#getMessageCard(): MessageCard\n\t{\n\t\treturn new MessageCard({\n\t\t\tid: 'paymentMessage',\n\t\t\theader: Loc.getMessage('LANDING_FORM_PAY_SYSTEMS_MESSAGE_HEADER'),\n\t\t\tdescription: Loc.getMessage('LANDING_FORM_PAY_SYSTEMS_MESSAGE_DESCRIPTION'),\n\t\t\ticon: messageIcon,\n\t\t\trestoreState: true,\n\t\t});\n\t}\n\n\t#getPaySystemsSelectorForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('paySystemsSelectorForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\tid: 'paySystemsForm',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_PAY_SYSTEMS_GET_PAYMENT'),\n\t\t\t\ttoggleable: true,\n\t\t\t\topened: this.options.formOptions.payment.use,\n\t\t\t\tfields: [\n\t\t\t\t\tthis.#getPaySystemsSelectorField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\t#getPaySystemsSelectorField(): PaySystemsSelectorField\n\t{\n\t\treturn this.cache.remember('paySystemSelectorField',\n\t\t\t() => new PaySystemsSelectorField({\n\t\t\t\tid: 'paySystemsSelector',\n\t\t\t\tselector: 'paySystemsSelector',\n\t\t\t\tdisabledPaySystems: [...this.options.formOptions.payment.disabledSystems],\n\t\t\t\tonFetchPaySystemsError: (errors) => this.onFetchPaySystemsError(errors),\n\t\t\t\tshowMorePaySystemsBtn: true,\n\t\t\t\tmorePaySystemsBtnSidePanelPath: this.options.dictionary.payment.moreSystemSliderPath,\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetValue(): { [p: string]: * }\n\t{\n\t\tconst schemeId = Text.toNumber(this.options.formOptions.document.scheme);\n\t\tconst usePayment = this.#getPaySystemsSelectorForm().isOpened();\n\n\t\tif (!this.#schemeManager.isInvoice(schemeId) && usePayment)\n\t\t{\n\t\t\tthis.options.formOptions.document.scheme = this.#schemeManager.getSpecularSchemeId(schemeId);\n\t\t}\n\n\t\treturn super.getValue();\n\t}\n\n\tvalueReducer(value)\n\t{\n\t\tconst paySystemsSelectorData = value.paySystemsSelector;\n\t\tconst payment = this.options.formOptions.payment;\n\t\tconst document = this.options.formOptions.document;\n\n\t\tpayment.disabledSystems = paySystemsSelectorData.disabledPaySystems;\n\t\tpayment.use = this.#getPaySystemsSelectorForm().isOpened();\n\n\t\tif (document.payment)\n\t\t{\n\t\t\tdocument.payment = { ...document.payment, ...payment };\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdocument.payment = payment;\n\t\t}\n\n\t\treturn { document };\n\t}\n\n\tonChange(event: BaseEvent): void\n\t{\n\t\tthis.emit('onChange', { skipPrepare: true });\n\t}\n\n\tonFetchPaySystemsError(errors): void\n\t{\n\t\tconst firstError = errors[0];\n\t\tif (firstError.code === this.#moduleNotIncludedErrorCode)\n\t\t{\n\t\t\tthis.#showErrorPlaceholder(firstError.message);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showErrorPlaceholder('Network error');\n\t\t}\n\t}\n}"],"names":["PaySystems","options","setEventNamespace","SchemeManager","dictionary","document","schemes","addItem","cache","remember","Tag","render","title","subtitle","schemeId","Text","toNumber","formOptions","scheme","usePayment","isOpened","isInvoice","getSpecularSchemeId","value","paySystemsSelectorData","paySystemsSelector","payment","disabledSystems","disabledPaySystems","use","event","emit","skipPrepare","errors","firstError","code","message","ContentWrapper","Dom","clean","getLayout","append","getErrorPlaceholderLayout","HeaderCard","Loc","getMessage","MessageCard","id","header","description","icon","messageIcon","restoreState","FormSettingsForm","toggleable","opened","fields","PaySystemsSelectorField","selector","onFetchPaySystemsError","showMorePaySystemsBtn","morePaySystemsBtnSidePanelPath","moreSystemSliderPath"],"mappings":"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"}