(function(){"use strict";BX.namespace("BX.Landing.UI.Panel");var t=BX.Landing.Utils.proxy;var n=BX.Landing.Utils.getSelectedElement;BX.Landing.UI.Panel.EditorPanel=function(){BX.Landing.UI.Panel.BaseButtonPanel.apply(this,arguments);this.layout.classList.add("landing-ui-panel-editor");this.position="absolute";this.currentElement=null;l(this);r(this);g(this);this.rect=this.layout.getBoundingClientRect()};BX.Landing.UI.Panel.EditorPanel.instance=null;BX.Landing.UI.Panel.EditorPanel.getInstance=function(){if(!BX.Landing.UI.Panel.EditorPanel.instance){BX.Landing.UI.Panel.EditorPanel.instance=new BX.Landing.UI.Panel.EditorPanel}return BX.Landing.UI.Panel.EditorPanel.instance};var e=null;var i=null;function a(t){i=t;e=e||d.bind(null,t);document.addEventListener("keydown",s);window.addEventListener("resize",e);try{document.addEventListener("scroll",e,{passive:true})}catch(t){document.addEventListener("scroll",e)}}function o(){document.removeEventListener("keydown",s);window.removeEventListener("resize",e);try{document.removeEventListener("scroll",e,{passive:true})}catch(t){document.removeEventListener("scroll",e)}}function s(t){if(t.which===9&&t.target.nodeName!=="LI"){t.preventDefault();if(!t.shiftKey){document.execCommand("indent")}else{document.execCommand("outdent")}}if(t.which===13&&t.target.nodeName!=="LI"&&t.target.nodeName!=="UL"&&t.metaKey===true){t.preventDefault();var n=window.getSelection().getRangeAt(0);var e=BX.create("br");n.deleteContents();n.insertNode(e);n=document.createRange();n.setStartAfter(e);n.collapse(true);var a=window.getSelection();a.removeAllRanges();a.addRange(n)}setTimeout(function(){BX.Landing.UI.Panel.EditorPanel.getInstance().adjustPosition(i)},10)}function d(){BX.Landing.UI.Panel.EditorPanel.getInstance().adjustPosition(i)}function l(t){var n=new BX.Landing.UI.Button.EditorAction("drag",{html:'<strong class="landing-ui-drag">&nbsp;</strong>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_DRAG")}});n.layout.onbxdrag=o.bind(this);n.layout.onbxdragstop=s.bind(this);jsDD.registerObject(n.layout);t.prependButton(n);var e;var i;var a;function o(n,o){if(!e){var s=BX.pos(jsDD.current_node);i=Math.max(Math.abs(n-s.left),0);a=Math.max(Math.abs(o-s.top),0);e=true}BX.DOM.write(function(){t.layout.classList.remove("landing-ui-transition");t.layout.style.top=o-a+"px";t.layout.style.left=n-i+"px"}.bind(this))}function s(){e=false;t.layout.classList.add("landing-ui-transition")}}function r(n){n.addButton(new BX.Landing.UI.Button.EditorAction("bold",{html:'<span class="landing-ui-icon-editor-bold"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_BOLD")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.EditorAction("italic",{html:'<span class="landing-ui-icon-editor-italic"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_ITALIC")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.EditorAction("underline",{html:'<span class="landing-ui-icon-editor-underline"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_UNDERLINE")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.EditorAction("strikeThrough",{html:'<span class="landing-ui-icon-editor-strike"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_STRIKE")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.EditorAction("justifyLeft",{html:'<span class="landing-ui-icon-editor-left"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_ALIGN_LEFT")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.EditorAction("justifyCenter",{html:'<span class="landing-ui-icon-editor-center"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_ALIGN_CENTER")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.EditorAction("justifyRight",{html:'<span class="landing-ui-icon-editor-right"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_ALIGN_RIGHT")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.EditorAction("justifyFull",{html:'<span class="landing-ui-icon-editor-justify"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_ALIGN_JUSTIFY")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.CreateLink("createLink",{html:'<span class="landing-ui-icon-editor-link"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_CREATE_LINK")},onClick:t(n.adjustButtonsState,n)}));var e=BX.Landing.Env.getInstance().getOptions().rights;if(e.includes("edit")){n.addButton(new BX.Landing.UI.Button.CreatePage("createPage",{html:'<span class="landing-ui-icon-editor-new-page"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_CREATE_PAGE")},onClick:t(n.adjustButtonsState,n)}))}n.addButton(new BX.Landing.UI.Button.EditorAction("unlink",{html:'<span class="landing-ui-icon-editor-unlink"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_UNLINK")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.EditorAction("insertUnorderedList",{html:'<span class="fa fa-list-ul"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_UL")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.EditorAction("insertOrderedList",{html:'<span class="fa fa-list-ol"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_OL")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.EditorAction("removeFormat",{html:'<span class="landing-ui-icon-editor-eraser"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_CLEAR")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.ColorAction("foreColor",{text:BX.Landing.Loc.getMessage("EDITOR_ACTION_SET_FORE_COLOR"),attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_COLOR")},onClick:t(n.adjustButtonsState,n)}));n.addButton(new BX.Landing.UI.Button.TextBackgroundAction("hiliteColor",{html:'<span class="landing-ui-icon-editor-text-background"></span>',attrs:{title:BX.Landing.Loc.getMessage("LANDING_TITLE_OF_EDITOR_ACTION_TEXT_BACKGROUND")},onClick:t(n.adjustButtonsState,n)}))}var u={top:0,left:0};function c(t,n,e){var i=n.getBoundingClientRect();var a=i.left+i.width/2-t.rect.width/2;var o=i.top-t.rect.height-4;var s="absolute";var d=n.closest(".landing-ui-panel-content-body-content");if(d){o=d.getBoundingClientRect().top+5;s="fixed"}else{if(o<=5&&(i.bottom>window.innerHeight||i.height>window.innerHeight/1.5)){o=5;s="fixed"}else{if(o>5){o+=window.pageYOffset}else{o=i.bottom+4+window.pageYOffset}}}if(a+t.rect.width>window.innerWidth-20){a-=a+t.rect.width-(window.innerWidth-20)}a=Math.max(20,a);if(u.top!==o||u.left!==a||e){BX.DOM.write(function(){t.layout.style.position=s;t.layout.style.top=o+"px";t.layout.style.left=a+"px"});u.top=o;u.left=a;_(t)}}function g(t){document.body.appendChild(t.layout)}var L=null;function B(t){L=t.target}var h=false;function I(t){h=L!==t.target}function f(t){if(h){t.preventDefault();t.stopPropagation()}}function E(t){if(t.popup){t.popup.close()}if(t.menu){t.menu.close()}}function _(t){t.buttons.forEach(E);if(t.additionalButtons){t.additionalButtons.forEach(E)}BX.Landing.UI.Tool.ColorPicker.hideAll()}BX.Landing.UI.Panel.EditorPanel.prototype={constructor:BX.Landing.UI.Panel.EditorPanel,__proto__:BX.Landing.UI.Panel.BaseButtonPanel.prototype,show:function(n,e,i){this.currentElement=n;if(this.additionalButtons){this.additionalButtons.forEach(function(t){this.buttons.remove(t);E(t);BX.remove(t.layout)},this);this.additionalButtons=null}if(i){this.additionalButtons=i;this.additionalButtons.forEach(function(t){if(t.insertAfter){var n=this.layout.querySelector('[data-id="'+t.insertAfter+'"]');if(n){BX.insertAfter(t.layout,n);this.buttons.add(t)}}else{this.addButton(t)}},this)}if(!this.isShown()){BX.onCustomEvent("BX.Landing.Editor:enable",[n]);document.addEventListener("mousedown",B,true);document.addEventListener("mouseup",I,true);document.addEventListener("click",f,true);this.currentElement.addEventListener("click",t(this.adjustButtonsState,this),true);setTimeout(function(){this.layout.classList.add("landing-ui-transition")}.bind(this),100)}BX.Landing.UI.Panel.BaseButtonPanel.prototype.show.call(this,arguments);BX.DOM.write(function(){this.rect=this.layout.getBoundingClientRect();this.adjustPosition(n,e,true)}.bind(this));a(n);this.adjustButtonsState()},hide:function(){if(this.isShown()){BX.onCustomEvent("BX.Landing.Editor:disable",[null]);document.removeEventListener("mousedown",B,true);document.removeEventListener("mouseup",I,true);document.removeEventListener("click",f,true);this.currentElement.removeEventListener("click",t(this.adjustButtonsState,this),true);setTimeout(function(){this.rect=this.layout.getBoundingClientRect();this.layout.classList.remove("landing-ui-transition")}.bind(this),100)}BX.Landing.UI.Panel.BaseButtonPanel.prototype.hide.call(this,arguments);o()},adjustButtonsState:function(){var t=function(t){return(!t?"de":"")+"activate"};var n=function(t){return this.buttons.get(t)}.bind(this);requestAnimationFrame(function(){var e=this.getFormat();void(n("bold")&&n("bold")[t(e.bold)]());void(n("italic")&&n("italic")[t(e.italic)]());void(n("underline")&&n("underline")[t(e.underline)]());void(n("strikeThrough")&&n("strikeThrough")[t(e.strike)]());void(n("justifyLeft")&&n("justifyLeft")[t(e.align==="left")]());void(n("justifyCenter")&&n("justifyCenter")[t(e.align==="center")]());void(n("justifyRight")&&n("justifyRight")[t(e.align==="right")]());void(n("justifyFull")&&n("justifyFull")[t(e.align==="justify")]())}.bind(this))},getFormat:function(){var t=n();var e={};if(t){var i=getComputedStyle(t);switch(i.getPropertyValue("font-weight")){case"bold":case"bolder":case"500":case"600":case"700":case"800":case"900":e["bold"]=true;break}if(i.getPropertyValue("font-style")==="italic"){e["italic"]=true}if(i.getPropertyValue("text-decoration").includes("underline")||i.getPropertyValue("text-decoration-line").includes("underline")){e["underline"]=true}if(i.getPropertyValue("text-decoration").includes("line-through")||i.getPropertyValue("text-decoration-line").includes("line-through")){e["strike"]=true}var a=i.getPropertyValue("text-align")||"left";if(a.match(/[left|center|rigth|custiffy]/)){e["align"]=a}if(this.currentElement.nodeName==="A"||this.currentElement.closest("a")){e["link"]=true}}return e},adjustPosition:function(t,n,e){c(this,t,e)},isFixed:function(){return this.position==="fixed-top"||this.position==="fixed-right"}}})();
//# sourceMappingURL=editor_panel.map.js