(function(){"use strict";BX.namespace("BX.Landing.UI.Panel");var n=BX.Landing.Utils.addClass;var e=BX.Landing.Utils.removeClass;var i=BX.Landing.Utils.append;var t=BX.Landing.Utils.onCustomEvent;var a=BX.Landing.Utils.setTextContent;var r=BX.Landing.Utils.create;var s=BX.Landing.Utils.style;var o=BX.Landing.Utils.isNumber;var d=BX.Landing.Utils.isString;var c=BX.Landing.Utils.isPlainObject;var h=BX.Landing.Utils.isArray;var l=BX.Landing.Utils.addQueryParams;var u="landing";var L="block";var g="system";var f=BX.Landing.UI.Button.SidebarButton;BX.Landing.UI.Panel.URLList=function(e,a){BX.Landing.UI.Panel.Content.apply(this,arguments);n(this.layout,"landing-ui-panel-url-list");n(this.overlay,"landing-ui-panel-url-list-overlay");n(this.overlay,"landing-ui-hide");this.overlay.hidden=true;this.overlay.dataset.isShown="false";t("BX.Landing.Block:init",this.refresh.bind(this));t("BX.Landing.Block:remove",this.refresh.bind(this));i(this.layout,document.body);this.loader=new BX.Loader({target:this.content});this.promiseResolve=function(){};this.layout.hidden=true;this.isNeedLoad=true;this.cache=new BX.Cache.MemoryCache};BX.Landing.UI.Panel.URLList.getInstance=function(){if(!BX.Landing.UI.Panel.URLList.instance){BX.Landing.UI.Panel.URLList.instance=new BX.Landing.UI.Panel.URLList("url_list")}return BX.Landing.UI.Panel.URLList.instance};BX.Landing.UI.Panel.URLList.instance=null;BX.Landing.UI.Panel.URLList.prototype={constructor:BX.Landing.UI.Panel.URLList,__proto__:BX.Landing.UI.Panel.Content.prototype,refresh:function(){this.isNeedLoad=true},showLoader:function(){this.loader.show(this.content)},show:function(n,i){this.showOptions=i;BX.Landing.UI.Panel.Content.prototype.show.call(this);this.clear();this.showLoader();if(n===u){e(this.layout,"landing-ui-panel-url-list-blocks");a(this.title,i.panelTitle||BX.Landing.Loc.getMessage("LANDING_LINKS_LANDINGS_TITLE"));this.showSites(i)}else{a(this.title,i.panelTitle||BX.Landing.Loc.getMessage("LANDING_LINKS_BLOCKS_TITLE"));this.showBlocks(i)}return new Promise(function(n){this.promiseResolve=n}.bind(this))},showSites:function(n){var e=n.siteId;void s(this.layout,{width:null});void BX.Landing.Backend.getInstance().getSites(n).then(function(i){this.appendSidebarButton(new f("current_site",{text:BX.Landing.Loc.getMessage("LANDING_LINKS_PANEL_CURRENT_SITE")}));i.forEach(function(i){if(parseInt(i.ID)==e){this.appendSidebarButton(new f(i.ID,{text:i.TITLE,onClick:this.onSiteClick.bind(this,i.ID,n.enableAreas),child:true,active:true}))}},this);BX.Landing.Backend.getInstance().getLandings({siteId:e}).then(function(e){e.forEach(function(e){if(!e.IS_AREA||e.IS_AREA&&n.enableAreas){this.appendCard(new BX.Landing.UI.Card.LandingPreviewCard({title:e.TITLE,description:e.DESCRIPTION,preview:e.PREVIEW,onClick:this.onLandingClick.bind(this,e.ID,e.TITLE)}))}},this);this.loader.hide()}.bind(this));if(!n.currentSiteOnly){this.appendSidebarButton(new f("my_sites",{text:BX.Landing.Loc.getMessage("LANDING_LINKS_PANEL_MY_SITES")}));i.forEach(function(e){this.appendSidebarButton(new f(e.ID,{text:e.TITLE,onClick:this.onSiteClick.bind(this,e.ID,n.enableAreas),child:true}))},this)}}.bind(this))},createCurrentSiteButton:function(){return new f("current_site",{text:BX.Landing.Loc.getMessage("LANDING_LINKS_PANEL_CURRENT_SITE")})},showBlocks:function(n){var e=n.landingId;var i=n.siteId;void s(this.layout,{width:"880px"});BX.Landing.Backend.getInstance().getSites(n).then(function(n){this.appendSidebarButton(this.createCurrentSiteButton());var e=n.map(function(n){return n.ID},this);return BX.Landing.Backend.getInstance().getLandings({siteId:e}).then(function(e){return n.reduce(function(n,i,t){var a=e.filter(function(n){return i.ID===n.SITE_ID});n[i.ID]={site:i,landings:a};return n},{})})}.bind(this)).then(function(t){t[i].landings.forEach(function(i){var t=parseInt(i.ID)===parseInt(e);if(!n.currentPageOnly||t){var a=this.createLandingSidebarButton(i,t);this.appendSidebarButton(a);if(t){a.layout.click()}}},this);if(!n.currentPageOnly){Object.keys(t).forEach(function(n){if(parseInt(n)!==parseInt(i)){var e=t[n].site;this.appendSidebarButton(this.createSiteSidebarButton(e));t[n].landings.forEach(function(n){this.appendSidebarButton(this.createLandingSidebarButton(n))},this)}},this)}}.bind(this))},createLandingSidebarButton:function(n,e){return new f(n.ID,{text:n.TITLE,onClick:this.onLandingChange.bind(this,n),child:true,active:e})},createSiteSidebarButton:function(n){return new f(n.ID,{text:n.TITLE,child:false,active:false})},onLandingChange:function(n,e){this.currentSelectedLanding=n;this.sidebarButtons.forEach(function(n){if(n.layout===e.currentTarget){n.activate();return}n.deactivate()});this.showPreviewLoader().then(this.createIframeIfNeed()).then(this.loadPreviewSrc(this.buildLandingPreviewUrl(n))).then(this.hidePreviewLoader())},buildLandingPreviewUrl:function(n){var e=BX.Landing.Main.getInstance().options.params.sef_url.landing_view;e=e.replace("#site_show#",n.SITE_ID);e=e.replace("#landing_edit#",n.ID);return l(e,{forceLoad:true,landing_mode:"edit"})},loadPreviewSrc:function(n){return function(){return new Promise(function(e){if(this.previewFrame.src!==n){this.previewFrame.src=n;this.previewFrame.onload=function(){var n=this.previewFrame.contentDocument;BX.Landing.Utils.removePanels(n);[].slice.call(n.querySelectorAll(".block-wrapper")).forEach(function(n){n.classList.add("landing-ui-block-selectable-overlay");n.addEventListener("click",function(e){e.preventDefault();this.onBlockClick(parseInt(n.id.replace("block","")),e)}.bind(this))},this);e(this.previewFrame)}.bind(this);return}e(this.previewFrame)}.bind(this))}.bind(this)},showPreviewLoader:function(){if(!this.loader){this.loader=new BX.Loader}if(this.previewFrameWrapper){void s(this.previewFrameWrapper,{opacity:0})}return new Promise(function(n){void this.loader.show(this.content);n()}.bind(this))},hidePreviewLoader:function(){return function(){void s(this.previewFrameWrapper,{opacity:null});return this.loader.hide()}.bind(this)},createIframeIfNeed:function(){return function(){new Promise(function(n){if(!this.previewFrame){this.previewFrame=r("iframe",{});this.previewFrameWrapper=r("div",{attrs:{style:"width: 100%; height: 100%; overflow: hidden;"}});this.previewFrameWrapper.appendChild(this.previewFrame);this.content.innerHTML="";this.content.appendChild(this.previewFrameWrapper);this.showPreviewLoader();requestAnimationFrame(function(){var n=this.content.clientWidth-40;void s(this.previewFrame,{width:"1000px",height:"calc((100vh - 113px) * (100 / "+n/1e3*100+"))",transform:"scale("+n/1e3+") translateZ(0)","transform-origin":"top left",border:"none"})}.bind(this))}n(this.previewFrame)}.bind(this))}.bind(this)},onBlockClick:function(n,e){if(e.isTrusted){void BX.Landing.Backend.getInstance().getBlocks({landingId:this.currentSelectedLanding.ID}).then(function(e){var i=e.find(function(e){return e.id===n});if(i){this.onChange({type:L,id:i.id,name:i.name,alias:i.alias})}}.bind(this))}},onLandingClick:function(n,e){this.onChange({type:u,id:n,name:e})},onSystemClick:function(n,e){this.onChange({type:g,id:"_"+n,name:e})},onSiteClick:function(n,e,i){this.sidebarButtons.forEach(function(n){if(n.layout===i.currentTarget){n.activate()}else{n.deactivate()}});this.content.innerHTML="";this.showLoader();BX.Landing.Backend.getInstance().getLandings({siteId:n}).then(function(n){n.forEach(function(n){if(!n.IS_AREA||n.IS_AREA&&e){this.appendCard(this.createLandingPreview(n))}},this);this.loader.hide()}.bind(this))},createLandingPreview:function(n){return new BX.Landing.UI.Card.LandingPreviewCard({title:n.TITLE,description:n.DESCRIPTION,preview:n.PREVIEW,onClick:this.onLandingClick.bind(this,n.ID,n.TITLE)})},createBlockPreview:function(n){return new BX.Landing.UI.Card.BlockHTMLPreview({content:n.id,onClick:this.onBlockClick.bind(this,n.id,n.name,n.alias)})},getLanding:function(n,e){var i=JSON.stringify(["getLanding"+n,e]);return this.cache.remember(i,function(){return BX.Landing.Backend.getInstance().action("Landing::getList",{params:{filter:{ID:n},get_preview:true}}).then(function(n){return n}.bind(this))}.bind(this))},getBlock:function(n){var e="getBlocks"+n;return this.cache.remember(e,function(){return BX.Landing.Backend.getInstance().action("Block::getById",{block:n,params:{edit_mode:true}}).then(function(n){return n}.bind(this))}.bind(this))},onChange:function(n){this.promiseResolve(n);this.hide()},hide:function(){this.previewFrame=null;return BX.Landing.UI.Panel.Content.prototype.hide.call(this)}}})();
//# sourceMappingURL=url_list.map.js