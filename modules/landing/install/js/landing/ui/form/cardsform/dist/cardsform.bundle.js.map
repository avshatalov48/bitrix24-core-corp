{"version":3,"file":"cardsform.bundle.js","sources":["../src/cardsform.js"],"sourcesContent":["import {BaseForm} from 'landing.ui.form.baseform';\nimport {FormCollection} from 'landing.ui.collection.formcollection';\nimport {Loc} from 'landing.loc';\nimport {Content} from 'landing.ui.panel.content';\nimport {Dom, Runtime, Text, Type, Event} from 'main.core';\nimport {CardForm} from 'landing.ui.form.cardform';\nimport {Draggable} from 'ui.draganddrop.draggable';\nimport {PageObject} from 'landing.pageobject';\nimport {BaseEvent} from 'main.core.events';\nimport {TextField} from 'landing.ui.field.textfield';\n\nimport './css/cards_form.css';\n\nexport class CardsForm extends BaseForm\n{\n\tconstructor(options = {})\n\t{\n\t\tsuper(options);\n\n\t\tDom.addClass(this.layout, 'landing-ui-form-cards');\n\t\tthis.type = 'cards';\n\t\tthis.code = options.code;\n\t\tthis.id = `${this.code.replace('.', '')}-${Text.getRandom()}`;\n\t\tthis.presets = options.presets;\n\t\tthis.childForms = new FormCollection();\n\t\tthis.presetForm = new FormCollection();\n\t\tthis.sync = options.sync;\n\t\tthis.forms = options.forms;\n\t\tthis.wheelEventName = window.onwheel ? 'wheel' : 'mousewheel';\n\n\t\tthis.onFormRemove = this.onFormRemove.bind(this);\n\t\tthis.onAddCardClick = this.onAddCardClick.bind(this);\n\t\tthis.onMouseWheel = this.onMouseWheel.bind(this);\n\t\tthis.onDragEnd = this.onDragEnd.bind(this);\n\n\t\tthis.addButton = this.createAddButton();\n\t\tthis.draggable = new Draggable({\n\t\t\tcontainer: this.body,\n\t\t\tdraggable: '.landing-ui-form-cards-item',\n\t\t\tdragElement: '.landing-ui-form-card-item-header-drag',\n\t\t\ttype: Draggable.MOVE,\n\t\t});\n\n\t\tthis.draggable.subscribe('end', this.onDragEnd);\n\n\t\tsetTimeout(() => {\n\t\t\tthis.value = this.serialize();\n\t\t});\n\n\t\tthis.adjustLastFormState();\n\t\tDom.append(this.addButton.layout, this.footer);\n\t}\n\n\tcreateAddButton(): BX.Landing.UI.Button.BaseButton\n\t{\n\t\treturn new BX.Landing.UI.Button.BaseButton(`add-card-${Text.getRandom()}`, {\n\t\t\tclassName: 'landing-ui-card-add-button',\n\t\t\ttext: Loc.getMessage('LANDING_CARDS_FORM_ADD_BUTTON'),\n\t\t\tonClick: this.onAddCardClick,\n\t\t});\n\t}\n\n\tonFormRemove(event: BaseEvent)\n\t{\n\t\tthis.childForms.remove(event.getTarget());\n\t\tthis.sortForms();\n\t\tthis.adjustLastFormState();\n\t}\n\n\tonDragEnd()\n\t{\n\t\t// @todo: Need add sort:end event for Draggable\n\t\tsetTimeout(() => {\n\t\t\tthis.sortForms();\n\t\t});\n\t}\n\n\tsortForms()\n\t{\n\t\tconst children = [...this.body.children];\n\n\t\tthis.childForms.sort((a, b) => {\n\t\t\tconst aIndex = parseInt(children.indexOf(a.wrapper));\n\t\t\tconst bIndex = parseInt(children.indexOf(b.wrapper));\n\t\t\treturn aIndex < bIndex ? -1 : 1;\n\t\t});\n\n\t\tthis.childForms.forEach((form, index) => {\n\t\t\tconst [code, oldIndex] = form.selector.split('@');\n\t\t\tform.oldIndex = Text.toNumber(oldIndex);\n\t\t\tform.selector = `${code}@${index}`;\n\t\t});\n\t}\n\n\taddChildForm(form: CardForm)\n\t{\n\t\tthis.childForms.add(form);\n\t\tform.subscribe('onRemove', this.onFormRemove);\n\n\t\tDom.append(form.wrapper, this.body);\n\t\tthis.adjustLastFormState();\n\t}\n\n\taddPresetForm(form)\n\t{\n\t\tthis.presetForm.add(form);\n\t\tform.wrapper.hidden = true;\n\t\tDom.append(form.wrapper, this.body);\n\t\tthis.adjustLastFormState();\n\t}\n\n\tonAddCardClick()\n\t{\n\t\tif (Type.isPlainObject(this.presets) && Object.keys(this.presets).length > 0)\n\t\t{\n\t\t\tthis.showPresetsPopup();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addEmptyCard();\n\t\t}\n\t}\n\n\tonPresetItemClick(presetId)\n\t{\n\t\tconst preset = this.presets[presetId];\n\n\t\tconst newForm = this.presetForm.find((form) => {\n\t\t\treturn form.preset.id === presetId;\n\t\t}).clone();\n\n\t\tnewForm.selector = `${newForm.selector.split('@')[0]}@${this.childForms.length}`;\n\t\tnewForm.oldIndex = this.childForms.length;\n\t\tnewForm.preset = Runtime.clone(preset);\n\t\tnewForm.preset.id = presetId;\n\t\tthis.addChildForm(newForm);\n\t\tthis.adjustLastFormState();\n\t\tthis.popup.close();\n\n\t\tif (Type.isPlainObject(preset.values))\n\t\t{\n\t\t\tnewForm.fields.forEach((field) => {\n\t\t\t\tconst code = field.selector.split('@')[0];\n\n\t\t\t\tif (code in preset.values)\n\t\t\t\t{\n\t\t\t\t\tfield.setValue(preset.values[code]);\n\n\t\t\t\t\tif (field instanceof TextField)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.fireEvent(field.input, 'input');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (Type.isArray(preset.disallow))\n\t\t\t\t{\n\t\t\t\t\tconst isDisallow = !!preset.disallow.find((fieldCode) => {\n\t\t\t\t\t\treturn code === fieldCode;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (isDisallow)\n\t\t\t\t\t{\n\t\t\t\t\t\tfield.layout.hidden = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowPresetsPopup()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = new BX.PopupMenuWindow({\n\t\t\t\tid: 'catalog_blocks_list',\n\t\t\t\tbindElement: this.addButton.layout,\n\t\t\t\titems: Object.keys(this.presets).map((preset) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttext: this.presets[preset].name,\n\t\t\t\t\t\tclassName: 'landing-ui-form-cards-preset-popup-item menu-popup-no-icon',\n\t\t\t\t\t\tonclick: this.onPresetItemClick.bind(this, preset),\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tautoHide: true,\n\t\t\t\tmaxHeight: 176,\n\t\t\t\tminHeight: 87,\n\t\t\t});\n\n\t\t\tEvent.bind(this.popup.popupWindow.popupContainer, 'mouseover', this.onMouseOver.bind(this));\n\t\t\tEvent.bind(this.popup.popupWindow.popupContainer, 'mouseleave', this.onMouseLeave.bind(this));\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\tEvent.bind(rootWindow.document, 'click', this.onDocumentClick.bind(this));\n\t\t\tDom.append(\n\t\t\t\tthis.popup.popupWindow.popupContainer,\n\t\t\t\tthis.addButton.layout.closest('.landing-ui-panel-content-body-content'),\n\t\t\t);\n\t\t}\n\n\t\tif (this.popup.popupWindow.isShown())\n\t\t{\n\t\t\tthis.popup.popupWindow.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.popup.popupWindow.show();\n\t\t}\n\n\t\tthis.adjustPopupPosition();\n\t}\n\n\tonMouseOver()\n\t{\n\t\tconst container = this.popup.popupWindow.getPopupContainer();\n\t\tEvent.bind(container, this.wheelEventName, this.onMouseWheel, true);\n\t\tEvent.bind(container, 'touchmove', this.onMouseWheel, true);\n\t}\n\n\tonMouseLeave()\n\t{\n\t\tconst container = this.popup.popupWindow.getPopupContainer();\n\t\tEvent.unbind(container, this.wheelEventName, this.onMouseWheel, true);\n\t\tEvent.unbind(container, 'touchmove', this.onMouseWheel, true);\n\t}\n\n\tonMouseWheel(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tconst delta = Content.getDeltaFromEvent(event);\n\t\tconst {scrollTop} = this.popup.popupWindow.getContentContainer();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.popup.popupWindow.contentContainer.scrollTop = scrollTop - delta.y;\n\t\t});\n\t}\n\n\tonDocumentClick()\n\t{\n\t\tif (this.popup.popupWindow)\n\t\t{\n\t\t\tthis.popup.popupWindow.close();\n\t\t}\n\t}\n\n\tadjustPopupPosition()\n\t{\n\t\tif (this.popup.popupWindow)\n\t\t{\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tconst offsetParent = this.addButton.layout.closest('.landing-ui-panel-content-body-content');\n\n\t\t\t\tconst buttonTop = BX.Landing.Utils.offsetTop(this.addButton.layout, offsetParent);\n\t\t\t\tconst buttonLeft = BX.Landing.Utils.offsetLeft(this.addButton.layout, offsetParent);\n\t\t\t\tconst buttonRect = this.addButton.layout.getBoundingClientRect();\n\t\t\t\tconst popupRect = this.popup.popupWindow.popupContainer.getBoundingClientRect();\n\n\t\t\t\tconst yOffset = 14;\n\n\t\t\t\tthis.popup.popupWindow.popupContainer.style.top = `${buttonTop + buttonRect.height + yOffset}px`;\n\t\t\t\tthis.popup.popupWindow.popupContainer.style.left = `${buttonLeft - (popupRect.width / 2) + (buttonRect.width / 2)}px`;\n\t\t\t\tthis.popup.popupWindow.setAngle({\n\t\t\t\t\toffset: 83,\n\t\t\t\t\tposition: 'top',\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\taddEmptyCard()\n\t{\n\t\tconst newData = Runtime.clone(this.childForms[0].data);\n\t\tconst newSelector = `${newData.selector.split('@')[0]}@${this.childForms.length}`;\n\t\tnewData.selector = newSelector;\n\t\tconst newForm = this.childForms[0].clone(newData);\n\t\tnewForm.oldIndex = this.childForms.length;\n\t\tnewForm.selector = newSelector;\n\t\tnewForm.fields.forEach((field) => field.reset());\n\t\tthis.addChildForm(newForm);\n\t\tthis.adjustLastFormState();\n\t}\n\n\tgetVisibleForms()\n\t{\n\t\treturn [...this.body.children].filter((item) => {\n\t\t\treturn !item.hidden;\n\t\t});\n\t}\n\n\tadjustLastFormState()\n\t{\n\t\tconst visibleItems = this.getVisibleForms();\n\n\t\tif (visibleItems.length === 1)\n\t\t{\n\t\t\tDom.addClass(visibleItems[0], 'landing-ui-disallow-remove');\n\t\t\treturn;\n\t\t}\n\n\t\t[...visibleItems].forEach((item) => {\n\t\t\tDom.removeClass(item, 'landing-ui-disallow-remove');\n\t\t});\n\t}\n\n\tserialize()\n\t{\n\t\treturn this.childForms.map((form) => {\n\t\t\treturn form.serialize();\n\t\t});\n\t}\n\n\t/**\n\t * Gets indexes map\n\t * @return {Object}\n\t */\n\tgetIndexesMap()\n\t{\n\t\treturn this.childForms.reduce((acc, form, index) => {\n\t\t\treturn {...acc, [index]: form.oldIndex};\n\t\t}, {});\n\t}\n\n\tgetUsedPresets()\n\t{\n\t\treturn this.childForms.reduce((acc, form) => {\n\t\t\tif (Type.isPlainObject(form.preset))\n\t\t\t{\n\t\t\t\tconst [, index] = form.selector.split('@');\n\t\t\t\tacc[index] = form.preset.id;\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\tisChanged()\n\t{\n\t\treturn JSON.stringify(this.value) !== JSON.stringify(this.serialize());\n\t}\n}"],"names":["CardsForm","options","Dom","addClass","layout","type","code","id","replace","Text","getRandom","presets","childForms","FormCollection","presetForm","sync","forms","wheelEventName","window","onwheel","onFormRemove","bind","onAddCardClick","onMouseWheel","onDragEnd","addButton","createAddButton","draggable","Draggable","container","body","dragElement","MOVE","subscribe","setTimeout","value","serialize","adjustLastFormState","append","footer","BX","Landing","UI","Button","BaseButton","className","text","Loc","getMessage","onClick","event","remove","getTarget","sortForms","children","sort","a","b","aIndex","parseInt","indexOf","wrapper","bIndex","forEach","form","index","selector","split","oldIndex","toNumber","add","hidden","Type","isPlainObject","Object","keys","length","showPresetsPopup","addEmptyCard","presetId","preset","newForm","find","clone","Runtime","addChildForm","popup","close","values","fields","field","setValue","TextField","fireEvent","input","isArray","disallow","isDisallow","fieldCode","PopupMenuWindow","bindElement","items","map","name","onclick","onPresetItemClick","autoHide","maxHeight","minHeight","Event","popupWindow","popupContainer","onMouseOver","onMouseLeave","rootWindow","PageObject","getRootWindow","document","onDocumentClick","closest","isShown","show","adjustPopupPosition","getPopupContainer","unbind","stopPropagation","preventDefault","delta","Content","getDeltaFromEvent","getContentContainer","scrollTop","requestAnimationFrame","contentContainer","y","offsetParent","buttonTop","Utils","offsetTop","buttonLeft","offsetLeft","buttonRect","getBoundingClientRect","popupRect","yOffset","style","top","height","left","width","setAngle","offset","position","newData","data","newSelector","reset","filter","item","visibleItems","getVisibleForms","removeClass","reduce","acc","JSON","stringify","BaseForm"],"mappings":"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"}