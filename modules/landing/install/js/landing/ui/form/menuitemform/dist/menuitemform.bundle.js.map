{"version":3,"file":"menuitemform.bundle.js","sources":["../src/menuitemform.js"],"sourcesContent":["import {Dom, Text, Type, Tag, Cache, Event} from 'main.core';\nimport {BaseForm} from 'landing.ui.form.baseform';\nimport './css/style.css';\n\nconst depthKey = Symbol('depth');\nconst onHeaderClick = Symbol('onHeaderClick');\nconst onTextChange = Symbol('onTextChange');\n\n/**\n * @memberOf BX.Landing.UI.Form\n */\nexport class MenuItemForm extends BaseForm\n{\n\tconstructor(options = {})\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Form.MenuItemForm');\n\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis[onHeaderClick] = this[onHeaderClick].bind(this);\n\t\tthis[onTextChange] = this[onTextChange].bind(this);\n\t\tthis.onRemoveButtonClick = this.onRemoveButtonClick.bind(this);\n\n\t\tDom.addClass(this.layout, 'landing-ui-form-menuitem');\n\t\tDom.append(this.getHeaderLeftLayout(), this.header);\n\t\tDom.append(this.getHeaderRightLayout(), this.header);\n\n\t\tthis.setDepth(options.depth);\n\n\t\tconst [firstField: BX.Landing.UI.Field.Link] = this.fields;\n\t\tif (firstField)\n\t\t{\n\t\t\tconst {text} = firstField.getValue();\n\t\t\tthis.setTitle(text);\n\n\t\t\tEvent.bind(firstField.input.input, 'input', this[onTextChange]);\n\t\t}\n\n\t\tEvent.bind(this.getHeader(), 'click', this[onHeaderClick]);\n\t}\n\n\t[onHeaderClick](event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (this.isFormShown())\n\t\t{\n\t\t\tthis.hideForm();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showForm();\n\t\t}\n\t}\n\n\t[onTextChange]()\n\t{\n\t\tconst [firstField: BX.Landing.UI.Field.Link] = this.fields;\n\t\tif (firstField)\n\t\t{\n\t\t\tconst {text} = firstField.getValue();\n\t\t\tthis.setTitle(text);\n\t\t}\n\t}\n\n\tonRemoveButtonClick()\n\t{\n\t\tthis.emit('remove', {form: this});\n\t\tDom.remove(this.layout);\n\t}\n\n\tshowForm()\n\t{\n\t\tDom.addClass(this.layout, 'landing-ui-form-menuitem-open');\n\t\tDom.style(this.body, 'display', 'block');\n\t}\n\n\thideForm()\n\t{\n\t\tDom.removeClass(this.layout, 'landing-ui-form-menuitem-open');\n\t\tDom.style(this.body, 'display', null);\n\t}\n\n\tisFormShown(): boolean\n\t{\n\t\treturn Dom.style(this.body, 'display') !== 'none';\n\t}\n\n\tgetDragButton(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('dragButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-form-header-drag-button landing-ui-drag\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('titleLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-form-header-title\">${Text.encode(this.title)}</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetHeaderLeftLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerLeftLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-form-header-left\">\n\t\t\t\t\t${this.getDragButton()}\n\t\t\t\t\t${this.getTitleLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetRemoveButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\tconst button = Tag.render`<div class=\"landing-ui-form-header-remove-button\"></div>`;\n\t\t\tEvent.bind(button, 'click', this.onRemoveButtonClick);\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tgetHeaderRightLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerRightLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-form-header-right\">\n\t\t\t\t\t${this.getRemoveButton()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tsetTitle(title: string)\n\t{\n\t\tif (Type.isString(title) || Type.isNumber(title))\n\t\t{\n\t\t\tthis.title = title;\n\t\t\tthis.getTitleLayout().innerText = Text.decode(title);\n\t\t}\n\t}\n\n\tsetDepth(depth: number)\n\t{\n\t\tconst offset = 20;\n\t\tthis[depthKey] = Text.toNumber(depth);\n\t\tDom.style(this.layout, 'margin-left', `${depth * offset}px`);\n\t\tDom.attr(this.layout, 'data-depth', depth);\n\t}\n\n\tgetDepth(): number\n\t{\n\t\treturn Text.toNumber(Dom.attr(this.layout, 'data-depth'));\n\t}\n\n\tserialize()\n\t{\n\t\tconst [firstField: BX.Landing.UI.Field.Link] = this.fields;\n\t\treturn firstField.getValue();\n\t}\n}"],"names":["depthKey","Symbol","onHeaderClick","onTextChange","MenuItemForm","options","setEventNamespace","cache","Cache","MemoryCache","bind","onRemoveButtonClick","Dom","addClass","layout","append","getHeaderLeftLayout","header","getHeaderRightLayout","setDepth","depth","fields","firstField","getValue","text","setTitle","Event","input","getHeader","event","preventDefault","isFormShown","hideForm","showForm","emit","form","remove","style","body","removeClass","remember","Tag","render","Text","encode","title","getDragButton","getTitleLayout","button","getRemoveButton","Type","isString","isNumber","innerText","decode","offset","toNumber","attr","BaseForm"],"mappings":"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"}