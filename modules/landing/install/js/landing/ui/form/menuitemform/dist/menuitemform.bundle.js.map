{"version":3,"file":"menuitemform.bundle.js","sources":["../src/menuitemform.js"],"sourcesContent":["import {Dom, Text, Type, Tag, Cache, Event} from 'main.core';\nimport {BaseForm} from 'landing.ui.form.baseform';\nimport 'ui.fonts.opensans';\nimport './css/style.css';\n\nconst depthKey = Symbol('depth');\nconst onHeaderClick = Symbol('onHeaderClick');\nconst onTextChange = Symbol('onTextChange');\n\n/**\n * @memberOf BX.Landing.UI.Form\n */\nexport class MenuItemForm extends BaseForm\n{\n\tconstructor(options = {})\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Form.MenuItemForm');\n\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis[onHeaderClick] = this[onHeaderClick].bind(this);\n\t\tthis[onTextChange] = this[onTextChange].bind(this);\n\t\tthis.onRemoveButtonClick = this.onRemoveButtonClick.bind(this);\n\n\t\tDom.addClass(this.layout, 'landing-ui-form-menuitem');\n\t\tDom.append(this.getHeaderLeftLayout(), this.header);\n\t\tDom.append(this.getHeaderRightLayout(), this.header);\n\n\t\tthis.setDepth(options.depth);\n\n\t\tconst [firstField: BX.Landing.UI.Field.Link] = this.fields;\n\t\tif (firstField)\n\t\t{\n\t\t\tconst {text} = firstField.getValue();\n\t\t\tthis.setTitle(text);\n\n\t\t\tEvent.bind(firstField.input.input, 'input', this[onTextChange]);\n\t\t}\n\n\t\tEvent.bind(this.getHeader(), 'click', this[onHeaderClick]);\n\t}\n\n\t[onHeaderClick](event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (this.isFormShown())\n\t\t{\n\t\t\tthis.hideForm();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showForm();\n\t\t}\n\t}\n\n\t[onTextChange]()\n\t{\n\t\tconst [firstField: BX.Landing.UI.Field.Link] = this.fields;\n\t\tif (firstField)\n\t\t{\n\t\t\tconst {text} = firstField.getValue();\n\t\t\tthis.setTitle(text);\n\t\t}\n\t}\n\n\tonRemoveButtonClick()\n\t{\n\t\tthis.emit('remove', {form: this});\n\t\tDom.remove(this.layout);\n\t}\n\n\tshowForm()\n\t{\n\t\tDom.addClass(this.layout, 'landing-ui-form-menuitem-open');\n\t\tDom.style(this.body, 'display', 'block');\n\t}\n\n\thideForm()\n\t{\n\t\tDom.removeClass(this.layout, 'landing-ui-form-menuitem-open');\n\t\tDom.style(this.body, 'display', null);\n\t}\n\n\tisFormShown(): boolean\n\t{\n\t\treturn this.layout.classList.contains('landing-ui-form-menuitem-open');\n\t}\n\n\tgetDragButton(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('dragButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-form-header-drag-button landing-ui-drag\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetTitleLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('titleLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-form-header-title\">${Text.encode(this.title)}</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetHeaderLeftLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerLeftLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-form-header-left\">\n\t\t\t\t\t${this.getDragButton()}\n\t\t\t\t\t${this.getTitleLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetRemoveButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\tconst button = Tag.render`<div class=\"landing-ui-form-header-remove-button\"></div>`;\n\t\t\tEvent.bind(button, 'click', this.onRemoveButtonClick);\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tgetHeaderRightLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerRightLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-form-header-right\">\n\t\t\t\t\t${this.getRemoveButton()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tsetTitle(title: string)\n\t{\n\t\tif (Type.isString(title) || Type.isNumber(title))\n\t\t{\n\t\t\tthis.title = title;\n\t\t\tthis.getTitleLayout().innerText = Text.decode(title);\n\t\t}\n\t}\n\n\tsetDepth(depth: number)\n\t{\n\t\tconst offset = 20;\n\t\tthis[depthKey] = Text.toNumber(depth);\n\t\tDom.style(this.layout, 'margin-left', `${depth * offset}px`);\n\t\tDom.attr(this.layout, 'data-depth', depth);\n\t}\n\n\tgetDepth(): number\n\t{\n\t\treturn Text.toNumber(Dom.attr(this.layout, 'data-depth'));\n\t}\n\n\tserialize()\n\t{\n\t\tconst [firstField: BX.Landing.UI.Field.Link] = this.fields;\n\t\treturn firstField.getValue();\n\t}\n}"],"names":["depthKey","Symbol","onHeaderClick","onTextChange","MenuItemForm","options","setEventNamespace","cache","Cache","MemoryCache","bind","onRemoveButtonClick","Dom","addClass","layout","append","getHeaderLeftLayout","header","getHeaderRightLayout","setDepth","depth","fields","firstField","getValue","text","setTitle","Event","input","getHeader","event","preventDefault","isFormShown","hideForm","showForm","emit","form","remove","style","body","removeClass","classList","contains","remember","Tag","render","Text","encode","title","getDragButton","getTitleLayout","button","getRemoveButton","Type","isString","isNumber","innerText","decode","offset","toNumber","attr","BaseForm"],"mappings":"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"}