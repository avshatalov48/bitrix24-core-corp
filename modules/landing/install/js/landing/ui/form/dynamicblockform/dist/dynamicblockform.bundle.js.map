{"version":3,"file":"dynamicblockform.bundle.js","sources":["../src/dynamicblockform.js"],"sourcesContent":["import {Dom, Type} from 'main.core';\nimport {BaseForm} from 'landing.ui.form.baseform';\nimport {Env} from 'landing.env';\nimport {Loc} from 'landing.loc';\n\n/**\n * @memberOf BX.Landing.UI.Form\n */\nexport class DynamicBlockForm extends BaseForm\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tthis.type = options.type;\n\t\tthis.forms = options.forms;\n\t\tthis.code = options.code;\n\t\tthis.onSourceChangeHandler = options.onSourceChange;\n\t\tthis.dynamicParams = options.dynamicParams;\n\t\tthis.settingFieldsSelectors = ['source'];\n\n\t\tthis.addField(this.createSourceField());\n\t}\n\n\tstatic getSources(): Array<any>\n\t{\n\t\treturn Env.getInstance().getOptions().sources;\n\t}\n\n\tstatic getSourceById(id: string)\n\t{\n\t\treturn DynamicBlockForm.getSources().find((source) => {\n\t\t\treturn String(source.id) === String(id);\n\t\t});\n\t}\n\n\tstatic getSourceFieldItems(): {name: string, value: string}\n\t{\n\t\treturn DynamicBlockForm.getSources().map((source) => {\n\t\t\treturn {name: source.name, value: source.id};\n\t\t});\n\t}\n\n\tstatic isReference(value): boolean\n\t{\n\t\tconst sources = DynamicBlockForm.getSources();\n\t\tif (Type.isArray(sources))\n\t\t{\n\t\t\treturn sources.some((source) => {\n\t\t\t\tif (Type.isArray(source.references))\n\t\t\t\t{\n\t\t\t\t\treturn source.references.some((reference) => {\n\t\t\t\t\t\treturn reference.id === value;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tcreateSourceField(): BX.Landing.UI.Field.Dropdown\n\t{\n\t\tlet value = '';\n\n\t\tif (\n\t\t\tType.isPlainObject(this.dynamicParams)\n\t\t\t&& Type.isPlainObject(this.dynamicParams.wrapper)\n\t\t\t&& Type.isPlainObject(this.dynamicParams.wrapper.settings)\n\t\t\t&& Type.isString(this.dynamicParams.wrapper.settings.source)\n\t\t)\n\t\t{\n\t\t\tvalue = this.dynamicParams.wrapper.settings.source;\n\t\t}\n\n\t\tlet source = DynamicBlockForm.getSourceById(value);\n\t\tif (!source)\n\t\t{\n\t\t\t[source] = DynamicBlockForm.getSources();\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tthis.onSourceChangeHandler(source);\n\t\t}, 0);\n\n\t\treturn new BX.Landing.UI.Field.Dropdown({\n\t\t\ttitle: Loc.getMessage('LANDING_CARDS__SOURCE_FIELD_TITLE'),\n\t\t\tselector: 'source',\n\t\t\tcontent: value,\n\t\t\titems: DynamicBlockForm.getSourceFieldItems(),\n\t\t\tonValueChange: (field) => {\n\t\t\t\tthis.onSourceChangeHandler(DynamicBlockForm.getSourceById(field.getValue()));\n\t\t\t},\n\t\t});\n\t}\n\n\tserialize(): {[key: string]: any}\n\t{\n\t\treturn this.fields.reduce((acc, field) => {\n\t\t\tconst value = field.getValue();\n\n\t\t\tif (field.selector === 'source')\n\t\t\t{\n\t\t\t\tacc.source = value;\n\t\t\t\tacc.settings[field.selector] = value;\n\t\t\t}\n\t\t\telse if (value === '@hide' || (Type.isPlainObject(value) && value.id === '@hide'))\n\t\t\t{\n\t\t\t\tacc.references[field.selector] = '@hide';\n\n\t\t\t\tif (Dom.hasClass(field.layout, 'landing-ui-field-dynamic-dropdown'))\n\t\t\t\t{\n\t\t\t\t\tacc.stubs[field.selector] = '';\n\t\t\t\t}\n\t\t\t\telse if (Dom.hasClass(field.layout, 'landing-ui-field-dynamic-image'))\n\t\t\t\t{\n\t\t\t\t\tacc.stubs[field.selector] = {\n\t\t\t\t\t\tid: -1,\n\t\t\t\t\t\tsrc: 'data:image/gif;base64,R0lGODlhAQABAIAAAP',\n\t\t\t\t\t\talt: '',\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (DynamicBlockForm.isReference(value))\n\t\t\t{\n\t\t\t\tacc.references[field.selector] = {id: value};\n\t\t\t}\n\t\t\telse if (Type.isPlainObject(value) && Type.isString(value.id))\n\t\t\t{\n\t\t\t\tacc.references[field.selector] = value;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tacc.stubs[field.selector] = value;\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, {settings: {}, references: {}, stubs: {}});\n\t}\n}"],"names":["DynamicBlockForm","options","type","forms","code","onSourceChangeHandler","onSourceChange","dynamicParams","settingFieldsSelectors","addField","createSourceField","value","Type","isPlainObject","wrapper","settings","isString","source","getSourceById","getSources","setTimeout","BX","Landing","UI","Field","Dropdown","title","Loc","getMessage","selector","content","items","getSourceFieldItems","onValueChange","field","getValue","fields","reduce","acc","id","references","Dom","hasClass","layout","stubs","src","alt","isReference","Env","getInstance","getOptions","sources","find","String","map","name","isArray","some","reference","BaseForm"],"mappings":";;;;;;CAKA;;;;AAGA,KAAaA,gBAAb;CAAA;;CAEC,4BAAYC,OAAZ,EACA;CAAA;;CAAA;CACC,kHAAMA,OAAN;CAEA,UAAKC,IAAL,GAAYD,OAAO,CAACC,IAApB;CACA,UAAKC,KAAL,GAAaF,OAAO,CAACE,KAArB;CACA,UAAKC,IAAL,GAAYH,OAAO,CAACG,IAApB;CACA,UAAKC,qBAAL,GAA6BJ,OAAO,CAACK,cAArC;CACA,UAAKC,aAAL,GAAqBN,OAAO,CAACM,aAA7B;CACA,UAAKC,sBAAL,GAA8B,CAAC,QAAD,CAA9B;;CAEA,UAAKC,QAAL,CAAc,MAAKC,iBAAL,EAAd;;CAVD;CAWC;;CAdF;CAAA;CAAA,wCAwDC;CAAA;;CACC,UAAIC,KAAK,GAAG,EAAZ;;CAEA,UACCC,cAAI,CAACC,aAAL,CAAmB,KAAKN,aAAxB,KACGK,cAAI,CAACC,aAAL,CAAmB,KAAKN,aAAL,CAAmBO,OAAtC,CADH,IAEGF,cAAI,CAACC,aAAL,CAAmB,KAAKN,aAAL,CAAmBO,OAAnB,CAA2BC,QAA9C,CAFH,IAGGH,cAAI,CAACI,QAAL,CAAc,KAAKT,aAAL,CAAmBO,OAAnB,CAA2BC,QAA3B,CAAoCE,MAAlD,CAJJ,EAMA;CACCN,QAAAA,KAAK,GAAG,KAAKJ,aAAL,CAAmBO,OAAnB,CAA2BC,QAA3B,CAAoCE,MAA5C;CACA;;CAED,UAAIA,MAAM,GAAGjB,gBAAgB,CAACkB,aAAjB,CAA+BP,KAA/B,CAAb;;CACA,UAAI,CAACM,MAAL,EACA;CAAA,oCACYjB,gBAAgB,CAACmB,UAAjB,EADZ;;CAAA;;CACEF,QAAAA,MADF;CAEC;;CAEDG,MAAAA,UAAU,CAAC,YAAM;CAChB,QAAA,MAAI,CAACf,qBAAL,CAA2BY,MAA3B;CACA,OAFS,EAEP,CAFO,CAAV;CAIA,aAAO,IAAII,EAAE,CAACC,OAAH,CAAWC,EAAX,CAAcC,KAAd,CAAoBC,QAAxB,CAAiC;CACvCC,QAAAA,KAAK,EAAEC,eAAG,CAACC,UAAJ,CAAe,mCAAf,CADgC;CAEvCC,QAAAA,QAAQ,EAAE,QAF6B;CAGvCC,QAAAA,OAAO,EAAEnB,KAH8B;CAIvCoB,QAAAA,KAAK,EAAE/B,gBAAgB,CAACgC,mBAAjB,EAJgC;CAKvCC,QAAAA,aAAa,EAAE,uBAACC,KAAD,EAAW;CACzB,UAAA,MAAI,CAAC7B,qBAAL,CAA2BL,gBAAgB,CAACkB,aAAjB,CAA+BgB,KAAK,CAACC,QAAN,EAA/B,CAA3B;CACA;CAPsC,OAAjC,CAAP;CASA;CAxFF;CAAA;CAAA,gCA2FC;CACC,aAAO,KAAKC,MAAL,CAAYC,MAAZ,CAAmB,UAACC,GAAD,EAAMJ,KAAN,EAAgB;CACzC,YAAMvB,KAAK,GAAGuB,KAAK,CAACC,QAAN,EAAd;;CAEA,YAAID,KAAK,CAACL,QAAN,KAAmB,QAAvB,EACA;CACCS,UAAAA,GAAG,CAACrB,MAAJ,GAAaN,KAAb;CACA2B,UAAAA,GAAG,CAACvB,QAAJ,CAAamB,KAAK,CAACL,QAAnB,IAA+BlB,KAA/B;CACA,SAJD,MAKK,IAAIA,KAAK,KAAK,OAAV,IAAsBC,cAAI,CAACC,aAAL,CAAmBF,KAAnB,KAA6BA,KAAK,CAAC4B,EAAN,KAAa,OAApE,EACL;CACCD,UAAAA,GAAG,CAACE,UAAJ,CAAeN,KAAK,CAACL,QAArB,IAAiC,OAAjC;;CAEA,cAAIY,aAAG,CAACC,QAAJ,CAAaR,KAAK,CAACS,MAAnB,EAA2B,mCAA3B,CAAJ,EACA;CACCL,YAAAA,GAAG,CAACM,KAAJ,CAAUV,KAAK,CAACL,QAAhB,IAA4B,EAA5B;CACA,WAHD,MAIK,IAAIY,aAAG,CAACC,QAAJ,CAAaR,KAAK,CAACS,MAAnB,EAA2B,gCAA3B,CAAJ,EACL;CACCL,YAAAA,GAAG,CAACM,KAAJ,CAAUV,KAAK,CAACL,QAAhB,IAA4B;CAC3BU,cAAAA,EAAE,EAAE,CAAC,CADsB;CAE3BM,cAAAA,GAAG,EAAE,0CAFsB;CAG3BC,cAAAA,GAAG,EAAE;CAHsB,aAA5B;CAKA;CACD,SAhBI,MAiBA,IAAI9C,gBAAgB,CAAC+C,WAAjB,CAA6BpC,KAA7B,CAAJ,EACL;CACC2B,UAAAA,GAAG,CAACE,UAAJ,CAAeN,KAAK,CAACL,QAArB,IAAiC;CAACU,YAAAA,EAAE,EAAE5B;CAAL,WAAjC;CACA,SAHI,MAIA,IAAIC,cAAI,CAACC,aAAL,CAAmBF,KAAnB,KAA6BC,cAAI,CAACI,QAAL,CAAcL,KAAK,CAAC4B,EAApB,CAAjC,EACL;CACCD,UAAAA,GAAG,CAACE,UAAJ,CAAeN,KAAK,CAACL,QAArB,IAAiClB,KAAjC;CACA,SAHI,MAKL;CACC2B,UAAAA,GAAG,CAACM,KAAJ,CAAUV,KAAK,CAACL,QAAhB,IAA4BlB,KAA5B;CACA;;CAED,eAAO2B,GAAP;CACA,OAvCM,EAuCJ;CAACvB,QAAAA,QAAQ,EAAE,EAAX;CAAeyB,QAAAA,UAAU,EAAE,EAA3B;CAA+BI,QAAAA,KAAK,EAAE;CAAtC,OAvCI,CAAP;CAwCA;CApIF;CAAA;CAAA,iCAiBC;CACC,aAAOI,eAAG,CAACC,WAAJ,GAAkBC,UAAlB,GAA+BC,OAAtC;CACA;CAnBF;CAAA;CAAA,kCAqBsBZ,EArBtB,EAsBC;CACC,aAAOvC,gBAAgB,CAACmB,UAAjB,GAA8BiC,IAA9B,CAAmC,UAACnC,MAAD,EAAY;CACrD,eAAOoC,MAAM,CAACpC,MAAM,CAACsB,EAAR,CAAN,KAAsBc,MAAM,CAACd,EAAD,CAAnC;CACA,OAFM,CAAP;CAGA;CA1BF;CAAA;CAAA,0CA6BC;CACC,aAAOvC,gBAAgB,CAACmB,UAAjB,GAA8BmC,GAA9B,CAAkC,UAACrC,MAAD,EAAY;CACpD,eAAO;CAACsC,UAAAA,IAAI,EAAEtC,MAAM,CAACsC,IAAd;CAAoB5C,UAAAA,KAAK,EAAEM,MAAM,CAACsB;CAAlC,SAAP;CACA,OAFM,CAAP;CAGA;CAjCF;CAAA;CAAA,gCAmCoB5B,KAnCpB,EAoCC;CACC,UAAMwC,OAAO,GAAGnD,gBAAgB,CAACmB,UAAjB,EAAhB;;CACA,UAAIP,cAAI,CAAC4C,OAAL,CAAaL,OAAb,CAAJ,EACA;CACC,eAAOA,OAAO,CAACM,IAAR,CAAa,UAACxC,MAAD,EAAY;CAC/B,cAAIL,cAAI,CAAC4C,OAAL,CAAavC,MAAM,CAACuB,UAApB,CAAJ,EACA;CACC,mBAAOvB,MAAM,CAACuB,UAAP,CAAkBiB,IAAlB,CAAuB,UAACC,SAAD,EAAe;CAC5C,qBAAOA,SAAS,CAACnB,EAAV,KAAiB5B,KAAxB;CACA,aAFM,CAAP;CAGA;;CAED,iBAAO,KAAP;CACA,SATM,CAAP;CAUA;;CAED,aAAO,KAAP;CACA;CArDF;CAAA;CAAA,EAAsCgD,iCAAtC;;;;;;;;"}