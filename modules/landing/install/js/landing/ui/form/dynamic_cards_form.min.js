(function(){"use strict";BX.namespace("BX.Landing.UI.Form");BX.Landing.UI.Form.DynamicCardsForm=function(e){BX.Landing.UI.Form.BaseForm.apply(this,arguments);this.type=e.type;this.code=e.code;this.presets=e.presets;this.sync=e.sync;this.forms=e.forms;this.id=this.code.replace(".","")+"-"+BX.Landing.Utils.random();this.onSourceChangeHandler=e.onSourceChange;this.dynamicParams=e.dynamicParams;this.settingFieldsSelectors=["source","pagesCount","detailPage","useSef"];this.addField(this.createSourceField());this.addField(this.createPagesField());this.addCard(this.createFieldsGroup([this.createLinkField()]))};BX.Landing.UI.Form.DynamicCardsForm.prototype={constructor:BX.Landing.UI.Form.DynamicCardsForm,__proto__:BX.Landing.UI.Form.BaseForm.prototype,getSources:function(){return BX.Landing.Main.getInstance().options.sources},getSourceItems:function(){return this.getSources().map(function(e){return{name:e.name,value:e.id,url:e.url.filter,filter:e.filter,sort:{items:e.sort.map(function(e){return{name:e.name,value:e.id}})}}})},createSourceField:function(){var e=this.getSourceItems();var t={source:e[0].value,filter:e[0].filter,sort:{items:e[0].sort.items}};if(BX.type.isPlainObject(this.dynamicParams)&&BX.type.isPlainObject(this.dynamicParams.settings)&&BX.type.isPlainObject(this.dynamicParams.settings.source)){t.source=this.dynamicParams.settings.source.source;t.filter=this.dynamicParams.settings.source.filter;t.sort.value=this.dynamicParams.settings.source.sort}return new BX.Landing.UI.Field.Source({selector:"source",title:BX.Landing.Loc.getMessage("LANDING_CARDS__SOURCE_FIELD_TITLE"),items:e,value:t,onValueChange:function(e){var t=e.getValue();var i=this.getSources().find(function(e){return e.id===t.source});setTimeout(function(){this.onSourceChangeHandler(i)}.bind(this),0)}.bind(this)})},createPagesField:function(){return new BX.Landing.UI.Field.Pages({selector:"pagesCount",title:BX.Landing.Loc.getMessage("LANDING_CARDS__PAGES_FIELD_TITLE"),value:this.dynamicParams.settings.pagesCount})},createLinkField:function(){var e={text:"",href:""};if(BX.type.isPlainObject(this.dynamicParams)&&BX.type.isPlainObject(this.dynamicParams.settings)&&BX.type.isPlainObject(this.dynamicParams.settings.detailPage)){e=this.dynamicParams.settings.detailPage}return new BX.Landing.UI.Field.Link({selector:"detailPage",title:BX.Landing.Loc.getMessage("LANDING_CARDS__DETAIL_PAGE_FIELD_TITLE"),textOnly:true,disableCustomURL:true,disableBlocks:true,disallowType:true,allowedTypes:[BX.Landing.UI.Field.LinkURL.TYPE_PAGE],detailPageMode:true,sourceField:this.fields.find(function(e){return e.selector==="source"}),options:{siteId:BX.Landing.Main.getInstance().options.site_id,landingId:BX.Landing.Main.getInstance().id,filter:{"=TYPE":BX.Landing.Main.getInstance().options.params.type}},content:e})},createUseSefField:function(){return new BX.Landing.UI.Field.Checkbox({selector:"useSef",multiple:false,items:[{name:BX.Landing.Loc.getMessage("LANDING_CARDS__DETAIL_PAGE_USE_SEF"),value:true,checked:true}]})},createFieldsGroup:function(e){return new BX.Landing.UI.Card.DynamicFieldsGroup({items:e})},isReference:function(e){var t=this.getSources();if(BX.type.isArray(t)){return t.some(function(t){if(BX.type.isArray(t.references)){return t.references.some(function(t){return t.id===e})}return false})}return false},serialize:function(){return this.fields.reduce(function(e,t){var i=t.getValue();if(this.settingFieldsSelectors.includes(t.selector)){if(t.selector==="source"){e.source=i.source}e.settings[t.selector]=i}else if(i==="@hide"||BX.type.isPlainObject(i)&&i.id==="@hide"){e.references[t.selector]="@hide";if(t instanceof BX.Landing.UI.Field.Dropdown){e.stubs[t.selector]=""}else if(t instanceof BX.Landing.UI.Field.DynamicImage){e.stubs[t.selector]={id:-1,src:"data:image/gif;base64,R0lGODlhAQABAIAAAP",alt:""}}}else{if(this.isReference(i)||BX.type.isPlainObject(i)&&BX.type.isString(i.id)){if(this.isReference(i)){e.references[t.selector]={id:i}}else{e.references[t.selector]=i}}else{e.stubs[t.selector]=i}}return e}.bind(this),{settings:{},references:{},stubs:{}})}}})();
//# sourceMappingURL=dynamic_cards_form.map.js