{"version":3,"file":"baseform.bundle.js","sources":["../src/baseform.js"],"sourcesContent":["import {Type, Event, Text, Tag, Dom, Cache, Runtime} from 'main.core';\nimport {Env} from 'landing.env';\nimport typeof {BaseField} from 'landing.ui.field.basefield';\nimport type BaseFormOptions from './internal/type';\nimport './css/style.css';\n\n/**\n * @memberOf BX.Landing.UI.Form\n */\nexport class BaseForm extends Event.EventEmitter\n{\n\tconstructor(data: BaseFormOptions = {})\n\t{\n\t\tsuper(data);\n\t\tthis.setEventNamespace('BX.Landing.UI.Form.BaseForm');\n\n\t\tthis.data = {...data};\n\t\tthis.id = Reflect.has(this.data, 'id') ? this.data.id : Text.getRandom();\n\t\tthis.selector = Reflect.has(this.data, 'selector') ? this.data.selector : '';\n\t\tthis.title = Reflect.has(this.data, 'title') ? this.data.title : '';\n\t\tthis.label = Reflect.has(this.data, 'label') ? this.data.label : '';\n\t\tthis.type = Reflect.has(this.data, 'type') ? this.data.type : 'content';\n\t\tthis.code = Reflect.has(this.data, 'code') ? this.data.code : '';\n\t\tthis.descriptionText = Reflect.has(this.data, 'description') ? this.data.description : '';\n\t\tthis.headerCheckbox = this.data.headerCheckbox;\n\t\tthis.cache = new Cache.MemoryCache();\n\n\t\tthis.fields = new BX.Landing.Collection.BaseCollection();\n\t\tthis.cards = new BX.Landing.Collection.BaseCollection();\n\n\t\tthis.layout = BaseForm.createLayout();\n\t\tthis.description = BaseForm.createDescription();\n\t\tthis.header = BaseForm.createHeader();\n\t\tthis.body = BaseForm.createBody();\n\t\tthis.footer = BaseForm.createFooter();\n\n\t\tDom.append(this.header, this.layout);\n\t\tDom.append(this.description, this.layout);\n\t\tDom.append(this.body, this.layout);\n\t\tDom.append(this.footer, this.layout);\n\n\t\tif (Type.isString(this.title) && this.title !== '')\n\t\t{\n\t\t\tDom.append(document.createTextNode(this.title), this.header);\n\t\t}\n\n\t\tif (Type.isString(this.descriptionText) && this.descriptionText !== '')\n\t\t{\n\t\t\tthis.description.innerHTML = this.descriptionText;\n\t\t}\n\n\t\tif (Type.isArray(this.data.fields) && this.data.fields.length > 0)\n\t\t{\n\t\t\tthis.data.fields.forEach((field) => {\n\t\t\t\tthis.addField(field);\n\t\t\t});\n\t\t}\n\n\t\tconst {sources} = Env.getInstance().getOptions();\n\t\tif (\n\t\t\tType.isPlainObject(this.headerCheckbox)\n\t\t\t&& Type.isArray(sources)\n\t\t\t&& sources.length > 0\n\t\t)\n\t\t{\n\t\t\tDom.append(this.getHeaderCheckbox(), this.header);\n\t\t}\n\t}\n\n\tstatic createLayout(): HTMLDivElement\n\t{\n\t\treturn Tag.render`<div class=\"landing-ui-form\"></div>`;\n\t}\n\n\tstatic createHeader(): HTMLDivElement\n\t{\n\t\treturn Tag.render`<div class=\"landing-ui-form-header\"></div>`;\n\t}\n\n\tstatic createDescription(): HTMLDivElement\n\t{\n\t\treturn Tag.render`<div class=\"landing-ui-form-description\"></div>`;\n\t}\n\n\tstatic createBody(): HTMLDivElement\n\t{\n\t\treturn Tag.render`<div class=\"landing-ui-form-body\"></div>`;\n\t}\n\n\tstatic createFooter(): HTMLDivElement\n\t{\n\t\treturn Tag.render`<div class=\"landing-ui-form-footer\"></div>`;\n\t}\n\n\tgetHeaderCheckbox(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('headerCheckbox', () => {\n\t\t\tconst checkboxId = Text.getRandom();\n\t\t\tconst {text, help, state, onChange} = this.headerCheckbox;\n\n\t\t\tconst input = Tag.render`\n\t\t\t\t<input type=\"checkbox\" id=\"${checkboxId}\" class=\"landing-ui-form-header-checkbox-input\">\n\t\t\t`;\n\t\t\tconst label = Tag.render`\n\t\t\t\t<label for=\"${checkboxId}\" class=\"landing-ui-form-header-checkbox-label\">${text}</label>\n\t\t\t`;\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div class=\"landing-ui-form-header-checkbox\">${input}${label}</div>\n\t\t\t`;\n\n\t\t\tif (Text.toBoolean(state))\n\t\t\t{\n\t\t\t\tinput.setAttribute('checked', true);\n\t\t\t}\n\n\t\t\tif (Type.isFunction(onChange))\n\t\t\t{\n\t\t\t\tEvent.bind(input, 'change', () => {\n\t\t\t\t\tonChange({\n\t\t\t\t\t\tstate: input.checked === true,\n\t\t\t\t\t\tform: this,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (Type.isString(help) && help !== '')\n\t\t\t{\n\t\t\t\tconst helpButton = Tag.render`\n\t\t\t\t\t<a href=\"${help}\" class=\"landing-ui-form-header-checkbox-help\" target=\"_blank\"> </a>\n\t\t\t\t`;\n\n\t\t\t\tDom.append(helpButton, layout);\n\t\t\t}\n\n\t\t\treturn layout;\n\t\t});\n\t}\n\n\tgetHeader(): HTMLDivElement\n\t{\n\t\treturn this.header;\n\t}\n\n\tgetBody(): HTMLDivElement\n\t{\n\t\treturn this.body;\n\t}\n\n\tgetFooter(): HTMLDivElement\n\t{\n\t\treturn this.footer;\n\t}\n\n\tgetNode(): HTMLDivElement\n\t{\n\t\treturn this.layout;\n\t}\n\n\taddField(field: BaseField)\n\t{\n\t\tif (Type.isObject(field))\n\t\t{\n\t\t\tthis.fields.add(field);\n\t\t\tDom.append(field.getNode(), this.getBody());\n\t\t}\n\t}\n\n\taddCard(card: BX.Landing.UI.Card.BaseCard)\n\t{\n\t\tif (Type.isObject(card))\n\t\t{\n\t\t\tthis.cards.add(card);\n\t\t\tcard.fields.forEach((field) => {\n\t\t\t\tthis.fields.add(field);\n\t\t\t});\n\t\t\tDom.append(card.getNode(), this.getBody());\n\t\t}\n\t}\n\n\tremoveCard(card: BX.Landing.UI.Card.BaseCard)\n\t{\n\t\tif (Type.isObject(card))\n\t\t{\n\t\t\tcard.fields.forEach((field) => {\n\t\t\t\tthis.fields.remove(field);\n\t\t\t});\n\n\t\t\tthis.cards.remove(card);\n\t\t\tDom.remove(card.layout);\n\t\t}\n\t}\n\n\treplaceCard(oldCard: BX.Landing.UI.Card.BaseCard, newCard: BX.Landing.UI.Card.BaseCard)\n\t{\n\t\tthis.removeCard(oldCard);\n\t\tthis.addCard(newCard);\n\t}\n\n\tisCheckboxChecked(): boolean\n\t{\n\t\tconst checkbox = this.header.querySelector('input');\n\t\treturn Type.isDomNode(checkbox) && checkbox.checked;\n\t}\n\n\tclone(options: BaseFormOptions): BaseForm\n\t{\n\t\tconst instance = new this.constructor(\n\t\t\tRuntime.clone(options || this.data),\n\t\t);\n\n\t\tthis.fields.forEach((field) => {\n\t\t\tif (field instanceof BX.Landing.UI.Field.Date)\n\t\t\t{\n\t\t\t\tconst newFieldData = Runtime.clone(field.data);\n\t\t\t\tnewFieldData.selector = instance.selector;\n\t\t\t\tinstance.addField(field.clone(newFieldData));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tinstance.addField(field.clone());\n\t\t});\n\n\t\treturn instance;\n\t}\n\n\tserialize(): {[key: string]: any}\n\t{\n\t\treturn this.fields.reduce((acc, field) => {\n\t\t\tacc[field.selector] = field.getValue();\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\tremoveField(field: BaseField)\n\t{\n\t\tthis.fields.remove(field);\n\t\tDom.remove(field.layout);\n\t}\n}"],"names":["BaseForm","data","setEventNamespace","id","Reflect","has","Text","getRandom","selector","title","label","type","code","descriptionText","description","headerCheckbox","cache","Cache","MemoryCache","fields","BX","Landing","Collection","BaseCollection","cards","layout","createLayout","createDescription","header","createHeader","body","createBody","footer","createFooter","Dom","append","Type","isString","document","createTextNode","innerHTML","isArray","length","forEach","field","addField","Env","getInstance","getOptions","sources","isPlainObject","getHeaderCheckbox","remember","checkboxId","text","help","state","onChange","input","Tag","render","toBoolean","setAttribute","isFunction","Event","bind","checked","form","helpButton","isObject","add","getNode","getBody","card","remove","oldCard","newCard","removeCard","addCard","checkbox","querySelector","isDomNode","options","instance","constructor","Runtime","clone","UI","Field","Date","newFieldData","reduce","acc","getValue","EventEmitter"],"mappings":"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"}