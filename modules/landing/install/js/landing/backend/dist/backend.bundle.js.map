{"version":3,"file":"backend.bundle.js","sources":["../src/backend.js"],"sourcesContent":["import {Uri, Cache, Loc, Reflection, Type, Http, ajax} from 'main.core';\nimport type {Block, Landing, Site, Template} from './types';\n\nexport class Backend\n{\n\tstatic getInstance()\n\t{\n\t\tif (!Backend.instance)\n\t\t{\n\t\t\tBackend.instance = new Backend();\n\t\t}\n\n\t\treturn Backend.instance;\n\t}\n\n\tstatic request({url, data}): Promise<any, any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst fd = data instanceof FormData ? data : Http.Data.convertObjectToFormData(data);\n\t\t\tconst xhr = ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl,\n\t\t\t\tdata: fd,\n\t\t\t\tstart: false,\n\t\t\t\tpreparePost: false,\n\t\t\t\tonsuccess: (response) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tType.isPlainObject(response)\n\t\t\t\t\t\t&& response.type === 'error'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(response);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(response);\n\t\t\t\t},\n\t\t\t\tonfailure: reject,\n\t\t\t});\n\n\t\t\txhr.send(fd);\n\t\t});\n\t}\n\n\tcache = new Cache.MemoryCache();\n\n\tgetControllerUrl(): string\n\t{\n\t\treturn this.cache.remember('controllerUrl', () => {\n\t\t\tconst uri = new Uri('/bitrix/tools/landing/ajax.php');\n\t\t\turi.setQueryParam('site', Loc.getMessage('SITE_ID') || undefined);\n\t\t\treturn uri.toString();\n\t\t});\n\t}\n\n\tgetSiteId(): number\n\t{\n\t\treturn this.cache.remember('siteId', () => {\n\t\t\tconst landing = Reflection.getClass('BX.Landing.Main');\n\n\t\t\tif (landing)\n\t\t\t{\n\t\t\t\tconst instance = landing.getInstance();\n\n\t\t\t\tif (\n\t\t\t\t\t'options' in instance\n\t\t\t\t\t&& 'site_id' in instance.options\n\t\t\t\t\t&& !Type.isUndefined(instance.options.site_id)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn instance.options.site_id;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn -1;\n\t\t});\n\t}\n\n\tgetLandingId(): number\n\t{\n\t\treturn this.cache.remember('landingId', () => {\n\t\t\tconst landing = Reflection.getClass('BX.Landing.Main');\n\n\t\t\tif (landing)\n\t\t\t{\n\t\t\t\treturn landing.getInstance().id;\n\t\t\t}\n\n\t\t\treturn -1;\n\t\t});\n\t}\n\n\tgetSitesType(): 'PAGE' | 'STORE'\n\t{\n\t\treturn this.cache.remember('siteType', () => {\n\t\t\tconst landing = Reflection.getClass('BX.Landing.Main');\n\n\t\t\tif (landing)\n\t\t\t{\n\t\t\t\tconst instance = landing.getInstance();\n\n\t\t\t\tif (\n\t\t\t\t\tType.isPlainObject(instance.options)\n\t\t\t\t\t&& Type.isPlainObject(instance.options.params)\n\t\t\t\t\t&& Type.isString(instance.options.params.type)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn instance.options.params.type;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn 'PAGE';\n\t\t});\n\t}\n\n\taction(\n\t\taction: string,\n\t\tdata: {[key: string]: any} = {},\n\t\tqueryParams = {},\n\t\tuploadParams = {},\n\t): Promise<{[key: string]: any}, any>\n\t{\n\t\tqueryParams.site_id = this.getSiteId();\n\n\t\tconst requestBody = {\n\t\t\tsessid: Loc.getMessage('bitrix_sessid'),\n\t\t\taction: uploadParams.action || action.replace('Landing\\\\Block', 'Block'),\n\t\t\tdata: {...data, uploadParams, lid: data.lid || this.getLandingId()},\n\t\t};\n\n\t\tconst uri = new Uri(this.getControllerUrl());\n\t\turi.setQueryParams({\n\t\t\taction: requestBody.action,\n\t\t\t...queryParams,\n\t\t});\n\n\t\treturn Backend\n\t\t\t.request({\n\t\t\t\turl: uri.toString(),\n\t\t\t\tdata: requestBody,\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tif (\n\t\t\t\t\trequestBody.action === 'Block::updateNodes'\n\t\t\t\t\t|| requestBody.action === 'Block::removeCard'\n\t\t\t\t\t|| requestBody.action === 'Block::cloneCard'\n\t\t\t\t\t|| requestBody.action === 'Block::addCard'\n\t\t\t\t\t|| requestBody.action === 'Block::updateStyles'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tBX.Landing.UI.Panel.StatusPanel.getInstance().update();\n\t\t\t\t}\n\n\t\t\t\treturn response.result;\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tif (requestBody.action !== 'Block::getById')\n\t\t\t\t{\n\t\t\t\t\tconst error = Type.isString(err) ? {type: 'error'} : err;\n\t\t\t\t\terr.action = requestBody.action;\n\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tBX.Landing.ErrorManager.getInstance().add(error);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t}\n\n\tbatch(action, data = {}, queryParams = {}): Promise<{[key: string]: any}, any>\n\t{\n\t\tqueryParams.site_id = this.getSiteId();\n\n\t\tconst requestBody = {\n\t\t\tsessid: Loc.getMessage('bitrix_sessid'),\n\t\t\taction: action.replace('Landing\\\\Block', 'Block'),\n\t\t\tdata: {lid: data.lid || this.getLandingId()},\n\t\t\tbatch: data,\n\t\t};\n\n\t\tconst uri = new Uri(this.getControllerUrl());\n\t\turi.setQueryParams({\n\t\t\taction: requestBody.action,\n\t\t\t...queryParams,\n\t\t});\n\n\t\treturn Backend\n\t\t\t.request({\n\t\t\t\turl: uri.toString(),\n\t\t\t\tdata: requestBody,\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tBX.Landing.UI.Panel.StatusPanel.getInstance().update();\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tif (requestBody.action !== 'Block::getById')\n\t\t\t\t{\n\t\t\t\t\tconst error = Type.isString(err) ? {type: 'error'} : err;\n\t\t\t\t\terror.action = requestBody.action;\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tBX.Landing.ErrorManager.getInstance().add(error);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t}\n\n\tupload(file: File | Blob, uploadParams = {}): Promise<{[key: string]: any}, any>\n\t{\n\t\tconst formData = new FormData();\n\n\t\tformData.append('sessid', Loc.getMessage('bitrix_sessid'));\n\t\tformData.append('picture', file, file.name);\n\n\t\tif ('block' in uploadParams)\n\t\t{\n\t\t\tformData.append('action', 'Block::uploadFile');\n\t\t\tformData.append('data[block]', uploadParams.block);\n\t\t}\n\n\t\tif ('lid' in uploadParams)\n\t\t{\n\t\t\tformData.set('action', 'Landing::uploadFile');\n\t\t\tformData.append('data[lid]', uploadParams.lid);\n\t\t}\n\n\t\tif ('id' in uploadParams)\n\t\t{\n\t\t\tformData.set('action', 'Site::uploadFile');\n\t\t\tformData.append('data[id]', uploadParams.id);\n\t\t}\n\n\t\tconst uri = new Uri(this.getControllerUrl());\n\t\turi.setQueryParams({\n\t\t\taction: formData.get('action'),\n\t\t\tsite_id: this.getSiteId(),\n\t\t});\n\n\t\tif (uploadParams.context)\n\t\t{\n\t\t\turi.setQueryParam('context', uploadParams.context);\n\t\t}\n\n\t\treturn Backend\n\t\t\t.request({\n\t\t\t\turl: uri.toString(),\n\t\t\t\tdata: formData,\n\t\t\t})\n\t\t\t.then(response => response.result)\n\t\t\t.catch((err) => {\n\t\t\t\tconst error = Type.isString(err) ? {type: 'error'} : err;\n\t\t\t\terror.action = 'Block::uploadFile';\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tBX.Landing.ErrorManager.getInstance().add(error);\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t}\n\n\tgetSites({filter = {}} = {}): Promise<Array<Site>>\n\t{\n\t\treturn this.cache.remember(`sites+${JSON.stringify(filter)}`, () => {\n\t\t\treturn this\n\t\t\t\t.action('Site::getList', {\n\t\t\t\t\tparams: {\n\t\t\t\t\t\torder: {ID: 'DESC'},\n\t\t\t\t\t\tfilter: {TYPE: this.getSitesType(), ...filter},\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then(response => response);\n\t\t});\n\t}\n\n\tgetLandings({siteId = []}: {siteId?: number | Array<number>} = {}): Promise<Array<Landing>>\n\t{\n\t\tconst ids = Type.isArray(siteId) ? siteId : [siteId];\n\t\tconst getBathItem = id => ({\n\t\t\taction: 'Landing::getList',\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tfilter: {SITE_ID: id},\n\t\t\t\t\torder: {ID: 'DESC'},\n\t\t\t\t\tget_preview: true,\n\t\t\t\t\tcheck_area: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t\tconst prepareResponse = (response) => {\n\t\t\treturn response.reduce((acc, item) => {\n\t\t\t\treturn [...acc, ...item.result];\n\t\t\t}, []);\n\t\t};\n\n\t\treturn this.cache.remember(`landings+${JSON.stringify(ids)}`, () => {\n\t\t\tif (ids.filter(id => !Type.isNil(id)).length === 0)\n\t\t\t{\n\t\t\t\treturn this.getSites()\n\t\t\t\t\t.then((sites) => {\n\t\t\t\t\t\tconst data = sites.map(site => getBathItem(site.ID));\n\t\t\t\t\t\treturn this.batch('Landing::getList', data);\n\t\t\t\t\t})\n\t\t\t\t\t.then(response => prepareResponse(response))\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tresponse.forEach((landing) => {\n\t\t\t\t\t\t\tthis.cache.set(`landing+${landing.ID}`, Promise.resolve(landing));\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst data = ids.map(id => getBathItem(id));\n\t\t\treturn this.batch('Landing::getList', data)\n\t\t\t\t.then(response => prepareResponse(response))\n\t\t\t\t.then((response) => {\n\t\t\t\t\tresponse.forEach((landing) => {\n\t\t\t\t\t\tthis.cache.set(`landing+${landing.ID}`, Promise.resolve(landing));\n\t\t\t\t\t});\n\t\t\t\t\treturn response;\n\t\t\t\t});\n\t\t});\n\t}\n\n\tgetLanding({landingId}: {landingId: string}): Promise<Landing>\n\t{\n\t\treturn this.cache.remember(`landing+${landingId}`, () => {\n\t\t\treturn this\n\t\t\t\t.action('Landing::getList', {\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tfilter: {ID: landingId},\n\t\t\t\t\t\tget_preview: true,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((response) => {\n\t\t\t\t\tif (Type.isArray(response) && response.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn response[0];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\t\t});\n\t}\n\n\tgetBlocks({landingId}: {landingId: string}): Promise<Array<Block>>\n\t{\n\t\treturn this.cache.remember(`blocks+${landingId}`, () => {\n\t\t\treturn this\n\t\t\t\t.action('Block::getList', {\n\t\t\t\t\tlid: landingId,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tget_content: true,\n\t\t\t\t\t\tedit_mode: true,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((blocks) => {\n\t\t\t\t\tblocks.forEach((block) => {\n\t\t\t\t\t\tthis.cache.set(`block+${block.id}`, Promise.resolve(block));\n\t\t\t\t\t});\n\n\t\t\t\t\treturn blocks;\n\t\t\t\t});\n\t\t});\n\t}\n\n\tgetBlock({blockId}: {blockId: string}): Promise<Block>\n\t{\n\t\treturn this.cache.remember(`blockId+${blockId}`, () => {\n\t\t\treturn this.action('Block::getById', {\n\t\t\t\tblock: blockId,\n\t\t\t\tparams: {\n\t\t\t\t\tedit_mode: true,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTemplates({type = 'page', filter = {}} = {}): Promise<Array<Template>>\n\t{\n\t\treturn this.cache.remember(`templates+${JSON.stringify(filter)}`, () => {\n\t\t\treturn this\n\t\t\t\t.action('Demos::getPageList', {type, filter})\n\t\t\t\t.then(response => Object.values(response));\n\t\t});\n\t}\n\n\tgetDynamicTemplates(): Promise<Array<Template>>\n\t{\n\t\treturn this.cache.remember('dynamicTemplates', () => {\n\t\t\treturn this.getTemplates({filter: {section: 'dynamic'}});\n\t\t});\n\t}\n}"],"names":["Backend","Cache","MemoryCache","cache","remember","uri","Uri","setQueryParam","Loc","getMessage","undefined","toString","landing","Reflection","getClass","instance","getInstance","options","Type","isUndefined","site_id","id","isPlainObject","params","isString","type","action","data","queryParams","uploadParams","getSiteId","requestBody","sessid","replace","lid","getLandingId","getControllerUrl","setQueryParams","request","url","then","response","BX","Landing","UI","Panel","StatusPanel","update","result","catch","err","error","ErrorManager","add","Promise","reject","batch","file","formData","FormData","append","name","block","set","get","context","filter","JSON","stringify","order","ID","TYPE","getSitesType","siteId","ids","isArray","getBathItem","SITE_ID","get_preview","check_area","prepareResponse","reduce","acc","item","isNil","length","getSites","sites","map","site","forEach","resolve","landingId","get_content","edit_mode","blocks","blockId","Object","values","getTemplates","section","fd","Http","Data","convertObjectToFormData","xhr","ajax","method","dataType","start","preparePost","onsuccess","onfailure","send"],"mappings":"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"}