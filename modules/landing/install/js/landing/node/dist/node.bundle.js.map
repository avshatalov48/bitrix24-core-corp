{"version":3,"file":"node.bundle.js","sources":["../src/node.js"],"sourcesContent":["const isFunction = BX.Landing.Utils.isFunction;\nconst isString = BX.Landing.Utils.isString;\nconst isPlainObject = BX.Landing.Utils.isPlainObject;\nconst isArray = BX.Landing.Utils.isArray;\nconst bind = BX.Landing.Utils.bind;\nconst proxy = BX.Landing.Utils.proxy;\nconst data = BX.Landing.Utils.data;\n\nexport class Node\n{\n\tconstructor(options)\n\t{\n\t\tthis.node = options.node;\n\t\tthis.manifest = isPlainObject(options.manifest) ? options.manifest : {};\n\t\tthis.selector = isString(options.selector) ? options.selector : '';\n\t\tthis.onChangeHandler = isFunction(options.onChange) ? options.onChange : (function() {});\n\t\tthis.onDesignShow = isFunction(options.onDesignShow) ? options.onDesignShow : (function() {});\n\t\tthis.changeOptionsHandler = isFunction(options.onChangeOptions) ? options.onChangeOptions : (function() {});\n\n\t\tthis.onDocumentClick = proxy(this.onDocumentClick, this);\n\t\tthis.onDocumentKeydown = proxy(this.onDocumentKeydown, this);\n\n\t\t// Bind on document events\n\t\tbind(document, 'click', this.onDocumentClick);\n\t\tbind(document, 'keydown', this.onDocumentKeydown);\n\n\t\t// Make manifest as reed only\n\t\tObject.freeze(this.manifest);\n\n\t\t// Add selector attribute\n\t\tthis.node.dataset.selector = this.selector;\n\n\t\tif (this.isAllowInlineEdit())\n\t\t{\n\t\t\tthis.onAllowInlineEdit();\n\t\t}\n\t}\n\n\t/**\n\t * Handles document click event\n\t * @param {MouseEvent} event\n\t */\n\tonDocumentClick(event)\n\t{}\n\n\t/**\n\t * Handles document keydown event\n\t * @param {KeyboardEvent} event\n\t */\n\tonDocumentKeydown(event)\n\t{\n\t\tif (event.keyCode === 27)\n\t\t{\n\t\t\tthis.onEscapePress();\n\t\t}\n\t}\n\n\t/**\n\t * Handles escape press event\n\t */\n\tonEscapePress()\n\t{}\n\n\t/**\n\t * Gets field for editor form\n\t * @abstract\n\t * @return {?BX.Landing.UI.Field.BaseField}\n\t */\n\tgetField()\n\t{\n\t\tthrow new Error('Must be implemented by subclass');\n\t}\n\n\t/**\n\t * Shows node content editor\n\t */\n\tshowEditor()\n\t{}\n\n\t/**\n\t * Hides node content editor\n\t */\n\thideEditor()\n\t{}\n\n\t/**\n\t * Handles allow inline edit event\n\t */\n\tonAllowInlineEdit()\n\t{}\n\n\t/**\n\t * Checks that allow inline edit\n\t * @return {boolean}\n\t */\n\tisAllowInlineEdit()\n\t{\n\t\treturn this.manifest.allowInlineEdit !== false;\n\t}\n\n\t/**\n\t * Checks that this node is grouped\n\t * @return {boolean}\n\t */\n\tisGrouped()\n\t{\n\t\treturn typeof this.manifest.group === 'string' && this.manifest.group.length > 0;\n\t}\n\n\t/**\n\t * Sets node value\n\t * @abstract\n\t * @param {*} value\n\t * @param {?boolean} [preventSave = false]\n\t * @param {?boolean} [preventHistory = false]\n\t * @return void\n\t */\n\tsetValue(value, preventSave, preventHistory)\n\t{\n\t\tthrow new Error('Must be implemented by subclass');\n\t}\n\n\t/**\n\t * Gets value\n\t * @abstract\n\t * @return {string|object}\n\t */\n\tgetValue()\n\t{\n\t\tthrow new Error('Must be implemented by subclass');\n\t}\n\n\t/**\n\t * Gets additional values\n\t * @return {*}\n\t */\n\tgetAdditionalValue()\n\t{\n\t\tif (\n\t\t\tisPlainObject(this.manifest.extend)\n\t\t\t&& isArray(this.manifest.extend.attrs)\n\t\t)\n\t\t{\n\t\t\treturn this.manifest.extend.attrs.reduce((accumulator, key) => {\n\t\t\t\treturn (accumulator[key] = data(this.node, key)), accumulator;\n\t\t\t}, {});\n\t\t}\n\n\t\treturn {};\n\t}\n\n\t/**\n\t * Handles content change event and calls external onChange handler\n\t * @param {?boolean} [preventHistory = false]\n\t */\n\tonChange(preventHistory)\n\t{\n\t\tthis.onChangeHandler.apply(null, [this, preventHistory]);\n\t}\n\n\t/**\n\t * Gets node index\n\t * @return {int}\n\t */\n\tgetIndex()\n\t{\n\t\tlet index = parseInt(this.selector.split('@')[1], 10);\n\t\tindex = index === index ? index : 0;\n\n\t\treturn index;\n\t}\n\n\t/**\n\t * Prevents save\n\t * @param {boolean} value\n\t */\n\tpreventSave(value)\n\t{\n\t\tthis.isSavePreventedValue = value;\n\t}\n\n\t/**\n\t * Checks that save is prevented\n\t * @return {boolean}\n\t */\n\tisSavePrevented()\n\t{\n\t\treturn !!this.isSavePreventedValue;\n\t}\n\n\t/**\n\t * Gets current block\n\t * @return {number|*}\n\t */\n\tgetBlock()\n\t{\n\t\treturn BX.Landing.PageObject.getBlocks().getByChildNode(this.node);\n\t}\n\n\t/**\n\t * Prepare pseudo url if needed\n\t * @param {object} url\n\t * @return {null|object}\n\t */\n\tpreparePseudoUrl(url)\n\t{\n\t\tlet urlIsChange = false;\n\t\tif (!(url.href === '#' && url.target === ''))\n\t\t{\n\t\t\turlIsChange = true;\n\t\t}\n\n\t\tif (url.href === 'selectActions:')\n\t\t{\n\t\t\turl.href = '';\n\t\t\turl.enabled = false;\n\t\t\turlIsChange = true;\n\t\t}\n\n\t\tif (url.href.startsWith('product:'))\n\t\t{\n\t\t\turl.target = '_self';\n\t\t\turlIsChange = true;\n\t\t}\n\n\t\tif (url.enabled !== false && (url.href === '' || url.href === '#'))\n\t\t{\n\t\t\turl.enabled = false;\n\t\t\turlIsChange = true;\n\t\t}\n\n\t\tif (url.target === '')\n\t\t{\n\t\t\turl.target = '_blank';\n\t\t\turlIsChange = true;\n\t\t}\n\n\t\tif (urlIsChange === true)\n\t\t{\n\t\t\treturn url;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nBX.Landing.Node = Node;\nBX.Landing.Node.storage = [];\n"],"names":["isFunction","BX","Landing","Utils","isString","isPlainObject","isArray","bind","proxy","data","Node","constructor","options","node","manifest","selector","onChangeHandler","onChange","onDesignShow","changeOptionsHandler","onChangeOptions","onDocumentClick","onDocumentKeydown","document","Object","freeze","dataset","isAllowInlineEdit","onAllowInlineEdit","event","keyCode","onEscapePress","getField","Error","showEditor","hideEditor","allowInlineEdit","isGrouped","group","length","setValue","value","preventSave","preventHistory","getValue","getAdditionalValue","extend","attrs","reduce","accumulator","key","apply","getIndex","index","parseInt","split","isSavePreventedValue","isSavePrevented","getBlock","PageObject","getBlocks","getByChildNode","preparePseudoUrl","url","urlIsChange","href","target","enabled","startsWith","storage"],"mappings":"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"}