{"version":3,"file":"node.bundle.js","sources":["../src/node.js"],"sourcesContent":["import {Type} from 'main.core';\n\nexport class Node\n{\n\tconstructor()\n\t{\n\t\tvar isFunction = BX.Landing.Utils.isFunction;\n\t\tvar isString = BX.Landing.Utils.isString;\n\t\tvar isPlainObject = BX.Landing.Utils.isPlainObject;\n\t\tvar isArray = BX.Landing.Utils.isArray;\n\t\tvar bind = BX.Landing.Utils.bind;\n\t\tvar proxy = BX.Landing.Utils.proxy;\n\t\tvar data = BX.Landing.Utils.data;\n\n\t\tthis.node = options.node;\n\t\tthis.manifest = isPlainObject(options.manifest) ? options.manifest : {};\n\t\tthis.selector = isString(options.selector) ? options.selector : \"\";\n\t\tthis.onChangeHandler = isFunction(options.onChange) ? options.onChange : (function() {});\n\t\tthis.onDesignShow = isFunction(options.onDesignShow) ? options.onDesignShow : (function() {});\n\t\tthis.changeOptionsHandler = isFunction(options.onChangeOptions) ? options.onChangeOptions : (function() {});\n\n\t\tthis.onDocumentClick = proxy(this.onDocumentClick, this);\n\t\tthis.onDocumentKeydown = proxy(this.onDocumentKeydown, this);\n\n\t\t// Bind on document events\n\t\tbind(document, \"click\", this.onDocumentClick);\n\t\tbind(document, \"keydown\", this.onDocumentKeydown);\n\n\t\t// Make manifest as reed only\n\t\tObject.freeze(this.manifest);\n\n\t\t// Add selector attribute\n\t\tthis.node.dataset.selector = this.selector;\n\n\t\tif (this.isAllowInlineEdit())\n\t\t{\n\t\t\tthis.onAllowInlineEdit();\n\t\t}\n\t}\n\n\tonDocumentClick(event)\n\t{\n\n\t}\n\n\t/**\n\t * Handles document keydown event\n\t * @param {KeyboardEvent} event\n\t */\n\tonDocumentKeydown(event)\n\t{\n\t\tif (event.keyCode === 27)\n\t\t{\n\t\t\tthis.onEscapePress();\n\t\t}\n\t}\n\n\t/**\n\t * Handles escape press event\n\t */\n\tonEscapePress()\n\t{\n\n\t}\n\n\t/**\n\t * Gets field for editor form\n\t * @abstract\n\t * @return {?BX.Landing.UI.Field.BaseField}\n\t */\n\tgetField()\n\t{\n\t\tthrow new Error(\"Must be implemented by subclass\");\n\t}\n\n\t/**\n\t * Shows node content editor\n\t */\n\tshowEditor()\n\t{\n\n\t}\n\n\t/**\n\t * Hides node content editor\n\t */\n\thideEditor()\n\t{\n\n\t}\n\n\t/**\n\t * Handles allow inline edit event\n\t */\n\tonAllowInlineEdit()\n\t{\n\n\t}\n\n\t/**\n\t * Checks that allow inline edit\n\t * @return {boolean}\n\t */\n\tisAllowInlineEdit()\n\t{\n\t\treturn this.manifest.allowInlineEdit !== false;\n\t}\n\n\t/**\n\t * Checks that this node is grouped\n\t * @return {boolean}\n\t */\n\tisGrouped()\n\t{\n\t\treturn typeof this.manifest.group === \"string\" && this.manifest.group.length > 0;\n\t}\n\n\t/**\n\t * Sets node value\n\t * @abstract\n\t * @param {*} value\n\t * @param {?boolean} [preventSave = false]\n\t * @param {?boolean} [preventHistory = false]\n\t */\n\tsetValue(value, preventSave, preventHistory)\n\t{\n\t\tthrow new Error(\"Must be implemented by subclass\");\n\t}\n\n\t/**\n\t * Gets value\n\t * @abstract\n\t * @return {string|object}\n\t */\n\tgetValue()\n\t{\n\t\tthrow new Error(\"Must be implemented by subclass\");\n\t}\n\n\t/**\n\t * Gets additional values\n\t * @return {*}\n\t */\n\tgetAdditionalValue()\n\t{\n\t\tif (isPlainObject(this.manifest.extend) &&\n\t\t\tisArray(this.manifest.extend.attrs))\n\t\t{\n\t\t\treturn this.manifest.extend.attrs.reduce(function(accumulator, key) {\n\t\t\t\treturn (accumulator[key] = data(this.node, key)), accumulator;\n\t\t\t}.bind(this), {});\n\t\t}\n\n\t\treturn {};\n\t}\n\n\t/**\n\t * Handles content change event and calls external onChange handler\n\t */\n\tonChange()\n\t{\n\t\tthis.onChangeHandler.apply(null, [this]);\n\t}\n\n\t/**\n\t * Gets node index\n\t * @return {int}\n\t */\n\tgetIndex()\n\t{\n\t\tvar index = parseInt(this.selector.split(\"@\")[1]);\n\t\tindex = index === index ? index : 0;\n\t\treturn index;\n\t}\n\n\t/**\n\t * Prevents save\n\t * @param {boolean} value\n\t */\n\tpreventSave(value)\n\t{\n\t\tthis.isSavePreventedValue = value;\n\t}\n\n\t/**\n\t * Checks that save is prevented\n\t * @return {boolean}\n\t */\n\tisSavePrevented()\n\t{\n\t\treturn !!this.isSavePreventedValue;\n\t}\n\n\t/**\n\t * Gets current block\n\t * @return {number|*}\n\t */\n\tgetBlock()\n\t{\n\t\treturn BX.Landing.PageObject.getBlocks().getByChildNode(this.node);\n\t}\n}"],"names":["Node","constructor","isFunction","BX","Landing","Utils","isString","isPlainObject","isArray","bind","proxy","data","node","options","manifest","selector","onChangeHandler","onChange","onDesignShow","changeOptionsHandler","onChangeOptions","onDocumentClick","onDocumentKeydown","document","Object","freeze","dataset","isAllowInlineEdit","onAllowInlineEdit","event","keyCode","onEscapePress","getField","Error","showEditor","hideEditor","allowInlineEdit","isGrouped","group","length","setValue","value","preventSave","preventHistory","getValue","getAdditionalValue","extend","attrs","reduce","accumulator","key","apply","getIndex","index","parseInt","split","isSavePreventedValue","isSavePrevented","getBlock","PageObject","getBlocks","getByChildNode"],"mappings":"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"}