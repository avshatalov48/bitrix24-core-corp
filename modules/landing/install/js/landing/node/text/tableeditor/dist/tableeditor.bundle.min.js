this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};this.BX.Landing.Node=this.BX.Landing.Node||{};this.BX.Landing.Node.Text=this.BX.Landing.Node.Text||{};(function(e,t,l){"use strict";function n(e,t){var l=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!l){if(Array.isArray(e)||(l=a(e))||t&&e&&typeof e.length==="number"){if(l)e=l;var n=0;var i=function e(){};return{s:i,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d=true,r=false,s;return{s:function t(){l=l.call(e)},n:function e(){var t=l.next();d=t.done;return t},e:function e(t){r=true;s=t},f:function e(){try{if(!d&&l["return"]!=null)l["return"]()}finally{if(r)throw s}}}}function a(e,t){if(!e)return;if(typeof e==="string")return i(e,t);var l=Object.prototype.toString.call(e).slice(8,-1);if(l==="Object"&&e.constructor)l=e.constructor.name;if(l==="Map"||l==="Set")return Array.from(e);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return i(e,t)}function i(e,t){if(t==null||t>e.length)t=e.length;for(var l=0,n=new Array(t);l<t;l++)n[l]=e[l];return n}var d=function(){function e(t){babelHelpers.classCallCheck(this,e);this.table=t.querySelector(".landing-table");if(!this.table){return}this.node=t;this.tBody=this.node.getElementsByTagName("tbody")[0];this.addTitles(this.node);this.enableEditCells(this.table);this.dragAndDropRows(this);this.dragAndDropCols(this);this.resizeColumn(this);this.buildLines(this);this.addRow(this);this.addCol(this);this.onUnselect(this);this.unselect(this);this.selectAll(this);this.selectRow(this);this.selectCol(this);this.onCopyTable(this);this.onDeleteElementTable(this);this.onShowPopupMenu(this)}babelHelpers.createClass(e,[{key:"addTitles",value:function e(t){if(!t.hasAttribute("title-added")){t.title="";t.querySelector(".landing-table-th-select-all").title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_SELECT_TABLE"));t.querySelectorAll(".landing-table-div-col-dnd").forEach((function(e){e.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_DND_COLS"))}));t.querySelectorAll(".landing-table-col-resize").forEach((function(e){e.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_RESIZE_COLS"))}));t.querySelectorAll(".landing-table-col-add").forEach((function(e){e.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_BUTTON_ADD_COL"))}));t.querySelectorAll(".landing-table-row-dnd").forEach((function(e){e.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_DND_ROWS"))}));t.querySelectorAll(".landing-table-row-add").forEach((function(e){e.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_BUTTON_ADD_ROW"))}));t.setAttribute("title-added","true")}}},{key:"unselect",value:function e(t){var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(t.table){if(!l){t.table.classList.remove("table-selected-all");this.removeClasses(t.table,"landing-table-th-select-all-selected");this.removeClasses(t.table,"landing-table-cell-selected")}this.removeClasses(t.table,"landing-table-row-selected");this.removeClasses(t.table,"landing-table-th-selected");this.removeClasses(t.table,"landing-table-th-selected-cell");this.removeClasses(t.table,"landing-table-th-selected-top");this.removeClasses(t.table,"landing-table-th-selected-x");this.removeClasses(t.table,"landing-table-tr-selected-left");this.removeClasses(t.table,"landing-table-tr-selected-y");this.removeClasses(t.table,"landing-table-col-selected");this.removeClasses(t.table,"landing-table-tr-selected");this.removeClasses(t.table,"table-selected-all-right");this.removeClasses(t.table,"table-selected-all-bottom")}}},{key:"onUnselect",value:function e(t){l.Event.bind(t.table,"click",(function(){var e=new Set(["landing-table-th-select-all","landing-table-row-dnd","landing-table-row-add"]);var l=babelHelpers.toConsumableArray(event.target.classList).some((function(t){return e.has(t)}));if(!l){var n=new Set(["landing-table-col-dnd"]);l=babelHelpers.toConsumableArray(event.target.parentElement.classList).some((function(e){return n.has(e)}));if(!l){t.unselect(t)}}}))}},{key:"selectAll",value:function e(t){var n=t.table.querySelector(".landing-table-th-select-all");l.Event.bind(n,"click",(function(){var e=false;if(t.table.classList.contains("table-selected-all")){e=true}t.unselect(t,true);var l=t.table.querySelectorAll(".landing-table-tr");var a=0;l.forEach((function(t){var n=t.childNodes;var i=0;var d=0;t.childNodes.forEach((function(e){if(e.nodeType===1){d=i}i++}));if(a>0){var r=n[d];if(e){r.classList.remove("table-selected-all-right")}else{r.classList.add("table-selected-all-right")}}a++;if(a===l.length){n.forEach((function(t){if(t.nodeType===1){if(e){t.classList.remove("table-selected-all-bottom")}else{t.classList.add("table-selected-all-bottom")}}}))}}));n.classList.toggle("landing-table-th-select-all-selected");t.table.classList.toggle("table-selected-all");t.table.querySelectorAll(".landing-table-col-dnd").forEach((function(e){e.classList.toggle("landing-table-cell-selected")}));t.table.querySelectorAll(".landing-table-row-dnd").forEach((function(e){e.classList.toggle("landing-table-cell-selected")}))}))}},{key:"selectRow",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var a=t.table.querySelectorAll(".landing-table-row-dnd");if(n!==null){var i=[];i[0]=a[n];a=i}a.forEach((function(e){l.Event.bind(e,"click",(function(){if(!event.target.classList.contains("landing-table-row-add")){t.unselect(t);var l=e.parentElement.childNodes;var n=0;l.forEach((function(e){if(e.nodeType===1){if(n===1){e.classList.add("landing-table-tr-selected-left")}if(n>=1){e.classList.add("landing-table-tr-selected-y")}n++}}));e.parentElement.classList.add("landing-table-row-selected");t.tBody.classList.add("landing-table-tr-selected")}}))}))}},{key:"selectCol",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var a=t.table.querySelectorAll(".landing-table-col-dnd");if(n!==null){var i=[];i[0]=a[n];a=i}a.forEach((function(e){l.Event.bind(e,"click",(function(){if(!event.target.classList.contains("landing-table-col-add")&&!event.target.classList.contains("landing-table-col-resize")){t.unselect(t);var l=e.cellIndex;var n=0;t.tBody.childNodes.forEach((function(e){if(e.nodeType===1){var t=0;var a=0;var i=0;e.childNodes.forEach((function(e){if(e.nodeType===1){if(l===a){i=t}a++}t++}));if(n===0){e.classList.add("landing-table-col-selected");e.childNodes[i].classList.add("landing-table-th-selected-cell")}if(n===1){e.childNodes[i].classList.add("landing-table-th-selected-top")}if(n>=1){e.childNodes[i].classList.add("landing-table-th-selected-x")}n++;e.childNodes[i].classList.add("landing-table-th-selected")}}))}}))}))}},{key:"buildLines",value:function e(t){if(t.node){var l=t.node.querySelector(".landing-table").getBoundingClientRect().width;var n=t.node.querySelector(".landing-table").getBoundingClientRect().height;var a=5;var i=document.querySelectorAll(".landing-table-row-add-line");i.forEach((function(e){e.style.width="".concat(l+a,"px")}));var d=document.querySelectorAll(".landing-table-col-add-line");d.forEach((function(e){e.style.height="".concat(n+a,"px")}))}}},{key:"getButtonsAddRow",value:function e(t){return t.querySelectorAll(".landing-table-row-add")}},{key:"addRow",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var a=t.getButtonsAddRow(t.node);if(n===null){a=Array.prototype.slice.call(a,0)}else{var i=a[n];a=[];a[0]=i}a=Array.prototype.slice.call(a,0);a.forEach((function(e){l.Event.bind(e,"click",(function(){var l=t.table.querySelector(".landing-table-th-selected-cell");var n=0;var a=0;if(l){l.parentNode.childNodes.forEach((function(e){if(n===0&&e===l){n=a}if(e.nodeType===1){a++}}))}var i=document.createElement("th");i.classList.add("landing-table-th","landing-table-row-dnd");if(t.table.classList.contains("table-selected-all")){i.classList.add("landing-table-cell-selected")}var d=e.parentNode.parentNode;var r=babelHelpers.toConsumableArray(d.parentNode.children).indexOf(e.parentNode.parentNode);var s=0;var o=0;t.tBody.childNodes.forEach((function(e){if(e.nodeType===1){o=s}s++}));var c=t.tBody.childNodes[o];var g=document.createElement("td");g.classList.add("landing-table-th","landing-table-td");g.style.width="50px";var u=t.node.querySelector(".landing-table");if(u.hasAttribute("bg-color")){g.style.backgroundColor=u.getAttribute("bg-color")}if(u.hasAttribute("text-color")){g.style.color=u.getAttribute("text-color")}var f=document.createElement("tr");f.classList.add("landing-table-tr");i.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_DND_ROWS"));i.style.width="16px";var b=document.createElement("div");b.classList.add("landing-table-row-add");b.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_BUTTON_ADD_COL"));var h=document.createElement("div");h.classList.add("landing-table-row-add-line");var v=document.createElement("div");v.classList.add("landing-table-div-row-dnd");b.appendChild(h);i.appendChild(b);i.appendChild(v);if(c){var y=c.children.length;var p=[];e.parentNode.parentNode.childNodes.forEach((function(e){if(e.nodeType===1){p.push(e)}}));for(var L=0;L<y;L++){var B=g.cloneNode(true);if(L===n){B.classList.add("landing-table-th-selected","landing-table-th-selected-x")}if(L===0){f.appendChild(i)}else{B.style.width=p[L].style.width;B.style.height=p[L].style.height;f.appendChild(B)}}}e.parentNode.parentNode.parentNode.insertBefore(f,e.parentNode.parentNode.nextSibling);t.buildLines(t);t.enableEditCells(t.node);BX.Landing.Node.Text.currentNode.onChange(true);t.selectRow(t,r);t.addRow(t,r);t.unselect(t);BX.Landing.UI.Panel.EditorPanel.getInstance().hide()}))}))}},{key:"getButtonsAddCol",value:function e(t){return t.querySelectorAll(".landing-table-col-add")}},{key:"addCol",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var a=t.getButtonsAddCol(t.node);if(n===null){a=Array.prototype.slice.call(a,0)}else{var i=a[n];a=[];a[0]=i}a.forEach((function(e){l.Event.bind(e,"click",(function(){var l=t.table.querySelector(".landing-table-row-selected");var n=0;var a=0;if(l){l.parentNode.childNodes.forEach((function(e){if(e===l&&n===0){n=a}if(e.nodeType===1){a++}}))}var i;var d;i=document.createElement("th");i.classList.add("landing-table-th","landing-table-col-dnd");i.style.width="50px";if(t.table.classList.contains("table-selected-all")){i.classList.add("landing-table-cell-selected")}var r=e.parentNode.parentNode;var s=babelHelpers.toConsumableArray(r.children).indexOf(e.parentNode);if(t.tBody.childNodes.length>0){var o=0;t.tBody.childNodes.forEach((function(e){if(e.nodeType===1){d=i.cloneNode(true);var l=document.createElement("div");l.classList.add("landing-table-div-col-dnd");l.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_DND_COLS"));var a=document.createElement("div");a.classList.add("landing-table-col-resize");a.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_RESIZE_COLS"));var r=document.createElement("div");r.classList.add("landing-table-col-add");r.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_BUTTON_ADD_COL"));var c=document.createElement("div");c.classList.add("landing-table-col-add-line");r.appendChild(c);d.appendChild(l);d.appendChild(a);d.appendChild(r);var g=document.createElement("td");g.classList.add("landing-table-th","landing-table-td");g.style.width="50px";var u=t.node.querySelector(".landing-table");if(u.hasAttribute("bg-color")){g.style.backgroundColor=u.getAttribute("bg-color")}if(u.hasAttribute("text-color")){g.style.color=u.getAttribute("text-color")}if(n>0&&n===o){g.classList.add("landing-table-tr-selected-y")}var f=0;var b=0;var h=0;e.childNodes.forEach((function(e){if(e.nodeType===1){if(b===s){h=f}b++}f++}));if(o===0){e.childNodes[h].parentNode.insertBefore(d,e.childNodes[h].nextSibling)}else{e.childNodes[h].parentNode.insertBefore(g,e.childNodes[h].nextSibling)}o++}}))}t.buildLines(t);t.enableEditCells(t.node);BX.Landing.Node.Text.currentNode.onChange(true);t.selectCol(t,s);t.addCol(t,s);t.unselect(t);BX.Landing.UI.Panel.EditorPanel.getInstance().hide()}))}))}},{key:"dragAndDropRows",value:function e(l){var a=this;this.draggableRows=new t.Draggable({container:l.tBody,draggable:".landing-table-tr",dragElement:".landing-table-row-dnd",type:t.Draggable.HEADLESS});var i=[];var d;var r;var s;var o=0;var c;var g;var u;var f;var b;var h;var v;this.draggableRows.subscribe("start",(function(e){v=a.draggableRows.dragStartEvent.data.originalSource;g=l.tBody.getBoundingClientRect().left;u=l.tBody.getBoundingClientRect().top;d=[];r=[];c=0;s=e.getData().sourceIndex;i=l.tBody.querySelectorAll(".landing-table-tr");i.forEach((function(e){d.push(e.getBoundingClientRect().y);r.push(e.getBoundingClientRect().height)}));f=i[s].getBoundingClientRect().x;b=i[s].getBoundingClientRect().y;h=document.createElement("tr");h.classList.add("landing-table-tr-draggable");i[s].childNodes.forEach((function(e){h.append(e.cloneNode(true))}));if(i[s].classList.contains("landing-table-row-selected")){h.classList.add("landing-table-row-selected")}var t;var n=0;while(!t){if(i[s].childNodes[n].nodeType===1){t=n}n++}h.childNodes[t].style.borderRadius=getComputedStyle(i[s].childNodes[t]).borderRadius})).subscribe("move",(function(e){if(!v.classList.contains("landing-table-row-add")){l.tBody.classList.add("landing-table-draggable");i[s].classList.add("landing-table-tr-taken");c=e.getData().offsetY;l.tBody.append(h);h.style.position="absolute";h.style.top="".concat(b-u+c-.5,"px");h.style.left="".concat(f-g-.5,"px");if(c>0){h.style.transform="rotate(-1deg)"}else{h.style.transform="rotate(1deg)"}}})).subscribe("end",(function(){h.remove();i[s].classList.remove("landing-table-tr-taken");i[s].style="";var e=b+c;var t=e+i[s].getBoundingClientRect().height;if(c<0){var a=n(d.entries()),g;try{for(a.s();!(g=a.n()).done;){var u=babelHelpers.slicedToArray(g.value,2),f=u[0],v=u[1];if(f===s){v-=r[f-1]/2}if(e>=v){o=f}}}catch(e){a.e(e)}finally{a.f()}}if(c===0){o=s}if(c>0){var y=n(d.entries()),p;try{for(y.s();!(p=y.n()).done;){var L=babelHelpers.slicedToArray(p.value,2),B=L[0],E=L[1];var m=E+r[B]/2;if(B===s){m=E}if(t>=m){o=B}}}catch(e){y.e(e)}finally{y.f()}}if(o===0){o++}if(s!==o){var N=null;var C=null;if(i[o]){N=i[o];C=N.nextSibling;while(C&&C.nodeType!==1){C=C.nextSibling}}if(s>o){l.tBody.insertBefore(i[s],N)}if(s<o){l.tBody.insertBefore(i[s],C)}}l.tBody.classList.remove("landing-table-draggable");BX.Landing.Node.Text.currentNode.onChange(true)}))}},{key:"dragAndDropCols",value:function e(l){this.draggableCols=new t.Draggable({container:l.tBody,draggable:".landing-table-div-col-dnd",type:t.Draggable.HEADLESS});var a;var i=0;var d;var r;var s=[];var o;var c;var g;var u;var f;var b;var h;this.draggableCols.subscribe("start",(function(e){u=l.tBody.getBoundingClientRect().left;o=[];c=[];b=[];d=0;r=0;a=e.getData().originalSource.parentNode.cellIndex;if(a){s=babelHelpers.toConsumableArray(l.tBody.querySelectorAll(".landing-table-tr")).map((function(e){return e.children[a]}));g=l.tBody.querySelectorAll(".landing-table-tr");g[0].childNodes.forEach((function(e){if(e.nodeType===1){o.push(e.getBoundingClientRect().x);c.push(e.getBoundingClientRect().width)}}))}f=s[0].getBoundingClientRect().x;h=document.createElement("div");s.forEach((function(e){b.push(e.getAttribute("style"));h.append(e.cloneNode(true));h.lastChild.style.borderRadius=getComputedStyle(e).borderRadius;h.lastChild.style.height="".concat(e.getBoundingClientRect().height,"px");h.lastChild.style.width="".concat(e.getBoundingClientRect().width,"px")}));h.hidden=true;h.classList.add("landing-table-col-draggable");l.tBody.append(h)})).subscribe("move",(function(e){l.tBody.classList.add("landing-table-draggable");s.forEach((function(e){e.classList.add("landing-table-col-taken")}));d=e.getData().offsetX;r=e.getData().offsetY;h.hidden=false;h.style.position="absolute";h.style.left="".concat(f-u+d,"px");h.style.top="".concat(0,"px");if(d<0){h.style.transform="rotate(-1deg)"}if(d>0){h.style.transform="rotate(1deg)"}})).subscribe("end",(function(){h.remove();s.forEach((function(e){e.hidden=false}));if(a){var e=o[a]+d;var t=o[a]+d+s[0].getBoundingClientRect().width;var r=0;s.forEach((function(e){e.style=b[r];e.classList.remove("landing-table-col-taken");r++}));if(d<0){var u=n(o.entries()),f;try{for(u.s();!(f=u.n()).done;){var v=babelHelpers.slicedToArray(f.value,2),y=v[0],p=v[1];if(y>0){p-=c[y-1]/2}if(e>p){i=y}}}catch(e){u.e(e)}finally{u.f()}}if(d===0){i=a}if(d>0){var L=n(o.entries()),B;try{for(L.s();!(B=L.n()).done;){var E=babelHelpers.slicedToArray(B.value,2),m=E[0],N=E[1];var C=N+c[m]/2;if(m===a){C=N}if(t>C){i=m}}}catch(e){L.e(e)}finally{L.f()}}if(i===0){i++}if(a!==i){g.forEach((function(e){var t=[];e.childNodes.forEach((function(e){if(e.nodeType===1){t.push(e)}}));var l=null;var n=null;if(t[i]){l=t[i];n=l.nextSibling;while(n&&n.nodeType!==1){n=n.nextSibling}}if(a>i){e.insertBefore(t[a],l)}if(a<i){e.insertBefore(t[a],n)}}))}l.tBody.classList.remove("landing-table-draggable");BX.Landing.Node.Text.currentNode.onChange(true)}}))}},{key:"resizeColumn",value:function e(l){var n=this.tBody;this.resizeElement=new t.Draggable({container:n,draggable:".landing-table-col-resize",type:t.Draggable.HEADLESS});var a;var i;this.resizeElement.subscribe("start",(function(e){i=[];var t=e.getData().draggable.parentNode;a=t.getBoundingClientRect().width;var l=t.cellIndex;var d=n.querySelectorAll(".landing-table-tr");d.forEach((function(e){i.push(e.children[l])}))})).subscribe("move",(function(e){var t=e.getData().offsetX;var l=a+t;i.forEach((function(e){BX.Dom.style(e,"width","".concat(l,"px"))}))})).subscribe("end",(function(){var e=n.getBoundingClientRect().width;var t=n.parentElement.parentElement.getBoundingClientRect().width;if(t>e){n.parentElement.parentElement.classList.add("landing-table-scroll-hidden")}else{n.parentElement.parentElement.classList.remove("landing-table-scroll-hidden")}l.buildLines(l);BX.Landing.Node.Text.currentNode.onChange(true)}))}},{key:"enableEditCells",value:function e(t){var l=t.querySelectorAll(".landing-table-td");l.forEach((function(e){e.setAttribute("contenteditable","true")}))}},{key:"removeClasses",value:function e(t,l){var n=t.querySelectorAll(".".concat(l));n.forEach((function(e){e.classList.remove(l)}))}},{key:"onCopyTable",value:function e(t){BX.Event.EventEmitter.subscribe("BX.Landing.TableEditor:onCopyTable",(function(){t.unselect(t);BX.Landing.UI.Panel.EditorPanel.getInstance().hide()}))}},{key:"onShowPopupMenu",value:function e(t){BX.Event.EventEmitter.subscribe("BX.Landing.PopupMenuWindow:onShow",(function(){t.unselect(t);BX.Landing.UI.Panel.EditorPanel.getInstance().hide()}))}},{key:"onDeleteElementTable",value:function e(t){BX.Event.EventEmitter.subscribe("BX.Landing.TableEditor:onDeleteElementTable",(function(){t.buildLines(t)}))}}]);return e}();e.default=d})(this.BX.Landing.Node.Text.TableEditor=this.BX.Landing.Node.Text.TableEditor||{},BX.UI.DragAndDrop,BX);
//# sourceMappingURL=tableeditor.bundle.map.js