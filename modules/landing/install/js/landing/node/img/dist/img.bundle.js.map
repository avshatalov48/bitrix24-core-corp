{"version":3,"file":"img.bundle.js","sources":["../src/img.js"],"sourcesContent":["import { Node } from 'landing.node';\nimport {Env} from 'landing.env';\n\nconst attr = BX.Landing.Utils.attr;\nconst data = BX.Landing.Utils.data;\nconst encodeDataValue = BX.Landing.Utils.encodeDataValue;\nconst decodeDataValue = BX.Landing.Utils.decodeDataValue;\n\nexport class Img extends Node\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.type = 'img';\n\t\tthis.editPanel = null;\n\t\tthis.lastValue = null;\n\t\tthis.field = null;\n\t\tthis.uploadParams = options.uploadParams;\n\n\t\tif (!this.isGrouped())\n\t\t{\n\t\t\tthis.node.addEventListener('click', this.onClick.bind(this));\n\t\t}\n\n\t\tif (this.isAllowInlineEdit())\n\t\t{\n\t\t\tthis.node.setAttribute('title', BX.Landing.Loc.getMessage('LANDING_TITLE_OF_IMAGE_NODE'));\n\t\t}\n\t}\n\n\t/**\n\t * Click on field - edit mode.\n\t * @param {MouseEvent} event\n\t */\n\tonClick(event)\n\t{\n\t\tif (\n\t\t\tthis.manifest.allowInlineEdit !== false\n\t\t\t&& BX.Landing.Main.getInstance().isControlsEnabled()\n\t\t\t&& (!BX.Landing.Node.Text.currentNode\n\t\t\t|| !BX.Landing.Node.Text.currentNode.isEditable())\n\t\t\t&& !BX.Landing.UI.Panel.StylePanel.getInstance().isShown()\n\t\t)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tBX.Landing.UI.Button.ColorAction.hideAll();\n\n\t\t\tif (!this.editPanel)\n\t\t\t{\n\t\t\t\tthis.editPanel = new BX.Landing.UI.Panel.Content(this.selector, {\n\t\t\t\t\ttitle: BX.Landing.Loc.getMessage('LANDING_IMAGE_PANEL_TITLE'),\n\t\t\t\t\tclassName: 'landing-ui-panel-edit-image',\n\t\t\t\t});\n\n\t\t\t\tthis.editPanel.appendFooterButton(\n\t\t\t\t\tnew BX.Landing.UI.Button.BaseButton('save_block_content', {\n\t\t\t\t\t\ttext: BX.Landing.Loc.getMessage('BLOCK_SAVE'),\n\t\t\t\t\t\tonClick: this.save.bind(this),\n\t\t\t\t\t\tclassName: 'landing-ui-button-content-save',\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t\tthis.editPanel.appendFooterButton(\n\t\t\t\t\tnew BX.Landing.UI.Button.BaseButton('cancel_block_content', {\n\t\t\t\t\t\ttext: BX.Landing.Loc.getMessage('BLOCK_CANCEL'),\n\t\t\t\t\t\tonClick: this.editPanel.hide.bind(this.editPanel),\n\t\t\t\t\t\tclassName: 'landing-ui-button-content-cancel',\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\twindow.parent.document.body.appendChild(this.editPanel.layout);\n\t\t\t}\n\n\t\t\tconst form = new BX.Landing.UI.Form.BaseForm({ title: this.manifest.name });\n\t\t\tform.addField(this.getField());\n\n\t\t\tthis.editPanel.clear();\n\t\t\tthis.editPanel.appendForm(form);\n\t\t\tthis.editPanel.show();\n\t\t\tBX.Landing.UI.Panel.EditorPanel.getInstance().hide();\n\t\t}\n\t}\n\n\t/**\n\t * Saves value changes\n\t */\n\tsave()\n\t{\n\t\tconst value = this.editPanel.forms[0].fields[0].getValue();\n\n\t\tif (JSON.stringify(this.getValue()) !== JSON.stringify(value))\n\t\t{\n\t\t\tthis.setValue(value);\n\t\t}\n\n\t\tthis.editPanel.hide();\n\t}\n\n\t/**\n\t * Gets form field\n\t * @return {?BX.Landing.UI.Field.BaseField}\n\t */\n\tgetField(): ?BX.Landing.UI.Field.BaseField\n\t{\n\t\tif (this.field)\n\t\t{\n\t\t\tthis.field.setValue(this.getValue());\n\t\t\tthis.field.content = this.getValue();\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.field.adjustPreviewBackgroundSize();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet description = '';\n\n\t\t\tif (this.manifest.dimensions)\n\t\t\t{\n\t\t\t\tconst dimensions = this.manifest.dimensions;\n\n\t\t\t\tconst width = (\n\t\t\t\t\tdimensions.width\n\t\t\t\t\t|| dimensions.maxWidth\n\t\t\t\t\t|| dimensions.minWidth\n\t\t\t\t);\n\n\t\t\t\tconst height = (\n\t\t\t\t\tdimensions.height\n\t\t\t\t\t|| dimensions.maxHeight\n\t\t\t\t\t|| dimensions.minHeight\n\t\t\t\t);\n\n\t\t\t\tif (width && !height)\n\t\t\t\t{\n\t\t\t\t\tdescription = `${BX.Landing.Loc.getMessage('LANDING_CONTENT_IMAGE_RECOMMENDED_WIDTH')} `;\n\t\t\t\t\tdescription += `${width}px`;\n\t\t\t\t}\n\t\t\t\telse if (height && !width)\n\t\t\t\t{\n\t\t\t\t\tdescription = `${BX.Landing.Loc.getMessage('LANDING_CONTENT_IMAGE_RECOMMENDED_HEIGHT')} `;\n\t\t\t\t\tdescription += `${height}px`;\n\t\t\t\t}\n\t\t\t\telse if (width && height)\n\t\t\t\t{\n\t\t\t\t\tdescription = `${BX.Landing.Loc.getMessage('LANDING_CONTENT_IMAGE_RECOMMENDED_SIZE')} `;\n\t\t\t\t\tdescription += `${width}px&nbsp;/&nbsp;`;\n\t\t\t\t\tdescription += `${height}px`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst value = this.getValue();\n\t\t\tif (value.url)\n\t\t\t{\n\t\t\t\tvalue.url = decodeDataValue(value.url);\n\t\t\t}\n\n\t\t\tconst disableLink = !!this.node.closest('a') || !!this.manifest.disableLink;\n\n\t\t\tif (this.manifest.editInStyle !== true)\n\t\t\t{\n\t\t\t\tthis.field = new BX.Landing.UI.Field.Image({\n\t\t\t\t\tselector: this.selector,\n\t\t\t\t\ttitle: this.manifest.name,\n\t\t\t\t\tdescription: description,\n\t\t\t\t\tdisableLink: disableLink,\n\t\t\t\t\tallowAiImage: Env.getInstance().getOptions()['allow_ai_image'],\n\t\t\t\t\tcontent: value,\n\t\t\t\t\tdimensions: this.manifest.dimensions ?? {},\n\t\t\t\t\tcreate2xByDefault: this.manifest.create2xByDefault,\n\t\t\t\t\tdisableAltField: isBackground(this.node),\n\t\t\t\t\tuploadParams: this.uploadParams,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this.field;\n\t}\n\n\t/**\n\t * Sets node value\n\t * @param value - Path to image\n\t * @param {?boolean} [preventSave = false]\n\t * @param {?boolean} [preventHistory = false]\n\t */\n\tsetValue(value, preventSave, preventHistory)\n\t{\n\t\tthis.lastValue = this.lastValue || this.getValue();\n\t\tthis.preventSave(preventSave);\n\n\t\tif (value && value.src)\n\t\t{\n\t\t\tvalue.src = decodeURIComponent(value.src);\n\t\t}\n\n\t\tif (isImage(this.node))\n\t\t{\n\t\t\tsetImageValue(this.node, value);\n\t\t}\n\n\t\tif (isBackground(this.node))\n\t\t{\n\t\t\tsetBackgroundValue(this.node, value);\n\t\t}\n\n\t\tif (value.url)\n\t\t{\n\t\t\tconst url = this.preparePseudoUrl(value.url);\n\t\t\tif (url !== null)\n\t\t\t{\n\t\t\t\tattr(this.node, 'data-pseudo-url', url);\n\t\t\t}\n\t\t}\n\n\t\tthis.onChange(preventHistory);\n\n\t\tif (!preventHistory)\n\t\t{\n\t\t\tBX.Landing.History.getInstance().push();\n\t\t}\n\n\t\tthis.lastValue = this.getValue();\n\t}\n\n\t/**\n\t * Gets node value\n\t * @return {{src: string}}\n\t */\n\tgetValue(): {src: string}\n\t{\n\t\tconst value = { type: '', src: '', alt: '', url: '' };\n\n\t\tconst fileId = parseInt(this.node.dataset.fileid, 10);\n\t\tif (fileId > 0)\n\t\t{\n\t\t\tvalue.id = fileId;\n\t\t}\n\n\t\tconst fileId2x = parseInt(this.node.dataset.fileid2x, 10);\n\t\tif (fileId2x > 0)\n\t\t{\n\t\t\tvalue.id2x = fileId2x;\n\t\t}\n\n\t\tif (isBackground(this.node))\n\t\t{\n\t\t\tvalue.type = 'background';\n\t\t\tvalue.src = getBackgroundUrl(this.node);\n\t\t\tconst src2x = getBackgroundUrl2x(this.node);\n\t\t\tif (src2x)\n\t\t\t{\n\t\t\t\tvalue.src2x = src2x;\n\t\t\t}\n\t\t}\n\n\t\tif (isImage(this.node))\n\t\t{\n\t\t\tvalue.type = 'image';\n\t\t\tvalue.alt = getAlt(this);\n\t\t\tvalue.src = getImageSrc(this.node);\n\t\t\tconst src2x = getImageSrc2x(this.node);\n\t\t\tif (src2x)\n\t\t\t{\n\t\t\t\tvalue.src2x = src2x;\n\t\t\t}\n\t\t}\n\n\t\tvalue.url = (\n\t\t\tencodeDataValue(getPseudoUrl(this))\n\t\t\t|| { text: '', href: '', target: '_self', enabled: false }\n\t\t);\n\n\t\treturn value;\n\t}\n}\n\nBX.Landing.Node.Img = Img;\n\n/**\n * Checks that node use backgroundImage\n * @param {HTMLElement} node\n * @return {boolean}\n */\nfunction isBackground(node): boolean\n{\n\treturn node.nodeName !== 'IMG';\n}\n\n/**\n * Checks that node is imaged\n * @param {HTMLElement} node\n * @return {boolean}\n */\nfunction isImage(node): boolean\n{\n\treturn node.nodeName === 'IMG';\n}\n\n/**\n * Gets background url\n * @param {BX.Landing.Node.Img} node\n * @return {boolean}\n */\nfunction getBackgroundUrl(node): boolean\n{\n\tconst bg = node.style.getPropertyValue('background-image');\n\tif (bg)\n\t{\n\t\tconst res = bg.match(/url\\((.*?)\\)/);\n\n\t\tif (res && res[1])\n\t\t{\n\t\t\treturn res[1].replace(/[\"'|]/g, '');\n\t\t}\n\t}\n\n\treturn '';\n}\n\n/**\n * Gets background url 2x\n * @param {BX.Landing.Node.Img} node\n * @return {boolean}\n */\nfunction getBackgroundUrl2x(node): boolean\n{\n\tconst bg = node.style.getPropertyValue('background-image');\n\tif (bg)\n\t{\n\t\tconst res = bg.match(/1x, url\\([\"'|](.*)[\"'|]\\) 2x\\)/);\n\n\t\tif (res && res[1])\n\t\t{\n\t\t\treturn res[1].replace(/[\"'|]/g, '');\n\t\t}\n\t}\n\n\treturn '';\n}\n\n/**\n * Gets image alt\n * @param {BX.Landing.Node.Img} node\n * @return {string}\n */\nfunction getAlt(node): string\n{\n\tconst alt = attr(node.node, 'alt');\n\n\treturn alt || '';\n}\n\nfunction getPseudoUrl(node): string\n{\n\tconst url = data(node.node, 'data-pseudo-url');\n\n\treturn url || '';\n}\n\n/**\n * Gets image src\n * @param {HTMLElement} node\n * @return {string}\n */\nfunction getImageSrc(node): string\n{\n\tconst src = attr(node, 'src');\n\n\treturn src || '';\n}\n\n/**\n * Gets image src 2x\n * @param {HTMLElement} node\n * @return {string}\n */\nfunction getImageSrc2x(node): string\n{\n\tconst src = attr(node, 'srcset');\n\n\treturn src ? src.replace(' 2x', '') : '';\n}\n\n/**\n * Sets image value or converts to image and sets value\n * @param {HTMLElement} node\n * @param {object} value\n */\nfunction setImageValue(node, value)\n{\n\tif (isImage(node))\n\t{\n\t\tnode.src = value.src;\n\t\tnode.alt = value.alt || '';\n\t\tnode.dataset.fileid = value.id || -1;\n\t\tnode.srcset = value.src2x ? `${value.src2x} 2x` : '';\n\t\tnode.dataset.fileid2x = value.id2x || -1;\n\t}\n\telse\n\t{\n\t\tconst newNode = BX.create('img', {\n\t\t\tattrs: { src: value.src, alt: value.alt, 'data-fileid': value.id },\n\t\t});\n\n\t\tBX.Dom.insertBefore(newNode, node);\n\t\tBX.remove(node);\n\t}\n}\n\n/**\n * Sets background value or converts to div and sets value\n * @param {HTMLElement} node\n * @param {object} value\n */\nfunction setBackgroundValue(node, value)\n{\n\tif (isBackground(node))\n\t{\n\t\tif (value.src)\n\t\t{\n\t\t\tconst style = [`background-image: url(\"${value.src}\");`];\n\t\t\tif (value.src2x)\n\t\t\t{\n\t\t\t\tstyle.push(`background-image: -webkit-image-set(url(\"${value.src}\") 1x, url(\"${value.src2x}\") 2x);`, `background-image: image-set(url(\"${value.src}\") 1x, url(\"${value.src2x}\") 2x);`);\n\t\t\t}\n\n\t\t\t// save css-vars and other styles\n\t\t\tconst oldStyleObj = node.style;\n\t\t\tconst oldStyle = {};\n\t\t\t[...oldStyleObj].forEach((prop) => {\n\t\t\t\toldStyle[prop] = oldStyleObj.getPropertyValue(prop);\n\t\t\t});\n\n\t\t\tnode.setAttribute('style', style.join(' '));\n\t\t\tfor (const prop in oldStyle)\n\t\t\t{\n\t\t\t\tif (prop !== 'background-image')\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.style(node, prop, oldStyle[prop]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (node.style)\n\t\t{\n\t\t\tBX.Dom.style(node, 'background-image', null);\n\t\t}\n\n\t\tnode.dataset.fileid = value.id || -1;\n\t\tnode.dataset.fileid2x = value.id2x || -1;\n\t}\n\telse\n\t{\n\t\tconst newNode = BX.create('div', {\n\t\t\tattrs: {\n\t\t\t\tstyle: `background-image: url(\"${value.src}\")`,\n\t\t\t\t'data-fileid': value.id,\n\t\t\t},\n\t\t});\n\n\t\tBX.Dom.insertBefore(newNode, node);\n\t\tBX.Dom.remove(node);\n\t}\n}\n"],"names":["attr","BX","Landing","Utils","data","encodeDataValue","decodeDataValue","Img","Node","constructor","options","type","editPanel","lastValue","field","uploadParams","isGrouped","node","addEventListener","onClick","bind","isAllowInlineEdit","setAttribute","Loc","getMessage","event","manifest","allowInlineEdit","Main","getInstance","isControlsEnabled","Text","currentNode","isEditable","UI","Panel","StylePanel","isShown","preventDefault","stopPropagation","Button","ColorAction","hideAll","Content","selector","title","className","appendFooterButton","BaseButton","text","save","hide","window","parent","document","body","appendChild","layout","form","Form","BaseForm","name","addField","getField","clear","appendForm","show","EditorPanel","value","forms","fields","getValue","JSON","stringify","setValue","content","requestAnimationFrame","adjustPreviewBackgroundSize","description","dimensions","width","maxWidth","minWidth","height","maxHeight","minHeight","url","disableLink","closest","editInStyle","Field","Image","allowAiImage","Env","getOptions","create2xByDefault","disableAltField","isBackground","preventSave","preventHistory","src","decodeURIComponent","isImage","setImageValue","setBackgroundValue","preparePseudoUrl","onChange","History","push","alt","fileId","parseInt","dataset","fileid","id","fileId2x","fileid2x","id2x","getBackgroundUrl","src2x","getBackgroundUrl2x","getAlt","getImageSrc","getImageSrc2x","getPseudoUrl","href","target","enabled","nodeName","bg","style","getPropertyValue","res","match","replace","srcset","newNode","create","attrs","Dom","insertBefore","remove","oldStyleObj","oldStyle","forEach","prop","join"],"mappings":"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"}