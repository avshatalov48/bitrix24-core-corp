{"version":3,"file":"embed.bundle.js","sources":["../src/embed.js"],"sourcesContent":["import { Base } from 'landing.node.base';\n\nexport class Embed extends Base\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.data = BX.Landing.Utils.data;\n\t\tthis.type = 'embed';\n\t\tthis.attribute = ['data-src', 'data-source', 'data-preview'];\n\t\tthis.onAttributeChangeHandler = options.onAttributeChange || (function() {});\n\t\tthis.lastValue = this.getValue();\n\t\tthis.nodeContainer = this.node.closest(BX.Landing.Node.Embed.CONTAINER_SELECTOR);\n\t}\n\n\tonChange(preventHistory)\n\t{\n\t\tthis.lastValue = this.getValue();\n\t\tthis.onAttributeChangeHandler(this);\n\t\tthis.onChangeHandler(this, preventHistory);\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn JSON.stringify(this.getValue()) !== JSON.stringify(this.lastValue);\n\t}\n\n\tgetValue(): { src: string, source: string, preview: string, ratio: string }\n\t{\n\t\tconst ratio = this.nodeContainer\n\t\t\t? BX.Landing.Node.Embed.RATIO_CLASSES.find((item) => BX.Dom.hasClass(this.nodeContainer, item))\n\t\t\t: ''\n\t\t;\n\n\t\treturn {\n\t\t\tsrc: this.node.src ?? this.data(this.node, 'data-src'),\n\t\t\tsource: this.data(this.node, 'data-source'),\n\t\t\tpreview: this.data(this.node, 'data-preview'),\n\t\t\tratio: ratio || '',\n\t\t};\n\t}\n\n\t/**\n\t * Sets node value\n\t * @abstract\n\t * @param {*} value\n\t * @param {?boolean} [preventSave = false]\n\t * @param {?boolean} [preventHistory = false]\n\t * @return void\n\t */\n\tsetValue(value, preventSave, preventHistory)\n\t{\n\t\t// if iframe or preview-div\n\t\tif (this.node.src)\n\t\t{\n\t\t\tthis.node.src = value.src;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.data(this.node, 'data-src', value.src);\n\t\t}\n\n\t\tthis.data(this.node, 'data-source', value.source);\n\t\tif (value.preview)\n\t\t{\n\t\t\tthis.data(this.node, 'data-preview', value.preview);\n\t\t\tBX.Dom.style(this.node, 'background-image', `url(\"${value.preview}\")`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.data(this.node, 'data-preview', null);\n\t\t\tBX.Dom.style(this.node, 'background-image', '');\n\t\t}\n\n\t\tif (\n\t\t\tvalue.src && value.ratio\n\t\t\t&& this.lastValue.src !== value.src\n\t\t\t&& BX.Landing.Node.Embed.RATIO_CLASSES.includes(value.ratio)\n\t\t\t&& this.nodeContainer\n\t\t)\n\t\t{\n\t\t\tBX.Landing.Node.Embed.RATIO_CLASSES.forEach((ratioClass) => {\n\t\t\t\tif (value.ratio === ratioClass)\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.addClass(this.nodeContainer, ratioClass);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.removeClass(this.nodeContainer, ratioClass);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.isChanged())\n\t\t{\n\t\t\tif (!preventHistory)\n\t\t\t{\n\t\t\t\tBX.Landing.History.getInstance().push();\n\t\t\t}\n\n\t\t\tthis.onChange(preventHistory);\n\t\t}\n\t}\n\n\tgetField(): BX.Landing.UI.Field.EmbedBg | BX.Landing.UI.Field.Embed\n\t{\n\t\tconst fieldData = {\n\t\t\ttitle: this.manifest.name,\n\t\t\tselector: this.selector,\n\t\t\tcontent: this.getValue(),\n\t\t};\n\t\tif (BX.Dom.hasClass(this.node.parentNode, 'bg-video__inner'))\n\t\t{\n\t\t\treturn new BX.Landing.UI.Field.EmbedBg(fieldData);\n\t\t}\n\n\t\treturn new BX.Landing.UI.Field.Embed(fieldData);\n\t}\n}\n\nBX.Landing.Node.Embed = Embed;\nBX.Landing.Node.Embed.CONTAINER_SELECTOR = '.embed-responsive';\nBX.Landing.Node.Embed.RATIO_CLASSES = [\n\t'embed-responsive-16by9',\n\t'embed-responsive-9by16',\n\t'embed-responsive-4by3',\n\t'embed-responsive-3by4',\n\t'embed-responsive-21by9',\n\t'embed-responsive-9by21',\n\t'embed-responsive-1by1',\n];\nBX.Landing.Node.Embed.DEFAULT_RATIO_V = 'embed-responsive-9by16';\nBX.Landing.Node.Embed.DEFAULT_RATIO_H = 'embed-responsive-16by9';\n"],"names":["Embed","Base","constructor","options","data","BX","Landing","Utils","type","attribute","onAttributeChangeHandler","onAttributeChange","lastValue","getValue","nodeContainer","node","closest","Node","CONTAINER_SELECTOR","onChange","preventHistory","onChangeHandler","isChanged","JSON","stringify","ratio","RATIO_CLASSES","find","item","Dom","hasClass","src","source","preview","setValue","value","preventSave","style","includes","forEach","ratioClass","addClass","removeClass","History","getInstance","push","getField","fieldData","title","manifest","name","selector","content","parentNode","UI","Field","EmbedBg","DEFAULT_RATIO_V","DEFAULT_RATIO_H"],"mappings":"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"}