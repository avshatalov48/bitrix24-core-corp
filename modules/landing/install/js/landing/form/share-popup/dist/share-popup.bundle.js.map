{"version":3,"file":"share-popup.bundle.js","sources":["../src/share-popup.js"],"sourcesContent":["import {Cache, Tag, Text, Type, Loc, Reflection, Event} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\nimport {Env} from 'landing.env';\nimport {Embed} from 'crm.form.embed';\nimport {PageObject} from 'landing.pageobject';\n\nimport './css/style.css';\n\ntype TextBlockOptions = {\n\ttype: string,\n\ttitle: string,\n\tlink: {\n\t\tlabel: string,\n\t\tonClick: () => void,\n\t},\n\taction: {\n\t\tlabel: string,\n\t\tonClick: () => void,\n\t},\n};\n\n/**\n * @memberOf BX.Landing.Form\n */\nexport class SharePopup extends EventEmitter\n{\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.Form.SharePopup');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.setOptions(options);\n\n\t\tconsole.log(PageObject.getEditorWindow().document);\n\t\tEvent.bind(PageObject.getEditorWindow().document, 'click', () => {\n\t\t\tconsole.log('click');\n\t\t\tthis.hide();\n\t\t});\n\t}\n\n\tsetOptions(options)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\tgetOptions(): {[key: string]: any}\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\treturn this.#cache.remember('popup', () => {\n\t\t\treturn new Popup({\n\t\t\t\tid: `form-share-popup-${Text.getRandom()}`,\n\t\t\t\tbindElement: this.getOptions().bindElement,\n\t\t\t\tcontent: this.getContent(),\n\t\t\t\tclassName: 'landing-form-share-popup',\n\t\t\t\twidth: 410,\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tnoAllPaddings : true,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 115\n\t\t\t\t},\n\t\t\t\tminWidth: 410,\n\t\t\t\tcontentBackground: 'transparent',\n\t\t\t\tbackground: '#E9EAED',\n\t\t\t});\n\t\t});\n\t}\n\n\tgetContent(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('content', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-form-share-popup-content\">\n\t\t\t\t\t${this.getShareBlock()}\n\t\t\t\t\t${this.getCommunicationBlock()}\n\t\t\t\t\t${this.getHelpBlock()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetShareBlock(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('shareBlock', () => {\n\t\t\treturn this.createContentBlock({\n\t\t\t\ttype: 'share',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SHARE__SHARE_TITLE'),\n\t\t\t\tlink: {\n\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__SHARE_LINK_LABEL'),\n\t\t\t\t\tonClick: () => {},\n\t\t\t\t},\n\t\t\t\taction: {\n\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__SHARE_ACTION_LABEL'),\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\tthis.showEmbedPanel();\n\t\t\t\t\t\tthis.hide();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tshowEmbedPanel()\n\t{\n\t\tconst {formEditorData} = Env.getInstance().getOptions();\n\t\tif (\n\t\t\tType.isPlainObject(formEditorData)\n\t\t\t&& Type.isPlainObject(formEditorData.formOptions)\n\t\t)\n\t\t{\n\t\t\tconst {id} = formEditorData.formOptions;\n\t\t\tEmbed.open(id);\n\t\t}\n\t}\n\n\tshowWidgetPanel()\n\t{\n\t\tconst SidePanelInstance = Reflection.getClass('BX.SidePanel.Instance');\n\n\t\tSidePanelInstance.open(\n\t\t\t`/crm/button/`,\n\t\t\t{\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false,\n\t\t\t},\n\t\t);\n\t}\n\n\tgetCommunicationBlock(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('communicationBlock', () => {\n\t\t\treturn this.createContentBlock({\n\t\t\t\ttype: 'communication',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SHARE__COMMUNICATION_TITLE'),\n\t\t\t\tlink: {\n\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__COMMUNICATION_LINK_LABEL'),\n\t\t\t\t\tonClick: () => {},\n\t\t\t\t},\n\t\t\t\taction: {\n\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__COMMUNICATION_ACTION_LABEL'),\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\tthis.showWidgetPanel();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetHelpBlock(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('helpBlock', () => {\n\t\t\treturn this.createContentBlock({\n\t\t\t\ttype: 'help',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SHARE__HELP_TITLE'),\n\t\t\t\tlink: {\n\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__HELP_LINK_LABEL'),\n\t\t\t\t\tonClick: () => {},\n\t\t\t\t},\n\t\t\t\taction: {\n\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__HELP_ACTION_LABEL'),\n\t\t\t\t\tonClick: () => {},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tcreateContentBlock(options: TextBlockOptions): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-form-share-popup-content-block\" data-type=\"${Text.encode(options.type)}\">\n\t\t\t\t\t<div class=\"landing-form-share-popup-content-block-icon\"></div>\n\t\t\t\t\t<div class=\"landing-form-share-popup-content-block-text\">\n\t\t\t\t\t\t<div class=\"landing-form-share-popup-content-block-text-title\">\n\t\t\t\t\t\t\t${Text.encode(options.title)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass=\"landing-form-share-popup-content-block-text-link\"\n\t\t\t\t\t\t\tonclick=\"${options.link.onClick}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Text.encode(options.link.label)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"landing-form-share-popup-content-block-action\">\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-xs ui-btn-round ui-btn-no-caps ui-btn-light-border\"\n\t\t\t\t\t\t\tonclick=\"${options.action.onClick}\"\n\t\t\t\t\t\t>${Text.encode(options.action.label)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t}\n\n\tshow(options)\n\t{\n\t\tconst popup: Popup = this.getPopup();\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tif (Type.isDomNode(options.bindElement))\n\t\t\t{\n\t\t\t\tpopup.setBindElement(options.bindElement);\n\t\t\t}\n\t\t}\n\n\t\tpopup.show();\n\t}\n\n\thide()\n\t{\n\t\tthis.getPopup().close();\n\t}\n}"],"names":["SharePopup","EventEmitter","constructor","options","Cache","MemoryCache","setEventNamespace","subscribeFromOptions","events","setOptions","console","log","PageObject","getEditorWindow","document","Event","bind","hide","set","getOptions","get","getPopup","remember","Popup","id","Text","getRandom","bindElement","content","getContent","className","width","autoHide","closeByEsc","noAllPaddings","angle","position","offset","minWidth","contentBackground","background","Tag","render","getShareBlock","getCommunicationBlock","getHelpBlock","createContentBlock","type","title","Loc","getMessage","link","label","onClick","action","showEmbedPanel","formEditorData","Env","getInstance","Type","isPlainObject","formOptions","Embed","open","showWidgetPanel","SidePanelInstance","Reflection","getClass","allowChangeHistory","cacheable","encode","show","popup","isDomNode","setBindElement","close"],"mappings":"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"}