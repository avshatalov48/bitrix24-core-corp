{"version":3,"file":"publication.bundle.js","sources":["../src/publication.js"],"sourcesContent":["import { Tag, Uri } from 'main.core';\n\ntype PublicationOptions = {\n\tsiteId: number,\n\tlandingId: number,\n\turl: string\n};\n\ntype AjaxResult = {\n\ttype: string,\n\tresult: any\n};\n\nexport class Publication\n{\n\tstatic instance: ?Publication = null;\n\tdialog: ?BX.PopupWindow = null;\n\tsiteId: number;\n\tlandingId: number;\n\turl: string;\n\n\tconstructor(options: PublicationOptions)\n\t{\n\t\tthis.siteId = options.siteId;\n\t\tthis.landingId = options.landingId;\n\t\tthis.url = options.url;\n\t}\n\n\tstatic getInstance(options: PublicationOptions): Publication\n\t{\n\t\tif (!Publication.instance)\n\t\t{\n\t\t\tPublication.instance = new Publication(options);\n\t\t}\n\t\treturn Publication.instance;\n\t}\n\n\tpublication(mode: string)\n\t{\n\t\tconst action = (mode === 'site') ? 'Site::publication' : 'Landing::publication';\n\t\tconst data = {\n\t\t\tdata: (mode === 'site')\n\t\t\t? {\n\t\t\t\tid: this.siteId\n\t\t\t}\n\t\t\t: {\n\t\t\t\tlid: this.landingId\n\t\t\t},\n\t\t\tactionType: 'rest',\n\t\t\tsessid: BX.message('bitrix_sessid')\n\t\t};\n\n\t\tthis.renderPopup();\n\n\t\tBX.ajax({\n\t\t\turl: Uri.addParam(window.location.href, {action}),\n\t\t\tdata,\n\t\t\tdataType: 'json',\n\t\t\tmethod: 'POST',\n\t\t\tonsuccess: (result: AjaxResult) => {\n\t\t\t\tif (result.type === 'error')\n\t\t\t\t{\n\t\t\t\t\tconsole.log(result.result);\n\t\t\t\t\tthis.renderErrorPopupContent(result.result[0].error_description);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.renderSuccessPopupContent();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\trenderPopup()\n\t{\n\t\tif (!this.dialog)\n\t\t{\n\t\t\tthis.dialog = new BX.PopupWindow('landing-publication-confirm', null, {\n\t\t\t\tcontent: '',\n\t\t\t\ttitleBar: {content: 'Publication'},\n\t\t\t\toffsetLeft: 0,\n\t\t\t\toffsetTop: 0,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\t\ttext: 'OK',\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\tthis.renderWaitPopupContent();\n\t\tthis.dialog.show();\n\t}\n\n\trenderContent(status: HTMLElement)\n\t{\n\t\tthis.dialog.setContent(Tag.render`\n\t\t\t<div class=\"ui-publication\">\n\t\t\t\t<div>Publication dialog</div>\n\t\t\t\t<div>URL: <a href=\"${this.url}\" target=\"_blank\">${this.url}</a></div>\n\t\t\t\t${status}\n\t\t\t</div>\n\t\t`);\n\t}\n\n\trenderWaitPopupContent()\n\t{\n\t\tthis.renderContent(Tag.render`\n\t\t\t<span class=\"ui-publication-name\">Please wait...</span>\n\t\t`);\n\t}\n\n\trenderSuccessPopupContent()\n\t{\n\t\tthis.renderContent(Tag.render`\n\t\t\t<span class=\"ui-publication-name\">SUCCESS!</span>\n\t\t`);\n\t}\n\n\trenderErrorPopupContent(error: string)\n\t{\n\t\tthis.renderContent(Tag.render`\n\t\t\t<span class=\"ui-publication-name\">ERROR! ${error}</span>\n\t\t`);\n\t}\n}"],"names":["Publication","options","siteId","landingId","url","mode","action","data","id","lid","actionType","sessid","BX","message","renderPopup","ajax","Uri","addParam","window","location","href","dataType","method","onsuccess","result","type","console","log","renderErrorPopupContent","error_description","renderSuccessPopupContent","dialog","PopupWindow","content","titleBar","offsetLeft","offsetTop","buttons","PopupWindowButton","text","events","click","popupWindow","close","renderWaitPopupContent","show","status","setContent","Tag","render","renderContent","error","instance"],"mappings":"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"}