{"version":3,"file":"imageeditor.bundle.js","sources":["../src/internal/path.resolver.js","../src/internal/get.mime.type.js","../src/internal/build.options.js","../src/internal/get.filename.js","../src/imageeditor.js"],"sourcesContent":["const assetPath = '/bitrix/js/main/imageeditor/external/photoeditorsdk/assets';\nconst landingAssetsPath = '/bitrix/images/landing/imageeditor/assets';\n\nexport default function pathResolver(path)\n{\n\tif (path.includes('sites_recommended_transform_default'))\n\t{\n\t\tconst [, fileName] = path.split('sites_recommended_transform_default');\n\t\treturn `${assetPath}/ui/desktop/editor/controls/transform/ratios/imgly_transform_common_4-3${fileName}`;\n\t}\n\n\tif (path.includes('sites_recommended_transform_retina'))\n\t{\n\t\tconst [, fileName] = path.split('sites_recommended_transform_retina');\n\t\treturn `${assetPath}/ui/desktop/editor/controls/transform/ratios/imgly_transform_common_4-3${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-3-4'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-3-4');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-3-4${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-4-3'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-4-3');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-4-3${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-9-16'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-9-16');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-9-16${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-16-9'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-16-9');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-16-9${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-1-1'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-1-1');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-1-1${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-custom'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-custom');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-custom${fileName}`;\n\t}\n\n\treturn path;\n}","export default function getMimeType(path)\n{\n\tconst imageExtension = BX.util.getExtension(path);\n\treturn `image/${imageExtension === 'jpg' ? 'jpeg' : imageExtension}`;\n}","import {Loc, Type} from 'main.core';\nimport pathResolver from './path.resolver';\nimport getMimeType from './get.mime.type';\n\nconst proxyPath = '/bitrix/tools/landing/proxy.php';\nconst isValidDimensions = ({width, height} = {}) => {\n\treturn Type.isNumber(width) && Type.isNumber(height);\n};\n\nexport default function buildOptions({image, dimensions} = {})\n{\n\tconst preparedDimensions = {\n\t\twidth: dimensions.width || dimensions.maxWidth || dimensions.minWidth,\n\t\theight: dimensions.height || dimensions.maxHeight || dimensions.minHeight,\n\t};\n\n\treturn {\n\t\timage,\n\t\tmegapixels: 100,\n\t\tproxy: proxyPath,\n\t\tdefaultControl: 'transform',\n\t\tassets: {\n\t\t\tresolver: pathResolver,\n\t\t},\n\t\texport: {\n\t\t\tformat: getMimeType(image),\n\t\t\ttype: BX.Main.ImageEditor.renderType.BLOB,\n\t\t\tquality: 1,\n\t\t},\n\t\tcontrolsOptions: {\n\t\t\ttransform: {\n\t\t\t\tcategories: [\n\t\t\t\t\t{\n\t\t\t\t\t\tidentifier: 'sites_recommended',\n\t\t\t\t\t\tdefaultName: Loc.getMessage('LANDING_IMAGE_EDITOR_RECOMMENDED_RATIOS'),\n\t\t\t\t\t\tratios: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'sites_recommended_transform_retina',\n\t\t\t\t\t\t\t\tdefaultName: Loc.getMessage('LANDING_IMAGE_EDITOR_TRANSFORM_DEFAULT'),\n\t\t\t\t\t\t\t\tratio: (() => {\n\t\t\t\t\t\t\t\t\tif (isValidDimensions(preparedDimensions))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn preparedDimensions.width / preparedDimensions.height;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t\t})(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-custom',\n\t\t\t\t\t\t\t\tdefaultName: Loc.getMessage('IMAGE_EDITOR_RATIOS_CUSTOM'),\n\t\t\t\t\t\t\t\tratio: '*',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tidentifier: 'sites_other',\n\t\t\t\t\t\tdefaultName: Loc.getMessage('LANDING_IMAGE_EDITOR_OTHER_RATIOS'),\n\t\t\t\t\t\tratios: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-1-1',\n\t\t\t\t\t\t\t\tdefaultName: '1:1',\n\t\t\t\t\t\t\t\tratio: 1,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-3-4',\n\t\t\t\t\t\t\t\tdefaultName: '3:4',\n\t\t\t\t\t\t\t\tratio: 3 / 4,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-4-3',\n\t\t\t\t\t\t\t\tdefaultName: '4:3',\n\t\t\t\t\t\t\t\tratio: 4 / 3,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-9-16',\n\t\t\t\t\t\t\t\tdefaultName: '9:16',\n\t\t\t\t\t\t\t\tratio: 9 / 16,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-16-9',\n\t\t\t\t\t\t\t\tdefaultName: '16:9',\n\t\t\t\t\t\t\t\tratio: 16 / 9,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\treplaceCategories: false,\n\t\t\t\tavailableRatios: [\n\t\t\t\t\t'sites_recommended_transform_default',\n\t\t\t\t\t'sites_recommended_transform_retina',\n\t\t\t\t\t'landing-transform-3-4',\n\t\t\t\t\t'landing-transform-4-3',\n\t\t\t\t\t'landing-transform-9-16',\n\t\t\t\t\t'landing-transform-16-9',\n\t\t\t\t\t'landing-transform-1-1',\n\t\t\t\t\t'landing-transform-custom',\n\t\t\t\t],\n\t\t\t},\n\t\t},\n\t};\n}","export default function getFilename(path)\n{\n\treturn path.split('\\\\').pop().split('/').pop();\n}","import 'main.imageeditor';\nimport buildOptions from './internal/build.options';\nimport getFilename from './internal/get.filename';\n\n/**\n * @memberOf BX.Landing\n */\nexport class ImageEditor\n{\n\tstatic edit(options: {image: string, dimensions: {width: number, height: number}})\n\t{\n\t\tconst imageEditor = BX.Main.ImageEditor.getInstance();\n\t\tconst preparedOptions = buildOptions(options);\n\n\t\treturn imageEditor\n\t\t\t.edit(preparedOptions)\n\t\t\t.then((file) => {\n\t\t\t\tfile.name = decodeURIComponent(getFilename(options.image));\n\t\t\t\treturn file;\n\t\t\t});\n\t}\n}"],"names":["assetPath","landingAssetsPath","pathResolver","path","includes","split","fileName","getMimeType","imageExtension","BX","util","getExtension","proxyPath","isValidDimensions","width","height","Type","isNumber","buildOptions","image","dimensions","preparedDimensions","maxWidth","minWidth","maxHeight","minHeight","megapixels","proxy","defaultControl","assets","resolver","export","format","type","Main","ImageEditor","renderType","BLOB","quality","controlsOptions","transform","categories","identifier","defaultName","Loc","getMessage","ratios","ratio","undefined","replaceCategories","availableRatios","getFilename","pop","options","imageEditor","getInstance","preparedOptions","edit","then","file","name","decodeURIComponent"],"mappings":"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"}