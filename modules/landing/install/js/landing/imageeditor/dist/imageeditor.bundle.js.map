{"version":3,"file":"imageeditor.bundle.js","sources":["../src/internal/path.resolver.js","../src/internal/get.mime.type.js","../src/internal/build.options.js","../src/internal/get.filename.js","../src/imageeditor.js"],"sourcesContent":["const assetPath = '/bitrix/js/main/imageeditor/external/photoeditorsdk/assets';\nconst landingAssetsPath = '/bitrix/images/landing/imageeditor/assets';\n\nexport default function pathResolver(path)\n{\n\tif (path.includes('sites_recommended_transform_default'))\n\t{\n\t\tconst [, fileName] = path.split('sites_recommended_transform_default');\n\t\treturn `${assetPath}/ui/desktop/editor/controls/transform/ratios/imgly_transform_common_4-3${fileName}`;\n\t}\n\n\tif (path.includes('sites_recommended_transform_retina'))\n\t{\n\t\tconst [, fileName] = path.split('sites_recommended_transform_retina');\n\t\treturn `${assetPath}/ui/desktop/editor/controls/transform/ratios/imgly_transform_common_4-3${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-3-4'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-3-4');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-3-4${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-4-3'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-4-3');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-4-3${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-9-16'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-9-16');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-9-16${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-16-9'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-16-9');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-16-9${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-1-1'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-1-1');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-1-1${fileName}`;\n\t}\n\n\tif (path.includes('landing-transform-custom'))\n\t{\n\t\tconst [, fileName] = path.split('landing-transform-custom');\n\t\treturn `${landingAssetsPath}/transform/ratios/landing-transform-custom${fileName}`;\n\t}\n\n\treturn path;\n}","export default function getMimeType(path): string\n{\n\tlet imageExtension = BX.util.getExtension(path);\n\tif (imageExtension.length > 4)\n\t{\n\t\timageExtension = imageExtension.split('_').pop();\n\t}\n\n\treturn `image/${imageExtension === 'jpg' ? 'jpeg' : imageExtension}`;\n}\n","import {Loc, Type} from 'main.core';\nimport pathResolver from './path.resolver';\nimport getMimeType from './get.mime.type';\n\nconst proxyPath = '/bitrix/tools/landing/proxy.php';\nconst isValidDimensions = ({width, height} = {}) => {\n\treturn Type.isNumber(width) && Type.isNumber(height);\n};\n\nexport default function buildOptions({image, dimensions} = {})\n{\n\tconst preparedDimensions = {\n\t\twidth: dimensions.width || dimensions.maxWidth || dimensions.minWidth,\n\t\theight: dimensions.height || dimensions.maxHeight || dimensions.minHeight,\n\t};\n\n\treturn {\n\t\timage,\n\t\tmegapixels: 100,\n\t\tproxy: proxyPath,\n\t\tdefaultControl: 'transform',\n\t\tassets: {\n\t\t\tresolver: pathResolver,\n\t\t},\n\t\texport: {\n\t\t\tformat: getMimeType(image),\n\t\t\ttype: BX.Main.ImageEditor.renderType.BLOB,\n\t\t\tquality: 1,\n\t\t},\n\t\tcontrolsOptions: {\n\t\t\ttransform: {\n\t\t\t\tcategories: [\n\t\t\t\t\t{\n\t\t\t\t\t\tidentifier: 'sites_recommended',\n\t\t\t\t\t\tdefaultName: Loc.getMessage('LANDING_IMAGE_EDITOR_RECOMMENDED_RATIOS'),\n\t\t\t\t\t\tratios: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'sites_recommended_transform_retina',\n\t\t\t\t\t\t\t\tdefaultName: Loc.getMessage('LANDING_IMAGE_EDITOR_TRANSFORM_DEFAULT'),\n\t\t\t\t\t\t\t\tratio: (() => {\n\t\t\t\t\t\t\t\t\tif (isValidDimensions(preparedDimensions))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn preparedDimensions.width / preparedDimensions.height;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t\t})(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-custom',\n\t\t\t\t\t\t\t\tdefaultName: Loc.getMessage('IMAGE_EDITOR_RATIOS_CUSTOM'),\n\t\t\t\t\t\t\t\tratio: '*',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tidentifier: 'sites_other',\n\t\t\t\t\t\tdefaultName: Loc.getMessage('LANDING_IMAGE_EDITOR_OTHER_RATIOS'),\n\t\t\t\t\t\tratios: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-1-1',\n\t\t\t\t\t\t\t\tdefaultName: '1:1',\n\t\t\t\t\t\t\t\tratio: 1,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-3-4',\n\t\t\t\t\t\t\t\tdefaultName: '3:4',\n\t\t\t\t\t\t\t\tratio: 3 / 4,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-4-3',\n\t\t\t\t\t\t\t\tdefaultName: '4:3',\n\t\t\t\t\t\t\t\tratio: 4 / 3,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-9-16',\n\t\t\t\t\t\t\t\tdefaultName: '9:16',\n\t\t\t\t\t\t\t\tratio: 9 / 16,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tidentifier: 'landing-transform-16-9',\n\t\t\t\t\t\t\t\tdefaultName: '16:9',\n\t\t\t\t\t\t\t\tratio: 16 / 9,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\treplaceCategories: false,\n\t\t\t\tavailableRatios: [\n\t\t\t\t\t'sites_recommended_transform_default',\n\t\t\t\t\t'sites_recommended_transform_retina',\n\t\t\t\t\t'landing-transform-3-4',\n\t\t\t\t\t'landing-transform-4-3',\n\t\t\t\t\t'landing-transform-9-16',\n\t\t\t\t\t'landing-transform-16-9',\n\t\t\t\t\t'landing-transform-1-1',\n\t\t\t\t\t'landing-transform-custom',\n\t\t\t\t],\n\t\t\t},\n\t\t},\n\t};\n}","export default function getFilename(path)\n{\n\treturn path.split('\\\\').pop().split('/').pop();\n}","import 'main.imageeditor';\nimport buildOptions from './internal/build.options';\nimport getFilename from './internal/get.filename';\n\n/**\n * @memberOf BX.Landing\n */\nexport class ImageEditor\n{\n\tstatic edit(options: {image: string, dimensions: {width: number, height: number}})\n\t{\n\t\tconst imageEditor = BX.Main.ImageEditor.getInstance();\n\t\tconst preparedOptions = buildOptions(options);\n\n\t\treturn imageEditor\n\t\t\t.edit(preparedOptions)\n\t\t\t.then((file) => {\n\t\t\t\tfile.name = decodeURIComponent(getFilename(options.image));\n\t\t\t\treturn file;\n\t\t\t});\n\t}\n}"],"names":["assetPath","landingAssetsPath","pathResolver","path","includes","split","fileName","getMimeType","imageExtension","BX","util","getExtension","length","pop","proxyPath","isValidDimensions","width","height","Type","isNumber","buildOptions","image","dimensions","preparedDimensions","maxWidth","minWidth","maxHeight","minHeight","megapixels","proxy","defaultControl","assets","resolver","format","type","Main","ImageEditor","renderType","BLOB","quality","controlsOptions","transform","categories","identifier","defaultName","Loc","getMessage","ratios","ratio","undefined","replaceCategories","availableRatios","getFilename","options","imageEditor","getInstance","preparedOptions","edit","then","file","name","decodeURIComponent"],"mappings":"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"}