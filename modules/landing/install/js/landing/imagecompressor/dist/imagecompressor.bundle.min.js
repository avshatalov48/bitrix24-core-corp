this.BX=this.BX||{};(function(e,t){"use strict";function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}var a=r(function(e){(function(t){var r=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype;var a=t.Blob&&function(){try{return Boolean(new Blob)}catch(e){return false}}();var i=a&&t.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch(e){return false}}();var n=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder;var o=/^data:((.*?)(;charset=.*?)?)(;base64)?,/;var s=(a||n)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(e){var t,r,s,l,f,u,c,h,v;t=e.match(o);if(!t){throw new Error("invalid data URI")}r=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII");s=!!t[4];l=e.slice(t[0].length);if(s){f=atob(l)}else{f=decodeURIComponent(l)}u=new ArrayBuffer(f.length);c=new Uint8Array(u);for(h=0;h<f.length;h+=1){c[h]=f.charCodeAt(h)}if(a){return new Blob([i?c:u],{type:r})}v=new n;v.append(u);return v.getBlob(r)};if(t.HTMLCanvasElement&&!r.toBlob){if(r.mozGetAsFile){r.toBlob=function(e,t,a){var i=this;setTimeout(function(){if(a&&r.toDataURL&&s){e(s(i.toDataURL(t,a)))}else{e(i.mozGetAsFile("blob",t))}})}}else if(r.toDataURL&&s){r.toBlob=function(e,t,r){var a=this;setTimeout(function(){e(s(a.toDataURL(t,r)))})}}}if(babelHelpers.typeof(e)==="object"&&e.exports){e.exports=s}else{t.dataURLtoBlob=s}})(window)});var i=function(e){if(typeof Blob==="undefined"){return false}return e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"};var n={strict:true,checkOrientation:true,maxWidth:Infinity,maxHeight:Infinity,minWidth:0,minHeight:0,width:undefined,height:undefined,quality:.8,mimeType:"auto",convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null};var o=typeof window!=="undefined";var s=o?window:{};var l=Array.prototype.slice;function f(e){return Array.from?Array.from(e):l.call(e)}var u=/^image\/.+$/;function c(e){return u.test(e)}function h(e){var t=c(e)?e.substr(6):"";if(t==="jpeg"){t="jpg"}return".".concat(t)}var v=String.fromCharCode;function d(e,t,r){var a="";var i;r+=t;for(i=t;i<r;i+=1){a+=v(e.getUint8(i))}return a}var b=s.btoa;function m(e,t){var r=[];var a=8192;var i=new Uint8Array(e);while(i.length>0){r.push(v.apply(null,f(i.subarray(0,a))));i=i.subarray(a)}return"data:".concat(t,";base64,").concat(b(r.join("")))}function p(e){var t=new DataView(e);var r;try{var a;var i;var n;if(t.getUint8(0)===255&&t.getUint8(1)===216){var o=t.byteLength;var s=2;while(s+1<o){if(t.getUint8(s)===255&&t.getUint8(s+1)===225){i=s;break}s+=1}}if(i){var l=i+4;var f=i+10;if(d(t,l,4)==="Exif"){var u=t.getUint16(f);a=u===18761;if(a||u===19789){if(t.getUint16(f+2,a)===42){var c=t.getUint32(f+4,a);if(c>=8){n=f+c}}}}}if(n){var h=t.getUint16(n,a);var v;var b;for(b=0;b<h;b+=1){v=n+b*12+2;if(t.getUint16(v,a)===274){v+=8;r=t.getUint16(v,a);t.setUint16(v,1,a);break}}}}catch(e){r=1}return r}function g(e){var t=0;var r=1;var a=1;switch(e){case 2:r=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90;a=-1;break;case 6:t=90;break;case 7:t=90;r=-1;break;case 8:t=-90;break;default:}return{rotate:t,scaleX:r,scaleY:a}}var y=/\.\d*(?:0|9){12}\d*$/;function w(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1e11;return y.test(e)?Math.round(e*t)/t:e}var B=s.ArrayBuffer,U=s.FileReader;var k=s.URL||s.webkitURL;var x=/\.\w+$/;var H=s.Compressor;var T=function(){function e(t,r){babelHelpers.classCallCheck(this,e);this.file=t;this.image=new Image;this.options=babelHelpers.objectSpread({},n,r);this.aborted=false;this.result=null;this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;var r=this.file,a=this.options;if(!i(r)){this.fail(new Error("The first argument must be a File or Blob object."));return}var n=r.type;if(!c(n)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!k||!U){this.fail(new Error("The current browser does not support image compression."));return}if(!B){a.checkOrientation=false}if(k&&!a.checkOrientation){this.load({url:k.createObjectURL(r)})}else{var o=new U;var s=a.checkOrientation&&n==="image/jpeg";this.reader=o;o.onload=function(e){var a=e.target;var i=a.result;var o={};if(s){var l=p(i);if(l>1||!k){o.url=m(i,n);if(l>1){Object.assign(o,g(l))}}else{o.url=k.createObjectURL(r)}}else{o.url=i}t.load(o)};o.onabort=function(){t.fail(new Error("Aborted to read the image with FileReader."))};o.onerror=function(){t.fail(new Error("Failed to read the image with FileReader."))};o.onloadend=function(){t.reader=null};if(s){o.readAsArrayBuffer(r)}else{o.readAsDataURL(r)}}}},{key:"load",value:function e(t){var r=this;var a=this.file,i=this.image;i.onload=function(){r.draw(babelHelpers.objectSpread({},t,{naturalWidth:i.naturalWidth,naturalHeight:i.naturalHeight}))};i.onabort=function(){r.fail(new Error("Aborted to load the image."))};i.onerror=function(){r.fail(new Error("Failed to load the image."))};i.alt=a.name;i.src=t.url}},{key:"draw",value:function e(t){var r=this;var i=t.naturalWidth,n=t.naturalHeight,o=t.rotate,s=o===void 0?0:o,l=t.scaleX,f=l===void 0?1:l,u=t.scaleY,h=u===void 0?1:u;var v=this.file,d=this.image,b=this.options;var m=document.createElement("canvas");var p=m.getContext("2d");var g=i/n;var y=Math.abs(s)%180===90;var B=Math.max(b.maxWidth,0)||Infinity;var U=Math.max(b.maxHeight,0)||Infinity;var k=Math.max(b.minWidth,0)||0;var x=Math.max(b.minHeight,0)||0;var H=Math.max(b.width,0)||i;var T=Math.max(b.height,0)||n;if(y){var M=[U,B];B=M[0];U=M[1];var j=[x,k];k=j[0];x=j[1];var A=[T,H];H=A[0];T=A[1]}if(B<Infinity&&U<Infinity){if(U*g>B){U=B/g}else{B=U*g}}else if(B<Infinity){U=B/g}else if(U<Infinity){B=U*g}if(k>0&&x>0){if(x*g>k){x=k/g}else{k=x*g}}else if(k>0){x=k/g}else if(x>0){k=x*g}if(T*g>H){T=H/g}else{H=T*g}H=Math.floor(w(Math.min(Math.max(H,k),B)));T=Math.floor(w(Math.min(Math.max(T,x),U)));var C=-H/2;var L=-T/2;var E=H;var R=T;if(y){var I=[T,H];H=I[0];T=I[1]}m.width=H;m.height=T;if(!c(b.mimeType)){b.mimeType=v.type}var D="transparent";if(v.size>b.convertSize&&b.mimeType==="image/png"){D="#fff";b.mimeType="image/jpeg"}p.fillStyle=D;p.fillRect(0,0,H,T);if(b.beforeDraw){b.beforeDraw.call(this,p,m)}if(this.aborted){return}p.save();p.translate(H/2,T/2);p.rotate(s*Math.PI/180);p.scale(f,h);p.drawImage(d,C,L,E,R);p.restore();if(b.drew){b.drew.call(this,p,m)}if(this.aborted){return}var S=function e(t){if(!r.aborted){r.done({naturalWidth:i,naturalHeight:n,result:t})}};if(m.toBlob){m.toBlob(S,b.mimeType,b.quality)}else{S(a(m.toDataURL(b.mimeType,b.quality)))}}},{key:"done",value:function e(t){var r=t.naturalWidth,a=t.naturalHeight,i=t.result;var n=this.file,o=this.image,s=this.options;if(k&&!s.checkOrientation){k.revokeObjectURL(o.src)}if(i){if(s.strict&&i.size>n.size&&s.mimeType===n.type&&!(s.width>r||s.height>a||s.minWidth>r||s.minHeight>a)){i=n}else{var l=new Date;i.lastModified=l.getTime();i.lastModifiedDate=l;i.name=n.name;if(i.name&&i.type!==n.type){i.name=i.name.replace(x,h(i.type))}}}else{i=n}this.result=i;if(s.success){s.success.call(this,i)}}},{key:"fail",value:function e(t){var r=this.options;if(r.error){r.error.call(this,t)}else{throw t}}},{key:"abort",value:function e(){if(!this.aborted){this.aborted=true;if(this.reader){this.reader.abort()}else if(!this.image.complete){this.image.onload=null;this.image.onabort()}else{this.fail(new Error("The compression process has been aborted."))}}}}],[{key:"noConflict",value:function t(){window.Compressor=H;return e}},{key:"setDefaults",value:function e(t){Object.assign(n,t)}}]);return e}();var M=["width","height","maxWidth","maxHeight","minWidth","minHeight"];function j(e){if(!t.Type.isString(e)){return Promise.resolve(e)}return new Promise(function(r,a){try{var i=t.ajax.xhr();i.open("GET",e);i.responseType="blob";i.onerror=function(){a(new Error("Network error."))};i.onload=function(){if(i.status===200){r(i.response)}else{a(new Error("Loading error: ".concat(i.statusText)))}};i.send()}catch(e){a(e.message)}})}var A=function(){function e(r){var a=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);this.file=r;this.options=babelHelpers.objectSpread({quality:.8},i);if(this.options.retina){M.forEach(function(e){if(t.Type.isNumber(a.options[e])){a.options[e]*=2}})}}babelHelpers.createClass(e,[{key:"compress",value:function e(){var t=this;return new Promise(function(e,r){void new T(t.file,babelHelpers.objectSpread({},t.options,{success:e,error:r}))})}}],[{key:"compress",value:function t(r){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return j(r).then(function(t){var r=new e(t,a);return r.compress()})}}]);return e}();e.ImageCompressor=A})(this.BX.Landing=this.BX.Landing||{},BX);
//# sourceMappingURL=imagecompressor.bundle.map.js