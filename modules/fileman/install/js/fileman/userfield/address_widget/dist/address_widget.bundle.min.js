this.BX=this.BX||{};this.BX.Fileman=this.BX.Fileman||{};(function(e,s,a,l,t,i){"use strict";var r=babelHelpers.classPrivateFieldLooseKey("wrapper");class o{constructor(e){Object.defineProperty(this,r,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,r)[r]=e.wrapper}getWrapper(){return babelHelpers.classPrivateFieldLooseBase(this,r)[r]}layout(){throw new Error("please implement the layout() method")}}let d=e=>e,b,n;var p=babelHelpers.classPrivateFieldLooseKey("addresses");var c=babelHelpers.classPrivateFieldLooseKey("widgets");class v extends o{constructor(e){super(e);Object.defineProperty(this,p,{writable:true,value:[]});Object.defineProperty(this,c,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e.addresses}destroyWidgets(){babelHelpers.classPrivateFieldLooseBase(this,c)[c].forEach((e=>{e.destroy()}))}layout(){const e=t.Tag.render(b||(b=d`<div></div>`));babelHelpers.classPrivateFieldLooseBase(this,p)[p].forEach((s=>{t.Dom.append(this.getLayoutForAddress(s),e)}));t.Dom.append(e,this.getWrapper());return this.getWrapper()}getLayoutForAddress(e){const s=new a.Factory;const i=s.createAddressWidget({address:e,mode:l.ControlMode.view,popupOptions:{offsetLeft:14},popupBindOptions:{forceBindPosition:true,position:"right"},mapBehavior:"auto",useFeatures:{fields:false,map:true,autocomplete:false}});babelHelpers.classPrivateFieldLooseBase(this,c)[c].push(i);const r=t.Tag.render(n||(n=d`
			<span class="fields address field-item view">
				<span class="ui-link ui-link-dark ui-link-dotted">${0}</span>
			</span>
		`),this.getFormattedAddress(e));i.render({mapBindElement:r,controlWrapper:r});return r}getFormattedAddress(e){var s;const a=new l.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));return(s=e.toString(a,l.AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA))!=null?s:""}}let u=e=>e,h,F,P,L,B,H,f,m,y;var g=babelHelpers.classPrivateFieldLooseKey("widget");var w=babelHelpers.classPrivateFieldLooseKey("nodes");var E=babelHelpers.classPrivateFieldLooseKey("wrapper");var I=babelHelpers.classPrivateFieldLooseKey("address");var C=babelHelpers.classPrivateFieldLooseKey("fieldName");var D=babelHelpers.classPrivateFieldLooseKey("fieldFormName");var O=babelHelpers.classPrivateFieldLooseKey("showMap");var A=babelHelpers.classPrivateFieldLooseKey("enableRemoveButton");var T=babelHelpers.classPrivateFieldLooseKey("isCompactMode");var M=babelHelpers.classPrivateFieldLooseKey("initialAddressId");var S=babelHelpers.classPrivateFieldLooseKey("areDetailsShown");var j=babelHelpers.classPrivateFieldLooseKey("isLoading");var K=babelHelpers.classPrivateFieldLooseKey("isDropdownLoading");var _=babelHelpers.classPrivateFieldLooseKey("isDestroyed");class N extends i.EventEmitter{constructor(e){super();Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,w,{writable:true,value:{}});Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:true});Object.defineProperty(this,A,{writable:true,value:false});Object.defineProperty(this,T,{writable:true,value:false});Object.defineProperty(this,M,{writable:true,value:null});Object.defineProperty(this,S,{writable:true,value:false});Object.defineProperty(this,j,{writable:true,value:false});Object.defineProperty(this,K,{writable:true,value:false});Object.defineProperty(this,_,{writable:true,value:false});this.setEventNamespace("Fileman.EditEntry");babelHelpers.classPrivateFieldLooseBase(this,E)[E]=e.wrapper;babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e.fieldName;babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e.fieldFormName;babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e.enableRemoveButton;babelHelpers.classPrivateFieldLooseBase(this,M)[M]=e.initialAddressId;babelHelpers.classPrivateFieldLooseBase(this,O)[O]=e.showMap;if(e.address){babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e.address}if(e.isCompactMode){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e.isCompactMode}}layout(){const e=new a.Factory;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e.createAddressWidget({address:babelHelpers.classPrivateFieldLooseBase(this,I)[I],mode:l.ControlMode.edit,popupOptions:{offsetLeft:14},popupBindOptions:{forceBindPosition:true,position:"right"},mapBehavior:"auto",useFeatures:{fields:true,map:babelHelpers.classPrivateFieldLooseBase(this,O)[O],autocomplete:true}});babelHelpers.classPrivateFieldLooseBase(this,w)[w].userInput=t.Tag.render(h||(h=u`<input type="text" class="ui-ctl-element" />`));babelHelpers.classPrivateFieldLooseBase(this,w)[w].fieldsContainer=t.Tag.render(F||(F=u`<div class="location-fields-control-block"></div>`));babelHelpers.classPrivateFieldLooseBase(this,w)[w].detailsToggle=t.Tag.render(P||(P=u`<span class="ui-link ui-link-secondary address-control-mode-switch">${0}</span>`),t.Loc.getMessage("ADDRESS_USERFIELD_DETAILS"));t.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,w)[w].detailsToggle,"click",this.onDetailsToggleClick.bind(this));let s=this.getInitialAddressFieldValue();babelHelpers.classPrivateFieldLooseBase(this,w)[w].fieldValueInput=t.Tag.render(L||(L=u`<input type="hidden" name="${0}" value="${0}" />`),babelHelpers.classPrivateFieldLooseBase(this,D)[D],s);babelHelpers.classPrivateFieldLooseBase(this,w)[w].inputIcon=t.Tag.render(B||(B=u`<button type="button" class="ui-ctl-after ui-ctl-icon-clear"></button>`));t.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,w)[w].inputIcon,"click",this.onInputIconClick.bind(this));babelHelpers.classPrivateFieldLooseBase(this,g)[g].subscribeOnAddressChangedEvent(this.onAddressChanged.bind(this));babelHelpers.classPrivateFieldLooseBase(this,g)[g].subscribeOnStateChangedEvent(this.onWidgetStateChangedEvent.bind(this));babelHelpers.classPrivateFieldLooseBase(this,g)[g].subscribeOnFeatureEvent(this.onFeatureEvent.bind(this));babelHelpers.classPrivateFieldLooseBase(this,w)[w].entryWrapper=t.Tag.render(H||(H=u`
			<div class="edit-entry-input-wrapper">
				<div class="fields address field-item edit ui-ctl ui-ctl-after-icon ${0}">
					${0}
					${0}
					${0}
				</div>
			</div>
		`),this.getUserInputSizeClass(),babelHelpers.classPrivateFieldLooseBase(this,w)[w].userInput,babelHelpers.classPrivateFieldLooseBase(this,w)[w].fieldsContainer,babelHelpers.classPrivateFieldLooseBase(this,w)[w].inputIcon);babelHelpers.classPrivateFieldLooseBase(this,w)[w].layout=t.Tag.render(f||(f=u`
			<div class="edit-entry-layout-wrapper ${0}">
				<div class="address-control-mode-switch-wrapper">
					${0}
				</div>
				${0}
			</div>
		`),this.getLayoutSizeClass(),babelHelpers.classPrivateFieldLooseBase(this,w)[w].detailsToggle,babelHelpers.classPrivateFieldLooseBase(this,w)[w].entryWrapper);if(babelHelpers.classPrivateFieldLooseBase(this,A)[A]){t.Dom.append(this.getRemoveInputButton(babelHelpers.classPrivateFieldLooseBase(this,w)[w].layout),babelHelpers.classPrivateFieldLooseBase(this,w)[w].entryWrapper)}t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,w)[w].fieldValueInput,babelHelpers.classPrivateFieldLooseBase(this,w)[w].layout);babelHelpers.classPrivateFieldLooseBase(this,g)[g].render({inputNode:babelHelpers.classPrivateFieldLooseBase(this,w)[w].userInput,mapBindElement:babelHelpers.classPrivateFieldLooseBase(this,E)[E],controlWrapper:babelHelpers.classPrivateFieldLooseBase(this,w)[w].layout,fieldsContainer:babelHelpers.classPrivateFieldLooseBase(this,w)[w].fieldsContainer});return babelHelpers.classPrivateFieldLooseBase(this,w)[w].layout}getUserInputSizeClass(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T]?"ui-ctl-wd":"ui-ctl-w100"}getLayoutSizeClass(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T]?"compact":""}getRemoveInputButton(e){const s=t.Tag.render(m||(m=u`
			<span class="uf-address-search-input-remove"></span>
		`));t.Event.bind(s,"click",(e=>{this.emit(N.onRemoveInputButtonClickedEvent)}));return s}destroy(){if(!babelHelpers.classPrivateFieldLooseBase(this,w)[w].layout){return}if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]){babelHelpers.classPrivateFieldLooseBase(this,g)[g].destroy()}if(babelHelpers.classPrivateFieldLooseBase(this,I)[I]&&babelHelpers.classPrivateFieldLooseBase(this,I)[I].id>0){t.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,w)[w].layout);const e=t.Tag.render(y||(y=u`<input type="hidden" name="${0}" value="${0}_del" />`),babelHelpers.classPrivateFieldLooseBase(this,D)[D],babelHelpers.classPrivateFieldLooseBase(this,I)[I].id);t.Dom.append(e,babelHelpers.classPrivateFieldLooseBase(this,w)[w].layout);this.emitFieldChangedEvent()}else{t.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,w)[w].layout)}babelHelpers.classPrivateFieldLooseBase(this,_)[_]=true}isDestroyed(){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}onAddressChanged(e){const s=parseInt(babelHelpers.classPrivateFieldLooseBase(this,M)[M]);const a=e.data.address;if(!a){return}if(s&&parseInt(a.id)!==s){a.id=s}babelHelpers.classPrivateFieldLooseBase(this,w)[w].fieldValueInput.value=this.getChangedAddressFieldValue(a);this.emitFieldChangedEvent()}onWidgetStateChangedEvent(e){const s=e.data.state;babelHelpers.classPrivateFieldLooseBase(this,j)[j]=s===a.State.DATA_LOADING;this.refreshInputIcon()}onFeatureEvent(e){if(e.data.feature instanceof a.AutocompleteFeature){babelHelpers.classPrivateFieldLooseBase(this,K)[K]=e.data.eventCode===a.AutocompleteFeature.searchStartedEvent;this.refreshInputIcon()}}isInputLoading(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]||babelHelpers.classPrivateFieldLooseBase(this,K)[K]}refreshInputIcon(){if(!babelHelpers.classPrivateFieldLooseBase(this,w)[w].inputIcon){return}if(this.isInputLoading()){t.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,w)[w].inputIcon,"ui-ctl-icon-clear");t.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,w)[w].inputIcon,"ui-ctl-icon-loader")}else{t.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,w)[w].inputIcon,"ui-ctl-icon-loader");t.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,w)[w].inputIcon,"ui-ctl-icon-clear")}}getInitialAddressFieldValue(){var e,s;let a="";if(((e=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:e.id)==0){if(babelHelpers.classPrivateFieldLooseBase(this,I)[I].location){a=t.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,I)[I].toJson())}else{a=`${babelHelpers.classPrivateFieldLooseBase(this,I)[I].getFieldValue(l.AddressType.ADDRESS_LINE_2)}|${babelHelpers.classPrivateFieldLooseBase(this,I)[I].latitude};${babelHelpers.classPrivateFieldLooseBase(this,I)[I].longitude}`}}else if(((s=babelHelpers.classPrivateFieldLooseBase(this,I)[I])==null?void 0:s.id)>0){a=`${this.getFormattedAddress(babelHelpers.classPrivateFieldLooseBase(this,I)[I])}|${babelHelpers.classPrivateFieldLooseBase(this,I)[I].latitude};${babelHelpers.classPrivateFieldLooseBase(this,I)[I].longitude}|${babelHelpers.classPrivateFieldLooseBase(this,I)[I].id}`}return a}getChangedAddressFieldValue(e){return e.toJson()}getFormattedAddress(e){var s;const a=new l.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));return(s=e.toString(a,l.AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA))!=null?s:""}onInputIconClick(){if(this.isInputLoading()){return}babelHelpers.classPrivateFieldLooseBase(this,w)[w].userInput.focus();babelHelpers.classPrivateFieldLooseBase(this,g)[g].resetView();babelHelpers.classPrivateFieldLooseBase(this,g)[g].address=null;if(babelHelpers.classPrivateFieldLooseBase(this,I)[I]&&babelHelpers.classPrivateFieldLooseBase(this,I)[I].id>0){babelHelpers.classPrivateFieldLooseBase(this,w)[w].fieldValueInput.value=babelHelpers.classPrivateFieldLooseBase(this,I)[I].id+"_del"}else{babelHelpers.classPrivateFieldLooseBase(this,w)[w].fieldValueInput.value=""}this.emitFieldChangedEvent()}onDetailsToggleClick(){if(!babelHelpers.classPrivateFieldLooseBase(this,w)[w].fieldsContainer||!babelHelpers.classPrivateFieldLooseBase(this,w)[w].detailsToggle){return}const e=babelHelpers.classPrivateFieldLooseBase(this,w)[w].fieldsContainer;const s=babelHelpers.classPrivateFieldLooseBase(this,w)[w].detailsToggle;if(babelHelpers.classPrivateFieldLooseBase(this,S)[S]&&t.Dom.hasClass(e,"visible")){t.Dom.removeClass(e,"visible");s.innerText=t.Loc.getMessage("ADDRESS_USERFIELD_DETAILS")}else{t.Dom.addClass(e,"visible");s.innerText=t.Loc.getMessage("ADDRESS_USERFIELD_NO_DETAILS")}babelHelpers.classPrivateFieldLooseBase(this,S)[S]=!babelHelpers.classPrivateFieldLooseBase(this,S)[S]}emitFieldChangedEvent(){BX.onCustomEvent(window,"onUIEntityEditorUserFieldExternalChanged",[babelHelpers.classPrivateFieldLooseBase(this,C)[C]]);BX.onCustomEvent(window,"onCrmEntityEditorUserFieldExternalChanged",[babelHelpers.classPrivateFieldLooseBase(this,C)[C]])}}N.onRemoveInputButtonClickedEvent="onRemoveInputButtonClicked";let R=e=>e,W,$,k;var X=babelHelpers.classPrivateFieldLooseKey("fieldName");var U=babelHelpers.classPrivateFieldLooseKey("fieldFormName");var V=babelHelpers.classPrivateFieldLooseKey("addresses");var x=babelHelpers.classPrivateFieldLooseKey("inputsWrapper");var G=babelHelpers.classPrivateFieldLooseKey("isMultiple");var z=babelHelpers.classPrivateFieldLooseKey("isCompactMode");var J=babelHelpers.classPrivateFieldLooseKey("showMap");var Y=babelHelpers.classPrivateFieldLooseKey("inputs");class q extends o{constructor(e){super(e);Object.defineProperty(this,X,{writable:true,value:""});Object.defineProperty(this,U,{writable:true,value:""});Object.defineProperty(this,V,{writable:true,value:[]});Object.defineProperty(this,x,{writable:true,value:null});Object.defineProperty(this,G,{writable:true,value:false});Object.defineProperty(this,z,{writable:true,value:false});Object.defineProperty(this,J,{writable:true,value:true});Object.defineProperty(this,Y,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,X)[X]=e.fieldName;babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e.fieldFormName;babelHelpers.classPrivateFieldLooseBase(this,V)[V]=e.addresses;babelHelpers.classPrivateFieldLooseBase(this,G)[G]=e.isMultiple;babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e.compactMode;babelHelpers.classPrivateFieldLooseBase(this,J)[J]=e.showMap}layout(){const e=t.Tag.render(W||(W=R`<div class="address-edit-wrapper"></div>`));const s=t.Tag.render($||($=R`<div class="address-inputs-wrapper"></div>`));if(babelHelpers.classPrivateFieldLooseBase(this,V)[V].length>0){babelHelpers.classPrivateFieldLooseBase(this,V)[V].forEach((e=>{const a=this.createInputForAddress(e);t.Dom.append(a.layout(),s)}))}else{const e=this.createInputForAddress();t.Dom.append(e.layout(),s)}t.Dom.append(s,e);babelHelpers.classPrivateFieldLooseBase(this,x)[x]=s;if(babelHelpers.classPrivateFieldLooseBase(this,G)[G]){const s=t.Tag.render(k||(k=R`<input type="button" value="${0}" />`),t.Loc.getMessage("ADDRESS_USERFIELD_ADD_INPUT"));t.Event.bind(s,"click",this.addInput.bind(this));t.Dom.append(s,e)}t.Dom.append(e,this.getWrapper());return this.getWrapper()}addInput(){if(!babelHelpers.classPrivateFieldLooseBase(this,x)[x]){return}const e=this.createInputForAddress();t.Dom.append(e.layout(),babelHelpers.classPrivateFieldLooseBase(this,x)[x])}createInputForAddress(e){var s;const a=new N({wrapper:this.getWrapper(),address:e,fieldName:babelHelpers.classPrivateFieldLooseBase(this,X)[X],fieldFormName:babelHelpers.classPrivateFieldLooseBase(this,U)[U],enableRemoveButton:babelHelpers.classPrivateFieldLooseBase(this,G)[G],initialAddressId:(s=parseInt(e==null?void 0:e.id))!=null?s:null,isCompactMode:babelHelpers.classPrivateFieldLooseBase(this,z)[z],showMap:babelHelpers.classPrivateFieldLooseBase(this,J)[J]});i.EventEmitter.subscribe(a,N.onRemoveInputButtonClickedEvent,this.removeInput.bind(this,a));babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].push(a);return a}removeInput(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].filter((e=>!e.isDestroyed())).length;if(s>1){e.destroy()}}}var Q=babelHelpers.classPrivateFieldLooseKey("mode");var Z=babelHelpers.classPrivateFieldLooseKey("wrapper");var ee=babelHelpers.classPrivateFieldLooseKey("addresses");var se=babelHelpers.classPrivateFieldLooseKey("isMultiple");var ae=babelHelpers.classPrivateFieldLooseKey("showMap");var le=babelHelpers.classPrivateFieldLooseKey("fieldConfig");var te=babelHelpers.classPrivateFieldLooseKey("additionalProperties");class ie{static init(e){var s;const a=e.mode;const i=document.getElementById(e.wrapperId);if(!i){return}let r=[];const o=e.addressData;o.forEach((e=>{if(t.Type.isObject(e)){r.push(new l.Address(e))}}));const d=(s=e.showMap)!=null?s:true;let b={addresses:r,wrapper:i,mode:a,fieldConfig:{fieldName:e.fieldName,fieldFormName:e.fieldFormName},isMultiple:e.isMultiple,showMap:d};if(e.additionalProperties){b.additionalProperties=e.additionalProperties}const n=new ie(b);n.layout()}constructor(e){Object.defineProperty(this,Q,{writable:true,value:ie.VIEW_MODE});Object.defineProperty(this,Z,{writable:true,value:void 0});Object.defineProperty(this,ee,{writable:true,value:void 0});Object.defineProperty(this,se,{writable:true,value:false});Object.defineProperty(this,ae,{writable:true,value:true});Object.defineProperty(this,le,{writable:true,value:{}});Object.defineProperty(this,te,{writable:true,value:{}});babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=e.mode;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e.wrapper;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=e.addresses;babelHelpers.classPrivateFieldLooseBase(this,le)[le]=e.fieldConfig;babelHelpers.classPrivateFieldLooseBase(this,se)[se]=e.isMultiple;babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=e.showMap;if(e.additionalProperties){babelHelpers.classPrivateFieldLooseBase(this,te)[te]=e.additionalProperties}}layout(){let e=null;if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]===ie.VIEW_MODE){e=new v({wrapper:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z],addresses:babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]})}if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]===ie.EDIT_MODE){var s;e=new q({wrapper:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z],fieldName:babelHelpers.classPrivateFieldLooseBase(this,le)[le].fieldName,fieldFormName:babelHelpers.classPrivateFieldLooseBase(this,le)[le].fieldFormName,addresses:babelHelpers.classPrivateFieldLooseBase(this,ee)[ee],isMultiple:babelHelpers.classPrivateFieldLooseBase(this,se)[se],compactMode:(s=babelHelpers.classPrivateFieldLooseBase(this,te)[te].compactMode)!=null?s:false,showMap:babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]})}if(e){e.layout()}}}ie.VIEW_MODE="view";ie.EDIT_MODE="edit";const re=t.Reflection.namespace("BX.Fileman.UserField");re.AddressField=ie})(this.BX.Fileman.Userfield=this.BX.Fileman.Userfield||{},BX,BX.Location.Widget,BX.Location.Core,BX,BX.Event);
//# sourceMappingURL=address_widget.bundle.map.js