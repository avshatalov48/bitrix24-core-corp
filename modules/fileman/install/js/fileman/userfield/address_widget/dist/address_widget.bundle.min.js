this.BX=this.BX||{};this.BX.Fileman=this.BX.Fileman||{};(function(e,s,a,l,t){"use strict";var i=babelHelpers.classPrivateFieldLooseKey("wrapper");class r{constructor(e){Object.defineProperty(this,i,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,i)[i]=e.wrapper}getWrapper(){return babelHelpers.classPrivateFieldLooseBase(this,i)[i]}layout(){throw new Error("please implement the layout() method")}}let o=e=>e,d,b;var n=babelHelpers.classPrivateFieldLooseKey("addresses");var p=babelHelpers.classPrivateFieldLooseKey("widgets");class c extends r{constructor(e){super(e);Object.defineProperty(this,n,{writable:true,value:[]});Object.defineProperty(this,p,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.addresses}destroyWidgets(){babelHelpers.classPrivateFieldLooseBase(this,p)[p].forEach((e=>{e.destroy()}))}layout(){const e=l.Tag.render(d||(d=o`<div></div>`));babelHelpers.classPrivateFieldLooseBase(this,n)[n].forEach((s=>{l.Dom.append(this.getLayoutForAddress(s),e)}));l.Dom.append(e,this.getWrapper());return this.getWrapper()}getLayoutForAddress(e){const t=new s.Factory;const i=t.createAddressWidget({address:e,mode:a.ControlMode.view,popupOptions:{offsetLeft:14},popupBindOptions:{forceBindPosition:true,position:"right"},mapBehavior:"auto",useFeatures:{fields:false,map:true,autocomplete:false}});babelHelpers.classPrivateFieldLooseBase(this,p)[p].push(i);const r=l.Tag.render(b||(b=o`
			<span class="fields address field-item view">
				<span class="ui-link ui-link-dark ui-link-dotted">${0}</span>
			</span>
		`),this.getFormattedAddress(e));i.render({mapBindElement:r,controlWrapper:r});return r}getFormattedAddress(e){var s;const l=new a.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));return(s=e.toString(l,a.AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA))!=null?s:""}}let v=e=>e,u,h,F,P,L,B,H,f,m;var y=babelHelpers.classPrivateFieldLooseKey("widget");var g=babelHelpers.classPrivateFieldLooseKey("nodes");var w=babelHelpers.classPrivateFieldLooseKey("wrapper");var E=babelHelpers.classPrivateFieldLooseKey("address");var I=babelHelpers.classPrivateFieldLooseKey("fieldName");var C=babelHelpers.classPrivateFieldLooseKey("fieldFormName");var D=babelHelpers.classPrivateFieldLooseKey("showMap");var O=babelHelpers.classPrivateFieldLooseKey("enableRemoveButton");var A=babelHelpers.classPrivateFieldLooseKey("isCompactMode");var T=babelHelpers.classPrivateFieldLooseKey("initialAddressId");var M=babelHelpers.classPrivateFieldLooseKey("areDetailsShown");var S=babelHelpers.classPrivateFieldLooseKey("isLoading");var j=babelHelpers.classPrivateFieldLooseKey("isDropdownLoading");var K=babelHelpers.classPrivateFieldLooseKey("isDestroyed");class _ extends t.EventEmitter{constructor(e){super();Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:{}});Object.defineProperty(this,w,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:true});Object.defineProperty(this,O,{writable:true,value:false});Object.defineProperty(this,A,{writable:true,value:false});Object.defineProperty(this,T,{writable:true,value:null});Object.defineProperty(this,M,{writable:true,value:false});Object.defineProperty(this,S,{writable:true,value:false});Object.defineProperty(this,j,{writable:true,value:false});Object.defineProperty(this,K,{writable:true,value:false});this.setEventNamespace("Fileman.EditEntry");babelHelpers.classPrivateFieldLooseBase(this,w)[w]=e.wrapper;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e.fieldName;babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e.fieldFormName;babelHelpers.classPrivateFieldLooseBase(this,O)[O]=e.enableRemoveButton;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e.initialAddressId;babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e.showMap;if(e.address){babelHelpers.classPrivateFieldLooseBase(this,E)[E]=e.address}if(e.isCompactMode){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e.isCompactMode}}layout(){const e=new s.Factory;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e.createAddressWidget({address:babelHelpers.classPrivateFieldLooseBase(this,E)[E],mode:a.ControlMode.edit,popupOptions:{offsetLeft:14},popupBindOptions:{forceBindPosition:true,position:"right"},mapBehavior:"auto",useFeatures:{fields:true,map:babelHelpers.classPrivateFieldLooseBase(this,D)[D],autocomplete:true}});babelHelpers.classPrivateFieldLooseBase(this,g)[g].userInput=l.Tag.render(u||(u=v`<input type="text" class="ui-ctl-element" />`));babelHelpers.classPrivateFieldLooseBase(this,g)[g].fieldsContainer=l.Tag.render(h||(h=v`<div class="location-fields-control-block"></div>`));babelHelpers.classPrivateFieldLooseBase(this,g)[g].detailsToggle=l.Tag.render(F||(F=v`<span class="ui-link ui-link-secondary address-control-mode-switch">${0}</span>`),l.Loc.getMessage("ADDRESS_USERFIELD_DETAILS"));l.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,g)[g].detailsToggle,"click",this.onDetailsToggleClick.bind(this));let t=this.getInitialAddressFieldValue();babelHelpers.classPrivateFieldLooseBase(this,g)[g].fieldValueInput=l.Tag.render(P||(P=v`<input type="hidden" name="${0}" value="${0}" />`),babelHelpers.classPrivateFieldLooseBase(this,C)[C],t);babelHelpers.classPrivateFieldLooseBase(this,g)[g].inputIcon=l.Tag.render(L||(L=v`<button type="button" class="ui-ctl-after ui-ctl-icon-clear"></button>`));l.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,g)[g].inputIcon,"click",this.onInputIconClick.bind(this));babelHelpers.classPrivateFieldLooseBase(this,y)[y].subscribeOnAddressChangedEvent(this.onAddressChanged.bind(this));babelHelpers.classPrivateFieldLooseBase(this,y)[y].subscribeOnStateChangedEvent(this.onWidgetStateChangedEvent.bind(this));babelHelpers.classPrivateFieldLooseBase(this,y)[y].subscribeOnFeatureEvent(this.onFeatureEvent.bind(this));babelHelpers.classPrivateFieldLooseBase(this,g)[g].entryWrapper=l.Tag.render(B||(B=v`
			<div class="edit-entry-input-wrapper">
				<div class="fields address field-item edit ui-ctl ui-ctl-after-icon ${0}">
					${0}
					${0}
					${0}
				</div>
			</div>
		`),this.getUserInputSizeClass(),babelHelpers.classPrivateFieldLooseBase(this,g)[g].userInput,babelHelpers.classPrivateFieldLooseBase(this,g)[g].fieldsContainer,babelHelpers.classPrivateFieldLooseBase(this,g)[g].inputIcon);babelHelpers.classPrivateFieldLooseBase(this,g)[g].layout=l.Tag.render(H||(H=v`
			<div class="edit-entry-layout-wrapper ${0}">
				<div class="address-control-mode-switch-wrapper">
					${0}
				</div>
				${0}
			</div>
		`),this.getLayoutSizeClass(),babelHelpers.classPrivateFieldLooseBase(this,g)[g].detailsToggle,babelHelpers.classPrivateFieldLooseBase(this,g)[g].entryWrapper);if(babelHelpers.classPrivateFieldLooseBase(this,O)[O]){l.Dom.append(this.getRemoveInputButton(babelHelpers.classPrivateFieldLooseBase(this,g)[g].layout),babelHelpers.classPrivateFieldLooseBase(this,g)[g].entryWrapper)}l.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,g)[g].fieldValueInput,babelHelpers.classPrivateFieldLooseBase(this,g)[g].layout);babelHelpers.classPrivateFieldLooseBase(this,y)[y].render({inputNode:babelHelpers.classPrivateFieldLooseBase(this,g)[g].userInput,mapBindElement:babelHelpers.classPrivateFieldLooseBase(this,w)[w],controlWrapper:babelHelpers.classPrivateFieldLooseBase(this,g)[g].layout,fieldsContainer:babelHelpers.classPrivateFieldLooseBase(this,g)[g].fieldsContainer});return babelHelpers.classPrivateFieldLooseBase(this,g)[g].layout}getUserInputSizeClass(){return babelHelpers.classPrivateFieldLooseBase(this,A)[A]?"ui-ctl-wd":"ui-ctl-w100"}getLayoutSizeClass(){return babelHelpers.classPrivateFieldLooseBase(this,A)[A]?"compact":""}getRemoveInputButton(e){const s=l.Tag.render(f||(f=v`
			<span class="uf-address-search-input-remove"></span>
		`));l.Event.bind(s,"click",(e=>{this.emit(_.onRemoveInputButtonClickedEvent)}));return s}destroy(){if(!babelHelpers.classPrivateFieldLooseBase(this,g)[g].layout){return}if(babelHelpers.classPrivateFieldLooseBase(this,y)[y]){babelHelpers.classPrivateFieldLooseBase(this,y)[y].destroy()}if(babelHelpers.classPrivateFieldLooseBase(this,E)[E]&&babelHelpers.classPrivateFieldLooseBase(this,E)[E].id>0){l.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,g)[g].layout);const e=l.Tag.render(m||(m=v`<input type="hidden" name="${0}" value="${0}_del" />`),babelHelpers.classPrivateFieldLooseBase(this,C)[C],babelHelpers.classPrivateFieldLooseBase(this,E)[E].id);l.Dom.append(e,babelHelpers.classPrivateFieldLooseBase(this,g)[g].layout);this.emitFieldChangedEvent()}else{l.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,g)[g].layout)}babelHelpers.classPrivateFieldLooseBase(this,K)[K]=true}isDestroyed(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K]}onAddressChanged(e){const s=parseInt(babelHelpers.classPrivateFieldLooseBase(this,T)[T]);const a=e.data.address;if(!a){return}if(s&&parseInt(a.id)!==s){a.id=s}babelHelpers.classPrivateFieldLooseBase(this,g)[g].fieldValueInput.value=this.getChangedAddressFieldValue(a);this.emitFieldChangedEvent()}onWidgetStateChangedEvent(e){const a=e.data.state;babelHelpers.classPrivateFieldLooseBase(this,S)[S]=a===s.State.DATA_LOADING;this.refreshInputIcon()}onFeatureEvent(e){if(e.data.feature instanceof s.AutocompleteFeature){babelHelpers.classPrivateFieldLooseBase(this,j)[j]=e.data.eventCode===s.AutocompleteFeature.searchStartedEvent;this.refreshInputIcon()}}isInputLoading(){return babelHelpers.classPrivateFieldLooseBase(this,S)[S]||babelHelpers.classPrivateFieldLooseBase(this,j)[j]}refreshInputIcon(){if(!babelHelpers.classPrivateFieldLooseBase(this,g)[g].inputIcon){return}if(this.isInputLoading()){l.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,g)[g].inputIcon,"ui-ctl-icon-clear");l.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,g)[g].inputIcon,"ui-ctl-icon-loader")}else{l.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,g)[g].inputIcon,"ui-ctl-icon-loader");l.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,g)[g].inputIcon,"ui-ctl-icon-clear")}}getInitialAddressFieldValue(){var e,s;let l="";if(((e=babelHelpers.classPrivateFieldLooseBase(this,E)[E])==null?void 0:e.id)===0){l=`${babelHelpers.classPrivateFieldLooseBase(this,E)[E].getFieldValue(a.AddressType.ADDRESS_LINE_2)}|${babelHelpers.classPrivateFieldLooseBase(this,E)[E].latitude};${babelHelpers.classPrivateFieldLooseBase(this,E)[E].longitude}`}else if(((s=babelHelpers.classPrivateFieldLooseBase(this,E)[E])==null?void 0:s.id)>0){l=`${this.getFormattedAddress(babelHelpers.classPrivateFieldLooseBase(this,E)[E])}|${babelHelpers.classPrivateFieldLooseBase(this,E)[E].latitude};${babelHelpers.classPrivateFieldLooseBase(this,E)[E].longitude}|${babelHelpers.classPrivateFieldLooseBase(this,E)[E].id}`}return l}getChangedAddressFieldValue(e){return e.toJson()}getFormattedAddress(e){var s;const l=new a.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));return(s=e.toString(l,a.AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA))!=null?s:""}onInputIconClick(){if(this.isInputLoading()){return}babelHelpers.classPrivateFieldLooseBase(this,g)[g].userInput.focus();babelHelpers.classPrivateFieldLooseBase(this,y)[y].resetView();babelHelpers.classPrivateFieldLooseBase(this,y)[y].address=null;if(babelHelpers.classPrivateFieldLooseBase(this,E)[E]&&babelHelpers.classPrivateFieldLooseBase(this,E)[E].id>0){babelHelpers.classPrivateFieldLooseBase(this,g)[g].fieldValueInput.value=babelHelpers.classPrivateFieldLooseBase(this,E)[E].id+"_del"}else{babelHelpers.classPrivateFieldLooseBase(this,g)[g].fieldValueInput.value=""}this.emitFieldChangedEvent()}onDetailsToggleClick(){if(!babelHelpers.classPrivateFieldLooseBase(this,g)[g].fieldsContainer||!babelHelpers.classPrivateFieldLooseBase(this,g)[g].detailsToggle){return}const e=babelHelpers.classPrivateFieldLooseBase(this,g)[g].fieldsContainer;const s=babelHelpers.classPrivateFieldLooseBase(this,g)[g].detailsToggle;if(babelHelpers.classPrivateFieldLooseBase(this,M)[M]&&l.Dom.hasClass(e,"visible")){l.Dom.removeClass(e,"visible");s.innerText=l.Loc.getMessage("ADDRESS_USERFIELD_DETAILS")}else{l.Dom.addClass(e,"visible");s.innerText=l.Loc.getMessage("ADDRESS_USERFIELD_NO_DETAILS")}babelHelpers.classPrivateFieldLooseBase(this,M)[M]=!babelHelpers.classPrivateFieldLooseBase(this,M)[M]}emitFieldChangedEvent(){BX.onCustomEvent(window,"onUIEntityEditorUserFieldExternalChanged",[babelHelpers.classPrivateFieldLooseBase(this,I)[I]]);BX.onCustomEvent(window,"onCrmEntityEditorUserFieldExternalChanged",[babelHelpers.classPrivateFieldLooseBase(this,I)[I]])}}_.onRemoveInputButtonClickedEvent="onRemoveInputButtonClicked";let N=e=>e,R,W,$;var k=babelHelpers.classPrivateFieldLooseKey("fieldName");var U=babelHelpers.classPrivateFieldLooseKey("fieldFormName");var X=babelHelpers.classPrivateFieldLooseKey("addresses");var V=babelHelpers.classPrivateFieldLooseKey("inputsWrapper");var x=babelHelpers.classPrivateFieldLooseKey("isMultiple");var G=babelHelpers.classPrivateFieldLooseKey("isCompactMode");var z=babelHelpers.classPrivateFieldLooseKey("showMap");var Y=babelHelpers.classPrivateFieldLooseKey("inputs");class J extends r{constructor(e){super(e);Object.defineProperty(this,k,{writable:true,value:""});Object.defineProperty(this,U,{writable:true,value:""});Object.defineProperty(this,X,{writable:true,value:[]});Object.defineProperty(this,V,{writable:true,value:null});Object.defineProperty(this,x,{writable:true,value:false});Object.defineProperty(this,G,{writable:true,value:false});Object.defineProperty(this,z,{writable:true,value:true});Object.defineProperty(this,Y,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e.fieldName;babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e.fieldFormName;babelHelpers.classPrivateFieldLooseBase(this,X)[X]=e.addresses;babelHelpers.classPrivateFieldLooseBase(this,x)[x]=e.isMultiple;babelHelpers.classPrivateFieldLooseBase(this,G)[G]=e.compactMode;babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e.showMap}layout(){const e=l.Tag.render(R||(R=N`<div class="address-edit-wrapper"></div>`));const s=l.Tag.render(W||(W=N`<div class="address-inputs-wrapper"></div>`));if(babelHelpers.classPrivateFieldLooseBase(this,X)[X].length>0){babelHelpers.classPrivateFieldLooseBase(this,X)[X].forEach((e=>{const a=this.createInputForAddress(e);l.Dom.append(a.layout(),s)}))}else{const e=this.createInputForAddress();l.Dom.append(e.layout(),s)}l.Dom.append(s,e);babelHelpers.classPrivateFieldLooseBase(this,V)[V]=s;if(babelHelpers.classPrivateFieldLooseBase(this,x)[x]){const s=l.Tag.render($||($=N`<input type="button" value="${0}" />`),l.Loc.getMessage("ADDRESS_USERFIELD_ADD_INPUT"));l.Event.bind(s,"click",this.addInput.bind(this));l.Dom.append(s,e)}l.Dom.append(e,this.getWrapper());return this.getWrapper()}addInput(){if(!babelHelpers.classPrivateFieldLooseBase(this,V)[V]){return}const e=this.createInputForAddress();l.Dom.append(e.layout(),babelHelpers.classPrivateFieldLooseBase(this,V)[V])}createInputForAddress(e){var s;const a=new _({wrapper:this.getWrapper(),address:e,fieldName:babelHelpers.classPrivateFieldLooseBase(this,k)[k],fieldFormName:babelHelpers.classPrivateFieldLooseBase(this,U)[U],enableRemoveButton:babelHelpers.classPrivateFieldLooseBase(this,x)[x],initialAddressId:(s=parseInt(e==null?void 0:e.id))!=null?s:null,isCompactMode:babelHelpers.classPrivateFieldLooseBase(this,G)[G],showMap:babelHelpers.classPrivateFieldLooseBase(this,z)[z]});t.EventEmitter.subscribe(a,_.onRemoveInputButtonClickedEvent,this.removeInput.bind(this,a));babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].push(a);return a}removeInput(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].filter((e=>!e.isDestroyed())).length;if(s>1){e.destroy()}}}var q=babelHelpers.classPrivateFieldLooseKey("mode");var Q=babelHelpers.classPrivateFieldLooseKey("wrapper");var Z=babelHelpers.classPrivateFieldLooseKey("addresses");var ee=babelHelpers.classPrivateFieldLooseKey("isMultiple");var se=babelHelpers.classPrivateFieldLooseKey("showMap");var ae=babelHelpers.classPrivateFieldLooseKey("fieldConfig");var le=babelHelpers.classPrivateFieldLooseKey("additionalProperties");class te{static init(e){var s;const t=e.mode;const i=document.getElementById(e.wrapperId);if(!i){return}let r=[];const o=e.addressData;o.forEach((e=>{if(l.Type.isObject(e)){r.push(new a.Address(e))}}));const d=(s=e.showMap)!=null?s:true;let b={addresses:r,wrapper:i,mode:t,fieldConfig:{fieldName:e.fieldName,fieldFormName:e.fieldFormName},isMultiple:e.isMultiple,showMap:d};if(e.additionalProperties){b.additionalProperties=e.additionalProperties}const n=new te(b);n.layout()}constructor(e){Object.defineProperty(this,q,{writable:true,value:te.VIEW_MODE});Object.defineProperty(this,Q,{writable:true,value:void 0});Object.defineProperty(this,Z,{writable:true,value:void 0});Object.defineProperty(this,ee,{writable:true,value:false});Object.defineProperty(this,se,{writable:true,value:true});Object.defineProperty(this,ae,{writable:true,value:{}});Object.defineProperty(this,le,{writable:true,value:{}});babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e.mode;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=e.wrapper;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e.addresses;babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=e.fieldConfig;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=e.isMultiple;babelHelpers.classPrivateFieldLooseBase(this,se)[se]=e.showMap;if(e.additionalProperties){babelHelpers.classPrivateFieldLooseBase(this,le)[le]=e.additionalProperties}}layout(){let e=null;if(babelHelpers.classPrivateFieldLooseBase(this,q)[q]===te.VIEW_MODE){e=new c({wrapper:babelHelpers.classPrivateFieldLooseBase(this,Q)[Q],addresses:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]})}if(babelHelpers.classPrivateFieldLooseBase(this,q)[q]===te.EDIT_MODE){var s;e=new J({wrapper:babelHelpers.classPrivateFieldLooseBase(this,Q)[Q],fieldName:babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].fieldName,fieldFormName:babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].fieldFormName,addresses:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z],isMultiple:babelHelpers.classPrivateFieldLooseBase(this,ee)[ee],compactMode:(s=babelHelpers.classPrivateFieldLooseBase(this,le)[le].compactMode)!=null?s:false,showMap:babelHelpers.classPrivateFieldLooseBase(this,se)[se]})}if(e){e.layout()}}}te.VIEW_MODE="view";te.EDIT_MODE="edit";const ie=l.Reflection.namespace("BX.Fileman.UserField");ie.AddressField=te})(this.BX.Fileman.Userfield=this.BX.Fileman.Userfield||{},BX.Location.Widget,BX.Location.Core,BX,BX.Event);
//# sourceMappingURL=address_widget.bundle.map.js