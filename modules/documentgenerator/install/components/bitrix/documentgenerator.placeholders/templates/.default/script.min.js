(function(){BX.namespace("BX.DocumentGenerator");BX.DocumentGenerator.Placeholders={popupCopyMessage:null,filterId:"documentgenerator-placeholders-filter",getFilterNode:function(){return BX("popup-window-content-documentgenerator-placeholders-filter_search_container")},filter:null,getFilter:function(){if(!this.filter){var e=BX.Main.filterManager.getById(this.filterId);this.filter=e.getApi()}return this.filter},provider:null,moduleId:null,rootProviders:{}};BX.DocumentGenerator.Placeholders.init=function(e){this.moduleId=e.moduleId;this.maxDepthProviderLevel=e.maxDepthProviderLevel||2;BX.addCustomEvent("UI::Select::change",BX.proxy(this.onSelectChange,this));BX.addCustomEvent("BX.Main.Filter:show",BX.proxy(this.onShowFilter,this))};BX.DocumentGenerator.Placeholders.onSelectChange=function(e,t){if(!BX.isParentForNode(this.getFilterNode(),e.input)){return}this.removeFields(e);this.addFields(t)};BX.DocumentGenerator.Placeholders.getProviderFields=function(){var e=this.getFilter(),t=[];var r=e.parent.presets.getFields();if(!BX.type.isArray(r)){return t}for(var i in r){if(r.hasOwnProperty(i)){var o=r[i].getAttribute("data-name");if(o&&o.indexOf("provider")>=0){t.push(r[i])}}}return t};BX.DocumentGenerator.Placeholders.getSelectedData=function(e,t){t=t||"value";var r=BX.findChildByClassName(e,"main-ui-select");if(r){return BX.parseJSON(r.dataset[t])}};BX.DocumentGenerator.Placeholders.removeFields=function(e){var t=this.getProviderFields(),r;var i=false;for(r=0;r<t.length;r++){if(i){this.getFilter().parent.presets.removeField(t[r])}if(BX.findChildByClassName(t[r],"main-ui-select")===e.node){i=true}}};BX.DocumentGenerator.Placeholders.addFields=function(e){var t=this.getProviderFields(),r,i=e.PLACEHOLDER||"";var o=t.length;var s=1;for(r=0;r<o;r++){var n=this.getSelectedData(t[r]);if(n&&n.CLASS){n.CLASS=n.CLASS.toLowerCase();if(this.rootProviders[n.CLASS]){s++}}}this.provider=this.getSelectedData(t[0]).VALUE;var a=e.OPTIONS;if(!BX.Type.isArray(a)){a=[]}BX.ajax.runAction("documentgenerator.dataprovider.getProviderFields",{data:{provider:e.CLASS,module:this.moduleId,options:a,placeholder:i}}).then(BX.proxy(function(t){if(i.length>0){i+="."}var n={LABEL:e.NAME,TYPE:"SELECT",ITEMS:[{NAME:BX.message("DOCGEN_PLACEHOLDERS_FIELD_EMPTY"),VALUE:""}],NAME:"provider"+o};for(r=0;r<t.data.fields.length;r++){if(!t.data.fields[r].provider){continue}if(s>this.maxDepthProviderLevel&&this.rootProviders[t.data.fields[r].provider.toLowerCase()]){continue}n.ITEMS.push({NAME:t.data.fields[r].title,VALUE:i+t.data.fields[r].placeholder,OPTIONS:t.data.fields[r].options,CLASS:t.data.fields[r].provider})}if(n.ITEMS.length>1){var a=this.getFilter().parent.presets;a.addField(n)}},this)).then(function(e){})};BX.DocumentGenerator.Placeholders.onShowFilter=function(){BX.removeCustomEvent("BX.Main.Filter:show",BX.proxy(this.onShowFilter,this));var e=this.getProviderFields();this.provider=this.getSelectedData(e[0]).VALUE;var t=this.getSelectedData(e[0],"items");if(t){for(var r=0;r<t.length;r++){if(t[r].CLASS){this.rootProviders[t[r].CLASS.toLowerCase()]=1}}}if(this.provider){this.addFields(this.getSelectedData(e[0]))}};BX.DocumentGenerator.Placeholders.Copy=function(e,t){var r;if(BX.clipboard.copy("{"+t+"}")){r=BX.message("DOCGEN_PLACEHOLDERS_COPY_PLACEHOLDER")}else{r=BX.message("DOCGEN_PLACEHOLDERS_COPY_PLACEHOLDER")}BX.DocumentGenerator.Placeholders.showCopyLinkPopup(e,r)};BX.DocumentGenerator.Placeholders.showCopyLinkPopup=function(e,t){if(this.popupCopyMessage){return}this.popupCopyMessage=new BX.PopupWindow("crm-popup-copy-link",e,{className:"crm-popup-copy-link",bindPosition:{position:"top"},offsetLeft:30,darkMode:true,angle:true,content:t});this.popupCopyMessage.show();setTimeout(function(){BX.hide(BX(this.popupCopyMessage.uniquePopupId))}.bind(this),2e3);setTimeout(function(){this.popupCopyMessage.destroy();this.popupCopyMessage=null}.bind(this),2200)}})(window);
//# sourceMappingURL=script.map.js