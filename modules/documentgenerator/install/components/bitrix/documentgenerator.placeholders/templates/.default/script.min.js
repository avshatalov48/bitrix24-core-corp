(function(){BX.namespace("BX.DocumentGenerator");BX.DocumentGenerator.Placeholders={popupCopyMessage:null,filterId:"documentgenerator-placeholders-filter",getFilterNode:function(){return BX("popup-window-content-documentgenerator-placeholders-filter_search_container")},filter:null,getFilter:function(){if(!this.filter){var e=BX.Main.filterManager.getById(this.filterId);this.filter=e.getApi()}return this.filter},provider:null,moduleId:null,rootProviders:{}};BX.DocumentGenerator.Placeholders.init=function(e){this.moduleId=e.moduleId;this.maxDepthProviderLevel=e.maxDepthProviderLevel||2;BX.addCustomEvent("UI::Select::change",BX.proxy(this.onSelectChange,this));BX.addCustomEvent("BX.Main.Filter:show",BX.proxy(this.onShowFilter,this))};BX.DocumentGenerator.Placeholders.onSelectChange=function(e,t){if(!BX.isParentForNode(this.getFilterNode(),e.input)){return}this.removeFields(e);this.addFields(t)};BX.DocumentGenerator.Placeholders.getProviderFields=function(){var e=this.getFilter(),t=[];var i=e.parent.presets.getFields();if(!BX.type.isArray(i)){return t}for(var o in i){if(i.hasOwnProperty(o)){var r=i[o].getAttribute("data-name");if(r&&r.indexOf("provider")>=0){t.push(i[o])}}}return t};BX.DocumentGenerator.Placeholders.getSelectedData=function(e,t){t=t||"value";var i=BX.findChildByClassName(e,"main-ui-select");if(i){return BX.parseJSON(i.dataset[t])}};BX.DocumentGenerator.Placeholders.removeFields=function(e){var t=this.getProviderFields(),i;var o=false;for(i=0;i<t.length;i++){if(o){this.getFilter().parent.presets.removeField(t[i])}if(BX.findChildByClassName(t[i],"main-ui-select")===e.node){o=true}}};BX.DocumentGenerator.Placeholders.addFields=function(e){var t=this.getProviderFields(),i,o=e.PLACEHOLDER||"";var r=t.length;var s=1;for(i=0;i<r;i++){var n=this.getSelectedData(t[i]);if(n&&n.CLASS){n.CLASS=n.CLASS.toLowerCase();if(this.rootProviders[n.CLASS]){s++}}}this.provider=this.getSelectedData(t[0]).VALUE;BX.ajax.runAction("documentgenerator.dataprovider.getProviderFields",{data:{provider:e.CLASS,module:this.moduleId,options:e.OPTIONS,placeholder:o}}).then(BX.proxy(function(t){if(o.length>0){o+="."}var n={LABEL:e.NAME,TYPE:"SELECT",ITEMS:[{NAME:BX.message("DOCGEN_PLACEHOLDERS_FIELD_EMPTY"),VALUE:""}],NAME:"provider"+r};for(i=0;i<t.data.fields.length;i++){if(!t.data.fields[i].provider){continue}if(s>this.maxDepthProviderLevel&&this.rootProviders[t.data.fields[i].provider.toLowerCase()]){continue}n.ITEMS.push({NAME:t.data.fields[i].title,VALUE:o+t.data.fields[i].placeholder,OPTIONS:t.data.fields[i].options,CLASS:t.data.fields[i].provider})}if(n.ITEMS.length>1){var a=this.getFilter().parent.presets;a.addField(n)}},this)).then(function(e){})};BX.DocumentGenerator.Placeholders.onShowFilter=function(){BX.removeCustomEvent("BX.Main.Filter:show",BX.proxy(this.onShowFilter,this));var e=this.getProviderFields();this.provider=this.getSelectedData(e[0]).VALUE;var t=this.getSelectedData(e[0],"items");if(t){for(var i=0;i<t.length;i++){if(t[i].CLASS){this.rootProviders[t[i].CLASS.toLowerCase()]=1}}}if(this.provider){this.addFields(this.getSelectedData(e[0]))}};BX.DocumentGenerator.Placeholders.Copy=function(e,t){var i;if(BX.clipboard.copy("{"+t+"}")){i=BX.message("DOCGEN_PLACEHOLDERS_COPY_PLACEHOLDER")}else{i=BX.message("DOCGEN_PLACEHOLDERS_COPY_PLACEHOLDER")}BX.DocumentGenerator.Placeholders.showCopyLinkPopup(e,i)};BX.DocumentGenerator.Placeholders.showCopyLinkPopup=function(e,t){if(this.popupCopyMessage){return}this.popupCopyMessage=new BX.PopupWindow("crm-popup-copy-link",e,{className:"crm-popup-copy-link",bindPosition:{position:"top"},offsetLeft:30,darkMode:true,angle:true,content:t});this.popupCopyMessage.show();setTimeout(function(){BX.hide(BX(this.popupCopyMessage.uniquePopupId))}.bind(this),2e3);setTimeout(function(){this.popupCopyMessage.destroy();this.popupCopyMessage=null}.bind(this),2200)}})(window);
//# sourceMappingURL=script.map.js