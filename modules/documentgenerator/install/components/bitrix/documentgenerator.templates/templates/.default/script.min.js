(function(){BX.namespace("BX.DocumentGenerator");BX.DocumentGenerator.TemplateList={gridId:null,uploadUri:"",errorNode:"docgen-templates-error-message"};BX.DocumentGenerator.TemplateList.init=function(e,t){if(this.gridId){return}this.uploadUri=t.uploadUri||"";this.gridId=e;this.settingsButtonNode="docgen-templates-settings-button";BX.addCustomEvent("SidePanel.Slider:onMessage",function(e){if(e.getEventId()==="documentgenerator-add-template"){var t=e.getData();var n=t.templateId;if(n>0){var r=BX.Main.gridManager.getById(BX.DocumentGenerator.TemplateList.gridId);if(r){r.instance.reloadTable("GET",{},function(){BX.DocumentGenerator.TemplateList.highlightRow(n)})}}}});BX.addCustomEvent("Grid::rowMoved",BX.DocumentGenerator.TemplateList.onRowMoved);this.initSettingsMenu(t.settingsMenu)};BX.DocumentGenerator.TemplateList.delete=function(e){if(confirm(BX.message("DOCGEN_TEMPLATE_LIST_DELETE_CONFIRM"))){BX.hide(BX(BX.DocumentGenerator.TemplateList.errorNode));var t=BX.Main.gridManager.getById(BX.DocumentGenerator.TemplateList.gridId);if(t){t.instance.getLoader().show()}BX.ajax.runAction("documentgenerator.api.template.delete",{data:{id:e}}).then(function(t){var n=BX.Main.gridManager.getById(BX.DocumentGenerator.TemplateList.gridId);if(n){n.instance.getLoader().hide();n.instance.removeRow(e)}},function(e){var t=BX.Main.gridManager.getById(BX.DocumentGenerator.TemplateList.gridId);if(t){t.instance.getLoader().hide()}BX(BX.DocumentGenerator.TemplateList.errorNode).innerHTML=e.errors.pop().message;BX.show(BX(BX.DocumentGenerator.TemplateList.errorNode))})}};BX.DocumentGenerator.TemplateList.highlightRow=function(e){var t=BX.Main.gridManager.getById(BX.DocumentGenerator.TemplateList.gridId);if(t){var n=t.instance.getRows().getById(e);if(n){n.select()}}};BX.DocumentGenerator.TemplateList.edit=function(e){var t=BX.DocumentGenerator.TemplateList.uploadUri;if(e>0){t=BX.util.add_url_param(t,{ID:e})}if(BX.SidePanel){BX.SidePanel.Instance.open(t,{width:845,events:{onMessage:function(e){if(e.getEventId()==="numerator-saved-event"){var t=e.getData();var n=this.iframe.contentDocument.querySelector("#docs-template-num-select");if(n){var r=n.options;var i=true;for(var o=0;o<r.length;o++){var a=r[o];if(a.value===t.id){i=false;a.innerText=t.name}}if(i){n.appendChild(BX.create("option",{attrs:{value:t.id},text:t.name},this.iframe.contentDocument))}n.value=t.id}}}}})}else{top.location.href=t}};BX.DocumentGenerator.TemplateList.onRowMoved=function(e,t,n){BX.hide(BX(BX.DocumentGenerator.TemplateList.errorNode));if(n.getId()!==BX.DocumentGenerator.TemplateList.gridId){return}n=BX.Main.gridManager.getById(BX.DocumentGenerator.TemplateList.gridId);if(n){n.instance.getLoader().show()}BX.ajax.runComponentAction("bitrix:documentgenerator.templates","resortList",{data:{order:e},mode:"class"}).then(function(e){var t=BX.Main.gridManager.getById(BX.DocumentGenerator.TemplateList.gridId);if(t){t.instance.getLoader().hide()}},function(e){var t=BX.Main.gridManager.getById(BX.DocumentGenerator.TemplateList.gridId);if(t){t.instance.getLoader().hide()}BX(BX.DocumentGenerator.TemplateList.errorNode).innerHTML=e.errors.pop().message;BX.show(BX(BX.DocumentGenerator.TemplateList.errorNode))})};BX.DocumentGenerator.TemplateList.initSettingsMenu=function(e){if(BX.type.isArray(e)&&e.length>0){var t,n=e.length,r=[];for(t=0;t<n;t++){if(BX.type.isArray(e[t].items)&&e[t].items.length>0){var i,o=e[t].items.length;for(i=0;i<o;i++){e[t].items[i].onclick=function(e,t){if(BX.SidePanel){BX.SidePanel.Instance.open(t.uri,{width:845})}else{top.location.href=t.uri}if(BX.PopupMenu.getCurrentMenu()){BX.PopupMenu.getCurrentMenu().popupWindow.close()}}}}else{e[t].onclick=function(e,t){if(BX.SidePanel){BX.SidePanel.Instance.open(t.uri,{width:845})}else{top.location.href=t.uri}if(BX.PopupMenu.getCurrentMenu()){BX.PopupMenu.getCurrentMenu().popupWindow.close()}}}r.push(e[t])}BX.bind(BX(this.settingsButtonNode),"click",BX.proxy(function(){BX.PopupMenu.show(this.settingsButtonNode+"-menu",BX(this.settingsButtonNode),r,{offsetLeft:0,offsetTop:0,closeByEsc:true})},this))}};BX.DocumentGenerator.TemplateList.openMoreLink=function(e){if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=7622241");e.preventDefault()}}})(window);
//# sourceMappingURL=script.map.js