{"version":3,"file":"call.bundle.js","sources":["../src/hacks.js","../src/dialogs/background_dialog.js","../src/engine/logger.js","../src/hardware.js","../src/engine/abstract_call.js","../src/view/copilot-notify.js","../src/view/user-registry.js","../src/view/svg.js","../src/view/buttons.js","../src/view/mobile.js","../src/view/tools.js","../src/call_api.js","../src/view/call-user.js","../src/view/floor-request.js","../src/view/notifications.js","../src/view/device-selector.js","../src/call_ai.js","../src/view/user-selector.js","../src/view/view.js","../src/engine/simple_vad.js","../src/engine/plain_call.js","../src/engine/bitrix_call.js","../src/engine/voximplant_call.js","../src/engine/stub.js","../src/engine/engine.js","../src/util.js","../src/dialogs/incoming_notification.js","../src/dialogs/conference_notification.js","../src/floating_screenshare.js","../src/call_hint_popup.js","../src/dialogs/promo_popup.js","../src/sidebar.js","../src/view/record-with-copilot-popup.js","../src/web_screenshare_popup.js","../src/video_strategy.js","../src/view/copilot-popup.js","../src/controller.js","../src/index.js"],"sourcesContent":["// screensharing workaround\nexport function applyHacks() {\n\tif (window[\"BXDesktopSystem\"])\n\t{\n\t\tnavigator['getDisplayMedia'] = function ()\n\t\t{\n\t\t\tvar mediaParams = {\n\t\t\t\taudio: false,\n\t\t\t\tvideo: {\n\t\t\t\t\tmandatory: {\n\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\tmaxWidth: screen.width > 1920 ? screen.width : 1920,\n\t\t\t\t\t\tmaxHeight: screen.height > 1080 ? screen.height : 1080,\n\t\t\t\t\t},\n\t\t\t\t\toptional: [{googTemporalLayeredScreencast: true}],\n\t\t\t\t},\n\t\t\t};\n\t\t\treturn navigator.mediaDevices.getUserMedia(mediaParams);\n\t\t};\n\t}\n}\n","import { Type } from 'main.core';\nimport { Utils as MessengerUtils } from 'im.lib.utils';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nexport class BackgroundDialog\n{\n\tstatic isAvailable()\n\t{\n\t\treturn MessengerUtils.platform.getDesktopVersion() >= 52;\n\t}\n\n\tstatic isMaskAvailable()\n\t{\n\t\treturn MessengerUtils.platform.isDesktopFeatureEnabled('mask');\n\t}\n\n\tstatic open(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\t\tconst tab = Type.isStringFilled(options.tab) ? options.tab : 'background'; // mask, background\n\n\t\tif (!this.isAvailable())\n\t\t{\n\t\t\tif (window.BX.Helper)\n\t\t\t{\n\t\t\t\twindow.BX.Helper.show(\"redirect=detail&code=12398124\");\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tconst html =\n\t\t\t`<div id=\"bx-desktop-loader\" class=\"bx-desktop-loader-wrap\">\n\t\t\t\t<div class=\"bx-desktop-loader\">\n\t\t\t\t\t<svg class=\"bx-desktop-loader-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t\t\t<circle class=\"bx-desktop-loader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id=\"placeholder\"></div>`\n\t\t;\n\n\t\tconst js = `BX.Runtime.loadExtension(\"im.v2.component.call-background\").then(function(exports) {\n\t\t\t\tBX.Vue3.BitrixVue.createApp({\n\t\t\t\t\tcomponents: {CallBackground: exports.CallBackground},\n\t\t\t\t\ttemplate: '<CallBackground tab=\"${tab}\"/>',\n\t\t\t\t}).mount(\"#placeholder\");\n\t\t\t});`;\n\n\t\tDesktopApi.createWindow(\"callBackground\", (controller) =>\n\t\t{\n\t\t\tconst title = this.isMaskAvailable() ? BX.message('BXD_CALL_BG_MASK_TITLE') : BX.message('BXD_CALL_BG_TITLE');\n\t\t\tcontroller.SetProperty(\"title\", title);\n\t\t\tcontroller.SetProperty(\"clientSize\", {Width: 943, Height: 670});\n\t\t\tcontroller.SetProperty(\"minClientSize\", {Width: 943, Height: 670});\n\t\t\tcontroller.SetProperty(\"backgroundColor\", \"#2B3038\");\n\t\t\tcontroller.ExecuteCommand(\"center\");\n\t\t\tcontroller.ExecuteCommand(\"html.load\", DesktopApi.prepareHtml(html, js));\n\t\t});\n\n\t\treturn true;\n\t}\n}\n","export class Logger\n{\n\tconstructor(serviceUrl, token)\n\t{\n\t\tthis.serviceUrl = serviceUrl;\n\t\tthis.token = token;\n\n\t\tthis.socket = null;\n\t\tthis.attempt = 0;\n\t\tthis.reconnectTimeout = null;\n\t\tthis.unsentMessages = [];\n\n\t\tthis.onSocketOpenHandler = this.onSocketOpen.bind(this);\n\t\tthis.onSocketCloseHandler = this.onSocketClose.bind(this);\n\t\tthis.onSocketErrorHandler = this.onSocketError.bind(this);\n\n\t\tthis.connect();\n\t}\n\n\tget isConnected()\n\t{\n\t\treturn this.socket && this.socket.readyState === 1;\n\t}\n\n\tlog(message)\n\t{\n\t\tif ((typeof message) != 'string')\n\t\t{\n\t\t\tconsole.error(\"Message should be string\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isConnected)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'log',\n\t\t\t\tmessage: message\n\t\t\t}));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.unsentMessages.push(message);\n\t\t}\n\t}\n\n\tsendStat(statRecord)\n\t{\n\t\tif ((typeof statRecord) == 'object')\n\t\t{\n\t\t\tstatRecord = JSON.stringify(statRecord)\n\t\t}\n\n\t\tif (this.isConnected)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'stat',\n\t\t\t\tmessage: statRecord\n\t\t\t}));\n\t\t}\n\t}\n\n\tconnect()\n\t{\n\t\tif (this.socket)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.serviceUrl)\n\t\t{\n\t\t\tconsole.error('Logging service url is empty');\n\t\t\treturn;\n\t\t}\n\t\tif (!this.serviceUrl.startsWith('ws://') && !this.serviceUrl.startsWith('wss://'))\n\t\t{\n\t\t\tconsole.error('Logging service url should start with ws:// or wss://');\n\t\t\treturn;\n\t\t}\n\t\tif (!this.token)\n\t\t{\n\t\t\tconsole.error('Logging token is empty');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.attempt++;\n\t\tthis.socket = new WebSocket(this.serviceUrl + '?token=' + this.token);\n\n\t\tthis.bindSocketEvents();\n\t}\n\n\tscheduleReconnect()\n\t{\n\t\tclearTimeout(this.reconnectTimeout);\n\n\t\tif (this.attempt > 3)\n\t\t{\n\t\t\tconsole.error(\"Could not connect to the logging service, giving up\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reconnectTimeout = setTimeout(this.connect.bind(this), this.getConnectionDelay(this.attempt) * 1000);\n\t}\n\n\tgetConnectionDelay(attempt)\n\t{\n\t\tswitch (attempt)\n\t\t{\n\t\t\tcase 0:\n\t\t\tcase 1:\n\t\t\t\treturn 15;\n\t\t\tcase 2:\n\t\t\t\treturn 30;\n\t\t\tdefault:\n\t\t\t\treturn 60;\n\t\t}\n\t}\n\n\tdisconnect()\n\t{\n\t\tclearTimeout(this.reconnectTimeout);\n\t\tif (this.socket)\n\t\t{\n\t\t\tthis.removeSocketEvents();\n\t\t\tthis.socket.close(1000);\n\t\t\tthis.socket = null;\n\t\t}\n\t}\n\n\tbindSocketEvents()\n\t{\n\t\tthis.socket.addEventListener('open', this.onSocketOpenHandler);\n\t\tthis.socket.addEventListener('close', this.onSocketCloseHandler);\n\t\tthis.socket.addEventListener('error', this.onSocketErrorHandler);\n\t}\n\n\tremoveSocketEvents()\n\t{\n\t\tthis.socket.removeEventListener('open', this.onSocketOpenHandler);\n\t\tthis.socket.removeEventListener('close', this.onSocketCloseHandler);\n\t\tthis.socket.removeEventListener('error', this.onSocketErrorHandler);\n\t}\n\n\tonSocketOpen()\n\t{\n\t\tthis.attempt = 0;\n\t\tfor (let i = 0; i < this.unsentMessages.length; i++)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'log',\n\t\t\t\tmessage: this.unsentMessages[i]\n\t\t\t}));\n\t\t}\n\t\tthis.unsentMessages = [];\n\t}\n\n\tonSocketClose()\n\t{\n\t\tthis.socket = null;\n\t\tthis.scheduleReconnect();\n\t}\n\n\tonSocketError()\n\t{\n\t\tthis.socket = null;\n\t\tthis.scheduleReconnect();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.disconnect();\n\t\tthis.unsentMessages = null;\n\t}\n}","import {EventEmitter} from 'main.core.events'\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nconst lsKey = {\n\tdefaultMicrophone: 'bx-im-settings-default-microphone',\n\tdefaultCamera: 'bx-im-settings-default-camera',\n\tdefaultSpeaker: 'bx-im-settings-default-speaker',\n\tenableMicAutoParameters: 'bx-im-settings-enable-mic-auto-parameters',\n\tpreferHd: 'bx-im-settings-camera-prefer-hd',\n\tenableMirroring: 'bx-im-settings-camera-enable-mirroring'\n};\n\nconst Events = {\n\tinitialized: \"initialized\",\n\tdeviceChanged: \"deviceChange\",\n\tonChangeMirroringVideo: \"onChangeMirroringVideo\",\n\tonChangeMicrophoneMuted: \"onChangeMicrophoneMuted\",\n\tonChangeCameraOn: \"onChangeCameraOn\",\n};\n\nclass HardwareManager extends EventEmitter\n{\n\tEvents = Events\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.HardwareManager')\n\n\t\tthis.initialized = false;\n\t\tthis._currentDeviceList = [];\n\t\tthis.updating = false;\n\t\tthis._isCameraOn = false;\n\t\tthis._isMicrophoneMuted = false;\n\t}\n\n\tinit()\n\t{\n\t\tif (this.initialized)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (this.initPromise)\n\t\t{\n\t\t\treturn this.initPromise;\n\t\t}\n\n\t\tthis.initPromise = new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.enumerateDevices()\n\t\t\t\t.then((deviceList) =>\n\t\t\t\t{\n\t\t\t\t\tthis._currentDeviceList = this.filterDeviceList(deviceList);\n\n\t\t\t\t\tnavigator.mediaDevices.addEventListener('devicechange', BX.debounce(this.onNavigatorDeviceChanged.bind(this), 500));\n\t\t\t\t\tthis.initialized = true;\n\t\t\t\t\tthis.initPromise = null;\n\t\t\t\t\tthis.emit(Events.initialized, {});\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.initPromise = null;\n\t\t\t\t\treject(e)\n\t\t\t\t});\n\t\t})\n\n\t\treturn this.initPromise;\n\t}\n\n\tenumerateDevices()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices)\n\t\t\t{\n\t\t\t\treturn reject(\"NO_WEBRTC\");\n\t\t\t}\n\t\t\tnavigator.mediaDevices.enumerateDevices().then(devices => resolve(devices))\n\t\t});\n\t}\n\n\tget cameraList()\n\t{\n\t\treturn this._getDeviceMap(\"videoinput\");\n\t}\n\n\tget microphoneList()\n\t{\n\t\treturn this._getDeviceMap(\"audioinput\");\n\t}\n\n\tget audioOutputList()\n\t{\n\t\treturn this._getDeviceMap(\"audiooutput\");\n\t}\n\n\tget defaultMicrophone()\n\t{\n\t\tlet microphoneId = localStorage ? localStorage.getItem(lsKey.defaultMicrophone) : '';\n\n\t\tif (\n\t\t\t(!microphoneId || !this.microphoneList[microphoneId])\n\t\t\t&& Object.keys(this.microphoneList).length\n\t\t)\n\t\t{\n\t\t\t// previous solution with ternary operator\n\t\t\t// has been replaced with two separate conditions\n\t\t\t// because some systems / browsers don't create a duplicate for the default audio device\n\t\t\tif (Object.keys(this.microphoneList).includes('default'))\n\t\t\t{\n\t\t\t\tmicrophoneId = this.getDefaultDeviceIdByGroupId(this.getDeviceGroupIdByDeviceId('default', 'audioinput'), 'audioinput');\n\t\t\t}\n\n\t\t\tif (!microphoneId)\n\t\t\t{\n\t\t\t\tmicrophoneId = Object.keys(this.microphoneList)[0];\n\t\t\t}\n\n\t\t\treturn  microphoneId;\n\t\t}\n\t\treturn this.microphoneList[microphoneId] ? microphoneId : '';\n\t}\n\n\tset defaultMicrophone(microphoneId)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultMicrophone, microphoneId)\n\t\t}\n\t}\n\n\tget defaultCamera()\n\t{\n\t\tconst cameraId = localStorage ? localStorage.getItem(lsKey.defaultCamera) : '';\n\n\t\tif (\n\t\t\t(!cameraId || !this.cameraList[cameraId])\n\t\t\t&& Object.keys(this.cameraList).length\n\t\t)\n\t\t{\n\t\t\treturn Object.keys(this.cameraList)[0];\n\t\t}\n\n\t\treturn this.cameraList[cameraId] ? cameraId : '';\n\t}\n\n\tset defaultCamera(cameraId)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultCamera, cameraId)\n\t\t}\n\t}\n\n\tget defaultSpeaker()\n\t{\n\t\tlet speakerId = localStorage ? localStorage.getItem(lsKey.defaultSpeaker) : '';\n\n\t\tif (\n\t\t\t(!speakerId || this.audioOutputList[speakerId])\n\t\t\t&& Object.keys(this.audioOutputList).length\n\t\t)\n\t\t{\n\t\t\tspeakerId = Object.keys(this.audioOutputList).includes('default')\n\t\t\t\t? this.getDefaultDeviceIdByGroupId(this.getDeviceGroupIdByDeviceId('default', 'audiooutput'), 'audiooutput')\n\t\t\t\t: Object.keys(this.audioOutputList)[0]\n\t\t\t;\n\n\t\t\treturn  speakerId;\n\t\t}\n\t\treturn this.audioOutputList[speakerId] ? speakerId : '';\n\t}\n\n\tset defaultSpeaker(speakerId: string)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultSpeaker, speakerId)\n\t\t}\n\t}\n\n\tget enableMicAutoParameters(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.enableMicAutoParameters) !== 'N') : true;\n\t}\n\n\tset enableMicAutoParameters(enableMicAutoParameters: boolean)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.enableMicAutoParameters, enableMicAutoParameters ? 'Y' : 'N')\n\t\t}\n\t}\n\n\tget preferHdQuality(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.preferHd) !== 'N') : true;\n\t}\n\n\tset preferHdQuality(preferHdQuality: boolean)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.preferHd, preferHdQuality ? 'Y' : 'N')\n\t\t}\n\t}\n\n\tget enableMirroring(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.enableMirroring) !== 'N') : true;\n\t}\n\n\tset enableMirroring(enableMirroring: boolean)\n\t{\n\t\tif (this.enableMirroring !== enableMirroring)\n\t\t{\n\t\t\tthis.emit(Events.onChangeMirroringVideo, {enableMirroring: enableMirroring});\n\n\t\t\tif (DesktopApi.isDesktop())\n\t\t\t{\n\t\t\t\tDesktopApi.emit(Events.onChangeMirroringVideo, [enableMirroring]);\n\t\t\t}\n\t\t\tif (localStorage)\n\t\t\t{\n\t\t\t\tlocalStorage.setItem(lsKey.enableMirroring, enableMirroring ? 'Y' : 'N');\n\t\t\t}\n\t\t}\n\t}\n\n\tget isCameraOn()\n\t{\n\t\treturn this._isCameraOn;\n\t}\n\n\tset isCameraOn(isCameraOn)\n\t{\n\t\tif (this._isCameraOn !== isCameraOn)\n\t\t{\n\t\t\tthis._isCameraOn = isCameraOn;\n\t\t\tthis.emit(Events.onChangeCameraOn, {isCameraOn: this._isCameraOn});\n\t\t}\n\t}\n\n\tget isMicrophoneMuted()\n\t{\n\t\treturn this._isMicrophoneMuted;\n\t}\n\n\tset isMicrophoneMuted(isMicrophoneMuted)\n\t{\n\t\tif (this._isMicrophoneMuted !== isMicrophoneMuted)\n\t\t{\n\t\t\tthis._isMicrophoneMuted = isMicrophoneMuted;\n\t\t\tthis.emit(Events.onChangeMicrophoneMuted, {isMicrophoneMuted: this._isMicrophoneMuted});\n\t\t}\n\t}\n\n\thasCamera()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error(\"HardwareManager is not initialized yet\");\n\t\t}\n\n\t\treturn Object.keys(this.cameraList).length > 0;\n\t}\n\n\tgetMicrophoneList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error(\"HardwareManager is not initialized yet\");\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => (\n\t\t\tdeviceInfo.kind === \"audioinput\" && deviceInfo.deviceId !== 'default'\n\t\t));\n\t}\n\n\tgetCameraList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error(\"HardwareManager is not initialized yet\");\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => deviceInfo.kind == \"videoinput\")\n\t}\n\n\tgetSpeakerList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error(\"HardwareManager is not initialized yet\");\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => (\n\t\t\tdeviceInfo.kind === \"audiooutput\" && deviceInfo.deviceId !== 'default'\n\t\t));\n\t}\n\n\tcanSelectSpeaker()\n\t{\n\t\treturn 'setSinkId' in HTMLMediaElement.prototype;\n\t}\n\n\tupdateDeviceList(e)\n\t{\n\t\tif (this.updating)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.updating = true;\n\t\tlet removedDevices = this._currentDeviceList;\n\t\tlet addedDevices = [];\n\n\t\tconst shouldSkipDeviceChangedEvent = this._currentDeviceList.every(deviceInfo => deviceInfo.deviceId == \"\" && deviceInfo.label == \"\");\n\n\t\tnavigator.mediaDevices.enumerateDevices().then(devices =>\n\t\t{\n\t\t\tdevices = this.filterDeviceList(devices);\n\t\t\tdevices.forEach(deviceInfo =>\n\t\t\t{\n\t\t\t\tconst index = removedDevices.findIndex(dev => (\n\t\t\t\t\tdev.kind === deviceInfo.kind\n\t\t\t\t\t&& dev.deviceId === deviceInfo.deviceId\n\t\t\t\t\t&& dev.groupId === deviceInfo.groupId\n\t\t\t\t))\n\t\t\t\tif (index != -1)\n\t\t\t\t{\n\t\t\t\t\t// device found in previous version\n\t\t\t\t\tremovedDevices.splice(index, 1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\taddedDevices.push(deviceInfo);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!shouldSkipDeviceChangedEvent)\n\t\t\t{\n\t\t\t\tthis.emit(Events.deviceChanged, {\n\t\t\t\t\tadded: addedDevices,\n\t\t\t\t\tremoved: removedDevices\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis._currentDeviceList = devices;\n\t\t\tthis.updating = false;\n\t\t})\n\t}\n\n\tfilterDeviceList(browserDeviceList)\n\t{\n\t\treturn browserDeviceList.filter(device =>\n\t\t{\n\t\t\tswitch (device.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\treturn device.deviceId !== \"communications\" && !this.isDeviceInBlackList(device);\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\treturn device.deviceId !== \"communications\" && !this.isDeviceInBlackList(device);\n\t\t\t\tdefault:\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t})\n\t}\n\n\tisDeviceInBlackList(device)\n\t{\n\t\tconst deviceBlackList = [\n\t\t\t'(virtual)',\n\t\t\t'zoomaudiodevice',\n\t\t\t'microsoft teams audio',\n\t\t\t'bitrixaudio',\n\t\t];\n\t\tlet result = false;\n\n\t\tdeviceBlackList.forEach(item => {\n\t\t\tif (device.label.toLowerCase().includes(item))\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tonNavigatorDeviceChanged(e)\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateDeviceList();\n\t}\n\n\t_getDeviceMap(deviceKind)\n\t{\n\t\tlet result = {};\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error(\"HardwareManager is not initialized yet\");\n\t\t}\n\t\tfor (let i = 0; i < this._currentDeviceList.length; i++)\n\t\t{\n\t\t\tif (this._currentDeviceList[i].kind == deviceKind)\n\t\t\t{\n\t\t\t\tresult[this._currentDeviceList[i].deviceId] = this._currentDeviceList[i].label;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetDefaultDeviceIdByGroupId(groupId, deviceKind)\n\t{\n\t\tlet deviceId;\n\n\t\tthis._currentDeviceList.forEach(device => {\n\t\t\tif (\n\t\t\t\tdevice.groupId === groupId\n\t\t\t\t&& device.deviceId !== 'default'\n\t\t\t\t&& device.kind === deviceKind\n\t\t\t)\n\t\t\t{\n\t\t\t\tdeviceId = device.deviceId;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn deviceId;\n\t}\n\n\tgetDeviceGroupIdByDeviceId(deviceId, deviceKind)\n\t{\n\t\tlet groupId;\n\n\t\tthis._currentDeviceList.forEach(device => {\n\t\t\tif (device.deviceId === deviceId && device.kind === deviceKind)\n\t\t\t{\n\t\t\t\tgroupId = device.groupId;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn groupId;\n\t}\n\n\tremoveDevicesByDefaultGroup(devices)\n\t{\n\t\tlet resultDeviceList = devices;\n\n\t\tdevices.forEach(device => {\n\t\t\tif (device.deviceId === 'default')\n\t\t\t{\n\t\t\t\tresultDeviceList = resultDeviceList.filter(item => (\n\t\t\t\t\titem.kind !== device.kind\n\t\t\t\t\t|| item.groupId !== device.groupId\n\t\t\t\t));\n\t\t\t}\n\t\t});\n\n\t\treturn resultDeviceList;\n\t}\n\n\tgetCurrentDeviceList()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.enumerateDevices().then(deviceList => {\n\t\t\t\tthis._currentDeviceList = this.filterDeviceList(deviceList);\n\t\t\t\tresolve();\n\t\t\t})\n\t\t});\n\t}\n\n\tgetRemovedUsedDevices(devices, currentDevices)\n\t{\n\t\treturn devices.filter(device =>\n\t\t{\n\t\t\tswitch (device.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\treturn device.deviceId === currentDevices.microphoneId;\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\treturn device.deviceId === currentDevices.speakerId;\n\t\t\t\tcase \"videoinput\":\n\t\t\t\t\treturn device.deviceId === currentDevices.cameraId;\n\t\t\t\tdefault:\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t})\n\t}\n}\n\nexport const Hardware = new HardwareManager();","import {Type} from 'main.core'\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {Logger} from './logger'\nimport {CallType, CallEvent, CallState, CallEngine, Provider} from './engine'\nimport {Hardware} from '../hardware';\nimport Util from '../util'\n\n/**\n * Abstract call class\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onJoin\n * - onLeave\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onCallFailure\n * - onDestroy\n */\nexport class AbstractCall\n{\n\tlogger: ?Logger\n\tlocalStreams: {[key: string]: ?MediaStream}\n\n\tconstructor(params)\n\t{\n\t\tthis.id = params.id;\n\t\tthis.instanceId = params.instanceId;\n\t\tthis.parentId = params.parentId || null;\n\t\tthis.direction = params.direction;\n\t\tthis.type = BX.prop.getInteger(params, \"type\", CallType.Instant); // @see {BX.Call.Type}\n\t\tthis.state = BX.prop.getString(params, \"state\", CallState.Idle);\n\n\t\tthis.ready = false;\n\t\tthis.userId = CallEngine.getCurrentUserId();\n\n\t\tthis.initiatorId = params.initiatorId || '';\n\t\tthis.users = Type.isArray(params.users) ? params.users.filter(userId => userId != this.userId) : [];\n\n\t\tthis.associatedEntity = Type.isPlainObject(params.associatedEntity) ? params.associatedEntity : {};\n\t\tthis.startDate = new Date(BX.prop.getString(params, \"startDate\", \"\"));\n\n\t\t// media constraints\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.videoHd = params.videoHd === true;\n\t\tthis.cameraId = params.cameraId || '';\n\t\tthis.microphoneId = params.microphoneId || '';\n\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tthis.wasConnected = false;\n\n\t\tthis.logToken = params.logToken || '';\n\t\tif (CallEngine.getLogService() && this.logToken)\n\t\t{\n\t\t\tthis.logger = new Logger(CallEngine.getLogService(), this.logToken);\n\t\t}\n\n\t\tthis.localStreams = {\n\t\t\tmain: null,\n\t\t\tscreen: null\n\t\t};\n\n\t\tthis.eventListeners = {};\n\n\t\tif (Type.isPlainObject(params.events))\n\t\t{\n\t\t\tthis.initEventListeners(params.events);\n\t\t}\n\n\t\tthis.connectionData = params.connectionData;\n\n\t\tthis._microphoneLevel = 0;\n\t};\n\n\tget provider()\n\t{\n\t\tthrow new Error(\"must be overwritten\")\n\t}\n\n\tget microphoneLevel()\n\t{\n\t\treturn this._microphoneLevel\n\t}\n\n\tset microphoneLevel(level)\n\t{\n\t\tif (level != this._microphoneLevel)\n\t\t{\n\t\t\tthis._microphoneLevel = level;\n\t\t\tthis.runCallback(CallEvent.onMicrophoneLevel, {\n\t\t\t\tlevel: level\n\t\t\t});\n\t\t}\n\t}\n\n\tinitEventListeners(eventListeners)\n\t{\n\t\tfor (var eventName in eventListeners)\n\t\t{\n\t\t\tthis.addEventListener(eventName, eventListeners[eventName]);\n\t\t}\n\t};\n\n\taddEventListener(eventName, listener)\n\t{\n\t\tif (!Type.isArray(this.eventListeners[eventName]))\n\t\t{\n\t\t\tthis.eventListeners[eventName] = [];\n\t\t}\n\t\tif (Type.isFunction(listener))\n\t\t{\n\t\t\tthis.eventListeners[eventName].push(listener);\n\t\t}\n\t};\n\n\tremoveEventListener(eventName, listener)\n\t{\n\t\tif (Type.isArray(this.eventListeners[eventName]) && this.eventListeners[eventName].indexOf(listener) >= 0)\n\t\t{\n\t\t\tvar listenerIndex = this.eventListeners[eventName].indexOf(listener);\n\t\t\tif (listenerIndex >= 0)\n\t\t\t{\n\t\t\t\tthis.eventListeners[eventName].splice(listenerIndex, 1);\n\t\t\t}\n\t\t}\n\t};\n\n\trunCallback(eventName, eventFields)\n\t{\n\t\t//console.log(eventName, eventFields);\n\t\tif (Type.isArray(this.eventListeners[eventName]) && this.eventListeners[eventName].length > 0)\n\t\t{\n\t\t\tif (eventName === null || typeof (eventFields) !== \"object\")\n\t\t\t{\n\t\t\t\teventFields = {};\n\t\t\t}\n\t\t\teventFields.call = this;\n\t\t\tfor (let i = 0; i < this.eventListeners[eventName].length; i++)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.eventListeners[eventName][i].call(this, eventFields);\n\t\t\t\t} catch (err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(eventName + \" callback error: \", err);\n\t\t\t\t\tthis.log(eventName + \" callback error: \", err);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tgetLocalStream(tag)\n\t{\n\t\treturn this.localStreams[tag];\n\t};\n\n\tsetLocalStream(mediaStream, tag)\n\t{\n\t\ttag = tag || \"main\";\n\n\t\tthis.localStreams[tag] = mediaStream;\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tthrow new Error(\"isAnyoneParticipating should be implemented\");\n\t};\n\n\t__onPullEvent(command, params)\n\t{\n\t\tthrow new Error(\"__onPullEvent should be implemented\");\n\t};\n\n\tinviteUsers()\n\t{\n\t\tthrow new Error(\"inviteUsers is not implemented\");\n\t};\n\n\tcancel()\n\t{\n\t\tthrow new Error(\"cancel is not implemented\");\n\t};\n\n\tanswer()\n\t{\n\t\tthrow new Error(\"answer is not implemented\");\n\t};\n\n\tdecline(code, reason)\n\t{\n\t\tthrow new Error(\"decline is not implemented\");\n\t};\n\n\thangup()\n\t{\n\t\tthrow new Error(\"hangup is not implemented\");\n\t};\n\n\tlog()\n\t{\n\t\tlet text = Util.getLogMessage.apply(null, arguments);\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.writeToLogFile(BX.message('USER_ID') + '.video.log', text.substr(3));\n\t\t}\n\t\tif (CallEngine.debugFlag && console)\n\t\t{\n\t\t\tlet a = ['Call log [' + Util.getTimeForLog() + ']: '];\n\t\t\tconsole.log.apply(this, a.concat(Array.prototype.slice.call(arguments)));\n\t\t}\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.log(text);\n\t\t}\n\n\t\tif (BX.MessengerDebug)\n\t\t{\n\t\t\tBX.MessengerDebug.addLog(this.id, text);\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.destroy();\n\t\t\tthis.logger = null;\n\t\t}\n\n\t\tthis.state = CallState.Finished;\n\t\tthis.runCallback(CallEvent.onDestroy);\n\t}\n}","import { Dom, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { PromoManager } from 'im.v2.lib.promo';\n\nimport { Analytics } from 'call.lib.analytics';\n\nimport '../css/copilot-notify.css'\n\nexport const CopilotNotifyType = {\n\tCOPILOT_ENABLED: 'COPILOT_ENABLED',\n\tCOPILOT_DISABLED: 'COPILOT_DISABLED',\n\tCOPILOT_RESULT: 'COPILOT_RESULT',\n\tAI_UNAVAILABLE_ERROR: 'AI_UNAVAILABLE_ERROR',\n\tAI_SETTINGS_ERROR: 'AI_SETTINGS_ERROR',\n\tAI_AGREEMENT_ERROR: 'AI_AGREEMENT_ERROR',\n\tAI_NOT_ENOUGH_BAAS_ERROR: 'AI_NOT_ENOUGH_BAAS_ERROR',\n};\n\nexport class CopilotNotify {\n\tconstructor(config)\n\t{\n\t\tthis.callId = config.callId || 0;\n\t\tthis.type = config.type || '';\n\t\tthis.popup = null;\n\t\tthis.notifyText = '';\n\t\tthis.promoId = '';\n\t\tthis.popupTemplate = null;\n\t\tthis.bindElement = config.bindElement;\n\t\tthis.notifyColor = '';\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t}\n\t}\n\n\tgetPopupTemplate()\n\t{\n\t\tthis.setAdditionalInformation();\n\n\t\tif (!this.notifyText)\n\t\t{\n\t\t\tthis.popupTemplate = null;\n\t\t}\n\n\t\tthis.popupTemplate = Dom.create(\"div\", {\n\t\t\tprops: {className: 'bx-call-copilot-notify__content'},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-call-copilot-notify__icon'},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-call-copilot-notify__message'},\n\t\t\t\t\ttext: this.notifyText,\n\t\t\t\t}),\n\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\tprops: {className: 'bx-call-copilot-notify__close-btn'},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\tsetAdditionalInformation()\n\t{\n\t\tswitch (this.type)\n\t\t{\n\t\t\tcase CopilotNotifyType.COPILOT_ENABLED:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_WARNING_ENABLED');\n\t\t\t\tthis.promoId = 'call:copilot-notify-warning:21112024:all';\n\t\t\t\tthis.notifyColor = '#8E52EC';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.COPILOT_DISABLED:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_PROMO_ENABLED');\n\t\t\t\tthis.promoId = 'call:copilot-notify-promo:21112024:all';\n\t\t\t\tthis.notifyColor = '#8E52EC';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.COPILOT_RESULT:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_RESULT_WARNING');\n\t\t\t\tthis.promoId = 'call:copilot-notify-result:24112024:all';\n\t\t\t\tthis.notifyColor = '#8E52EC';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_UNAVAILABLE_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_AI_UNAVAILABLE_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_SETTINGS_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_AI_SETTINGS_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_AGREEMENT_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_AI_AGREEMENT_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_NOT_ENOUGH_BAAS_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_AI_NOT_ENOUGH_BAAS_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_AI_DEFAULT_TEXT');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tcreate()\n\t{\n\t\tconst self = this;\n\n\t\tthis.getPopupTemplate();\n\n\t\tif (!this.bindElement || !this.popupTemplate)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName : \"bx-call-copilot-notify\",\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.popupTemplate,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tpadding: 0,\n\t\t\tcontentBorderRadius: '1024px',\n\t\t\tbackground: this.notifyColor,\n\t\t\tcontentBackground: this.notifyColor,\n\t\t\tdarkMode: true,\n\t\t\tcontentNoPaddings: true,\n\t\t\tanimation: \"fading\",\n\t\t\tautoHide: true,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onClose();\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tself.popup = null;\n\t\t\t\t},\n\t\t\t\tonShow: () => {\n\t\t\t\t\tconst popupWidth = this.popup.getPopupContainer().offsetWidth;\n\t\t\t\t\tconst elementWidth = this.popup.bindElement.offsetWidth;\n\t\t\t\t\tconst offsetFix = 7;\n\n\t\t\t\t\tthis.popup.setOffset({\n\t\t\t\t\t\toffsetLeft: elementWidth - offsetFix - popupWidth / 2\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.popup.setAngle({\n\t\t\t\t\t\toffset: popupWidth / 2,\n\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t});\n\t\t\t\t\tthis.popup.adjustPosition();\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tif (!this.promoId)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tPromoManager.getInstance().markAsWatched(this.promoId);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.close();\n\t\tthis.create();\n\n\t\tif (!this.canShowCopilotNotify())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.type === CopilotNotifyType.COPILOT_ENABLED || this.type === CopilotNotifyType.COPILOT_DISABLED)\n\t\t{\n\t\t\tAnalytics.getInstance().copilot.onCopilotNotifyShow({\n\t\t\t\tisCopilotActive: this.type === CopilotNotifyType.COPILOT_ENABLED,\n\t\t\t\tcallId: this.callId,\n\t\t\t});\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tcanShowCopilotNotify()\n\t{\n\t\tif (!this.promoId)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn PromoManager.getInstance().needToShow(this.promoId);\n\t}\n}\n","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {EndpointDirection, UserState} from '../engine/engine';\n\nexport class UserModel\n{\n\tid: number\n\tname: string\n\tavatar: string\n\tgender: string\n\tstate: string\n\ttalking: boolean\n\tcameraState: boolean\n\tprevCameraState: boolean\n\tmicrophoneState: boolean\n\tscreenState: boolean\n\tvideoPaused: boolean\n\tfloorRequestState: boolean\n\tlocalUser: boolean\n\tcentralUser: boolean\n\tpinned: boolean\n\tpresenter: boolean\n\torder: number\n\tprevOrder: number\n\tallowRename: boolean\n\twasRenamed: boolean\n\trenameRequested: boolean\n\tdirection: string\n\n\tconstructor(config)\n\t{\n\t\tthis.data = {\n\t\t\tid: BX.prop.getInteger(config, \"id\", 0),\n\t\t\tname: BX.prop.getString(config, \"name\", \"\"),\n\t\t\tavatar: BX.prop.getString(config, \"avatar\", \"\"),\n\t\t\tgender: BX.prop.getString(config, \"gender\", \"\"),\n\t\t\tstate: BX.prop.getString(config, \"state\", UserState.Idle),\n\t\t\ttalking: BX.prop.getBoolean(config, \"talking\", false),\n\t\t\tcameraState: BX.prop.getBoolean(config, \"cameraState\", true),\n\t\t\tprevCameraState: BX.prop.getBoolean(config, \"cameraState\", true),\n\t\t\tmicrophoneState: BX.prop.getBoolean(config, \"microphoneState\", true),\n\t\t\tscreenState: BX.prop.getBoolean(config, \"screenState\", false),\n\t\t\tvideoPaused: BX.prop.getBoolean(config, \"videoPaused\", false),\n\t\t\tfloorRequestState: BX.prop.getBoolean(config, \"floorRequestState\", false),\n\t\t\tlocalUser: BX.prop.getBoolean(config, \"localUser\", false),\n\t\t\tcentralUser: BX.prop.getBoolean(config, \"centralUser\", false),\n\t\t\tpinned: BX.prop.getBoolean(config, \"pinned\", false),\n\t\t\tpresenter: BX.prop.getBoolean(config, \"presenter\", false),\n\t\t\torder: BX.prop.getInteger(config, \"order\", false),\n\t\t\tprevOrder: BX.prop.getInteger(config, \"prevOrder\", false),\n\t\t\tallowRename: BX.prop.getBoolean(config, \"allowRename\", false),\n\t\t\twasRenamed: BX.prop.getBoolean(config, \"wasRenamed\", false),\n\t\t\trenameRequested: BX.prop.getBoolean(config, \"renameRequested\", false),\n\t\t\tdirection: BX.prop.getString(config, \"direction\", EndpointDirection.SendRecv),\n\t\t};\n\n\t\tfor (let fieldName in this.data)\n\t\t{\n\t\t\tif (this.data.hasOwnProperty(fieldName))\n\t\t\t{\n\t\t\t\tObject.defineProperty(this, fieldName, {\n\t\t\t\t\tget: this._getField(fieldName).bind(this),\n\t\t\t\t\tset: this._setField(fieldName).bind(this),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.onUpdate = {\n\t\t\ttalking: this._onUpdateTalking.bind(this),\n\t\t\tstate: this._onUpdateState.bind(this),\n\t\t};\n\n\t\tthis.talkingStop = null;\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'UserModel');\n\t};\n\n\t_getField(fieldName)\n\t{\n\t\treturn function ()\n\t\t{\n\t\t\treturn this.data[fieldName];\n\t\t}\n\t};\n\n\t_setField(fieldName)\n\t{\n\t\treturn function (newValue)\n\t\t{\n\t\t\tvar oldValue = this.data[fieldName];\n\t\t\tif (oldValue == newValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.data[fieldName] = newValue;\n\n\t\t\tif (this.onUpdate.hasOwnProperty(fieldName))\n\t\t\t{\n\t\t\t\tthis.onUpdate[fieldName](newValue, oldValue);\n\t\t\t}\n\n\t\t\tthis.eventEmitter.emit(\"changed\", {\n\t\t\t\tuser: this,\n\t\t\t\tfieldName: fieldName,\n\t\t\t\toldValue: oldValue,\n\t\t\t\tnewValue: newValue,\n\t\t\t});\n\t\t}\n\t};\n\n\t_onUpdateTalking(talking)\n\t{\n\t\tif (talking)\n\t\t{\n\t\t\tthis.floorRequestState = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.talkingStop = (new Date()).getTime();\n\t\t}\n\t};\n\n\t_onUpdateState(newValue)\n\t{\n\t\tif (newValue != UserState.Connected)\n\t\t{\n\t\t\tthis.talking = false;\n\t\t\tthis.screenState = false;\n\t\t}\n\t};\n\n\twasTalkingAgo()\n\t{\n\t\tif (this.state != UserState.Connected)\n\t\t{\n\t\t\treturn +Infinity;\n\t\t}\n\t\tif (this.talking)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\tif (!this.talkingStop)\n\t\t{\n\t\t\treturn +Infinity;\n\t\t}\n\n\t\treturn ((new Date()).getTime() - this.talkingStop);\n\t};\n\n\tsubscribe(event, handler)\n\t{\n\t\tthis.eventEmitter.subscribe(event, handler);\n\t};\n\n\tunsubscribe(event, handler)\n\t{\n\t\tthis.eventEmitter.unsubscribe(event, handler);\n\t};\n}\n\nexport class UserRegistry extends EventEmitter\n{\n\tusers: UserModel[];\n\n\tconstructor(config:{users: UserModel[]} = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.UserRegistry')\n\t\tthis.users = Type.isArray(config.users) ? config.users : [];\n\n\t\tthis._sort();\n\t};\n\n\t/**\n\t *\n\t * @param {int} userId\n\t * @returns {UserModel|null}\n\t */\n\tget(userId): ?UserModel\n\t{\n\t\tfor (let i = 0; i < this.users.length; i++)\n\t\t{\n\t\t\tif (this.users[i].id == userId)\n\t\t\t{\n\t\t\t\treturn this.users[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t};\n\n\tpush(user: UserModel)\n\t{\n\t\tif (!(user instanceof UserModel))\n\t\t{\n\t\t\tthrow Error(\"user should be instance of UserModel\")\n\t\t}\n\n\t\tthis.users.push(user);\n\t\tthis._sort();\n\t\tuser.subscribe(\"changed\", this._onUserChanged.bind(this));\n\t\tthis.emit(\"userAdded\", {\n\t\t\tuser: user\n\t\t})\n\t};\n\n\t_onUserChanged(event)\n\t{\n\t\tif (event.data.fieldName === 'order')\n\t\t{\n\t\t\tthis._sort();\n\t\t}\n\t\tthis.emit(\"userChanged\", event.data)\n\t};\n\n\t_sort()\n\t{\n\t\tthis.users = this.users.sort(function (a, b)\n\t\t{\n\t\t\treturn a.order - b.order;\n\t\t});\n\t}\n}","import {Dom, Type} from 'main.core'\n\nexport function createSVG(elementName, config)\n{\n\tlet element = document.createElementNS('http://www.w3.org/2000/svg', elementName);\n\n\tif (\"attrNS\" in config && Type.isObject(config.attrNS))\n\t{\n\t\tfor (let key in config.attrNS)\n\t\t{\n\t\t\tif (config.attrNS.hasOwnProperty(key))\n\t\t\t{\n\t\t\t\telement.setAttributeNS(null, key, config.attrNS[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\tDom.adjust(element, config);\n\treturn element;\n}","import {Dom, Text, Type} from 'main.core';\nimport Util from '../util';\nimport {createSVG} from './svg';\nimport {View} from './view';\nimport { Utils } from 'im.v2.lib.utils';\n\nexport class TitleButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.elements = {\n\t\t\troot: null\n\t\t};\n\n\t\tthis.text = Type.isStringFilled(config.text) ? config.text : '';\n\t\tthis.isGroupCall = config.isGroupCall;\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-title\"},\n\t\t\thtml: this.getTitle()\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tgetTitle()\n\t{\n\t\tconst prettyName = '<span class=\"bx-messenger-videocall-panel-title-name\">' + Text.encode(this.text) + '</span>';\n\n\t\tif (this.isGroupCall)\n\t\t{\n\t\t\treturn BX.message(\"IM_M_GROUP_CALL_WITH\").replace(\"#CHAT_NAME#\", prettyName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn BX.message(\"IM_M_CALL_WITH\").replace(\"#USER_NAME#\", prettyName);\n\t\t}\n\t};\n}\n\nexport class SimpleButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.class = config.class;\n\t\tthis.backgroundClass = BX.prop.getString(config, \"backgroundClass\", \"\");\n\t\tthis.backgroundClass = \"bx-messenger-videocall-panel-icon-background\" + (this.backgroundClass ? \" \" : \"\") + this.backgroundClass;\n\t\tthis.blocked = config.blocked === true;\n\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\t\tthis.isActive = false;\n\t\tthis.counter = BX.prop.getInteger(config, \"counter\", 0);\n\t\tthis.isComingSoon = config.isComingSoon || false;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tcounter: null,\n\t\t\tcomingSoon: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tonMouseOver: BX.prop.getFunction(config, \"onMouseOver\", BX.DoNothing),\n\t\t\tonMouseOut: BX.prop.getFunction(config, \"onMouseOut\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tlet textNode;\n\t\tif (this.text !== '')\n\t\t{\n\t\t\ttextNode = Dom.create(\"div\", {props: {className: \"bx-messenger-videocall-panel-text\"}, text: this.text});\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttextNode = null;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-item\" + (this.blocked ? \" blocked\" : \"\")},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: this.backgroundClass},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon bx-messenger-videocall-panel-icon-\" + this.class},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.counter = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-counter\"},\n\t\t\t\t\t\t\t\t\ttext: 0,\n\t\t\t\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\t\t\t\tcounter: 0,\n\t\t\t\t\t\t\t\t\t\tcounterType: 'digits',\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.comingSoon = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-coming-soon\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_FEATURES_COMING_SOON'),\n\t\t\t\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\t\t\t\tvisible: this.isComingSoon ? 'Y' : 'N',\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\ttextNode,\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-bottom-spacer\"}\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t\tmouseover: this.callbacks.onMouseOver,\n\t\t\t\tmouseout: this.callbacks.onMouseOut\n\t\t\t}\n\t\t});\n\n\t\tif (this.isActive)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"active\");\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tsetActive(isActive)\n\t{\n\t\tif (this.isActive == isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.isActive = isActive;\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.isActive)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"active\");\n\t\t}\n\t};\n\n\tsetBlocked(isBlocked)\n\t{\n\t\tif (this.blocked == isBlocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.blocked = isBlocked;\n\t\tif (this.blocked)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"blocked\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"blocked\");\n\t\t}\n\t};\n\n\tsetCounter(counter)\n\t{\n\t\tthis.counter = parseInt(counter, 10);\n\n\t\tlet counterLabel = this.counter;\n\t\tif (counterLabel > 999)\n\t\t{\n\t\t\tcounterLabel = 999;\n\t\t}\n\n\t\tlet counterType = 'digits';\n\t\tif (counterLabel.toString().length === 2)\n\t\t{\n\t\t\tcounterType = 'dozens';\n\t\t}\n\t\telse if (counterLabel.toString().length > 2)\n\t\t{\n\t\t\tcounterType = 'hundreds';\n\t\t}\n\n\t\tthis.elements.counter.dataset.counter = counterLabel;\n\t\tthis.elements.counter.dataset.counterType = counterType;\n\t\tthis.elements.counter.innerText = counterLabel;\n\t};\n\n\tsetIsComingSoon(isActive)\n\t{\n\t\tthis.isComingSoon = isActive;\n\n\t\tthis.isComingSoon\n\t\t\t? this.elements.comingSoon.dataset.visible = 'Y'\n\t\t\t: this.elements.comingSoon.dataset.visible = 'N';\n\t}\n}\n\nexport class DeviceButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.class = config.class;\n\t\tthis.text = config.text;\n\n\t\tthis.enabled = (config.enabled === true);\n\t\tthis.arrowEnabled = (config.arrowEnabled === true);\n\t\tthis.arrowHidden = (config.arrowHidden === true);\n\t\tthis.blocked = (config.blocked === true);\n\n\t\tthis.showLevel = (config.showLevel === true);\n\t\tthis.level = config.level || 0;\n\n\t\tthis.sideIcon = BX.prop.getString(config, \"sideIcon\", \"\");\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticonContainer: null,\n\t\t\ticon: null,\n\t\t\tarrow: null,\n\t\t\tlevelMeter: null,\n\t\t\tpointer: null,\n\t\t\tellipsis: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tonArrowClick: BX.prop.getFunction(config, \"onArrowClick\", BX.DoNothing),\n\t\t\tonSideIconClick: BX.prop.getFunction(config, \"onSideIconClick\", BX.DoNothing),\n\t\t\tonMouseOver: BX.prop.getFunction(config, \"onMouseOver\", BX.DoNothing),\n\t\t\tonMouseOut: BX.prop.getFunction(config, \"onMouseOut\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tid: \"bx-messenger-videocall-panel-item-with-arrow-\" + this.class,\n\t\t\t\tclassName: \"bx-messenger-videocall-panel-item-with-arrow\" + (this.blocked ? \" blocked\" : \"\")\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-with-arrow-left\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.iconContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: this.getIconContainerClass()},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: this.getIconClass()},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-text\"},\n\t\t\t\t\t\t\ttext: this.text\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t\tmouseover: this.callbacks.onMouseOver,\n\t\t\t\tmouseout: this.callbacks.onMouseOut\n\t\t\t}\n\t\t});\n\n\t\tthis.elements.arrow = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-with-arrow-right\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-with-arrow-right-icon\"},\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: function (e)\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onArrowClick.apply(this, arguments);\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (!this.arrowHidden)\n\t\t{\n\t\t\tthis.elements.icon.appendChild(this.elements.arrow);\n\t\t}\n\n\t\tif (this.showLevel)\n\t\t{\n\t\t\tthis.elements.icon.appendChild(createSVG(\"svg\", {\n\t\t\t\tattrNS: {\n\t\t\t\t\tclass: \"bx-messenger-videocall-panel-item-level-meter-container\",\n\t\t\t\t\twidth: \"28\",\n\t\t\t\t\theight: \"28\",\n\t\t\t\t\tviewBox: \"0 0 28 28\",\n\t\t\t\t\tfill: \"none\",\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateSVG(\"defs\", {\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tcreateSVG(\"linearGradient\", {\n\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\tid: \"volumeGradient\",\n\t\t\t\t\t\t\t\t\tx1: \"0%\",\n\t\t\t\t\t\t\t\t\ty1: \"100%\",\n\t\t\t\t\t\t\t\t\tx2: \"0%\",\n\t\t\t\t\t\t\t\t\ty2: \"0%\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tthis.elements.gradientStop1 = createSVG(\"stop\", {\n\t\t\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\t\t\toffset: \"0\",\n\t\t\t\t\t\t\t\t\t\t\t\"stop-color\": \"#2FC6F6\",\n\t\t\t\t\t\t\t\t\t\t\tid: \"gradientStop1\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tthis.elements.gradientStop2 = createSVG(\"stop\", {\n\t\t\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\t\t\toffset: \"0\",\n\t\t\t\t\t\t\t\t\t\t\t\"stop-color\": \"transparent\",\n\t\t\t\t\t\t\t\t\t\t\tid: \"gradientStop2\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t]\n\t\t\t\t\t}),\n\t\t\t\t\tcreateSVG(\"path\", {\n\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\"fill-rule\": \"evenodd\",\n\t\t\t\t\t\t\t\"clip-rule\": \"evenodd\",\n\t\t\t\t\t\t\td: \"M20.4012 13.5741C20.9948 13.5614 21.4862 14.0351 21.4988 14.6321C21.5567 17.3753 19.5475 20.5964 15.6554 21.1285L15.6546 22.5504L16.1204 22.5507C16.6554 22.5507 17.0891 22.9869 17.0891 23.525C17.0891 24.0631 16.6554 24.4993 16.1204 24.4993H12.879C12.344 24.4993 11.9103 24.0631 11.9103 23.525C11.9103 22.9869 12.344 22.5507 12.879 22.5507L13.3433 22.5504L13.3432 21.1275C9.45683 20.5997 7.47015 17.4555 7.50034 14.6434C7.50675 14.0463 7.99323 13.5674 8.58692 13.5738C9.14103 13.5799 9.59269 14.0065 9.64523 14.5489L9.65028 14.6667C9.64425 15.2277 9.95576 16.3048 10.5307 17.1425C11.3561 18.3452 12.625 19.0421 14.5111 19.0421C16.3868 19.0421 17.6512 18.3317 18.4781 17.1059C19.0061 16.3232 19.3137 15.3287 19.3465 14.7932L19.3492 14.678C19.3366 14.081 19.8076 13.5867 20.4012 13.5741ZM14.4996 4.66602C16.2557 4.66602 17.6793 6.0193 17.6793 7.68867V14.0608C17.6793 15.7301 16.2557 17.0834 14.4996 17.0834C12.7435 17.0834 11.32 15.7301 11.32 14.0608L11.32 7.68867C11.32 6.0193 12.7435 4.66602 14.4996 4.66602Z\",\n\t\t\t\t\t\t\tfill: \"url(#volumeGradient)\"\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}));\n\t\t}\n\t\telse if (this.showLevel)\n\t\t{\n\t\t\tthis.elements.icon.appendChild(createSVG(\"svg\", {\n\t\t\t\tattrNS: {\n\t\t\t\t\tclass: \"bx-messenger-videocall-panel-item-level-meter-container\",\n\t\t\t\t\twidth: 3, height: 20\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateSVG(\"g\", {\n\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\tfill: \"#30B1DC\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tcreateSVG(\"rect\", {\n\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\tx: 0, y: 0, width: 3, height: 20, rx: 1.5, opacity: .1,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tthis.elements.levelMeter = createSVG(\"rect\", {\n\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\tx: 0, y: 20, width: 3, height: 20, rx: 1.5,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t]\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}));\n\t\t}\n\n\t\tthis.elements.ellipsis = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon-ellipsis\"},\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onSideIconClick\n\t\t\t}\n\t\t})\n\n\t\tthis.elements.pointer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon-pointer\"},\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onSideIconClick\n\t\t\t}\n\t\t})\n\n\t\tif (this.sideIcon == \"pointer\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.pointer, this.elements.icon);\n\t\t}\n\t\telse if (this.sideIcon == \"ellipsis\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.ellipsis, this.elements.icon);\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tgetIconClass()\n\t{\n\t\treturn \"bx-messenger-videocall-panel-item-with-arrow-icon bx-messenger-videocall-panel-item-with-arrow-icon-\" + this.class + (this.enabled ? \"\" : \"-off\");\n\t};\n\n\tgetIconContainerClass()\n\t{\n\t\treturn \"bx-messenger-videocall-panel-item-with-arrow-icon-container\" + \" bx-messenger-videocall-panel-item-with-arrow-icon-container-\" + this.class + (this.enabled ? \"\" : \"-off\");\n\t};\n\n\tenable()\n\t{\n\t\tif (this.enabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.enabled = true;\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\t\tthis.elements.icon.className = this.getIconClass();\n\n\t\tif (this.elements.gradientStop1 && this.elements.gradientStop2)\n\t\t{\n\t\t\tthis.elements.gradientStop1.setAttribute('offset', '0%');\n\t\t\tthis.elements.gradientStop2.setAttribute('offset', '0%');\n\t\t}\n\t\telse if (this.elements.levelMeter)\n\t\t{\n\t\t\tthis.elements.levelMeter.setAttribute('y', Math.round((1 - this.level) * 20));\n\t\t}\n\t};\n\n\tdisable()\n\t{\n\t\tif (!this.enabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.enabled = false;\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\t\tthis.elements.icon.className = this.getIconClass();\n\n\t\tif (this.elements.gradientStop1 && this.elements.gradientStop2)\n\t\t{\n\t\t\tthis.elements.gradientStop1.setAttribute('offset', '0%');\n\t\t\tthis.elements.gradientStop2.setAttribute('offset', '0%');\n\t\t}\n\t\telse if (this.elements.levelMeter)\n\t\t{\n\t\t\tthis.elements.levelMeter.setAttribute('y', Math.round((1 - this.level) * 20));\n\t\t}\n\t};\n\n\tsetBlocked(blocked)\n\t{\n\t\tif (this.blocked == blocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.blocked = blocked;\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\t\tthis.elements.icon.className = this.getIconClass();\n\t\tif (this.blocked)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"blocked\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"blocked\");\n\t\t}\n\t};\n\n\tsetSideIcon(sideIcon)\n\t{\n\t\tif (this.sideIcon == sideIcon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.sideIcon = sideIcon;\n\n\t\tBX.Dom.remove(this.elements.pointer);\n\t\tBX.Dom.remove(this.elements.ellipsis);\n\n\t\tif (this.sideIcon == \"pointer\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.pointer, this.elements.icon);\n\t\t}\n\t\telse if (this.sideIcon == \"ellipsis\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.ellipsis, this.elements.icon);\n\t\t}\n\t}\n\n\tshowArrow()\n\t{\n\t\tif (!this.arrowHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.arrowHidden = false;\n\t\tthis.elements.root.appendChild(this.elements.arrow);\n\t};\n\n\thideArrow()\n\t{\n\t\tif (this.arrowHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.arrowHidden = false;\n\t\tthis.elements.root.removeChild(this.elements.arrow);\n\t};\n\n\tsetLevel(level)\n\t{\n\t\tthis.level = Math.log(level * 100) / 4.6;\n\t\tif (this.showLevel && this.enabled)\n\t\t{\n\t\t\tconst offset = `${100 - Math.round((1 - this.level) * 100)}%`;\n\t\t\tthis.elements.gradientStop1.setAttribute('offset', offset);\n\t\t\tthis.elements.gradientStop2.setAttribute('offset', offset);\n\t\t}\n\t}\n}\n\nexport class WaterMarkButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.language = config.language;\n\t};\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-watermark\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"img\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-watermark-img\",\n\t\t\t\t\t\tsrc: this.getWatermarkUrl(this.language)\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tgetWatermarkUrl(language)\n\t{\n\t\tswitch (language)\n\t\t{\n\t\t\tcase 'ru':\n\t\t\tcase 'kz':\n\t\t\tcase 'by':\n\t\t\t\treturn '/bitrix/js/call/images/new-logo-white-ru.svg';\n\t\t\tdefault:\n\t\t\t\treturn '/bitrix/js/call/images/new-logo-white-en.svg';\n\t\t}\n\t};\n}\n\nexport class TopButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.iconClass = BX.prop.getString(config, \"iconClass\", \"\");\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tonMouseOver: BX.prop.getFunction(config, \"onMouseOver\", BX.DoNothing),\n\t\t\tonMouseOut: BX.prop.getFunction(config, \"onMouseOut\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-button\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon \" + this.iconClass}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-text \" + this.iconClass},\n\t\t\t\t\ttext: this.text\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t\tmouseover: this.callbacks.onMouseOver,\n\t\t\t\tmouseout: this.callbacks.onMouseOut\n\t\t\t}\n\t\t})\n\t};\n}\n\nexport class TopFramelessButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.iconClass = BX.prop.getString(config, \"iconClass\", \"\");\n\t\tthis.textClass = BX.prop.getString(config, \"textClass\", \"\");\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tonMouseOver: BX.prop.getFunction(config, \"onMouseOver\", BX.DoNothing),\n\t\t\tonMouseOut: BX.prop.getFunction(config, \"onMouseOut\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-button-frameless\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon \" + this.iconClass}\n\t\t\t\t}),\n\t\t\t\t(this.text != \"\" ?\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-text \" + this.textClass},\n\t\t\t\t\t\t\ttext: this.text\n\t\t\t\t\t\t})\n\t\t\t\t\t\t:\n\t\t\t\t\t\tnull\n\t\t\t\t)\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t\tmouseover: this.callbacks.onMouseOver,\n\t\t\t\tmouseout: this.callbacks.onMouseOut\n\t\t\t},\n\t\t});\n\t};\n}\n\nexport class ParticipantsButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", 0);\n\t\tthis.foldButtonState = BX.prop.getString(config, \"foldButtonState\", ParticipantsButton.FoldButtonState.Hidden);\n\t\tthis.allowAdding = BX.prop.getBoolean(config, \"allowAdding\", false);\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tleftContainer: null,\n\t\t\trightContainer: null,\n\t\t\tfoldIcon: null,\n\t\t\tcount: null,\n\t\t\tseparator: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonListClick: BX.prop.getFunction(config, \"onListClick\", BX.DoNothing),\n\t\t\tonAddClick: BX.prop.getFunction(config, \"onAddClick\", BX.DoNothing)\n\t\t}\n\t};\n\n\tstatic FoldButtonState = {\n\t\tActive: \"active\",\n\t\tFold: \"fold\",\n\t\tUnfold: \"unfold\",\n\t\tHidden: \"hidden\"\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.leftContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-inner left\" + (this.foldButtonState != ParticipantsButton.FoldButtonState.Hidden ? \" active\" : \"\")},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon participants\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.count = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-text-count\"},\n\t\t\t\t\t\t\ttext: this.count\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.foldIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-fold-icon \" + this.foldButtonState},\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this.callbacks.onListClick\n\t\t\t\t\t}\n\t\t\t\t}),\n\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.separator = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-separator\"}\n\t\t});\n\t\tthis.elements.rightContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-inner active\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-text\"},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ADD\")\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon add\"}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onAddClick\n\t\t\t}\n\t\t});\n\n\t\tif (this.allowAdding)\n\t\t{\n\t\t\tthis.elements.root.appendChild(this.elements.separator);\n\t\t\tthis.elements.root.appendChild(this.elements.rightContainer);\n\t\t}\n\t\treturn this.elements.root;\n\t};\n\n\tupdate(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", this.count);\n\t\tthis.foldButtonState = BX.prop.getString(config, \"foldButtonState\", this.foldButtonState);\n\t\tthis.allowAdding = BX.prop.getBoolean(config, \"allowAdding\", this.allowAdding);\n\n\t\tthis.elements.count.innerText = this.count;\n\n\t\tthis.elements.foldIcon.className = \"bx-messenger-videocall-top-participants-fold-icon \" + this.foldButtonState;\n\t\tif (this.foldButtonState == ParticipantsButton.FoldButtonState.Hidden)\n\t\t{\n\t\t\tthis.elements.leftContainer.classList.remove(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.leftContainer.classList.add(\"active\");\n\t\t}\n\n\t\tif (this.allowAdding && !this.elements.separator.parentElement)\n\t\t{\n\t\t\tthis.elements.root.appendChild(this.elements.separator);\n\t\t\tthis.elements.root.appendChild(this.elements.rightContainer);\n\t\t}\n\t\tif (!this.allowAdding && this.elements.separator.parentElement)\n\t\t{\n\t\t\tBX.remove(this.elements.separator);\n\t\t\tBX.remove(this.elements.rightContainer);\n\t\t}\n\t};\n}\n\nexport class ParticipantsButtonMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", 0);\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticon: null,\n\t\t\ttext: null,\n\t\t\tarrow: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-icon\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.text = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-text\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_PARTICIPANTS\").replace(\"#COUNT#\", this.count)\n\t\t\t\t}),\n\t\t\t\tthis.elements.arrow = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-arrow\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tsetCount(count)\n\t{\n\t\tif (this.count == count)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.count = count;\n\t\tthis.elements.text.innerText = BX.message(\"IM_M_CALL_PARTICIPANTS\").replace(\"#COUNT#\", this.count);\n\t};\n}\n\nexport class RecordStatusButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.userId = config.userId;\n\t\tthis.recordState = config.recordState;\n\n\t\tthis.updateViewInterval = null;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ttimeText: null,\n\t\t\tstateText: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonPauseClick: BX.prop.getFunction(config, \"onPauseClick\", BX.DoNothing),\n\t\t\tonStopClick: BX.prop.getFunction(config, \"onStopClick\", BX.DoNothing),\n\t\t\tonMouseOver: BX.prop.getFunction(config, \"onMouseOver\", BX.DoNothing),\n\t\t\tonMouseOut: BX.prop.getFunction(config, \"onMouseOut\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus record-status-\" + this.recordState.state + \" \" + (this.recordState.userId == this.userId ? '' : 'record-user-viewer')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-status\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon record-status\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-time\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.timeText = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-time-text\"},\n\t\t\t\t\t\t\ttext: Util.getRecordTimeText(this.recordState)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-separator\"}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-buttons\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-button\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon record-pause\"},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.callbacks.onPauseClick\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tmouseover: this.callbacks.onMouseOver,\n\t\t\t\tmouseout: this.callbacks.onMouseOut\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tupdate(recordState)\n\t{\n\t\tif (this.recordState.state !== recordState.state)\n\t\t{\n\t\t\tclearInterval(this.updateViewInterval);\n\t\t\tif (recordState.state === View.RecordState.Started)\n\t\t\t{\n\t\t\t\tthis.updateViewInterval = setInterval(this.updateView.bind(this), 1000);\n\t\t\t}\n\t\t}\n\n\t\tthis.recordState = recordState;\n\t\tthis.updateView();\n\t}\n\n\tupdateView()\n\t{\n\t\tvar timeText = Util.getRecordTimeText(this.recordState);\n\t\tif (this.elements.timeText.innerText !== timeText)\n\t\t{\n\t\t\tthis.elements.timeText.innerText = Util.getRecordTimeText(this.recordState);\n\t\t}\n\n\t\tif (!this.elements.root.classList.contains(\"record-status-\" + this.recordState.state))\n\t\t{\n\t\t\tthis.elements.root.className = \"bx-messenger-videocall-top-recordstatus record-status-\" + this.recordState.state + ' ' + (this.recordState.userId == this.userId ? '' : 'record-user-viewer');\n\t\t}\n\t};\n\n\tstopViewUpdate()\n\t{\n\t\tif (this.updateViewInterval)\n\t\t{\n\t\t\tclearInterval(this.updateViewInterval);\n\t\t\tthis.updateViewInterval = null;\n\t\t}\n\t};\n}\n","import {Dom} from 'main.core';\nimport {createSVG} from './svg'\nimport {UserState} from '../engine/engine';\nimport Util from '../util'\nimport { Utils } from 'im.v2.lib.utils';\n\nexport class CallUserMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.userModel = config.userModel;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t\tavatarOutline: null,\n\t\t\tuserName: null,\n\t\t\tuserStatus: null,\n\t\t\tmenuArrow: null,\n\t\t\tfloorRequest: null,\n\t\t\tmic: null,\n\t\t\tcam: null,\n\t\t};\n\n\t\tthis._onUserFieldChangeHandler = this._onUserFieldChange.bind(this);\n\t\tthis.userModel.subscribe(\"changed\", this._onUserFieldChangeHandler);\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing)\n\t\t}\n\n\t\tthis.avatarBackground = Util.getAvatarBackground();\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-avatar\" + (this.userModel.talking ? \" talking\" : \"\")\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.floorRequest = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-floor-request bx-messenger-videocall-floor-request-icon\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-body\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-text\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.mic = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-icon\" + (this.userModel.microphoneState ? \"\" : \" bx-call-view-icon-red-microphone-off\")\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.cam = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-icon\" + (this.userModel.cameraState ? \"\" : \" bx-call-view-icon-red-camera-off\")\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.userName = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-username\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttext: this.userModel.name\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-menu-arrow\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.userStatus = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-user-status\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: this.userModel.pinned ? BX.message(\"IM_M_CALL_PINNED_USER\") : BX.message(\"IM_M_CALL_CURRENT_PRESENTER\")\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tupdate()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.userName.innerText = this.userModel.name;\n\n\t\tif (this.userModel.avatar !== '')\n\t\t{\n\t\t\tthis.elements.root.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t\tthis.elements.avatar.innerText = '';\n\t\t\tthis.elements.root.style.removeProperty(\"--avatar-background\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty(\"--avatar\");\n\t\t\tthis.elements.root.style.setProperty(\"--avatar-background\", this.avatarBackground);\n\t\t\tthis.elements.avatar.innerText = Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t\t}\n\t\tthis.elements.avatar.classList.toggle(\"talking\", this.userModel.talking);\n\t\tthis.elements.floorRequest.classList.toggle(\"active\", this.userModel.floorRequestState);\n\t\tthis.elements.mic.classList.toggle(\"bx-call-view-icon-red-microphone-off\", !this.userModel.microphoneState);\n\t\tthis.elements.cam.classList.toggle(\"bx-call-view-icon-red-camera-off\", !this.userModel.cameraState);\n\n\t\tthis.elements.userStatus.innerText = this.userModel.pinned ? BX.message(\"IM_M_CALL_PINNED_USER\") : BX.message(\"IM_M_CALL_CURRENT_PRESENTER\");\n\t};\n\n\tmount(parentElement)\n\t{\n\t\tparentElement.appendChild(this.render());\n\t};\n\n\tdismount()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tDom.remove(this.elements.root);\n\t};\n\n\tsetUserModel(userModel: UserModel)\n\t{\n\t\tthis.userModel.unsubscribe(\"changed\", this._onUserFieldChangeHandler);\n\t\tthis.userModel = userModel;\n\t\tthis.userModel.subscribe(\"changed\", this._onUserFieldChangeHandler);\n\t\tthis.update();\n\t};\n\n\t_onUserFieldChange(event)\n\t{\n\t\tthis.update();\n\t};\n}\n\nexport class UserSelectorMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.userRegistry = config.userRegistry;\n\t\tthis.userRegistry.subscribe(\"userAdded\", this._onUserAdded.bind(this));\n\t\tthis.userRegistry.subscribe(\"userChanged\", this._onUserChanged.bind(this));\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tusers: {}\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-selector-mobile\",\n\t\t\t},\n\t\t});\n\n\t\tthis.updateUsers();\n\n\t\treturn this.elements.root;\n\t};\n\n\trenderUser(userFields)\n\t{\n\t\treturn createSVG(\"svg\", {\n\t\t\tattrNS: {\n\t\t\t\twidth: 14.5, height: 11.6\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\torder: userFields.order\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tcreateSVG(\"circle\", {\n\t\t\t\t\tattrNS: {\n\t\t\t\t\t\tclass: \"bx-messenger-videocall-user-selector-mobile-border\" + (userFields.talking ? \" talking\" : \"\"),\n\t\t\t\t\t\tcx: 7.25, cy: 5.8, r: 4.6,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tcreateSVG(\"circle\", {\n\t\t\t\t\tattrNS: {\n\t\t\t\t\t\tclass: \"bx-messenger-videocall-user-selector-mobile-dot\" + (userFields.centralUser ? \" pinned\" : \"\"),\n\t\t\t\t\t\tcx: 7.25, cy: 5.8, r: 3.3\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tupdateUsers()\n\t{\n\t\tthis.userRegistry.users.forEach(function (userFields)\n\t\t{\n\t\t\tif (userFields.localUser || userFields.state != UserState.Connected)\n\t\t\t{\n\t\t\t\tif (this.elements.users[userFields.id])\n\t\t\t\t{\n\t\t\t\t\tBX.remove(this.elements.users[userFields.id]);\n\t\t\t\t\tthis.elements.users[userFields.id] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar newNode = this.renderUser(userFields);\n\t\t\t\tif (this.elements.users[userFields.id])\n\t\t\t\t{\n\t\t\t\t\tBX.replace(this.elements.users[userFields.id], newNode)\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.elements.root.appendChild(newNode)\n\t\t\t\t}\n\t\t\t\tthis.elements.users[userFields.id] = newNode;\n\t\t\t}\n\t\t}, this)\n\t};\n\n\t_onUserAdded(event)\n\t{\n\t\tthis.updateUsers();\n\t};\n\n\t_onUserChanged(event)\n\t{\n\t\tthis.updateUsers();\n\t};\n\n\tmount(parentElement)\n\t{\n\t\tparentElement.appendChild(this.render());\n\t};\n\n\tdismount()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBX.remove(this.elements.root);\n\t};\n}\n\nexport class MobileSlider\n{\n\tconstructor(config)\n\t{\n\t\tthis.parent = config.parent || null;\n\t\tthis.content = config.content || null;\n\n\t\tthis.elements = {\n\t\t\tbackground: null,\n\t\t\troot: null,\n\t\t\thandle: null,\n\t\t\tbody: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(config, \"onClose\", BX.DoNothing),\n\t\t\tonDestroy: BX.prop.getFunction(config, \"onDestroy\", BX.DoNothing),\n\t\t};\n\n\t\tthis.touchStartY = 0;\n\t\tthis.processedTouchId = 0;\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.background = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-background\"\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: this._onBackgroundClick.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-container\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.handle = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-handle\"\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tthis.elements.body = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.content\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\ttouchstart: this._onTouchStart.bind(this),\n\t\t\t\ttouchmove: this._onTouchMove.bind(this),\n\t\t\t\ttouchend: this._onTouchEnd.bind(this),\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tshow()\n\t{\n\t\tif (this.parent)\n\t\t{\n\t\t\tthis.render();\n\t\t\tthis.parent.appendChild(this.elements.root);\n\t\t\tthis.parent.appendChild(this.elements.background);\n\t\t}\n\t};\n\n\tclose()\n\t{\n\t\tBX.remove(this.elements.root);\n\t\tBX.remove(this.elements.background);\n\t\tthis.callbacks.onClose();\n\t};\n\n\tcloseWithAnimation()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.root.classList.add(\"closing\");\n\t\tthis.elements.background.classList.add(\"closing\");\n\t\tthis.elements.root.addEventListener(\"animationend\", function ()\n\t\t{\n\t\t\tthis.close();\n\t\t}.bind(this));\n\t};\n\n\t_onTouchStart(e)\n\t{\n\t\tthis.touchStartY = e.pageY;\n\t\tif (this.processedTouchId || e.touches.length > 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.target == this.elements.header || e.target == this.elements.root || this.elements.body.scrollTop === 0)\n\t\t{\n\t\t\tthis.processedTouchId = e.touches[0].identifier;\n\t\t}\n\t};\n\n\t_onTouchMove(e)\n\t{\n\t\tif (e.touches.length > 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.touches[0].identifier != this.processedTouchId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tvar delta = this.touchStartY - e.pageY;\n\t\tif (delta > 0)\n\t\t{\n\t\t\tdelta = 0;\n\t\t}\n\t\tthis.elements.root.style.bottom = delta + \"px\";\n\t\tif (delta)\n\t\t{\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\t_onTouchEnd(e)\n\t{\n\t\tvar allowProcessing = false;\n\t\tfor (var i = 0; i < e.changedTouches.length; i++)\n\t\t{\n\t\t\tif (e.changedTouches[i].identifier == this.processedTouchId)\n\t\t\t{\n\t\t\t\tallowProcessing = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!allowProcessing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar delta = e.pageY - this.touchStartY;\n\t\tif (delta > 100)\n\t\t{\n\t\t\tthis.closeWithAnimation();\n\t\t\te.preventDefault();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty(\"bottom\");\n\t\t}\n\n\t\tthis.processedTouchId = 0;\n\t\tthis.touchStartY = 0;\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.callbacks.onDestroy();\n\t\tthis.elements = {};\n\t\tthis.callbacks = {};\n\t\tthis.parent = null;\n\t};\n\n\t_onBackgroundClick()\n\t{\n\t\tthis.closeWithAnimation();\n\t};\n}\n\nexport class MobileMenu\n{\n\tconstructor(config)\n\t{\n\t\tthis.parent = config.parent || null;\n\t\tthis.header = BX.prop.getString(config, \"header\", \"\");\n\t\tthis.largeIcons = BX.prop.getBoolean(config, \"largeIcons\", false);\n\n\t\tthis.slider = null;\n\n\t\tvar items = BX.prop.getArray(config, \"items\", []);\n\t\tif (items.length === 0)\n\t\t{\n\t\t\tthrow Error(\"Items array should not be empty\");\n\t\t}\n\n\t\tthis.items = items\n\t\t\t.filter(item => typeof (item) === \"object\" && !!item)\n\t\t\t.map(item => new MobileMenuItem(item))\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\theader: null,\n\t\t\tbody: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(config, \"onClose\", BX.DoNothing),\n\t\t\tonDestroy: BX.prop.getFunction(config, \"onDestroy\", BX.DoNothing),\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.header = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-header\"\n\t\t\t},\n\t\t\ttext: this.header\n\t\t});\n\t\tthis.elements.body = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-body\" + (this.largeIcons ? \" bx-videocall-mobile-menu-large\" : \"\")\n\t\t\t}\n\t\t});\n\n\t\tthis.items.forEach(item =>\n\t\t{\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\tthis.elements.body.appendChild(item.render());\n\t\t\t}\n\t\t});\n\n\t\treturn BX.createFragment([\n\t\t\tthis.elements.header,\n\t\t\tthis.elements.body\n\t\t]);\n\t};\n\n\tsetHeader(header)\n\t{\n\t\tthis.header = header;\n\t\tif (this.elements.header)\n\t\t{\n\t\t\tthis.elements.header.innerText = header;\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.slider)\n\t\t{\n\t\t\tthis.slider = new MobileSlider({\n\t\t\t\tparent: this.parent,\n\t\t\t\tcontent: this.render(),\n\t\t\t\tonClose: this.onSliderClose.bind(this),\n\t\t\t\tonDestroy: this.onSliderDestroy.bind(this),\n\t\t\t});\n\t\t}\n\n\t\tthis.slider.show()\n\t};\n\n\tclose()\n\t{\n\t\tif (this.slider)\n\t\t{\n\t\t\tthis.slider.close()\n\t\t}\n\t};\n\n\tonSliderClose()\n\t{\n\t\tthis.slider.destroy();\n\t};\n\n\tonSliderDestroy()\n\t{\n\t\tthis.slider = null;\n\t\tthis.destroy();\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.slider)\n\t\t{\n\t\t\tthis.slider.destroy();\n\t\t}\n\t\tthis.slider = null;\n\t\tthis.items.forEach(function (item)\n\t\t{\n\t\t\titem.destroy();\n\t\t});\n\t\tthis.items = [];\n\n\t\tthis.callbacks.onDestroy();\n\t\tthis.elements = {};\n\t\tthis.callbacks = {};\n\t\tthis.parent = null;\n\t};\n}\n\nclass MobileMenuItem\n{\n\tconstructor(config)\n\t{\n\t\tthis.id = BX.prop.getString(config, \"id\", Util.getUuidv4());\n\t\tthis.icon = BX.prop.getString(config, \"icon\", \"\");\n\t\tthis.iconClass = BX.prop.getString(config, \"iconClass\", \"\");\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\t\tthis.showSubMenu = BX.prop.getBoolean(config, \"showSubMenu\", false);\n\t\tthis.separator = BX.prop.getBoolean(config, \"separator\", false);\n\t\tthis.enabled = BX.prop.getBoolean(config, \"enabled\", true);\n\t\tthis.userModel = BX.prop.get(config, \"userModel\", null);\n\t\tthis.avatarBackground = Util.getAvatarBackground();\n\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis._userChangeHandler = this._onUserChange.bind(this);\n\t\t\tthis.subscribeUserEvents();\n\t\t\tthis.text = this.userModel.name;\n\t\t\tthis.icon = this.userModel.avatar;\n\t\t\tthis.iconClass = \"user-avatar\";\n\t\t\tthis.iconText = Utils.text.getFirstLetters(this.userModel.name);\n\t\t\tthis.iconBackground = Util.getAvatarBackground();\n\t\t}\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticon: null,\n\t\t\tcontent: null,\n\t\t\tsubmenu: null,\n\t\t\tseparator: null,\n\t\t\tmic: null,\n\t\t\tcam: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tclick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tclickSubMenu: BX.prop.getFunction(config, \"onClickSubMenu\", BX.DoNothing),\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tif (this.separator)\n\t\t{\n\t\t\tthis.elements.root = Dom.create(\"hr\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-separator\",\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item\" + (this.enabled ? \"\" : \" disabled\"),\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-icon \" + this.iconClass\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tthis.elements.content = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-content\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\ttext: this.text\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t]\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this.callbacks.click\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.icon != \"\")\n\t\t\t{\n\t\t\t\tthis.elements.icon.style.backgroundImage = \"url(\\\"\" + this.icon + \"\\\")\";\n\t\t\t\tthis.elements.icon.innerText = '';\n\t\t\t}\n\t\t\telse if (this.iconText)\n\t\t\t{\n\t\t\t\tthis.elements.icon.innerText = this.iconText;\n\t\t\t\tthis.elements.root.style.setProperty(\"--avatar-background\", this.avatarBackground);\n\t\t\t}\n\n\t\t\tif (this.showSubMenu)\n\t\t\t{\n\t\t\t\tthis.elements.submenu = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-submenu-icon\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.elements.root.appendChild(this.elements.submenu);\n\t\t\t}\n\n\t\t\tif (this.userModel)\n\t\t\t{\n\t\t\t\tthis.elements.mic = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-icon-user bx-call-view-icon-red-microphone-off\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.elements.cam = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-icon-user bx-call-view-icon-red-camera-off\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (!this.userModel.cameraState)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.content.prepend(this.elements.cam);\n\t\t\t\t}\n\t\t\t\tif (!this.userModel.microphoneState)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.content.prepend(this.elements.mic);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tupdateUserIcons()\n\t{\n\t\tif (!this.userModel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.microphoneState)\n\t\t{\n\t\t\tBX.remove(this.elements.mic);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.content.prepend(this.elements.mic);\n\t\t}\n\t\tif (this.userModel.cameraState)\n\t\t{\n\t\t\tBX.remove(this.elements.cam);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.content.prepend(this.elements.cam);\n\t\t}\n\t};\n\n\tsubscribeUserEvents()\n\t{\n\t\tthis.userModel.subscribe(\"changed\", this._userChangeHandler);\n\t};\n\n\t_onUserChange(event)\n\t{\n\t\tthis.updateUserIcons();\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis.userModel.unsubscribe(\"changed\", this._userChangeHandler);\n\t\t\tthis.userModel = null;\n\t\t}\n\t\tthis.callbacks = null;\n\t\tthis.elements = null;\n\t};\n}\n","export function logPlaybackError(error)\n{\n\tconsole.error(\"Playback start error: \", error);\n}","import Util from './util';\n\nexport const MediaStreamsKinds = {\n\tCamera: 1,\n\tMicrophone: 2,\n\tScreen: 3,\n\tScreenAudio: 4,\n}\n\nclass Track {\n\tid = null;\n\tsource = '';\n\ttrack = {};\n\n\tconstructor(id, track) {\n\t\tthis.id = id;\n\t\tthis.source = track.source;\n\t\tthis.track = track\n\t}\n}\n\nclass Message {\n\ttext\n\tfrom\n\ttimestamp\n\n\tconstructor(message) {\n\t\tthis.text = message.message\n\t\tthis.from = message.senderSid\n\t\tthis.timestamp = Math.floor(Date.now() / 1000)\n\t}\n}\n\nconst STREAM_QUALITY = {\n\tHIGH: 2,\n\tMEDIUM: 1,\n\tLOW: 0,\n}\n\nexport const CALL_STATE = {\n\tCONNECTED: 'Connected',\n\tPROGRESSING: 'Progressing',\n\tTERMINATED: 'Terminated',\n}\n\nconst VIDEO_QUEUE = {\n\tINITIAL: '',\n\tENABLE: 'enable',\n\tDISABLE: 'disable',\n};\n\nconst LOG_LEVEL = {\n\tINFO: 'INFO',\n\tWARNING: 'WARNING',\n\tERROR: 'ERROR',\n};\n\nconst MONITORING_EVENTS_NAME_LIST = {\n\tTRACK_SUBSCRIPTION_FAILED: 3,\n\tTRACK_SUBSCRIPTION_DELAY: 4,\n\tHIGH_PACKET_LOSS_SEND: 7,\n\tHIGH_PACKET_LOSS_RECEIVE: 8,\n\tCPU_ISSUES: 9,\n\tNETWORK_ISSUES: 10,\n\tPEER_CONNECTION_REFUSED: 11,\n\tPEER_CONNECTION_ISSUES: 12,\n\tUSER_CAMERA_DISABLED: 14,\n\tUSER_RECONNECTED: 15,\n\tLOCAL_VIDEO_STREAM_RECEIVING_FAILED: 18,\n\tLOCAL_MICROPHONE_STREAM_RECEIVING_FAILED: 19,\n\tLOCAL_SCREEN_STREAM_RECEIVING_FAILED: 20,\n\tLOCAL_VIDEO_STREAM_PUBLICATION_FAILED: 21,\n\tLOCAL_MICROPHONE_STREAM_PUBLICATION_FAILED: 22,\n\tLOCAL_SCREEN_STREAM_PUBLICATION_FAILED: 23,\n};\n\nconst MONITORING_EVENTS_LIST = {\n\tmetrics: {\n\t\tPACKET_LOST_SEND: [],\n\t\tPACKET_LOST_RECEIVE: [],\n\t\tCOUNT_TRACKS: {video: 0, audio: 0},\n\t\tBITRATE_IN: [],\n\t\tBITRATE_OUT: [],\n\t\tCONN_SCORE_CURRENT: [],\n\t\tJITTER: [],\n\t\tTOTAL_FREEZE_DURATION: [],\n\t\tFREEZE_COUNT: [],\n\t\tFRAMES_DECODED: [],\n\t\tFRAMES_DROPPED: [],\n\t\tFRAMES_RECEIVED: [],\n\t\tFRAMES_LOSS: [],\n\t},\n\tstartTimestamp: 0,\n\tevents: []\n};\n\nconst ReconnectionReason = {\n\tNetworkError: 'NetworkError',\n\tPingPongMissed: 'PingPongMissed',\n\tPeerConnectionFailed: 'PeerConnectionFailed',\n\tWsTransportClosed: 'WsTransportClosed',\n\tLeaveCommand: 'LeaveCommand',\n\tJoinResponseError: 'JoinResponseError',\n};\n\nconst ErrorPreventingReconnection = {\n\tInputError: 2,\n\tAccessDenied: 3,\n\tRoomNotFound: 5,\n\tMalfunctioningSignaling: 7,\n};\n\nexport class Call {\n\tsender = null;\n\trecipient = null;\n\t#privateProperties = {\n\t\tclientVersion: '1.0.0',\n\t\tclientPlatform: 'web',\n\t\tcodec: 'vp8',\n\t\tcanReconnect: true,\n\t\tlogs: {},\n\t\tisloggingEnable: true,\n\t\tloggerCallback: null,\n\t\tabortController: new AbortController(),\n\t\tisWaitAnswer: false,\n\t\treportsForIncomingTracks: {},\n\t\treportsForOutgoingTracks: {},\n\t\tprevParticipantsWithLargeDataLoss: new Set(),\n\t\ttracksDataFromSocket: {},\n\t\trealTracksIds: {}, // todo: check why track ids are different in a stream and in the track itself\n\t\turl: null,\n\t\troomId: null,\n\t\ttoken: null,\n\t\tendpoint: null,\n\t\tjwt: null,\n\t\toptions: null,\n\t\ticeServers: null,\n\t\tsocketConnect: null,\n\t\tpeerConnectionFailed: false,\n\t\tpendingCandidates: {\n\t\t\trecipient: [],\n\t\t\tsender: [],\n\t\t},\n\t\tpendingPublications: {},\n\t\tpendingSubscriptions: {},\n\t\tpublicationTimeout: 10000,\n\t\tsubscriptionTimeout: 1500,\n\t\tsubscriptionTries: 5,\n\t\tcameraStream: null,\n\t\tmicrophoneStream: null,\n\t\tscreenStream: null,\n\t\tmediaMutedBySystem: false,\n\t\tneedToEnableAudioAfterSystemMuted: false,\n\t\tneedToDisableAudioAfterPublish: false,\n\t\tlocalTracks: {},\n\t\tlocalConnectionQuality: 0,\n\t\tminimalConnectionQuality: 2,\n\t\trtt: 0,\n\t\tpingIntervalDuration: 0,\n\t\tpingTimeoutDuration: 0,\n\t\tontrackData: {},\n\t\tremoteTracks: {},\n\t\tremoteParticipants: {},\n\t\tmainStream: {},\n\t\tpingPongTimeout: null,\n\t\tpingPongInterval: null,\n\t\tuserId: '',\n\t\tlocalParticipantSid: '',\n\t\tdefaultVideoResolution: {\n\t\t\twidth: 1280,\n\t\t\theight: 720\n\t\t},\n\t\tdefaultSimulcastBitrate: {\n\t\t\tq: 120000,\n\t\t\th: 300000,\n\t\t\tf: 1000000\n\t\t},\n\t\tdefaultRemoteStreamsQuality: STREAM_QUALITY.MEDIUM,\n\t\taudioBitrate: 70000,\n\t\tvideoBitrate: 1500000,\n\t\tscreenBitrate: 1500000,\n\t\tvideoSimulcast: true,\n\t\tscreenSimulcast: false,\n\t\tevents: new Map(),\n\t\toffersStack: 0,\n\t\taudioDeviceId: '',\n\t\tswitchActiveAudioDeviceInProgress: null,\n\t\tswitchActiveAudioDevicePending: null,\n\t\tvideoDeviceId: '',\n\t\tswitchActiveVideoDeviceInProgress: null,\n\t\tswitchActiveVideoDevicePending: null,\n\t\tisReconnecting: false,\n\t\treconnectionAttempt: 0,\n\t\treconnectionTimeout: null,\n\t\tlastReconnectionReason: null,\n\t\tfastReconnectionDelay: 1000,\n\t\treconnectionDelay: 5000,\n\t\tcallStatsInterval: null,\n\t\tcallState: '',\n\t\twasConnected: false,\n\t\tpacketLostThreshold: 7,\n\t\tstatsTimeout: 3000,\n\t\tvideoQueue: VIDEO_QUEUE.INITIAL,\n\t\tvideoStreamSetupErrorList: {},\n\t}\n\n\tconstructor() {\n\t\tthis.sendLeaveBound = this.#sendLeave.bind(this);\n\t\tthis.beforeDisconnectBound = this.#beforeDisconnect.bind(this);\n\n\t\tthis.monitoringEvents = [];\n\t\tthis.monitoringDelayTime = 60000;\n\t\tthis.monitoringIntervalTime = 10000;\n\t\tthis.countMetricsInMetricsInterval = this.monitoringDelayTime / this.#privateProperties.statsTimeout;\n\t\tthis.monitoringInterval = null;\n\t\tthis.currentMonitoringEventsObject = JSON.parse(JSON.stringify(MONITORING_EVENTS_LIST));\n\t\tthis.startTimestampGrabMetrics = null;\n\n\t\tthis.prevInboundRtpStatsSum = {\n\t\t\tfreezeCount: 0,\n\t\t\ttotalFreezesDuration: 0,\n\t\t\tjitter: 0,\n\t\t\tframesDecoded: 0,\n\t\t\tframesDropped: 0,\n\t\t\tframesReceived: 0,\n\t\t};\n\t}\n\n\tget isMediaMutedBySystem()\n\t{\n\t\treturn this.#privateProperties.mediaMutedBySystem;\n\t}\n\n\tcheckQosFeatureAndExecutionCallback(callback)\n\t{\n\t\tif (typeof callback === 'function' && Util.isNewQOSEnabled())\n\t\t{\n\t\t\tcallback();\n\t\t}\n\t}\n\n\tclearMonitoringEvents()\n\t{\n\t\tthis.monitoringEvents = [];\n\t}\n\n\taddMonitoringEvents({ name, value = undefined, withCounter = false })\n\t{\n\t\tconst currentEventIndex = this.currentMonitoringEventsObject.events.findIndex(evt => evt.name === name);\n\t\tconst lastTimestamp = Date.now();\n\n\t\tif (withCounter && currentEventIndex !== -1)\n\t\t{\n\t\t\tthis.currentMonitoringEventsObject.events[currentEventIndex].lastTimestamp = lastTimestamp;\n\t\t\tthis.currentMonitoringEventsObject.events[currentEventIndex].value += 1;\n\t\t\treturn;\n\t\t}\n\n\t\tif (withCounter && currentEventIndex === -1)\n\t\t{\n\t\t\tthis.currentMonitoringEventsObject.events.push({name, value: 1, lastTimestamp})\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentMonitoringEventsObject.events.push({name, value, lastTimestamp});\n\t}\n\n\tsetClearValuesForCurrentMonitoringEventsObject()\n\t{\n\t\tthis.currentMonitoringEventsObject = JSON.parse(JSON.stringify(MONITORING_EVENTS_LIST));\n\t}\n\n\tgetCountRemoteTracks()\n\t{\n\t\tlet countVideoTracks = 0;\n\t\tlet countAudioTracks = 0;\n\n\t\tObject.values(this.#privateProperties.remoteParticipants).forEach(participant =>\n\t\t{\n\t\t\tif (participant.getTrack(MediaStreamsKinds.Camera) && !participant.isMutedVideo && !participant.isLocalVideoMute)\n\t\t\t{\n\t\t\t\tcountVideoTracks += 1;\n\t\t\t}\n\n\t\t\tif (participant.getTrack(MediaStreamsKinds.Microphone) && !participant.isMutedAudio)\n\t\t\t{\n\t\t\t\tcountAudioTracks += 1;\n\t\t\t}\n\n\t\t\tif (participant.getTrack(MediaStreamsKinds.Screen))\n\t\t\t{\n\t\t\t\tcountVideoTracks += 1;\n\t\t\t}\n\n\t\t\tif (participant.getTrack(MediaStreamsKinds.ScreenAudio))\n\t\t\t{\n\t\t\t\tcountAudioTracks += 1;\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tcountVideoTracks,\n\t\t\tcountAudioTracks,\n\t\t}\n\t}\n\n\tstartAggregateMonitoringEvents()\n\t{\n\t\tthis.startTimestampGrabMetrics = Date.now();\n\t\tthis.currentMonitoringEventsObject.startTimestamp = this.startTimestampGrabMetrics;\n\n\t\tthis.monitoringInterval = setInterval(() => {\n\t\t\tconst { countVideoTracks, countAudioTracks } = this.getCountRemoteTracks();\n\n\t\t\tthis.currentMonitoringEventsObject.metrics.COUNT_TRACKS = {\n\t\t\t\tvideo: countVideoTracks,\n\t\t\t\taudio: countAudioTracks,\n\t\t\t};\n\t\t}, this.monitoringIntervalTime);\n\n\t\tthis.monitoringTimeout = setTimeout(() => {\n\t\t\tclearTimeout(this.monitoringTimeout);\n\t\t\tthis.monitoringTimeout = null;\n\n\t\t\tif (this.#privateProperties.isReconnecting)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.sendMonitoringEvents();\n\t\t}, this.monitoringDelayTime);\n\n\t}\n\n\tsendMonitoringEvents(withRestart = true)\n\t{\n\t\tconst eventsToSend = [];\n\t\tconst eventsToLog = [];\n\n\t\tthis.currentMonitoringEventsObject.events.forEach(evt =>\n\t\t{\n\t\t\tlet eventName = '';\n\t\t\tconst eventList = Object.entries(MONITORING_EVENTS_NAME_LIST);\n\t\t\tfor (let i = 0; i < eventList.length; i++)\n\t\t\t{\n\t\t\t\tif (eventList[i][1] === evt.name)\n\t\t\t\t{\n\t\t\t\t\teventName = eventList[i][0];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst eventData = {\n\t\t\t\tmediaServerId: 0, // TODO: should be replaced with real value for large rooms; 0 - only for small rooms\n\t\t\t\tmessage: '',\n\t\t\t\tvalue: JSON.stringify(evt.value),\n\t\t\t\teventTime: Math.round(evt.lastTimestamp / 1000)\n\t\t\t};\n\n\t\t\teventsToSend.push({\n\t\t\t\teventTypeId: evt.name,\n\t\t\t\t...eventData,\n\t\t\t});\n\n\t\t\teventsToLog.push({\n\t\t\t\teventTypeId: eventName,\n\t\t\t\t...eventData,\n\t\t\t});\n\t\t});\n\n\t\tconst objForSend = {\n\t\t\taudioSubscribed: this.currentMonitoringEventsObject.metrics.COUNT_TRACKS.audio,\n\t\t\tvideoSubscribed: this.currentMonitoringEventsObject.metrics.COUNT_TRACKS.video,\n\t\t\tpacketLoss: this.currentMonitoringEventsObject.metrics.PACKET_LOST_RECEIVE,\n\t\t\tbitrateIn: this.currentMonitoringEventsObject.metrics.BITRATE_IN,\n\t\t\tbitrateOut: this.currentMonitoringEventsObject.metrics.BITRATE_OUT,\n\t\t\tconnScore:  this.currentMonitoringEventsObject.metrics.CONN_SCORE_CURRENT,\n\t\t\tframesLoss: this.currentMonitoringEventsObject.metrics.FRAMES_LOSS,\n\t\t\tfreezeCount: this.currentMonitoringEventsObject.metrics.FREEZE_COUNT,\n\t\t\ttotalFreezesDuration: this.currentMonitoringEventsObject.metrics.TOTAL_FREEZE_DURATION,\n\t\t\tjitter: this.currentMonitoringEventsObject.metrics.JITTER,\n\t\t\tevents: eventsToSend,\n\t\t};\n\n\t\tobjForSend.events = eventsToSend;\n\n\t\tthis.#sendSignal({ sendQoS: objForSend });\n\n\t\tclearInterval(this.monitoringInterval);\n\t\tthis.monitoringInterval = null;\n\t\tclearTimeout(this.monitoringTimeout);\n\t\tthis.monitoringTimeout = null;\n\t\tthis.setClearValuesForCurrentMonitoringEventsObject();\n\n\t\tif (withRestart)\n\t\t{\n\t\t\tthis.startAggregateMonitoringEvents();\n\t\t}\n\t}\n\n\tonPublishFailed(kind)\n\t{\n\t\tthis.triggerEvents('PublishFailed', [kind]);\n\t\tlet eventName;\n\t\tif (kind === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\teventName = MONITORING_EVENTS_NAME_LIST.LOCAL_VIDEO_STREAM_PUBLICATION_FAILED;\n\t\t}\n\t\telse if (kind === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\teventName = MONITORING_EVENTS_NAME_LIST.LOCAL_MICROPHONE_STREAM_PUBLICATION_FAILED;\n\t\t}\n\t\telse if (kind === MediaStreamsKinds.Screen)\n\t\t{\n\t\t\teventName = MONITORING_EVENTS_NAME_LIST.LOCAL_SCREEN_STREAM_PUBLICATION_FAILED;\n\t\t}\n\n\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t{\n\t\t\tthis.addMonitoringEvents({\n\t\t\t\tname: eventName,\n\t\t\t\twithCounter: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tasync connect(options) {\n\t\tthis.setLog(`Connecting to the call (desktop: ${Util.isDesktop()})`, LOG_LEVEL.INFO);\n\t\tthis.#privateProperties.callState = CALL_STATE.PROGRESSING\n\n\t\tfor (let key in options) {\n\t\t\tthis.#privateProperties[`${key}`] = options[key]\n\t\t}\n\n\t\tif (!this.#privateProperties.endpoint) {\n\t\t\tthis.setLog(`Missing required param 'endpoint' from backend, disconnecting`, LOG_LEVEL.ERROR);\n\t\t\tthis.triggerEvents('Failed', [{name: 'AUTHORIZE_ERROR', message: `Missing required param 'endpoint'`}]);\n\t\t\treturn;\n\t\t}\n\t\tif (!this.#privateProperties.jwt) {\n\t\t\tthis.setLog(`Missing required param 'jwt' from backend, disconnecting`, LOG_LEVEL.ERROR);\n\t\t\tthis.triggerEvents('Failed', [{name: 'AUTHORIZE_ERROR', message: `Missing required param 'jwt'`}]);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#privateProperties.endpoint = this.#privateProperties.endpoint.replace(/\\/+$/, '');\n\n\t\ttry\n\t\t{\n\t\t\tconst mediaServerInfo = await this.getMediaServerInfo();\n\t\t\tthis.#privateProperties.url = mediaServerInfo.url;\n\t\t\tthis.#privateProperties.token = mediaServerInfo.token;\n\t\t\tthis.#privateProperties.data = mediaServerInfo.data;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tif (error.name !== 'AbortError' && !this.#privateProperties.abortController.signal.aborted)\n\t\t\t{\n\t\t\t\tthis.#reconnect();\n\t\t\t}\n\t\t\telse if (this.#privateProperties.abortController.signal.aborted)\n\t\t\t{\n\t\t\t\tthis.triggerEvents('Failed', [error]);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#privateProperties.abortController.signal.aborted)\n\t\t{\n\t\t\tthis.#beforeDisconnect();\n\t\t\treturn;\n\t\t}\n\t\tthis.#privateProperties.abortController.signal.addEventListener('abort', this.beforeDisconnectBound);\n\n\t\tthis.#privateProperties.socketConnect = new WebSocket(`${this.#privateProperties.url}?access_token=${this.#privateProperties.token}&auto_subscribe=1&sdk=js&version=1.6.7&protocol=8&roomData=${this.#privateProperties.data}`);\n\t\tthis.#privateProperties.socketConnect.onmessage = (e) => this.socketOnMessageHandler(e);\n\t\tthis.#privateProperties.socketConnect.onopen = () => this.socketOnOpenHandler();\n\t\tthis.#privateProperties.socketConnect.onerror = () => this.socketOnErrorHandler();\n\t\tthis.#privateProperties.socketConnect.onclose = (e) => this.socketOnCloseHandler(e);\n\t};\n\n\t#reconnect() {\n\t\tthis.#privateProperties.isReconnecting = true;\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\n\t\tconst reconnect = () =>\n\t\t{\n\t\t\tconst reconnectionDelay = this.#privateProperties.lastReconnectionReason !== ReconnectionReason.JoinResponseError\n\t\t\t\t? this.#privateProperties.fastReconnectionDelay\n\t\t\t\t: this.#privateProperties.reconnectionDelay;\n\t\t\tthis.setLog(`Reconnecting attempt: ${++this.#privateProperties.reconnectionAttempt}`, LOG_LEVEL.WARNING);\n\t\t\tthis.#privateProperties.reconnectionTimeout = setTimeout(this.connect.bind(this), reconnectionDelay);\n\t\t};\n\n\t\treconnect();\n\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t{\n\t\t\tthis.addMonitoringEvents({\n\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.USER_RECONNECTED,\n\t\t\t\twithCounter: true,\n\t\t\t});\n\t\t});\n\t\tthis.triggerEvents('Reconnecting');\n\t};\n\n\t#beforeDisconnect() {\n\t\twindow.removeEventListener('unload', this.sendLeaveBound);\n\t\tthis.#clearPingInterval();\n\t\tthis.#clearPingTimeout();\n\t\tclearInterval(this.#privateProperties.callStatsInterval);\n\n\t\tthis.#privateProperties.localTracks = {};\n\t\tthis.#privateProperties.isWaitAnswer = false;\n\n\t\tif (this.#privateProperties.socketConnect)\n\t\t{\n\t\t\tthis.#privateProperties.socketConnect.onmessage = null;\n\t\t\tthis.#privateProperties.socketConnect.onopen = null;\n\t\t\tthis.#privateProperties.socketConnect.onerror = null;\n\t\t\tthis.#privateProperties.socketConnect.onclose = null;\n\t\t\tthis.#privateProperties.socketConnect.close();\n\t\t\tthis.#privateProperties.socketConnect = null;\n\t\t}\n\t}\n\n\tgetMediaServerInfo() {\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\tlet url = `${this.#privateProperties.endpoint}/join`;\n\t\t\t\turl += `?token=${this.#privateProperties.jwt}`;\n\t\t\t\turl += `&clientVersion=${this.#privateProperties.clientVersion}`;\n\t\t\t\turl += `&clientPlatform=${this.#privateProperties.clientPlatform}`;\n\t\t\tlet response;\n\t\t\tlet data;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tresponse = await fetch(url, {\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\tsignal: this.#privateProperties.abortController.signal,\n\t\t\t\t});\n\t\t\t\tif (!response.ok)\n\t\t\t\t{\n\t\t\t\t\tthrow new Error(`Got response code ${response.status}`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (error.name === 'AbortError')\n\t\t\t\t{\n\t\t\t\t\treject(error);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.NetworkError;\n\t\t\t\t\treject({name: 'MEDIASERVER_UNREACHABLE', message: error.message});\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tdata = await response.json();\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.JoinResponseError;\n\t\t\t\treject({name: 'MEDIASERVER_UNEXPECTED_ANSWER', message: error.message});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (data.result?.mediaServerUrl && data.result?.tokenToAccessMediaServer && data.result?.roomData)\n\t\t\t{\n\t\t\t\tresolve({\n\t\t\t\t\turl: data.result.mediaServerUrl,\n\t\t\t\t\ttoken: data.result.tokenToAccessMediaServer,\n\t\t\t\t\tdata: data.result.roomData,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tdata?.error?.code === ErrorPreventingReconnection.InputError\n\t\t\t\t\t|| data?.error?.code === ErrorPreventingReconnection.AccessDenied\n\t\t\t\t\t|| data?.error?.code === ErrorPreventingReconnection.RoomNotFound\n\t\t\t\t\t|| data?.error?.code === ErrorPreventingReconnection.MalfunctioningSignaling\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.abortController.abort();\n\t\t\t\t\treject(data.error);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.JoinResponseError;\n\t\t\t\t\treject({name: 'MEDIASERVER_MISSING_PARAMS', message: `Incorrect signaling response`});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tasync sendOffer() {\n\t\tif (this.#privateProperties.offersStack > 0 && !this.#privateProperties.isWaitAnswer) {\n\t\t\tthis.setLog('Start sending an offer', LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.isWaitAnswer = true;\n\t\t\tthis.#privateProperties.offersStack--;\n\n\t\t\ttry {\n\t\t\t\tlet offer = await this.sender.createOffer();\n\t\t\t\tif (Util.useTcpSdp())\n\t\t\t\t{\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: offer.type,\n\t\t\t\t\t\tsdp: this.#removeUdpFromSdp(offer.sdp),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tawait this.sender.setLocalDescription(offer);\n\t\t\t\tthis.#sendSignal({ offer });\n\t\t\t\tthis.setLog('Sending an offer succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.setLog(`Sending an offer failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t\tthis.#beforeDisconnect();\n\t\t\t\tthis.#reconnect();\n\t\t\t}\n\t\t}\n\t}\n\n\tasync startStream() {\n\t\tconst videoTrack = await this.getLocalVideo();\n\t\tif (videoTrack) {\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Camera, videoTrack);\n\t\t} else {\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Camera);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.Camera);\n\t\t}\n\n\t\tconst audioTrack = await this.getLocalAudio();\n\t\tif (audioTrack) {\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Microphone, audioTrack);\n\t\t} else {\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Microphone);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.Microphone);\n\t\t}\n\t}\n\n\tasync socketOnMessageHandler(event) {\n\t\tif (typeof event.data !== 'string') return;\n\n\t\tlet data\n\n\t\ttry\n\t\t{\n\t\t\tdata = JSON.parse(event.data);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tthis.setLog(`Could not parse a socket message: ${event.data}`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tif (data?.answer){\n\t\t\tawait this.#answerHandler(data);\n\t\t} else if (data?.offer) {\n\t\t\tawait this.#offerHandler(data);\n\t\t} else if (data?.joinResponse) {\n\t\t\tthis.#privateProperties.abortController.signal.removeEventListener('abort', this.beforeDisconnectBound);\n\n\t\t\tthis.#privateProperties.iceServers = data.joinResponse.iceServers;\n\t\t\tthis.#privateProperties.localParticipantSid = data.joinResponse.localParticipant.sid;\n\t\t\tthis.#createPeerConnection()\n\n\t\t\tconst connectedEvent = this.#privateProperties.isReconnecting && this.wasConnected\n\t\t\t\t? 'Reconnected'\n\t\t\t\t: 'Connected';\n\n\t\t\tthis.#privateProperties.callState = CALL_STATE.CONNECTED;\n\t\t\tthis.wasConnected = true;\n\t\t\tthis.setLog(`${connectedEvent} to the call ${this.#privateProperties.roomId} on the mediaserver after ${this.#privateProperties.reconnectionAttempt} attempts`, LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.isReconnecting = false;\n\t\t\tthis.#privateProperties.reconnectionAttempt = 0;\n\t\t\tthis.triggerEvents(connectedEvent);\n\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tif (connectedEvent === 'Reconnected' && this.monitoringEvents.length)\n\t\t\t\t{\n\t\t\t\t\tthis.sendMonitoringEvents();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst participantsToDelete = {...this.#privateProperties.remoteParticipants};\n\t\t\tObject.values(data.joinResponse.otherParticipants).forEach( p => {\n\t\t\t\tif (participantsToDelete[p.userId])\n\t\t\t\t{\n\t\t\t\t\tdelete participantsToDelete[p.userId];\n\t\t\t\t}\n\t\t\t\tthis.setLog(`Adding an early connected participant with id ${p.userId} (sid: ${p.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.#setRemoteParticipant(p);\n\t\t\t})\n\n\t\t\tfor (let userId in participantsToDelete)\n\t\t\t{\n\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\t\t\tthis.setLog(`Deleting a missing participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents('ParticipantLeaved', [participant]);\n\t\t\t\tdelete this.#privateProperties.remoteTracks[userId];\n\t\t\t\tdelete this.#privateProperties.remoteParticipants[userId];\n\t\t\t}\n\n\t\t\tthis.#privateProperties.pingIntervalDuration = data.joinResponse.pingInterval * 1000\n\t\t\tthis.#privateProperties.pingTimeoutDuration = this.#privateProperties.pingIntervalDuration * 2\n\t\t\tthis.#startPingInterval()\n\t\t} else if (data?.participantJoined) {\n\t\t\tthis.setLog(`Adding a new participant with id ${data.participantJoined.participant.userId} (sid: ${data.participantJoined.participant.sid})`, LOG_LEVEL.INFO);\n\t\t\tthis.#setRemoteParticipant(data.participantJoined.participant);\n\t\t} else if (data?.participantLeft) {\n\t\t\tconst participantId = data.participantLeft.userId;\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\tconst pendingSubscriptions = this.#privateProperties.pendingSubscriptions[participantId];\n\n\t\t\tif (pendingSubscriptions)\n\t\t\t{\n\t\t\t\tfor (let trackId in pendingSubscriptions)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(pendingSubscriptions[trackId].timeout);\n\t\t\t\t\tthis.setLog(`A participant with id ${participantId} (sid: ${data.participantLeft.sid}) left during subscription attempt, cancel it`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\n\t\t\t\tdelete this.#privateProperties.pendingSubscriptions[participantId];\n\t\t\t}\n\n\t\t\tif (participant)\n\t\t\t{\n\t\t\t\tthis.setLog(`Deleting a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents('ParticipantLeaved', [participant]);\n\t\t\t\tdelete this.#privateProperties.remoteTracks[participantId];\n\t\t\t\tdelete this.#privateProperties.remoteParticipants[participantId];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Got participantLeft signal for a non-existent participant with id ${participantId} (sid: ${data.participantLeft.sid})`, LOG_LEVEL.WARNING);\n\t\t\t}\n\t\t} else if (data?.trackCreated) {\n\t\t\tconst participantId = data.trackCreated.userId;\n\t\t\tconst cid = data.trackCreated.cid;\n\t\t\tconst track = data.trackCreated.track;\n\t\t\tconst trackId = track.sid;\n\t\t\ttrack.userId = participantId\n\t\t\tif (participantId == this.#privateProperties.userId) {\n\t\t\t\tconst timeout = this.#privateProperties.pendingPublications[cid];\n\t\t\t\tif (timeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.#privateProperties.pendingPublications[cid]);\n\t\t\t\t\tdelete this.#privateProperties.pendingPublications[cid];\n\n\t\t\t\t\tthis.setLog(`Publishing a local track with kind ${track.source} (sid: ${trackId}) succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.#privateProperties.localTracks[track.source] = track\n\t\t\t\t\tthis.triggerEvents('PublishSucceed', [track.source]);\n\t\t\t\t\tif (track.source === MediaStreamsKinds.Microphone && this.#privateProperties.needToDisableAudioAfterPublish)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#privateProperties.needToDisableAudioAfterPublish = false;\n\t\t\t\t\t\tthis.disableAudio();\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.source === MediaStreamsKinds.Camera && this.#privateProperties.videoQueue)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#processVideoQueue();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.setLog(`Got trackCreated signal for a non-existent local track with kind ${track.source} (sid: ${trackId})`, LOG_LEVEL.WARNING);\n\t\t\t} else {\n\t\t\t\tthis.#privateProperties.tracksDataFromSocket[trackId] = track;\n\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\t\tif (participant)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Got a track info with kind ${track.source} (sid: ${data.trackCreated.track.sid}) for a participant with id ${participantId} (sid: ${participant.sid}), waiting for it`, LOG_LEVEL.INFO);\n\t\t\t\t\tswitch (track.source)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\t\t\t\tparticipant.videoEnabled = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\t\t\t\tparticipant.audioEnabled = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\t\t\t\tparticipant.screenSharingEnabled = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst ontrackData = this.#privateProperties.ontrackData[trackId];\n\t\t\t\t\tdelete this.#privateProperties.ontrackData[trackId];\n\n\t\t\t\t\tif (ontrackData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#createRemoteTrack(trackId, ontrackData);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#addPendingSubscription(participant, track);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Got a track info with kind ${track.source} (sid: ${data.trackCreated.track.sid}) for a non-existent participant with id ${participantId}`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (data?.trackDeleted) {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst participantId = data.trackDeleted.publisher;\n\t\t\t\tconst trackId = data.trackDeleted.shortId;\n\t\t\t\tconst pendingSubscription = this.#privateProperties.pendingSubscriptions[participantId]?.[trackId];\n\n\t\t\t\tif (pendingSubscription)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(pendingSubscription.timeout);\n\t\t\t\t\tdelete this.#privateProperties.pendingSubscriptions[participantId][trackId];\n\t\t\t\t\tthis.setLog(`Track with id ${trackId} was deleted during subscription attempt, cancel it`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\n\t\t\t\tif (participantId == this.#privateProperties.userId) return;\n\t\t\t\tthis.setLog(`Start deleting a track with id ${trackId} from a participant with id ${participantId} `, LOG_LEVEL.INFO);\n\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\t\tif (!participant)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} failed: can't find a participant with id ${participantId}`, LOG_LEVEL.WARNING);\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst track = Object.values(participant.tracks)?.find(track => track?.id === trackId);\n\t\t\t\tdelete this.#privateProperties.tracksDataFromSocket[trackId];\n\n\t\t\t\tif (track)\n\t\t\t\t{\n\t\t\t\t\tif (track.source === MediaStreamsKinds.Microphone)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipant.audioEnabled = false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipant.videoEnabled = false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.source === MediaStreamsKinds.Screen)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipant.screenSharingEnabled = false;\n\t\t\t\t\t}\n\t\t\t\t\tparticipant.removeTrack(track.source);\n\t\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} from a participant with id ${participantId} (sid: ${participant.sid}) succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.triggerEvents('RemoteMediaRemoved', [participant, track]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} from a participant with id ${participantId} (sid: ${participant.sid}) failed: can't find a track`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} from a participant with id ${participantId} failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t}\n\t\t} else if (data?.trackMuted) {\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[data.trackMuted.track.publisher];\n\t\t\tconst trackId = data.trackMuted.track.shortId;\n\t\t\tif (data.trackMuted.track.publisher == this.#privateProperties.userId)\n\t\t\t{\n\t\t\t\tconst track = Object.values(this.#privateProperties.localTracks)?.find(track => track?.sid === trackId);\n\t\t\t\tif (track)\n\t\t\t\t{\n\t\t\t\t\tif (track.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!data.trackMuted.muted && track.muted && !this.#privateProperties.mediaMutedBySystem)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.triggerEvents('PublishSucceed', [track.source]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!this.#privateProperties.mediaMutedBySystem)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.triggerEvents('PublishPaused', [track.source]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.#privateProperties.videoQueue)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#processVideoQueue();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if(track.source === MediaStreamsKinds.Microphone)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.triggerEvents('PublishPaused', [track.source, data.trackMuted.muted]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!participant) {\n\t\t\t\tif (data.trackMuted.track.publisher != this.#privateProperties.userId)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Got mute signal (${data.trackMuted.muted}) for a non-existent participant with id ${data.trackMuted.track.publisher}`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst track = Object.values(participant.tracks)?.find(track => track?.id === trackId);\n\t\t\tconst awaitedTrack = this.#privateProperties.tracksDataFromSocket[trackId];\n\t\t\tif (awaitedTrack && !track)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.tracksDataFromSocket[trackId].muted = data.trackMuted.muted;\n\t\t\t\tthis.setLog(`Got mute signal (${data.trackMuted.muted}) for a non-received track with id ${trackId}`, LOG_LEVEL.WARNING);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (!track)\n\t\t\t{\n\t\t\t\tthis.setLog(`Got mute signal (${data.trackMuted.muted}) for a non-existent track with id ${trackId}`, LOG_LEVEL.WARNING);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (track.source === MediaStreamsKinds.Microphone)\n\t\t\t{\n\t\t\t\tparticipant.isMutedAudio = data.trackMuted.muted;\n\t\t\t\tconst eventName = data.trackMuted.muted\n\t\t\t\t\t? 'RemoteMediaMuted'\n\t\t\t\t\t: 'RemoteMediaUnmuted';\n\t\t\t\tthis.setLog(`Got mute signal (${data.trackMuted.muted}) for audio from a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents(eventName, [participant, track]);\n\t\t\t}\n\t\t\telse if (track.source === MediaStreamsKinds.Camera)\n\t\t\t{\n\t\t\t\tparticipant.isMutedVideo = data.trackMuted.muted;\n\t\t\t\tconst eventName = data.trackMuted.muted\n\t\t\t\t\t? 'RemoteMediaRemoved'\n\t\t\t\t\t: 'RemoteMediaAdded';\n\t\t\t\tthis.setLog(`Got mute signal (${data.trackMuted.muted}) for video from a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents(eventName, [participant, track]);\n\t\t\t}\n\t\t} else if (data?.trickle) {\n\t\t\tthis.#addIceCandidate(data.trickle);\n\t\t} else if (data?.newMessage) {\n\t\t\tconst message = new Message(data.newMessage)\n\t\t\tthis.triggerEvents('MessageReceived', [message]);\n\t\t} else if (data?.handRaised) {\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[data.handRaised.participantId];\n\t\t\tif (participant)\n\t\t\t{\n\t\t\t\tparticipant.isHandRaised = data.handRaised.isHandRaised;\n\t\t\t\tthis.triggerEvents('HandRaised', [participant]);\n\t\t\t}\n\t\t} else if (data?.speakersChanged) {\n\t\t\tthis.#speakerChangedHandler(data)\n\t\t} else if (data?.subscribedQualityUpdate) {\n\t\t\tconsole.log(data)\n\t\t} else if (data?.connectionQuality) {\n\t\t\tconsole.log(data);\n\t\t\tif (!data.connectionQuality.updates)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst participants = {};\n\t\t\tconst participantsToUpdate = { ...this.#privateProperties.remoteParticipants };\n\n\t\t\tdata.connectionQuality.updates.forEach(participant => {\n\t\t\t\tObject.values(participantsToUpdate).forEach(remoteParticipant => {\n\n\t\t\t\t\tconst hasGoodQuality = participant.score > this.#privateProperties.minimalConnectionQuality;\n\t\t\t\t\tif (\n\t\t\t\t\t\tparticipant.participantSid === remoteParticipant.sid\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t!remoteParticipant.isMutedVideo\n\t\t\t\t\t\t\t|| !remoteParticipant.connectionQuality\n\t\t\t\t\t\t)\n\t\t\t\t\t\t&& !remoteParticipant.screenSharingEnabled\n\t\t\t\t\t) {\n\t\t\t\t\t\tparticipants[remoteParticipant.userId] = participant.score;\n\t\t\t\t\t\tthis.setLog(`Quality of connection with a participant with id ${remoteParticipant.userId} (sid: ${remoteParticipant.sid}) changed to ${participant.score}`, hasGoodQuality ? LOG_LEVEL.INFO : LOG_LEVEL.WARNING);\n\t\t\t\t\t\tthis.#privateProperties.remoteParticipants[remoteParticipant.userId].connectionQuality = participant.score;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst isLocalVideoMuted = this.#privateProperties.localTracks[MediaStreamsKinds.Camera]\n\t\t\t\t\t\t&& this.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted;\n\n\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (participant.participantSid === this.#privateProperties.localParticipantSid)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.currentMonitoringEventsObject.metrics.CONN_SCORE_CURRENT.push(participant.score);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tparticipant.participantSid === this.#privateProperties.localParticipantSid\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t!isLocalVideoMuted\n\t\t\t\t\t\t\t|| !this.#privateProperties.localConnectionQuality\n\t\t\t\t\t\t)\n\t\t\t\t\t\t&& !this.#privateProperties.localTracks[MediaStreamsKinds.Screen]\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipants[this.#privateProperties.userId] = participant.score;\n\t\t\t\t\t\tthis.#privateProperties.localConnectionQuality =  participant.score;\n\n\t\t\t\t\t\tthis.setLog(`Quality of connection with a mediaserver changed to ${participant.score}`, hasGoodQuality ? LOG_LEVEL.INFO : LOG_LEVEL.WARNING);\n\t\t\t\t\t\t// this.#toggleRemoteParticipantVideo(Object.keys(participantsToUpdate), hasGoodQuality);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.triggerEvents('ConnectionQualityChanged', [participants]);\n\t\t} else if (data.pongResp) {\n\t\t\tthis.#privateProperties.rtt = Date.now() - data.pongResp.lastPingTimestamp\n\t\t\tthis.#resetPingTimeout()\n\t\t} else if (data.leave) {\n\t\t\tthis.setLog(`Got leave signal with ${data.leave.reason} reason`, LOG_LEVEL.WARNING);\n\t\t\tthis.#beforeDisconnect();\n\n\t\t\tif (\n\t\t\t\t(data.leave.canReconnect || data.leave.reason === 'CHANGING_MEDIA_SERVER') &&\n\t\t\t\tdata.leave.reason !== \"SIGNALING_DUPLICATE_PARTICIPANT\")\n\t\t\t{\n\t\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.LeaveCommand;\n\t\t\t\tthis.#reconnect();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#privateProperties.canReconnect = false;\n\t\t\t\tthis.triggerEvents('Failed', [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: data.leave.reason,\n\t\t\t\t\t\tleaveInformation: {code: data.leave.code, reason: data.leave.reason}\n\t\t\t\t\t}]);\n\t\t\t}\n\t\t}\n\t};\n\tsocketOnOpenHandler() {\n\t\twindow.addEventListener('unload', this.sendLeaveBound)\n\t};\n\n\tsocketOnCloseHandler(e) {\n\t\tthis.#beforeDisconnect();\n\n\t\tif (e?.code && e?.code !== 1005)\n\t\t{\n\n\t\t\tthis.setLog(`Socket closed with a code ${e.code}, reconnecting`, LOG_LEVEL.ERROR);\n\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.WsTransportClosed;\n\t\t\tthis.#reconnect();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Socket closed with a code ${e.code}`, LOG_LEVEL.ERROR);\n\t\t}\n\t};\n\tsocketOnErrorHandler() {\n\t\tthis.setLog(`Got a socket error`, LOG_LEVEL.ERROR);\n\t};\n\tasync onIceCandidate(target, event) {\n\t\tif (!event.candidate) return;\n\n\t\tif (Util.useTcpSdp() && event.candidate.protocol !== 'tcp')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst trickle = {\n\t\t\tcandidateInit: JSON.stringify({\n\t\t\t\tcandidate: event.candidate.candidate,\n\t\t\t\tsdpMid: event.candidate?.sdpMid,\n\t\t\t\tsdpMLineIndex: event.candidate?.sdpMLineIndex,\n\t\t\t\tusernameFragment: event.candidate?.usernameFragment\n\t\t\t})\n\t\t};\n\n\t\tif (target) {\n\t\t\ttrickle.target = target;\n\t\t}\n\n\t\tthis.#sendSignal({ trickle });\n\t};\n\tonConnectionStateChange(subscriber) {\n\t\tconst state = subscriber\n\t\t\t? this.recipient.connectionState\n\t\t\t: this.sender.connectionState\n\n\t\tif (state === 'failed' && !this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\tthis.setLog(`State of ${subscriber ? 'recipient' : 'sender'} peer connection changed to ${state}, reconnecting`, LOG_LEVEL.WARNING);\n\t\t\tif (this.#privateProperties.peerConnectionFailed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#privateProperties.peerConnectionFailed = true;\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_REFUSED,\n\t\t\t\t\twithCounter: true,\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.#beforeDisconnect();\n\t\t\tif (this.#privateProperties.canReconnect)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.PeerConnectionFailed;\n\t\t\t\tthis.#reconnect();\n\t\t\t}\n\t\t}\n\t}\n\n\t#resetPingTimeout() {\n\t\tthis.#clearPingTimeout()\n\t\tif (!this.#privateProperties.pingTimeoutDuration) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#privateProperties.pingTimeout = setTimeout(() => {\n\t\t\tthis.setLog('Ping signal was not received, reconnecting', LOG_LEVEL.WARNING);\n\t\t\tthis.#beforeDisconnect();\n\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.PingPongMissed;\n\t\t\tthis.#reconnect();\n\t\t}, this.#privateProperties.pingTimeoutDuration);\n\t}\n\n\n\t#clearPingTimeout() {\n\t\tif (this.#privateProperties.pingTimeout) {\n\t\t\tclearTimeout(this.#privateProperties.pingTimeout);\n\t\t}\n\t}\n\n\t#startPingInterval() {\n\t\tthis.#clearPingInterval()\n\t\tthis.#resetPingTimeout()\n\t\tif (!this.#privateProperties.pingIntervalDuration) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#privateProperties.pingPongInterval = setInterval(() => {\n\t\t\tthis.#sendPing();\n\t\t}, this.#privateProperties.pingIntervalDuration);\n\t}\n\n\t#clearPingInterval() {\n\t\tthis.#clearPingTimeout();\n\t\tif (this.#privateProperties.pingPongInterval) {\n\t\t\tclearInterval(this.#privateProperties.pingPongInterval);\n\t\t}\n\t}\n\n\t#sendPing() {\n\t\tthis.#sendSignal({\n\t\t\tpingReq: {\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t\trtt: this.#privateProperties.rtt\n\t\t\t}\n\t\t});\n\t}\n\n\ton(eventType, handler) {\n\t\tthis.#privateProperties.events.set(eventType, handler)\n\t\treturn this\n\t}\n\toff(eventType) {\n\t\tif (this.#privateProperties.events.has(eventType)) {\n\t\t\treturn this.#privateProperties.events.delete(eventType)\n\t\t}\n\t\treturn this\n\t}\n\n\ttriggerEvents(eventType, args) {\n\t\tif (this.#privateProperties.events.has(eventType)) {\n\t\t\tconst event = this.#privateProperties.events.get(eventType)\n\t\t\tif (args) {\n\t\t\t\tevent(...args)\n\t\t\t} else {\n\t\t\t\tevent()\n\t\t\t}\n\t\t}\n\t}\n\n\tisRecordable() {\n\t\tconsole.log('isRecordable')\n\t}\n\n\tsetBitrate(bitrate, MediaStreamKind) {\n\t\tthis.setLog('Start setting bitrate', LOG_LEVEL.INFO);\n\t\tlet track;\n\t\tlet isSimulcast;\n\t\tswitch (MediaStreamKind) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\ttrack = this.#privateProperties.cameraStream.getVideoTracks[0];\n\t\t\t\tisSimulcast = this.#privateProperties.videoSimulcast;\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\ttrack = this.#privateProperties.microphoneStream.getAudioTracks[0];\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\ttrack = this.#privateProperties.screenStream.getVideoTracks[0];\n\t\t\t\tbreak;\n\t\t}\n\t\tconst senders = this.sender.getSenders()\n\n\t\tsenders.forEach( (sender) => {\n\t\t\tconst params = sender.getParameters();\n\t\t\tif(!params || !params.encodings || params.encodings.length === 0)\n\t\t\t{\n\t\t\t\tthis.setLog('Setting bitrate failed: has no encodings in the sender parameters', LOG_LEVEL.WARNING);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tparams.encodings.forEach(encoding => {\n\t\t\t\t\tif (isSimulcast) {\n\t\t\t\t\t\tencoding.maxBitrate = bitrate < this.#privateProperties.defaultSimulcastBitrate[encoding.rid] ? bitrate : this.#privateProperties.defaultSimulcastBitrate[encoding.rid]\n\t\t\t\t\t} else {\n\t\t\t\t\t\tencoding.maxBitrate = bitrate\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tsender.setParameters(params);\n\t\t\t\tthis.setLog('Setting bitrate succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t});\n\t}\n\n\t#addPendingPublication(trackId, source)\n\t{\n\t\tthis.#privateProperties.pendingPublications[trackId] = setTimeout(() =>\n\t\t{\n\t\t\tdelete this.#privateProperties.pendingPublications[trackId];\n\t\t\tthis.onPublishFailed(source);\n\t\t}, this.#privateProperties.publicationTimeout);\n\t}\n\n\t#addPendingSubscription(participant, track, tries)\n\t{\n\t\tclearTimeout(this.#privateProperties.pendingSubscriptions[participant.userId]?.[track.sid]?.timeout);\n\t\tif (!this.#privateProperties.pendingSubscriptions[participant.userId])\n\t\t{\n\t\t\tthis.#privateProperties.pendingSubscriptions[participant.userId] = {};\n\t\t}\n\n\t\tif (tries === undefined)\n\t\t{\n\t\t\ttries = this.#privateProperties.subscriptionTries;\n\t\t}\n\n\t\tconst timeout = setTimeout(() => {\n\t\t\tthis.setLog(`Track ${track.sid} with kind ${track.source} for a participant with id ${participant.userId} (sid: ${participant.sid}) was not received, trying to subscribe to it`, LOG_LEVEL.WARNING);\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.TRACK_SUBSCRIPTION_DELAY,\n\t\t\t\t\twithCounter: true,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (tries)\n\t\t\t{\n\t\t\t\tthis.#addPendingSubscription(participant, track, tries - 1)\n\t\t\t\tthis.#changeSubscriptionToTrack(track.sid, participant.sid, true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Subscription to track ${track.sid} with kind ${track.source} for a participant with id ${participant.userId} (sid: ${participant.sid}) failed`, LOG_LEVEL.ERROR);\n\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.TRACK_SUBSCRIPTION_FAILED,\n\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, this.#privateProperties.subscriptionTimeout);\n\n\t\tthis.#privateProperties.pendingSubscriptions[participant.userId][track.sid] = {\n\t\t\ttimeout,\n\t\t\ttries,\n\t\t};\n\t}\n\n\tsetCodec(transceiver)\n\t{\n\t\tif (!('getCapabilities' in RTCRtpReceiver)) {\n\t\t\treturn;\n\t\t}\n\t\tconst cap = RTCRtpReceiver.getCapabilities('video');\n\t\tif (!cap) return;\n\t\tconst matched = [];\n\t\tconst partialMatched = [];\n\t\tconst unmatched = [];\n\t\tcap.codecs.forEach((c) => {\n\t\t\tconst codec = c.mimeType.toLowerCase();\n\t\t\tif (codec === 'audio/opus') {\n\t\t\t\tmatched.push(c);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst matchesVideoCodec = codec === `video/${this.#privateProperties.codec}`;\n\t\t\tif (!matchesVideoCodec) {\n\t\t\t\tunmatched.push(c);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// for h264 codecs that have sdpFmtpLine available, use only if the\n\t\t\t// profile-level-id is 42e01f for cross-browser compatibility\n\t\t\tif (this.#privateProperties.codec === 'h264') {\n\t\t\t\tif (c.sdpFmtpLine && c.sdpFmtpLine.includes('profile-level-id=42e01f')) {\n\t\t\t\t\tmatched.push(c);\n\t\t\t\t} else {\n\t\t\t\t\tpartialMatched.push(c);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmatched.push(c);\n\t\t});\n\n\t\tif ('setCodecPreferences' in transceiver) {\n\t\t\t// console.log('setCodecPreferences', this.#privateProperties.codec, matched, partialMatched, unmatched);\n\t\t\ttransceiver.setCodecPreferences(matched.concat(partialMatched, unmatched));\n\t\t}\n\t}\n\n\tasync publishTrack(MediaStreamKind, MediaStreamTrack, StreamQualityOptions = {}) {\n\t\tif (!this.sender)\n\t\t{\n\t\t\tthis.setLog(`Publishing a track before a peer connection was created, ignoring`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog(`Start publishing a track with kind ${MediaStreamKind}`, LOG_LEVEL.INFO);\n\n\t\ttry {\n\t\t\tfor (let keys in StreamQualityOptions ) {\n\t\t\t\tthis.#privateProperties[`${keys}`] = StreamQualityOptions[keys]\n\t\t\t}\n\n\t\t\tconst source = MediaStreamKind;\n\t\t\tMediaStreamTrack.source = source;\n\t\t\tif (source === MediaStreamsKinds.Camera) {\n\t\t\t\tif( this.#privateProperties.videoSimulcast) {\n\t\t\t\t\tconst width = MediaStreamTrack.getSettings().width;\n\t\t\t\t\tconst height = MediaStreamTrack.getSettings().height;\n\n\t\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Camera);\n\t\t\t\t\tif (sender)\n\t\t\t\t\t{\n\t\t\t\t\t\tawait sender.replaceTrack(MediaStreamTrack);\n\t\t\t\t\t\tthis.#updateVideoEncodings(sender, MediaStreamTrack);\n\t\t\t\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} via replace track succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\t\tthis.triggerEvents('PublishSucceed', [MediaStreamsKinds.Camera]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst encodings = this.#getEncodingsFromVideoWidth(width);\n\n\t\t\t\t\t\tconst transceiver = this.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\t\t\tdirection: 'sendonly',\n\t\t\t\t\t\t\tstreams: [this.#privateProperties.cameraStream],\n\t\t\t\t\t\t\tsendEncodings: MediaStreamTrack.sendEncodings || encodings,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.setCodec(transceiver)\n\n\t\t\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\t\t\"cid\":  MediaStreamTrack.id,\n\t\t\t\t\t\t\t\t\"type\":  \"VIDEO\",\n\t\t\t\t\t\t\t\t\"width\":  width,\n\t\t\t\t\t\t\t\t\"height\":  height,\n\t\t\t\t\t\t\t\t\"source\":  source,\n\t\t\t\t\t\t\t\t\"layers\":  this.#getLayersFromEncodings(width, height, encodings),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Camera);\n\t\t\t\t\tif (sender)\n\t\t\t\t\t{\n\t\t\t\t\t\tawait sender.replaceTrack(MediaStreamTrack);\n\t\t\t\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} via replace track succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\t\tthis.triggerEvents('PublishSucceed', [MediaStreamsKinds.Camera]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.setBitrate(this.#privateProperties.videoBitrate, MediaStreamsKinds.Camera)\n\n\t\t\t\t\t\tconst width = MediaStreamTrack.getSettings().width\n\t\t\t\t\t\tconst height = MediaStreamTrack.getSettings().height\n\n\t\t\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\t\t\"cid\":  MediaStreamTrack.id,\n\t\t\t\t\t\t\t\t\"type\":  \"VIDEO\",\n\t\t\t\t\t\t\t\t\"width\":  width,\n\t\t\t\t\t\t\t\t\"height\":  height,\n\t\t\t\t\t\t\t\t\"source\":  source,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (source === MediaStreamsKinds.Microphone) {\n\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Microphone);\n\t\t\t\tif (sender)\n\t\t\t\t{\n\t\t\t\t\tawait sender.replaceTrack(MediaStreamTrack);\n\t\t\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} via replace track succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.triggerEvents('PublishSucceed', [MediaStreamsKinds.Microphone]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\t\"cid\" : MediaStreamTrack.id,\n\t\t\t\t\t\t\t\"source\":  source\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (source === MediaStreamsKinds.Screen) {\n\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t});\n\t\t\t\tconst width = MediaStreamTrack.getSettings().width\n\t\t\t\tconst height = MediaStreamTrack.getSettings().height\n\n\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\"cid\":  MediaStreamTrack.id,\n\t\t\t\t\t\t\"type\":  \"VIDEO\",\n\t\t\t\t\t\t\"width\":  width,\n\t\t\t\t\t\t\"height\":  height,\n\t\t\t\t\t\t\"source\":  source,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (source === MediaStreamsKinds.ScreenAudio) {\n\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t});\n\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t});\n\n\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\"cid\" : MediaStreamTrack.id,\n\t\t\t\t\t\t\"source\":  source\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.#privateProperties.offersStack++;\n\t\t\tawait this.sendOffer();\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tif (MediaStreamKind === MediaStreamsKinds.Microphone)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.needToDisableAudioAfterPublish = false;\n\t\t\t}\n\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamKind);\n\t\t\tthis.onPublishFailed(MediaStreamKind);\n\t\t}\n\t}\n\n\t#getMaxEncodingsByVideoWidth(width)\n\t{\n\t\t// https://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/video/config/simulcast.cc;l=76;\n\t\tif (width >= 960)\n\t\t{\n\t\t\treturn 3;\n\t\t}\n\t\telse if (width >= 480)\n\t\t{\n\t\t\treturn 2;\n\t\t}\n\t\treturn 1;\n\t}\n\n\t#getEncodingsFromVideoWidth(width)\n\t{\n\t\tconst maxEncodings = this.#getMaxEncodingsByVideoWidth(width);\n\t\tconst rids = ['q', 'h', 'f'];\n\t\tconst encodings = [];\n\n\t\tfor (let i = 0; i < 3; i++)\n\t\t{\n\t\t\tconst rid = rids[i];\n\t\t\tencodings.push({\n\t\t\t\trid,\n\t\t\t\tactive: i < maxEncodings,\n\t\t\t\tmaxBitrate: this.#privateProperties.defaultSimulcastBitrate[rid],\n\t\t\t\tscaleResolutionDownBy: 2 ** Math.max(0, (maxEncodings - 1 - i))\n\t\t\t});\n\t\t}\n\n\t\treturn encodings;\n\t};\n\n\t#getLayersFromEncodings(width, height, encodings)\n\t{\n\t\treturn encodings.map((encoding, index) =>\n\t\t{\n\t\t\treturn {\n\t\t\t\tquality: index,\n\t\t\t\twidth: width / encoding.scaleResolutionDownBy,\n\t\t\t\theight: height / encoding.scaleResolutionDownBy,\n\t\t\t\tbitrate: this.#privateProperties.defaultSimulcastBitrate[encoding.rid],\n\t\t\t}\n\t\t});\n\t}\n\n\t#updateVideoEncodings(sender, track)\n\t{\n\t\tconst params = sender.getParameters();\n\t\tconst width = track.getSettings().width;\n\t\tconst encodings = this.#getEncodingsFromVideoWidth(width);\n\n\t\tif (params && params.encodings && params.encodings.length)\n\t\t{\n\t\t\tparams.encodings.forEach((encoding) =>\n\t\t\t{\n\t\t\t\tconst encodingByRid = encodings.find(el => el.rid === encoding.rid);\n\t\t\t\tif (encodingByRid)\n\t\t\t\t{\n\t\t\t\t\tencoding.active = encodingByRid.active;\n\t\t\t\t\tencoding.maxBitrate = encodingByRid.maxBitrate;\n\t\t\t\t\tencoding.scaleResolutionDownBy = encodingByRid.scaleResolutionDownBy;\n\t\t\t\t}\n\t\t\t});\n\t\t\tsender.setParameters(params);\n\t\t}\n\t}\n\n\tasync changeStreamQuality(StreamQualityOptions) {\n\t\tfor (let key in StreamQualityOptions) {\n\t\t\tif (this.#privateProperties[`${key}`] !== StreamQualityOptions[key]) {\n\t\t\t\tthis.#privateProperties[`${key}`] = StreamQualityOptions[key]\n\n\t\t\t\tif (key === 'videoSimulcast' || (key === 'screenSimulcast' && this.#privateProperties.screenStream)) {\n\t\t\t\t\tconst kind = key === 'videoSimulcast'\n\t\t\t\t\t\t? MediaStreamsKinds.Camera\n\t\t\t\t\t\t: MediaStreamsKinds.Screen\n\n\t\t\t\t\tif (this.#getSender(kind)) {\n\t\t\t\t\t\tawait this.republishTrack(kind)\n\t\t\t\t\t}\n\t\t\t\t} else if ( ['videoBitrate', 'audioBitrate', 'screenBitrate'].includes(key)) {\n\t\t\t\t\tconst kind = key === 'videoBitrate'\n\t\t\t\t\t\t? MediaStreamsKinds.Camera\n\t\t\t\t\t\t: key === 'screenBitrate'\n\t\t\t\t\t\t\t? MediaStreamsKinds.Screen\n\t\t\t\t\t\t\t: MediaStreamsKinds.Microphone\n\n\t\t\t\t\tawait this.setBitrate(StreamQualityOptions[key], kind)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync republishTrack(MediaStreamKind) {\n\t\tthis.setLog(`Start republishing a track with kind ${MediaStreamKind}`, LOG_LEVEL.INFO);\n\t\tawait this.unpublishTrack(MediaStreamKind);\n\t\tconst track = await this.getTrack(MediaStreamKind);\n\t\tif (track) {\n\t\t\tawait this.publishTrack(MediaStreamKind, track);\n\t\t} else {\n\t\t\tthis.setLog(`Republishing a track with kind ${MediaStreamKind} failed: ${error}`, LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamKind);\n\t\t\tthis.triggerEvents('PublishFailed', [MediaStreamKind])\n\t\t}\n\t}\n\n\tasync unpublishTrack(MediaStreamKind) {\n\t\tthis.setLog(`Start unpublishing a track with kind ${MediaStreamKind}`, LOG_LEVEL.INFO);\n\t\tconst sender = this.#getSender(MediaStreamKind);\n\n\t\tif (sender) {\n\t\t\tthis.sender.removeTrack(sender);\n\t\t\tthis.#privateProperties.offersStack++;\n\t\t\tawait this.sendOffer();\n\t\t\tthis.setLog(`Unpublishing a track with kind ${MediaStreamKind} succeeded`, LOG_LEVEL.INFO);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Unpublishing a track with kind ${MediaStreamKind} failed: has no sender for a track`, LOG_LEVEL.ERROR);\n\t\t}\n\t}\n\n\ttoggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle = false) {\n\t\tthis.#toggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle);\n\t}\n\n\t#changeSubscriptionToTrack(trackId, participantId, subscribe)\n\t{\n\t\tthis.#sendSignal({\n\t\t\tsubscription: {\n\t\t\t\ttrackSids: [trackId],\n\t\t\t\tsubscribe,\n\t\t\t\tparticipantTracks: [\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipantSid: participantId,\n\t\t\t\t\t\ttrackSids: [trackId],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t}\n\t\t});\n\t}\n\n\t#pauseRemoteTrack(userId, trackId, trackSource, pause)\n\t{\n\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\tif (!participant)\n\t\t{\n\t\t\tthis.setLog(`Trying to pause a track with kind ${trackSource} (sid: ${trackId}) for a non-existent participant with id ${userId}`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tparticipant.videoPaused = pause;\n\t\tthis.#sendSignal({\n\t\t\ttrackSetting: {\n\t\t\t\ttrackSids: [trackId],\n\t\t\t\tdisabled: pause,\n\t\t\t\tquality: this.#calculateVideoQualityForUser(userId, trackSource),\n\t\t\t}\n\t\t});\n\t}\n\n\t#calculateVideoQualityForUser(userId, source)\n\t{\n\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\tconst exactUser = this.#privateProperties.mainStream.userId == userId;\n\t\tconst exactTrack = this.#privateProperties.mainStream.kind === source;\n\n\t\tlet quality = STREAM_QUALITY.LOW;\n\t\tif (exactUser && (exactTrack || !participant.screenSharingEnabled))\n\t\t{\n\t\t\tquality = STREAM_QUALITY.HIGH;\n\t\t}\n\t\telse if (!this.#privateProperties.mainStream.userId)\n\t\t{\n\t\t\tquality = this.#privateProperties.defaultRemoteStreamsQuality;\n\t\t}\n\n\t\treturn quality;\n\t}\n\n\t#changeRoomStreamsQuality(userId, kind) {\n\t\tthis.setLog(`Start changing a streams quality`, LOG_LEVEL.INFO);\n\t\tObject.values(this.getParticipants()).forEach(p =>\n\t\t{\n\t\t\tlet quality = this.#privateProperties.defaultRemoteStreamsQuality;\n\t\t\tif (userId)\n\t\t\t{\n\t\t\t\tconst exactUser = userId == p.userId;\n\t\t\t\tquality = exactUser && kind === MediaStreamsKinds.Camera ? STREAM_QUALITY.HIGH : STREAM_QUALITY.MEDIUM;\n\n\t\t\t\tif (exactUser)\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.mainStream = { userId, kind };\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#privateProperties.mainStream = {};\n\t\t\t}\n\n\t\t\tp.setStreamQuality(quality);\n\t\t\tthis.setLog(`Quality of video for a participant with id ${p.userId} (sid: ${p.sid}) was changed to ${quality}`, LOG_LEVEL.INFO);\n\t\t})\n\t}\n\n\t#toggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle = false)\n\t{\n\t\tparticipantIds.forEach(participantId => {\n\t\t\tconst remoteParticipant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\tif (remoteParticipant && remoteParticipant.tracks[MediaStreamsKinds.Camera] && remoteParticipant.isLocalVideoMute === showVideo)\n\t\t\t{\n\t\t\t\tremoteParticipant.isLocalVideoMute = !showVideo;\n\n\t\t\t\tif (remoteParticipant.isMutedVideo)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#pauseRemoteTrack(\n\t\t\t\t\tremoteParticipant.userId,\n\t\t\t\t\tremoteParticipant.tracks[MediaStreamsKinds.Camera].id,\n\t\t\t\t\tremoteParticipant.tracks[MediaStreamsKinds.Camera].source,\n\t\t\t\t\tremoteParticipant.isLocalVideoMute\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tif (!isPaginateToggle)\n\t\t{\n\t\t\tthis.triggerEvents('ToggleRemoteParticipantVideo', [showVideo]);\n\t\t}\n\t}\n\n\thangup() {\n\t\tif (this.#privateProperties.callState === CALL_STATE.TERMINATED)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#privateProperties.abortController.abort();\n\n\t\tthis.#privateProperties.callState = CALL_STATE.TERMINATED;\n\n\t\tthis.setLog(`Disconnecting from the call`, LOG_LEVEL.INFO);\n\t\tthis.#sendLeave();\n\t\tthis.#beforeDisconnect();\n\t\tthis.#destroyPeerConnection();\n\n\t\tclearTimeout(this.#privateProperties.reconnectionTimeout);\n\n\t\tfor (let trackId in this.#privateProperties.pendingPublications)\n\t\t{\n\t\t\tclearTimeout(this.#privateProperties.pendingPublications[trackId]);\n\t\t}\n\t\tthis.#privateProperties.pendingPublications = {};\n\n\t\tfor (let userId in this.#privateProperties.pendingSubscriptions)\n\t\t{\n\t\t\tfor (let trackId in this.#privateProperties.pendingSubscriptions[userId])\n\t\t\t{\n\t\t\t\tclearTimeout(this.#privateProperties.pendingSubscriptions[userId][trackId].timeout);\n\t\t\t}\n\t\t}\n\t\tthis.#privateProperties.pendingSubscriptions = {};\n\n\t\tthis.#privateProperties.url = null;\n\t\tthis.#privateProperties.token = null;\n\t\tthis.#privateProperties.endpoint = null;\n\t\tthis.#privateProperties.jwt = null;\n\t\tthis.#privateProperties.options = null;\n\t\tthis.#privateProperties.iceServers = null;\n\t\tthis.#privateProperties.lastReconnectionReason = null;\n\n\t\tthis.#releaseStream(MediaStreamsKinds.Camera);\n\t\tthis.#releaseStream(MediaStreamsKinds.Microphone);\n\t\tthis.#releaseStream(MediaStreamsKinds.Screen);\n\n\t\tthis.#privateProperties.rtt = 0;\n\t\tthis.#privateProperties.remoteTracks = {};\n\t\tthis.#privateProperties.isReconnecting = false;\n\t\tthis.#privateProperties.reconnectionAttempt = 0;\n\t\tthis.#privateProperties.mainStream = {};\n\n\t\tthis.triggerEvents('Disconnected');\n\t}\n\n\tisConnected() {\n\t\treturn this.#privateProperties.callState === CALL_STATE.CONNECTED\n\t}\n\n\tsetVideoStreamSetupErrorList(userId, kind)\n\t{\n\t\tconst errorInVideoStreamSetupErrorList = this.#privateProperties.videoStreamSetupErrorList[userId];\n\t\tconst kindInListKinds = !!errorInVideoStreamSetupErrorList && errorInVideoStreamSetupErrorList.includes(kind);\n\t\tconst kindsArray = errorInVideoStreamSetupErrorList || [];\n\n\t\tif (!kindInListKinds)\n\t\t{\n\t\t\tthis.#privateProperties.videoStreamSetupErrorList[userId] = [kind, ...kindsArray];\n\t\t}\n\t}\n\n\tsetMainStream(userId, kind)\n\t{\n\t\t// userId always exists, check in bitrix_call\n\t\tif (!this.#privateProperties.remoteParticipants[userId])\n\t\t{\n\t\t\tthis.setVideoStreamSetupErrorList(userId, kind);\n\t\t\tthis.setLog(`Setting main stream error (No remoteParticipant with ID - ${userId} in list)`, LOG_LEVEL.ERROR);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog(`Setting main stream for a participant width id ${userId} (sid: ${this.#privateProperties.remoteParticipants[userId].sid})`, LOG_LEVEL.INFO);\n\t\tthis.#changeRoomStreamsQuality(userId, kind);\n\t}\n\n\tresetMainStream() {\n\t\tthis.setLog(`Resetting main stream`, LOG_LEVEL.INFO);\n\t\tthis.#changeRoomStreamsQuality()\n\t}\n\n\tremoveTrack(mediaStreamKind) {\n\t\tconst trackSid = this.#privateProperties.localTracks[mediaStreamKind]?.sid\n\t\tif (trackSid)\n\t\t{\n\t\t\tthis.setLog(`Sending removeTrack signal for a track with kind ${mediaStreamKind} (sid: ${trackSid})`, LOG_LEVEL.INFO);\n\t\t\tdelete this.#privateProperties.localTracks[mediaStreamKind];\n\t\t\tthis.#sendSignal({\n\t\t\t\tremoveTrack: {\n\t\t\t\t\tsid: trackSid\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Sending removeTrack signal for a non-existent track with kind ${mediaStreamKind}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tpauseTrack(mediaStreamKind, keepTrack) {\n\t\tconst trackSid = this.#privateProperties.localTracks[mediaStreamKind]?.sid;\n\t\tif (trackSid)\n\t\t{\n\t\t\tthis.setLog(`Sending pause signal (keep: ${keepTrack}) for a track with kind ${mediaStreamKind} (sid: ${trackSid})`, LOG_LEVEL.INFO);\n\t\t\tif (!keepTrack)\n\t\t\t{\n\t\t\t\tdelete this.#privateProperties.localTracks[mediaStreamKind];\n\t\t\t}\n\t\t\tthis.#sendSignal({\n\t\t\t\tmute: {\n\t\t\t\t\tsid: trackSid,\n\t\t\t\t\tmuted: true\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Sending pause signal for a non-existent track with kind ${mediaStreamKind}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tunpauseTrack(mediaStreamKind) {\n\t\tconst trackSid = this.#privateProperties.localTracks[mediaStreamKind]?.sid;\n\t\tif (trackSid)\n\t\t{\n\t\t\tthis.setLog(`Sending unpause signal for a track with kind ${mediaStreamKind} (sid: ${trackSid})`, LOG_LEVEL.INFO);\n\t\t\tthis.#sendSignal({\n\t\t\t\tmute: {\n\t\t\t\t\tsid: trackSid,\n\t\t\t\t\tmuted: false\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Sending unpause signal for a non-existent track with kind ${mediaStreamKind}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tdisableAudio(bySystem = false) {\n\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog('Start disabling audio', LOG_LEVEL.INFO);\n\t\tconst track = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\tif (track)\n\t\t{\n\t\t\tthis.#privateProperties.needToEnableAudioAfterSystemMuted = bySystem ? track.enabled : false;\n\t\t\ttrack.enabled = false;\n\t\t\tthis.pauseTrack(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Disabling audio failed: has no track', LOG_LEVEL.ERROR);\n\t\t}\n\t}\n\n\tasync enableAudio(disabled = false)\n\t{\n\t\tthis.setLog('Start enabling audio', LOG_LEVEL.INFO);\n\t\tthis.#privateProperties.needToEnableAudioAfterSystemMuted = false;\n\t\tif (this.#privateProperties.switchActiveAudioDeviceInProgress)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait this.#privateProperties.switchActiveAudioDeviceInProgress;\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.onPublishFailed(MediaStreamsKinds.Microphone);\n\t\t\t}\n\t\t}\n\t\tlet track = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\tconst canUseUnpauseSignal = track && this.#privateProperties.localTracks[MediaStreamsKinds.Microphone];\n\t\tconst needToGetNewTrack = track?.readyState !== 'live';\n\n\t\tif (needToGetNewTrack)\n\t\t{\n\t\t\ttrack = await this.getLocalAudio();\n\t\t}\n\n\t\tif (!track)\n\t\t{\n\n\t\t\tthis.setLog('Enabling audio failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Microphone);\n\t\t\tthis.triggerEvents('PublishFailed', [MediaStreamsKinds.Microphone]);\n\t\t}\n\n\t\tif (canUseUnpauseSignal)\n\t\t{\n\t\t\tthis.setLog('Enabling audio via unpause signal', LOG_LEVEL.INFO);\n\t\t\ttrack.enabled = true;\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Microphone, track);\n\t\t\tthis.unpauseTrack(MediaStreamsKinds.Microphone);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Enabling audio via publish', LOG_LEVEL.INFO);\n\t\t\ttrack.enabled = !disabled;\n\t\t\tif (disabled)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.needToDisableAudioAfterPublish = true;\n\t\t\t}\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Microphone, track);\n\t\t}\n\t}\n\n\tasync disableVideo(bySystem = false)\n\t{\n\t\tif (this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst hasQueue = this.#privateProperties.videoQueue !== VIDEO_QUEUE.INITIAL;\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.DISABLE;\n\t\tif (hasQueue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setLog('Start disabling video', LOG_LEVEL.INFO);\n\t\tconst track = this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t\tif (track && this.#privateProperties.localTracks[MediaStreamsKinds.Camera])\n\t\t{\n\t\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\t\t\t\ttrack.stop();\n\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.USER_CAMERA_DISABLED,\n\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tthis.triggerEvents('MediaMutedBySystem', [false]);\n\t\t\t\tthis.triggerEvents('PublishEnded', [MediaStreamsKinds.Camera]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted = true;\n\t\t\tthis.pauseTrack(MediaStreamsKinds.Camera, true);\n\t\t\tif (!bySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t\t\ttrack.stop();\n\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.USER_CAMERA_DISABLED,\n\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tthis.triggerEvents('PublishEnded', [MediaStreamsKinds.Camera]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Disabling video failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t}\n\t}\n\n\tasync enableVideo(skipUnpause = false) {\n\t\tif (this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst hasQueue = this.#privateProperties.videoQueue !== VIDEO_QUEUE.INITIAL;\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.ENABLE;\n\t\tif (hasQueue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.#privateProperties.switchActiveVideoDeviceInProgress)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait this.#privateProperties.switchActiveVideoDeviceInProgress;\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.onPublishFailed(MediaStreamsKinds.Camera);\n\t\t\t}\n\t\t}\n\t\tthis.setLog('Start enabling video', LOG_LEVEL.INFO);\n\t\tlet hasTrack = !!this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t\tlet track = await this.getLocalVideo();\n\n\t\tif (track && hasTrack && this.#privateProperties.localTracks[MediaStreamsKinds.Camera])\n\t\t{\n\n\t\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\t\t\t\tthis.triggerEvents('MediaMutedBySystem', [false]);\n\t\t\t}\n\t\t\tif (skipUnpause)\n\t\t\t{\n\t\t\t\tthis.setLog('Re-enabling video after automatic camera change', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog('Enabling video via unpause signal', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted = false;\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Camera, track);\n\t\t\tif (skipUnpause)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.unpauseTrack(MediaStreamsKinds.Camera);\n\t\t\t}\n\t\t}\n\t\telse if (track)\n\t\t{\n\t\t\tthis.setLog('Enabling video via publish', LOG_LEVEL.INFO);\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Camera, track);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Enabling video failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Camera);\n\t\t\tthis.triggerEvents('PublishFailed', [MediaStreamsKinds.Camera]);\n\t\t}\n\t}\n\n\t#processVideoQueue()\n\t{\n\t\tconst videoQueue = this.#privateProperties.videoQueue;\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\tif (videoQueue === VIDEO_QUEUE.ENABLE && this.#privateProperties.cameraStream?.getVideoTracks()[0].readyState !== 'live')\n\t\t{\n\t\t\tthis.enableVideo();\n\t\t}\n\t\telse if (videoQueue === VIDEO_QUEUE.DISABLE && this.#privateProperties.cameraStream?.getVideoTracks()[0].readyState === 'live' && !this.#privateProperties.mediaMutedBySystem)\n\t\t{\n\t\t\tthis.disableVideo();\n\t\t}\n\t}\n\n\tasync startScreenShare() {\n\t\tthis.setLog('Start enabling screen sharing', LOG_LEVEL.INFO);\n\t\tconst tracks = await this.getLocalScreen()\n\t\tconst videoTrack = tracks?.video;\n\t\tconst audioTrack = tracks?.audio;\n\n\t\tif (!videoTrack)\n\t\t{\n\t\t\tthis.setLog('Enabling screen sharing failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Screen);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.Screen);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.ScreenAudio);\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.publishTrack(MediaStreamsKinds.Screen, videoTrack);\n\n\t\tif (audioTrack)\n\t\t{\n\t\t\tawait this.publishTrack(MediaStreamsKinds.ScreenAudio, audioTrack);\n\t\t}\n\t}\n\n\tasync stopScreenShare() {\n\t\tthis.setLog('Start disabling screen sharing', LOG_LEVEL.INFO);\n\t\tthis.#releaseStream(MediaStreamsKinds.Screen);\n\t\tthis.removeTrack(MediaStreamsKinds.Screen);\n\t\tthis.removeTrack(MediaStreamsKinds.ScreenAudio);\n\t\tawait this.unpublishTrack(MediaStreamsKinds.Screen);\n\t\tawait this.unpublishTrack(MediaStreamsKinds.ScreenAudio);\n\t}\n\n\tsendMessage(message) {\n\t\tthis.#sendSignal({ sendMessage: { message } });\n\t}\n\n\traiseHand(raised) {\n\t\tthis.#sendSignal({ raiseHand: { raised } });\n\t}\n\n\tasync getLocalVideo() {\n\t\tif (this.#privateProperties.cameraStream?.getVideoTracks()[0].readyState !== 'live')\n\t\t{\n\t\t\tawait this.getTrack(MediaStreamsKinds.Camera);\n\t\t}\n\n\t\treturn this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t}\n\tasync getLocalAudio() {\n\t\tif (!this.#privateProperties.microphoneStream)\n\t\t{\n\t\t\tawait this.getTrack(MediaStreamsKinds.Microphone);\n\t\t}\n\n\t\treturn this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t}\n\tasync getLocalScreen() {\n\t\tif (!this.#privateProperties.screenStream)\n\t\t{\n\t\t\tawait this.getTrack(MediaStreamsKinds.Screen);\n\t\t}\n\n\t\treturn {\n\t\t\tvideo: this.#privateProperties.screenStream?.getVideoTracks()[0],\n\t\t\taudio: this.#privateProperties.screenStream?.getAudioTracks()[0]\n\t\t};\n\t}\n\n\tasync #getUserMedia(options, fallbackMode = false) {\n\t\tthis.triggerEvents('GetUserMediaStarted', [options]);\n\n\t\tthis.setLog(`Start getting user media with options: ${JSON.stringify(options)}`, LOG_LEVEL.INFO);\n\t\tconst constraints = {\n\t\t\taudio: false,\n\t\t\tvideo: false,\n\t\t}\n\n\t\tlet stream = null\n\n\t\ttry {\n\t\t\tif (options.video) {\n\t\t\t\tconstraints.video = {};\n\n\t\t\t\tif (!fallbackMode)\n\t\t\t\t{\n\t\t\t\t\tconstraints.video.width = { ideal: this.#privateProperties.defaultVideoResolution.width };\n\t\t\t\t\tconstraints.video.height = { ideal: this.#privateProperties.defaultVideoResolution.height };\n\t\t\t\t}\n\n\t\t\t\tif (this.#privateProperties.videoDeviceId) {\n\t\t\t\t\tconstraints.video.deviceId = {exact: this.#privateProperties.videoDeviceId}\n\t\t\t\t}\n\t\t\t} else if (options.audio) {\n\t\t\t\tif (this.#privateProperties.audioDeviceId) {\n\t\t\t\t\tconstraints.audio = {\n\t\t\t\t\t\tdeviceId: {exact: this.#privateProperties.audioDeviceId}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconstraints.audio = true\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstream = await navigator.mediaDevices.getUserMedia(constraints);\n\n\t\t\tif (options.video && stream.getVideoTracks()[0])\n\t\t\t{\n\t\t\t\tthis.triggerEvents('GetUserMediaSuccess', [{video: true}]);\n\t\t\t}\n\n\t\t\tif (options.audio && stream.getAudioTracks()[0])\n\t\t\t{\n\t\t\t\tthis.triggerEvents('GetUserMediaSuccess', [{audio: true}]);\n\t\t\t}\n\n\t\t\tif (options.video)\n\t\t\t{\n\t\t\t\tthis.#addTrackMuteHandlers(stream.getVideoTracks()[0]);\n\t\t\t}\n\t\t\tthis.setLog(`Getting user media with constraints: ${JSON.stringify(constraints)} succeeded`, LOG_LEVEL.INFO);\n\t\t} catch (e) {\n\t\t\tif (options.video)\n\t\t\t{\n\t\t\t\tthis.setLog(`Getting user media with constraints: ${JSON.stringify(constraints)} failed (fallbackMode: ${fallbackMode}): ${e}`, LOG_LEVEL.ERROR);\n\n\t\t\t\tif (!fallbackMode)\n\t\t\t\t{\n\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.LOCAL_VIDEO_STREAM_RECEIVING_FAILED,\n\t\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tstream = await this.#getUserMedia(options, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (options.audio)\n\t\t\t{\n\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.LOCAL_MICROPHONE_STREAM_RECEIVING_FAILED,\n\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.setLog(`Getting user media with constraints: ${JSON.stringify(constraints)} failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({ name: MONITORING_EVENTS_NAME_LIST.GET_LOCAL_TRACK_ERROR,\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\ttype: 'main'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} finally {\n\t\t\tthis.triggerEvents('GetUserMediaEnded');\n\t\t\treturn stream\n\t\t}\n\t}\n\n\tasync #getDisplayMedia() {\n\t\tthis.setLog('Start getting display media', LOG_LEVEL.INFO);\n\t\tlet stream = null;\n\n\t\ttry {\n\t\t\tif (window[\"BXDesktopSystem\"] && window[\"BXDesktopSystem\"].GetProperty('versionParts')[3] < 78) {\n\t\t\t\tstream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\tchromeMediaSource: 'screen',\n\t\t\t\t\t\t\tmaxWidth: 1920,\n\t\t\t\t\t\t\tmaxHeight: 1080,\n\t\t\t\t\t\t\tmaxFrameRate: 5\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always',\n\t\t\t\t\t\twidth: {\n\t\t\t\t\t\t\tideal: 1920\n\t\t\t\t\t\t},\n\t\t\t\t\t\theight: {\n\t\t\t\t\t\t\tideal: 1080\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsystemAudio: \"include\",\n\t\t\t\t\taudio: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.setLog('Getting display media succeeded', LOG_LEVEL.INFO);\n\t\t} catch (e) {\n\t\t\tthis.setLog(`Getting display media failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() => {\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.LOCAL_SCREEN_STREAM_RECEIVING_FAILED,\n\t\t\t\t\twithCounter: true,\n\t\t\t\t});\n\t\t\t});\n\t\t} finally {\n\t\t\treturn stream;\n\t\t}\n\t}\n\n\tasync getTrack(MediaStreamKind) {\n\t\tif (MediaStreamKind === MediaStreamsKinds.Camera && this.#privateProperties.cameraStream?.getVideoTracks().readyState !== 'live')\n\t\t{\n\t\t\tthis.#privateProperties.cameraStream = await this.#getUserMedia({video: true});\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Microphone && !this.#privateProperties.microphoneStream)\n\t\t{\n\t\t\tthis.#privateProperties.microphoneStream = await this.#getUserMedia({audio: true});\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Screen && !this.#privateProperties.screenStream)\n\t\t{\n\t\t\tthis.#privateProperties.screenStream = await this.#getDisplayMedia();\n\t\t}\n\n\t\tif (this.#privateProperties.abortController.signal.aborted)\n\t\t{\n\t\t\tthis.#releaseStream(MediaStreamKind);\n\t\t\treturn;\n\t\t}\n\n\t\tlet track;\n\n\t\tif (MediaStreamKind === MediaStreamsKinds.Screen)\n\t\t{\n\t\t\ttrack = this.#privateProperties.screenStream?.getVideoTracks()[0];\n\t\t\tif (track && track.readyState !== 'live')\n\t\t\t{\n\t\t\t\tthis.#privateProperties.screenStream = null;\n\t\t\t\ttrack = this.getLocalScreen();\n\t\t\t}\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\ttrack = this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t\t\tif (track && track.readyState !== 'live')\n\t\t\t{\n\t\t\t\tthis.#privateProperties.cameraStream = null;\n\t\t\t\ttrack = this.getLocalVideo();\n\t\t\t}\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\ttrack = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\t\tif (track && track.readyState !== 'live')\n\t\t\t{\n\t\t\t\tthis.#privateProperties.microphoneStream = null;\n\t\t\t\ttrack = this.getLocalAudio();\n\t\t\t}\n\t\t}\n\n\t\tif (track && !track.onended)\n\t\t{\n\t\t\tconst interrupted = MediaStreamKind === MediaStreamsKinds.Microphone\n\t\t\t\t|| MediaStreamKind === MediaStreamsKinds.Camera;\n\n\t\t\ttrack.onended = () => {\n\t\t\t\tif (this.#privateProperties.localTracks[MediaStreamKind])\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.localTracks[MediaStreamKind].muted = true;\n\t\t\t\t}\n\t\t\t\tthis.triggerEvents('PublishEnded', [MediaStreamKind, interrupted]);\n\t\t\t};\n\t\t}\n\n\t\treturn track;\n\t}\n\n\tasync switchActiveAudioDevice(deviceId, force) {\n\t\tif (this.#privateProperties.switchActiveAudioDeviceInProgress && !force)\n\t\t{\n\t\t\tthis.setLog(`Got another request to switch an audio device to ${deviceId}, saving it`, LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.switchActiveAudioDevicePending = deviceId;\n\t\t\treturn;\n\t\t}\n\n\t\tlet error;\n\t\tlet fulfilled = false;\n\t\tthis.setLog(`Start switching an audio device to ${deviceId}`, LOG_LEVEL.INFO);\n\t\tconst promise = new Promise(async (resolve, reject) =>\n\t\t{\n\t\t\tthis.#privateProperties.audioDeviceId = deviceId;\n\t\t\tconst prevStream = this.#privateProperties.microphoneStream;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst prevTrack = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\t\t\tthis.#privateProperties.microphoneStream = null;\n\t\t\t\tlet prevTrackEnabledState = true;\n\t\t\t\tlet prevTrackId = '';\n\t\t\t\tif (prevTrack)\n\t\t\t\t{\n\t\t\t\t\tprevTrackEnabledState = prevTrack.enabled;\n\t\t\t\t\tprevTrackId = prevTrack.id;\n\t\t\t\t\tprevTrack.stop();\n\t\t\t\t}\n\t\t\t\tconst audioTrack = await this.getLocalAudio();\n\t\t\t\taudioTrack.source = MediaStreamsKinds.Microphone;\n\t\t\t\taudioTrack.enabled = prevTrackEnabledState;\n\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Microphone);\n\t\t\t\tif (\n\t\t\t\t\tsender\n\t\t\t\t\t&& (this.isAudioPublished() || sender.track.id !== audioTrack.id || audioTrack.id !== prevTrackId)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog('Have sender for audio, start replacing track', LOG_LEVEL.INFO);\n\t\t\t\t\tawait sender.replaceTrack(audioTrack);\n\t\t\t\t}\n\t\t\t\tthis.setLog('Switching an audio device succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\terror = e;\n\t\t\t\tthis.setLog(`Switching an audio device failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t\tif (!this.#privateProperties.microphoneStream)\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.microphoneStream = prevStream;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tif (this.#privateProperties.switchActiveAudioDevicePending)\n\t\t\t\t{\n\t\t\t\t\tconst deviceId = this.#privateProperties.switchActiveAudioDevicePending;\n\t\t\t\t\tthis.#privateProperties.switchActiveAudioDevicePending = null;\n\t\t\t\t\tresolve(this.switchActiveAudioDevice(deviceId , true));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfulfilled = true;\n\t\t\t\t\tthis.#privateProperties.switchActiveAudioDeviceInProgress = null;\n\t\t\t\t\treturn error ? reject(error) : resolve();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!force && !fulfilled)\n\t\t{\n\t\t\tthis.#privateProperties.switchActiveAudioDeviceInProgress = promise;\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tasync switchActiveVideoDevice(deviceId, force) {\n\t\tif (this.#privateProperties.switchActiveVideoDeviceInProgress && !force)\n\t\t{\n\t\t\tthis.setLog(`Got another request to switch a video device to ${deviceId}, saving it`, LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.switchActiveVideoDevicePending = deviceId;\n\t\t\treturn;\n\t\t}\n\n\t\tlet error;\n\t\tlet fulfilled = false;\n\t\tthis.setLog(`Start switching a video device to ${deviceId}`, LOG_LEVEL.INFO);\n\t\tconst promise = new Promise(async (resolve, reject) =>\n\t\t{\n\t\t\tthis.#privateProperties.videoDeviceId = deviceId;\n\t\t\tconst prevStream = this.#privateProperties.cameraStream;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Camera);\n\t\t\t\tif (sender && this.isVideoPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.setLog('Have sender for video, start replacing track', LOG_LEVEL.INFO);\n\t\t\t\t\tthis.#privateProperties.cameraStream?.getVideoTracks()[0].stop();\n\t\t\t\t\tthis.#privateProperties.cameraStream = null;\n\n\t\t\t\t\tconst videoTrack = await this.getLocalVideo();\n\t\t\t\t\tvideoTrack.source = MediaStreamsKinds.Camera;\n\t\t\t\t\tawait sender.replaceTrack(videoTrack);\n\t\t\t\t\tthis.#updateVideoEncodings(sender, videoTrack);\n\t\t\t\t}\n\t\t\t\tthis.setLog('Switching a video device succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\terror = e;\n\t\t\t\tthis.setLog(`Switching a video device failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t\tif (!this.#privateProperties.cameraStream)\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.cameraStream = prevStream;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tif (this.#privateProperties.switchActiveVideoDevicePending)\n\t\t\t\t{\n\t\t\t\t\tconst deviceId = this.#privateProperties.switchActiveVideoDevicePending;\n\t\t\t\t\tthis.#privateProperties.switchActiveVideoDevicePending = null;\n\t\t\t\t\tresolve(this.switchActiveVideoDevice(deviceId , true));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfulfilled = true;\n\t\t\t\t\tthis.#privateProperties.switchActiveVideoDeviceInProgress = null;\n\t\t\t\t\treturn error ? reject(error) : resolve();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!force && !fulfilled)\n\t\t{\n\t\t\tthis.#privateProperties.switchActiveVideoDeviceInProgress = promise;\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tisAudioPublished()\n\t{\n\t\treturn this.#privateProperties.localTracks[MediaStreamsKinds.Microphone] && this.#privateProperties.localTracks[MediaStreamsKinds.Microphone]?.muted !== true;\n\t}\n\n\tisVideoPublished()\n\t{\n\t\treturn this.#privateProperties.localTracks[MediaStreamsKinds.Camera] && this.#privateProperties.localTracks[MediaStreamsKinds.Camera]?.muted !== true ;\n\t}\n\n\t#addTrackMuteHandlers(track)\n\t{\n\t\ttrack.onmute = (event) =>\n\t\t{\n\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\t\t\tthis.disableVideo(true);\n\t\t\tthis.disableAudio(true);\n\t\t\tthis.#privateProperties.mediaMutedBySystem = true;\n\t\t\tthis.triggerEvents('MediaMutedBySystem', [true]);\n\t\t};\n\n\t\ttrack.onunmute = (event) =>\n\t\t{\n\t\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\t\t\t\tthis.triggerEvents('MediaMutedBySystem', [false]);\n\t\t\t}\n\t\t\tthis.enableVideo();\n\t\t\tif (this.#privateProperties.needToEnableAudioAfterSystemMuted)\n\t\t\t{\n\t\t\t\tthis.enableAudio();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetParticipants() {\n\t\treturn this.#privateProperties.remoteParticipants\n\t}\n\n\tgetState() {\n\t\treturn this.#privateProperties.callState\n\t}\n\n\tsetLog(log, level) {\n\t\tlevel = LOG_LEVEL[level] || LOG_LEVEL.info;\n\n\t\tif (this.#privateProperties.isloggingEnable)\n\t\t{\n\t\t\tconst desktopVersion = window['BXDesktopSystem']?.ApiVersion?.();\n\t\t\tconst version = this.#privateProperties.clientVersion + (desktopVersion ? ` (desktopApi: ${desktopVersion})` : '');\n\t\t\tconst data = {\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000),\n\t\t\t\tevent: log,\n\t\t\t\tclient: this.#privateProperties.clientPlatform,\n\t\t\t\tappVersion: version,\n\t\t\t};\n\t\t\tconst logLength = Object.values(this.#privateProperties.logs).length;\n\t\t\tthis.#privateProperties.logs[logLength] = {\n\t\t\t\tlevel,\n\t\t\t\tdata,\n\t\t\t};\n\t\t\tlet lastSentLog = 0;\n\n\t\t\tfor (let index in this.#privateProperties.logs)\n\t\t\t{\n\t\t\t\tif (!this.#sendLog(this.#privateProperties.logs[index].data, this.#privateProperties.logs[index].level))\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tlastSentLog = index;\n\t\t\t}\n\n\t\t\tif (lastSentLog)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.logs = Object.values(this.#privateProperties.logs).slice(lastSentLog + 1);\n\t\t\t}\n\n\t\t\tif (this.#privateProperties.loggerCallback) {\n\t\t\t\tthis.#privateProperties.loggerCallback();\n\t\t\t}\n\t\t}\n\t}\n\n\t#sendLog(log, level) {\n\t\tconst signal = {\n\t\t\tsendLog: {\n\t\t\t\tuserName: `${this.#privateProperties.userId}`,\n\t\t\t\tdata: JSON.stringify(log),\n\t\t\t\tmsgLevel: level,\n\t\t\t}\n\t\t};\n\n\t\treturn this.isConnected() ? this.#sendSignal(signal) : false;\n\t}\n\n\tsetLoggerCallback(callback) {\n\t\tthis.#privateProperties.loggerCallback = callback;\n\t}\n\n\tenableSilentLogging(enable) {\n\t\tthis.#privateProperties.isloggingEnable = enable;\n\t}\n\n\t#removeUdpFromSdp(sdp)\n\t{\n\t\tconst updatedSdp = [];\n\t\tsdp.split(/(\\r\\n|\\r|\\n)/).filter(RegExp.prototype.test.bind(/^([a-z])=(.*)/)).forEach((el) =>\n\t\t{\n\t\t\tif (!el.startsWith('a=candidate') || el.includes('tcp'))\n\t\t\t{\n\t\t\t\tupdatedSdp.push(el);\n\t\t\t}\n\t\t});\n\n\t\tsdp = updatedSdp.join('\\r\\n') + '\\r\\n';\n\n\t\treturn sdp;\n\t}\n\n\tasync #answerHandler(data) {\n\t\tthis.setLog('Start handling a remote answer', LOG_LEVEL.INFO);\n\t\tlet hasError = false;\n\t\ttry\n\t\t{\n\t\t\tif (Util.useTcpSdp())\n\t\t\t{\n\t\t\t\tdata.answer.sdp = this.#removeUdpFromSdp(data.answer.sdp);\n\t\t\t}\n\t\t\tawait this.sender.setRemoteDescription(data.answer);\n\t\t\tthis.#privateProperties.pendingCandidates.sender.forEach((candidate) =>\n\t\t\t{\n\t\t\t\tthis.sender.addIceCandidate(candidate);\n\t\t\t\tthis.setLog('Added a deferred ICE candidate', LOG_LEVEL.INFO);\n\t\t\t});\n\t\t\tthis.#privateProperties.pendingCandidates.sender = [];\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.setLog(`Handling a remote answer failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\thasError = true;\n\t\t\tthis.#beforeDisconnect();\n\t\t\tthis.#reconnect();\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_ISSUES,\n\t\t\t\t\tvalue: 1,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tif (!hasError)\n\t\t\t{\n\t\t\t\tthis.setLog('Handling a remote answer succeeded', LOG_LEVEL.INFO);\n\t\t\t\tthis.#privateProperties.isWaitAnswer = false;\n\t\t\t\tawait this.sendOffer();\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #offerHandler(data) {\n\t\tthis.setLog('Handling a remote offer', LOG_LEVEL.INFO);\n\t\ttry\n\t\t{\n\t\t\tif (Util.useTcpSdp())\n\t\t\t{\n\t\t\t\tdata.offer.sdp = this.#removeUdpFromSdp(data.offer.sdp);\n\t\t\t}\n\t\t\tawait this.recipient.setRemoteDescription(data.offer);\n\t\t\tthis.#privateProperties.pendingCandidates.recipient.forEach((candidate) =>\n\t\t\t{\n\t\t\t\tthis.recipient.addIceCandidate(candidate);\n\t\t\t\tthis.setLog('Added a deferred ICE candidate', LOG_LEVEL.INFO);\n\t\t\t});\n\t\t\tthis.#privateProperties.pendingCandidates.recipient = [];\n\t\t\tlet answer = await this.recipient.createAnswer();\n\t\t\tif (Util.useTcpSdp())\n\t\t\t{\n\t\t\t\tanswer = {\n\t\t\t\t\ttype: answer.type,\n\t\t\t\t\tsdp: this.#removeUdpFromSdp(answer.sdp),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tawait this.recipient.setLocalDescription(answer);\n\t\t\tthis.#sendSignal({ answer });\n\t\t\tthis.setLog('Handling a remote offer succeeded', LOG_LEVEL.INFO);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.setLog(`Handling a remote offer failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.#beforeDisconnect();\n\t\t\tthis.#reconnect();\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_ISSUES,\n\t\t\t\t\tvalue: 2,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#addIceCandidate(trickle) {\n\t\tthis.setLog('Start adding an ICE candidate', LOG_LEVEL.INFO);\n\t\ttry\n\t\t{\n\t\t\tconst candidate = JSON.parse(trickle.candidateInit);\n\n\t\t\tif (Util.useTcpSdp() && !candidate.candidate.includes('tcp'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (trickle.target)\n\t\t\t{\n\t\t\t\tif (this.recipient.remoteDescription)\n\t\t\t\t{\n\t\t\t\t\tthis.recipient.addIceCandidate(candidate);\n\t\t\t\t\tthis.setLog('Adding an ICE candidate succeeded', LOG_LEVEL.INFO);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#privateProperties.pendingCandidates.recipient.push(candidate);\n\t\t\t\tthis.setLog('Adding an ICE candidate deferred: has no remote description', LOG_LEVEL.INFO);\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.sender.remoteDescription)\n\t\t\t\t{\n\t\t\t\t\tthis.sender.addIceCandidate(candidate);\n\t\t\t\t\tthis.setLog('Adding an ICE candidate succeeded', LOG_LEVEL.INFO);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#privateProperties.pendingCandidates.sender.push(candidate);\n\t\t\t\tthis.setLog('Adding an ICE candidate deferred: has no remote description', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.setLog(`Adding an ICE candidate failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_ISSUES,\n\t\t\t\t\tvalue: 3,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#setRemoteParticipant(participant) {\n\t\tconst userId = participant.userId\n\t\tconst participantEvent = this.#privateProperties.remoteParticipants[userId]\n\t\t\t? 'ParticipantStateUpdated'\n\t\t\t: 'ParticipantJoined'\n\t\tconst remoteParticipant = new Participant(participant, this.#privateProperties.socketConnect)\n\t\tthis.#privateProperties.remoteParticipants[userId] = remoteParticipant;\n\t\tthis.triggerEvents(participantEvent, [remoteParticipant]);\n\t\tif (participant.participantTracks)\n\t\t{\n\t\t\tObject.values(participant.participantTracks).forEach( track => {\n\t\t\t\ttrack.userId = userId\n\t\t\t\tthis.#privateProperties.tracksDataFromSocket[track.sid] = track\n\t\t\t\tif (track.muted && track.source === MediaStreamsKinds.Microphone)\n\t\t\t\t{\n\t\t\t\t\tremoteParticipant.isMutedAudio = true;\n\t\t\t\t}\n\t\t\t\tif (track.muted && track.source === MediaStreamsKinds.Camera)\n\t\t\t\t{\n\t\t\t\t\tremoteParticipant.isMutedVideo = true;\n\t\t\t\t}\n\t\t\t\tswitch (track.source)\n\t\t\t\t{\n\t\t\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\t\t\tremoteParticipant.videoEnabled = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\t\t\tremoteParticipant.audioEnabled = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\t\t\tremoteParticipant.screenSharingEnabled = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthis.setLog(`A participant with id ${userId} (sid: ${participant.sid}) has a track info with kind ${track.source} (sid: ${track.sid}, waiting for it`, LOG_LEVEL.INFO);\n\n\t\t\t\tconst ontrackData = this.#privateProperties.ontrackData[track.sid];\n\t\t\t\tdelete this.#privateProperties.ontrackData[track.sid];\n\n\t\t\t\tif (ontrackData)\n\t\t\t\t{\n\t\t\t\t\tthis.#createRemoteTrack(track.sid, ontrackData);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#addPendingSubscription(participant, track);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tif (this.#privateProperties.videoStreamSetupErrorList[userId]) {\n\t\t\tconst kindArray = [...this.#privateProperties.videoStreamSetupErrorList[userId]];\n\t\t\tdelete this.#privateProperties.videoStreamSetupErrorList[userId];\n\n\t\t\tkindArray.forEach((kind) =>\n\t\t\t{\n\t\t\t\tthis.setMainStream(userId, kind);\n\t\t\t});\n\t\t}\n\t};\n\n\t#createRemoteTrack(trackId, ontrackData)\n\t{\n\t\tconst trackData = this.#privateProperties.tracksDataFromSocket[trackId];\n\t\tconst userId = trackData.userId;\n\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\tconst track = ontrackData.track;\n\t\tconst trackMuted = !!trackData.muted;\n\n\t\tthis.#privateProperties.realTracksIds[track.id] = trackId;\n\t\ttrack.source = trackData.source;\n\t\ttrack.layers = trackData.layers || null;\n\n\t\tif (!this.#privateProperties.remoteTracks?.[userId])\n\t\t{\n\t\t\tthis.#privateProperties.remoteTracks[userId] = {}\n\t\t}\n\t\tconst remoteTrack = new Track(trackId, track);\n\t\tthis.#privateProperties.remoteTracks[userId][trackId] = remoteTrack;\n\n\t\tif (remoteTrack.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tparticipant.isMutedVideo = trackMuted;\n\t\t}\n\t\telse if (remoteTrack.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tparticipant.isMutedAudio = trackMuted;\n\t\t\tif (trackMuted)\n\t\t\t{\n\t\t\t\tthis.setLog(`Trigger mute signal (${trackMuted}) for received audio from a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents('RemoteMediaMuted', [participant, remoteTrack]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.#privateProperties.pendingSubscriptions[userId]?.[trackId]?.timeout)\n\t\t{\n\t\t\tclearTimeout(this.#privateProperties.pendingSubscriptions[userId][trackId].timeout);\n\t\t\tdelete this.#privateProperties.pendingSubscriptions[userId][trackId];\n\t\t}\n\n\t\tthis.setLog(`Got an expected track with kind ${remoteTrack.source} (sid: ${trackId}) for a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\tparticipant.addTrack(remoteTrack.source, remoteTrack);\n\t\tif (remoteTrack.source !== MediaStreamsKinds.Camera || !participant.isMutedVideo)\n\t\t{\n\t\t\tthis.triggerEvents('RemoteMediaAdded', [participant, remoteTrack]);\n\t\t}\n\n\t\tif (remoteTrack.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tconst quality = this.#calculateVideoQualityForUser(userId, remoteTrack.source);\n\t\t\tthis.setLog(`Quality of video for a participant with id ${participant.userId} (sid: ${participant.sid}) was changed to ${quality} after receiving`, LOG_LEVEL.INFO);\n\t\t\tparticipant.setStreamQuality(quality);\n\t\t}\n\n\t\tif (track.kind === 'video')\n\t\t{\n\t\t\tconst streamRemovingId = Util.getUuidv4();\n\t\t\tparticipant.streamRemovingId = streamRemovingId;\n\t\t\tontrackData.streams[0].onremovetrack = () =>\n\t\t\t{\n\t\t\t\t// we need to check if a participant is still exists\n\t\t\t\t// otherwise tracks were deleted when participant left room\n\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\t\t\tif (participant?.streamRemovingId === streamRemovingId)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Track with kind ${track.source} (sid: ${track.id}) for a participant with id ${userId} (sid: ${participant.sid || 'unknown'}) was removed from peer connection`, LOG_LEVEL.WARNING);\n\t\t\t\t\tthis.triggerEvents('RemoteMediaRemoved', [participant, remoteTrack]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Track with kind ${track.source} (sid: ${track.id}) was removed from a disconnected participant with id ${userId} (sid: unknown) before it was removed from peer connection`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\t#speakerChangedHandler(data) {\n\t\tdata.speakersChanged.speakers.forEach((speaker) => {\n\t\t\tconst participant = Object.values(this.#privateProperties.remoteParticipants).find(p => p.sid === speaker.sid)\n\t\t\tif (participant && participant?.userId != this.#privateProperties.userId) {\n\t\t\t\tparticipant.isSpeaking = speaker?.active || false\n\t\t\t\tif (speaker?.active) {\n\t\t\t\t\tthis.triggerEvents('VoiceStarted', [participant]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.triggerEvents('VoiceEnded', [participant]);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t#createPeerConnection() {\n\t\tthis.#destroyPeerConnection()\n\n\t\tconst config = {};\n\t\tif (this.#privateProperties.iceServers)\n\t\t{\n\t\t\tconfig.iceServers = this.#privateProperties.iceServers;\n\t\t}\n\n\t\tthis.sender = new RTCPeerConnection(config);\n\t\tthis.sender.addEventListener('icecandidate', e => this.onIceCandidate(null, e));\n\t\tthis.sender.addEventListener('connectionstatechange', e => this.onConnectionStateChange());\n\n\t\tthis.recipient = new RTCPeerConnection(config);\n\t\tthis.recipient.ontrack = (event) => {\n\t\t\tconst ids = event.streams[0].id.split('|');\n\t\t\tconst trackId = ids[1];\n\t\t\tconst userId = this.#privateProperties.tracksDataFromSocket[trackId]?.userId;\n\n\t\t\tif (this.#privateProperties.remoteParticipants[userId] && this.#privateProperties.tracksDataFromSocket[trackId])\n\t\t\t{\n\t\t\t\tthis.#createRemoteTrack(trackId, event);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Got a track with kind ${event.track.kind} (sid: ${trackId}) without a participant, saving it`, LOG_LEVEL.WARNING);\n\t\t\t\tthis.#privateProperties.ontrackData[trackId] = event;\n\t\t\t}\n\t\t};\n\t\tthis.recipient.addEventListener('icecandidate', e => this.onIceCandidate('SUBSCRIBER', e));\n\t\tthis.recipient.addEventListener('connectionstatechange', e => this.onConnectionStateChange(true));\n\n\t\tconst getStatsHandle = async () => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst statsAll = {};\n\t\t\t\tlet packetLostEventAdded = false;\n\t\t\t\tawait this.sender.getStats(null).then((stats) =>\n\t\t\t\t{\n\t\t\t\t\tlet statsOutput = [];\n\t\t\t\t\tconst codecs = {};\n\t\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\t\tconst remoteReports = {};\n\t\t\t\t\tconst reportsWithoutRemoteInfo = {};\n\t\t\t\t\tlet isQualityLimitationSent = false;\n\t\t\t\t\tlet totalBitrateOut = 0;\n\n\t\t\t\t\tstats.forEach((report) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tstatsOutput.push(report);\n\n\n\t\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (report.type === 'remote-inbound-rtp')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst reportId = report.localId;\n\t\t\t\t\t\t\tif (reportsWithoutRemoteInfo[reportId])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst packetsLostData = Util.calcLocalPacketsLost(reportsWithoutRemoteInfo[reportId], this.#privateProperties.reportsForOutgoingTracks[reportId], report);\n\t\t\t\t\t\t\t\tconst { currentPercentPacketLost } = packetsLostData;\n\n\t\t\t\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.currentMonitoringEventsObject.metrics.PACKET_LOST_SEND.push(currentPercentPacketLost);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (!packetLostEventAdded && currentPercentPacketLost > this.#privateProperties.packetLostThreshold)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tpacketLostEventAdded = true;\n\t\t\t\t\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.HIGH_PACKET_LOSS_SEND,\n\t\t\t\t\t\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostData = packetsLostData;\n\t\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLost = packetsLostData.totalPacketsLost;\n\t\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\t\t\tthis.#privateProperties.reportsForOutgoingTracks[reportId] = reportsWithoutRemoteInfo[reportId];\n\t\t\t\t\t\t\t\tdelete reportsWithoutRemoteInfo[reportId];\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tremoteReports[report.localId] = report;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (report.type === 'outbound-rtp')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.#privateProperties.reportsForOutgoingTracks[report.id], true);\n\t\t\t\t\t\t\treport.userId = this.#privateProperties.userId;\n\n\t\t\t\t\t\t\tif (report.kind === 'audio')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Microphone;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (report.kind === 'video' )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treport.source = report.contentType === 'screenshare'\n\t\t\t\t\t\t\t\t\t? MediaStreamsKinds.Screen\n\t\t\t\t\t\t\t\t\t: MediaStreamsKinds.Camera;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttotalBitrateOut += report.bitrate;\n\n\t\t\t\t\t\t\tif (report.qualityLimitationReason && report.qualityLimitationReason !== 'none' && !isQualityLimitationSent)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (report.qualityLimitationReason === 'cpu') {\n\t\t\t\t\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.CPU_ISSUES,\n\t\t\t\t\t\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (report.qualityLimitationReason === 'bandwidth') {\n\t\t\t\t\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.NETWORK_ISSUES,\n\t\t\t\t\t\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tisQualityLimitationSent = true;\n\t\t\t\t\t\t\t\tthis.setLog(`Local user have problems with sending video: ${report.qualityLimitationReason} (${Object.entries(report.qualityLimitationDurations).reduce(\n\t\t\t\t\t\t\t\t\t(accumulator, value, index) => accumulator + `${index ? ', ' : ''}` + `${value[0]}: ${value[1]}`,\n\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t)})`, LOG_LEVEL.WARNING);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (Util.setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#privateProperties.reportsForOutgoingTracks[report.id] = report;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst formattedBitrateOut = Number.parseFloat((totalBitrateOut / 1000000).toFixed(2));\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics.BITRATE_OUT.length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.currentMonitoringEventsObject.metrics.BITRATE_OUT.push(formattedBitrateOut);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tstatsAll.sender = statsOutput;\n\t\t\t\t});\n\n\t\t\t\tawait this.recipient.getStats(null).then((stats) =>\n\t\t\t\t{\n\t\t\t\t\tlet statsOutput = [];\n\t\t\t\t\tconst participantsWithLargeDataLoss = new Map();\n\t\t\t\t\tconst codecs = {};\n\t\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\t\tlet totalBitrateIn = 0;\n\t\t\t\t\tlet currentPacketLostReceiveCount = 0;\n\n\t\t\t\t\tconst inboundRtpStatsArray = {\n\t\t\t\t\t\tfreezeCount: [],\n\t\t\t\t\t\ttotalFreezesDuration: [],\n\t\t\t\t\t\tjitter: [],\n\t\t\t\t\t\tframesDecoded: [],\n\t\t\t\t\t\tframesDropped: [],\n\t\t\t\t\t\tframesReceived: [],\n\t\t\t\t\t\tframesLoss: [],\n\t\t\t\t\t};\n\n\t\t\t\t\tstats.forEach((report) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (report.type === 'inbound-rtp' && report.kind === 'video')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst { freezeCount, totalFreezesDuration, jitter, framesDecoded, framesDropped, framesReceived } = report;\n\n\t\t\t\t\t\t\tinboundRtpStatsArray.jitter.push(jitter);\n\t\t\t\t\t\t\tinboundRtpStatsArray.totalFreezesDuration.push(totalFreezesDuration);\n\t\t\t\t\t\t\tinboundRtpStatsArray.freezeCount.push(freezeCount);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesDecoded.push(framesDecoded);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesDropped.push(framesDropped);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesReceived.push(framesReceived);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesLoss.push((framesDropped / framesReceived) * 100);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstatsOutput.push(report);\n\n\t\t\t\t\t\tconst needCheckPacketLosts = (report?.trackIdentifier\n\t\t\t\t\t\t\t&& report.hasOwnProperty('packetsLost')\n\t\t\t\t\t\t\t&& report.hasOwnProperty('packetsReceived'));\n\n\t\t\t\t\t\tif (needCheckPacketLosts)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst packetsLostData = Util.calcRemotePacketsLost(report, this.#privateProperties.reportsForIncomingTracks[report.trackIdentifier]);\n\n\t\t\t\t\t\t\treport.packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\t\tthis.#privateProperties.reportsForIncomingTracks[report.trackIdentifier] = report;\n\n\t\t\t\t\t\t\tconst realTrackId = this.#privateProperties.realTracksIds[report.trackIdentifier];\n\t\t\t\t\t\t\tconst track = this.#privateProperties.tracksDataFromSocket[realTrackId];\n\t\t\t\t\t\t\tif (track)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst prevReport = track.report || {};\n\t\t\t\t\t\t\t\ttrack.report = report;\n\n\t\t\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, prevReport);\n\t\t\t\t\t\t\t\treport.userId = track.userId;\n\t\t\t\t\t\t\t\treport.source = track.source;\n\n\t\t\t\t\t\t\t\tconst { currentPercentPacketLost } = packetsLostData;\n\n\t\t\t\t\t\t\t\tif (track.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcurrentPacketLostReceiveCount = currentPercentPacketLost;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\ttotalBitrateIn += report.bitrate;\n\n\t\t\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (packetsLostData.currentPercentPacketLost > this.#privateProperties.packetLostThreshold)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst participant = Object.values(this.#privateProperties.remoteParticipants)\n\t\t\t\t\t\t\t\t\t.find(p => p?.tracks?.[MediaStreamsKinds.Camera]?.track?.id === report.trackIdentifier);\n\t\t\t\t\t\t\t\tif (participant && participant.userId != this.#privateProperties.userId)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tparticipantsWithLargeDataLoss.set(participant.userId, `userId: ${ participant.userId} (${packetsLostData.currentPercentPacketLost}%)`);\n\t\t\t\t\t\t\t\t\tthis.#privateProperties.prevParticipantsWithLargeDataLoss.delete(participant.userId);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst { countVideoTracks, countAudioTracks } = this.getCountRemoteTracks();\n\n\t\t\t\t\t\tconst round = (number, decimal) => Math.round(number * Math.pow(10, decimal)) / Math.pow(10, decimal);\n\n\t\t\t\t\t\tconst addValueInboundRTCStatsToMetrics = ({ key, metricsKey, isSum, decimal = 0, interval }) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[metricsKey].length >= this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst inboundRtpStatsArraySumByKey = inboundRtpStatsArray[key].reduce((acc, number) => acc + number, 0) / (interval ? (this.#privateProperties.statsTimeout / 1000) : 1);\n\t\t\t\t\t\t\tconst prevInboundRtpStatsArraySumByKey = this.prevInboundRtpStatsSum[key];\n\t\t\t\t\t\t\tconst diffInboundRtpStatsArraySumByKey = prevInboundRtpStatsArraySumByKey && !!isSum ? inboundRtpStatsArraySumByKey - prevInboundRtpStatsArraySumByKey : inboundRtpStatsArraySumByKey;\n\t\t\t\t\t\t\tconst metricValue = !!countVideoTracks ? diffInboundRtpStatsArraySumByKey / countVideoTracks : 0;\n\n\t\t\t\t\t\t\tthis.currentMonitoringEventsObject.metrics[metricsKey].push(round(metricValue, decimal));\n\t\t\t\t\t\t\tthis.prevInboundRtpStatsSum[key] = inboundRtpStatsArraySumByKey;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key: 'jitter', metricsKey: 'JITTER', isSum: false, decimal: 3 });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key: 'freezeCount', metricsKey: 'FREEZE_COUNT', isSum: true, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key: 'totalFreezesDuration', metricsKey: 'TOTAL_FREEZE_DURATION', isSum: true, decimal: 3, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key:'framesDecoded', metricsKey:'FRAMES_DECODED', isSum:true, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key:'framesDropped', metricsKey: 'FRAMES_DROPPED', isSum: true, interval: true });\n\t\t\t\t\t\t// addValueInboundRTCStatsToMetrics({ key: 'framesLoss', metricsKey: 'FRAMES_LOSS', isSum: true });\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics.FRAMES_LOSS.length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst currentFramesReceived = this.currentMonitoringEventsObject.metrics.FRAMES_RECEIVED.slice(-1)[0];\n\t\t\t\t\t\t\tconst currentFramesDropped = this.currentMonitoringEventsObject.metrics.FRAMES_DROPPED.slice(-1)[0];\n\t\t\t\t\t\t\tconst currentFramesLoss = !!currentFramesReceived ? currentFramesDropped / currentFramesReceived : 0;\n\t\t\t\t\t\t\tthis.currentMonitoringEventsObject.metrics.FRAMES_LOSS.push(currentFramesLoss > 0 ? round(currentFramesLoss * 100, 0)  : 0);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst formattedBitrateIn = Number.parseFloat((totalBitrateIn / 1000000).toFixed(2));\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics.BITRATE_IN.length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.currentMonitoringEventsObject.metrics.BITRATE_IN.push(formattedBitrateIn);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics.PACKET_LOST_RECEIVE.length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.currentMonitoringEventsObject.metrics.PACKET_LOST_RECEIVE.push(currentPacketLostReceiveCount);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (currentPacketLostReceiveCount > this.#privateProperties.packetLostThreshold)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addMonitoringEvents({name: MONITORING_EVENTS_NAME_LIST.HIGH_PACKET_LOSS_RECEIVE, withCounter: true} )\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tstatsAll.recipient = statsOutput;\n\t\t\t\t\tif (participantsWithLargeDataLoss.size || this.#privateProperties.prevParticipantsWithLargeDataLoss.size)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (participantsWithLargeDataLoss.size)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.setLog(`Have high packetsLost on users: ${[...participantsWithLargeDataLoss.values()]}`, LOG_LEVEL.WARNING);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.triggerEvents('UpdatePacketLoss', [[...participantsWithLargeDataLoss.keys()]] );\n\t\t\t\t\t}\n\t\t\t\t\tthis.#privateProperties.prevParticipantsWithLargeDataLoss = participantsWithLargeDataLoss;\n\t\t\t\t});\n\n\t\t\t\tthis.triggerEvents('CallStatsReceived', [statsAll]);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\t// if we're here it's almost okay\n\t\t\t\t// we tried to get stats during reconnection\n\t\t\t}\n\t\t}\n\n\n\t\tgetStatsHandle().finally(() => {\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.startAggregateMonitoringEvents();\n\t\t\t});\n\t\t\tthis.#privateProperties.callStatsInterval = setInterval( async () => {\n\t\t\t\tawait getStatsHandle()\n\t\t\t}, this.#privateProperties.statsTimeout);\n\t\t});\n\t}\n\n\t#destroyPeerConnection() {\n\t\tif (this.sender) {\n\t\t\tthis.sender.close()\n\t\t\tthis.sender = null\n\t\t}\n\n\t\tif (this.recipient) {\n\t\t\tthis.recipient.close()\n\t\t\tthis.recipient = null\n\t\t}\n\n\t\tthis.#privateProperties.peerConnectionFailed = false;\n\t}\n\n\t#releaseStream(kind) {\n\t\tlet streamType\n\n\t\tswitch (kind) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tstreamType = 'cameraStream'\n\t\t\t\tbreak\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tstreamType = 'microphoneStream'\n\t\t\t\tbreak\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tstreamType = 'screenStream'\n\t\t\t\tbreak\n\t\t}\n\n\t\tif (streamType) {\n\t\t\tthis.#privateProperties[streamType]?.getTracks?.()?.forEach( track => {\n\t\t\t\ttrack.onended = null\n\t\t\t\ttrack.stop()\n\t\t\t})\n\t\t\tthis.#privateProperties[streamType] = null\n\t\t}\n\t}\n\n\t#getSender(kind) {\n\t\tconst senders = this.sender?.getSenders?.();\n\t\tlet sender = null;\n\n\t\tif (senders?.length > 0) {\n\t\t\tfor (const s of senders) {\n\t\t\t\tif (s.track?.source === kind) {\n\t\t\t\t\tsender = s\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn sender;\n\t}\n\n\t#sendSignal(signal) {\n\t\tif (this.#privateProperties.socketConnect?.readyState === 1)\n\t\t{\n\t\t\tthis.#privateProperties.socketConnect.send(JSON.stringify(signal));\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#sendLeave() {\n\t\tif (this.#privateProperties.socketConnect?.readyState === 1) {\n\t\t\tthis.#sendSignal({\n\t\t\t\tleave:  {\n\t\t\t\t\treason: 'CLIENT_INITIATED'\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.sendMonitoringEvents(false);\n\t\t\t});\n\t\t}\n\t}\n}\n\nclass Participant {\n\t#socketConnect;\n\n\tname = '';\n\timage = '';\n\tuserId = '';\n\tvideoEnabled = false;\n\taudioEnabled = false;\n\tscreenSharingEnabled = false;\n\tisSpeaking = false;\n\ttracks = {};\n\tsid = '';\n\tisMutedVideo = false;\n\tisMutedAudio = false;\n\tisHandRaised = false;\n\tvideoPaused = false;\n\tisLocalVideoMute = false;\n\tstreamRemovingId = '';\n\tcameraStreamQuality: STREAM_QUALITY.MEDIUM;\n\n\tconstructor(participant, socket) {\n\t\tthis.name = participant?.name || '';\n\t\tthis.image = participant?.image || '';\n\t\tthis.userId = participant?.userId || '';\n\t\tthis.sid = participant?.sid || '';\n\t\tthis.videoEnabled = participant?.videoEnabled || false;\n\t\tthis.audioEnabled = participant?.audioEnabled || false;\n\t\tthis.screenSharingEnabled = participant?.screenSharingEnabled || false;\n\t\tthis.isSpeaking = participant?.isSpeaking || false;\n\t\tthis.isHandRaised = participant?.isHandRaised || false;\n\t\tthis.#socketConnect = socket;\n\t}\n\n\tsubscribeTrack(MediaStreamKind) {};\n\n\tunsubscribeTrack(MediaStreamKind) {};\n\n\tattachTrack(MediaStreamKind) {};\n\n\tdetachTrack(MediaStreamKind) {};\n\n\tdisableAudio() {\n\t\tthis.tracks[MediaStreamsKinds.Microphone].track.enabled = false;\n\t\tthis.isMutedAudio = true;\n\t};\n\n\tenableAudio() {\n\t\tthis.tracks[MediaStreamsKinds.Microphone].track.enabled = true;\n\t\tthis.isMutedAudio = false;\n\t};\n\n\tdisableVideo() {\n\t\tthis.tracks[MediaStreamsKinds.Camera].track.enabled = false;\n\t\tthis.isMutedVideo = true;\n\t};\n\n\tenableVideo() {\n\t\tthis.tracks[MediaStreamsKinds.Camera].track.enabled = true;\n\t\tthis.isMutedVideo = false;\n\t};\n\n\taddTrack(MediaStreamKind, Track) {\n\t\tthis.tracks[MediaStreamKind] = Track;\n\t};\n\n\tremoveTrack(MediaStreamKind, Track) {\n\t\tdelete this.tracks[MediaStreamKind];\n\t};\n\n\tgetTrack(MediaStreamKind) {\n\t\treturn this.tracks?.[MediaStreamKind]\n\t}\n\n\tsetStreamQuality(quality) {\n\t\tif (this.cameraStreamQuality === quality || this.videoPaused)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.tracks?.[MediaStreamsKinds.Camera]) {\n\t\t\tthis.cameraStreamQuality = quality;\n\t\t\tconst trackId = this.tracks[MediaStreamsKinds.Camera].id;\n\t\t\tthis.tracks[MediaStreamsKinds.Camera].track.currentVideoQuality =  quality;\n\t\t\tconst signal = {\n\t\t\t\ttrackSetting: {\n\t\t\t\t\ttrackSids: [trackId],\n\t\t\t\t\tquality: quality,\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.#socketConnect.send(JSON.stringify(signal));\n\t\t}\n\t}\n}\n","import {Dom, Type} from 'main.core';\nimport {Menu} from 'main.popup';\nimport {UserState} from '../engine/engine';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport {logPlaybackError} from './tools';\nimport type {UserModel} from './user-registry'\nimport {MediaStreamsKinds} from '../call_api';\nimport Util from '../util';\nimport { Utils } from 'im.v2.lib.utils';\n\ntype CallUserElements = {\n\troot?: HTMLElement,\n\tcontainer?: HTMLElement,\n\tvideoContainer?: HTMLElement,\n\tvideo?: HTMLVideoElement,\n\taudio?: HTMLAudioElement,\n\tscreenAudio?: HTMLAudioElement,\n\tpreview?: HTMLVideoElement,\n\tvideoBorder?: HTMLElement,\n\tavatarContainer?: HTMLElement,\n\tavatar?: HTMLElement,\n\tnameContainer?: HTMLElement,\n\tname?: HTMLElement,\n\tchangeNameIcon?: HTMLElement,\n\tchangeNameContainer?: HTMLElement,\n\tchangeNameCancel?: HTMLElement,\n\tchangeNameInput?: HTMLInputElement,\n\tchangeNameConfirm?: HTMLElement,\n\tchangeNameLoader?: HTMLElement,\n\tintroduceYourselfContainer?: HTMLElement,\n\tfloorRequest?: HTMLElement,\n\tbadNetworkIndicator?: HTMLElement,\n\tstate?: HTMLElement,\n\tremoveButton?: HTMLElement,\n\tmicState?: HTMLElement,\n\tcameraState?: HTMLElement,\n\tpanel?: HTMLElement,\n\tbuttonMenu?: HTMLElement,\n\tbuttonBackground?: HTMLElement,\n\tbuttonPin?: HTMLElement,\n\tbuttonUnPin?: HTMLElement,\n\tconnectionProblem?: HTMLElement,\n\tstatsOverlay?: HTMLElement,\n\tconnectionQualityIcon?: HTMLElement,\n}\n\ntype CallUserParams = {\n\tparentContainer: HTMLElement,\n\tuserModel: UserModel,\n\tscreenAudioElement: ?HTMLAudioElement,\n\taudioElement: ?HTMLAudioElement,\n\tallowBackgroundItem: ?boolean,\n\tallowMaskItem: ?boolean,\n\tallowPinButton: ?boolean,\n\tscreenSharingUser: ?boolean,\n\taudioTrack: ?MediaStreamTrack,\n\tscreenAudioTrack: ?MediaStreamTrack,\n\tvideoTrack: ?MediaStreamTrack,\n\n\tonClick: () => void,\n\tonPin: () => void,\n\tonUnPin: () => void,\n\tonUserRename: () => void,\n\tonUserRenameInputFocus: () => void,\n\tonUserRenameInputBlur: () => void,\n}\n\nexport class CallUser\n{\n\tuserModel: UserModel\n\telements: CallUserElements = {}\n\tmenu: ?Menu\n\n\tconstructor(config: CallUserParams = {})\n\t{\n\t\tthis.userModel = config.userModel;\n\t\tthis.userModel.subscribe(\"changed\", this._onUserFieldChanged.bind(this));\n\t\tthis.parentContainer = config.parentContainer;\n\t\tthis.screenSharingUser = Type.isBoolean(config.screenSharingUser) ? config.screenSharingUser : false;\n\t\tthis.allowBackgroundItem = Type.isBoolean(config.allowBackgroundItem) ? config.allowBackgroundItem : true;\n\t\tthis.allowMaskItem = Type.isBoolean(config.allowMaskItem) ? config.allowMaskItem : true;\n\t\tthis._allowPinButton = Type.isBoolean(config.allowPinButton) ? config.allowPinButton : true;\n\t\tthis._visible = true;\n\t\tthis._audioTrack = config.audioTrack;\n\t\tthis._screenAudioTrack = config.screenAudioTrack;\n\t\tthis._audioStream = this._audioTrack ? new MediaStream([this._audioTrack]) : null;\n\t\tthis._screenAudioStream = this._screenAudioTrack ? new MediaStream([this._screenAudioTrack]) : null;\n\t\tthis._videoTrack = config.videoTrack;\n\t\tthis._stream = this._videoTrack ? new MediaStream([this._videoTrack]) : null;\n\t\tthis._videoRenderer = null;\n\t\tthis._previewRenderer = null;\n\t\tthis._flipVideo = false;\n\n\t\tthis.hidden = false;\n\t\tthis.videoBlurState = false;\n\t\tthis.isChangingName = false;\n\n\t\tthis._badNetworkIndicator = false;\n\n\t\tthis.incomingVideoConstraints = {\n\t\t\twidth: 0, height: 0\n\t\t}\n\t\tif (config.audioElement)\n\t\t{\n\t\t\tthis.elements.audio = config.audioElement;\n\t\t}\n\n\t\tif (config.screenAudioElement)\n\t\t{\n\t\t\tthis.elements.screenAudio = config.screenAudioElement;\n\t\t}\n\n\t\tthis.callBacks = {\n\t\t\tonClick: Type.isFunction(config.onClick) ? config.onClick : BX.DoNothing,\n\t\t\tonUserRename: Type.isFunction(config.onUserRename) ? config.onUserRename : BX.DoNothing,\n\t\t\tonUserRenameInputFocus: Type.isFunction(config.onUserRenameInputFocus) ? config.onUserRenameInputFocus : BX.DoNothing,\n\t\t\tonUserRenameInputBlur: Type.isFunction(config.onUserRenameInputBlur) ? config.onUserRenameInputBlur : BX.DoNothing,\n\t\t\tonPin: Type.isFunction(config.onPin) ? config.onPin : BX.DoNothing,\n\t\t\tonUnPin: Type.isFunction(config.onUnPin) ? config.onUnPin : BX.DoNothing,\n\t\t};\n\t\tthis.checkAspectInterval = setInterval(this.checkVideoAspect.bind(this), 500);\n\n\t\tthis.hintManager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tclassName: `bx-messenger-videocall-panel-item-hotkey-hint ${this.userModel.id}`,\n\t\t\t\tbindOptions: {forceBindPosition: true}\n\t\t\t}\n\t\t});\n\n\t\tthis.connectionStats = {};\n\t\tthis.connectionStatsVisible = false;\n\n\t\tthis.avatarBackground = Util.getAvatarBackground();\n\n\t\tthis.removeAvatarPulseTimer = null;\n\t\tthis.hideUserNameTimer = null;\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tthis.onMouseMoveHandler = this.showUserName.bind(this);\n\t\tdocument.addEventListener('mousemove', this.onMouseMoveHandler);\n\t}\n\n\tget id()\n\t{\n\t\treturn this.userModel.id\n\t}\n\n\tget allowPinButton()\n\t{\n\t\treturn this._allowPinButton;\n\t}\n\n\tset allowPinButton(allowPinButton)\n\t{\n\t\tif (this._allowPinButton == allowPinButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._allowPinButton = allowPinButton;\n\t\tthis.update()\n\t}\n\n\tget audioTrack()\n\t{\n\t\treturn this._audioTrack;\n\t}\n\n\tset audioTrack(audioTrack: ?MediaStreamTrack)\n\t{\n\t\tif (this._audioTrack === audioTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._audioTrack = audioTrack;\n\t\tthis._audioStream = this._audioTrack ? new MediaStream([this._audioTrack]) : null;\n\t\tthis.playAudio()\n\t}\n\n\tget audioStream()\n\t{\n\t\treturn this._audioStream;\n\t}\n\n\tget screenAudioTrack()\n\t{\n\t\treturn this._screenAudioTrack;\n\t}\n\n\tset screenAudioTrack(screenAudioTrack: ?MediaStreamTrack)\n\t{\n\t\tif (this._screenAudioTrack === screenAudioTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._screenAudioTrack = screenAudioTrack;\n\t\tthis._screenAudioStream = this._screenAudioTrack ? new MediaStream([this._screenAudioTrack]) : null;\n\t\tthis.playScreenAudio()\n\t}\n\n\tget screenAudioStream()\n\t{\n\t\treturn this._screenAudioStream;\n\t}\n\n\tget flipVideo()\n\t{\n\t\treturn this._flipVideo;\n\t}\n\n\tset flipVideo(flipVideo)\n\t{\n\t\tthis._flipVideo = flipVideo;\n\t\tthis.update()\n\t}\n\n\tget stream(): ?MediaStream\n\t{\n\t\treturn this._stream;\n\t}\n\n\tget visible()\n\t{\n\t\treturn this._visible;\n\t}\n\n\tset visible(visible)\n\t{\n\t\tif (this._visible !== visible)\n\t\t{\n\t\t\tthis._visible = visible;\n\t\t\tthis.update();\n\t\t\tthis.updateRendererState();\n\t\t}\n\t}\n\n\tget videoRenderer()\n\t{\n\t\treturn this._videoRenderer;\n\t}\n\n\tset videoRenderer(videoRenderer)\n\t{\n\t\t// we should to reset old video track after switching from a plain call\n\t\t// in order to properly check the camera video in hasCameraVideo\n\t\tif (this._videoTrack)\n\t\t{\n\t\t\tthis._videoTrack = null;\n\t\t}\n\n\t\tif (this._badNetworkIndicator)\n\t\t{\n\t\t\t// Voximplant calls logic with support of streams disabling\n\t\t\tif (videoRenderer.stream)\n\t\t\t{\n\t\t\t\tthis._tempVideoRenderer = videoRenderer;\n\t\t\t\tthis._videoRenderer = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._tempVideoRenderer = this._videoRenderer = null;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Bitrix calls logic with support of preview\n\t\t\tthis._tempVideoRenderer = null;\n\t\t\tconst currentVideoRendererKind = this._videoRenderer?.kind;\n\t\t\tconst newVideoRendererKind = videoRenderer?.kind;\n\n\t\t\tif (videoRenderer.stream)\n\t\t\t{\n\t\t\t\tif (newVideoRendererKind === 'sharing' && currentVideoRendererKind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis._previewRenderer = this._videoRenderer;\n\t\t\t\t\tthis._videoRenderer = videoRenderer;\n\t\t\t\t}\n\t\t\t\telse if (newVideoRendererKind === 'video' && currentVideoRendererKind === 'sharing')\n\t\t\t\t{\n\t\t\t\t\tthis._previewRenderer = videoRenderer;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._videoRenderer = videoRenderer;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (newVideoRendererKind === 'sharing')\n\t\t\t\t{\n\t\t\t\t\tif (currentVideoRendererKind === 'sharing')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._videoRenderer = this._previewRenderer;\n\t\t\t\t\t}\n\t\t\t\t\tthis._previewRenderer = null;\n\t\t\t\t\tdelete this.connectionStats[MediaStreamsKinds.Screen];\n\t\t\t\t}\n\t\t\t\telse if (newVideoRendererKind === 'video')\n\t\t\t\t{\n\t\t\t\t\tif (currentVideoRendererKind === 'sharing')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._previewRenderer = null;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._videoRenderer = null;\n\t\t\t\t\t}\n\t\t\t\t\tdelete this.connectionStats[MediaStreamsKinds.Camera];\n\t\t\t\t}\n\t\t\t\tthis.showConnectionStats();\n\t\t\t}\n\t\t}\n\n\t\tthis.update();\n\t\tthis.updateRendererState();\n\t}\n\n\tget previewRenderer()\n\t{\n\t\treturn this._previewRenderer;\n\t}\n\n\tget videoTrack()\n\t{\n\t\treturn this._videoTrack;\n\t}\n\n\tset videoTrack(videoTrack: MediaStreamTrack)\n\t{\n\t\tif (this._videoTrack === videoTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._videoTrack = videoTrack;\n\t\tif (this._videoTrack && this._stream)\n\t\t{\n\t\t\tthis._stream.removeTrack(this._stream.getVideoTracks()[0]);\n\t\t\tthis._stream.addTrack(this._videoTrack);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._stream = this._videoTrack ? new MediaStream([this._videoTrack]) : null;\n\t\t}\n\n\t\tthis.update();\n\t}\n\n\tset badNetworkIndicator(badNetworkIndicator)\n\t{\n\t\tif (this._badNetworkIndicator === badNetworkIndicator)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._badNetworkIndicator = badNetworkIndicator;\n\t\tif (this._badNetworkIndicator)\n\t\t{\n\t\t\tif (this._videoRenderer)\n\t\t\t{\n\t\t\t\tthis._tempVideoRenderer = this._videoRenderer;\n\t\t\t\tthis._videoRenderer = null;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this._tempVideoRenderer)\n\t\t\t{\n\t\t\t\tthis._videoRenderer = this._tempVideoRenderer;\n\t\t\t\tthis._tempVideoRenderer = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.update();\n\t}\n\n\tset hasConnectionProblem(hasConnectionProblem)\n\t{\n\t\tthis._hasConnectionProblem = hasConnectionProblem;\n\t\tif (this._hasConnectionProblem)\n\t\t{\n\t\t\tthis.elements.connectionProblem.classList.add(\"connection-problem-visible\");\n\t\t}\n\t\telse {\n\t\t\tthis.elements.connectionProblem.classList.remove(\"connection-problem-visible\");\n\t\t}\n\t}\n\n\tset connectionQuality(connectionQuality)\n\t{\n\t\tthis._connectionQuality = connectionQuality;\n\n\t\tconst connectionQualityIcons = {\n\t\t\texcellent: '--excellent-quality-icon',\n\t\t\tgood: '--good-quality-icon',\n\t\t\tpoor: '--poor-quality-icon',\n\t\t\tbad: '--bad-quality-icon',\n\t\t}\n\n\t\tif (this._connectionQuality !== undefined && this.elements.connectionQualityIcon)\n\t\t{\n\t\t\tlet resultIcon = connectionQualityIcons.bad;\n\n\t\t\tif (this._connectionQuality >= 4)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.excellent;\n\t\t\t}\n\n\t\t\tif (this._connectionQuality >= 3 && this._connectionQuality < 4)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.good;\n\t\t\t}\n\n\t\t\tif (this._connectionQuality >= 2 && this._connectionQuality < 3)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.poor;\n\t\t\t}\n\n\t\t\tif (this._connectionQuality < 2)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.bad;\n\t\t\t}\n\n\t\t\tthis.elements.connectionQualityIcon.style.setProperty('--connection-quality-icon', `var(${resultIcon})`);\n\t\t}\n\t}\n\n\tisVisibleMediaStateIcon(isActive)\n\t{\n\t\treturn !isActive && this.userModel.state === UserState.Connected;\n\t};\n\n\tisVisibleCameraStateIcon()\n\t{\n\t\treturn this.isVisibleMediaStateIcon(this.userModel.cameraState);\n\t};\n\n\tisVisibleMicStateIcon()\n\t{\n\t\treturn this.isVisibleMediaStateIcon(this.userModel.microphoneState);\n\t};\n\n\tshowStats(stats)\n\t{\n\t\tthis.connectionStats = stats;\n\t\tif (this.elements.statsOverlay && this.connectionStatsVisible)\n\t\t{\n\t\t\tthis.showConnectionStats();\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user\"},\n\t\t\tdataset: {userId: this.userModel.id, order: this.userModel.order},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.videoBorder = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-border\",\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tthis.elements.container = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-inner\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.avatarContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar-border\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar\"},\n\t\t\t\t\t\t\t\t\ttext: ''\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar-overlay-border\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar-pulse-element\", style: \"animation-delay: -2s;\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar-pulse-element\", style: \"animation-delay: -1.5s;\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar-pulse-element\", style: \"animation-delay: -1s;\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar-pulse-element\", style: \"animation-delay: -0.5s;\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.panel = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-panel\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.state = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-status-text\"},\n\t\t\t\t\t\t\ttext: this.getStateMessage(this.userModel.state)\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.userBottomContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.nameContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-name-container\" + ((this.userModel.allowRename && !this.userModel.wasRenamed) ? \" hidden\" : \"\")},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.name = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-name\", title: (this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace(\"#NAME#\", this.userModel.name) : this.userModel.name)},\n\t\t\t\t\t\t\t\t\t\t\ttext: (this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace(\"#NAME#\", this.userModel.name) : this.userModel.name),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-name-icon bx-messenger-videocall-user-change-name-icon hidden\"},\n\t\t\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.changeNameContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-container hidden\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameCancel = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-cancel\"},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameInput = Dom.create(\"input\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-change-name-input\"\n\t\t\t\t\t\t\t\t\t\t\t}, attrs: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text', value: this.userModel.name\n\t\t\t\t\t\t\t\t\t\t\t}, events: {\n\t\t\t\t\t\t\t\t\t\t\t\tkeydown: this.onNameInputKeyDown.bind(this),\n\t\t\t\t\t\t\t\t\t\t\t\tfocus: this.callBacks.onUserRenameInputFocus,\n\t\t\t\t\t\t\t\t\t\t\t\tblur: this.callBacks.onUserRenameInputBlur,\n\t\t\t\t\t\t\t\t\t\t\t\tclick: function(event) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameConfirm = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-confirm\"},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tclick: this.changeName.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameLoader = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-loader hidden\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-loader-icon\"}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.introduceYourselfContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-introduce-yourself-container\" + (!this.userModel.allowRename || this.userModel.wasRenamed ? \" hidden\" : \"\")},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-introduce-yourself-text\"},\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('IM_CALL_GUEST_INTRODUCE_YOURSELF'),\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.floorRequest = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-floor-request bx-messenger-videocall-floor-request-icon\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.statsOverlay = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-stats-overlay\"},\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t\tstyle: {\n\t\t\t\torder: this.userModel.order\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: function (e)\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onClick({\n\t\t\t\t\t\tuserId: this.id\n\t\t\t\t\t});\n\t\t\t\t}.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.updateAvatarPulseState()\n\t\t}\n\n\t\tthis.elements.debugPanel = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-debug-panel\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-debug-panel-button connection-stats\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.connectionQualityIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-debug-panel-button-icon connection-quality-icon\",\n\t\t\t\t\t\t\t\ttitle: BX.message(\"IM_M_CALL_CONNECTION_QUALITY_HINT\"),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: e => {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tthis.connectionStatsVisible = !this.connectionStatsVisible;\n\t\t\t\t\t\t\tif (this.connectionStatsVisible)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showConnectionStats();\n\t\t\t\t\t\t\t\tthis.elements.statsOverlay.classList.add('stats-overlay-visble');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.elements.statsOverlay.classList.remove('stats-overlay-visble');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.connectionProblem = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-debug-panel-button connection-problem\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-debug-panel-button-icon connection-problem-icon\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tmouseover: (e) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.hintManager.show(e.currentTarget, BX.message(\"IM_M_CALL_POOR_CONNECTION_WITH_USER\"));\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmouseout: (e) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.hintManager.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.userModel.localUser)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-user-self\");\n\t\t}\n\n\t\tif (this.userModel.avatar !== '')\n\t\t{\n\t\t\tthis.elements.root.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t\tthis.elements.avatar.innerText = '';\n\t\t\tthis.elements.root.style.removeProperty(\"--avatar-background\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty(\"--avatar\");\n\t\t\tthis.elements.root.style.setProperty(\"--avatar-background\", this.avatarBackground);\n\t\t\tthis.elements.avatar.innerText = this.getAvatarInnerText();\n\t\t}\n\n\t\tthis.elements.videoContainer = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-video-container\",\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.video = Dom.create(\"video\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-video\", volume: 0, autoplay: true\n\t\t\t\t\t},\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tplaysinline: true, muted: true\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-preview\",\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-preview-container\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.preview = Dom.create(\"video\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-preview-video\", volume: 0, autoplay: true,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\tplaysinline: true, muted: true\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t\tthis.elements.container.appendChild(this.elements.videoContainer);\n\n\t\tif (this.stream && this.stream.active)\n\t\t{\n\t\t\tthis.elements.video.srcObject = this.stream;\n\t\t}\n\n\t\tif (this.flipVideo)\n\t\t{\n\t\t\tthis.elements.video.classList.add(\"bx-messenger-videocall-video-flipped\");\n\t\t}\n\t\tif (this.userModel.screenState)\n\t\t{\n\t\t\tthis.elements.video.classList.add(\"bx-messenger-videocall-video-contain\");\n\t\t}\n\n\t\tif (this.isVisibleCameraStateIcon() && this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add(\"extra-padding\");\n\t\t}\n\n\t\t//this.elements.nameContainer.appendChild(this.elements.micState);\n\n\t\t// todo: show button only if user have the permission to remove user\n\t\t/*this.elements.removeButton = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-close\"}\n\t\t});\n\n\t\tthis.elements.container.appendChild(this.elements.removeButton);*/\n\n\t\tthis.elements.buttonBackground = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-icon background\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-text\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_CALL_CHANGE_BACKGROUND\")\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: e => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonMenu = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-icon menu\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: e => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.showMenu();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonPin = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-icon pin\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-text\"\n\t\t\t\t\t}, text: BX.message(\"IM_CALL_PIN\")\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: (e) =>\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onPin({userId: this.userModel.id});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonUnPin = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-icon unpin\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-text\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_CALL_UNPIN\")\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick:  (e) =>\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onUnPin();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.elements.userBottomContainer.appendChild(\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-user-device-state-container\"},\n\t\t\t\tchildren: [\n\t\t\t\t\tthis.elements.cameraState = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-name-icon bx-messenger-videocall-user-device-state camera\" + (!this.isVisibleCameraStateIcon() ? \" hidden\" : \"\")},\n\t\t\t\t\t}),\n\t\t\t\t\tthis.elements.micState = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-name-icon bx-messenger-videocall-user-device-state mic\" + (!this.isVisibleMicStateIcon() ? \" hidden\" : \"\")},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t}),\n\t\t);\n\n\t\tthis.updatePanelDeferred();\n\t\treturn this.elements.root;\n\t};\n\n\tshowConnectionStats()\n\t{\n\t\tif (!this.elements.statsOverlay)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet statsString = '';\n\n\t\tconst cameraStats = this.connectionStats?.[MediaStreamsKinds.Camera];\n\t\tconst screenStats = this.connectionStats?.[MediaStreamsKinds.Screen];\n\t\tconst audioStats = this.connectionStats?.[MediaStreamsKinds.Microphone];\n\n\t\tif (cameraStats || !screenStats)\n\t\t{\n\t\t\tstatsString += `Video stats:\\n`;\n\t\t\tstatsString += this._formatVideoStats(cameraStats);\n\t\t}\n\n\t\tif (screenStats)\n\t\t{\n\t\t\tif (screenStats)\n\t\t\t{\n\t\t\t\tstatsString += `\\n\\n`;\n\t\t\t}\n\n\t\t\tstatsString += `Screen share stats:\\n`;\n\t\t\tstatsString += this._formatVideoStats(screenStats);\n\t\t}\n\n\t\tif (audioStats)\n\t\t{\n\t\t\tif (cameraStats || screenStats)\n\t\t\t{\n\t\t\t\tstatsString += `\\n\\n`;\n\t\t\t}\n\n\t\t\tstatsString += `Audio stats:\\n`;\n\t\t\tstatsString += `Bitrate: ${audioStats?.bitrate || 0}\\n`;\n\t\t\tstatsString += `PacketsLost: ${audioStats?.packetsLostExtended || 0}\\n`;\n\t\t\tstatsString += `Codec: ${audioStats?.codecName || '-'}`;\n\t\t}\n\n\t\tthis.elements.statsOverlay.innerText = statsString;\n\t}\n\n\tsetIncomingVideoConstraints(width, height)\n\t{\n\t\tthis.incomingVideoConstraints.width = typeof (width) === \"undefined\" ? this.incomingVideoConstraints.width : width;\n\t\tthis.incomingVideoConstraints.height = typeof (height) === \"undefined\" ? this.incomingVideoConstraints.height : height;\n\n\t\tif (!this.videoRenderer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// vox low quality temporary workaround\n\t\t// (disabled to test quality)\n\t\t// if (this.incomingVideoConstraints.width >= 320 && this.incomingVideoConstraints.width <= 640)\n\t\t// {\n\t\t// \tthis.incomingVideoConstraints.width = 640;\n\t\t// }\n\t\t// if (this.incomingVideoConstraints.height >= 180 && this.incomingVideoConstraints.height <= 360)\n\t\t// {\n\t\t// \tthis.incomingVideoConstraints.height = 360;\n\t\t// }\n\n\t\tthis.videoRenderer.requestVideoSize(this.incomingVideoConstraints.width, this.incomingVideoConstraints.height);\n\t};\n\n\tupdateRendererState()\n\t{\n\t\t/*if (this.videoRenderer)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tthis.videoRenderer.enable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.videoRenderer.disable();\n\t\t\t}\n\t\t}*/\n\n\t\t/*if (this.elements.video && this.elements.video.srcObject)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tthis.elements.video.play();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.video.pause();\n\t\t\t}\n\t\t}*/\n\t};\n\n\t_onUserFieldChanged(event)\n\t{\n\t\tconst eventData = event.data;\n\n\t\tswitch (eventData.fieldName)\n\t\t{\n\t\t\tcase \"id\":\n\t\t\t\treturn this.updateId();\n\t\t\tcase \"name\":\n\t\t\t\treturn this.updateName();\n\t\t\tcase \"avatar\":\n\t\t\t\treturn this.updateAvatar();\n\t\t\tcase \"state\":\n\t\t\t\treturn this.updateState();\n\t\t\tcase \"talking\":\n\t\t\t\treturn this.updateTalking();\n\t\t\tcase \"microphoneState\":\n\t\t\t\treturn this.updateMicrophoneState();\n\t\t\tcase \"cameraState\":\n\t\t\t\treturn this.updateCameraState();\n\t\t\tcase \"videoPaused\":\n\t\t\t\treturn this.updateVideoPaused();\n\t\t\tcase \"floorRequestState\":\n\t\t\t\treturn this.updateFloorRequestState();\n\t\t\tcase \"screenState\":\n\t\t\t\treturn this.updateScreenState();\n\t\t\tcase \"pinned\":\n\t\t\t\treturn this.updatePanel();\n\t\t\tcase \"allowRename\":\n\t\t\t\treturn this.updateRenameAllowed();\n\t\t\tcase \"wasRenamed\":\n\t\t\t\treturn this.updateWasRenamed();\n\t\t\tcase \"renameRequested\":\n\t\t\t\treturn this.updateRenameRequested();\n\t\t\tcase \"order\":\n\t\t\t\treturn this.updateOrder();\n\n\t\t}\n\t};\n\n\ttoggleRenameIcon()\n\t{\n\t\tif (!this.userModel.allowRename)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.changeNameIcon.classList.toggle('hidden');\n\t};\n\n\ttoggleNameInput(event)\n\t{\n\t\tif (!this.userModel.allowRename || !this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\n\t\tif (this.isChangingName)\n\t\t{\n\t\t\tthis.isChangingName = false;\n\t\t\tif (!this.userModel.wasRenamed)\n\t\t\t{\n\t\t\t\tthis.elements.introduceYourselfContainer.classList.remove('hidden');\n\t\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.userModel.wasRenamed)\n\t\t\t{\n\t\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t\t}\n\t\t\tthis.isChangingName = true;\n\t\t\tthis.elements.nameContainer.classList.add('hidden');\n\t\t\tthis.elements.changeNameContainer.classList.remove('hidden');\n\t\t\tthis.elements.changeNameInput.value = this.userModel.name;\n\t\t\tthis.elements.changeNameInput.focus();\n\t\t\tthis.elements.changeNameInput.select();\n\t\t}\n\t};\n\n\tonNameInputKeyDown(event)\n\t{\n\t\tif (!this.userModel.allowRename)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t//enter\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tthis.changeName(event);\n\t\t}\n\t\t//escape\n\t\telse if (event.keyCode === 27)\n\t\t{\n\t\t\tthis.toggleNameInput(event);\n\t\t}\n\t};\n\n\tonNameInputFocus(event)\n\t{\n\n\t};\n\n\tonNameInputBlur(event)\n\t{\n\n\t};\n\n\tchangeName(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tconst inputValue = this.elements.changeNameInput.value;\n\t\tconst newName = inputValue.trim();\n\t\tlet needToUpdate = true;\n\t\tif (newName === this.userModel.name || newName === '')\n\t\t{\n\t\t\tneedToUpdate = false;\n\t\t}\n\n\t\tif (needToUpdate)\n\t\t{\n\t\t\tthis.elements.changeNameConfirm.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameLoader.classList.toggle('hidden');\n\t\t\tthis.callBacks.onUserRename(newName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleNameInput(event);\n\t\t}\n\t};\n\n\tshowMenu()\n\t{\n\t\tconst menuItems = [];\n\n\t\tif (this.userModel.localUser && this.allowBackgroundItem)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: (this.allowMaskItem ? BX.message(\"IM_CALL_CHANGE_BG_MASK\") : BX.message(\"IM_CALL_CHANGE_BACKGROUND\")),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.close();\n\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet rect = Dom.getRelativePosition(this.elements.buttonMenu, this.parentContainer)\n\t\tthis.menu = new Menu({\n\t\t\tid: 'call-view-user-menu-' + this.userModel.id,\n\t\t\tbindElement: {\n\t\t\t\tleft: rect.left,\n\t\t\t\ttop: rect.top,\n\t\t\t\tbottom: rect.bottom\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t\ttargetContainer: this.parentContainer,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tangle: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white', opacity: 0\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonPopupDestroy: () => this.menu = null\n\t\t\t}\n\t\t});\n\t\tthis.menu.show();\n\t};\n\n\tupdateAvatar()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tif (this.userModel.avatar !== '')\n\t\t\t{\n\t\t\t\tthis.elements.root.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t\t\tthis.elements.avatar.innerText = '';\n\t\t\t\tthis.elements.root.style.removeProperty(\"--avatar-background\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.root.style.removeProperty(\"--avatar\");\n\t\t\t\tthis.elements.root.style.setProperty(\"--avatar-background\", this.avatarBackground);\n\t\t\t\tthis.elements.avatar.innerText = this.getAvatarInnerText();\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateId()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.root.dataset.userId = this.userModel.id;\n\t\t}\n\t};\n\n\tupdateName()\n\t{\n\t\tif (this.isChangingName)\n\t\t{\n\t\t\tthis.isChangingName = false;\n\t\t\tthis.elements.changeNameConfirm.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameLoader.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t}\n\n\t\tif (this.elements.name)\n\t\t{\n\t\t\tthis.elements.name.innerText = this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace(\"#NAME#\", this.userModel.name) : this.userModel.name;\n\t\t}\n\t\tif (this.userModel.avatar === '' && this.elements.avatar)\n\t\t{\n\t\t\tthis.elements.avatar.innerText = this.getAvatarInnerText();\n\t\t}\n\n\t};\n\n\tgetAvatarInnerText()\n\t{\n\t\treturn Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t}\n\n\tupdateRenameAllowed()\n\t{\n\t\tif (this.userModel.allowRename && this.elements.nameContainer && this.elements.introduceYourselfContainer)\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('hidden');\n\t\t\tthis.elements.introduceYourselfContainer.classList.remove('hidden');\n\t\t}\n\t};\n\n\tupdateWasRenamed()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.allowRename)\n\t\t{\n\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t\tthis.elements.changeNameIcon.classList.remove('hidden');\n\t\t\tif (this.elements.changeNameContainer.classList.contains('hidden'))\n\t\t\t{\n\t\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateRenameRequested()\n\t{\n\t\tif (this.userModel.allowRename)\n\t\t{\n\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t}\n\t};\n\n\tupdateOrder()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.root.dataset.order = this.userModel.order;\n\t\t\tthis.elements.root.style.order = this.userModel.order;\n\t\t}\n\t};\n\n\tupdatePanelDeferred()\n\t{\n\t\tsetTimeout(this.updatePanel.bind(this), 0);\n\t};\n\n\tupdatePanel()\n\t{\n\t\tif (!this.isMounted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst width = this.elements.root.offsetWidth;\n\n\t\tDom.clean(this.elements.panel);\n\t\tif (this.userModel.localUser && this.allowBackgroundItem)\n\t\t{\n\t\t\tif (width > 300)\n\t\t\t{\n\t\t\t\tthis.elements.panel.appendChild(this.elements.buttonBackground);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.panel.appendChild(this.elements.buttonMenu);\n\t\t\t}\n\t\t}\n\n\t\tif (this.allowPinButton)\n\t\t{\n\t\t\tif (this.userModel.pinned)\n\t\t\t{\n\t\t\t\tthis.elements.panel.appendChild(this.elements.buttonUnPin);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.panel.appendChild(this.elements.buttonPin);\n\t\t\t}\n\n\t\t\tif (width > 250)\n\t\t\t{\n\t\t\t\tthis.elements.buttonPin.classList.remove(\"no-text\");\n\t\t\t\tthis.elements.buttonUnPin.classList.remove(\"no-text\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.buttonPin.classList.add(\"no-text\");\n\t\t\t\tthis.elements.buttonUnPin.classList.add(\"no-text\");\n\t\t\t}\n\t\t}\n\t};\n\n\tplayVideoElements(videoElement)\n\t{\n\t\tconst hasVideoEl = !!videoElement;\n\t\tconst isCanPlaying = hasVideoEl && !!videoElement.srcObject;\n\t\tconst isPaused = hasVideoEl && videoElement.paused;\n\t\tconst isReadyPlaying = hasVideoEl && videoElement.readyState >= videoElement.HAVE_CURRENT_DATA;\n\t\tconst isEnded = hasVideoEl && videoElement.ended;\n\n\t\tif (hasVideoEl && !isPaused)\n\t\t{\n\t\t\tvideoElement.pause();\n\t\t}\n\n\t\tif (isCanPlaying && isReadyPlaying && !isEnded)\n\t\t{\n\t\t\tvideoElement.play().catch(logPlaybackError);\n\t\t}\n\n\t\tif (isCanPlaying && isEnded)\n\t\t{\n\t\t\tvideoElement.load();\n\t\t}\n\n\t\tif (isCanPlaying && !isReadyPlaying && !isEnded && !videoElement.onloadeddata)\n\t\t{\n\t\t\tvideoElement.onloadeddata = () =>\n\t\t\t{\n\t\t\t\tthis.playVideoElements(videoElement);\n\t\t\t};\n\t\t}\n\t}\n\n\tupdate()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.hasVideo()/* && this.visible*/)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tif (this.videoRenderer)\n\t\t\t\t{\n\t\t\t\t\tthis.videoRenderer.render(this.elements.video);\n\t\t\t\t\tthis.playVideoElements(this.elements.video);\n\t\t\t\t\tif (this._previewRenderer)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._previewRenderer.render(this.elements.preview);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.preview.srcObject = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (this.stream && this.elements.video.srcObject?.id !== this.stream?.id)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.video.srcObject = this.stream;\n\t\t\t\t\tthis.playVideoElements(this.elements.video);\n\t\t\t\t}\n\n\t\t\t\tif (this.elements.avatarContainer)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.avatarContainer.classList.add('bx-messenger-videocall-hidden-avatar');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.videoRenderer?.kind === 'video' && this.flipVideo)\n\t\t\t{\n\t\t\t\tthis.elements.video.classList.toggle(\"bx-messenger-videocall-video-flipped\", this.flipVideo);\n\t\t\t\tthis.elements.preview.classList.toggle(\"bx-messenger-videocall-video-flipped\", !this.flipVideo);\n\t\t\t}\n\t\t\telse if (this.videoRenderer?.kind === 'sharing' && this.flipVideo)\n\t\t\t{\n\t\t\t\tthis.elements.video.classList.toggle(\"bx-messenger-videocall-video-flipped\", !this.flipVideo);\n\t\t\t\tthis.elements.preview.classList.toggle(\"bx-messenger-videocall-video-flipped\", this.flipVideo);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.video.classList.toggle(\"bx-messenger-videocall-video-flipped\", this.flipVideo);\n\t\t\t}\n\t\t\tthis.elements.video.classList.toggle(\"bx-messenger-videocall-video-contain\", this.userModel.screenState);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.srcObject = null;\n\t\t\tthis.elements.preview.srcObject = null;\n\t\t\tif (this.elements.avatarContainer)\n\t\t\t{\n\t\t\t\tthis.elements.avatarContainer.classList.remove('bx-messenger-videocall-hidden-avatar');\n\t\t\t}\n\t\t}\n\t\tif (\n\t\t\tUtil.isCallServerAllowed()\n\t\t\t&& this.userModel.state === UserState.Connected\n\t\t\t&& !this.elements.debugPanel.parentElement\n\t\t\t&& !this.screenSharingUser\n\t\t)\n\t\t{\n\t\t\tthis.elements.container.appendChild(this.elements.debugPanel);\n\t\t}\n\t\tthis.updatePanelDeferred();\n\t};\n\n\tplayAudio()\n\t{\n\t\tif (!this.audioStream)\n\t\t{\n\t\t\tthis.elements.audio.srcObject = null;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.speakerId && Type.isFunction(this.elements.audio.setSinkId))\n\t\t{\n\t\t\tthis.elements.audio.setSinkId(this.speakerId).then(function ()\n\t\t\t{\n\t\t\t\tthis.elements.audio.srcObject = this.audioStream;\n\t\t\t\tthis.elements.audio.play().catch(logPlaybackError);\n\t\t\t}.bind(this)).catch(console.error);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.audio.srcObject = this.audioStream;\n\t\t\tthis.elements.audio.play().catch(logPlaybackError);\n\t\t}\n\t};\n\n\tplayScreenAudio()\n\t{\n\t\tif (!this.screenAudioStream)\n\t\t{\n\t\t\tthis.elements.screenAudio.srcObject = null;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.screenAudio.srcObject = this.screenAudioStream;\n\t\tthis.elements.screenAudio.play().catch(logPlaybackError);\n\t}\n\n\tplayVideo()\n\t{\n\t\tthis.playVideoElements(this.elements.video);\n\t\tthis.playVideoElements(this.elements.preview);\n\t};\n\n\tblurVideo(blurState)\n\t{\n\t\tblurState = !!blurState;\n\n\t\tif (this.videoBlurState == blurState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoBlurState = blurState;\n\t\tif (this.elements.video)\n\t\t{\n\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-blurred');\n\t\t}\n\t};\n\n\tgetStateMessage(userState, videoPaused)\n\t{\n\t\tswitch (userState)\n\t\t{\n\t\t\tcase UserState.Idle:\n\t\t\t\treturn \"\";\n\t\t\tcase UserState.Calling:\n\t\t\t\treturn BX.message(\"IM_M_CALL_STATUS_WAIT_ANSWER\");\n\t\t\tcase UserState.Declined:\n\t\t\t\treturn BX.message(\"IM_M_CALL_STATUS_DECLINED\");\n\t\t\tcase UserState.Ready:\n\t\t\tcase UserState.Connecting:\n\t\t\t\treturn BX.message(\"IM_M_CALL_STATUS_WAIT_CONNECT\");\n\t\t\tcase UserState.Connected:\n\t\t\t\treturn videoPaused ? BX.message(\"IM_M_CALL_STATUS_VIDEO_PAUSED\") : \"\";\n\t\t\tcase UserState.Failed:\n\t\t\t\treturn BX.message(\"IM_M_CALL_STATUS_CONNECTION_ERROR\");\n\t\t\tcase UserState.Unavailable:\n\t\t\t\treturn BX.message(\"IM_M_CALL_STATUS_UNAVAILABLE\");\n\t\t\tdefault:\n\t\t\t\treturn \"\";\n\t\t}\n\t};\n\n\tmount(parent, force)\n\t{\n\t\tforce = force === true;\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t}\n\n\t\tif (this.isMounted() && this.elements.root.parentElement == parent && !force)\n\t\t{\n\t\t\tthis.updatePanelDeferred();\n\t\t\treturn false;\n\t\t}\n\n\t\tparent.appendChild(this.elements.root);\n\t\tthis.update();\n\t};\n\n\tdismount()\n\t{\n\t\t// this.visible = false;\n\t\tif (!this.isMounted())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.elements.video.srcObject = null;\n\t\tthis.elements.preview.srcObject = null;\n\t\tDom.remove(this.elements.root);\n\t};\n\n\tisMounted()\n\t{\n\t\treturn !!(this.elements.root && this.elements.root.parentElement);\n\t};\n\n\tupdateState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.state == UserState.Calling || this.userModel.state == UserState.Connecting)\n\t\t{\n\t\t\tthis.updateAvatarPulseState();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addAvatarPulseTimer();\n\t\t}\n\n\t\tif (this.userModel.state == UserState.Idle)\n\t\t{\n\t\t\tthis._videoRenderer = null;\n\t\t\tthis._previewRenderer = null;\n\t\t\tthis._audioTrack = null;\n\t\t\tthis._audioStream = null;\n\t\t}\n\n\t\tthis.elements.state.innerText = this.getStateMessage(this.userModel.state, this.userModel.videoPaused);\n\n\t\tthis.updateMicrophoneState()\n\t\tthis.updateCameraState()\n\n\t\tthis.update();\n\t};\n\n\tupdateTalking()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.updateAvatarPulseState();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addAvatarPulseTimer();\n\t\t}\n\t};\n\n\tupdateMicrophoneState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.micState.classList.add(\"hidden\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.micState.classList.remove(\"hidden\");\n\t\t\tthis.clearAvatarPulseTimer();\n\t\t}\n\n\t\tif (this.isVisibleCameraStateIcon() && this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add(\"extra-padding\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.remove(\"extra-padding\");\n\t\t}\n\t};\n\n\tupdateCameraState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.isVisibleCameraStateIcon())\n\t\t{\n\t\t\tthis.elements.cameraState.classList.add(\"hidden\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.cameraState.classList.remove(\"hidden\");\n\t\t}\n\n\t\tif (this.isVisibleCameraStateIcon() && this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add(\"extra-padding\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.remove(\"extra-padding\");\n\t\t}\n\t};\n\n\tupdateVideoPaused()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\n\t\t}\n\t\tif (this.stream && this.hasVideo())\n\t\t{\n\t\t\tthis.blurVideo(this.userModel.videoPaused);\n\t\t}\n\t\tthis.updateState();\n\t};\n\n\tupdateFloorRequestState()\n\t{\n\t\tif (!this.elements.floorRequest)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.floorRequestState)\n\t\t{\n\t\t\tthis.elements.floorRequest.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.floorRequest.classList.remove(\"active\");\n\t\t}\n\t};\n\n\tupdateScreenState()\n\t{\n\t\tif (!this.elements.video)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.screenState)\n\t\t{\n\t\t\tthis.elements.video.classList.add(\"bx-messenger-videocall-video-contain\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.classList.remove(\"bx-messenger-videocall-video-contain\");\n\t\t}\n\t};\n\n\thide()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.root.dataset.hidden = 1;\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdelete this.elements.root.dataset.hidden;\n\t};\n\n\thasVideo()\n\t{\n\t\treturn this.userModel.state == UserState.Connected && (!!this._videoTrack || !!this._videoRenderer);\n\t};\n\n\thasCameraVideo()\n\t{\n\t\treturn this.userModel.state == UserState.Connected && (!!this._videoTrack || this._videoRenderer?.kind === 'video' || this._previewRenderer?.kind === 'video');\n\t}\n\n\tcheckVideoAspect()\n\t{\n\t\tif (!this.elements.video)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.elements.video.videoHeight > this.elements.video.videoWidth)\n\t\t{\n\t\t\tthis.elements.video.classList.add(\"bx-messenger-videocall-video-vertical\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.classList.remove(\"bx-messenger-videocall-video-vertical\");\n\t\t}\n\t};\n\n\treleaseStream()\n\t{\n\t\tif (this._videoRenderer && !this._previewRenderer)\n\t\t{\n\t\t\tif (this.elements.video)\n\t\t\t{\n\t\t\t\tthis.elements.video.srcObject = null;\n\t\t\t}\n\t\t\tthis._videoRenderer = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.elements.video)\n\t\t\t{\n\t\t\t\tthis.elements.video.srcObject = null;\n\t\t\t}\n\t\t\tthis.videoTrack = null;\n\t\t}\n\t};\n\n\t_getVideoStats(videoStats) {\n\t\tlet resultString = '';\n\t\tlet limitationsString = '';\n\n\t\tresultString += `Bitrate: ${videoStats?.bitrate || 0}\\n`;\n\t\tresultString += `PacketsLost: ${videoStats?.packetsLostExtended || 0}\\n`;\n\t\tresultString += `Codec: ${videoStats?.codecName || '-'}\\n`;\n\t\tresultString += `Resolution: ${videoStats?.frameWidth || 0}x${videoStats?.frameHeight || 0} `;\n\n\t\tif (videoStats?.qualityLimitationReason)\n\t\t{\n\t\t\tresultString += `(changes:${videoStats.qualityLimitationResolutionChanges}, FPS: ${videoStats?.framesPerSecond || 0})`;\n\t\t\tlimitationsString = `Limitation: ${videoStats.qualityLimitationReason}`;\n\t\t\tlimitationsString += ` (duration: ${Object.entries(videoStats.qualityLimitationDurations || {}).reduce(\n\t\t\t\t(accumulator, value, index) => accumulator + `${index ? ', ' : ''}` + `${value[0]}: ${value[1]}`,\n\t\t\t\t'',\n\t\t\t)})`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresultString += `(${videoStats?.framesPerSecond || 0} FPS)`;\n\t\t}\n\n\t\treturn ({\n\t\t\tresultString,\n\t\t\tlimitationsString,\n\t\t})\n\t}\n\n\t_formatVideoStats(videoStats)\n\t{\n\t\tlet result = '';\n\t\tlet limitations = '';\n\t\tif (Type.isArray(videoStats))\n\t\t{\n\t\t\tvideoStats.forEach((stats, trackIndex) =>\n\t\t\t{\n\t\t\t\tif (trackIndex)\n\t\t\t\t{\n\t\t\t\t\tresult += `\\n\\n`;\n\t\t\t\t}\n\n\t\t\t\tif (videoStats.length > 1)\n\t\t\t\t{\n\t\t\t\t\tresult += `Track ${trackIndex+1}\\n`;\n\t\t\t\t}\n\n\t\t\t\tconst {resultString, limitationsString} = this._getVideoStats(stats);\n\n\t\t\t\tif (resultString)\n\t\t\t\t{\n\t\t\t\t\tresult += resultString;\n\t\t\t\t}\n\n\t\t\t\tif (limitationsString)\n\t\t\t\t{\n\t\t\t\t\tlimitations = limitationsString;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst {resultString, limitationsString} = this._getVideoStats(videoStats);\n\n\t\t\tif (resultString)\n\t\t\t{\n\t\t\t\tresult += resultString;\n\t\t\t}\n\n\t\t\tif (limitationsString)\n\t\t\t{\n\t\t\t\tlimitations = limitationsString;\n\t\t\t}\n\t\t}\n\n\t\treturn limitations ? `${limitations}\\n\\n${result}` : result;\n\t};\n\n\tshowUserName()\n\t{\n\t\tif (this.hideUserNameTimer)\n\t\t{\n\t\t\tclearTimeout(this.hideUserNameTimer);\n\t\t\tthis.hideUserNameTimer = null;\n\t\t}\n\n\t\tif (this.elements.nameContainer)\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('active');\n\t\t\tthis.hideUserNameTimer = setTimeout(() => {\n\t\t\t\tthis.elements.nameContainer.classList.remove('active')\n\t\t\t}, 5000)\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.hintManager)\n\t\t{\n\t\t\tthis.hintManager.hide();\n\t\t\tthis.hintManager = null;\n\t\t}\n\t\tthis.releaseStream();\n\t\tclearInterval(this.checkAspectInterval);\n\n\t\tdocument.removeEventListener('mousemove', this.onMouseMoveHandler);\n\t};\n\n\taddAvatarPulseTimer()\n\t{\n\t\tif (this.removeAvatarPulseTimer)\n\t\t{\n\t\t\tclearTimeout(this.removeAvatarPulseTimer);\n\t\t\tthis.removeAvatarPulseTimer = null;\n\t\t}\n\n\t\tthis.removeAvatarPulseTimer = setTimeout(() => {\n\t\t\tthis.elements.avatarContainer.classList.remove(\"bx-messenger-videocall-user-avatar-pulse\");\n\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-user-talking\");\n\t\t}, 1000);\n\t}\n\n\tclearAvatarPulseTimer()\n\t{\n\t\tif (this.removeAvatarPulseTimer)\n\t\t{\n\t\t\tclearTimeout(this.removeAvatarPulseTimer);\n\t\t\tthis.removeAvatarPulseTimer = null;\n\t\t}\n\n\t\tthis.elements.avatarContainer.classList.remove(\"bx-messenger-videocall-user-avatar-pulse\");\n\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-user-talking\");\n\t}\n\n\tupdateAvatarPulseState()\n\t{\n\t\tif (this.removeAvatarPulseTimer)\n\t\t{\n\t\t\tclearTimeout(this.removeAvatarPulseTimer);\n\t\t\tthis.removeAvatarPulseTimer = null;\n\t\t}\n\n\t\tthis.elements.avatarContainer.classList.add(\"bx-messenger-videocall-user-avatar-pulse\");\n\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-user-talking\");\n\t\t}\n\t}\n}\n\n","import {Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport { Utils } from 'im.v2.lib.utils';\n\nexport class FloorRequest extends EventEmitter\n{\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(\"BX.Call.FloorRequest\");\n\n\t\tthis.hideTime = BX.prop.getInteger(config, \"hideTime\", 10);\n\t\tthis.userModel = config.userModel;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null\n\t\t};\n\n\t\tthis._hideTimeout = null;\n\t\tthis._onUserModelChangedHandler = this._onUserModelChanged.bind(this);\n\t\tthis.userModel.subscribe(\"changed\", this._onUserModelChangedHandler);\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new FloorRequest(config);\n\t};\n\n\tmount(container)\n\t{\n\t\tcontainer.appendChild(this.render());\n\t\tthis.scheduleDismount();\n\t};\n\n\tdismount()\n\t{\n\t\tBX.remove(this.elements.root);\n\t\tthis.destroy();\n\t};\n\n\tdismountWithAnimation()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.elements.root.classList.add(\"closing\");\n\n\t\tthis.elements.root.addEventListener(\"animationend\", () => this.dismount());\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-floor-request-notification\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-icon-container\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-avatar\"},\n\t\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-icon bx-messenger-videocall-floor-request-icon\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.name = Dom.create(\"span\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-text-container\"},\n\t\t\t\t\thtml: BX.message(\"IM_CALL_WANTS_TO_SAY_\" + (this.userModel.gender == \"F\" ? \"F\" : \"M\")).replace(\"#NAME#\", '<span class =\"bx-call-view-floor-request-notification-text-name\">' + BX.util.htmlspecialchars(this.userModel.name) + '</span>')\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-close\"},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this.dismount.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.userModel.avatar)\n\t\t{\n\t\t\tthis.elements.avatar.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t\tthis.elements.avatar.innerText = '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.avatar.innerText = Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t\t}\n\n\t\treturn this.elements.root\n\t};\n\n\tscheduleDismount()\n\t{\n\t\treturn;\n\t\tthis._hideTimeout = setTimeout(this.dismountWithAnimation.bind(this), this.hideTime * 1000);\n\t};\n\n\t_onUserModelChanged(event)\n\t{\n\t\tvar eventData = event.data;\n\n\t\tif (eventData.fieldName == \"floorRequestState\" && !this.userModel.floorRequestState)\n\t\t{\n\t\t\tthis.dismountWithAnimation();\n\t\t}\n\n\t\tif (this.userModel.avatar === '' && this.elements.avatar)\n\t\t{\n\t\t\tthis.elements.avatar.innerText = Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t\t}\n\n\t\tif (this.elements.name)\n\t\t{\n\t\t\tthis.elements.name.innerHtml = BX.message(\"IM_CALL_WANTS_TO_SAY_\" + (this.userModel.gender == \"F\" ? \"F\" : \"M\")).replace(\"#NAME#\", '<span class =\"bx-call-view-floor-request-notification-text-name\">' + BX.util.htmlspecialchars(this.userModel.name) + '</span>');\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tclearTimeout(this._hideTimeout);\n\t\tthis._hideTimeout = null;\n\t\tthis.elements = null;\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis.userModel.unsubscribe(\"changed\", this._onUserModelChangedHandler);\n\t\t\tthis.userModel = null;\n\t\t}\n\t\tthis.emit(\"onDestroy\", {});\n\t}\n}","const maximumNotifications = 5;\n\nlet instance;\n\nexport class NotificationManager\n{\n\tconstructor()\n\t{\n\t\tthis.maxNotification = maximumNotifications;\n\t\tthis.notifications = [];\n\t};\n\n\tstatic get Instance()\n\t{\n\t\tif (!instance)\n\t\t{\n\t\t\tinstance = new NotificationManager()\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\taddNotification(notification)\n\t{\n\t\tnotification.subscribe(\"onDestroy\", () => this.onNotificationDestroy(notification));\n\t\tthis.notifications.push(notification);\n\n\t\tif (this.notifications.length > this.maxNotification)\n\t\t{\n\t\t\tconst firstNotification = this.notifications.shift();\n\t\t\tfirstNotification.dismount();\n\t\t}\n\t};\n\n\tonNotificationDestroy(notification)\n\t{\n\t\tconst index = this.notifications.indexOf(notification);\n\n\t\tif (index != -1)\n\t\t{\n\t\t\tthis.notifications.splice(index, 1);\n\t\t}\n\t};\n}","import {Dom} from 'main.core'\nimport {EventEmitter} from 'main.core.events'\nimport {Popup} from 'main.popup'\nimport {Hardware} from '../hardware';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport 'ui.switcher';\nimport Util from '../util';\n\nconst DeviceSelectorEvents = {\n\tonMicrophoneSelect: \"onMicrophoneSelect\",\n\tonMicrophoneSwitch: \"onMicrophoneSwitch\",\n\tonCameraSelect: \"onCameraSelect\",\n\tonCameraSwitch: \"onCameraSwitch\",\n\tonSpeakerSelect: \"onSpeakerSelect\",\n\tonSpeakerSwitch: \"onSpeakerSwitch\",\n\tonChangeHdVideo: \"onChangeHdVideo\",\n\tonChangeMicAutoParams: \"onChangeMicAutoParams\",\n\tonChangeFaceImprove: \"onChangeFaceImprove\",\n\tonAdvancedSettingsClick: \"onOpenAdvancedSettingsClick\",\n\tonShow: \"onShow\",\n\tonDestroy: \"onDestroy\",\n};\n\n/**\n * @param config\n * @param {Node} config.parentElement\n * @param {boolean} config.cameraEnabled\n * @param {boolean} config.microphoneEnabled\n * @param {boolean} config.speakerEnabled\n * @param {boolean} config.allowHdVideo\n * @param {boolean} config.faceImproveEnabled\n * @param {object} config.events\n\n * @returns {DeviceSelector}\n */\n\n/**\n * @param config\n * @param {Node} config.parentElement\n * @param {number} config.zIndex\n * @param {boolean} config.cameraEnabled\n * @param {boolean} config.microphoneEnabled\n * @param {boolean} config.speakerEnabled\n * @param {boolean} config.allowHdVideo\n * @param {boolean} config.faceImproveEnabled\n * @constructor\n */\nexport class DeviceSelector\n{\n\tstatic Events = DeviceSelectorEvents;\n\n\tconstructor(config)\n\t{\n\t\tthis.viewElement = config.viewElement || null;\n\t\tthis.parentElement = config.parentElement;\n\t\tthis.zIndex = config.zIndex;\n\n\t\tthis.cameraEnabled = BX.prop.getBoolean(config, \"cameraEnabled\", false);\n\t\tthis.cameraId = BX.prop.getString(config, \"cameraId\", false);\n\t\tthis.microphoneEnabled = BX.prop.getBoolean(config, \"microphoneEnabled\", false);\n\t\tthis.microphoneId = BX.prop.getString(config, \"microphoneId\", false);\n\t\tthis.speakerEnabled = BX.prop.getBoolean(config, \"speakerEnabled\", false);\n\t\tthis.speakerId = BX.prop.getString(config, \"speakerId\", false);\n\t\tthis.allowHdVideo = BX.prop.getBoolean(config, \"allowHdVideo\", false);\n\t\tthis.faceImproveEnabled = BX.prop.getBoolean(config, \"faceImproveEnabled\", false);\n\t\tthis.allowFaceImprove = BX.prop.getBoolean(config, \"allowFaceImprove\", false);\n\t\tthis.allowBackground = BX.prop.getBoolean(config, \"allowBackground\", true);\n\t\tthis.allowMask = BX.prop.getBoolean(config, \"allowMask\", true);\n\t\tthis.allowAdvancedSettings = BX.prop.getBoolean(config, \"allowAdvancedSettings\", false);\n\t\tthis.switchCameraBlocked = config.switchCameraBlocked || false;\n\t\tthis.switchMicrophoneBlocked = config.switchMicrophoneBlocked || false;\n\t\tthis.isDestroying = false;\n\n\t\tthis.popup = null;\n\t\tthis.eventEmitter = new BX.Event.EventEmitter(this, \"DeviceSelector\");\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tmicContainer: null,\n\t\t\tcameraContainer: null,\n\t\t\tspeakerContainer: null,\n\t\t};\n\n\t\tconst eventListeners = BX.prop.getObject(config, \"events\", {});\n\t\tObject.values(DeviceSelectorEvents).forEach((eventName) =>\n\t\t{\n\t\t\tif (eventListeners[eventName])\n\t\t\t{\n\t\t\t\tthis.eventEmitter.subscribe(eventName, eventListeners[eventName]);\n\t\t\t}\n\t\t})\n\t};\n\n\t// static create(config)\n\t// {\n\t// \treturn new DeviceSelector(config);\n\t// };\n\n\tshow()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\t\tthis.popup = new Popup({\n\t\t\tid: 'call-view-device-selector',\n\t\t\tbindElement: this.parentElement,\n\t\t\ttargetContainer: this.viewElement,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 20,\n\t\t\toffsetLeft: -20,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top'\n\t\t\t},\n\t\t\tangle: false,\n\t\t\tbackground: '#22272B',\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: '#22272B',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tcontent: this.render(),\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => this.popup.destroy(),\n\t\t\t\tonPopupDestroy: () => this.destroy(),\n\t\t\t}\n\t\t});\n\t\tthis.popup.show();\n\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onShow, {});\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-top\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t(this.microphoneContainer = DeviceMenu.create({\n\t\t\t\t\t\t\tblocked: this.switchMicrophoneBlocked,\n\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_MIC\"),\n\t\t\t\t\t\t\tdeviceList: Hardware.getMicrophoneList(),\n\t\t\t\t\t\t\tselectedDevice: this.microphoneId,\n\t\t\t\t\t\t\tdeviceEnabled: this.microphoneEnabled,\n\t\t\t\t\t\t\ticons: [\"microphone\", \"microphone-off\"],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonSwitch: this.onMicrophoneSwitch.bind(this),\n\t\t\t\t\t\t\t\tonSelect: this.onMicrophoneSelect.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})).render(),\n\t\t\t\t\t\t(this.cameraContainer = DeviceMenu.create({\n\t\t\t\t\t\t\tblocked: this.switchCameraBlocked,\n\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_CAMERA\"),\n\t\t\t\t\t\t\tdeviceList: Hardware.getCameraList(),\n\t\t\t\t\t\t\tselectedDevice: this.cameraId,\n\t\t\t\t\t\t\tdeviceEnabled: this.cameraEnabled,\n\t\t\t\t\t\t\ticons: [\"camera\", \"camera-off\"],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonSwitch: this.onCameraSwitch.bind(this),\n\t\t\t\t\t\t\t\tonSelect: this.onCameraSelect.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})).render(),\n\t\t\t\t\t\tHardware.canSelectSpeaker() ?\n\t\t\t\t\t\t\tDeviceMenu.create({\n\t\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_SPEAKER\"),\n\t\t\t\t\t\t\t\tdeviceList: Hardware.getSpeakerList(),\n\t\t\t\t\t\t\t\tselectedDevice: this.speakerId,\n\t\t\t\t\t\t\t\tdeviceEnabled: this.speakerEnabled,\n\t\t\t\t\t\t\t\ticons: [\"speaker\", \"speaker-off\"],\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tonSwitch: this.onSpeakerSwitch.bind(this),\n\t\t\t\t\t\t\t\t\tonSelect: this.onSpeakerSelect.bind(this)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).render()\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tid: \"device-selector-hd-video\",\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-view-device-selector-bottom-item-checkbox\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\t\t\t\t\t\tchecked: this.allowHdVideo\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tchange: this.onAllowHdVideoChange.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-label\"},\n\t\t\t\t\t\t\t\t\tattrs: {for: \"device-selector-hd-video\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_HD_VIDEO\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.allowFaceImprove ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tid: \"device-selector-mic-auto-params\",\n\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-view-device-selector-bottom-item-checkbox\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\t\t\t\t\t\t\tchecked: this.faceImproveEnabled\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tchange: this.onFaceImproveChange.bind(this)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-label\"},\n\t\t\t\t\t\t\t\t\t\tattrs: {for: \"device-selector-mic-auto-params\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_SETTINGS_HARDWARE_CAMERA_FACE_IMPROVE\")\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tthis.allowBackground ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\t\ttext: this.allowMask ? BX.message(\"IM_M_CALL_BG_MASK_CHANGE\") : BX.message(\"IM_M_CALL_BACKGROUND_CHANGE\"),\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"CALL_RUN_SELF_TEST\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tUtil.startSelfTest();\n\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t(this.allowAdvancedSettings && !!BX.MessengerCommon) ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_ADVANCED_SETTINGS\"),\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t// to prevent BX.IM.autoHide\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onAdvancedSettingsClick);\n\t\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t};\n\n\ttoggleCameraAvailability(available)\n\t{\n\t\tif (available)\n\t\t{\n\t\t\tthis.cameraContainer.unblock();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cameraContainer.block();\n\t};\n\n\ttoggleMicrophoneAvailability(available)\n\t{\n\t\tif (available)\n\t\t{\n\t\t\tthis.microphoneContainer.unblock();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneContainer.block();\n\t};\n\n\tonMicrophoneSwitch()\n\t{\n\t\tthis.microphoneEnabled = !this.microphoneEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onMicrophoneSwitch, {\n\t\t\tmicrophoneEnabled: this.microphoneEnabled\n\t\t})\n\t};\n\n\tonMicrophoneSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onMicrophoneSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t})\n\t};\n\n\tonCameraSwitch()\n\t{\n\t\tthis.cameraEnabled = !this.cameraEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onCameraSwitch, {\n\t\t\tcameraEnabled: this.cameraEnabled\n\t\t})\n\t};\n\n\tonCameraSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onCameraSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\tonSpeakerSwitch()\n\t{\n\t\tthis.speakerEnabled = !this.speakerEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onSpeakerSwitch, {\n\t\t\tspeakerEnabled: this.speakerEnabled\n\t\t})\n\t};\n\n\tonSpeakerSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onSpeakerSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\tonAllowHdVideoChange(e)\n\t{\n\t\tthis.allowHdVideo = e.currentTarget.checked;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onChangeHdVideo, {\n\t\t\tallowHdVideo: this.allowHdVideo\n\t\t})\n\t};\n\n\tonAllowMirroringVideoChange(e)\n\t{\n\t\tHardware.enableMirroring = e.target.checked;\n\t};\n\n\tonFaceImproveChange(e)\n\t{\n\t\tthis.faceImproveEnabled = e.currentTarget.checked;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onChangeFaceImprove, {\n\t\t\tfaceImproveEnabled: this.faceImproveEnabled\n\t\t})\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.isDestroying)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isDestroying = true;\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onDestroy, {});\n\t};\n}\n\nconst DeviceMenuEvents = {\n\tonSelect: \"onSelect\",\n\tonSwitch: \"onSwitch\"\n};\n\nclass DeviceMenu\n{\n\tconstructor(config)\n\t{\n\t\tconfig = BX.type.isObject(config) ? config : {};\n\n\t\tthis.menuBlocked = config.blocked || false;\n\t\tthis.deviceList = BX.prop.getArray(config, \"deviceList\", []);\n\t\tthis.selectedDevice = BX.prop.getString(config, \"selectedDevice\", \"\");\n\t\tthis.deviceEnabled = BX.prop.getBoolean(config, \"deviceEnabled\", false);\n\t\tthis.deviceLabel = BX.prop.getString(config, \"deviceLabel\", \"\");\n\t\tthis.icons = BX.prop.getArray(config, \"icons\", []);\n\t\tthis.eventEmitter = new EventEmitter(this, 'DeviceMenu');\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tswitchIcon: null,\n\t\t\tmenuInner: null,\n\t\t\tmenuItems: {}  // deviceId => {root: element, icon: element}\n\t\t};\n\n\t\tvar events = BX.prop.getObject(config, \"events\", {});\n\t\tfor (var eventName in events)\n\t\t{\n\t\t\tif (!events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t}\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new DeviceMenu(config);\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector-menu-container\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-switch-wrapper\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.switchIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-icon \" + this.getDeviceIconClass()}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-text\"},\n\t\t\t\t\t\t\ttext: this.deviceLabel\n\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-switch\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t(new BX.UI.Switcher({\n\t\t\t\t\t\t\t\t\tsize: 'small',\n\t\t\t\t\t\t\t\t\tchecked: this.deviceEnabled,\n\t\t\t\t\t\t\t\t\thandlers: {\n\t\t\t\t\t\t\t\t\t\ttoggled: this.onSwitchToggled.bind(this)\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdisabled: this.menuBlocked,\n\t\t\t\t\t\t\t\t})).getNode()\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.menuInner = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-inner\" + (this.menuBlocked ? ' inactive' : '')},\n\t\t\t\t\tchildren: this.deviceList.map(this.renderDevice.bind(this))\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\treturn this.elements.root;\n\t};\n\n\trenderDevice(deviceInfo)\n\t{\n\t\tvar iconClass = this.selectedDevice === deviceInfo.deviceId ? \"selected\" : \"\";\n\t\tvar deviceElements = {};\n\t\tdeviceElements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item\"},\n\t\t\tdataset: {\n\t\t\t\tdeviceId: deviceInfo.deviceId\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tdeviceElements.icon = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item-icon \" + iconClass},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item-text\"},\n\t\t\t\t\ttext: deviceInfo.label || \"(\" + BX.message(\"IM_M_CALL_DEVICE_NO_NAME\") + \")\",\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.onMenuItemClick.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.elements.menuItems[deviceInfo.deviceId] = deviceElements;\n\t\treturn deviceElements.root;\n\t};\n\n\tblock()\n\t{\n\t\tthis.menuBlocked = true;\n\t\tthis.elements.root.classList.add(\"bx-call-view-device-selector-menu-container-blocked\");\n\t};\n\n\tunblock()\n\t{\n\t\tthis.menuBlocked = false;\n\t\tthis.elements.root.classList.remove(\"bx-call-view-device-selector-menu-container-blocked\");\n\t};\n\n\tgetDeviceIconClass()\n\t{\n\t\tvar result = \"\";\n\t\tif (this.deviceEnabled && this.icons.length > 0)\n\t\t{\n\t\t\tresult = this.icons[0];\n\t\t}\n\t\telse if (!this.deviceEnabled && this.icons.length > 1)\n\t\t{\n\t\t\tresult = this.icons[1];\n\t\t}\n\t\treturn result;\n\t};\n\n\tonSwitchToggled()\n\t{\n\t\tif (this.menuBlocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deviceEnabled = !this.deviceEnabled;\n\t\tthis.elements.switchIcon.className = \"bx-call-view-device-selector-device-icon \" + this.getDeviceIconClass();\n\n\t\tthis.eventEmitter.emit(DeviceMenuEvents.onSwitch, {\n\t\t\tdeviceEnabled: this.deviceEnabled\n\t\t})\n\t};\n\n\tonMenuItemClick(e)\n\t{\n\t\tvar currentDevice = this.selectedDevice;\n\t\tvar selectedDevice = e.currentTarget.dataset.deviceId;\n\n\t\tthis.selectedDevice = selectedDevice;\n\t\tif (this.elements.menuItems[currentDevice])\n\t\t{\n\t\t\tthis.elements.menuItems[currentDevice]['icon'].classList.remove('selected');\n\t\t}\n\t\tif (this.elements.menuItems[this.selectedDevice])\n\t\t{\n\t\t\tthis.elements.menuItems[this.selectedDevice]['icon'].classList.add('selected');\n\t\t}\n\n\t\tthis.eventEmitter.emit(DeviceMenuEvents.onSelect, {\n\t\t\tdeviceId: this.selectedDevice\n\t\t})\n\t};\n}\n","import { Extension } from 'main.core';\nimport { CopilotNotifyType } from './view/copilot-notify';\n\n\nexport type CallAiOptions = {\n\tserviceEnabled?: boolean;\n\tsettingsEnabled?: boolean;\n\trecordingMinUsers?: number;\n\tagreementAccepted?: boolean;\n\ttariffAvailable?: boolean;\n\tbaasAvailable?: boolean;\n\tfeedBackLink?: string;\n\tbaasPromoSlider?: string;\n\thelpSlider?: string;\n};\n\nexport const CallAiError = {\n\tAI_UNAVAILABLE_ERROR: 'AI_UNAVAILABLE_ERROR',\n\tAI_SETTINGS_ERROR: 'AI_SETTINGS_ERROR',\n\tAI_AGREEMENT_ERROR: 'AI_AGREEMENT_ERROR',\n\tAI_NOT_ENOUGH_BAAS_ERROR: 'AI_NOT_ENOUGH_BAAS_ERROR',\n};\n\nclass CallAi\n{\n\tconstructor()\n\t{\n\t\tthis.serviceEnabled = false;\n\t\tthis.settingsEnabled = false;\n\t\tthis.recordingMinUsers = 1000;\n\t\tthis.agreementAccepted = false;\n\t\tthis.tariffAvailable = false;\n\t\tthis.baasAvailable = false;\n\t\tthis.feedBackLink = '';\n\t\tthis.baasPromoSlider = '';\n\t\tthis.helpSlider = '';\n\n\t\tif (Extension.getSettings('call.core').ai)\n\t\t{\n\t\t\tthis.setup(Extension.getSettings('call.core').ai);\n\t\t}\n\t}\n\n\tsetup(options: CallAiOptions)\n\t{\n\t\tif (options.serviceEnabled !== undefined)\n\t\t{\n\t\t\tthis.serviceEnabled = options.serviceEnabled;\n\t\t}\n\t\tif (options.settingsEnabled !== undefined)\n\t\t{\n\t\t\tthis.settingsEnabled = options.settingsEnabled;\n\t\t}\n\t\tif (options.recordingMinUsers)\n\t\t{\n\t\t\tthis.recordingMinUsers = options.recordingMinUsers;\n\t\t}\n\t\tif (options.agreementAccepted !== undefined)\n\t\t{\n\t\t\tthis.agreementAccepted = options.agreementAccepted;\n\t\t}\n\t\tif (options.tariffAvailable !== undefined)\n\t\t{\n\t\t\tthis.tariffAvailable = options.tariffAvailable;\n\t\t}\n\t\tif (options.baasAvailable !== undefined)\n\t\t{\n\t\t\tthis.baasAvailable = options.baasAvailable;\n\t\t}\n\t\tif (options.feedBackLink)\n\t\t{\n\t\t\tthis.feedBackLink = options.feedBackLink;\n\t\t}\n\t\tif (options.baasPromoSlider)\n\t\t{\n\t\t\tthis.baasPromoSlider = options.baasPromoSlider;\n\t\t}\n\t\tif (options.helpSlider)\n\t\t{\n\t\t\tthis.helpSlider = options.helpSlider;\n\t\t}\n\t}\n\n\tget serviceEnabled(): boolean\n\t{\n\t\treturn this._serviceEnabled;\n\t}\n\tset serviceEnabled(flag: boolean)\n\t{\n\t\tthis._serviceEnabled = flag;\n\t}\n\n\tget settingsEnabled(): boolean\n\t{\n\t\treturn this._settingsEnabled;\n\t}\n\tset settingsEnabled(flag: boolean)\n\t{\n\t\tthis._settingsEnabled = flag;\n\t}\n\n\tget recordingMinUsers(): number\n\t{\n\t\treturn this._recordingMinUsers;\n\t}\n\tset recordingMinUsers(value: number)\n\t{\n\t\tthis._recordingMinUsers = value;\n\t}\n\n\tget agreementAccepted(): boolean\n\t{\n\t\treturn this._agreementAccepted;\n\t}\n\tset agreementAccepted(flag: boolean)\n\t{\n\t\tthis._agreementAccepted = flag;\n\t}\n\n\tget tariffAvailable(): boolean\n\t{\n\t\treturn this._tariffAvailable;\n\t}\n\tset tariffAvailable(flag: boolean)\n\t{\n\t\tthis._tariffAvailable = flag;\n\t}\n\n\tget baasAvailable(): boolean\n\t{\n\t\treturn this._baasAvailable;\n\t}\n\tset baasAvailable(flag: boolean)\n\t{\n\t\tthis._baasAvailable = flag;\n\t}\n\n\tget feedBackLink(): string\n\t{\n\t\treturn this._feedBackLink;\n\t}\n\tset feedBackLink(value: string)\n\t{\n\t\tthis._feedBackLink = value;\n\t}\n\n\tget baasPromoSlider(): string\n\t{\n\t\treturn this._baasPromoSlider;\n\t}\n\tset baasPromoSlider(value: string)\n\t{\n\t\tthis._baasPromoSlider = value;\n\t}\n\n\tget helpSlider(): string\n\t{\n\t\treturn this._helpSlider;\n\t}\n\tset helpSlider(value: string)\n\t{\n\t\tthis._helpSlider = value;\n\t}\n\n\thandleCopilotError(errorType: string)\n\t{\n\t\tswitch (errorType)\n\t\t{\n\t\t\tcase CallAiError.AI_UNAVAILABLE_ERROR:\n\t\t\t\tthis.tariffAvailable = false;\n\t\t\t\tbreak;\n\t\t\tcase CallAiError.AI_SETTINGS_ERROR:\n\t\t\t\tthis.settingsEnabled = false;\n\t\t\t\tbreak;\n\t\t\tcase CallAiError.AI_AGREEMENT_ERROR:\n\t\t\t\tthis.agreementAccepted = false;\n\t\t\t\tbreak;\n\t\t\tcase CallAiError.AI_NOT_ENOUGH_BAAS_ERROR:\n\t\t\t\tthis.baasAvailable = false;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.error('there are no such errorTypes');\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport const CallAI = new CallAi();","import {Type} from 'main.core';\nimport {Menu, MenuManager} from 'main.popup';\n\nexport class UserSelector\n{\n\tconstructor(config)\n\t{\n\t\tthis.userList = config.userList;\n\t\tthis.current = config.current;\n\t\tthis.parentElement = config.parentElement;\n\t\tthis.zIndex = config.zIndex;\n\n\t\tthis.menu = null;\n\n\t\tthis.callbacks = {\n\t\t\tonSelect: Type.isFunction(config.onSelect) ? config.onSelect : BX.DoNothing\n\t\t}\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new UserSelector(config);\n\t}\n\n\tshow()\n\t{\n\t\tlet menuItems = [];\n\n\t\tthis.userList.forEach((user) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: user.id,\n\t\t\t\ttext: user.name || \"unknown (\" + user.id + \")\",\n\t\t\t\tclassName: (this.current == user.id ? \"menu-popup-item-accept\" : \"device-selector-empty\"),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.close();\n\t\t\t\t\tthis.callbacks.onSelect(user.id);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.menu = new Menu({\n\t\t\tid: 'call-view-select-user',\n\t\t\tbindElement: this.parentElement,\n\t\t\titems: menuItems,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tangle: false,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.popupWindow.destroy();\n\t\t\t\t\tMenuManager.destroy('call-view-select-device');\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.menu.popupWindow.show();\n\t}\n}","import {Browser, Dom, Runtime, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport { CopilotNotify, CopilotNotifyType } from './copilot-notify';\n\nimport {UserModel, UserRegistry} from './user-registry'\nimport * as Buttons from './buttons';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport {CallUserMobile, MobileMenu, MobileSlider, UserSelectorMobile} from './mobile';\nimport {CallUser} from './call-user';\nimport {Hardware} from '../hardware';\nimport {FloorRequest} from './floor-request';\nimport {NotificationManager} from './notifications';\nimport {DeviceSelector} from './device-selector';\nimport {EndpointDirection, UserState} from '../engine/engine';\nimport Util from '../util';\nimport { CallAI } from '../call_ai';\nimport { Utils } from 'im.v2.lib.utils';\nimport {UserSelector} from './user-selector';\n\nimport '../css/view.css';\n\nconst Layouts = {\n\tGrid: 1,\n\tCentered: 2,\n\tMobile: 3\n};\n\nconst RerenderReason = {\n\tVideoEnabled: 'videoEnabled',\n\tVideoDisabled: 'videoDisabled',\n\tUserDisconnected: 'userDisconnected',\n};\n\nconst SwapType = {\n\tDirect: 'direct',\n\tReplace: 'replace',\n};\n\nconst UiState = {\n\tPreparing: 1,\n\tInitializing: 2,\n\tCalling: 3,\n\tConnected: 4,\n\tError: 5\n};\n\nconst Size = {\n\tFolded: 'folded',\n\tFull: 'full'\n};\n\nconst RecordState = {\n\tStarted: 'started',\n\tResumed: 'resumed',\n\tPaused: 'paused',\n\tStopped: 'stopped'\n};\n\nconst RecordType = {\n\tNone: 'none',\n\tVideo: 'video',\n\tAudio: 'audio',\n};\n\nconst RoomState = {\n\tNone: 1,\n\tSpeaker: 2,\n\tNonSpeaker: 3,\n}\n\nconst EventName = {\n\tonShow: 'onShow',\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonButtonClick: 'onButtonClick',\n\tonBodyClick: 'onBodyClick',\n\tonReplaceCamera: 'onReplaceCamera',\n\tonReplaceMicrophone: 'onReplaceMicrophone',\n\tonReplaceSpeaker: 'onReplaceSpeaker',\n\tonSetCentralUser: 'onSetCentralUser',\n\tonLayoutChange: 'onLayoutChange',\n\tonChangeHdVideo: 'onChangeHdVideo',\n\tonChangeMicAutoParams: 'onChangeMicAutoParams',\n\tonChangeFaceImprove: 'onChangeFaceImprove',\n\tonUserClick: 'onUserClick',\n\tonUserRename: 'onUserRename',\n\tonUserPinned: 'onUserPinned',\n\tonDeviceSelectorShow: 'onDeviceSelectorShow',\n\tonOpenAdvancedSettings: 'onOpenAdvancedSettings',\n\tonHasMainStream: 'onHasMainStream',\n\tonToggleSubscribe: 'onToggleSubscribe'\n};\n\nconst beginingPosition = -1;\nconst newUserPosition = 999;\nconst addButtonPosition = 1001;\n\nconst MIN_WIDTH = 250;\n\nconst SIDE_USER_WIDTH = 160; // keep in sync with .bx-messenger-videocall-user-block .bx-messenger-videocall-user width\nconst SIDE_USER_HEIGHT = 90; // keep in sync with .bx-messenger-videocall-user height\n\nconst MAX_USERS_PER_PAGE = 19;\nconst MIN_GRID_USER_WIDTH = 180;\nconst MIN_GRID_USER_HEIGHT = 100;\n\nconst CHANGE_VIDEO_RERENDER_DELAY = 3000;\nconst WAITING_VIDEO_DELAY = 3000;\n\ntype ViewOptions = {\n\ttitle: ?string,\n\tcontainer: HTMLElement,\n\tbaseZIndex: number,\n\tcameraId: string,\n\tmicrophoneId: string,\n\tshowChatButtons: boolean,\n\tshowUsersButton: boolean,\n\tshowShareButton: boolean,\n\tshowRecordButton: boolean,\n\tshowDocumentButton: boolean,\n\tshowButtonPanel: boolean,\n\tbroadcastingMode: boolean,\n\tbroadcastingPresenters: number[],\n\tlanguage: string,\n\tuserData: {},\n\tuserLimit: number,\n\tisIntranetOrExtranet: boolean,\n\tmediaSelectionBlocked: boolean,\n\tblockedButtons: string[],\n\thiddenButtons: string[],\n\thiddenTopButtons: string[],\n\tuiState: string,\n\tlayout: string,\n\tuserStates: {},\n\tshowAddUserButtonInList?: boolean,\n\tisCopilotFeaturesEnabled: boolean,\n\tisCopilotActive: boolean,\n}\n\nexport class View\n{\n\tcentralUser: CallUser\n\tcallMenu: ?MobileMenu\n\tparticipantsMenu: ?MobileMenu\n\tpinnedUser: ?CallUser\n\tuserMenu: ?MobileMenu\n\tuserRegistry: UserRegistry\n\tusers: { [key: number]: CallUser; }\n\tscreenUsers: { [key: number]: CallUser; }\n\n\tconstructor(config: ViewOptions)\n\t{\n\t\tthis.title = config.title;\n\t\tthis.container = config.container;\n\t\tthis.baseZIndex = config.baseZIndex;\n\t\tthis.cameraId = config.cameraId;\n\t\tthis.microphoneId = config.microphoneId;\n\n\t\tthis.speakerId = '';\n\t\tthis.speakerMuted = false;\n\t\tthis.showChatButtons = (config.showChatButtons === true);\n\t\tthis.showUsersButton = (config.showUsersButton === true);\n\t\tthis.showShareButton = (config.showShareButton !== false);\n\t\tthis.showRecordButton = (config.showRecordButton !== false);\n\t\tthis.showDocumentButton = (config.showDocumentButton !== false);\n\t\tthis.showCopilotButton = (config.showCopilotButton !== false);\n\t\tthis.showButtonPanel = (config.showButtonPanel !== false);\n\t\tthis.showAddUserButtonInList = config.showAddUserButtonInList || false;\n\n\t\tthis.limitation = null;\n\t\tthis.inactiveUsers = [];\n\t\tthis.activeUsers = [];\n\t\tthis.rerenderTimeout = null;\n\t\tthis.waitingForUserMediaTimeouts = new Map();\n\t\tthis.rerenderQueue = new Map();\n\t\tthis.shelvedRerenderQueue = new Map();\n\n\t\tthis.broadcastingMode = BX.prop.getBoolean(config, \"broadcastingMode\", false);\n\t\tthis.broadcastingPresenters = BX.prop.getArray(config, \"broadcastingPresenters\", []);\n\n\t\tthis.currentPage = 1;\n\t\tthis.pagesCount = 1;\n\n\t\tthis.usersPerPage = 0; // initializes after rendering and on resize\n\n\t\tthis.language = config.language || '';\n\n\t\tthis.lastPosition = 1;\n\n\t\tthis.userData = {};\n\t\tif (config.userData)\n\t\t{\n\t\t\tthis.updateUserData(config.userData);\n\t\t}\n\t\tthis.userLimit = config.userLimit || 1;\n\t\tthis.userId = BX.message('USER_ID');\n\t\tthis.isIntranetOrExtranet = BX.prop.getBoolean(config, \"isIntranetOrExtranet\", true);\n\t\tthis.users = {}; // Call participants. The key is the user id.\n\t\tthis.screenUsers = {}; // Screen sharing participants. The key is the user id.\n\t\tthis.userRegistry = new UserRegistry();\n\n\t\tlet localUserModel = new UserModel({\n\t\t\tid: this.userId,\n\t\t\tstate: BX.prop.getString(config, \"localUserState\", UserState.Connected),\n\t\t\tlocalUser: true,\n\t\t\torder: beginingPosition,\n\t\t\tname: this.userData[this.userId] ? this.userData[this.userId].name : '',\n\t\t\tavatar: this.userData[this.userId] ? this.userData[this.userId].avatar_hr : '',\n\t\t});\n\t\tthis.userRegistry.push(localUserModel);\n\n\t\tthis.localUser = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: localUserModel,\n\t\t\tallowBackgroundItem: BackgroundDialog.isAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowMaskItem: BackgroundDialog.isMaskAvailable() && this.isIntranetOrExtranet,\n\t\t\tonUserRename: this._onUserRename.bind(this),\n\t\t\tonUserRenameInputFocus: this._onUserRenameInputFocus.bind(this),\n\t\t\tonUserRenameInputBlur: this._onUserRenameInputBlur.bind(this),\n\t\t\tonClick: this._onUserClick.bind(this),\n\t\t\tonPin: this._onUserPin.bind(this),\n\t\t\tonUnPin: this._onUserUnPin.bind(this),\n\t\t});\n\n\t\tthis.centralUser = this.localUser; //show local user until someone is connected\n\t\tthis.centralUserMobile = null;\n\t\tthis.pinnedUser = null;\n\t\tthis.presenterId = null;\n\n\t\tthis.returnToGridAfterScreenStopped = false;\n\n\t\tthis.mediaSelectionBlocked = (config.mediaSelectionBlocked === true);\n\n\t\tthis.visible = false;\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\twrap: null,\n\t\t\twatermark: null,\n\t\t\tcontainer: null,\n\t\t\toverlay: null,\n\t\t\ttopPanel: null,\n\t\t\tbottom: null,\n\t\t\tnotificationPanel: null,\n\t\t\tpanel: null,\n\t\t\taudioContainer: null,\n\t\t\tscreenAudioContainer: null,\n\t\t\taudio: {\n\t\t\t\t// userId: <audio> for this user's stream\n\t\t\t},\n\t\t\tscreenAudio: {\n\t\t\t\t// userId: <audio> for this user's stream\n\t\t\t},\n\t\t\tcenter: null,\n\t\t\tlocalUserMobile: null,\n\t\t\tuserBlock: null,\n\t\t\tear: {\n\t\t\t\tleft: null,\n\t\t\t\tright: null\n\t\t\t},\n\t\t\tuserList: {\n\t\t\t\tcontainer: null,\n\t\t\t\taddButton: null\n\t\t\t},\n\t\t\tuserSelectorContainer: null,\n\t\t\tpinnedUserContainer: null,\n\t\t\trenameSlider: {\n\t\t\t\tinput: null,\n\t\t\t\tbutton: null\n\t\t\t},\n\t\t\tpageNavigatorLeft: null,\n\t\t\tpageNavigatorLeftCounter: null,\n\t\t\tpageNavigatorRight: null,\n\t\t\tpageNavigatorRightCounter: null,\n\t\t};\n\n\t\tthis.buttons = {\n\t\t\ttitle: null,\n\t\t\tgrid: null,\n\t\t\tadd: null,\n\t\t\tshare: null,\n\t\t\trecord: null,\n\t\t\tdocument: null,\n\t\t\tcopilot: null,\n\t\t\tmicrophone: null,\n\t\t\tcamera: null,\n\t\t\tspeaker: null,\n\t\t\tscreen: null,\n\t\t\tmobileMenu: null,\n\t\t\tchat: null,\n\t\t\tusers: null,\n\t\t\thistory: null,\n\t\t\thangup: null,\n\t\t\tfullscreen: null,\n\t\t\toverlay: null,\n\t\t\tstatus: null,\n\t\t\treturnToCall: null,\n\t\t\trecordStatus: null,\n\t\t\tparticipants: null,\n\t\t\tparticipantsMobile: null,\n\t\t\twatermark: null,\n\t\t\thd: null,\n\t\t\tprotected: null,\n\t\t\tmore: null,\n\t\t\thangupOptions: null,\n\t\t};\n\n\t\tthis.size = Size.Full;\n\t\tthis.maxWidth = null;\n\t\tthis.isMuted = Hardware.isMicrophoneMuted;\n\t\tthis.isCameraOn = Hardware.isCameraOn;\n\t\tthis.isFullScreen = false;\n\t\tthis.isUserBlockFolded = false;\n\n\t\tthis.recordState = this.getDefaultRecordState();\n\n\t\tthis.blockedButtons = {};\n\t\tlet configBlockedButtons = BX.prop.getArray(config, \"blockedButtons\", []);\n\t\tconfigBlockedButtons.forEach(buttonCode => this.blockedButtons[buttonCode] = true);\n\n\t\tthis.hiddenButtons = {};\n\t\tthis.overflownButtons = {};\n\t\tif (!this.showUsersButton)\n\t\t{\n\t\t\tthis.hiddenButtons['users'] = true;\n\t\t}\n\t\tlet configHiddenButtons = BX.prop.getArray(config, \"hiddenButtons\", []);\n\t\tconfigHiddenButtons.forEach(buttonCode => this.hiddenButtons[buttonCode] = true);\n\n\t\tthis.hiddenTopButtons = {};\n\t\tlet configHiddenTopButtons = BX.prop.getArray(config, \"hiddenTopButtons\", []);\n\t\tconfigHiddenTopButtons.forEach(buttonCode => this.hiddenTopButtons[buttonCode] = true);\n\n\t\tthis.uiState = config.uiState || UiState.Calling;\n\t\tthis.layout = config.layout || Layouts.Centered;\n\t\tthis.whiteSpaceInUserGrid = 0;\n\t\tthis.roomState = RoomState.None;\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'BX.Call.View');\n\n\t\tthis.scrollInterval = 0;\n\n\t\t// Event handlers\n\t\tthis._onFullScreenChangeHandler = this._onFullScreenChange.bind(this);\n\t\t//this._onResizeHandler = BX.throttle(this._onResize.bind(this), 500);\n\t\tthis._onResizeHandler = this._onResize.bind(this);\n\t\tthis._onOrientationChangeHandler = BX.debounce(this._onOrientationChange.bind(this), 500);\n\t\tthis._onKeyDownHandler = this._onKeyDown.bind(this);\n\t\tthis._onKeyUpHandler = this._onKeyUp.bind(this);\n\n\t\tthis.resizeObserver = new BX.ResizeObserver(this._onResizeHandler);\n\t\tthis.intersectionObserver = null;\n\n\t\t// timers\n\t\tthis.switchPresenterTimeout = 0;\n\n\t\tthis.deviceSelector = null;\n\t\tthis.userSelector = null;\n\t\tthis.pinnedUserContainer = null;\n\n\t\tthis.renameSlider = null;\n\n\t\tthis.userSize = {width: 0, height: 0};\n\n\t\tthis.hintManager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tclassName: 'bx-messenger-videocall-panel-item-hotkey-hint',\n\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\tangle: false\n\t\t\t}\n\t\t});\n\n\t\tthis.hotKey = {\n\t\t\tall: Util.isDesktop(),\n\t\t\tmicrophone: true,\n\t\t\tmicrophoneSpace: true,\n\t\t\tcamera: true,\n\t\t\tscreen: true,\n\t\t\trecord: true,\n\t\t\tspeaker: true,\n\t\t\tchat: true,\n\t\t\tusers: true,\n\t\t\tfloorRequest: true,\n\t\t\tmuteSpeaker: true,\n\t\t\tgrid: true,\n\t\t};\n\t\tthis.hotKeyTemporaryBlock = 0;\n\n\t\tthis._isPreparing = false;\n\t\tthis._videoRerenderDelay = 0;\n\n\t\tthis.init();\n\t\tthis.subscribeEvents(config);\n\t\tif (Type.isPlainObject(config.userStates))\n\t\t{\n\t\t\tthis.appendUsers(config.userStates);\n\t\t}\n\n\t\t/*this.resizeCalled = 0;\n\t\tthis.reportResizeCalled = BX.debounce(function()\n\t\t{\n\t\t\tconsole.log('resizeCalled ' + this.resizeCalled + ' times');\n\t\t\tthis.resizeCalled = 0;\n\t\t}.bind(this), 100)*/\n\n\t\tthis.hideEarTimer = null;\n\n\t\tthis.isCopilotFeaturesEnabled = config.isCopilotFeaturesEnabled || false;\n\t\tthis.isCopilotActive = config.isCopilotActive || false;\n\t\tthis.copilotNotify = null;\n\t};\n\n\topenArticle(articleCode)\n\t{\n\t\tconst infoHelper = BX.UI.InfoHelper;\n\n\t\tif (infoHelper.isOpen())\n\t\t{\n\t\t\tinfoHelper.close()\n\t\t}\n\n\t\tinfoHelper.show(articleCode);\n\t}\n\n\tonClickButtonWithLimit(limitObj, handle)\n\t{\n\t\tconst {enabled, articleCode} = limitObj;\n\n\t\tif (enabled && typeof handle === \"function\") {\n\t\t\thandle()\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!enabled && articleCode) {\n\t\t\tthis.openArticle(articleCode)\n\t\t}\n\t}\n\n\tgetLimitation()\n\t{\n\t\tthis.limitation = Util.getCallFeatures();\n\t}\n\n\tgetLimitationByType(type)\n\t{\n\t\tconst defaultLimitation = {enable: true};\n\n\t\tconst currentLimitation = this.limitation?.[`call_${type}`];\n\n\t\tif (!currentLimitation) {\n\t\t\treturn defaultLimitation;\n\t\t}\n\n\t\treturn {\n\t\t\tenabled: currentLimitation.enable,\n\t\t\tarticleCode: currentLimitation.articleCode\n\t\t}\n\t}\n\n\tgetBackgroundLimitation()\n\t{\n\t\treturn this.getLimitationByType('background')\n\t}\n\n\tgetBackgroundBlurLimitation()\n\t{\n\t\treturn this.getLimitationByType('background_blur')\n\t}\n\n\tgetRecordLimitation()\n\t{\n\t\treturn this.getLimitationByType('record')\n\t}\n\n\tgetScreenSharingLimitation()\n\t{\n\t\treturn this.getLimitationByType('screen_sharing')\n\t}\n\n\tisDesktopCall()\n\t{\n\t\treturn DesktopApi.isDesktop();\n\t}\n\tcheckAvailableBackgroundImage()\n\t{\n\t\tif (!this.isDesktopCall())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {id: backgroundId} = DesktopApi.getBackgroundImage();\n\n\t\tif (!backgroundId || backgroundId === 'none') {\n\t\t\tDesktopApi.setCallBackground('none', 'none')\n\t\t}\n\t}\n\n\ttoggleVisibilityEar()\n\t{\n\t\tif (this.hideEarTimer)\n\t\t{\n\t\t\tclearTimeout(this.hideEarTimer);\n\t\t\tthis.hideEarTimer = null;\n\t\t}\n\n\t\tthis.elements.ear.top?.classList.add(\"force-visible\");\n\t\tthis.elements.ear.bottom?.classList.add(\"force-visible\");\n\t\tthis.elements.pageNavigatorLeft?.classList.add(\"force-visible\");\n\t\tthis.elements.pageNavigatorRight?.classList.add(\"force-visible\");\n\n\t\tthis.hideEarTimer = setTimeout(() =>\n\t\t{\n\t\t\tthis.elements.ear.top?.classList.remove(\"force-visible\");\n\t\t\tthis.elements.ear.bottom?.classList.remove(\"force-visible\");\n\t\t\tthis.elements.pageNavigatorLeft?.classList.remove(\"force-visible\");\n\t\t\tthis.elements.pageNavigatorRight?.classList.remove(\"force-visible\");\n\t\t}, 5000);\n\t}\n\n\tinit()\n\t{\n\t\tthis.getLimitation();\n\t\tthis.checkAvailableBackgroundImage();\n\n\t\tif (this.isFullScreenSupported())\n\t\t{\n\t\t\tif (Browser.isChrome() || Browser.isSafari())\n\t\t\t{\n\t\t\t\twindow.addEventListener(\"fullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t\twindow.addEventListener(\"webkitfullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t}\n\t\t\telse if (Browser.isFirefox())\n\t\t\t{\n\t\t\t\twindow.addEventListener(\"mozfullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t}\n\t\t}\n\t\tif (Browser.isMobile())\n\t\t{\n\t\t\tdocument.documentElement.style.setProperty('--view-height', window.innerHeight + 'px');\n\t\t\twindow.addEventListener(\"orientationchange\", this._onOrientationChangeHandler);\n\t\t}\n\n\t\tthis.elements.audioContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-audio-container\"}\n\t\t});\n\n\t\tthis.elements.screenAudioContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-audio-container\"}\n\t\t});\n\n\t\tif (Hardware.initialized)\n\t\t{\n\t\t\tthis.setSpeakerId(Hardware.defaultSpeaker);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHardware.subscribe(Hardware.Events.initialized, function ()\n\t\t\t{\n\t\t\t\tthis.setSpeakerId(Hardware.defaultSpeaker);\n\t\t\t}.bind(this))\n\t\t}\n\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setCameraState);\n\n\t\twindow.addEventListener(\"keydown\", this._onKeyDownHandler);\n\t\twindow.addEventListener(\"keyup\", this._onKeyUpHandler);\n\n\t\tthis.onMouseMoveHandler = this.toggleVisibilityEar.bind(this);\n\t\tdocument.addEventListener('mousemove', this.onMouseMoveHandler);\n\n\t\tif (Browser.isMac())\n\t\t{\n\t\t\tthis.keyModifier = '&#8984; + Shift';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.keyModifier = 'Ctrl + Shift';\n\t\t}\n\n\t\tthis.container.appendChild(this.elements.audioContainer);\n\t\tthis.container.appendChild(this.elements.screenAudioContainer);\n\t};\n\n\tget isPreparing()\n\t{\n\t\treturn this._isPreparing;\n\t};\n\n\tset isPreparing(isPreparing)\n\t{\n\t\tthis._isPreparing = !!isPreparing;\n\t};\n\n\t// for testing different delay values\n\tget videoRerenderDelay()\n\t{\n\t\treturn this._videoRerenderDelay > 0 ? this._videoRerenderDelay : CHANGE_VIDEO_RERENDER_DELAY;\n\t};\n\n\tset videoRerenderDelay(videoRerenderDelay)\n\t{\n\t\tthis._videoRerenderDelay = videoRerenderDelay;\n\t};\n\n\tsubscribeEvents(config)\n\t{\n\t\tfor (let event in EventName)\n\t\t{\n\t\t\tif (EventName.hasOwnProperty(event) && Type.isFunction(config[event]))\n\t\t\t{\n\t\t\t\tthis.setCallback(event, config[event]);\n\t\t\t}\n\t\t}\n\t};\n\n\tsetCallback(name, cb)\n\t{\n\t\tif (Type.isFunction(cb) && EventName.hasOwnProperty(name))\n\t\t{\n\t\t\tthis.eventEmitter.subscribe(name, function (event)\n\t\t\t{\n\t\t\t\tcb(event.data);\n\t\t\t});\n\t\t}\n\t};\n\n\tsubscribe(eventName, listener)\n\t{\n\t\treturn this.eventEmitter.subscribe(eventName, listener);\n\t};\n\n\tunsubscribe(eventName, listener)\n\t{\n\t\treturn this.eventEmitter.unsubscribe(eventName, listener);\n\t};\n\n\tgetNextPosition()\n\t{\n\t\treturn this.lastPosition++;\n\t};\n\n\t/**\n\t * @param {object} userStates {userId -> state}\n\t */\n\tappendUsers(userStates)\n\t{\n\t\tif (!Type.isPlainObject(userStates))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet userIds = Object.keys(userStates);\n\t\tfor (let i = 0; i < userIds.length; i++)\n\t\t{\n\t\t\tlet userId = userIds[i];\n\t\t\tthis.addUser(userId, userStates[userId] ? userStates[userId] : UserState.Idle);\n\t\t}\n\t};\n\n\tsetCentralUser(userId)\n\t{\n\t\tif (this.centralUser.id == userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.users[userId] && userId != this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst previousCentralUser = this.centralUser;\n\t\tthis.centralUser = (userId == this.userId ? this.localUser : this.users[userId]);\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tif (this.layout == Layouts.Mobile)\n\t\t\t{\n\t\t\t\tpreviousCentralUser.dismount();\n\t\t\t}\n\t\t\tthis.updateUserList();\n\t\t}\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tif (this.centralUserMobile)\n\t\t\t{\n\t\t\t\tthis.centralUserMobile.setUserModel(this.userRegistry.get(userId));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.centralUserMobile = new CallUserMobile({\n\t\t\t\t\tuserModel: this.userRegistry.get(userId),\n\t\t\t\t\tonClick: () => this.showUserMenu(this.centralUser.id)\n\t\t\t\t})\n\t\t\t\tthis.centralUserMobile.mount(this.elements.pinnedUserContainer);\n\t\t\t}\n\t\t}\n\t\tthis.userRegistry.users.forEach(userModel => userModel.centralUser = (userModel.id == userId));\n\t\tthis.eventEmitter.emit(EventName.onSetCentralUser, {\n\t\t\tuserId: userId,\n\t\t\tstream: userId == this.userId ? this.localUser.stream : this.users[userId].stream\n\t\t})\n\t};\n\n\tgetLeftUser(userId)\n\t{\n\t\tlet candidateUserId = null;\n\t\tfor (let i = 0; i < this.userRegistry.users.length; i++)\n\t\t{\n\t\t\tconst userModel = this.userRegistry.users[i];\n\t\t\tif (userModel.id == userId && candidateUserId)\n\t\t\t{\n\t\t\t\treturn candidateUserId\n\t\t\t}\n\n\t\t\tif (!userModel.localUser && userModel.state == UserState.Connected)\n\t\t\t{\n\t\t\t\tcandidateUserId = userModel.id\n\t\t\t}\n\t\t}\n\n\t\treturn candidateUserId;\n\t};\n\n\tgetRightUser(userId)\n\t{\n\t\tlet candidateUserId = null;\n\t\tfor (let i = this.userRegistry.users.length - 1; i >= 0; i--)\n\t\t{\n\t\t\tconst userModel = this.userRegistry.users[i];\n\t\t\tif (userModel.id == userId && candidateUserId)\n\t\t\t{\n\t\t\t\treturn candidateUserId\n\t\t\t}\n\n\t\t\tif (!userModel.localUser && userModel.state == UserState.Connected)\n\t\t\t{\n\t\t\t\tcandidateUserId = userModel.id\n\t\t\t}\n\t\t}\n\n\t\treturn candidateUserId;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.users).length;\n\t};\n\n\tgetConnectedUserCount(withYou)\n\t{\n\t\tlet count = this.getConnectedUsers().length;\n\n\t\tif (withYou)\n\t\t{\n\t\t\tconst userId = parseInt(this.userId);\n\t\t\tif (!this.broadcastingMode || this.broadcastingPresenters.includes(userId))\n\t\t\t{\n\t\t\t\tcount += 1;\n\t\t\t}\n\t\t}\n\n\t\treturn count;\n\t};\n\n\tgetUsersWithVideo()\n\t{\n\t\tlet result = [];\n\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users[userId].hasVideo())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetConnectedUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let i = 0; i < this.userRegistry.users.length; i++)\n\t\t{\n\t\t\tconst userModel = this.userRegistry.users[i];\n\t\t\tif (userModel.id != this.userId && userModel.state == UserState.Connected)\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetDisplayedUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let i = 0; i < this.userRegistry.users.length; i++)\n\t\t{\n\t\t\tconst userModel = this.userRegistry.users[i];\n\t\t\tif (userModel.id != this.userId && (userModel.id != this.centralUser.id && this.layout === Layouts.Centered || this.layout !== Layouts.Centered) && (userModel.state == UserState.Connected || userModel.state == UserState.Connecting || userModel.state == UserState.Calling))\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetActiveUsers()\n\t{\n\t\tconst result = [];\n\t\tfor (let i = 0; i < this.userRegistry.users.length; i++)\n\t\t{\n\t\t\tconst userModel = this.userRegistry.users[i];\n\t\t\tif (this.isUserHasActiveState(userModel) && this.users.hasOwnProperty(userModel.id))\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetUsersWithCamera()\n\t{\n\t\t// since we don't receive streams from inactive pages\n\t\t// we can't use this.getUsersWithVideo() to get number of users with video\n\t\treturn this.userRegistry.users.filter(el =>\n\t\t{\n\t\t\treturn el.id != this.userId && el.cameraState && this.isUserHasActiveState(el) && el.state !== UserState.Calling;\n\t\t});\n\t};\n\n\thasUserWithScreenSharing()\n\t{\n\t\treturn this.userRegistry.users.some(function (userModel)\n\t\t{\n\t\t\treturn userModel.screenState;\n\t\t})\n\t};\n\n\thasCurrentUserScreenSharing()\n\t{\n\t\tconst currentUser = this.userRegistry.get(this.userId);\n\n\t\tif (currentUser)\n\t\t{\n\t\t\treturn currentUser.screenState;\n\t\t}\n\n\t\treturn false\n\t}\n\n\tgetPresenterUserId()\n\t{\n\t\tlet currentPresenterId = this.presenterId || 0;\n\t\tif (currentPresenterId == this.localUser.id)\n\t\t{\n\t\t\tcurrentPresenterId = 0;\n\t\t}\n\t\tlet userId; // for usage in iterators\n\n\t\tlet currentPresenterModel = this.userRegistry.get(currentPresenterId);\n\n\t\t// 1. Current user, who is sharing screen has top priority\n\t\tif (currentPresenterModel && currentPresenterModel.screenState === true)\n\t\t{\n\t\t\treturn currentPresenterId;\n\t\t}\n\n\t\t// 2. If current user is not sharing screen, but someone is sharing - he should become presenter\n\t\tfor (userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId) && this.userRegistry.get(userId).screenState === true)\n\t\t\t{\n\t\t\t\treturn parseInt(userId);\n\t\t\t}\n\t\t}\n\n\t\t// 3. If current user is talking, or stopped talking less then one second ago - he should stay presenter\n\t\tif (currentPresenterModel && currentPresenterModel.wasTalkingAgo() < 1000)\n\t\t{\n\t\t\treturn currentPresenterId;\n\t\t}\n\n\t\t// 4. Return currently talking user\n\t\tlet minTalkingAgo = 0;\n\t\tlet minTalkingAgoUserId = 0;\n\t\tfor (userId in this.users)\n\t\t{\n\t\t\tif (!this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst userWasTalkingAgo = this.userRegistry.get(userId).wasTalkingAgo();\n\t\t\tif (userWasTalkingAgo < 1000)\n\t\t\t{\n\t\t\t\treturn parseInt(userId);\n\t\t\t}\n\t\t\tif (userWasTalkingAgo < minTalkingAgo)\n\t\t\t{\n\t\t\t\tminTalkingAgoUserId = parseInt(userId);\n\t\t\t}\n\t\t}\n\n\t\t// 5. Return last talking user\n\t\tif (minTalkingAgoUserId)\n\t\t{\n\t\t\treturn minTalkingAgoUserId;\n\t\t}\n\n\t\t// return current user in center\n\t\treturn this.centralUser.id;\n\t};\n\n\tswitchPresenter()\n\t{\n\t\tconst currentPresenterId = this.presenterId || 0;\n\t\tconst newPresenterId = this.getPresenterUserId();\n\n\t\tif (!newPresenterId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.presenterId = newPresenterId;\n\t\tthis.userRegistry.users.forEach(userModel => userModel.presenter = (userModel.id == this.presenterId));\n\n\t\tif (this.pinnedUser === null)\n\t\t{\n\t\t\tthis.setCentralUser(newPresenterId);\n\n\t\t\tif (this.layout == Layouts.Centered && currentPresenterId !== newPresenterId)\n\t\t\t{\n\t\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\t\tuserId: this.centralUser.id\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (currentPresenterId !== newPresenterId)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\tuserId: this.centralUser.id\n\t\t\t});\n\t\t}\n\t};\n\n\tswitchPresenterDeferred()\n\t{\n\t\tclearTimeout(this.switchPresenterTimeout);\n\t\tthis.switchPresenterTimeout = setTimeout(this.switchPresenter.bind(this), 1000);\n\t};\n\n\tcancelSwitchPresenter()\n\t{\n\t\tclearTimeout(this.switchPresenterTimeout);\n\t};\n\n\tsetUiState(uiState)\n\t{\n\t\tif (this.uiState == uiState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.uiState = uiState;\n\t\tif (this.uiState == UiState.Error && this.elements.container)\n\t\t{\n\t\t\tDom.clean(this.elements.container);\n\t\t\tthis.elements.container.appendChild(this.elements.overlay);\n\t\t}\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.updateButtons();\n\t};\n\n\tsetLayout(newLayout)\n\t{\n\t\tif (newLayout == this.layout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet useShelvedRerenderQueue = this.layout === Layouts.Centered && newLayout === Layouts.Grid;\n\n\t\tthis.layout = newLayout;\n\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-grid\");\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-centered\");\n\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\tthis.elements.container.appendChild(this.elements.userBlock);\n\n\t\t\tif (this.layout != Layouts.Mobile)\n\t\t\t{\n\t\t\t\tthis.elements.userBlock.appendChild(this.elements.userList.container);\n\t\t\t}\n\n\t\t\tthis.centralUser.playVideo();\n\t\t\t//this.centralUser.updateAvatarWidth();\n\t\t}\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-centered\");\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-grid\");\n\n\t\t\tthis.elements.container.appendChild(this.elements.userList.container);\n\t\t\tthis.elements.container.removeChild(this.elements.userBlock);\n\t\t\tif (this.isFullScreen && this.buttons.participants)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: Buttons.ParticipantsButton.FoldButtonState.Hidden\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.unpinUser();\n\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\tuserId: null\n\t\t\t});\n\t\t}\n\t\tif (this.layout == Layouts.Centered && this.isFullScreen)\n\t\t{\n\t\t\tthis.setUserBlockFolded(true);\n\t\t}\n\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-fullscreen-mobile\", (this.layout == Layouts.Mobile));\n\n\t\tthis.updateUserList(useShelvedRerenderQueue);\n\t\tthis.toggleEars();\n\t\tthis.updateButtons();\n\t\tthis.eventEmitter.emit(EventName.onLayoutChange, {\n\t\t\tlayout: this.layout\n\t\t});\n\t};\n\n\tsetRoomState(roomState)\n\t{\n\t\tif (this.roomState === roomState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.roomState = roomState;\n\t\tif (this.buttons.microphone)\n\t\t{\n\t\t\tthis.buttons.microphone.setSideIcon(this.getMicrophoneSideIcon(this.roomState));\n\t\t}\n\t}\n\n\tgetMicrophoneSideIcon(roomState)\n\t{\n\t\tswitch (roomState)\n\t\t{\n\t\t\tcase RoomState.Speaker:\n\t\t\t\treturn 'ellipsis';\n\t\t\tcase RoomState.NonSpeaker:\n\t\t\t\treturn 'pointer';\n\t\t\tcase RoomState.None:\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n\n\tsetCurrentPage(pageNumber)\n\t{\n\t\tif (pageNumber < 1 || pageNumber > this.pagesCount || pageNumber == this.currentPage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentPage = pageNumber;\n\n\t\tthis.recalculateUsersPerPage()\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeftCounter.innerHTML = (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t\tthis.elements.pageNavigatorRightCounter.innerHTML = (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t}\n\t\tif (!(this.layout === Layouts.Grid || this.layout === Layouts.Centered))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.renderUserList(true);\n\t\tthis.toggleEars();\n\t};\n\n\tcalculateUsersPerPage()\n\t{\n\t\tif (!this.elements.userList)\n\t\t{\n\t\t\treturn 1000;\n\t\t}\n\n\t\tconst containerSize = this.elements.userList.container.getBoundingClientRect();\n\t\tlet columns = Math.floor(containerSize.width / MIN_GRID_USER_WIDTH) || 1;\n\t\tlet rows = Math.floor(containerSize.height / MIN_GRID_USER_HEIGHT) || 1;\n\n\t\tif (this.layout === Layouts.Centered)\n\t\t{\n\t\t\tconst rowsWithoutGap = Math.floor(containerSize.height / SIDE_USER_HEIGHT) || 1;\n\t\t\tconst rowGap = 6;\n\n\t\t\tthis.whiteSpaceInUserGrid = containerSize.height - rowsWithoutGap * SIDE_USER_HEIGHT + (rowsWithoutGap - 1) * rowGap;\n\n\t\t\tcolumns = 1;\n\t\t\trows = this.whiteSpaceInUserGrid < 0 ? rowsWithoutGap - 1 : rowsWithoutGap;\n\t\t}\n\n\t\tlet usersPerPage = columns * rows - 1;\n\n\t\tif (this.userId == this.centralUser.id && this.layout === Layouts.Centered)\n\t\t{\n\t\t\tusersPerPage += 1;\n\t\t}\n\n\t\tif (!usersPerPage)\n\t\t{\n\t\t\treturn 1000;\n\t\t}\n\n\t\tif (usersPerPage <= MAX_USERS_PER_PAGE)\n\t\t{\n\t\t\treturn usersPerPage;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// check if the last row should be filled up\n\t\t\tlet elementSize = Util.findBestElementSize(\n\t\t\t\tcontainerSize.width,\n\t\t\t\tcontainerSize.height,\n\t\t\t\tMAX_USERS_PER_PAGE + 1,\n\t\t\t\tMIN_GRID_USER_WIDTH,\n\t\t\t\tMIN_GRID_USER_HEIGHT\n\t\t\t);\n\t\t\t// console.log('Optimal element size: width '+elementSize.width+' height '+elementSize.height);\n\t\t\tcolumns = Math.floor(containerSize.width / elementSize.width);\n\t\t\trows = Math.floor(containerSize.height / elementSize.height);\n\n\t\t\treturn columns * rows - 1;\n\t\t}\n\t};\n\n\tcalculatePagesCount(usersPerPage)\n\t{\n\t\tconst pages = Math.ceil((this.getDisplayedUsers().length) / usersPerPage);\n\t\treturn pages > 0 ? pages : 1;\n\t};\n\n\trecalculateUsersPerPage()\n\t{\n\t\tthis.usersPerPage = this.calculateUsersPerPage();\n\n\t\tif (this.currentPage < this.pagesCount && this.layout === Layouts.Centered && this.whiteSpaceInUserGrid > 0)\n\t\t{\n\t\t\tthis.usersPerPage = this.usersPerPage + 1;\n\t\t}\n\t}\n\n\trecalculatePages()\n\t{\n\t\tthis.usersPerPage = this.calculateUsersPerPage();\n\t\tthis.pagesCount = this.calculatePagesCount(this.usersPerPage);\n\n\t\tif (this.currentPage > this.pagesCount)\n\t\t{\n\t\t\tthis.currentPage = this.pagesCount;\n\t\t}\n\n\t\tthis.recalculateUsersPerPage();\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeftCounter.innerHTML = (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t\tthis.elements.pageNavigatorRightCounter.innerHTML = (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t}\n\t};\n\n\t/**\n\t * Returns page number, where the user is displayed, or 0 if user is not found\n\t * @param {int} userId Id of the user\n\t * @return {int}\n\t */\n\tfindUsersPage(userId)\n\t{\n\t\tif (userId == this.userId || this.usersPerPage === 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\tconst displayedUsers = this.getDisplayedUsers();\n\t\tlet userPosition = 0;\n\n\t\tfor (let i = 0; i < displayedUsers.length; i++)\n\t\t{\n\t\t\tif (displayedUsers[i] == userId)\n\t\t\t{\n\t\t\t\tuserPosition = i + 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (userPosition ? Math.ceil(userPosition / this.usersPerPage) : 0);\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.localUser.stream && this.localUser.stream.getVideoTracks().length > 0)\n\t\t{\n\t\t\tthrow new Error(\"Can not set camera id while having active stream\")\n\t\t}\n\t\tthis.cameraId = cameraId;\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.localUser.stream && this.localUser.stream.getAudioTracks().length > 0)\n\t\t{\n\t\t\tthrow new Error(\"Can not set microphone id while having active stream\")\n\t\t}\n\t\tthis.microphoneId = microphoneId;\n\t};\n\n\tsetMicrophoneLevel(level)\n\t{\n\t\tthis.microphoneLevel = level;\n\t\tthis.buttons.microphone?.setLevel(level);\n\t};\n\n\tsetCameraState = (event) =>\n\t{\n\t\tif (this.isCameraOn == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isCameraOn = event.data.isCameraOn;\n\n\t\tif (this.buttons.camera)\n\t\t{\n\t\t\tif (this.isCameraOn)\n\t\t\t{\n\t\t\t\tthis.buttons.camera.enable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.buttons.camera.disable();\n\t\t\t}\n\t\t}\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.isMuted == event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isMuted = event.data.isMicrophoneMuted\n\n\t\tif (this.buttons.microphone)\n\t\t{\n\t\t\tif (this.isMuted)\n\t\t\t{\n\t\t\t\tthis.buttons.microphone.disable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.buttons.microphone.enable();\n\t\t\t}\n\t\t}\n\t\tthis.userRegistry.get(this.userId).microphoneState = !this.isMuted;\n\t};\n\n\tsetLocalUserId(userId)\n\t{\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userId = parseInt(userId);\n\t\tthis.localUser.userModel.id = this.userId;\n\t\tthis.localUser.userModel.name = this.userData[this.userId] ? this.userData[this.userId].name : '';\n\t\tthis.localUser.userModel.avatar = this.userData[this.userId] ? this.userData[this.userId].avatar_hr : '';\n\t};\n\n\tsetUserBlockFolded(isUserBlockFolded)\n\t{\n\t\tthis.isUserBlockFolded = isUserBlockFolded;\n\n\t\tthis.elements.userBlock?.classList.toggle(\"folded\", this.isUserBlockFolded);\n\t\tthis.elements.root?.classList.toggle(\"bx-messenger-videocall-userblock-folded\", this.isUserBlockFolded);\n\t\tif (this.isUserBlockFolded)\n\t\t{\n\t\t\tif (this.buttons.participants && this.layout == Layouts.Centered)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: Buttons.ParticipantsButton.FoldButtonState.Unfold\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.buttons.participants)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: (this.isFullScreen && this.layout == Layouts.Centered) ? Buttons.ParticipantsButton.FoldButtonState.Fold : Buttons.ParticipantsButton.FoldButtonState.Hidden\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\taddUser(userId, state, direction)\n\t{\n\t\tuserId = Number(userId);\n\t\tif (this.users[userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstate = state || UserState.Idle;\n\t\tif (!direction)\n\t\t{\n\t\t\tif (this.broadcastingPresenters.length > 0 && !this.broadcastingPresenters.includes(userId))\n\t\t\t{\n\t\t\t\tdirection = EndpointDirection.RecvOnly;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdirection = EndpointDirection.SendRecv\n\t\t\t}\n\t\t}\n\n\t\tlet userModel = new UserModel({\n\t\t\tid: userId,\n\t\t\tname: this.userData[userId] ? this.userData[userId].name : '',\n\t\t\tavatar: this.userData[userId] ? this.userData[userId].avatar_hr : '',\n\t\t\tstate: state,\n\t\t\torder: state == UserState.Connected ? this.getNextPosition() : newUserPosition,\n\t\t\tdirection: direction\n\t\t});\n\n\t\tthis.userRegistry.push(userModel);\n\n\t\tif (!this.elements.audio[userId])\n\t\t{\n\t\t\tthis.elements.audio[userId] = Dom.create(\"audio\");\n\t\t\tthis.elements.audioContainer.appendChild(this.elements.audio[userId]);\n\t\t}\n\n\t\tif (!this.elements.screenAudio[userId])\n\t\t{\n\t\t\tthis.elements.screenAudio[userId] = Dom.create(\"audio\");\n\t\t\tthis.elements.screenAudioContainer.appendChild(this.elements.audio[userId]);\n\t\t}\n\n\t\tthis.users[userId] = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: userModel,\n\t\t\taudioElement: this.elements.audio[userId],\n\t\t\tscreenAudioElement: this.elements.screenAudio[userId],\n\t\t\tallowPinButton: this.getConnectedUserCount() > 1,\n\t\t\tonClick: this._onUserClick.bind(this),\n\t\t\tonPin: this._onUserPin.bind(this),\n\t\t\tonUnPin: this._onUserUnPin.bind(this),\n\t\t});\n\n\t\tthis.screenUsers[userId] = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: userModel,\n\t\t\tallowPinButton: false,\n\t\t\tscreenSharingUser: true,\n\t\t});\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.updateUserList();\n\t\t\tthis.updateButtons();\n\t\t\tthis.updateUserButtons();\n\t\t\tthis.muteSpeaker(this.speakerMuted);\n\t\t}\n\t};\n\n\tsetUserDirection(userId, direction)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user || user.direction == direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tuser.direction = direction;\n\t\tthis.updateUserList();\n\t};\n\n\tsetLocalUserDirection(direction)\n\t{\n\t\tif (this.localUser.userModel.direction != direction)\n\t\t{\n\t\t\tthis.localUser.userModel.direction = direction;\n\t\t\tthis.updateUserList();\n\t\t}\n\t};\n\n\tsetUserState(userId, newState)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (newState === UserState.Connected && this.uiState === UiState.Calling)\n\t\t{\n\t\t\tthis.setUiState(UiState.Connected);\n\t\t}\n\n\t\tuser.state = newState;\n\n\t\t// maybe switch central user\n\t\tif (this.centralUser.id == this.userId && newState == UserState.Connected)\n\t\t{\n\t\t\tthis.setCentralUser(userId);\n\t\t}\n\t\telse if (userId == this.centralUser.id)\n\t\t{\n\t\t\tif (newState == UserState.Connecting || newState == UserState.Failed)\n\t\t\t{\n\t\t\t\tthis.centralUser.blurVideo();\n\t\t\t}\n\t\t\telse if (newState == UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.centralUser.blurVideo(false);\n\t\t\t}\n\t\t\telse if (newState == UserState.Idle)\n\t\t\t{\n\t\t\t\tconst usersWithVideo = this.getUsersWithVideo();\n\t\t\t\tconst connectedUsers = this.getConnectedUsers();\n\n\t\t\t\tif (connectedUsers.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(this.userId);\n\t\t\t\t}\n\t\t\t\telse if (usersWithVideo.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(usersWithVideo[0]);\n\t\t\t\t}\n\t\t\t\telse //if (connectedUsers.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(connectedUsers[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (newState === UserState.Connected)\n\t\t{\n\t\t\tconst timer = setTimeout(() => {\n\t\t\t\tthis.waitingForUserMediaTimeouts.delete(userId);\n\t\t\t}, WAITING_VIDEO_DELAY);\n\t\t\tthis.waitingForUserMediaTimeouts.set(userId, timer);\n\t\t}\n\t\telse if (newState === UserState.Idle)\n\t\t{\n\t\t\tclearTimeout(this.waitingForUserMediaTimeouts.get(userId));\n\t\t\tthis.waitingForUserMediaTimeouts.delete(userId);\n\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\tuserId,\n\t\t\t\treason: RerenderReason.UserDisconnected,\n\t\t\t});\n\t\t}\n\n\t\tif (newState == UserState.Connected && user.order == newUserPosition)\n\t\t{\n\t\t\tuser.order = this.getNextPosition();\n\t\t}\n\t\telse if (newState == UserState.Idle)\n\t\t{\n\t\t\tthis.setUserFloorRequestState(userId, false);\n\t\t\t// reset user position to add them in the end after they reconnect\n\t\t\tuser.prevOrder = user.order;\n\t\t\tuser.order = newUserPosition;\n\t\t\tuser.prevCameraState = user.cameraState;\n\t\t\tuser.cameraState = false;\n\t\t}\n\n\t\tif (userId == this.localUser.id)\n\t\t{\n\t\t\tthis.localUser.userModel.cameraState = this.localUser.hasCameraVideo();\n\t\t}\n\n\t\tconst skippedElementsList = userId === this.localUser.id ? [] : ['panel'];\n\n\t\tthis.updateUserList();\n\t\tthis.updateButtons(skippedElementsList);\n\t\tthis.updateUserButtons();\n\t};\n\n\tsetTitle(title)\n\t{\n\t\tthis.title = title;\n\t};\n\n\tgetUserTalking(userId)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!user.talking;\n\t}\n\n\tsetUserTalking(userId, talking)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.talking = talking;\n\t\t}\n\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId == this.presenterId && !talking)\n\t\t{\n\t\t\tthis.switchPresenterDeferred();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.switchPresenter();\n\t\t}\n\n\t};\n\n\tsetUserStats(userId, stats)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].showStats(stats);\n\t\t}\n\t\tif (this.screenUsers[userId])\n\t\t{\n\t\t\tthis.screenUsers[userId].showStats(stats);\n\t\t}\n\t\tif (userId == this.localUser.id)\n\t\t{\n\t\t\tthis.localUser.showStats(stats);\n\t\t}\n\t}\n\n\tsetUserMicrophoneState(userId, isMicrophoneOn)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.microphoneState = isMicrophoneOn;\n\t\t}\n\t};\n\n\tsetUserCameraState(userId, cameraState)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.cameraState = cameraState;\n\t\t}\n\t};\n\n\tsetUserVideoPaused(userId, videoPaused)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.videoPaused = videoPaused;\n\t\t\tuser.cameraState = !videoPaused;\n\n\t\t\tif (!user.videoPaused !== videoPaused)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvideoPaused\n\t\t\t\t? this.updateRerenderQueue(userId, RerenderReason.VideoDisabled)\n\t\t\t\t: this.updateRerenderQueue(userId, RerenderReason.VideoEnabled);\n\t\t}\n\t};\n\n\tgetUserFloorRequestState(userId)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\n\t\treturn user && user.floorRequestState;\n\t};\n\n\tsetUserFloorRequestState(userId, userFloorRequestState)\n\t{\n\t\tconst user: UserModel = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (user.floorRequestState != userFloorRequestState)\n\t\t{\n\t\t\tconst userState = user?.state;\n\t\t\tconst userActive = (userState !== UserState.Idle\n\t\t\t\t&& userState !== UserState.Declined\n\t\t\t\t&& userState !== UserState.Unavailable\n\t\t\t\t&& userState !== UserState.Busy\n\t\t\t);\n\t\t\tif (userFloorRequestState && !userActive)\n\t\t\t{\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tuser.floorRequestState = userFloorRequestState;\n\t\t\tif (userId != this.localUser.id && userFloorRequestState)\n\t\t\t{\n\t\t\t\tthis.showFloorRequestNotification(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\tthis.setButtonActive('floorRequest', userFloorRequestState);\n\t\t}\n\t};\n\n\tpinUser(userId)\n\t{\n\t\tif (!(userId in this.users) && userId !== Number(this.userId))\n\t\t{\n\t\t\tconsole.error(\"User \" + userId + \" is not known\");\n\t\t\treturn;\n\t\t}\n\t\tthis.pinnedUser = !this.users[userId] ? this.localUser : this.users[userId];\n\t\tthis.userRegistry.users.forEach(userModel => userModel.pinned = userModel.id == userId);\n\t\tthis.setCentralUser(userId);\n\t\tthis.eventEmitter.emit(EventName.onUserPinned, {\n\t\t\tuserId: userId\n\t\t});\n\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\tuserId: this.centralUser.id\n\t\t});\n\t};\n\n\tunpinUser()\n\t{\n\t\tthis.pinnedUser = null;\n\t\tthis.userRegistry.users.forEach(userModel => userModel.pinned = false);\n\n\t\tthis.eventEmitter.emit(EventName.onUserPinned, {\n\t\t\tuserId: null\n\t\t});\n\t\tthis.switchPresenterDeferred();\n\t};\n\n\tshowFloorRequestNotification(userId)\n\t{\n\t\tconst userModel: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!userModel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet notification = FloorRequest.create({\n\t\t\tuserModel: userModel\n\t\t});\n\n\t\tnotification.mount(this.elements.notificationPanel);\n\t\tNotificationManager.Instance.addNotification(notification);\n\t};\n\n\tsetUserScreenState(userId, screenState)\n\t{\n\t\tconst user: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tuser.screenState = screenState;\n\t\tif (userId != this.userId)\n\t\t{\n\t\t\tif (screenState === true && this.layout === View.Layout.Grid)\n\t\t\t{\n\t\t\t\tthis.setLayout(Layouts.Centered);\n\t\t\t\tthis.returnToGridAfterScreenStopped = true;\n\t\t\t}\n\t\t\tif (screenState === false\n\t\t\t\t&& this.layout === Layouts.Centered\n\t\t\t\t&& !this.hasUserWithScreenSharing()\n\t\t\t\t&& !this.pinnedUser\n\t\t\t\t&& this.returnToGridAfterScreenStopped)\n\t\t\t{\n\t\t\t\tthis.returnToGridAfterScreenStopped = false;\n\t\t\t\tthis.setLayout(Layouts.Grid);\n\t\t\t}\n\t\t\tthis.switchPresenter();\n\t\t}\n\t};\n\n\tflipLocalVideo(flipVideo)\n\t{\n\t\tthis.localUser.flipVideo = !!flipVideo;\n\t}\n\n\tsetLocalStream(streamData)\n\t{\n\t\tconst mediaRenderer = streamData.mediaRenderer;\n\t\tconst mediaStream = streamData.stream;\n\t\tconst removed = streamData.removed;\n\t\tconst flipVideo = streamData.flipVideo;\n\t\tif (removed)\n\t\t{\n\t\t\tmediaRenderer.stream = null;\n\t\t}\n\n\t\tif (mediaRenderer) // for Bitrix calls\n\t\t{\n\t\t\tthis.localUser.videoRenderer = mediaRenderer;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localUser.videoTrack = mediaStream.getVideoTracks().length > 0 ? mediaStream.getVideoTracks()[0] : null;\n\t\t}\n\n\t\tif (!Type.isUndefined(flipVideo))\n\t\t{\n\t\t\tthis.flipLocalVideo(flipVideo);\n\t\t}\n\t\tthis.localUser.userModel.cameraState = this.localUser.hasCameraVideo();\n\n\t\tconst videoTracks = mediaStream.getVideoTracks();\n\t\tif (videoTracks.length > 0)\n\t\t{\n\t\t\tconst videoTrackSettings = videoTracks[0].getSettings();\n\t\t\tthis.cameraId = videoTrackSettings.deviceId || '';\n\t\t}\n\t\telse if (!mediaRenderer)\n\t\t{\n\t\t\tthis.cameraId = '';\n\t\t}\n\n\t\tconst audioTracks = mediaStream.getAudioTracks();\n\t\tif (audioTracks.length > 0)\n\t\t{\n\t\t\tconst audioTrackSettings = audioTracks[0].getSettings();\n\t\t\tthis.microphoneId = audioTrackSettings.deviceId || '';\n\t\t}\n\n\t\t/*if(!this.localUser.hasVideo())\n\t\t{\n\t\t\treturn false;\n\t\t}*/\n\n\t\tif (this.layout !== Layouts.Grid && this.centralUser.id == this.userId)\n\t\t{\n\t\t\tif (mediaRenderer) // for Bitrix ca;ls\n\t\t\t{\n\t\t\t\tthis.centralUser.videoRenderer = mediaRenderer;\n\t\t\t}\n\t\t\telse if (videoTracks.length > 0 || Object.keys(this.users).length === 0)\n\t\t\t{\n\t\t\t\tthis.centralUser.videoTrack = videoTracks[0];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setCentralUser(Object.keys(this.users)[0]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUserList();\n\t\t}\n\t};\n\n\tsetSpeakerId(speakerId)\n\t{\n\t\tif (this.speakerId == speakerId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!('setSinkId' in HTMLMediaElement.prototype))\n\t\t{\n\t\t\tconsole.error(\"Speaker selection is not supported\");\n\t\t}\n\n\t\tthis.speakerId = speakerId;\n\t\tfor (let userId in this.elements.audio)\n\t\t{\n\t\t\tthis.elements.audio[userId].setSinkId(this.speakerId);\n\t\t}\n\t};\n\n\tmuteSpeaker(mute)\n\t{\n\t\tthis.speakerMuted = !!mute;\n\n\t\tfor (let userId in this.elements.audio)\n\t\t{\n\t\t\tthis.elements.audio[userId].volume = this.speakerMuted ? 0 : 1;\n\t\t}\n\n\t\tif (!this.buttons.speaker)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.speakerMuted)\n\t\t{\n\t\t\tthis.buttons.speaker.disable();\n\t\t\tthis.buttons.speaker.hideArrow()\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.buttons.speaker.enable();\n\t\t\tif (Hardware.canSelectSpeaker())\n\t\t\t{\n\t\t\t\tthis.buttons.speaker.showArrow()\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateRerenderQueue(userId, reason)\n\t{\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthrow Error(\"User \" + userId + \" is not a part of this call\");\n\t\t}\n\n\t\tif (reason === RerenderReason.VideoEnabled)\n\t\t{\n\t\t\tif (this.rerenderQueue.get(userId)?.reason === RerenderReason.VideoDisabled)\n\t\t\t{\n\t\t\t\tthis.rerenderQueue.delete(userId);\n\t\t\t\tif (!this.rerenderQueue.size)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.rerenderTimeout);\n\t\t\t\t\tthis.rerenderTimeout = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.waitingForUserMediaTimeouts.has(userId))\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.waitingForUserMediaTimeouts.get(userId));\n\t\t\t\t\tthis.waitingForUserMediaTimeouts.delete(userId);\n\t\t\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\t\t\tuserId,\n\t\t\t\t\t\treason: RerenderReason.VideoEnabled,\n\t\t\t\t\t});\n\t\t\t\t\tthis.renderUserList();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (!this.rerenderTimeout)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.rerenderTimeout = setTimeout(() => {\n\t\t\t\t\t\t\tthis.renderUserList();\n\t\t\t\t\t\t}, this.videoRerenderDelay);\n\t\t\t\t\t}\n\t\t\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\t\t\tuserId,\n\t\t\t\t\t\treason: RerenderReason.VideoEnabled,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (reason === RerenderReason.VideoDisabled)\n\t\t{\n\t\t\tif (this.rerenderQueue.get(userId)?.reason === RerenderReason.VideoEnabled)\n\t\t\t{\n\t\t\t\tthis.rerenderQueue.delete(userId);\n\t\t\t\tif (!this.rerenderQueue.size)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.rerenderTimeout);\n\t\t\t\t\tthis.rerenderTimeout = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.rerenderTimeout)\n\t\t\t\t{\n\t\t\t\t\tthis.rerenderTimeout = setTimeout(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.renderUserList();\n\t\t\t\t\t}, this.videoRerenderDelay);\n\t\t\t\t}\n\n\t\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\t\tuserId,\n\t\t\t\t\treason: RerenderReason.VideoDisabled,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tsetVideoRenderer(userId, mediaRenderer)\n\t{\n\t\tconst user = this.users[userId];\n\t\tif (!user)\n\t\t{\n\t\t\tthrow Error(\"User \" + userId + \" is not a part of this call\");\n\t\t}\n\t\tif (mediaRenderer === null)\n\t\t{\n\t\t\tif (user.hasCameraVideo())\n\t\t\t{\n\t\t\t\tthis.updateRerenderQueue(userId, RerenderReason.VideoDisabled);\n\t\t\t}\n\t\t\tuser.videoRenderer = null;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!(\"render\" in mediaRenderer) || !Type.isFunction(mediaRenderer.render))\n\t\t{\n\t\t\tthrow Error(\"mediaRenderer should have method render\");\n\t\t}\n\t\tif (!(\"kind\" in mediaRenderer) || (mediaRenderer.kind !== \"video\" && mediaRenderer.kind !== \"sharing\"))\n\t\t{\n\t\t\tthrow Error(\"mediaRenderer should be of video kind\");\n\t\t}\n\n\t\tconst userHasCameraVideo = user.hasCameraVideo();\n\t\tuser.videoRenderer = mediaRenderer;\n\n\t\tif (mediaRenderer.stream && mediaRenderer.kind === 'video')\n\t\t{\n\t\t\tthis.updateRerenderQueue(userId, RerenderReason.VideoEnabled);\n\t\t}\n\t\telse if (mediaRenderer.kind === 'video')\n\t\t{\n\t\t\tif (!userHasCameraVideo)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.updateRerenderQueue(userId, RerenderReason.VideoDisabled);\n\t\t}\n\t};\n\n\tsetUserMedia(userId, kind, track)\n\t{\n\t\tif (kind === 'audio')\n\t\t{\n\t\t\tthis.users[userId].audioTrack = track;\n\t\t}\n\t\tif (kind === 'sharingAudio')\n\t\t{\n\t\t\tthis.users[userId].screenAudioTrack = track;\n\t\t}\n\t\tif (kind === 'video')\n\t\t{\n\t\t\tthis.users[userId].videoTrack = track;\n\t\t}\n\t\tif (kind === 'screen')\n\t\t{\n\t\t\tthis.screenUsers[userId].videoTrack = track;\n\t\t\tthis.updateUserList();\n\t\t\tthis.setUserScreenState(userId, track !== null);\n\t\t}\n\t};\n\n\tremoveScreenUsers()\n\t{\n\t\tfor (let userId in this.screenUsers)\n\t\t{\n\t\t\tthis.screenUsers[userId].videoTrack = null;\n\t\t}\n\t\tthis.updateUserList();\n\t};\n\n\tsetBadNetworkIndicator(userId, badNetworkIndicator)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].badNetworkIndicator = badNetworkIndicator;\n\t\t}\n\t}\n\n\tsetUserHasConnectionProblem(userId, hasConnectionProblem)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].hasConnectionProblem = hasConnectionProblem;\n\t\t}\n\t};\n\n\tsetUserConnectionQuality(userId, connectionQuality)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].connectionQuality = connectionQuality;\n\t\t}\n\n\t\tif (this.localUser.id === userId)\n\t\t{\n\t\t\tthis.localUser.connectionQuality = connectionQuality;\n\t\t}\n\t};\n\n\tapplyIncomingVideoConstraints()\n\t{\n\t\tlet userId;\n\t\tlet user: CallUser;\n\t\tif (this.layout === Layouts.Grid)\n\t\t{\n\t\t\tfor (userId in this.users)\n\t\t\t{\n\t\t\t\tuser = this.users[userId];\n\t\t\t\tuser.setIncomingVideoConstraints(this.userSize.width, this.userSize.height);\n\t\t\t}\n\t\t}\n\t\telse if (this.layout === Layouts.Centered)\n\t\t{\n\t\t\tfor (userId in this.users)\n\t\t\t{\n\t\t\t\tuser = this.users[userId];\n\t\t\t\tif (userId == this.centralUser.id)\n\t\t\t\t{\n\t\t\t\t\tconst containerSize = this.elements.center.getBoundingClientRect();\n\t\t\t\t\tuser.setIncomingVideoConstraints(Math.floor(containerSize.width), Math.floor(containerSize.height));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tuser.setIncomingVideoConstraints(SIDE_USER_WIDTH, SIDE_USER_HEIGHT);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tgetDefaultRecordState()\n\t{\n\t\treturn {\n\t\t\tstate: RecordState.Stopped,\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: []\n\t\t\t},\n\t\t};\n\t};\n\n\tsetRecordState(recordState)\n\t{\n\t\tthis.recordState = recordState;\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.update(this.recordState);\n\t\t}\n\n\t\tif (this.recordState.userId != this.userId)\n\t\t{\n\t\t\tif (this.recordState.state === RecordState.Stopped)\n\t\t\t{\n\t\t\t\tthis.unblockButtons(['record']);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.blockButtons(['record']);\n\t\t\t}\n\t\t}\n\n\t\tif (this.elements.topPanel)\n\t\t{\n\t\t\tif (this.recordState.state === RecordState.Stopped)\n\t\t\t{\n\t\t\t\tdelete (this.elements.topPanel.dataset.recordState);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.topPanel.dataset.recordState = recordState.state;\n\t\t\t}\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t}\n\t\tthis.container.appendChild(this.elements.root);\n\n\t\tif (this.layout !== Layouts.Mobile)\n\t\t{\n\t\t\tthis.startIntersectionObserver();\n\t\t}\n\t\tthis.updateButtons();\n\t\tthis.updateUserList();\n\n\t\tthis.resumeVideo();\n\t\tthis.toggleEars();\n\t\tthis.visible = true;\n\n\t\tthis.eventEmitter.emit(EventName.onShow);\n\n\t\t// We specifically disable the face improve feature to improve call quality.\n\t\tthis.disableFaceImprove();\n\t\tthis.checkPanelOverflow();\n\t};\n\n\thide()\n\t{\n\t\tthis.closeCopilotNotify();\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t}\n\t\tDom.remove(this.elements.root);\n\t\tthis.visible = false;\n\t};\n\n\tstartIntersectionObserver()\n\t{\n\t\tif (!('IntersectionObserver' in window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.intersectionObserver = new IntersectionObserver(\n\t\t\tthis._onIntersectionChange.bind(this),\n\t\t\t{\n\t\t\t\troot: this.elements.userList.container,\n\t\t\t\tthreshold: 0.5\n\t\t\t}\n\t\t);\n\t};\n\n\t/**\n\t * @param {CallUser} callUser\n\t */\n\tobserveIntersections(callUser)\n\t{\n\t\tif (this.intersectionObserver && callUser.elements.root)\n\t\t{\n\t\t\tthis.intersectionObserver.observe(callUser.elements.root);\n\t\t}\n\t};\n\n\t/**\n\t * @param {CallUser} callUser\n\t */\n\tunobserveIntersections(callUser)\n\t{\n\t\tif (this.intersectionObserver && callUser.elements.root)\n\t\t{\n\t\t\tthis.intersectionObserver.unobserve(callUser.elements.root);\n\t\t}\n\t};\n\n\tshowDeviceSelector(bindElement)\n\t{\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deviceSelector = new DeviceSelector({\n\t\t\tviewElement: this.container,\n\t\t\tparentElement: bindElement,\n\t\t\tzIndex: this.baseZIndex + 500,\n\t\t\tmicrophoneEnabled: !Hardware.isMicrophoneMuted,\n\t\t\tmicrophoneId: this.microphoneId || Hardware.defaultMicrophone,\n\t\t\tcameraEnabled: Hardware.isCameraOn,\n\t\t\tcameraId: this.cameraId,\n\t\t\tspeakerEnabled: !this.speakerMuted,\n\t\t\tspeakerId: this.speakerId,\n\t\t\tallowHdVideo: Hardware.preferHdQuality,\n\t\t\tfaceImproveEnabled: Util.isDesktop() && DesktopApi.isDesktop() && DesktopApi.getCameraSmoothingStatus(),\n\t\t\tallowFaceImprove: false,\n\t\t\tallowBackground: BackgroundDialog.isAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowMask: BackgroundDialog.isMaskAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowAdvancedSettings: typeof (BXIM) !== 'undefined' && this.isIntranetOrExtranet,\n\t\t\tswitchCameraBlocked: this.blockedButtons['camera'],\n\t\t\tswitchMicrophoneBlocked: this.blockedButtons['microphone'],\n\t\t\tevents: {\n\t\t\t\t[DeviceSelector.Events.onMicrophoneSelect]: this._onMicrophoneSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onMicrophoneSwitch]: this._onMicrophoneButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onCameraSelect]: this._onCameraSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onCameraSwitch]: this._onCameraButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onSpeakerSelect]: this._onSpeakerSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onSpeakerSwitch]: this._onSpeakerButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeHdVideo]: this._onChangeHdVideo.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeMicAutoParams]: this._onChangeMicAutoParams.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeFaceImprove]: this._onChangeFaceImprove.bind(this),\n\t\t\t\t[DeviceSelector.Events.onAdvancedSettingsClick]: () => this.eventEmitter.emit(EventName.onOpenAdvancedSettings),\n\t\t\t\t[DeviceSelector.Events.onDestroy]: () => this.deviceSelector = null,\n\t\t\t\t[DeviceSelector.Events.onShow]: () => this.eventEmitter.emit(EventName.onDeviceSelectorShow, {})\n\t\t\t}\n\t\t});\n\t\tthis.deviceSelector.show();\n\t};\n\n\tshowCallMenu()\n\t{\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_WANT_TO_SAY\"),\n\t\t\t\ticonClass: \"hand\",\n\t\t\t\tonClick: this._onMobileCallMenuFloorRequestClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_PARTICIPANTS_LIST\"),\n\t\t\t\ticonClass: \"participants\",\n\t\t\t\tonClick: this._onMobileCallMenShowParticipantsClick.bind(this)\n\t\t\t},\n\t\t\t// TODO:\n\t\t\t/*{\n\t\t\t\ttext: \"Add participant\",\n\t\t\t\ticonClass: \"add-participant\",\n\t\t\t\tonClick: function() {}\n\t\t\t},*/\n\n\t\t\t/*{ //DEBUG: mobile audio\n\t\t\t\ttext: \"Enable audio\",\n\t\t\t\ticonClass: \"\",\n\t\t\t\tonClick: function() {\n\t\t\t\t\tfor (var userId in this.elements.audio)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.users[userId].stream)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconsole.log('user ' + userId + ' stream found, trying to play');\n\t\t\t\t\t\t\tthis.elements.audio[userId].srcObject = this.users[userId].stream;\n\t\t\t\t\t\t\tthis.elements.audio[userId].play();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.callMenu.close();\n\t\t\t\t}.bind(this)\n\t\t\t},*/\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_COPY_INVITE\"),\n\t\t\t\ticonClass: \"add-participant\",\n\t\t\t\tonClick: this._onMobileCallMenuCopyInviteClick.bind(this)\n\n\t\t\t},\n\t\t\t!this.isIntranetOrExtranet\n\t\t\t\t?\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\"),\n\t\t\t\t\ticonClass: \"change-name\",\n\t\t\t\t\tonClick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callMenu.close();\n\t\t\t\t\t\tsetTimeout(this.showRenameSlider.bind(this), 100);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t:\n\t\t\t\tnull,\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CANCEL\"),\n\t\t\t\tenabled: false,\n\t\t\t\tonClick: this._onMobileCallMenuCancelClick.bind(this)\n\t\t\t}\n\t\t];\n\n\t\tthis.callMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\tonClose: () => this.callMenu.destroy(),\n\t\t\tonDestroy: () => this.callMenu = null,\n\t\t});\n\n\t\tthis.callMenu.show();\n\t};\n\n\tshowUserMenu(userId)\n\t{\n\t\tconst userModel: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!userModel)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet pinItem = null;\n\t\tif (this.pinnedUser && this.pinnedUser.id == userId)\n\t\t{\n\t\t\tpinItem = {\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_UNPIN\"),\n\t\t\t\ticonClass: \"unpin\",\n\t\t\t\tonClick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.unpinUser();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\telse if (this.userId != userId)\n\t\t{\n\t\t\tpinItem = {\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_PIN\"),\n\t\t\t\ticonClass: \"pin\",\n\t\t\t\tonClick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.pinUser(userId);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\tuserModel: userModel,\n\t\t\t\tenabled: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\tpinItem,\n\t\t\tthis.userId == userId && !this.isIntranetOrExtranet\n\t\t\t\t?\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\"),\n\t\t\t\t\ticonClass: \"change-name\",\n\t\t\t\t\tonClick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\t\tsetTimeout(this.showRenameSlider.bind(this), 100)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t:\n\t\t\t\tnull,\n\t\t\t/*{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_WRITE_TO_PRIVATE_CHAT\"),\n\t\t\t\ticonClass: \"private-chat\",\n\t\t\t\tonClick: function()\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\n\t\t\t\t\t})\n\t\t\t\t}.bind(this)\n\t\t\t},*/\n\t\t\t/*{\n\t\t\t\t// TODO:\n\t\t\t\ttext: \"Remove user\",\n\t\t\t\ticonClass: \"remove-user\"\n\t\t\t},*/\n\t\t\t{\n\t\t\t\tseparator: true\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CANCEL\"),\n\t\t\t\tenabled: false,\n\t\t\t\tonClick: () => this.userMenu.close(),\n\t\t\t}\n\t\t];\n\n\t\tthis.userMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\tonClose: () => this.userMenu.destroy(),\n\t\t\tonDestroy: () => this.userMenu = null,\n\t\t});\n\t\tthis.userMenu.show();\n\t};\n\n\tshowParticipantsMenu()\n\t{\n\t\tif (this.participantsMenu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet menuItems = [];\n\t\tmenuItems.push({\n\t\t\tuserModel: this.localUser.userModel,\n\t\t\tshowSubMenu: true,\n\t\t\tonClick: function ()\n\t\t\t{\n\t\t\t\tthis.participantsMenu.close();\n\t\t\t\tthis.showUserMenu(this.localUser.userModel.id);\n\t\t\t}.bind(this)\n\t\t});\n\t\tthis.userRegistry.users.forEach((userModel: UserModel) =>\n\t\t{\n\t\t\tif (userModel.localUser || userModel.state != UserState.Connected)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (menuItems.length > 0)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\tseparator: true\n\t\t\t\t});\n\t\t\t}\n\t\t\tmenuItems.push({\n\t\t\t\tuserModel: userModel,\n\t\t\t\tshowSubMenu: true,\n\t\t\t\tonClick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.participantsMenu.close();\n\t\t\t\t\tthis.showUserMenu(userModel.id);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.participantsMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\theader: BX.message(\"IM_M_CALL_PARTICIPANTS\").replace(\"#COUNT#\", this.getConnectedUserCount(true)),\n\t\t\tlargeIcons: true,\n\n\t\t\tonClose: function ()\n\t\t\t{\n\t\t\t\tthis.participantsMenu.destroy();\n\t\t\t}.bind(this),\n\t\t\tonDestroy: function ()\n\t\t\t{\n\t\t\t\tthis.participantsMenu = null;\n\t\t\t}.bind(this)\n\t\t});\n\n\t\tthis.participantsMenu.show();\n\t\treturn true;\n\t};\n\n\t/**\n\t * @param {Object} params\n\t * @param {string} params.text\n\t * @param {string} [params.subText]\n\t */\n\tshowMessage(params)\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t\tthis.container.appendChild(this.elements.root);\n\t\t}\n\n\t\tconst statusNode = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-status bx-messenger-videocall-user-status-wide\"},\n\t\t});\n\n\t\tif (Type.isStringFilled(params.text))\n\t\t{\n\t\t\tconst textNode = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-status-text\"},\n\t\t\t\ttext: params.text\n\t\t\t});\n\t\t\tstatusNode.appendChild(textNode);\n\t\t}\n\n\t\tif (this.elements.overlay.childElementCount)\n\t\t{\n\t\t\tDom.clean(this.elements.overlay);\n\t\t}\n\t\tthis.elements.overlay.appendChild(statusNode);\n\t};\n\n\thideMessage()\n\t{\n\t\tthis.elements.overlay.textContent = '';\n\t};\n\n\trenderErrorCallLayout()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t\tthis.container.appendChild(this.elements.root);\n\t\t}\n\n\t\tconst errorContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-error-container\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-error-container-icon-alert\"},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-error-message\"},\n\t\t\t\t\ttext: BX.message(\"CALL_CONNECTED_ERROR\"),\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-error-button-self-test\"},\n\t\t\t\t\ttext: BX.message(\"CALL_RUN_SELF_TEST\"),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.startSelfTest();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\n\t\t\t],\n\t\t})\n\n\t\tif (this.elements.overlay.childElementCount)\n\t\t{\n\t\t\tDom.clean(this.elements.overlay);\n\t\t}\n\t\tthis.elements.overlay.appendChild(errorContainer);\n\t}\n\n\t/**\n\t * @param {Object} params\n\t * @param {string} params.text\n\t * @param {string} [params.subText]\n\t */\n\tshowFatalError(params)\n\t{\n\t\tthis.renderErrorCallLayout();\n\t\tthis.setUiState(UiState.Error);\n\t\t// in some cases video elements may still be shown on the error screen, let's hide them\n\t\tthis.elements.userList.container.style.display = 'none';\n\t};\n\n\tclose()\n\t{\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.stopViewUpdate();\n\t\t}\n\t\tthis.recordState = this.getDefaultRecordState();\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tBX.remove(this.elements.root);\n\t\t}\n\n\t\tthis.visible = false;\n\t\tthis.eventEmitter.emit(EventName.onClose);\n\t};\n\n\tsetSize(size)\n\t{\n\t\tif (this.size == size)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.size = size;\n\n\t\tif (this.size == Size.Folded)\n\t\t{\n\t\t\tif (this.overflownButtonsPopup)\n\t\t\t{\n\t\t\t\tthis.overflownButtonsPopup.close();\n\t\t\t}\n\t\t\tif (this.elements.panel)\n\t\t\t{\n\t\t\t\tthis.elements.panel.classList.add('bx-messenger-videocall-panel-folded');\n\t\t\t}\n\t\t\tDom.remove(this.elements.container);\n\t\t\tDom.remove(this.elements.topPanel);\n\t\t\tthis.elements.root.style.removeProperty('max-width');\n\t\t\tthis.updateButtons();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.elements.panel)\n\t\t\t{\n\t\t\t\tthis.elements.panel.classList.remove('bx-messenger-videocall-panel-folded');\n\t\t\t}\n\t\t\tthis.elements.wrap.appendChild(this.elements.topPanel);\n\t\t\tthis.elements.wrap.appendChild(this.elements.container);\n\t\t\tif (this.maxWidth > 0)\n\t\t\t{\n\t\t\t\tthis.elements.root.style.maxWidth = Math.max(this.maxWidth, MIN_WIDTH) + 'px';\n\t\t\t}\n\t\t\tthis.updateButtons();\n\t\t\tthis.updateUserList();\n\t\t\tthis.resumeVideo();\n\t\t}\n\t};\n\n\tisButtonBlocked(buttonName)\n\t{\n\t\tswitch (buttonName)\n\t\t{\n\t\t\tcase 'camera':\n\t\t\t\treturn (this.uiState !== UiState.Preparing && this.uiState !== UiState.Connected) || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'chat':\n\t\t\t\treturn !this.showChatButtons || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'floorRequest':\n\t\t\t\treturn (this.uiState !== UiState.Connected) || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'screen':\n\t\t\t\treturn !this.showShareButton || (!this.isScreenSharingSupported() || this.isFullScreen) || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'users':\n\t\t\t\treturn !this.showUsersButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'record':\n\t\t\t\treturn !this.showRecordButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'document':\n\t\t\t\treturn !this.showDocumentButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'copilot':\n\t\t\t\treturn !this.showCopilotButton || this.blockedButtons[buttonName] === true;\n\t\t\tdefault:\n\t\t\t\treturn this.blockedButtons[buttonName] === true;\n\t\t}\n\t};\n\n\tisButtonHidden(buttonName)\n\t{\n\t\treturn this.hiddenButtons[buttonName] === true;\n\t};\n\n\tshowButton(buttonCode)\n\t{\n\t\tthis.showButtons([buttonCode]);\n\t};\n\n\thideButton(buttonCode)\n\t{\n\t\tthis.hideButtons([buttonCode]);\n\t};\n\n\t/**\n\t * @return {bool} Returns true if buttons update is required\n\t */\n\tcheckPanelOverflow()\n\t{\n\t\tconst delta = this.elements.panel.scrollWidth - this.elements.panel.offsetWidth\n\t\tconst mediumButtonMinWidth = 60; // todo: move to constants maybe? or maybe even calculate dynamically somehow?\n\t\tif (delta > 0)\n\t\t{\n\t\t\tlet countOfButtonsToHide = Math.ceil(delta / mediumButtonMinWidth);\n\t\t\tif (Object.keys(this.overflownButtons).length === 0)\n\t\t\t{\n\t\t\t\tcountOfButtonsToHide += 1;\n\t\t\t}\n\n\t\t\tconst buttons = this.getButtonList();\n\n\t\t\tfor (let i = buttons.length - 1; i > 0; i--)\n\t\t\t{\n\t\t\t\tif (buttons[i] === 'hangupOptions' || buttons[i] === 'hangup' || buttons[i] === 'close' || buttons[i] === 'more')\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.overflownButtons[buttons[i]] = true;\n\t\t\t\tcountOfButtonsToHide -= 1;\n\t\t\t\tif (!countOfButtonsToHide)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst hiddenButtonsCount = Object.keys(this.overflownButtons).length;\n\t\t\tif (hiddenButtonsCount > 0)\n\t\t\t{\n\t\t\t\tconst unusedPanelSpace = this.calculateUnusedPanelSpace();\n\t\t\t\tif (unusedPanelSpace > 320)\n\t\t\t\t{\n\t\t\t\t\tlet countOfButtonsToShow = Math.min(Math.floor(unusedPanelSpace / mediumButtonMinWidth), hiddenButtonsCount);\n\t\t\t\t\tlet buttonsLeftHidden = hiddenButtonsCount - countOfButtonsToShow;\n\t\t\t\t\tif (buttonsLeftHidden === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcountOfButtonsToShow += 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (countOfButtonsToShow == hiddenButtonsCount)\n\t\t\t\t\t{\n\t\t\t\t\t\t// show all buttons;\n\t\t\t\t\t\tthis.overflownButtons = {};\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i < countOfButtonsToShow; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdelete this.overflownButtons[Object.keys(this.overflownButtons)[0]]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to show\n\t */\n\tshowButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tif (this.hiddenButtons.hasOwnProperty(buttonName))\n\t\t\t{\n\t\t\t\tdelete this.hiddenButtons[buttonName];\n\t\t\t}\n\t\t})\n\n\t\tthis.updateButtons();\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to hide\n\t */\n\thideButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) => this.hiddenButtons[buttonName] = true);\n\t\tthis.updateButtons();\n\t};\n\n\tblockAddUser()\n\t{\n\t\tthis.blockedButtons['add'] = true;\n\n\t\tif (this.elements.userList.addButton)\n\t\t{\n\t\t\tDom.remove(this.elements.userList.addButton);\n\t\t}\n\t};\n\n\tunblockAddUser()\n\t{\n\t\tthis.blockedButtons['add'] = false;\n\n\t\tthis.updateButtons();\n\t};\n\n\tblockSwitchCamera()\n\t{\n\t\tthis.blockedButtons['camera'] = true;\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleCameraAvailability(false);\n\t\t}\n\t};\n\n\tunblockSwitchCamera()\n\t{\n\t\tdelete this.blockedButtons['camera'];\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleCameraAvailability(true);\n\t\t}\n\t};\n\n\tblockSwitchMicrophone()\n\t{\n\t\tthis.blockedButtons['microphone'] = true;\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleMicrophoneAvailability(false);\n\t\t}\n\t};\n\n\tunblockSwitchMicrophone()\n\t{\n\t\tdelete this.blockedButtons['microphone'];\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleMicrophoneAvailability(true);\n\t\t}\n\t};\n\n\tblockScreenSharing()\n\t{\n\t\tthis.blockedButtons['screen'] = true;\n\t};\n\n\tblockHistoryButton()\n\t{\n\t\tthis.blockedButtons['history'] = true;\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to block\n\t */\n\n\tblockButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array \")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tthis.blockedButtons[buttonName] = true;\n\t\t\tif (this.buttons[buttonName])\n\t\t\t{\n\t\t\t\tthis.buttons[buttonName].setBlocked(true);\n\t\t\t}\n\t\t})\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to unblock\n\t */\n\tunblockButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tdelete this.blockedButtons[buttonName];\n\t\t\tif (this.buttons[buttonName])\n\t\t\t{\n\t\t\t\tthis.buttons[buttonName].setBlocked(this.isButtonBlocked(buttonName));\n\t\t\t}\n\t\t})\n\t};\n\n\tdisableMediaSelection()\n\t{\n\t\tthis.mediaSelectionBlocked = true;\n\t};\n\n\tenableMediaSelection()\n\t{\n\t\tthis.mediaSelectionBlocked = false;\n\t\tif (this.buttons.microphone && this.isMediaSelectionAllowed())\n\t\t{\n\t\t\tthis.buttons.microphone.showArrow();\n\t\t}\n\t\tif (this.buttons.camera && this.isMediaSelectionAllowed())\n\t\t{\n\t\t\tthis.buttons.camera.showArrow();\n\t\t}\n\t};\n\n\tisMediaSelectionAllowed()\n\t{\n\t\treturn this.layout != Layouts.Mobile && (this.uiState == UiState.Preparing || this.uiState == UiState.Connected) && !this.mediaSelectionBlocked && !this.isFullScreen;\n\t};\n\n\tgetButtonList()\n\t{\n\t\tif (this.uiState == UiState.Error)\n\t\t{\n\t\t\treturn ['close'];\n\t\t}\n\t\tif (this.uiState == UiState.Initializing)\n\t\t{\n\t\t\treturn ['hangup'];\n\t\t}\n\n\t\tif (this.size == Size.Folded)\n\t\t{\n\t\t\treturn ['title', 'spacer', 'returnToCall', 'hangup'];\n\t\t}\n\n\t\tlet result = [];\n\n\t\tresult.push('microphone');\n\t\tresult.push('camera');\n\n\t\tif (this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('speaker');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.push('mobileMenu');\n\t\t}\n\n\t\tresult.push('chat');\n\t\tresult.push('users');\n\n\t\tif (this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('floorRequest');\n\t\t\tresult.push('screen');\n\t\t\tresult.push('record');\n\t\t\tresult.push('document');\n\t\t}\n\n\t\tif (this.layout !== Layouts.Mobile && CallAI.serviceEnabled)\n\t\t{\n\t\t\tresult.push('copilot');\n\t\t}\n\n\t\tresult = result.filter((buttonCode) =>\n\t\t{\n\t\t\treturn !this.hiddenButtons.hasOwnProperty(buttonCode) && !this.overflownButtons.hasOwnProperty(buttonCode);\n\t\t});\n\n\t\tif (Object.keys(this.overflownButtons).length > 0)\n\t\t{\n\t\t\tresult.push('more');\n\t\t}\n\n\t\tif (this.uiState == UiState.Preparing)\n\t\t{\n\t\t\tresult.push('close');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.push('hangup');\n\t\t}\n\n\t\tif (!this.hiddenButtons.hasOwnProperty('hangupOptions') && this.isIntranetOrExtranet)\n\t\t{\n\t\t\tresult.push('hangupOptions');\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetTopButtonList()\n\t{\n\t\tlet result = [];\n\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\treturn ['participantsMobile'];\n\t\t}\n\t\tresult.push('watermark');\n\t\tresult.push('protected');\n\t\tresult.push('recordStatus');\n\t\tresult.push('spacer');\n\n\t\tlet separatorNeeded = false;\n\t\tif (this.uiState === UiState.Connected && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('grid');\n\t\t}\n\n\t\tif (this.uiState != UiState.Preparing && this.isFullScreenSupported() && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('fullscreen');\n\t\t}\n\n\t\tif (this.uiState === UiState.Connected && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('feedback');\n\t\t}\n\n\t\tif (this.uiState != UiState.Preparing)\n\t\t{\n\t\t\tif (separatorNeeded)\n\t\t\t{\n\t\t\t\tresult.push('separator');\n\t\t\t}\n\t\t\tresult.push('participants');\n\t\t}\n\n\t\tlet previousButtonCode = '';\n\t\tresult = result.filter((buttonCode) =>\n\t\t{\n\t\t\tif (previousButtonCode === 'spacer' && buttonCode === 'separator')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tpreviousButtonCode = buttonCode;\n\n\t\t\treturn !this.hiddenTopButtons.hasOwnProperty(buttonCode);\n\t\t});\n\n\t\treturn result;\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.wrap = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: `bx-messenger-videocall-wrap ${this.isCopilotActive ? 'bx-messenger-videocall-wrap-with-copilot' : ''}`},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.container = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-inner\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.center = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-central-user\"},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\ttouchstart: this._onCenterTouchStart.bind(this),\n\t\t\t\t\t\t\t\t\t\ttouchend: this._onCenterTouchEnd.bind(this),\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pageNavigatorLeft = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator left\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.pageNavigatorLeftCounter = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-counter left\"},\n\t\t\t\t\t\t\t\t\t\t\thtml: (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-icon left\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onLeftPageNavigatorClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pageNavigatorRight = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator right\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.pageNavigatorRightCounter = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-counter right\"},\n\t\t\t\t\t\t\t\t\t\t\thtml: (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-icon right\"}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onRightPageNavigatorClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.topPanel = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-panel\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.notificationPanel = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-notification-panel\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.bottom = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.userSelectorContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom-user-selector-container\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pinnedUserContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom-pinned-user-container\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this._onBodyClick.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.showButtonPanel)\n\t\t{\n\t\t\tthis.elements.panel = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-panel\"},\n\t\t\t});\n\t\t\tthis.elements.bottom.appendChild(this.elements.panel);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-no-button-panel\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.userSelector = new UserSelectorMobile({\n\t\t\t\tuserRegistry: this.userRegistry\n\t\t\t});\n\t\t\tthis.userSelector.mount(this.elements.userSelectorContainer);\n\n\t\t\tthis.elements.ear.left = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-videocall-mobile-ear left\"\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this._onLeftEarClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.elements.ear.right = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-videocall-mobile-ear right\"\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this._onRightEarClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.elements.localUserMobile = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-local-user-mobile\"}\n\t\t\t});\n\n\t\t\tif (window.innerHeight < window.innerWidth)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add(\"orientation-landscape\");\n\t\t\t}\n\n\t\t\tthis.elements.wrap.appendChild(this.elements.ear.left);\n\t\t\tthis.elements.wrap.appendChild(this.elements.ear.right);\n\t\t\tthis.elements.wrap.appendChild(this.elements.localUserMobile);\n\t\t}\n\n\t\tthis.centralUser.mount(this.elements.center);\n\n\t\tthis.elements.overlay = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-overlay\"}\n\t\t});\n\n\t\tthis.elements.userBlock = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-block\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.ear.top = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear bx-messenger-videocall-ear-top\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear-icon\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this._onTopPageNavigatorClick.bind(this)\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.ear.bottom = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear bx-messenger-videocall-ear-bottom\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear-icon\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this._onBottomPageNavigatorClick.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.userList.container = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-list\"\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tscroll: Runtime.debounce(this.toggleEars.bind(this), 300),\n\t\t\t\twheel: (e) => this.elements.userList.container.scrollTop += e.deltaY\n\t\t\t}\n\t\t});\n\n\t\tthis.elements.userList.addButton = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-add\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-add-inner\"}\n\t\t\t\t})\n\t\t\t],\n\t\t\tstyle: {\n\t\t\t\torder: addButtonPosition\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: this._onAddButtonClick.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\tuserId: this.centralUser.id\n\t\t\t});\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-centered\");\n\t\t\tif (this.layout != Layouts.Mobile)\n\t\t\t{\n\t\t\t\tthis.elements.container.appendChild(this.elements.userBlock);\n\t\t\t}\n\t\t}\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-grid\");\n\t\t}\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-fullscreen-mobile\");\n\t\t}\n\n\t\tthis.resizeObserver.observe(this.elements.root);\n\t\tthis.resizeObserver.observe(this.container);\n\t\treturn this.elements.root;\n\t};\n\n\ttoggleSubscribingVideoInRenderUserList(participantIds, showVideo)\n\t{\n\t\tif (!!participantIds.length)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onToggleSubscribe, {\n\t\t\t\tparticipantIds: participantIds,\n\t\t\t\tshowVideo: showVideo\n\t\t\t});\n\t\t}\n\t}\n\n\tgetOrderingRules()\n\t{\n\t\tconst rules = {\n\t\t\tvideoEnabled: [],\n\t\t\tvideoDisabled: [],\n\t\t\tuserDisconnected: null,\n\t\t};\n\n\t\tthis.rerenderQueue.forEach((el) =>\n\t\t{\n\t\t\tif (el.reason === RerenderReason.UserDisconnected)\n\t\t\t{\n\t\t\t\trules.userDisconnected = {\n\t\t\t\t\tid: el.userId,\n\t\t\t\t\torder: this.userRegistry.get(el.userId).prevOrder,\n\t\t\t\t};\n\t\t\t}\n\t\t\telse if (el.reason === RerenderReason.VideoEnabled)\n\t\t\t{\n\t\t\t\trules.videoEnabled.push({\n\t\t\t\t\tid: el.userId,\n\t\t\t\t\torder: this.userRegistry.get(el.userId).order,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (el.reason === RerenderReason.VideoDisabled)\n\t\t\t{\n\t\t\t\trules.videoDisabled.push({\n\t\t\t\t\tid: el.userId,\n\t\t\t\t\torder: this.userRegistry.get(el.userId).order,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.rerenderQueue.clear();\n\t\trules.videoEnabled.sort((a, b) => a.order - b.order);\n\t\trules.videoDisabled.sort((a, b) => a.order - b.order);\n\n\t\treturn rules;\n\t};\n\n\tapplyOrderChanges(changes)\n\t{\n\t\tif (!Type.isArray(changes))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tchanges.forEach(change =>\n\t\t{\n\t\t\tif (change.type === SwapType.Direct)\n\t\t\t{\n\t\t\t\tchange.to.userModel.order = change.to.order;\n\t\t\t}\n\t\t\telse if (change.type === SwapType.Replace && change.to && change.from)\n\t\t\t{\n\t\t\t\tchange.to.userModel.order = change.from.order;\n\t\t\t\tchange.to.userModel.prevOrder = 0;\n\t\t\t\tchange.from.userModel.order = change.to.order;\n\t\t\t}\n\t\t});\n\t};\n\n\tisUserHasActiveState(userModel)\n\t{\n\t\treturn (userModel.state !== UserState.Idle\n\t\t\t&& userModel.state !== UserState.Declined\n\t\t\t&& userModel.state !== UserState.Unavailable\n\t\t\t&& userModel.state !== UserState.Busy\n\t\t\t&& userModel.direction !== EndpointDirection.RecvOnly\n\t\t);\n\t};\n\n\tprocessVideoRules(rules, params)\n\t{\n\t\tconst diffBetweenChanges = rules.videoEnabled.length - rules.videoDisabled.length;\n\t\tconst lessChangesField = diffBetweenChanges > 0 ? 'videoDisabled' : 'videoEnabled';\n\t\tconst moreChangesField = diffBetweenChanges > 0 ? 'videoEnabled' : 'videoDisabled';\n\n\t\tif (rules.videoEnabled.length && rules.videoDisabled.length)\n\t\t{\n\t\t\trules[lessChangesField].forEach((el, index) =>\n\t\t\t{\n\t\t\t\tconst toUser = this.userRegistry.get(el.id);\n\t\t\t\tconst fromUser = this.userRegistry.get(rules[moreChangesField][index].id);\n\n\t\t\t\tparams.orderChanges.push({\n\t\t\t\t\ttype: SwapType.Replace,\n\t\t\t\t\tto: {\n\t\t\t\t\t\tuserModel: fromUser,\n\t\t\t\t\t\torder: fromUser.order,\n\t\t\t\t\t},\n\t\t\t\t\tfrom: {\n\t\t\t\t\t\tuserModel: toUser,\n\t\t\t\t\t\torder: toUser.order,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.applyOrderChanges(params.orderChanges);\n\t\tparams.orderChanges.length = 0;\n\n\t\tif (diffBetweenChanges !== 0)\n\t\t{\n\t\t\trules[moreChangesField].splice(0, rules[moreChangesField].length - Math.abs(diffBetweenChanges));\n\t\t\trules[lessChangesField].length = 0;\n\n\t\t\tif (moreChangesField === 'videoEnabled')\n\t\t\t{\n\t\t\t\trules.videoEnabled.forEach((el) =>\n\t\t\t\t{\n\t\t\t\t\tparams.orderChanges.push({\n\t\t\t\t\t\ttype: SwapType.Replace,\n\t\t\t\t\t\tfrom: {\n\t\t\t\t\t\t\tuserModel: this.userRegistry.get(el.id),\n\t\t\t\t\t\t\torder: this.userRegistry.get(el.id).order,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tparams.incompleteSwaps.push(params.orderChanges.length);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\trules.videoEnabled.length = 0;\n\t\t\trules.videoDisabled.length = 0;\n\t\t}\n\t};\n\n\tprocessDisconnectRules(rules, params)\n\t{\n\t\tif (!rules.userDisconnected)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.userRegistry.get(rules.userDisconnected.id);\n\n\t\tif (userModel.prevCameraState)\n\t\t{\n\t\t\tparams.disconnectedUserHadVideo = true;\n\t\t}\n\t};\n\n\tcompleteVideoEnableSwap(userModel, rules, params)\n\t{\n\t\tconst swapRemains = params.incompleteSwaps.length;\n\n\t\tif (userModel.state === UserState.Calling)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\telse if (params.usersWithEnabledVideo.includes(userModel.id))\n\t\t{\n\t\t\tparams.incompleteSwaps.pop();\n\t\t\tparams.usersWithEnabledVideo.splice(params.usersWithEnabledVideo.indexOf(userModel.id), 1);\n\t\t\tparams.usersToKeepActive.push(userModel.id);\n\t\t}\n\t\telse if (!userModel.cameraState)\n\t\t{\n\t\t\tconst index = params.incompleteSwaps[swapRemains - 1] - 1;\n\t\t\tconst userEnabledVideo = params.orderChanges[index].from;\n\t\t\tconst currenUserFromCurrentPage = params.possibleActiveUsers?.includes(userModel.id);\n\t\t\tconst changedUserFromCurrentPage = params.possibleActiveUsers?.includes(userEnabledVideo.userModel.id);\n\t\t\tconst skipDeactivation = changedUserFromCurrentPage || (currenUserFromCurrentPage && changedUserFromCurrentPage);\n\n\t\t\tparams.orderChanges[index].to = {\n\t\t\t\tuserModel,\n\t\t\t\torder: userModel.order,\n\t\t\t};\n\n\t\t\tif (!skipDeactivation)\n\t\t\t{\n\t\t\t\tparams.currentPageUsers.pop();\n\t\t\t\tparams.usersToDeactivate++;\n\t\t\t}\n\t\t\telse if (changedUserFromCurrentPage && !currenUserFromCurrentPage)\n\t\t\t{\n\t\t\t\tparams.usersToForceDeactivation.push(userEnabledVideo.userModel.id);\n\t\t\t}\n\t\t\telse if (currenUserFromCurrentPage && changedUserFromCurrentPage)\n\t\t\t{\n\t\t\t\tparams.usersToKeepActive.push(userModel.id);\n\t\t\t}\n\n\t\t\tparams.incompleteSwaps.pop();\n\t\t}\n\t};\n\n\tcompleteVideoDisabledSwap(rules, params)\n\t{\n\t\tlet usersProceed = 0;\n\n\t\trules.videoDisabled.forEach((el, index) =>\n\t\t{\n\t\t\tconst userWithoutVideo = this.userRegistry.get(el.id);\n\t\t\tconst userWithoutVideoIndex = params.activeUsers.indexOf(el.id);\n\t\t\tconst userWithoutVideoPage = Math.ceil((userWithoutVideoIndex + 1) / this.usersPerPage);\n\t\t\tconst skipUsers = (userWithoutVideoPage - 1) * this.usersPerPage;\n\t\t\tconst numberOfUsersWithVideoForSwap = params.usersWithVideo.length - skipUsers;\n\t\t\tconst userToSwap = params.usersWithVideo[params.usersWithVideo.length - 1 - index];\n\t\t\tconst canCompleteVideoSwap = userToSwap && userToSwap.order > el.order;\n\n\t\t\tif (canCompleteVideoSwap && (numberOfUsersWithVideoForSwap - usersProceed >= rules.videoDisabled.length - index))\n\t\t\t{\n\t\t\t\tusersProceed++;\n\t\t\t\tparams.orderChanges.push({\n\t\t\t\t\ttype: SwapType.Replace,\n\t\t\t\t\tto: {\n\t\t\t\t\t\tuserModel: userWithoutVideo,\n\t\t\t\t\t\torder: userWithoutVideo.order,\n\t\t\t\t\t},\n\t\t\t\t\tfrom: {\n\t\t\t\t\t\tuserModel: userToSwap,\n\t\t\t\t\t\torder: userToSwap.order,\n\t\t\t\t\t},\n\t\t\t\t})\n\n\t\t\t\tconst userToSwapIndex = params.activeUsers.indexOf(userToSwap.id);\n\t\t\t\tconst userToSwapPage = Math.ceil((userToSwapIndex + 1) / this.usersPerPage);\n\n\t\t\t\tif (userWithoutVideoPage === this.currentPage && userToSwapPage > this.currentPage)\n\t\t\t\t{\n\t\t\t\t\tparams.usersToKeepActive.push(userToSwap.id);\n\t\t\t\t\tparams.usersToForceDeactivation.push(el.id);\n\t\t\t\t\tparams.usersToDeactivate++;\n\t\t\t\t}\n\t\t\t\telse if (userToSwapPage === this.currentPage && userToSwapPage > userWithoutVideoPage)\n\t\t\t\t{\n\t\t\t\t\tparams.usersToKeepActive.push(el.id);\n\t\t\t\t\tparams.usersToForceDeactivation.push(userToSwap.id);\n\t\t\t\t\tparams.usersToDeactivate++;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tcalculateUserActive(userModel, status, userSkipped, params)\n\t{\n\t\tif (params.usersWithEnabledVideo.includes(userModel.id) && !userSkipped && !params.possibleActiveUsers.includes(userModel.id))\n\t\t{\n\t\t\tparams.currentPageUsers.push(userModel);\n\t\t\tparams.usersToDeactivate--;\n\t\t\tstatus = true;\n\t\t}\n\t\telse if (params.currentPageUsers.length + params.usersToDeactivate > this.usersPerPage)\n\t\t{\n\t\t\tparams.currentPageUsers.pop();\n\t\t\tstatus = false;\n\t\t}\n\n\t\treturn status;\n\t};\n\n\tcompleteDisconnectSwap(rules, params)\n\t{\n\t\tconst lowerOrderOnCurrentPage = this.userRegistry.get(params.possibleActiveUsers[0])?.order;\n\t\tconst higherOrderOnCurrentPage = this.userRegistry.get(params.possibleActiveUsers[params.possibleActiveUsers.length - 1])?.order;\n\t\tlet disconnectedUserFromCurrentPage = false;\n\t\tif (this.currentPage === 1)\n\t\t{\n\t\t\tdisconnectedUserFromCurrentPage = rules.userDisconnected.order < lowerOrderOnCurrentPage || (rules.userDisconnected.order > lowerOrderOnCurrentPage && rules.userDisconnected.order < higherOrderOnCurrentPage);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst skipUsers = this.currentPage > 1 ? (this.currentPage - 2) * this.usersPerPage : 0;\n\t\t\tconst activeUsersFromPreviousPage = params.activeUsers.slice(skipUsers, skipUsers + this.usersPerPage);\n\t\t\tconst lastActiveUserFromPreviousPage = this.userRegistry.get(activeUsersFromPreviousPage[activeUsersFromPreviousPage.length - 1]);\n\t\t\tdisconnectedUserFromCurrentPage = (rules.userDisconnected.order > lowerOrderOnCurrentPage && rules.userDisconnected.order < higherOrderOnCurrentPage)\n\t\t\t\t|| (rules.userDisconnected.order < lowerOrderOnCurrentPage && rules.userDisconnected.order > lastActiveUserFromPreviousPage?.order);\n\t\t}\n\n\t\tconst userToSwap = params.disconnectedUserHadVideo\n\t\t\t? params.usersWithVideo[params.usersWithVideo.length - 1]\n\t\t\t: this.userRegistry.get(params.activeUsers[params.activeUsers.length - 1]);\n\n\t\tif (!userToSwap || userToSwap.order <= rules.userDisconnected.order)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tparams.orderChanges.push({\n\t\t\ttype: SwapType.Direct,\n\t\t\tto: {\n\t\t\t\tuserModel: userToSwap,\n\t\t\t\torder: rules.userDisconnected.order,\n\t\t\t},\n\t\t});\n\n\t\tif (this.currentPage !== this.pagesCount && disconnectedUserFromCurrentPage && !params.possibleActiveUsers.includes(userToSwap.id))\n\t\t{\n\t\t\tparams.usersToKeepActive.push(userToSwap.id);\n\t\t\tparams.usersToDeactivate++;\n\t\t}\n\t};\n\n\trenderAddUserButtonInList()\n\t{\n\t\tconst showAdd = this.showAddUserButtonInList && this.layout == Layouts.Centered && this.uiState === UiState.Connected && !this.isButtonBlocked(\"add\") && this.getConnectedUserCount() < this.userLimit - 1 && !this.isFullScreen && this.elements.userList.addButton;\n\n\t\tif (showAdd)\n\t\t{\n\t\t\tthis.elements.userList.container.appendChild(this.elements.userList.addButton);\n\t\t\treturn;\n\t\t}\n\n\t\tDom.remove(this.elements.userList.addButton);\n\t};\n\n\trenderUserList(pageChange)\n\t{\n\t\tclearTimeout(this.rerenderTimeout);\n\t\tthis.rerenderTimeout = null;\n\t\tthis.activeUsers = [];\n\t\tthis.inactiveUsers = [];\n\n\t\tconst showLocalUser = this.shouldShowLocalUser();\n\t\tlet userCount = 0;\n\t\tlet skipUsers = 0;\n\t\tlet skippedUsers = 0;\n\t\tlet renderedUsers = 0;\n\n\t\tconst orderingRules = this.getOrderingRules();\n\t\tconst orderingParams = {\n\t\t\tusersWithVideo: [],\n\t\t\tusersWithEnabledVideo: [],\n\t\t\tusersWithDisabledVideo: [],\n\t\t\tpossibleActiveUsers: null,\n\t\t\tusersToKeepActive: [],\n\t\t\tusersToForceDeactivation: [],\n\t\t\tcurrentPageUsers: [],\n\t\t\torderChanges: [],\n\t\t\tincompleteSwaps: [],\n\t\t\tdisconnectedUserHadVideo: false,\n\t\t\tusersToDeactivate: 0,\n\t\t\tvideoDisabledProceed: false,\n\t\t};\n\n\t\tif ((this.layout === Layouts.Grid || this.layout === Layouts.Centered) && this.pagesCount > 1)\n\t\t{\n\t\t\tskipUsers = (this.currentPage - 1) * this.usersPerPage;\n\t\t}\n\n\t\tif (this.layout === Layouts.Grid)\n\t\t{\n\t\t\tthis.processVideoRules(orderingRules, orderingParams);\n\t\t\tthis.processDisconnectRules(orderingRules, orderingParams);\n\t\t\torderingParams.usersWithEnabledVideo = orderingRules.videoEnabled.map(el => el.id);\n\t\t\torderingParams.usersWithDisabledVideo = orderingRules.videoDisabled.map(el => el.id);\n\n\t\t\torderingParams.activeUsers = this.getActiveUsers();\n\t\t\torderingParams.possibleActiveUsers = orderingParams.activeUsers.slice(skipUsers, skipUsers + this.usersPerPage);\n\t\t\torderingParams.usersWithVideo = this.getUsersWithCamera();\n\n\t\t\tthis.completeVideoDisabledSwap(orderingRules, orderingParams);\n\t\t\tif (orderingRules.userDisconnected)\n\t\t\t{\n\t\t\t\tthis.completeDisconnectSwap(orderingRules, orderingParams);\n\t\t\t}\n\t\t}\n\t\telse if (this.layout === Layouts.Centered)\n\t\t{\n\t\t\t// new grid logic is applied only in the Layouts.Grid layout\n\t\t\t// so we need to save some rules for later\n\t\t\torderingRules.videoEnabled.forEach(user => this.shelvedRerenderQueue.set(user.id, {\n\t\t\t\tuserId: user.id,\n\t\t\t\treason: RerenderReason.VideoEnabled,\n\t\t\t}));\n\t\t\torderingRules.videoDisabled.forEach(user => this.shelvedRerenderQueue.set(user.id, {\n\t\t\t\tuserId: user.id,\n\t\t\t\treason: RerenderReason.VideoDisabled,\n\t\t\t}));\n\t\t}\n\n\t\tfor (let i = 0; i < this.userRegistry.users.length; i++)\n\t\t{\n\t\t\tconst userModel: UserModel = this.userRegistry.users[i];\n\t\t\tconst userId = userModel.id;\n\t\t\tif (!this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst user: CallUser = this.users[userId];\n\t\t\tconst screenUser: CallUser = this.screenUsers[userId];\n\t\t\tif (userId == this.centralUser.id && (this.layout == Layouts.Centered || this.layout == Layouts.Mobile))\n\t\t\t{\n\t\t\t\tif (this.layout == Layouts.Centered)\n\t\t\t\t{\n\t\t\t\t\tthis.activeUsers.push(userId);\n\t\t\t\t}\n\t\t\t\tthis.unobserveIntersections(user);\n\t\t\t\tif (screenUser.hasVideo())\n\t\t\t\t{\n\t\t\t\t\tscreenUser.mount(this.elements.center);\n\t\t\t\t\tscreenUser.visible = true;\n\t\t\t\t\tuser.mount(this.elements.userList.container);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tuser.visible = true;\n\t\t\t\t\tuser.mount(this.elements.center);\n\t\t\t\t\tscreenUser.dismount();\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet userActive = this.isUserHasActiveState(userModel);\n\t\t\tlet userSkipped = false;\n\n\t\t\tif (userActive && skipUsers > 0 && skippedUsers < skipUsers)\n\t\t\t{\n\t\t\t\t// skip users on previous pages\n\t\t\t\tskippedUsers++;\n\t\t\t\tuserActive = false;\n\t\t\t\tuserSkipped = true;\n\t\t\t}\n\n\t\t\tif (userActive && this.layout === Layouts.Grid && this.usersPerPage > 0 && renderedUsers < this.usersPerPage)\n\t\t\t{\n\t\t\t\torderingParams.currentPageUsers.push(userModel);\n\t\t\t}\n\n\t\t\tif (this.layout === Layouts.Grid)\n\t\t\t{\n\t\t\t\tif (orderingRules.videoEnabled.length)\n\t\t\t\t{\n\t\t\t\t\tif ((userActive || userSkipped) && orderingParams.incompleteSwaps.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst previousIncompleteSwaps = orderingParams.incompleteSwaps.length;\n\t\t\t\t\t\tconst index = orderingParams.incompleteSwaps[0] - 1;\n\t\t\t\t\t\tconst userEnabledVideo = orderingParams.orderChanges[index].from;\n\t\t\t\t\t\tconst currentUserFromCurrentPage = orderingParams.possibleActiveUsers?.includes(userModel.id);\n\t\t\t\t\t\tconst changedUserFromCurrentPage = orderingParams.possibleActiveUsers?.includes(userEnabledVideo.userModel.id);\n\t\t\t\t\t\tconst currentUserFromNextPage = userModel.order > orderingParams.possibleActiveUsers[orderingParams.possibleActiveUsers.length-1].order;\n\n\t\t\t\t\t\tthis.completeVideoEnableSwap(userModel, orderingRules, orderingParams);\n\t\t\t\t\t\tconst swapCompleted = previousIncompleteSwaps !== orderingParams.incompleteSwaps.length;\n\n\t\t\t\t\t\tif (swapCompleted && userActive && !changedUserFromCurrentPage && !orderingParams.usersToKeepActive.includes(userModel.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (swapCompleted && ((!userSkipped && !currentUserFromCurrentPage) || (userSkipped && changedUserFromCurrentPage)))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserActive = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (orderingParams.usersToDeactivate)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = this.calculateUserActive(userModel, userActive, userSkipped, orderingParams);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (orderingParams.usersToForceDeactivation.includes(userModel.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (orderingRules.videoDisabled.length)\n\t\t\t\t{\n\t\t\t\t\tif (orderingParams.usersToKeepActive.includes(userModel.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = true;\n\t\t\t\t\t\torderingParams.usersToDeactivate--;\n\t\t\t\t\t}\n\t\t\t\t\telse if (orderingParams.usersToForceDeactivation.includes(userModel.id)\n\t\t\t\t\t\t|| (orderingParams.currentPageUsers.length + orderingParams.usersToDeactivate > this.usersPerPage)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t\torderingParams.currentPageUsers.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (orderingRules.userDisconnected)\n\t\t\t\t{\n\t\t\t\t\tif (orderingParams.usersToKeepActive.includes(userModel.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = true;\n\t\t\t\t\t\torderingParams.usersToDeactivate--;\n\t\t\t\t\t}\n\t\t\t\t\telse if (orderingParams.currentPageUsers.length + orderingParams.usersToDeactivate > this.usersPerPage)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t\torderingParams.currentPageUsers.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (userActive && (this.layout === Layouts.Grid || this.layout === Layouts.Centered) && this.usersPerPage > 0 && renderedUsers >= this.usersPerPage)\n\t\t\t{\n\t\t\t\t// skip users on following pages\n\t\t\t\tuserActive = false;\n\t\t\t}\n\n\t\t\tif (userActive)\n\t\t\t{\n\t\t\t\tthis.activeUsers.push(userId)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.inactiveUsers.push(userId)\n\t\t\t}\n\n\t\t\tif (!userActive)\n\t\t\t{\n\t\t\t\tuser.dismount();\n\t\t\t\tthis.unobserveIntersections(user);\n\t\t\t\tscreenUser.dismount();\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (screenUser.hasVideo())\n\t\t\t{\n\t\t\t\tscreenUser.mount(this.elements.userList.container);\n\t\t\t\tuserCount++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tscreenUser.dismount();\n\t\t\t}\n\t\t\tuser.mount(this.elements.userList.container);\n\t\t\tif (!this.isPreparing)\n\t\t\t{\n\t\t\t\tthis.observeIntersections(user);\n\t\t\t}\n\t\t\trenderedUsers++;\n\t\t\tuserCount++;\n\t\t}\n\n\t\tthis.applyOrderChanges(orderingParams.orderChanges);\n\n\t\tif (showLocalUser)\n\t\t{\n\t\t\tif (this.layout == Layouts.Centered && this.userId == this.centralUser.id || this.layout == Layouts.Mobile)\n\t\t\t{\n\t\t\t\t// this.unobserveIntersections(this.localUser);\n\t\t\t\tthis.localUser.mount(this.elements.center, true);\n\t\t\t\tthis.localUser.visible = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// using force true to always move self to the end of the list\n\t\t\t\tthis.localUser.mount(this.elements.userList.container);\n\t\t\t\tif (this.layout == Layouts.Centered && this.intersectionObserver)\n\t\t\t\t{\n\t\t\t\t\t// this.observeIntersections(this.localUser);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.visible = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tuserCount++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localUser.dismount();\n\t\t\t// this.unobserveIntersections(this.localUser);\n\t\t}\n\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.updateGridUserSize(userCount);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.userList.container.classList.add(\"bx-messenger-videocall-user-list-small\");\n\t\t\tthis.elements.userList.container.style.removeProperty('--avatar-size');\n\t\t\tthis.elements.userList.container.style.removeProperty('--avatar-text-size');\n\t\t\tthis.updateCentralUserAvatarSize();\n\t\t}\n\t\tthis.applyIncomingVideoConstraints();\n\n\t\tthis.renderAddUserButtonInList();\n\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-user-list-empty\", (this.elements.userList.container.childElementCount === 0));\n\t\tthis.localUser.updatePanelDeferred();\n\n\t\tthis.toggleSubscribingVideoInRenderUserList(this.activeUsers, true)\n\t\tthis.toggleSubscribingVideoInRenderUserList(this.inactiveUsers, false)\n\t};\n\n\tshouldShowLocalUser()\n\t{\n\t\treturn (\n\t\t\tthis.localUser.userModel.state != UserState.Idle\n\t\t\t&& this.localUser.userModel.direction != EndpointDirection.RecvOnly\n\t\t);\n\t};\n\n\tupdateGridUserSize(userCount)\n\t{\n\t\tconst containerSize = this.elements.userList.container.getBoundingClientRect();\n\t\tthis.userSize = Util.findBestElementSize(\n\t\t\tcontainerSize.width,\n\t\t\tcontainerSize.height,\n\t\t\tuserCount,\n\t\t\tMIN_GRID_USER_WIDTH,\n\t\t\tMIN_GRID_USER_HEIGHT\n\t\t);\n\n\t\t//Change the size to make it possible to make indents between users\n\t\tlet rows = Math.floor(containerSize.height / MIN_GRID_USER_HEIGHT) || 1;\n\t\tthis.userSize.width -= 5 * rows;\n\t\tthis.userSize.height -= 2.75 * rows;\n\t\tconst avatarSize = Math.round(this.userSize.height * 0.45);\n\t\tconst avatarTextSize = Math.round(avatarSize * 0.45);\n\t\tthis.elements.userList.container.style.setProperty('--grid-user-width', this.userSize.width + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--grid-user-height', this.userSize.height + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--avatar-size', avatarSize + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--avatar-text-size', avatarTextSize + 'px');\n\t\tif (this.userSize.width < 220)\n\t\t{\n\t\t\tthis.elements.userList.container.classList.add(\"bx-messenger-videocall-user-list-small\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.userList.container.classList.remove(\"bx-messenger-videocall-user-list-small\");\n\t\t}\n\t};\n\n\tupdateCentralUserAvatarSize()\n\t{\n\t\tlet containerSize;\n\t\tlet avatarSize;\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tcontainerSize = this.elements.root.getBoundingClientRect();\n\t\t\tavatarSize = Math.round(containerSize.width * 0.55);\n\t\t}\n\t\telse if (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tcontainerSize = this.elements.center.getBoundingClientRect();\n\t\t\tavatarSize = Math.min(Math.round(containerSize.height * 0.45), Math.round(containerSize.width * 0.45));\n\t\t\tthis.centralUser.setIncomingVideoConstraints(Math.floor(containerSize.width), Math.floor(containerSize.height));\n\t\t}\n\t\tconst avatarTextSize = Math.round(avatarSize * 0.45);\n\t\tthis.elements.center.style.setProperty('--avatar-size', avatarSize + 'px');\n\t\tthis.elements.center.style.setProperty('--avatar-text-size', avatarTextSize + 'px');\n\t};\n\n\trenderButtons(buttons): HTMLElement\n\t{\n\t\tlet panelInner, left, center, right;\n\n\t\tpanelInner = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-inner\"}\n\t\t});\n\n\t\tif (this.layout === Layouts.Mobile || this.size === Size.Folded)\n\t\t{\n\t\t\tleft = panelInner;\n\t\t\tcenter = panelInner;\n\t\t\tright = panelInner;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tleft = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-inner-left\"},\n\t\t\t});\n\t\t\tcenter = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-inner-center\"},\n\t\t\t});\n\t\t\tright = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-inner-right\"},\n\t\t\t});\n\t\t\tpanelInner.appendChild(left);\n\t\t\tpanelInner.appendChild(center);\n\t\t\tpanelInner.appendChild(right);\n\t\t}\n\n\t\tfor (let i = 0; i < buttons.length; i++)\n\t\t{\n\t\t\tswitch (buttons[i])\n\t\t\t{\n\t\t\t\tcase \"title\":\n\t\t\t\t\tthis.buttons.title = new Buttons.TitleButton({\n\t\t\t\t\t\ttext: this.title,\n\t\t\t\t\t\tisGroupCall: Object.keys(this.users).length > 1\n\t\t\t\t\t});\n\t\t\t\t\tleft.appendChild(this.buttons.title.render());\n\t\t\t\t\tbreak;\n\t\t\t\t/*case \"grid\":\n\t\t\t\t\tthis.buttons.grid = new SimpleButton({\n\t\t\t\t\t\tclass: \"grid\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_GRID\"),\n\t\t\t\t\t\tonClick: this._onGridButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tpanelInner.appendChild(this.buttons.grid.render());\n\t\t\t\t\tbreak;*/\n\t\t\t\t/*case \"add\":\n\t\t\t\t\tthis.buttons.add = new SimpleButton({\n\t\t\t\t\t\tclass: \"add\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ADD\"),\n\t\t\t\t\t\tonClick: this._onAddButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tleftSubPanel.appendChild(this.buttons.add.render());\n\t\t\t\t\tbreak;*/\n\t\t\t\tcase \"share\":\n\t\t\t\t\tthis.buttons.share = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"share\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_LINK\"),\n\t\t\t\t\t\tonClick: this._onShareButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tcenter.appendChild(this.buttons.share.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"microphone\":\n\t\t\t\t\tthis.buttons.microphone = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: \"microphone\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_MIC\"),\n\t\t\t\t\t\tenabled: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\tarrowHidden: this.layout == Layouts.Mobile,\n\t\t\t\t\t\tarrowEnabled: this.isMediaSelectionAllowed(),\n\t\t\t\t\t\tshowPointer: true, //todo\n\t\t\t\t\t\tblocked: this.isButtonBlocked(\"microphone\"),\n\t\t\t\t\t\tshowLevel: true,\n\t\t\t\t\t\tsideIcon: this.getMicrophoneSideIcon(this.roomState),\n\t\t\t\t\t\tonClick: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t\t\t\t\t\tthis._showMicrophoneHint(e);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonArrowClick: this._onMicrophoneArrowClick.bind(this),\n\t\t\t\t\t\tonMouseOver: this._showMicrophoneHint.bind(this),\n\t\t\t\t\t\tonMouseOut: () => this._destroyHotKeyHint(),\n\t\t\t\t\t\tonSideIconClick: this._onMicrophoneSideIconClick.bind(this),\n\t\t\t\t\t});\n\t\t\t\t\tleft.appendChild(this.buttons.microphone.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"camera\":\n\t\t\t\t\tthis.buttons.camera = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: \"camera\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_CAMERA\"),\n\t\t\t\t\t\tenabled: Hardware.isCameraOn,\n\t\t\t\t\t\tarrowHidden: this.layout == Layouts.Mobile,\n\t\t\t\t\t\tarrowEnabled: this.isMediaSelectionAllowed(),\n\t\t\t\t\t\tblocked: this.isButtonBlocked(\"camera\"),\n\t\t\t\t\t\tonClick: this._onCameraButtonClick.bind(this),\n\t\t\t\t\t\tonArrowClick: this._onCameraArrowClick.bind(this),\n\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget.firstChild, \"camera\", this.keyModifier + \" + V\");\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tleft.appendChild(this.buttons.camera.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"screen\":\n\t\t\t\t\tif (!this.buttons.screen)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.screen = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"screen\",\n\t\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-background-screen\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_SCREEN\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"screen\"),\n\t\t\t\t\t\t\tonClick: this._onScreenButtonClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"screen\", this.keyModifier + \" + S\");\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.screen.setBlocked(this.isButtonBlocked(\"screen\"));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.screen.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"record\":\n\t\t\t\t\tif (!this.buttons.record)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.record = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"record\",\n\t\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-background-record\",\n\t\t\t\t\t\t\ttext: this.recordState.state === View.RecordState.Started || this.recordState.state === View.RecordState.Resumed\n\t\t\t\t\t\t\t\t? BX.message(\"CALL_M_BTN_TITLE_STOP_RECORD\")\n\t\t\t\t\t\t\t\t: BX.message(\"IM_M_CALL_BTN_RECORD\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"record\"),\n\t\t\t\t\t\t\tonClick: this._onRecordToggleClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (this.isRecordingHotKeySupported())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"record\", this.keyModifier + \" + R\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (this.isRecordingHotKeySupported())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.record.setBlocked(this.isButtonBlocked('record'));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.record.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"document\":\n\t\t\t\t\tif (!this.buttons.document)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.document = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"document\",\n\t\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-background-document\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_DOCUMENT\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"document\"),\n\t\t\t\t\t\t\tonClick: this._onDocumentButtonClick.bind(this)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.document.setBlocked(this.isButtonBlocked('document'));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.document.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"copilot\":\n\t\t\t\t\tif (!this.buttons.copilot)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.copilot = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"copilot\",\n\t\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-background-copilot\",\n\t\t\t\t\t\t\ttext: BX.message(\"CALL_BUTTON_COPILOT_TITLE\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"copilot\"),\n\t\t\t\t\t\t\tonClick: this._onCopilotButtonClick.bind(this),\n\t\t\t\t\t\t\tisComingSoon: !this.isCopilotFeaturesEnabled,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.copilot.setBlocked(this.isButtonBlocked('copilot'));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isCopilotActive)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.copilot.setActive(true);\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.copilot.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"returnToCall\":\n\t\t\t\t\tthis.buttons.returnToCall = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"returnToCall\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_RETURN_TO_CALL\"),\n\t\t\t\t\t\tonClick: this._onBodyClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tright.appendChild(this.buttons.returnToCall.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"hangup\":\n\t\t\t\t\tthis.buttons.hangup = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"hangup\",\n\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-icon-background-hangup\",\n\t\t\t\t\t\ttext: Object.keys(this.users).length > 1 ? BX.message(\"IM_M_CALL_BTN_DISCONNECT\") : BX.message(\"IM_M_CALL_BTN_HANGUP\"),\n\t\t\t\t\t\tonClick: this._onHangupButtonClick.bind(this)\n\t\t\t\t\t});\n\n\t\t\t\t\tright.appendChild(this.buttons.hangup.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"hangupOptions\":\n\t\t\t\t\tthis.buttons.hangupOptions = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"hangup-options\",\n\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-icon-background-hangup-options\",\n\t\t\t\t\t\tonClick: this._onHangupOptionsButtonClick.bind(this)\n\t\t\t\t\t});\n\n\t\t\t\t\tright.appendChild(this.buttons.hangupOptions.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"close\":\n\t\t\t\t\tthis.buttons.close = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"close\",\n\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-icon-background-hangup\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_CLOSE\"),\n\t\t\t\t\t\tonClick: this._onCloseButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tright.appendChild(this.buttons.close.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"speaker\":\n\t\t\t\t\t/*this.buttons.speaker = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: \"speaker\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_SPEAKER\"),\n\t\t\t\t\t\tenabled: !this.speakerMuted,\n\t\t\t\t\t\tarrowEnabled: Hardware.canSelectSpeaker() && this.isMediaSelectionAllowed(),\n\t\t\t\t\t\tonClick: this._onSpeakerButtonClick.bind(this),\n\t\t\t\t\t\tonArrowClick: this._onSpeakerArrowClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\trightSubPanel.appendChild(this.buttons.speaker.render());*/\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"mobileMenu\":\n\t\t\t\t\tif (!this.buttons.mobileMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.mobileMenu = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"sandwich\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_MENU\"),\n\t\t\t\t\t\t\tonClick: this._onMobileMenuButtonClick.bind(this)\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.mobileMenu.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"chat\":\n\t\t\t\t\tif (!this.buttons.chat)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.chat = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"chat\",\n\t\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-background-chat\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_CHAT\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"chat\"),\n\t\t\t\t\t\t\tonClick: this._onChatButtonClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"chat\", this.keyModifier + \" + C\");\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.chat.setBlocked(this.isButtonBlocked('chat'));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.chat.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"floorRequest\":\n\t\t\t\t\tif (!this.buttons.floorRequest)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.floorRequest = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"floor-request\",\n\t\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-background-floor-request\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_WANT_TO_SAY\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"floorRequest\"),\n\t\t\t\t\t\t\tonClick: this._onFloorRequestButtonClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"floorRequest\", this.keyModifier + \" + H\");\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonMouseOut: () => this._destroyHotKeyHint()\n\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.floorRequest.setBlocked(this.isButtonBlocked('floorRequest'));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.floorRequest.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"more\":\n\t\t\t\t\tif (!this.buttons.more)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.more = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"more\",\n\t\t\t\t\t\t\tonClick: this._onMoreButtonClick.bind(this)\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.more.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"spacer\":\n\t\t\t\t\tpanelInner.appendChild(Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-spacer\"}\n\t\t\t\t\t}));\n\t\t\t\t\tbreak;\n\t\t\t\t/*case \"history\":\n\t\t\t\t\tthis.buttons.history = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"history\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_HISTORY\"),\n\t\t\t\t\t\tonClick: this._onHistoryButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\trightSubPanel.appendChild(this.buttons.history.render());\n\t\t\t\t\tbreak;*/\n\t\t\t}\n\t\t}\n\n\t\treturn panelInner;\n\t};\n\n\trenderTopButtons(buttons)\n\t{\n\t\tlet result = BX.createFragment();\n\n\t\tfor (let i = 0; i < buttons.length; i++)\n\t\t{\n\t\t\tswitch (buttons[i])\n\t\t\t{\n\t\t\t\tcase \"watermark\":\n\t\t\t\t\tthis.buttons.waterMark = new Buttons.WaterMarkButton({\n\t\t\t\t\t\tlanguage: this.language\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.waterMark.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"protected\":\n\t\t\t\t\tthis.buttons.protected = new Buttons.TopFramelessButton({\n\t\t\t\t\t\ticonClass: \"protected\",\n\t\t\t\t\t\ttextClass: \"protected\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_PROTECTED\").toLowerCase(),\n\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.hintManager.popupParameters.events = null;\n\t\t\t\t\t\t\tthis.hintManager.show(e.currentTarget, BX.message(\"IM_M_CALL_PROTECTED_HINT\"));\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.hintManager.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.protected.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"recordStatus\":\n\t\t\t\t\tif (this.buttons.recordStatus)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.recordStatus.updateView();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.recordStatus = new Buttons.RecordStatusButton({\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\trecordState: this.recordState,\n\t\t\t\t\t\t\tonPauseClick: this._onRecordPauseClick.bind(this),\n\t\t\t\t\t\t\tonStopClick: this._onRecordStopClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: this._onRecordMouseOver.bind(this),\n\t\t\t\t\t\t\tonMouseOut: this._onRecordMouseOut.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresult.appendChild(this.buttons.recordStatus.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"grid\":\n\t\t\t\t\tthis.buttons.grid = new Buttons.TopButton({\n\t\t\t\t\t\ticonClass: this.layout == Layouts.Grid ? \"speaker\" : \"grid\",\n\t\t\t\t\t\ttext: this.layout == Layouts.Grid ? BX.message(\"IM_M_CALL_SPEAKER_MODE\") : BX.message(\"IM_M_CALL_GRID_MODE\"),\n\t\t\t\t\t\tonClick: this._onGridButtonClick.bind(this),\n\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"grid\", this.keyModifier + \" + W\", {position: \"bottom\"});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.grid.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"fullscreen\":\n\t\t\t\t\tthis.buttons.fullscreen = new Buttons.TopButton({\n\t\t\t\t\t\ticonClass: this.isFullScreen ? \"fullscreen-leave\" : \"fullscreen-enter\",\n\t\t\t\t\t\ttext: this.isFullScreen ? BX.message(\"IM_M_CALL_WINDOW_MODE\") : BX.message(\"IM_M_CALL_FULLSCREEN_MODE\"),\n\t\t\t\t\t\tonClick: this._onFullScreenButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.fullscreen.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"feedback\":\n\t\t\t\t\tthis.buttons.feedback = new Buttons.TopButton({\n\t\t\t\t\t\ticonClass: 'feedback',\n\t\t\t\t\t\ttext: BX.message('IM_OL_COMMENT_HEAD_BUTTON_VOTE'),\n\t\t\t\t\t\tonClick: this._onFeedbackButtonClick.bind(this)\n\t\t\t\t\t})\n\t\t\t\t\tresult.appendChild(this.buttons.feedback.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"participants\":\n\t\t\t\t\tlet foldButtonState;\n\n\t\t\t\t\tif (this.isFullScreen && this.layout == Layouts.Centered)\n\t\t\t\t\t{\n\t\t\t\t\t\tfoldButtonState = this.isUserBlockFolded ? Buttons.ParticipantsButton.FoldButtonState.Unfold : Buttons.ParticipantsButton.FoldButtonState.Fold\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.showUsersButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tfoldButtonState = Buttons.ParticipantsButton.FoldButtonState.Active;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfoldButtonState = Buttons.ParticipantsButton.FoldButtonState.Hidden;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.buttons.participants)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\t\t\tfoldButtonState: foldButtonState,\n\t\t\t\t\t\t\tallowAdding: !this.isButtonBlocked(\"add\"),\n\t\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.participants = new Buttons.ParticipantsButton({\n\t\t\t\t\t\t\tfoldButtonState: foldButtonState,\n\t\t\t\t\t\t\tallowAdding: !this.isButtonBlocked(\"add\"),\n\t\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\t\tonListClick: this._onParticipantsButtonListClick.bind(this),\n\t\t\t\t\t\t\tonAddClick: this._onAddButtonClick.bind(this)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tresult.appendChild(this.buttons.participants.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"participantsMobile\":\n\t\t\t\t\tthis.buttons.participantsMobile = new Buttons.ParticipantsButtonMobile({\n\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\tonClick: this._onParticipantsButtonMobileListClick.bind(this),\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.participantsMobile.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"separator\":\n\t\t\t\t\tresult.appendChild(Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-separator\"}\n\t\t\t\t\t}));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"spacer\":\n\t\t\t\t\tresult.appendChild(Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-panel-spacer\"}\n\t\t\t\t\t}));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tupdateCopilotState(isActive)\n\t{\n\t\tthis.isCopilotActive = isActive;\n\n\t\tthis.setButtonActive('copilot', this.isCopilotActive);\n\n\t\tif (this.elements.wrap)\n\t\t{\n\t\t\tthis.elements.wrap.classList[this.isCopilotActive ? 'add' : 'remove']('bx-messenger-videocall-wrap-with-copilot')\n\t\t}\n\t}\n\n\tupdateCopilotFeatureState(isEnabled)\n\t{\n\t\tthis.isCopilotFeaturesEnabled = isEnabled;\n\n\t\tif (!this.buttons.copilot)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons.copilot.setIsComingSoon(!this.isCopilotFeaturesEnabled);\n\t}\n\n\tshowCopilotNotify(callId = 0, errorCode = '')\n\t{\n\t\tlet notifyType = '';\n\n\t\tif (!errorCode)\n\t\t{\n\t\t\tnotifyType = CopilotNotifyType[this.isCopilotActive ? 'COPILOT_ENABLED' : 'COPILOT_DISABLED'];\n\t\t}\n\n\t\tthis.copilotNotify = this.createCopilotNotify(notifyType, callId);\n\n\t\tif (this.copilotNotify)\n\t\t{\n\t\t\tthis.copilotNotify.show();\n\t\t}\n\t}\n\n\tcloseCopilotNotify()\n\t{\n\t\tif (this.copilotNotify)\n\t\t{\n\t\t\tthis.copilotNotify.close();\n\t\t}\n\t}\n\n\tshowCopilotResultNotify()\n\t{\n\t\tthis.copilotNotify = this.createCopilotNotify(CopilotNotifyType.COPILOT_RESULT);\n\n\t\tif (this.copilotNotify)\n\t\t{\n\t\t\tthis.copilotNotify.show();\n\t\t}\n\t}\n\n\tshowCopilotErrorNotify(errorType)\n\t{\n\t\tthis.copilotNotify = this.createCopilotNotify(CopilotNotifyType[errorType]);\n\n\t\tif (this.copilotNotify)\n\t\t{\n\t\t\tthis.copilotNotify.show();\n\t\t}\n\t}\n\n\tcreateCopilotNotify(notifyType, callId)\n\t{\n\t\tif (!this.buttons.copilot)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new CopilotNotify({\n\t\t\ttype: notifyType,\n\t\t\tbindElement: this.buttons.copilot.elements.root,\n\t\t\tonClose: () => {\n\t\t\t\tthis.copilotNotify = null;\n\t\t\t},\n\t\t\tcallId,\n\t\t});\n\t}\n\n\tcalculateUnusedPanelSpace(buttonList)\n\t{\n\t\tif (!buttonList)\n\t\t{\n\t\t\tbuttonList = this.getButtonList();\n\t\t}\n\n\t\tlet totalButtonWidth = 0;\n\t\tfor (let i = 0; i < buttonList.length; i++)\n\t\t{\n\t\t\tconst button = this.buttons[buttonList[i]];\n\t\t\tif (!button)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst buttonWidth = button.elements.root ? button.elements.root.getBoundingClientRect().width : 0;\n\t\t\ttotalButtonWidth += buttonWidth;\n\t\t}\n\n\t\treturn this.elements.panel.scrollWidth - totalButtonWidth - 32;\n\t};\n\n\tsetButtonActive(buttonName, isActive)\n\t{\n\t\tif (!this.buttons[buttonName])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons[buttonName].setActive(isActive);\n\t};\n\n\tgetButtonActive(buttonName)\n\t{\n\t\tif (!this.buttons[buttonName])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.buttons[buttonName].isActive;\n\t};\n\n\tsetButtonCounter(buttonName, counter)\n\t{\n\t\tif (!this.buttons[buttonName])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons[buttonName].setCounter(counter);\n\t};\n\n\tupdateUserList(useShelvedRerenderQueue)\n\t{\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tif (this.localUser != this.centralUser)\n\t\t\t{\n\t\t\t\tif (this.localUser.hasVideo())\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.mount(this.elements.localUserMobile);\n\t\t\t\t\tthis.localUser.visible = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.dismount();\n\t\t\t\t}\n\n\t\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\t\tuserId: this.centralUser.id\n\t\t\t\t});\n\t\t\t\tthis.centralUser.visible = true;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t/* if (this.layout == Layouts.Grid && this.size == Size.Full)\n\t\t{\n\t\t\tthis.recalculatePages();\n\t\t} */\n\n\t\tif ((this.layout == Layouts.Grid || this.layout == Layouts.Centered) && this.size == Size.Full)\n\t\t{\n\t\t\tthis.recalculatePages();\n\t\t}\n\n\t\tif (useShelvedRerenderQueue)\n\t\t{\n\t\t\tthis.shelvedRerenderQueue.forEach((el) =>\n\t\t\t{\n\t\t\t\tif (el.reason === RerenderReason.VideoEnabled)\n\t\t\t\t{\n\t\t\t\t\tthis.updateRerenderQueue(el.userId, el.reason);\n\t\t\t\t}\n\t\t\t\telse if (el.reason === RerenderReason.VideoDisabled)\n\t\t\t\t{\n\t\t\t\t\tthis.updateRerenderQueue(el.userId, el.reason);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.shelvedRerenderQueue.clear();\n\t\t}\n\n\t\tthis.renderUserList();\n\n\t\tif (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tif (!this.elements.userList.container.parentElement)\n\t\t\t{\n\t\t\t\tthis.elements.userBlock.appendChild(this.elements.userList.container);\n\t\t\t}\n\t\t\t//this.centralUser.setFullSize(this.elements.userList.container.childElementCount === 0);\n\n\t\t}\n\t\telse if (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tif (!this.elements.userList.container.parentElement)\n\t\t\t{\n\t\t\t\tthis.elements.container.appendChild(this.elements.userList.container);\n\t\t\t}\n\t\t}\n\t\tthis.toggleEars();\n\t};\n\n\tshowOverflownButtonsPopup()\n\t{\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tconst bindElement = this.buttons.more && this.buttons.more.elements.root ? this.buttons.more.elements.root : this.elements.panel;\n\n\t\tthis.overflownButtonsPopup = new Popup({\n\t\t\tid: 'bx-call-buttons-popup',\n\t\t\tbindElement: bindElement,\n\t\t\ttargetContainer: this.container,\n\t\t\tcontent: this.renderButtons(Object.keys(this.overflownButtons)),\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\toverlay: {backgroundColor: 'white', opacity: 0},\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top'\n\t\t\t},\n\t\t\tangle: {position: 'bottom', offset: 49},\n\t\t\tclassName: 'bx-call-buttons-popup',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.overflownButtonsPopup = null;\n\t\t\t\t\tthis.buttons.more.setActive(false);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t\tthis.overflownButtonsPopup.show();\n\t}\n\n\tresumeVideo()\n\t{\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tconst user = this.users[userId];\n\t\t\tuser.playVideo()\n\t\t\tconst screenUser = this.screenUsers[userId];\n\t\t\tscreenUser.playVideo();\n\t\t}\n\t\tthis.localUser.playVideo();\n\t};\n\n\tupdateUserButtons()\n\t{\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].allowPinButton = this.getConnectedUserCount() > 1;\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateButtons(skippedElementsList = [])\n\t{\n\t\tif (!this.elements.panel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!skippedElementsList.includes('panel'))\n\t\t{\n\t\t\tDom.clean(this.elements.panel);\n\t\t\tthis.elements.panel.appendChild(this.renderButtons(this.getButtonList()));\n\t\t}\n\n\t\tDom.clean(this.elements.topPanel);\n\t\tif (this.elements.topPanel)\n\t\t{\n\t\t\tthis.elements.topPanel.appendChild(this.renderTopButtons(this.getTopButtonList()));\n\t\t}\n\t\tif (this.buttons.participantsMobile)\n\t\t{\n\t\t\tthis.buttons.participantsMobile.setCount(this.getConnectedUserCount(true));\n\t\t}\n\n\n\n\t\tthis.renderAddUserButtonInList();\n\t};\n\n\tupdateUserData(userData)\n\t{\n\t\tfor (let userId in userData)\n\t\t{\n\t\t\tif (!this.userData[userId])\n\t\t\t{\n\t\t\t\tthis.userData[userId] = {\n\t\t\t\t\tname: '',\n\t\t\t\t\tavatar_hr: '',\n\t\t\t\t\tgender: 'M'\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (userData[userId].name)\n\t\t\t{\n\t\t\t\tthis.userData[userId].name = userData[userId].name;\n\t\t\t}\n\n\t\t\tif (userData[userId].avatar_hr)\n\t\t\t{\n\t\t\t\tthis.userData[userId].avatar_hr = Util.isAvatarBlank(userData[userId].avatar_hr) ? '' : userData[userId].avatar_hr;\n\t\t\t}\n\t\t\telse if (userData[userId].avatar)\n\t\t\t{\n\t\t\t\tthis.userData[userId].avatar_hr = Util.isAvatarBlank(userData[userId].avatar) ? '' : userData[userId].avatar;\n\t\t\t}\n\n\t\t\tif (userData[userId].gender)\n\t\t\t{\n\t\t\t\tthis.userData[userId].gender = userData[userId].gender === 'F' ? 'F' : 'M';\n\t\t\t}\n\n\t\t\tconst userModel = this.userRegistry.get(userId);\n\t\t\tif (userModel)\n\t\t\t{\n\t\t\t\tuserModel.name = this.userData[userId].name;\n\t\t\t\tuserModel.avatar = this.userData[userId].avatar_hr;\n\t\t\t}\n\t\t}\n\t};\n\n\tisScreenSharingSupported()\n\t{\n\t\treturn navigator.mediaDevices && typeof (navigator.mediaDevices.getDisplayMedia) === \"function\" || typeof (BXDesktopSystem) !== \"undefined\";\n\t};\n\n\tisRecordingHotKeySupported()\n\t{\n\t\treturn typeof (BXDesktopSystem) !== \"undefined\" && BXDesktopSystem.ApiVersion() >= 60;\n\t};\n\n\tisFullScreenSupported()\n\t{\n\t\tif (BX.browser.IsChrome() || BX.browser.IsSafari())\n\t\t{\n\t\t\treturn document.webkitFullscreenEnabled === true;\n\t\t}\n\t\telse if (BX.browser.IsFirefox())\n\t\t{\n\t\t\treturn document.fullscreenEnabled === true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t};\n\n\ttoggleEars()\n\t{\n\t\tthis.toggleTopEar();\n\t\tthis.toggleBottomEar();\n\n\t\tif (this.layout == Layouts.Grid && this.pagesCount > 1 && this.currentPage > 1)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeft.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeft.classList.remove(\"active\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Grid && this.pagesCount > 1 && this.currentPage < this.pagesCount)\n\t\t{\n\t\t\tthis.elements.pageNavigatorRight.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.pageNavigatorRight.classList.remove(\"active\");\n\t\t}\n\t};\n\n\ttoggleTopEar()\n\t{\n\t\tif (\n\t\t\tthis.layout !== Layouts.Grid &&\n\t\t\tthis.pagesCount > 1\n\t\t)\n\t\t{\n\t\t\tthis.elements.ear.top.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.ear.top.classList.remove(\"active\");\n\t\t}\n\t};\n\n\ttoggleBottomEar()\n\t{\n\t\tif (\n\t\t\tthis.layout !== Layouts.Grid &&\n\t\t\tthis.pagesCount > 1\n\t\t)\n\t\t{\n\t\t\tthis.elements.ear.bottom.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.ear.bottom.classList.remove(\"active\");\n\t\t}\n\t};\n\n\tscrollUserListUp()\n\t{\n\t\tthis.stopScroll();\n\t\tthis.scrollInterval = setInterval(\n\t\t\t() => this.elements.userList.container.scrollTop -= 10,\n\t\t\t20\n\t\t);\n\t};\n\n\tscrollUserListDown()\n\t{\n\t\tthis.stopScroll();\n\t\tthis.scrollInterval = setInterval(\n\t\t\t() => this.elements.userList.container.scrollTop += 10,\n\t\t\t20\n\t\t);\n\t};\n\n\tstopScroll()\n\t{\n\t\tif (this.scrollInterval)\n\t\t{\n\t\t\tclearInterval(this.scrollInterval);\n\t\t\tthis.scrollInterval = 0;\n\t\t}\n\t};\n\n\ttoggleRenameSliderInputLoader()\n\t{\n\t\tthis.elements.renameSlider.button.classList.add('ui-btn-wait');\n\t};\n\n\tsetHotKeyTemporaryBlock(isActive, force)\n\t{\n\t\tif (!!isActive)\n\t\t{\n\t\t\tthis.hotKeyTemporaryBlock++;\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tthis.hotKeyTemporaryBlock--;\n\t\t\tif (this.hotKeyTemporaryBlock < 0 || force)\n\t\t\t{\n\t\t\t\tthis.hotKeyTemporaryBlock = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetHotKeyActive(name, isActive)\n\t{\n\t\tif (typeof this.hotKey[name] === 'undefined')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hotKey[name] = !!isActive;\n\t};\n\n\tisHotKeyActive(name)\n\t{\n\t\tif (!this.hotKey['all'])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.hotKeyTemporaryBlock > 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isButtonHidden(name))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isButtonBlocked(name))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!this.hotKey[name];\n\t}\n\n\t// event handlers\n\n\t_onBodyClick()\n\t{\n\t\tthis.eventEmitter.emit(EventName.onBodyClick);\n\t};\n\n\t_onCenterTouchStart(e)\n\t{\n\t\tthis.centerTouchX = e.pageX;\n\t};\n\n\t_onCenterTouchEnd(e)\n\t{\n\t\tconst delta = e.pageX - this.centerTouchX;\n\n\t\tif (delta > 100)\n\t\t{\n\t\t\tthis.pinUser(this.getRightUser(this.centralUser.id));\n\t\t\te.preventDefault();\n\t\t}\n\t\tif (delta < -100)\n\t\t{\n\t\t\tthis.pinUser(this.getLeftUser(this.centralUser.id));\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\t_onFullScreenChange()\n\t{\n\t\tif (\"webkitFullscreenElement\" in document)\n\t\t{\n\t\t\tthis.isFullScreen = (!!document.webkitFullscreenElement);\n\t\t}\n\t\telse if (\"fullscreenElement\" in document)\n\t\t{\n\t\t\tthis.isFullScreen = (!!document.fullscreenElement);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// safari workaround\n\t\tsetTimeout(function ()\n\t\t{\n\t\t\tif (!this.elements.root)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.isFullScreen)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-fullscreen\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-fullscreen\");\n\t\t\t}\n\t\t\tthis.updateUserList();\n\t\t\tthis.updateButtons();\n\t\t\tthis.setUserBlockFolded(this.isFullScreen);\n\n\t\t}.bind(this), 0);\n\t};\n\n\t_onIntersectionChange(entries)\n\t{\n\t\tlet t = {};\n\t\tentries.forEach(function (intersectionEntry)\n\t\t{\n\t\t\tt[intersectionEntry.target.dataset.userId] = intersectionEntry.isIntersecting;\n\t\t});\n\t\tfor (let userId in t)\n\t\t{\n\t\t\tif (this.users[userId])\n\t\t\t{\n\t\t\t\tthis.users[userId].visible = t[userId];\n\t\t\t}\n\t\t\tif (userId == this.localUser.id)\n\t\t\t{\n\t\t\t\tthis.localUser.visible = t[userId];\n\t\t\t}\n\t\t}\n\t};\n\n\t_onResize()\n\t{\n\t\t// this.resizeCalled++;\n\t\t// this.reportResizeCalled();\n\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.centralUser)\n\t\t{\n\t\t\t//this.centralUser.updateAvatarWidth();\n\t\t}\n\t\tif (BX.browser.IsMobile())\n\t\t{\n\t\t\tdocument.documentElement.style.setProperty('--view-height', window.innerHeight + 'px');\n\t\t}\n\t\tif (this.layout == Layouts.Grid || this.layout == Layouts.Centered)\n\t\t{\n\t\t\tthis.updateUserList();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateCentralUserAvatarSize();\n\t\t\tthis.toggleEars();\n\t\t}\n\n\t\tconst rootDimensions = this.elements.root.getBoundingClientRect()\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-450\", rootDimensions.width < 450);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-550\", rootDimensions.width < 550);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-650\", rootDimensions.width < 650);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-700\", rootDimensions.width < 700);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-850\", rootDimensions.width < 850);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-900\", rootDimensions.width < 900);\n\n\t\t/*if (this.maxWidth === 0)\n\t\t{\n\t\t\tthis.elements.root.style.maxWidth = this.container.clientWidth + 'px';\n\t\t}*/\n\n\t\tif (this.checkPanelOverflow())\n\t\t{\n\t\t\tthis.updateButtons();\n\t\t\tif (this.overflownButtonsPopup && !Object.keys(this.overflownButtons).length)\n\t\t\t{\n\t\t\t\tthis.overflownButtonsPopup.close();\n\t\t\t}\n\t\t}\n\t};\n\n\t_onOrientationChange()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (window.innerHeight > window.innerWidth)\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"orientation-landscape\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"orientation-landscape\");\n\t\t}\n\t};\n\n\t_showHotKeyHint(targetNode, name, text, options)\n\t{\n\t\tconst existingHint = BX.PopupWindowManager.getPopupById('ui-hint-popup');\n\t\tif (existingHint)\n\t\t{\n\t\t\texistingHint.destroy();\n\t\t}\n\n\t\tif (!this.isHotKeyActive(name))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\toptions = options || {};\n\t\tthis.hintManager.popupParameters.events = {\n\t\t\tonShow: function onShow(event) {\n\t\t\t\tlet popup = event.getTarget();\n\t\t\t\tlet offsetLeft = (targetNode.offsetWidth / 2 - popup.getPopupContainer().offsetWidth / 2) + 23;\n\n\t\t\t\tif (options?.additionalOffsetLeft)\n\t\t\t\t{\n\t\t\t\t\toffsetLeft += options.additionalOffsetLeft;\n\t\t\t\t}\n\t\t\t\t// hack to get hint sizes\n\t\t\t\tpopup.getPopupContainer().style.display = 'block';\n\t\t\t\tif (options.position === 'bottom') {\n\t\t\t\t\tpopup.setOffset({\n\t\t\t\t\t\toffsetTop: 10,\n\t\t\t\t\t\toffsetLeft,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tpopup.setOffset({\n\t\t\t\t\t\toffsetLeft,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.hintManager.show(\n\t\t\ttargetNode,\n\t\t\ttext\n\t\t);\n\t}\n\n\t_destroyHotKeyHint()\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.hintManager.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// we need to destroy, not .hide for onShow event handler (see method _showHotKeyHint).\n\t\tthis.hintManager.popup.destroy();\n\t\tthis.hintManager.popup = null;\n\t}\n\n\t_showMicrophoneHint(e)\n\t{\n\t\tthis.hintManager.hide();\n\n\t\tif (!this.isHotKeyActive(\"microphone\"))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet micHotkeys = '';\n\t\tlet additionalOffsetLeft = 0;\n\t\tif (Hardware.isMicrophoneMuted && this.isHotKeyActive(\"microphoneSpace\"))\n\t\t{\n\t\t\tmicHotkeys = BX.message(\"IM_SPACE_HOTKEY\") + '<br>';\n\t\t\tadditionalOffsetLeft = 20;\n\t\t}\n\t\tmicHotkeys += this.keyModifier + ' + A';\n\n\t\tthis._showHotKeyHint(e.currentTarget.firstChild, \"microphone\", micHotkeys, {additionalOffsetLeft});\n\t}\n\n\t_onKeyDown(e)\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!(e.shiftKey && (e.ctrlKey || e.metaKey)) && !(e.code === 'Space'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (event.repeat)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst callMinimized = this.size === View.Size.Folded;\n\n\t\tif (\n\t\t\te.code === 'KeyA'\n\t\t\t&& this.isHotKeyActive('microphone')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tif (this.deviceSelector)\n\t\t\t{\n\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t}\n\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'Space' && Hardware.isMicrophoneMuted\n\t\t\t&& this.isHotKeyActive('microphoneSpace')\n\t\t)\n\t\t{\n\t\t\tif (!callMinimized)\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.pushToTalk = true;\n\t\t\t\tthis.microphoneHotkeyTimerId = setTimeout(function ()\n\t\t\t\t{\n\t\t\t\t\tif (this.deviceSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t\t\t}\n\t\t\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t\t\t}.bind(this), 100);\n\t\t\t}\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyS'\n\t\t\t&& this.isHotKeyActive('screen')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onScreenButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyV'\n\t\t\t&& this.isHotKeyActive('camera')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tif (this.deviceSelector)\n\t\t\t{\n\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t}\n\t\t\tthis._onCameraButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyU'\n\t\t\t&& this.isHotKeyActive('users')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onUsersButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyR'\n\t\t\t&& this.isRecordingHotKeySupported()\n\t\t\t&& this.isHotKeyActive('record')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onForceRecordToggleClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyH'\n\t\t\t&& this.isHotKeyActive('floorRequest')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onFloorRequestButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyC'\n\t\t\t&& this.isHotKeyActive('chat')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tif (callMinimized)\n\t\t\t{\n\t\t\t\tthis._onBodyClick(e);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._onChatButtonClick(e);\n\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t}\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyM'\n\t\t\t&& this.isHotKeyActive('muteSpeaker')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\t\tbuttonName: \"toggleSpeaker\",\n\t\t\t\tspeakerMuted: this.speakerMuted,\n\t\t\t\tfromHotKey: true,\n\t\t\t});\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyW'\n\t\t\t&& this.isHotKeyActive('grid')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.setLayout(this.layout == Layouts.Centered ? Layouts.Grid : Layouts.Centered);\n\t\t}\n\t};\n\n\t_onKeyUp(e)\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.microphoneHotkeyTimerId);\n\t\tif (this.pushToTalk && !Hardware.isMicrophoneMuted && e.code === 'Space')\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.pushToTalk = false;\n\t\t\tif (this.deviceSelector)\n\t\t\t{\n\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t}\n\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t}\n\t};\n\n\t_onUserClick(e)\n\t{\n\t\tconst userId = e.userId;\n\n\t\tif (userId == this.centralUser.id && this.layout != Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-hidden-panels\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Centered && userId != this.centralUser.id)\n\t\t{\n\t\t\tthis.pinUser(userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t(this.pinnedUser && this.pinnedUser.id === userId) ? this._onUserUnPin() : this._onUserPin({userId});\n\t\t}\n\n\t\tthis.eventEmitter.emit(EventName.onUserClick, {\n\t\t\tuserId: userId,\n\t\t\tstream: userId == this.userId ? this.localUser.stream : this.users[userId].stream,\n\t\t\tlayout: this.layout,\n\t\t});\n\t};\n\n\t_onUserRename(newName)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onUserRename, {newName: newName});\n\t};\n\n\t_onUserRenameInputFocus()\n\t{\n\t\tthis.setHotKeyTemporaryBlock(true);\n\t};\n\n\t_onUserRenameInputBlur()\n\t{\n\t\tthis.setHotKeyTemporaryBlock(false);\n\t};\n\n\t_onUserPin(e)\n\t{\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.setLayout(Layouts.Centered)\n\t\t}\n\t\tthis.pinUser(e.userId);\n\t};\n\n\t_onUserUnPin()\n\t{\n\t\tif (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tthis.setLayout(Layouts.Grid)\n\t\t}\n\t\tthis.unpinUser();\n\t};\n\n\t_onRecordToggleClick(e)\n\t{\n\t\tconst limitObj = this.getRecordLimitation();\n\n\t\tthis.onClickButtonWithLimit(limitObj, () => {\n\t\t\tif (this.recordState.state === View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\tthis._onRecordStartClick(e);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._onRecordStopClick(e);\n\t\t\t}\n\t\t})\n\t}\n\n\t_onForceRecordToggleClick(e)\n\t{\n\t\tconst limitObj = this.getRecordLimitation();\n\n\t\tthis.onClickButtonWithLimit(limitObj, () => {\n\t\t\tif (this.recordState.state === View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\tthis._onForceRecordStartClick(View.RecordType.Video);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._onRecordStopClick(e);\n\t\t\t}\n\t\t})\n\t}\n\n\t_onForceRecordStartClick(recordType)\n\t{\n\t\tif (typeof recordType === 'undefined')\n\t\t{\n\t\t\trecordType = View.RecordType.None;\n\t\t}\n\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: View.RecordState.Started,\n\t\t\tforceRecord: recordType, // none, video, audio\n\t\t\tnode: null\n\t\t});\n\t}\n\n\t_onRecordStartClick(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: View.RecordState.Started,\n\t\t\tnode: e.currentTarget\n\t\t});\n\t}\n\n\t_onRecordPauseClick(e)\n\t{\n\t\tlet recordState;\n\t\tif (this.recordState.state === View.RecordState.Paused)\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\trecordState = View.RecordState.Resumed;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Paused;\n\t\t\trecordState = this.recordState.state;\n\t\t}\n\n\t\tthis.buttons.recordStatus.update(this.recordState);\n\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: recordState,\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onRecordStopClick(e)\n\t{\n\t\tthis.recordState.state = View.RecordState.Stopped;\n\t\tthis.buttons.recordStatus.update(this.recordState);\n\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: this.recordState.state,\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onRecordMouseOver(e)\n\t{\n\t\tif (this.recordState.userId == this.userId || !this.userData[this.recordState.userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst recordingUserName = Text.encode(this.userData[this.recordState.userId].name);\n\t\tthis.hintManager.show(e.currentTarget, BX.message(\"IM_M_CALL_RECORD_HINT\").replace(\"#USER_NAME#\", recordingUserName));\n\t};\n\n\t_onRecordMouseOut()\n\t{\n\t\tthis.hintManager.hide();\n\t};\n\n\t_onDocumentButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'document',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onCopilotButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'copilot',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onGridButtonClick()\n\t{\n\t\tthis.setLayout(this.layout == Layouts.Centered ? Layouts.Grid : Layouts.Centered);\n\t\tif (this.layout == Layouts.Centered && this.localUser.id !== this.centralUser.id)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\tuserId: this.centralUser.id\n\t\t\t});\n\t\t}\n\t};\n\n\t_onAddButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"inviteUser\",\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onShareButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"share\",\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onMicrophoneButtonClick(e)\n\t{\n\t\tif (\"stopPropagation\" in e)\n\t\t{\n\t\t\te.stopPropagation();\n\t\t}\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleMute\",\n\t\t\tmuted: !Hardware.isMicrophoneMuted\n\t\t});\n\t};\n\n\t_onMicrophoneArrowClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showDeviceSelector(e.currentTarget);\n\t};\n\n\t_onMicrophoneSideIconClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"microphoneSideIcon\",\n\t\t});\n\t};\n\n\t_onMicrophoneSelected(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onReplaceMicrophone, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onCameraButtonClick(e)\n\t{\n\t\tif (\"stopPropagation\" in e)\n\t\t{\n\t\t\te.stopPropagation();\n\t\t}\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleVideo\",\n\t\t\tvideo: !Hardware.isCameraOn\n\t\t});\n\t};\n\n\t_onCameraArrowClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showDeviceSelector(e.currentTarget);\n\t};\n\n\t_onCameraSelected(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onReplaceCamera, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onSpeakerButtonClick()\n\t{\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleSpeaker\",\n\t\t\tspeakerMuted: this.speakerMuted\n\t\t});\n\t};\n\n\t_onChangeHdVideo(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeHdVideo, e.data);\n\t};\n\n\t_onChangeMicAutoParams(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeMicAutoParams, e.data);\n\t};\n\n\t_onChangeFaceImprove(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeFaceImprove, e.data);\n\t};\n\n\tdisableFaceImprove()\n\t{\n\t\tif (\n\t\t\tUtil.isDesktop()\n\t\t\t&& DesktopApi.isDesktop()\n\t\t\t&& DesktopApi.getCameraSmoothingStatus()\n\t\t)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onChangeFaceImprove, {\n\t\t\t\tfaceImproveEnabled: false\n\t\t\t});\n\t\t}\n\t}\n\n\t_onSpeakerSelected(e)\n\t{\n\t\tthis.setSpeakerId(e.data.deviceId);\n\n\t\tthis.eventEmitter.emit(EventName.onReplaceSpeaker, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onScreenButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\n\t\tconst limitObj = this.getScreenSharingLimitation();\n\n\t\tthis.onClickButtonWithLimit(limitObj, () => {\n\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\t\tbuttonName: 'toggleScreenSharing',\n\t\t\t\tnode: e.target\n\t\t\t});\n\t\t})\n\t};\n\n\t_onChatButtonClick(e)\n\t{\n\t\tthis.hintManager.hide();\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'showChat',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onUsersButtonClick(e)\n\t{\n\t\tthis.hintManager.hide();\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'toggleUsers',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onMobileMenuButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showCallMenu();\n\t};\n\n\t_onFloorRequestButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'floorRequest',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onMoreButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t\tthis.buttons.more.setActive(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showOverflownButtonsPopup();\n\t\t\tthis.buttons.more.setActive(true);\n\t\t}\n\t};\n\n\t_onHistoryButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'showHistory',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onHangupButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.clearNewLogicRules();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'hangup',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onHangupOptionsButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'hangupOptions',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onCloseButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'close',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onFullScreenButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'fullscreen',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onFeedbackButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'feedback',\n\t\t\tnode: e.target\n\t\t});\n\t}\n\n\t_onParticipantsButtonListClick(event)\n\t{\n\t\tif (!this.isButtonBlocked('users'))\n\t\t{\n\t\t\tthis._onUsersButtonClick(event);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isFullScreen)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setUserBlockFolded(!this.isUserBlockFolded);\n\t};\n\n\t_onParticipantsListButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\n\t\tconst viewEvent = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tbuttonName: 'participantsList',\n\t\t\t\tnode: e.target\n\t\t\t},\n\t\t\tcompatData: ['participantsList', e.target],\n\t\t});\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, viewEvent);\n\n\t\tif (viewEvent.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUserSelector.create({\n\t\t\tparentElement: e.currentTarget,\n\t\t\tzIndex: this.baseZIndex + 500,\n\t\t\tuserList: Object.values(this.users),\n\t\t\tcurrent: this.centralUser.id,\n\t\t\tonSelect: (userId) => this.setCentralUser(userId)\n\t\t}).show();\n\t};\n\n\t_onParticipantsButtonMobileListClick()\n\t{\n\t\tthis.showParticipantsMenu();\n\t};\n\n\t_onMobileCallMenuFloorRequestClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'floorRequest',\n\t\t});\n\t};\n\n\t_onMobileCallMenShowParticipantsClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.showParticipantsMenu();\n\t};\n\n\t_onMobileCallMenuCopyInviteClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"share\",\n\t\t\tnode: null\n\t\t})\n\t};\n\n\tshowRenameSlider()\n\t{\n\t\tif (!this.renameSlider)\n\t\t{\n\t\t\tthis.renameSlider = new MobileSlider({\n\t\t\t\tparent: this.elements.root,\n\t\t\t\tcontent: this.renderRenameSlider(),\n\t\t\t\tonClose: () => this.renameSlider.destroy(),\n\t\t\t\tonDestroy: () => this.renameSlider = null,\n\t\t\t});\n\t\t}\n\n\t\tthis.renameSlider.show();\n\t\tsetTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.elements.renameSlider.input.focus();\n\t\t\t\tthis.elements.renameSlider.input.select();\n\t\t\t},\n\t\t\t400\n\t\t);\n\t};\n\n\trenderRenameSlider()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-wrap\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-title\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\")\n\t\t\t\t}),\n\t\t\t\tthis.elements.renameSlider.input = Dom.create(\"input\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-input\"\n\t\t\t\t\t},\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\tvalue: this.localUser.userModel.name\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.renameSlider.button = Dom.create(\"button\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-button ui-btn ui-btn-md ui-btn-primary\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_RENAME_CONFIRM\"),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this._onMobileUserRename.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\t_onMobileUserRename(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tconst inputValue = this.elements.renameSlider.input.value;\n\t\tconst newName = inputValue.trim();\n\t\tlet needToUpdate = true;\n\t\tif (newName === this.localUser.userModel.name || newName === '')\n\t\t{\n\t\t\tneedToUpdate = false;\n\t\t}\n\n\t\tif (needToUpdate)\n\t\t{\n\t\t\tthis.toggleRenameSliderInputLoader();\n\t\t\tthis._onUserRename(newName)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renameSlider.close();\n\t\t}\n\t};\n\n\t_onMobileCallMenuCancelClick()\n\t{\n\t\tthis.callMenu.close();\n\t};\n\n\t_onLeftEarClick()\n\t{\n\t\tthis.pinUser(this.getLeftUser(this.centralUser.id));\n\t};\n\n\t_onRightEarClick()\n\t{\n\t\tthis.pinUser(this.getRightUser(this.centralUser.id));\n\t};\n\n\t_onLeftPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage - 1)\n\t};\n\n\t_onRightPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage + 1)\n\t};\n\n\t_onTopPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage !== 1 ? this.currentPage - 1 : this.pagesCount);\n\t};\n\n\t_onBottomPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage !== this.pagesCount ? this.currentPage + 1 : 1);\n\t};\n\n\tsetMaxWidth(maxWidth)\n\t{\n\t\tif (this.maxWidth !== maxWidth)\n\t\t{\n\t\t\tconst MAX_WIDTH_SPEAKER_MODE = 650;\n\t\t\tif (maxWidth < MAX_WIDTH_SPEAKER_MODE\n\t\t\t\t&& (!this.maxWidth || this.maxWidth > MAX_WIDTH_SPEAKER_MODE)\n\t\t\t\t&& this.layout === Layouts.Centered\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.setLayout(Layouts.Grid)\n\t\t\t}\n\n\t\t\tconst animateUnsetProperty = this.maxWidth === null;\n\t\t\tthis.maxWidth = maxWidth;\n\t\t\tif (this.size !== View.Size.Folded)\n\t\t\t{\n\t\t\t\tthis._applyMaxWidth(animateUnsetProperty);\n\t\t\t}\n\t\t}\n\t};\n\n\tremoveMaxWidth()\n\t{\n\t\tthis.setMaxWidth(null);\n\t}\n\n\t_applyMaxWidth(animateUnsetProperty)\n\t{\n\t\tconst containerDimensions = this.container.getBoundingClientRect();\n\t\tif (this.maxWidth !== null)\n\t\t{\n\t\t\tif (!this.elements.root.style.maxWidth && animateUnsetProperty)\n\t\t\t{\n\t\t\t\tthis.elements.root.style.maxWidth = containerDimensions.width + 'px';\n\t\t\t}\n\t\t\tsetTimeout(\n\t\t\t\t() => this.elements.root.style.maxWidth = Math.max(this.maxWidth, MIN_WIDTH) + 'px',\n\t\t\t\t0,\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.maxWidth = containerDimensions.width + 'px';\n\t\t\tthis.elements.root.addEventListener('transitionend',\n\t\t\t\t() => this.elements.root.style.removeProperty('max-width'),\n\t\t\t\t{once: true},\n\t\t\t)\n\t\t}\n\t};\n\n\treleaseLocalMedia()\n\t{\n\t\tif (!this.hasCurrentUserScreenSharing())\n\t\t{\n\t\t\tthis.localUser.releaseStream();\n\t\t}\n\n\t\tif (this.centralUser.id == this.userId)\n\t\t{\n\t\t\tthis.centralUser.releaseStream();\n\t\t}\n\t};\n\n\tclearNewLogicRules()\n\t{\n\t\tclearTimeout(this.rerenderTimeout);\n\t\tthis.rerenderTimeout = null;\n\t\tthis.waitingForUserMediaTimeouts.forEach(timeout => clearTimeout(timeout));\n\t\tthis.waitingForUserMediaTimeouts.clear();\n\t\tthis.rerenderQueue.clear();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.closeCopilotNotify();\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t}\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tDom.remove(this.elements.root);\n\t\t\tthis.elements.root = null;\n\t\t}\n\t\tthis.visible = false;\n\n\t\tthis.clearNewLogicRules();\n\n\t\twindow.removeEventListener(\"webkitfullscreenchange\", this._onFullScreenChangeHandler);\n\t\twindow.removeEventListener(\"mozfullscreenchange\", this._onFullScreenChangeHandler);\n\t\twindow.removeEventListener(\"orientationchange\", this._onOrientationChangeHandler);\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDownHandler);\n\t\twindow.removeEventListener(\"keyup\", this._onKeyUpHandler);\n\n\t\tdocument.removeEventListener('mousemove', this.onMouseMoveHandler);\n\t\tthis.resizeObserver.disconnect();\n\t\tthis.resizeObserver = null;\n\t\tif (this.intersectionObserver)\n\t\t{\n\t\t\tthis.intersectionObserver.disconnect();\n\t\t\tthis.intersectionObserver = null;\n\t\t}\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].destroy();\n\t\t\t}\n\t\t}\n\t\tthis.userData = null;\n\t\tthis.centralUser.destroy();\n\t\tthis.hintManager.hide();\n\t\tthis.hintManager = null;\n\n\t\tclearTimeout(this.switchPresenterTimeout);\n\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.stopViewUpdate();\n\t\t}\n\t\tthis.recordState = this.getDefaultRecordState();\n\t\tthis.buttons = null;\n\n\t\tthis.eventEmitter.emit(EventName.onDestroy);\n\t\tthis.eventEmitter.unsubscribeAll();\n\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setCameraState);\n\t};\n\n\tstatic Layout = Layouts;\n\tstatic Size = Size;\n\tstatic RecordState = RecordState;\n\tstatic RecordType = RecordType;\n\n\tstatic RecordSource = {\n\t\tChat: 'BXCLIENT_CHAT'\n\t};\n\n\tstatic UiState = UiState;\n\tstatic Event = EventName;\n\tstatic RoomState = RoomState;\n\tstatic DeviceSelector = DeviceSelector;\n\tstatic NotificationManager = NotificationManager;\n\tstatic MIN_WIDTH = MIN_WIDTH\n}\n","import {Type} from 'main.core'\n\nconst VOLUME_THRESHOLD = 0.02;\nconst INACTIVITY_TIME = 2000;\nconst AVERAGING_COEFFICIENT = 0.6; // from 0 to 1;\n\n/**\n * Naive voice activity detection\n * @param {object} config\n * @param {MediaStream} config.mediaStream\n * @param {function} config.onVoiceStarted\n * @param {function} config.onVoiceStopped\n * @constructor\n */\nexport class SimpleVAD\n{\n\tconstructor(config)\n\t{\n\t\tif (!(config.mediaStream instanceof MediaStream))\n\t\t{\n\t\t\tthrow new Error(\"config.mediaStream should be instance of MediaStream\");\n\t\t}\n\n\t\tif (config.mediaStream.getAudioTracks().length === 0)\n\t\t{\n\t\t\tthrow new Error(\"config.mediaStream should contain audio track\");\n\t\t}\n\n\t\tthis.mediaStream = new MediaStream();\n\t\tthis.mediaStream.addTrack(config.mediaStream.getAudioTracks()[0].clone());\n\t\tthis.audioContext = null;\n\t\tthis.mediaStreamNode = null;\n\t\tthis.analyserNode = null;\n\n\t\tthis.audioTimeDomainData = null;\n\t\tthis.voiceState = false;\n\n\t\tthis.measureInterval = 0;\n\t\tthis.inactivityTimeout = 0;\n\n\t\tthis.currentVolume = 0;\n\n\t\tthis.callbacks = {\n\t\t\tvoiceStarted: Type.isFunction(config.onVoiceStarted) ? config.onVoiceStarted : BX.DoNothing,\n\t\t\tvoiceStopped: Type.isFunction(config.onVoiceStopped) ? config.onVoiceStopped : BX.DoNothing\n\t\t};\n\n\t\tif (SimpleVAD.isSupported())\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\t};\n\n\tstatic isSupported()\n\t{\n\t\treturn (\n\t\t\t(window.AudioContext || window.webkitAudioContext)\n\t\t\t&& window.AnalyserNode\n\t\t\t&& typeof (window.AnalyserNode.prototype['getFloatTimeDomainData']) === \"function\"\n\t\t);\n\t};\n\n\tinit()\n\t{\n\t\tthis.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n\t\tthis.analyserNode = this.audioContext.createAnalyser();\n\t\tthis.analyserNode.fftSize = 128;\n\t\tthis.mediaStreamNode = this.audioContext.createMediaStreamSource(this.mediaStream);\n\t\tthis.mediaStreamNode.connect(this.analyserNode);\n\n\t\tthis.audioTimeDomainData = new Float32Array(this.analyserNode.fftSize);\n\t\tthis.measureInterval = setInterval(this.analyzeAudioStream.bind(this), 100);\n\t};\n\n\tanalyzeAudioStream()\n\t{\n\t\tthis.analyserNode.getFloatTimeDomainData(this.audioTimeDomainData);\n\t\tthis.updateCurrentVolume(this.audioTimeDomainData);\n\n\t\tthis.setVoiceState(this.currentVolume >= VOLUME_THRESHOLD);\n\t};\n\n\tsetVoiceState(voiceState)\n\t{\n\t\tif (this.voiceState == voiceState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (voiceState)\n\t\t{\n\t\t\tthis.callbacks.voiceStarted();\n\t\t\tclearTimeout(this.inactivityTimeout);\n\t\t\tthis.inactivityTimeout = 0;\n\t\t\tthis.voiceState = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.inactivityTimeout)\n\t\t\t{\n\t\t\t\tthis.inactivityTimeout = setTimeout(this.onInactivityTimeout.bind(this), INACTIVITY_TIME);\n\t\t\t}\n\t\t}\n\t};\n\n\tonInactivityTimeout()\n\t{\n\t\tthis.inactivityTimeout = 0;\n\t\tthis.voiceState = false;\n\t\tthis.callbacks.voiceStopped();\n\t};\n\n\tupdateCurrentVolume(audioTimeDomainData)\n\t{\n\t\tlet sum = 0;\n\n\t\tfor (let i = 0; i < audioTimeDomainData.length; i++)\n\t\t{\n\t\t\tsum += audioTimeDomainData[i] * audioTimeDomainData[i];\n\t\t}\n\n\t\tconst rms = Math.sqrt(sum / audioTimeDomainData.length);\n\t\tthis.currentVolume = Math.max(rms, this.currentVolume * AVERAGING_COEFFICIENT);\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.analyserNode)\n\t\t{\n\t\t\tthis.analyserNode.disconnect();\n\t\t}\n\n\t\tif (this.mediaStreamNode)\n\t\t{\n\t\t\tthis.mediaStreamNode.disconnect();\n\t\t}\n\n\t\tif (this.audioContext)\n\t\t{\n\t\t\tthis.audioContext.close();\n\t\t}\n\n\t\tif (this.mediaStream)\n\t\t{\n\t\t\tthis.mediaStream.getTracks().forEach(track => track.stop());\n\t\t\tthis.mediaStream = null;\n\t\t}\n\n\t\tclearInterval(this.measureInterval);\n\n\t\tthis.analyserNode = null;\n\t\tthis.mediaStreamNode = null;\n\t\tthis.audioContext = null;\n\n\t\tthis.callbacks = {\n\t\t\tvoiceStarted: BX.DoNothing,\n\t\t\tvoiceStopped: BX.DoNothing\n\t\t}\n\t}\n}\n\n","import {Browser, Type, Runtime} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {CallEngine, CallState, CallEvent, UserState, Provider} from './engine';\nimport {View} from '../view/view';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../hardware';\nimport Util from '../util'\nimport {MediaStreamsKinds} from '../call_api';\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tcancel: 'im.call.cancel',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping',\n\tnegotiationNeeded: 'im.call.negotiationNeeded',\n\tconnectionOffer: 'im.call.connectionOffer',\n\tconnectionAnswer: 'im.call.connectionAnswer',\n\ticeCandidate: 'im.call.iceCandidate'\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\tnegotiationNeeded: 'Call::negotiationNeeded',\n\tconnectionOffer: 'Call::connectionOffer',\n\tconnectionAnswer: 'Call::connectionAnswer',\n\ticeCandidate: 'Call::iceCandidate',\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\trecordState: 'Call::recordState',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tcustomMessage: 'Call::customMessage',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout'\n};\n\nconst defaultConnectionOptions = {\n\tofferToReceiveVideo: true,\n\tofferToReceiveAudio: true\n};\n\nconst signalingConnectionRefreshPeriod = 30000;\nconst signalingWaitReplyPeriod = 10000;\n//var signalingWaitReplyPeriod = 5000;\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n * - setMuted\n * - setVideoEnabled\n * - setCameraId\n * - setMicrophoneId\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onUserVoiceStarted\n * - onUserVoiceStopped\n * - onLocalMediaReceived\n * - onLocalMediaStopped\n * - onLocalMediaError\n * - onDeviceListUpdated\n * - onDestroy\n */\n\nexport class PlainCall extends AbstractCall\n{\n\tpeers: {[key: number]: Peer}\n\n\tconstructor(params)\n\t{\n\t\tsuper(params)\n\n\t\tthis.callFromMobile = params.callFromMobile;\n\t\tthis.state = params.state || '';\n\n\t\tthis.peers = this.initPeers(this.users);\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.recordState = {\n\t\t\tstate: 'stopped',\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: []\n\t\t\t},\n\t\t}\n\n\t\tthis.deviceList = [];\n\n\t\tthis.turnServer = (Browser.isFirefox() ? BX.message('turn_server_firefox') : BX.message('turn_server')) || 'turn.calls.bitrix24.com';\n\t\tthis.turnServerLogin = BX.message('turn_server_login') || 'bitrix';\n\t\tthis.turnServerPassword = BX.message('turn_server_password') || 'bitrix';\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.reinviteTimeout = null;\n\t\tthis.userData = params.userData;\n\n\t\tthis._onUnloadHandler = this.#onUnload.bind(this);\n\n\t\tthis.enableMicAutoParameters = params.enableMicAutoParameters !== false;\n\t\tthis.microphoneLevelInterval = null;\n\t\tthis.mediaMutedBySystem = false;\n\n\t\tthis._reconnectionEventCount = 0;\n\n\t\tthis._isCopilotActive = false;\n\t\tthis._isCopilotFeaturesEnabled = false;\n\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = null;\n\t\tthis._isBoostExpired = false;\n\n\t\twindow.addEventListener(\"unload\", this._onUnloadHandler);\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Plain;\n\t}\n\n\tget isCopilotActive()\n\t{\n\t\treturn this._isCopilotActive;\n\t}\n\n\tset isCopilotActive(isCopilotActive)\n\t{\n\t\tif (isCopilotActive !== this._isCopilotActive)\n\t\t{\n\t\t\tthis._isCopilotActive = isCopilotActive;\n\t\t}\n\t}\n\n\tget isBoostExpired()\n\t{\n\t\treturn this._isBoostExpired;\n\t}\n\n\tset isBoostExpired(isBoostExpired)\n\t{\n\t\tif (isBoostExpired !== this._isBoostExpired)\n\t\t{\n\t\t\tthis._isBoostExpired = isBoostExpired;\n\t\t}\n\t}\n\n\tget isCopilotFeaturesEnabled()\n\t{\n\t\treturn this._isCopilotFeaturesEnabled;\n\t}\n\n\tset isCopilotFeaturesEnabled(isCopilotFeaturesEnabled)\n\t{\n\t\tif (isCopilotFeaturesEnabled !== this._isCopilotFeaturesEnabled)\n\t\t{\n\t\t\tthis._isCopilotFeaturesEnabled = isCopilotFeaturesEnabled;\n\t\t}\n\t}\n\n\tget isRecordWhenCopilotActivePopupAlreadyShow()\n\t{\n\t\treturn this._isRecordWhenCopilotActivePopupAlreadyShow;\n\t}\n\n\tset isRecordWhenCopilotActivePopupAlreadyShow(isRecordWhenCopilotActivePopupAlreadyShow)\n\t{\n\t\tif (isRecordWhenCopilotActivePopupAlreadyShow !== this._isRecordWhenCopilotActivePopupAlreadyShow)\n\t\t{\n\t\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = isRecordWhenCopilotActivePopupAlreadyShow;\n\t\t}\n\t}\n\n\tinitPeers(userIds)\n\t{\n\t\tlet peers = {};\n\t\tfor (let i = 0; i < userIds.length; i++)\n\t\t{\n\t\t\tconst userId = Number(userIds[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tpeers[userId] = this.createPeer(userId);\n\t\t}\n\t\treturn peers;\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tsignalingConnected: userId == this.initiatorId,\n\t\t\tisLegacyMobile: userId == this.initiatorId && this.callFromMobile,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t},\n\t\t\tonMediaStopped: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged.bind(this),\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout.bind(this),\n\t\t\tonRTCStatsReceived: this.#onPeerRTCStatsReceived.bind(this),\n\t\t\tonRTCQualityChanged: this.#onPeerRTCQualityChanged.bind(this),\n\t\t\tonNetworkProblem: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onNetworkProblem, e)\n\t\t\t},\n\t\t\tonReconnecting: () =>\n\t\t\t{\n\t\t\t\tthis._reconnectionEventCount++;\n\t\t\t\tthis.runCallback(CallEvent.onReconnecting, {\n\t\t\t\t\treconnectionEventCount: this._reconnectionEventCount,\n\t\t\t\t});\n\t\t\t},\n\t\t\tonReconnected: () =>\n\t\t\t{\n\t\t\t\tthis._reconnectionEventCount = 0;\n\t\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t\t},\n\t\t\tonUpdateLastUsedCameraId: () =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUpdateLastUsedCameraId);\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * Returns call participants and their states\n\t * @return {object} userId => user state\n\t */\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\t\treturn result;\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\t\tconst hasVideoTracks = this.localStreams['main'] && this.localStreams['main'].getVideoTracks().length > 0;\n\n\t\tif (this.ready && hasVideoTracks !== this.videoEnabled)\n\t\t{\n\t\t\tthis.replaceLocalMediaStream().then(() =>\n\t\t\t{\n\t\t\t\tthis.signaling.sendCameraState(this.users, this.videoEnabled);\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: this.localStreams['main'] || new MediaStream(),\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\tcanChangeMediaDevices()\n\t{\n\t\treturn !this.mediaMutedBySystem;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted == event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\t\tif (this.localStreams[\"main\"])\n\t\t{\n\t\t\tconst audioTracks = this.localStreams[\"main\"].getAudioTracks();\n\t\t\tif (audioTracks[0])\n\t\t\t{\n\t\t\t\taudioTracks[0].enabled = !this.muted;\n\t\t\t}\n\t\t}\n\n\t\tthis.signaling.sendMicrophoneState(this.users, !this.muted);\n\t\tthis.sendTalkingState();\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.ready && this.mediaMutedBySystem)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onNeedResetMediaDevicesState);\n\t\t\tthis.changedMediaMutedBySystem(false);\n\t\t}\n\t\telse if (this.ready && Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.runCallback('onUpdateLastUsedCameraId');\n\t\t\tRuntime.debounce(this.replaceLocalMediaStream, 100, this)();\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\t\tif (this.ready)\n\t\t{\n\t\t\tif (this.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tRuntime.debounce(this.replaceLocalAudioStream, 100, this)();\n\t\t}\n\t};\n\n\tgetCurrentMicrophoneId()\n\t{\n\t\tif (!this.localStreams['main'])\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\n\t\tconst audioTracks = this.localStreams['main'].getAudioTracks();\n\t\tif (audioTracks.length > 0)\n\t\t{\n\t\t\tconst audioTrackSettings = audioTracks[0].getSettings();\n\t\t\treturn audioTrackSettings.deviceId;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\t};\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\trecordState.senderId = this.userId;\n\n\t\tif (!this.#changeRecordState(recordState))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst users = [this.userId].concat(this.users);\n\t\tthis.signaling.sendRecordState(users, this.recordState);\n\t};\n\n\tstopSendingStream(tag)\n\t{\n\t\t//todo: implement\n\t};\n\n\tallowVideoFrom(userList)\n\t{\n\t\t//todo: implement\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t **/\n\tinviteUsers(config: {users: number[], localStream: MediaStream} = {})\n\t{\n\t\tconst users = Type.isArray(config.users) ? config.users : Object.keys(this.peers);\n\t\tthis.ready = true;\n\n\t\tif (config.localStream instanceof MediaStream && !this.localStreams[\"main\"])\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\tthis.getLocalMediaStream(\"main\", true).then(() =>\n\t\t{\n\t\t\tif (!this.ready)\n\t\t\t{\n\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\tuserIds: users,\n\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N'\n\t\t\t});\n\t\t}).then(() =>\n\t\t{\n\t\t\tthis.state = CallState.Connected;\n\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\tlocal: true\n\t\t\t});\n\n\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t{\n\t\t\t\tconst userId = Number(users[i]);\n\t\t\t\tif (!this.peers[userId])\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.peers[userId].onInvited();\n\n\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t}\n\t\t}).catch((e) =>\n\t\t{\n\t\t\tconsole.error(e);\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t});\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(this.repeatInviteUsers.bind(this), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling\n\t\t\t.inviteUsers({\n\t\t\t\tuserIds: usersToRepeatInvite,\n\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\t\trepeated: 'Y',\n\t\t\t})\n\t\t\t.then(() => this.scheduleRepeatInvite());\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tgetMediaConstraints(options = {})\n\t{\n\t\tconst audio = {};\n\t\tconst video = options.videoEnabled ? {} : false;\n\t\tconst hdVideo = !!options.hdVideo;\n\t\tconst supportedConstraints = navigator.mediaDevices.getSupportedConstraints ? navigator.mediaDevices.getSupportedConstraints() : {};\n\n\t\tif (this.microphoneId)\n\t\t{\n\t\t\taudio.deviceId = {ideal: this.microphoneId};\n\t\t}\n\n\t\tif (!this.enableMicAutoParameters)\n\t\t{\n\t\t\tif (supportedConstraints.echoCancellation)\n\t\t\t{\n\t\t\t\taudio.echoCancellation = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.noiseSuppression)\n\t\t\t{\n\t\t\t\taudio.noiseSuppression = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.autoGainControl)\n\t\t\t{\n\t\t\t\taudio.autoGainControl = false;\n\t\t\t}\n\t\t}\n\n\t\tif (video)\n\t\t{\n\t\t\t//video.aspectRatio = 1.7777777778;\n\t\t\tif (this.cameraId)\n\t\t\t{\n\t\t\t\tvideo.deviceId = {exact: this.cameraId};\n\t\t\t}\n\n\t\t\tif (hdVideo)\n\t\t\t{\n\t\t\t\tvideo.width = {ideal: 1280};\n\t\t\t\tvideo.height = {ideal: 720};\n\t\t\t}\n\t\t}\n\n\t\treturn {audio: audio, video: video};\n\t};\n\n\t/**\n\t * Recursively tries to get user media stream with array of constraints\n\t *\n\t * @param constraintsArray array of constraints objects\n\t * @returns {Promise}\n\t */\n\tgetUserMedia(constraintsArray)\n\t{\n\t\treturn new Promise(function (resolve, reject)\n\t\t{\n\t\t\tconst currentConstraints = constraintsArray[0];\n\t\t\tnavigator.mediaDevices.getUserMedia(currentConstraints).then(\n\t\t\t\tfunction (stream)\n\t\t\t\t{\n\t\t\t\t\tresolve(stream);\n\t\t\t\t},\n\t\t\t\tfunction (error)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"getUserMedia error: \", error);\n\t\t\t\t\tthis.log(\"Current constraints\", currentConstraints);\n\t\t\t\t\tif (constraintsArray.length > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getUserMedia(constraintsArray.slice(1)).then(\n\t\t\t\t\t\t\tfunction (stream)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(stream);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction (error)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.log(\"Last fallback constraints used, failing\");\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t)\n\t\t}.bind(this))\n\t};\n\n\tgetLocalMediaStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: tag,\n\t\t\t\tstream: this.localStreams[tag]\n\t\t\t});\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log(\"Requesting access to media devices\");\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet constraintsArray = [];\n\t\t\tif (Hardware.isCameraOn)\n\t\t\t{\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: true, hdVideo: true}));\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: true, hdVideo: false}));\n\t\t\t\tif (fallbackToAudio)\n\t\t\t\t{\n\t\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: false}));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: false}));\n\t\t\t}\n\n\t\t\tthis.getUserMedia(constraintsArray).then((stream) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Local media stream received\");\n\t\t\t\tthis.localStreams[tag] = stream;\n\t\t\t\tstream.getVideoTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalVideoTrackEnded());\n\t\t\t\t\ttrack.addEventListener(\"mute\", () => this.onLocalVideoTrackMute());\n\t\t\t\t\ttrack.addEventListener(\"unmute\", () => this.onLocalVideoTrackUnmute());\n\t\t\t\t});\n\n                stream.getAudioTracks().forEach((track) =>\n                {\n                    track.addEventListener(\"ended\", () => this.onLocalAudioTrackEnded())\n                });\n\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\tstream: stream\n\t\t\t\t});\n\t\t\t\tthis.setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (Hardware.isMicrophoneMuted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tnavigator.mediaDevices.enumerateDevices().then((deviceList) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Could not get local media stream.\", e);\n\t\t\t\tthis.log(\"Request constraints: .\", constraintsArray);\n\t\t\t\tthis.runCallback(\"onLocalMediaError\", {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tgetLocalAudioStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\t\tif (this.localStreams[tag] && this.localStreams[tag].getAudioTracks().length)\n\t\t{\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log(\"Requesting access to audio devices\");\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet constraintsArray = [this.getMediaConstraints({videoEnabled: false})];\n\n\t\t\tthis.getUserMedia(constraintsArray).then((stream) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Local audio stream received\");\n\n\t\t\t\tif (!this.localStreams[tag]) {\n\t\t\t\t\tthis.localStreams[tag] = new MediaStream();\n\t\t\t\t}\n\n\t\t\t\tthis.localStreams[tag].addTrack(stream.getAudioTracks()[0]);\n\t\t\t\tstream.getAudioTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalAudioTrackEnded())\n\t\t\t\t});\n\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (this.muted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tnavigator.mediaDevices.enumerateDevices().then((deviceList) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Could not get local audio stream.\", e);\n\t\t\t\tthis.log(\"Request constraints: .\", constraintsArray);\n\t\t\t\tthis.runCallback(\"onLocalMediaError\", {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsetPublishingState(deviceType, publishing)\n\t{\n\t\tif (deviceType === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCameraPublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t\telse if (deviceType === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onMicrophonePublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t}\n\n\tstartMediaCapture()\n\t{\n\t\treturn this.getLocalMediaStream();\n\t};\n\n\tattachVoiceDetection()\n\t{\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t}\n\t\tif (this.microphoneLevelInterval)\n\t\t{\n\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tthis.voiceDetection = new SimpleVAD({\n\t\t\t\tmediaStream: this.localStreams['main'],\n\t\t\t\tonVoiceStarted: this.onLocalVoiceStarted.bind(this),\n\t\t\t\tonVoiceStopped: this.onLocalVoiceStopped.bind(this)\n\t\t\t})\n\n\t\t\tthis.microphoneLevelInterval = setInterval(function ()\n\t\t\t{\n\t\t\t\tthis.microphoneLevel = this.voiceDetection.currentVolume;\n\t\t\t}.bind(this), 200)\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Could not attach voice detection to media stream');\n\t\t}\n\t};\n\n\tgetDisplayMedia()\n\t{\n\t\treturn new Promise(function (resolve, reject)\n\t\t{\n\t\t\tif (window[\"BXDesktopSystem\"] && window[\"BXDesktopSystem\"].GetProperty('versionParts')[3] < 78) {\n\t\t\t\tnavigator.mediaDevices.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\tchromeMediaSource: 'screen',\n\t\t\t\t\t\t\tmaxWidth: 1920,\n\t\t\t\t\t\t\tmaxHeight: 1080,\n\t\t\t\t\t\t\tmaxFrameRate: 5\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(\n\t\t\t\t\tfunction (stream)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(stream)\n\t\t\t\t\t},\n\t\t\t\t\tfunction (error)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(error)\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (navigator.mediaDevices.getDisplayMedia)\n\t\t\t{\n\t\t\t\tnavigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always',\n\t\t\t\t\t\twidth: {\n\t\t\t\t\t\t\tideal: 1920\n\t\t\t\t\t\t},\n\t\t\t\t\t\theight: {\n\t\t\t\t\t\t\tideal: 1080\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsystemAudio: \"include\",\n\t\t\t\t\taudio: true,\n\t\t\t\t}).then(\n\t\t\t\t\tfunction (stream)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(stream)\n\t\t\t\t\t},\n\t\t\t\t\tfunction (error)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(error)\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error(\"Screen sharing is not supported\");\n\t\t\t\treject(\"Screen sharing is not supported\");\n\t\t\t}\n\t\t})\n\t};\n\n\tstartScreenSharing(changeSource)\n\t{\n\t\tchangeSource = !!changeSource;\n\t\tif (this.localStreams[\"screen\"] && !changeSource)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getDisplayMedia().then((stream) =>\n\t\t{\n\t\t\tthis.localStreams[\"screen\"] = stream;\n\n\t\t\tstream.getVideoTracks().forEach((track) =>\n\t\t\t{\n\t\t\t\ttrack.addEventListener(\"ended\", () => this.stopScreenSharing())\n\t\t\t});\n\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tscreenState: true,\n\t\t\t});\n\n\t\t\tif (this.ready)\n\t\t\t{\n\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t{\n\t\t\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}).catch((e) =>\n\t\t{\n\t\t\tthis.log(e);\n\t\t});\n\t};\n\n    onLocalVideoTrackEnded()\n    {\n        if (!this.localStreams[\"main\"])\n        {\n            return;\n        }\n\n        Util.stopMediaStreamVideoTracks(this.localStreams[\"main\"])\n\n        this.runCallback(CallEvent.onLocalMediaReceived, {\n            tag: 'main',\n            stream: this.localStreams[\"main\"]\n        });\n\n        if (!this.localStreams[\"main\"].getAudioTracks().length)\n        {\n            this.localStreams[\"main\"] = null;\n        }\n\n        for (let userId in this.peers)\n        {\n            if (this.peers[userId].calculatedState === UserState.Connected)\n            {\n                this.peers[userId].sendMedia();\n            }\n        }\n    }\n\n    onLocalAudioTrackEnded()\n    {\n        if (!this.localStreams[\"main\"])\n        {\n            return;\n        }\n\n        Util.stopMediaStreamAudioTracks(this.localStreams[\"main\"])\n\n        this.runCallback(CallEvent.onLocalMediaReceived, {\n            tag: 'main',\n            stream: this.localStreams[\"main\"]\n        });\n\n\t\tif (!this.localStreams[\"main\"].getVideoTracks().length)\n\t\t{\n            this.localStreams[\"main\"] = null;\n        }\n\n        for (let userId in this.peers)\n        {\n            if (this.peers[userId].calculatedState === UserState.Connected)\n            {\n                this.peers[userId].sendMedia();\n            }\n        }\n    }\n\n\tonLocalVideoTrackMute()\n\t{\n\t\tthis.changedMediaMutedBySystem(true);\n\t\tthis.prevMainStream = this.localStreams['main'];\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.localStreams['main'] = null;\n\t\t\tfor (let userId in this.peers)\n\t\t\t{\n\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId].replaceMediaStream('main');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tonLocalVideoTrackUnmute()\n\t{\n\t\tthis.changedMediaMutedBySystem(false);\n\n\t\tif (this.prevMainStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.prevMainStream);\n\t\t\tthis.prevMainStream = null;\n\t\t}\n\n\t\tthis.replaceLocalMediaStream().catch(() =>\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: 'main',\n\t\t\t\tstream: this.localStreams['main'] || new MediaStream(),\n\t\t\t});\n\t\t});\n\t};\n\n\tchangedMediaMutedBySystem(muted)\n\t{\n\t\tthis.mediaMutedBySystem = muted;\n\t\tconst microphoneState = muted ? false : !Hardware.isMicrophoneMuted;\n\t\tconst cameraState = muted ? false : Hardware.isCameraOn;\n\t\tthis.signaling.sendMicrophoneState(this.users, microphoneState);\n\t\tthis.signaling.sendCameraState(this.users, cameraState);\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tif (!this.localStreams[\"screen\"])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.stopMediaStream(this.localStreams[\"screen\"])\n\t\tthis.localStreams[\"screen\"] = null;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: false,\n\t\t});\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.localStreams[\"screen\"] instanceof MediaStream;\n\t};\n\n\tonLocalVoiceStarted()\n\t{\n\t\tthis.talking = true;\n\t\tthis.sendTalkingState();\n\t};\n\n\tonLocalVoiceStopped()\n\t{\n\t\tthis.talking = false;\n\t\tthis.sendTalkingState();\n\t};\n\n\tsendTalkingState()\n\t{\n\t\tif (this.talking && !Hardware.isMicrophoneMuted)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStarted({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStopped({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t}\n\n\tsendCustomMessage(message)\n\t{\n\t\tthis.signaling.sendCustomMessage({\n\t\t\tuserId: this.users,\n\t\t\tmessage: message\n\t\t});\n\t}\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool} [config.useVideo]\n\t * @param {bool} [config.enableMicAutoParameters]\n\t * @param {MediaStream} [config.localStream]\n\t */\n\tanswer(config)\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\t\t/*if(this.direction !== Direction.Incoming)\n\t\t{\n\t\t\tthrow new Error('Only incoming call could be answered');\n\t\t}*/\n\n\t\tthis.ready = true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\t\tthis.enableMicAutoParameters = (config.enableMicAutoParameters !== false);\n\n\t\tif (config.localStream instanceof MediaStream)\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(\"main\", true)\n\t\t\t\t.then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.ready)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\t\t\tthis.state = CallState.Connected;\n\n\t\t\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn this.sendAnswer();\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.then(() => resolve())\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t\t\t\treject(e)\n\t\t\t\t});\n\t\t});\n\t};\n\n\tsendAnswer()\n\t{\n\t\tthis.signaling.sendAnswer();\n\t};\n\n\tdecline(code, reason)\n\t{\n\t\tthis.ready = false;\n\n\t\tlet data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data).then(() =>\n\t\t{\n\t\t\tthis.destroy();\n\t\t});\n\t};\n\n\thangup(force = false)\n\t{\n\t\tif (!this.ready && !force)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn Promise.reject(error);\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tthis.ready = false;\n\t\tthis.state = CallState.Proceeding;\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tfor (let userId in this.peers)\n\t\t\t{\n\t\t\t\tthis.peers[userId].disconnect();\n\t\t\t}\n\n\t\t\tthis.#beforeLeaveCall();\n\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t\tthis.signaling.sendHangup({userId: this.users})\n\t\t\t\t.then(() => resolve())\n\t\t\t\t.catch(e => reject(e))\n\t\t\t;\n\t\t});\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToUsers({userId: this.users.concat(this.userId)});\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tgetState()\n\t{\n\n\t};\n\n\treplaceLocalMediaStream(tag: string = \"main\")\n\t{\n\t\tthis.setPublishingState(MediaStreamsKinds.Camera, true);\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t\tif (this.mediaMutedBySystem)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.changedMediaMutedBySystem(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\treplaceLocalAudioStream(tag: string = \"main\")\n\t{\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStreamAudioTracks(this.localStreams[tag]);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalAudioStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsendAllStreams(userId)\n\t{\n\t\tif (!this.peers[userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[userId].isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.peers[userId].calculatedState !== UserState.Calling)\n\t\t\t{\n\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t}\n\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t#changeRecordState(params)\n\t{\n\t\tif (params.action !== View.RecordState.Started && this.recordState.userId != params.senderId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.action === View.RecordState.Started)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tthis.recordState.userId = params.senderId;\n\t\t\tthis.recordState.date.start = params.date;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\t\telse if (params.action === View.RecordState.Paused)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Started)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Paused;\n\t\t\tthis.recordState.date.pause.push(\n\t\t\t\t{start: params.date, finish: null}\n\t\t\t);\n\t\t}\n\t\telse if (params.action === View.RecordState.Resumed)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Paused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tconst pauseElement = this.recordState.date.pause.find(function (element)\n\t\t\t{\n\t\t\t\treturn element.finish === null;\n\t\t\t});\n\t\t\tif (pauseElement)\n\t\t\t{\n\t\t\t\tpauseElement.finish = params.date;\n\t\t\t}\n\t\t}\n\t\telse if (params.action === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Stopped;\n\t\t\tthis.recordState.userId = 0;\n\t\t\tthis.recordState.date.start = null;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tconst handlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer.bind(this),\n\t\t\t'Call::hangup': this.#onPullEventHangup.bind(this),\n\t\t\t'Call::ping': this.#onPullEventPing.bind(this),\n\t\t\t'Call::negotiationNeeded': this.#onPullEventNegotiationNeeded.bind(this),\n\t\t\t'Call::connectionOffer': this.#onPullEventConnectionOffer.bind(this),\n\t\t\t'Call::connectionAnswer': this.#onPullEventConnectionAnswer.bind(this),\n\t\t\t'Call::iceCandidate': this.#onPullEventIceCandidate.bind(this),\n\t\t\t'Call::voiceStarted': this.#onPullEventVoiceStarted.bind(this),\n\t\t\t'Call::voiceStopped': this.#onPullEventVoiceStopped.bind(this),\n\t\t\t'Call::microphoneState': this.#onPullEventMicrophoneState.bind(this),\n\t\t\t'Call::cameraState': this.#onPullEventCameraState.bind(this),\n\t\t\t'Call::videoPaused': this.#onPullEventVideoPaused.bind(this),\n\t\t\t'Call::recordState': this.#onPullEventRecordState.bind(this),\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined.bind(this),\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited.bind(this),\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout.bind(this),\n\t\t\t'Call::associatedEntityReplaced': this.#onPullEventAssociatedEntityReplaced.bind(this),\n\t\t\t'Call::finish': this.#onPullEventFinish.bind(this),\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer.bind(this),\n\t\t\t'Call::customMessage': this.#onPullEventCallCustomMessage.bind(this),\n\t\t};\n\n\t\tif (handlers[command])\n\t\t{\n\t\t\tif (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tif (params.senderId != this.userId || params.instanceId != this.instanceId)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Signaling: ping from user \" + params.senderId);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\thandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addInvitedUsers(users);\n\t};\n\n\t#onPullEventUserInviteTimeout(params)\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventAnswer(params)\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.#onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peers[senderId].isReady())\n\t\t{\n\t\t\tthis.log(\"Received answer for user \" + senderId + \" in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].setSignalingConnected(true);\n\t\tthis.peers[senderId].setReady(true);\n\t\tthis.peers[senderId].isLegacyMobile = params.isLegacyMobile === true;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.sendAllStreams(senderId);\n\t\t}\n\t};\n\n\t#onPullEventAnswerSelf(params)\n\t{\n\t\tthis.runCallback('onGetUserMediaEnded', {});\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.log(\"Received remote self-answer in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.log(\"Call was answered elsewhere\");\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup(params)\n\t{\n\t\tconst senderId = params.senderId;\n\n\t\tif (this.userId == senderId)\n\t\t{\n\t\t\tif (this.instanceId != params.callInstanceId)\n\t\t\t{\n\t\t\t\t// self hangup elsewhere\n\t\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].disconnect(params.code);\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\n\t\tif (!this.isAnyoneParticipating() && this.ready)\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventPing(params)\n\t{\n\t\tif (params.callInstanceId == this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setSignalingConnected(true);\n\t};\n\n\t#onPullEventNegotiationNeeded(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet peer: Peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tif (params.restart)\n\t\t{\n\t\t\tpeer.reconnect()\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpeer.onNegotiationNeeded();\n\t\t}\n\t};\n\n\t#onPullEventConnectionOffer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionOffer(params.connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventConnectionAnswer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst connectionId = params.connectionId;\n\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionAnswer(connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventIceCandidate(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tlet candidates;\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tcandidates = params.candidates;\n\t\t\tfor (let i = 0; i < candidates.length; i++)\n\t\t\t{\n\t\t\t\tpeer.addIceCandidate(params.connectionId, candidates[i]);\n\t\t\t}\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Error parsing serialized candidate: ', e);\n\t\t}\n\t};\n\n\t#onPullEventVoiceStarted(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventVoiceStopped(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventMicrophoneState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\tuserId: params.senderId,\n\t\t\tmicrophoneState: params.microphoneState\n\t\t})\n\t};\n\n\t#onPullEventCameraState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\tuserId: params.senderId,\n\t\t\tcameraState: params.cameraState\n\t\t})\n\t};\n\n\t#onPullEventVideoPaused(params)\n\t{\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\tuserId: params.senderId,\n\t\t\tvideoPaused: params.videoPaused\n\t\t});\n\n\t\tpeer.holdOutgoingVideo(!!params.videoPaused);\n\t};\n\n\t#onPullEventRecordState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\tuserId: params.senderId,\n\t\t\trecordState: params.recordState\n\t\t})\n\t};\n\n\t#onPullEventAssociatedEntityReplaced(params)\n\t{\n\t\tif (params.call && params.call.ASSOCIATED_ENTITY)\n\t\t{\n\t\t\tthis.associatedEntity = params.call.ASSOCIATED_ENTITY;\n\t\t}\n\t};\n\n\t#onPullEventFinish()\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t};\n\n\t#onPullEventCallCustomMessage(params)\n\t{\n\t\tthis.runCallback(CallEvent.onCustomMessage, {message: params.message});\n\t}\n\n\t#onPeerStateChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (e.state == UserState.Failed || e.state == UserState.Unavailable)\n\t\t{\n\t\t\tif (!this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup().then(this.destroy.bind(this)).catch(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\t//this.runCallback(Event.onCallFailure, e);\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(e.userId, !Hardware.isMicrophoneMuted);\n\t\t\tthis.signaling.sendCameraState(e.userId, Hardware.isCameraOn);\n\t\t\tthis.wasConnected = true;\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout(e)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t#onPeerRTCStatsReceived(e)\n\t{\n\t\tconst remoteReportsToShow = {};\n\t\tconst localReportsToShow = {};\n\n\t\te.stats.forEach((report) =>\n\t\t{\n\t\t\tif (report.type === 'inbound-rtp' && (report.kind === 'video' || report.kind === 'audio') && report.source)\n\t\t\t{\n\t\t\t\tremoteReportsToShow[report.source] = report;\n\t\t\t}\n\t\t\tif (report.type === 'outbound-rtp' && (report.kind === 'video' || report.kind === 'audio') && report.source)\n\t\t\t{\n\t\t\t\tlocalReportsToShow[report.source] = report;\n\t\t\t}\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\tuserId: e.userId,\n\t\t\treport: remoteReportsToShow\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\tuserId: this.userId,\n\t\t\treport: localReportsToShow\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onRTCStatsReceived, e);\n\t};\n\n\t#onPeerRTCQualityChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onConnectionQualityChanged, {\n\t\t\tuserId: e.userId,\n\t\t\tscore: e.score,\n\t\t});\n\t}\n\n\t#onUnload()\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.hangup, {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId\n\t\t});\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tthis.peers[userId].disconnect();\n\t\t}\n\t};\n\n\t#beforeLeaveCall()\n\t{\n\t\t// stop media streams\n\t\tthis.unsubscribeHardwareChanges();\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\t\tthis.localStreams[tag] = null;\n\t\t\t}\n\t\t}\n\t\tif (this.prevMainStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.prevMainStream);\n\t\t\tthis.prevMainStream = null;\n\t\t}\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\t// remove all event listeners\n\t\twindow.removeEventListener(\"unload\", this._onUnloadHandler);\n\n\t\tclearInterval(this.statsInterval);\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tclearTimeout(this.reinviteTimeout);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.ready = false;\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Call destroy \\n\" + tempError.stack);\n\n\t\t// stop sending media streams\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.#beforeLeaveCall();\n\n\t\treturn super.destroy();\n\t}\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tisIceTricklingAllowed()\n\t{\n\t\treturn CallEngine.getPullClient().isPublishingSupported();\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendConnectionOffer(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.connectionOffer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.connectionOffer, data);\n\t\t}\n\t};\n\n\tsendConnectionAnswer(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.connectionAnswer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.connectionAnswer, data);\n\t\t}\n\t};\n\n\tsendIceCandidate(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.iceCandidate, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.iceCandidate, data);\n\t\t}\n\t};\n\n\tsendNegotiationNeeded(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.negotiationNeeded, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.negotiationNeeded, data);\n\t\t}\n\t};\n\n\tsendVoiceStarted(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.voiceStarted, data);\n\t\t}\n\t};\n\n\tsendVoiceStopped(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.voiceStopped, data);\n\t\t}\n\t};\n\n\tsendMicrophoneState(users, microphoneState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.microphoneState, {\n\t\t\t\tuserId: users,\n\t\t\t\tmicrophoneState: microphoneState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendCameraState(users, cameraState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.cameraState, {\n\t\t\t\tuserId: users,\n\t\t\t\tcameraState: cameraState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendVideoPaused(users, videoPaused)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.videoPaused, {\n\t\t\t\tuserId: users,\n\t\t\t\tvideoPaused: videoPaused\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendRecordState(users, recordState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.recordState, {\n\t\t\t\tuserId: users,\n\t\t\t\trecordState: recordState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 5);\n\t\t}\n\t};\n\n\tsendCustomMessage(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.customMessage, data, 5);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tconst retransmit = !CallEngine.getPullClient().isPublishingEnabled();\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: retransmit});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data, 3600);\n\t\t\tdata.retransmit = false;\n\t\t\treturn this.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\treturn this.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tif (eventName == 'Call::ping')\n\t\t{\n\t\t\tthis.call.log('Sending p2p signaling event ' + eventName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\t}\n\t\tCallEngine.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tif (signalName == 'Call::ping')\n\t\t{\n\t\t\tthis.call.log('Sending ajax-based signaling event ' + signalName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.call.log('Sending ajax-based signaling event ' + signalName + '; ' + JSON.stringify(data));\n\t\t}\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data).catch(function (e) {console.error(e)});\n\t};\n}\n\nclass Peer\n{\n\tcall: PlainCall\n\tpeerConnection: ?RTCPeerConnection\n\tpeerConnectionId: ?string\n\tvideoSender: ?RTCRtpSender\n\taudioSender: ?RTCRtpSender\n\tscreenSender: ?RTCRtpSender\n\tscreenAudioSender: ?RTCRtpSender\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t\tthis.userId = params.userId;\n\n\t\tthis.ready = params.ready === true;\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.signalingConnected = params.signalingConnected === true;\n\t\tthis.failureReason = '';\n\n\t\tthis.userAgent = '';\n\t\tthis.isFirefox = false;\n\t\tthis.isChrome = false;\n\t\tthis.isLegacyMobile = params.isLegacyMobile === true;\n\n\t\t/*sums up from signaling, ready and connection states*/\n\t\tthis.calculatedState = this.calculateState();\n\n\t\tthis.localStreams = {\n\t\t\tmain: null,\n\t\t\tscreen: null\n\t\t};\n\n\t\tthis.pendingIceCandidates = {};\n\t\tthis.localIceCandidates = [];\n\n\t\tthis.trackList = {};\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaStopped: Type.isFunction(params.onMediaStopped) ? params.onMediaStopped : BX.DoNothing,\n\t\t\tonRTCStatsReceived: Type.isFunction(params.onRTCStatsReceived) ? params.onRTCStatsReceived : BX.DoNothing,\n\t\t\tonRTCQualityChanged: Type.isFunction(params.onRTCQualityChanged) ? params.onRTCQualityChanged : BX.DoNothing,\n\t\t\tonNetworkProblem: Type.isFunction(params.onNetworkProblem) ? params.onNetworkProblem : BX.DoNothing,\n\t\t\tonReconnecting: Type.isFunction(params.onReconnecting) ? params.onReconnecting : BX.DoNothing,\n\t\t\tonReconnected: Type.isFunction(params.onReconnected) ? params.onReconnected : BX.DoNothing,\n\t\t\tonUpdateLastUsedCameraId: Type.isFunction(params.onUpdateLastUsedCameraId) ? params.onUpdateLastUsedCameraId : BX.DoNothing,\n\t\t};\n\n\t\t// intervals and timeouts\n\t\tthis.answerTimeout = null;\n\t\tthis.callingTimeout = null;\n\t\tthis.connectionTimeout = null;\n\t\tthis.signalingConnectionTimeout = null;\n\t\tthis.candidatesTimeout = null;\n\n\t\tthis.statsInterval = null;\n\n\t\tthis.connectionOfferReplyTimeout = null;\n\t\tthis.negotiationNeededReplyTimeout = null;\n\t\tthis.reconnectAfterDisconnectTimeout = null;\n\n\t\tthis.connectionAttempt = 0;\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\n\t\tthis._outgoingVideoTrack = null;\n\t\tObject.defineProperty(this, 'outgoingVideoTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingVideoTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingVideoTrack = track;\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._outgoingScreenTrack = null;\n\t\tObject.defineProperty(this, 'outgoingScreenTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingScreenTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingScreenTrack = track;\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis._incomingAudioTrack = null;\n\t\tthis._incomingScreenAudioTrack = null;\n\t\tthis._incomingVideoTrack = null;\n\t\tthis._incomingScreenTrack = null;\n\t\tObject.defineProperty(this, 'incomingAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingAudioTrack', 'audio')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingVideoTrack', {\n\t\t\tget: this._mediaGetter('_incomingVideoTrack'),\n\t\t\tset: this._mediaSetter('_incomingVideoTrack', 'video')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenTrack', 'screen')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenAudioTrack', 'sharingAudio')\n\t\t});\n\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\t// event handlers\n\t\tthis._onPeerConnectionIceCandidateHandler = this._onPeerConnectionIceCandidate.bind(this);\n\t\tthis._onPeerConnectionConnectionStateChangeHandler = this.#onPeerConnectionConnectionStateChange.bind(this);\n\t\tthis._onPeerConnectionIceGatheringStateChangeHandler = this.#onPeerConnectionIceGatheringStateChange.bind(this);\n\t\tthis._onPeerConnectionSignalingStateChangeHandler = this.#onPeerConnectionSignalingStateChange.bind(this);\n\t\t//this._onPeerConnectionNegotiationNeededHandler = this._onPeerConnectionNegotiationNeeded.bind(this);\n\t\tthis._onPeerConnectionTrackHandler = this.#onPeerConnectionTrack.bind(this);\n\t\tthis._onPeerConnectionRemoveStreamHandler = this.#onPeerConnectionRemoveStream.bind(this);\n\n\t\tthis._updateTracksDebounced = Runtime.debounce(this.#updateTracks.bind(this), 50);\n\n\t\tthis._waitTurnCandidatesTimeout = null;\n\n\t\tthis.prevPercentPacketLostList = {\n\t\t\tincomingPacketLost: [],\n\t\t\toutgoingPacketLost: [],\n\t\t};\n\t\tthis.reportsForIncomingTracks = {};\n\t\tthis.reportsForOutgoingTracks = {};\n\t\tthis.packetLostThreshold = 7;\n\t\tthis.videoBitrate = 1000000;\n\t\tthis.screenShareBitrate = 1500000;\n\t\tthis.maxConnectionScore = 5;\n\t\tthis.incomingConnectionScore = 0;\n\t\tthis.outgoingConnectionScore = 0;\n\t};\n\n\t_mediaGetter(trackVariable)\n\t{\n\t\treturn function ()\n\t\t{\n\t\t\treturn this[trackVariable]\n\t\t}.bind(this)\n\t};\n\n\t_mediaSetter(trackVariable, kind)\n\t{\n\t\treturn function (track)\n\t\t{\n\t\t\tif (this[trackVariable] != track)\n\t\t\t{\n\t\t\t\tthis[trackVariable] = track;\n\t\t\t\tif (track)\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaReceived({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind,\n\t\t\t\t\t\ttrack: track\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaStopped({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this)\n\t};\n\n\tsendMedia(skipOffer)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tif (!this.isInitiator())\n\t\t\t{\n\t\t\t\tthis.log('waiting for the other side to send connection offer');\n\t\t\t\tthis.sendNegotiationNeeded(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tconst connectionId = Util.getUuidv4();\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\t\tthis.updateOutgoingTracks();\n\n\t\tif (!skipOffer)\n\t\t{\n\t\t\tthis.applyResolutionScale();\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t};\n\n\tupdateOutgoingTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet audioTrack;\n\t\tlet videoTrack;\n\t\tlet screenTrack;\n\t\tlet screenAudioTrack;\n\n\t\tif (this.call.localStreams[\"main\"] && this.call.localStreams[\"main\"].getAudioTracks().length > 0 && this.call.localStreams[\"main\"].getAudioTracks()[0]?.readyState === 'live')\n\t\t{\n\t\t\taudioTrack = this.call.localStreams[\"main\"].getAudioTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"screen\"] && this.call.localStreams[\"screen\"].getVideoTracks().length > 0)\n\t\t{\n\t\t\tscreenTrack = this.call.localStreams[\"screen\"].getVideoTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"screen\"] && this.call.localStreams[\"screen\"].getAudioTracks().length > 0)\n\t\t{\n\t\t\tscreenAudioTrack = this.call.localStreams[\"screen\"].getAudioTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"main\"] && this.call.localStreams[\"main\"].getVideoTracks().length > 0 && this.call.localStreams[\"main\"].getVideoTracks()[0]?.readyState === 'live')\n\t\t{\n\t\t\tvideoTrack = this.call.localStreams[\"main\"].getVideoTracks()[0];\n\t\t}\n\n\t\tthis.outgoingVideoTrack = videoTrack ? videoTrack.clone() : null;\n\t\tthis.outgoingScreenTrack = screenTrack ? screenTrack.clone() : null;\n\n\t\tlet tracksToSend = [];\n\t\tif (audioTrack)\n\t\t{\n\t\t\ttracksToSend.push(audioTrack.id + ' (audio)');\n\t\t}\n\t\tif (screenAudioTrack)\n\t\t{\n\t\t\ttracksToSend.push(screenAudioTrack.id + ' (sharingAudio)');\n\t\t}\n\t\tif (videoTrack)\n\t\t{\n\t\t\ttracksToSend.push(videoTrack.id + ' (' + videoTrack.kind + ')');\n\t\t}\n\t\tif (screenTrack)\n\t\t{\n\t\t\ttracksToSend.push(screenTrack.id + ' (' + screenTrack.kind + ')');\n\t\t}\n\n\t\tconsole.log(\"User: \" + this.userId + '; Sending media streams. Tracks: ' + tracksToSend.join('; '));\n\n\t\t// if video sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.videoSender.replaceTrack(this.outgoingVideoTrack);\n\t\t}\n\t\tif (!this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.videoSender = this.peerConnection.addTrack(this.outgoingVideoTrack);\n\t\t}\n\t\tif (this.videoSender && !this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.videoSender);\n\t\t\tthis.videoSender = null;\n\t\t}\n\n\t\t// if screen sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.screenSender.replaceTrack(this.outgoingScreenTrack);\n\t\t}\n\t\tif (!this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.screenSender = this.peerConnection.addTrack(this.outgoingScreenTrack);\n\t\t}\n\t\tif (this.screenSender && !this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenSender);\n\t\t\tthis.screenSender = null;\n\t\t}\n\n\t\t// if screen sender audio found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenAudioSender && screenAudioTrack)\n\t\t{\n\t\t\tthis.screenAudioSender.replaceTrack(screenAudioTrack);\n\t\t}\n\t\tif (!this.screenAudioSender && screenAudioTrack)\n\t\t{\n\t\t\tthis.screenAudioSender = this.peerConnection.addTrack(screenAudioTrack);\n\t\t}\n\t\tif (this.screenAudioSender && !screenAudioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenAudioSender);\n\t\t\tthis.screenAudioSender = null;\n\t\t}\n\n\t\t// if audio sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.audioSender && audioTrack)\n\t\t{\n\t\t\tthis.audioSender.replaceTrack(audioTrack);\n\t\t}\n\t\tif (!this.audioSender && audioTrack)\n\t\t{\n\t\t\tthis.audioSender = this.peerConnection.addTrack(audioTrack);\n\t\t}\n\t\tif (this.audioSender && !audioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.audioSender);\n\t\t\tthis.audioSender = null;\n\t\t}\n\t};\n\n\tgetSenderMid(rtpSender: RTCRtpSender): string\n\t{\n\t\tif (!rtpSender || !this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst transceiver = this.peerConnection.getTransceivers().find(transceiver => {\n\t\t\tif (transceiver.sender.track && rtpSender.track)\n\t\t\t{\n\t\t\t\treturn transceiver.sender.track.id === rtpSender.track.id\n\t\t\t}\n\t\t\treturn false\n\t\t});\n\n\t\treturn transceiver ? transceiver.mid : null;\n\t};\n\n\tapplyResolutionScale(factor)\n\t{\n\t\tif (this.videoSender)\n\t\t{\n\t\t\tconst scaleFactor = factor || (this.screenSender ? 2 : 1);\n\t\t\tconst rate = this.videoBitrate / scaleFactor;\n\t\t\tconst videoParams = this.videoSender.getParameters();\n\n\t\t\tif (videoParams.encodings && videoParams.encodings.length > 0)\n\t\t\t{\n\t\t\t\tvideoParams.encodings[0].scaleResolutionDownBy = scaleFactor;\n\t\t\t\tvideoParams.encodings[0].maxBitrate = rate;\n\t\t\t\tthis.videoSender.setParameters(videoParams);\n\t\t\t}\n\t\t}\n\n\t\tif (this.screenSender)\n\t\t{\n\t\t\tconst screenParams = this.screenSender.getParameters();\n\t\t\tif (screenParams.encodings && screenParams.encodings.length > 0)\n\t\t\t{\n\t\t\t\tscreenParams.encodings[0].maxBitrate = this.screenShareBitrate;\n\t\t\t\tthis.screenSender.setParameters(screenParams);\n\t\t\t}\n\t\t}\n\t};\n\n\treplaceMediaStream(tag: string)\n\t{\n\t\tif (this.isRenegotiationSupported())\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localStreams[tag] = this.call.getLocalStream(tag);\n\t\t\tthis.reconnect();\n\t\t}\n\t};\n\n\tholdOutgoingVideo(holdState)\n\t{\n\t\tif (this.outgoingVideoHoldState == holdState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.outgoingVideoHoldState = holdState;\n\t\tif (this._outgoingVideoTrack)\n\t\t{\n\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t}\n\t};\n\n\tisInitiator()\n\t{\n\t\treturn this.call.userId < this.userId;\n\t};\n\n\tisRenegotiationSupported()\n\t{\n\t\treturn true;\n\t\t// return (Browser.isChrome() && this.isChrome);\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tthis.ready = ready;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(function ()\n\t\t{\n\t\t\tthis.onInviteTimeout(true);\n\t\t}.bind(this), 30000);\n\t\tthis.updateCalculatedState();\n\t};\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetUserAgent(userAgent)\n\t{\n\t\tthis.userAgent = userAgent;\n\t\tthis.isFirefox = userAgent.toLowerCase().indexOf('firefox') != -1;\n\t\tthis.isChrome = userAgent.toLowerCase().indexOf('chrome') != -1;\n\t\tthis.isLegacyMobile = userAgent === 'Bitrix Legacy Mobile';\n\t};\n\n\tgetUserAgent()\n\t{\n\t\treturn this.userAgent;\n\t};\n\n\tisParticipating()\n\t{\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.declined || this.busy)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\t// todo: maybe we should check iceConnectionState as well.\n\t\t\tconst iceConnectionState = this.peerConnection.iceConnectionState;\n\t\t\tif (iceConnectionState == 'checking' || iceConnectionState == 'connected' || iceConnectionState == 'completed')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tsetSignalingConnected(signalingConnected)\n\t{\n\t\tthis.signalingConnected = signalingConnected;\n\t\tthis.updateCalculatedState();\n\n\t\tif (this.signalingConnected)\n\t\t{\n\t\t\tthis.refreshSignalingTimeout();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.stopSignalingTimeout();\n\t\t}\n\t};\n\n\tisSignalingConnected()\n\t{\n\t\treturn this.signalingConnected;\n\t};\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisDeclined()\n\t{\n\t\treturn this.declined;\n\t};\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState != calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tisLegacyMobile: this.isLegacyMobile,\n\t\t\t\tnetworkProblem: !this.hasStun || !this.hasTurn\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t};\n\n\tcalculateState()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.failureReason !== '')\n\t\t\t{\n\t\t\t\treturn UserState.Failed;\n\t\t\t}\n\n\t\t\tif (this.peerConnection.iceConnectionState === 'connected' || this.peerConnection.iceConnectionState === 'completed')\n\t\t\t{\n\t\t\t\treturn UserState.Connected;\n\t\t\t}\n\n\t\t\treturn UserState.Connecting;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t};\n\n\tgetSignaling()\n\t{\n\t\treturn this.call.signaling;\n\t};\n\n\tstartStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\n\t\tthis.statsInterval = setInterval(function ()\n\t\t{\n\t\t\tif (!this.peerConnection)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.peerConnection.getStats().then(function (stats)\n\t\t\t{\n\t\t\t\t// stats gathering in new format like in the Bitrix24 calls\n\t\t\t\tconst statsOutput = [];\n\t\t\t\tconst codecs = {};\n\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\tconst remoteReports = {};\n\t\t\t\tconst reportsWithoutRemoteInfo = {};\n\t\t\t\tlet incomingDataLoss = 0;\n\t\t\t\tlet outgoingDataLoss = 0;\n\n\t\t\t\tstats.forEach((report) => {\n\t\t\t\t\tstatsOutput.push(report);\n\n\t\t\t\t\tconst needCheckInputPacketLost = (report?.trackIdentifier\n\t\t\t\t\t\t&& report?.type === 'inbound-rtp'\n\t\t\t\t\t\t&& report.hasOwnProperty('packetsLost')\n\t\t\t\t\t\t&& report.hasOwnProperty('packetsReceived'));\n\n\t\t\t\t\tif (needCheckInputPacketLost || report.type === 'outbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\tswitch (this.trackList[report.mid])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcase 'video':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Camera;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'screen':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Screen;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'audio':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Microphone;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (needCheckInputPacketLost)\n\t\t\t\t\t{\n\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.reportsForIncomingTracks[report.source]);\n\t\t\t\t\t\tconst packetsLostData = Util.calcRemotePacketsLost(report, this.reportsForIncomingTracks[report.source]);\n\t\t\t\t\t\treport.packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.reportsForIncomingTracks[report.source] = report;\n\n\t\t\t\t\t\tif (report.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tincomingDataLoss = packetsLostData.currentPercentPacketLost;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t{\n\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'remote-inbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst reportId = report.localId;\n\t\t\t\t\t\tif (reportsWithoutRemoteInfo[reportId])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst packetsLostData = Util.calcLocalPacketsLost(reportsWithoutRemoteInfo[reportId], this.reportsForOutgoingTracks[reportId], report);\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostData = packetsLostData;\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLost = packetsLostData.totalPacketsLost;\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\t\tthis.reportsForOutgoingTracks[reportId] = reportsWithoutRemoteInfo[reportId];\n\t\t\t\t\t\t\tdelete reportsWithoutRemoteInfo[reportId];\n\n\t\t\t\t\t\t\tif (this.reportsForOutgoingTracks[reportId].source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\toutgoingDataLoss = report.packetsLost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tremoteReports[reportId] = report;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'outbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.reportsForOutgoingTracks[report.id], true);\n\t\t\t\t\t\treport.userId = this.call.userId;\n\n\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Util.setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.reportsForOutgoingTracks[report.id] = report;\n\t\t\t\t\t\t\tif (report.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\toutgoingDataLoss = report.packetsLostData.currentPercentPacketLost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (this.prevPercentPacketLostList.incomingPacketLost.push(incomingDataLoss) > 10)\n\t\t\t\t{\n\t\t\t\t\tthis.prevPercentPacketLostList.incomingPacketLost.shift();\n\t\t\t\t}\n\n\t\t\t\tconst newIncomingConnectionDataLoss = this.prevPercentPacketLostList.incomingPacketLost.reduce(\n\t\t\t\t\t(acc, number) => acc + number, 0\n\t\t\t\t) / this.prevPercentPacketLostList.incomingPacketLost.length;\n\t\t\t\tconst newIncomingConnectionScore = this.calcNewConnectionScore(newIncomingConnectionDataLoss);\n\t\t\t\tif (!this.incomingConnectionScore || this.incomingConnectionScore !== newIncomingConnectionScore)\n\t\t\t\t{\n\t\t\t\t\tthis.incomingConnectionScore = newIncomingConnectionScore;\n\t\t\t\t\tthis.callbacks.onRTCQualityChanged({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tscore: this.incomingConnectionScore\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.prevPercentPacketLostList.outgoingPacketLost.push(outgoingDataLoss) > 10)\n\t\t\t\t{\n\t\t\t\t\tthis.prevPercentPacketLostList.outgoingPacketLost.shift();\n\t\t\t\t}\n\n\t\t\t\tconst newOutgoingConnectionDataLoss = this.prevPercentPacketLostList.outgoingPacketLost.reduce(\n\t\t\t\t\t(acc, number) => acc + number, 0\n\t\t\t\t) / this.prevPercentPacketLostList.outgoingPacketLost.length;\n\t\t\t\tconst newOutgoingConnectionScore = this.calcNewConnectionScore(newOutgoingConnectionDataLoss);\n\t\t\t\tif (!this.outgoingConnectionScore || this.outgoingConnectionScore !== newOutgoingConnectionScore)\n\t\t\t\t{\n\t\t\t\t\tthis.outgoingConnectionScore = newOutgoingConnectionScore;\n\t\t\t\t\tthis.callbacks.onRTCQualityChanged({\n\t\t\t\t\t\tuserId: this.call.userId,\n\t\t\t\t\t\tscore: this.outgoingConnectionScore\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.callbacks.onRTCStatsReceived({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tstats: statsOutput\n\t\t\t\t});\n\t\t\t}.bind(this));\n\t\t}.bind(this), 1000);\n\t};\n\n\tcalcNewConnectionScore(dataLoss)\n\t{\n\t\tlet connectionQuality;\n\t\tif (dataLoss < 10)\n\t\t{\n\t\t\tconnectionQuality = 4;\n\t\t}\n\n\t\tif (dataLoss > 10 && dataLoss <= 20)\n\t\t{\n\t\t\tconnectionQuality = 3;\n\t\t}\n\n\t\tif (dataLoss > 20 && dataLoss <= 30)\n\t\t{\n\t\t\tconnectionQuality = 2;\n\t\t}\n\n\t\tif (dataLoss > 30)\n\t\t{\n\t\t\tconnectionQuality = 1;\n\t\t}\n\n\t\treturn connectionQuality;\n\t}\n\n\tstopStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\t\tthis.statsInterval = null;\n\t};\n\n\tupdateCandidatesTimeout()\n\t{\n\t\tif (this.candidatesTimeout)\n\t\t{\n\t\t\tclearTimeout(this.candidatesTimeout);\n\t\t}\n\n\t\tthis.candidatesTimeout = setTimeout(this.sendIceCandidates.bind(this), 500);\n\t};\n\n\tsendIceCandidates()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": sending ICE candidates due to the timeout\");\n\n\t\tthis.candidatesTimeout = null;\n\t\tif (this.localIceCandidates.length > 0)\n\t\t{\n\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t});\n\t\t\tthis.localIceCandidates = [];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates pool is empty\");\n\t\t}\n\t};\n\n\t#createPeerConnection(id)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": Creating peer connection\");\n\t\tconst connectionConfig = {\n\t\t\t\"iceServers\": [\n\t\t\t\t{\n\t\t\t\t\turls: \"stun:\" + this.call.turnServer\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\turls: \"turn:\" + this.call.turnServer,\n\t\t\t\t\tusername: this.call.turnServerLogin,\n\t\t\t\t\tcredential: this.call.turnServerPassword\n\t\t\t\t}\n\t\t\t],\n\t\t\t// iceTransportPolicy: 'relay'\n\t\t};\n\n\t\tthis.localIceCandidates = [];\n\t\tthis.peerConnection = new RTCPeerConnection(connectionConfig);\n\t\tthis.peerConnectionId = id;\n\n\t\tthis.peerConnection.addEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.addEventListener(\"connectionstatechange\", this._onPeerConnectionConnectionStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.addEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.addEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.addEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.failureReason = '';\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\t\tthis.updateCalculatedState();\n\n\t\tthis.startStatisticsGathering();\n\t};\n\n\t_destroyPeerConnection()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.log(\"User \" + this.userId + \": Destroying peer connection \" + this.peerConnectionId);\n\t\tthis.stopStatisticsGathering();\n\n\t\tthis.peerConnection.removeEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.removeEventListener(\"connectionstatechange\", this._onPeerConnectionConnectionStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.removeEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.removeEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.removeEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.localIceCandidates = [];\n\t\tif (this.pendingIceCandidates[this.peerConnectionId])\n\t\t{\n\t\t\tdelete this.pendingIceCandidates[this.peerConnectionId];\n\t\t}\n\n\t\tthis.peerConnection.close();\n\t\tthis.peerConnection = null;\n\t\tthis.peerConnectionId = null;\n\t\tthis.videoSender = null;\n\t\tthis.screenSender = null;\n\t\tthis.audioSender = null;\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingScreenAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\t_onPeerConnectionIceCandidate(e)\n\t{\n\t\tconst candidate = e.candidate;\n\t\tthis.log(\"User \" + this.userId + \": ICE candidate discovered. Candidate: \" + (candidate ? candidate.candidate : candidate));\n\n\t\tif (candidate)\n\t\t{\n\t\t\tif (this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tcandidates: [candidate.toJSON()]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.localIceCandidates.push(candidate.toJSON());\n\t\t\t\tthis.updateCandidatesTimeout();\n\t\t\t}\n\n\t\t\tconst match = candidate.candidate.match(/typ\\s(\\w+)?/);\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tconst type = match[1];\n\t\t\t\tif (type == \"srflx\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasStun = true;\n\t\t\t\t}\n\t\t\t\telse if (type == \"relay\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasTurn = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionConnectionStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": peer connection state changed. New state: \" + this.peerConnection.connectionState);\n\n\t\tif (this.peerConnection.connectionState === \"connected\" || this.peerConnection.connectionState === \"completed\")\n\t\t{\n\t\t\tthis.connectionAttempt = 0;\n\t\t\tthis.callbacks.onReconnected();\n\t\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t\telse if (this.peerConnection.connectionState === \"failed\")\n\t\t{\n\t\t\tthis.log(\"peer connection failed. Trying to restore connection immediately\");\n\t\t\tthis.reconnect();\n\t\t}\n\t\t// else if (this.peerConnection.connectionState === \"disconnected\")\n\t\t// {\n\t\t// \t// we can ignore a 'disconnected' state because it can provoke frequent reconnects,\n\t\t// \t// besides that, iceConnectionState can can be changed back to 'connected' state by itself\n\t\t// \tthis.log(\"peer connection lost. Waiting 5 seconds before trying to restore it\");\n\t\t// \tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t// \tthis.reconnectAfterDisconnectTimeout = setTimeout(() => this.reconnect(), 5000);\n\t\t// }\n\n\t\tthis.updateCalculatedState();\n\t};\n\n\t#onPeerConnectionIceGatheringStateChange(e)\n\t{\n\t\tconst connection = e.target;\n\t\tthis.log(\"User \" + this.userId + \": ICE gathering state changed to : \" + connection.iceGatheringState);\n\n\t\tif (connection.iceGatheringState === 'complete')\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE gathering complete\");\n\t\t\tif (!this.hasStun || !this.hasTurn)\n\t\t\t{\n\t\t\t\tconst s = [];\n\t\t\t\tif (!this.hasTurn)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"TURN\");\n\t\t\t\t}\n\t\t\t\tif (!this.hasStun)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"STUN\");\n\t\t\t\t}\n\t\t\t\tthis.log(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tconsole.error(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tthis.callbacks.onNetworkProblem();\n\t\t\t}\n\n\t\t\tif (!this.hasTurn && !this.hasStun)\n\t\t\t{\n\n\t\t\t}\n\n\t\t\tif (!this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tif (this.localIceCandidates.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t\t\t});\n\t\t\t\t\tthis.localIceCandidates = [];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates already sent\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionSignalingStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \" PC signalingState: \" + this.peerConnection.signalingState);\n\t\tif (this.peerConnection.signalingState === \"stable\")\n\t\t{\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t};\n\n\t// this event is unusable in the current version of desktop (cef 64) and leads to signaling cycling\n\t// todo: reconsider using it after new version is released\n\t#onPeerConnectionNegotiationNeeded(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": needed negotiation for peer connection\");\n\t\tthis.log(\"signaling state: \", e.target.signalingState);\n\t\tthis.log(\"ice connection state: \", e.target.iceConnectionState);\n\t\tthis.log(\"pendingRemoteDescription: \", e.target.pendingRemoteDescription);\n\n\t\tif (e.target.iceConnectionState !== \"new\" && e.target.iceConnectionState !== \"connected\" && e.target.iceConnectionState !== \"completed\")\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": wrong connection state\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendNegotiationNeeded(this.peerConnection._forceReconnect === true);\n\t\t}\n\t};\n\n\t#onPeerConnectionTrack(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": media track received: \", e.track.id + \" (\" + e.track.kind + \")\");\n\n\t\tif (e.track.kind === \"video\")\n\t\t{\n\t\t\te.track.addEventListener(\"mute\", this.#onVideoTrackMuted.bind(this));\n\t\t\te.track.addEventListener(\"unmute\", this.#onVideoTrackUnMuted.bind(this));\n\t\t\te.track.addEventListener(\"ended\", this.#onVideoTrackEnded.bind(this));\n\t\t\tif (this.trackList[e.track.id] === 'screen')\n\t\t\t{\n\t\t\t\tthis.incomingScreenTrack = e.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingVideoTrack = e.track\n\t\t\t}\n\t\t}\n\t\telse if (e.track.kind === 'audio')\n\t\t{\n\t\t\t// this.incomingAudioTrack = e.track;\n\t\t\tif (this.trackList[e.track.id] === 'screenAudio')\n\t\t\t{\n\t\t\t\tthis.incomingScreenAudioTrack = e.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingAudioTrack = e.track;\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionRemoveStream(e)\n\t{\n\t\tthis.log(\"User: \" + this.userId + \"_onPeerConnectionRemoveStream: \", e);\n\t};\n\n\t#onVideoTrackMuted()\n\t{\n\t\tconsole.log(\"Video track muted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackUnMuted()\n\t{\n\t\tconsole.log(\"Video track unmuted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackEnded()\n\t{\n\t\tconsole.log(\"Video track ended\");\n\t};\n\n\t#updateTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tlet audioTrack = null;\n\t\tlet videoTrack = null;\n\t\tlet screenTrack = null;\n\t\tlet screenAudioTrack = null;\n\t\tthis.peerConnection.getTransceivers().forEach((tr) =>\n\t\t{\n\t\t\tthis.call.log(\"[debug] tr direction: \" + tr.direction + \" currentDirection: \" + tr.currentDirection);\n\t\t\tif (tr.currentDirection === \"sendrecv\" || tr.currentDirection === \"recvonly\")\n\t\t\t{\n\t\t\t\tif (tr.receiver && tr.receiver.track)\n\t\t\t\t{\n\t\t\t\t\tconst track = tr.receiver.track;\n\t\t\t\t\tif (track.kind === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'sharingAudio')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenAudioTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.kind === 'video')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'screen')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvideoTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.incomingAudioTrack = audioTrack;\n\t\tthis.incomingVideoTrack = videoTrack;\n\t\tthis.incomingScreenTrack = screenTrack;\n\t\tthis.incomingScreenAudioTrack = screenAudioTrack;\n\t};\n\n\tstopSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t};\n\n\trefreshSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = setTimeout(this.#onLostSignalingConnection.bind(this), signalingConnectionRefreshPeriod);\n\t};\n\n\t#onLostSignalingConnection()\n\t{\n\t\tthis.setSignalingConnected(false);\n\t};\n\n\t_onConnectionOfferReplyTimeout(connectionId)\n\t{\n\t\tthis.log(\"did not receive connection answer for connection \" + connectionId);\n\t\tthis.call.setPublishingState(MediaStreamsKinds.Camera, false);\n\n\t\tthis.reconnect();\n\t};\n\n\t_onNegotiationNeededReplyTimeout()\n\t{\n\t\tthis.log(\"did not receive connection offer in time\");\n\n\t\tthis.reconnect();\n\t};\n\n\tsetConnectionOffer(connectionId, sdp, trackList)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": applying connection offer for connection \" + connectionId);\n\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = null;\n\n\t\tif (!this.call.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnectionId !== connectionId)\n\t\t\t{\n\t\t\t\tthis._destroyPeerConnection();\n\t\t\t\tthis.#createPeerConnection(connectionId);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\n\t\tthis.applyOfferAndSendAnswer(sdp);\n\t};\n\n\tcreateAndSendOffer(config)\n\t{\n\t\tlet connectionConfig = defaultConnectionOptions;\n\t\tfor (let key in config)\n\t\t{\n\t\t\tconnectionConfig[key] = config[key];\n\t\t}\n\n\t\tthis.peerConnection.createOffer(connectionConfig)\n\t\t\t.then((offer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"User \" + this.userId + \": Created connection offer.\");\n\t\t\t\tthis.log(\"Applying local description\");\n\t\t\t\treturn this.peerConnection.setLocalDescription(offer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t})\n\t\t;\n\t};\n\n\tsendOffer()\n\t{\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\t\tthis.connectionOfferReplyTimeout = setTimeout(\n\t\t\t() => this._onConnectionOfferReplyTimeout(this.peerConnectionId),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tthis.getSignaling().sendConnectionOffer({\n\t\t\tuserId: this.userId,\n\t\t\tconnectionId: this.peerConnectionId,\n\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\ttracks: {\n\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\tsharingAudio: this.getSenderMid(this.screenAudioSender),\n\t\t\t},\n\t\t\tuserAgent: navigator.userAgent\n\t\t})\n\t};\n\n\tsendNegotiationNeeded(restart: boolean)\n\t{\n\t\trestart = restart === true;\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = setTimeout(\n\t\t\t() => this._onNegotiationNeededReplyTimeout(),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tconst params = {\n\t\t\tuserId: this.userId\n\t\t};\n\t\tif (restart)\n\t\t{\n\t\t\tparams.restart = true;\n\t\t}\n\n\t\tthis.getSignaling().sendNegotiationNeeded(params);\n\t};\n\n\tapplyOfferAndSendAnswer(sdp)\n\t{\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"offer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tif (this.pendingRemoteSdpDelay)\n\t\t{\n\t\t\tthis.pendingRemoteSdp = sdp;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote offer\");\n\t\tthis.log(\"User: \" + this.userId + \"; Peer ice connection state \", this.peerConnection.iceConnectionState);\n\n\t\tthis.pendingRemoteSdpDelay = true;\n\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (this.peerConnection.iceConnectionState === 'new')\n\t\t\t\t{\n\t\t\t\t\tthis.sendMedia(true);\n\t\t\t\t}\n\n\t\t\t\treturn this.peerConnection.createAnswer();\n\t\t\t})\n\t\t\t.then((answer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Created connection answer.\");\n\t\t\t\tthis.log(\"Applying local description.\");\n\n\t\t\t\treturn this.peerConnection.setLocalDescription(answer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyResolutionScale();\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t\tthis.getSignaling().sendConnectionAnswer({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\t\t\ttracks: {\n\t\t\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\t\t\tsharingAudio: this.getSenderMid(this.screenAudioSender),\n\t\t\t\t\t},\n\t\t\t\t\tuserAgent: navigator.userAgent\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(\"Could not apply remote offer\", e);\n\t\t\t\tconsole.error(\"Could not apply remote offer\", e);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.pendingRemoteSdpDelay = false;\n\t\t\t\tif (this.pendingRemoteSdp) {\n\t\t\t\t\tthis.applyOfferAndSendAnswer(this.pendingRemoteSdp);\n\t\t\t\t\tthis.pendingRemoteSdp = null;\n\t\t\t\t}\n\n\t\t\t})\n\t\t;\n\t};\n\n\tsetConnectionAnswer(connectionId, sdp, trackList)\n\t{\n\t\tif (!this.peerConnection || this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.signalingState !== 'have-local-offer')\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, wrong peer connection signaling state \" + this.peerConnection.signalingState);\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"answer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote answer\");\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(e);\n\t\t\t})\n\t\t\t.finally(() =>\n\t\t\t{\n\t\t\t\tthis.call.setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t})\n\t\t;\n\t};\n\n\taddIceCandidate(connectionId, candidate)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Error: Candidate for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.remoteDescription && this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\tthis.peerConnection\n\t\t\t\t.addIceCandidate(candidate)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.pendingIceCandidates[connectionId])\n\t\t\t{\n\t\t\t\tthis.pendingIceCandidates[connectionId] = [];\n\t\t\t}\n\t\t\tthis.pendingIceCandidates[connectionId].push(candidate);\n\t\t}\n\t};\n\n\tapplyPendingIceCandidates()\n\t{\n\t\tif (!this.peerConnection || !this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isArray(this.pendingIceCandidates[this.peerConnectionId]))\n\t\t{\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId].forEach((candidate) =>\n\t\t\t{\n\t\t\t\tthis.peerConnection.addIceCandidate(candidate).then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId] = [];\n\t\t}\n\t};\n\n\tonNegotiationNeeded()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnection.signalingState == \"have-local-offer\")\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.createAndSendOffer({iceRestart: true});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t};\n\n\treconnect()\n\t{\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.connectionAttempt++;\n\n\n\t\tif (this.connectionAttempt > 3)\n\t\t{\n\t\t\tthis.log(\"Error: Too many reconnection attempts, giving up\");\n\t\t\tthis.failureReason = \"Could not connect to user in time\";\n\t\t\tthis.updateCalculatedState();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callbacks.onReconnecting();\n\n\t\tthis.log(\"Trying to restore ICE connection. Attempt \" + this.connectionAttempt);\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis._destroyPeerConnection();\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendNegotiationNeeded(true);\n\t\t}\n\t};\n\n\tdisconnect()\n\t{\n\t\tthis._destroyPeerConnection();\n\n\t\tthis.outgoingVideoTrack = null;\n\t\tthis.outgoingScreenTrack = null;\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingScreenAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.disconnect();\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\tclearTimeout(this.answerTimeout);\n\t\tthis.answerTimeout = null;\n\n\t\tclearTimeout(this.connectionTimeout);\n\t\tthis.connectionTimeout = null;\n\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = null;\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaStopped = BX.DoNothing;\n\t};\n}\n","import {Type} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {\n\tCallEngine,\n\tEndpointDirection,\n\tUserState,\n\tQuality,\n\tUserMnemonic,\n\tCallEvent,\n\tCallState,\n\tCallType,\n\tProvider\n} from './engine';\nimport {Call, CALL_STATE, MediaStreamsKinds} from '../call_api.js';\nimport {View} from '../view/view';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../hardware';\nimport Util from '../util'\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onDestroy\n */\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping',\n\tfinish: 'im.call.finish',\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n\trepeatAnswer: 'Call::repeatAnswer',\n};\n\nconst clientEvents = {\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tscreenState: 'Call::screenState',\n\trecordState: 'Call::recordState',\n\temotion: 'Call::emotion',\n\tcustomMessage: 'Call::customMessage',\n\tshowUsers: 'Call::showUsers',\n\tshowAll: 'Call::showAll',\n\thideAll: 'Call::hideAll',\n};\n\nconst scenarioEvents = {\n\tviewerJoined: 'Call::viewerJoined',\n\tviewerLeft: 'Call::viewerLeft',\n};\n\nconst BitrixCallEvent = {\n\tonCallConference: 'BitrixCall::onCallConference'\n};\n\nconst MediaKinds = {\n\t[MediaStreamsKinds.Camera]: 'video',\n\t[MediaStreamsKinds.Microphone]: 'audio',\n\t[MediaStreamsKinds.Screen]: 'sharing',\n\t[MediaStreamsKinds.ScreenAudio]: 'sharingAudio',\n};\n\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\n\n// const MAX_USERS_WITHOUT_SIMULCAST = 6;\n\nexport class BitrixCall extends AbstractCall\n{\n\tstatic Event = BitrixCallEvent\n\tpeers: { [key: number]: Peer }\n\tlocalVAD: ?SimpleVAD\n\n\tconstructor(config)\n\t{\n\t\tsuper(config);\n\n\t\tthis.videoQuality = Quality.VeryHigh; // initial video quality. will drop on new peers connecting\n\n\t\tthis.BitrixCall = null;\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.peers = {};\n\t\tthis.peersWithBadConnection = new Set();\n\t\tthis.joinedElsewhere = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis._localUserState = UserState.Idle;\n\t\tthis.clientEventsBound = false;\n\t\tthis._screenShared = false;\n\t\tthis.videoAllowedFrom = UserMnemonic.all;\n\t\tthis.direction = EndpointDirection.SendRecv;\n\t\tthis.floorRequestActive = false;\n\n\t\tthis.recordState = {\n\t\t\tstate: View.RecordState.Stopped,\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: []\n\t\t\t},\n\t\t};\n\n\t\tthis.microphoneLevelInterval = null;\n\n\t\twindow.addEventListener(\"unload\", this.#onWindowUnload);\n\n\t\tthis.initPeers();\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.lastPingReceivedTimeout = null;\n\t\tthis.lastSelfPingReceivedTimeout = null;\n\n\t\tthis.reinviteTimeout = null;\n\n\t\tthis._reconnectionEventCount = 0;\n\n\t\tthis.pullEventHandlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer,\n\t\t\t'Call::hangup': this.#onPullEventHangup,\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined,\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited,\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout,\n\t\t\t'Call::ping': this.#onPullEventPing,\n\t\t\t'Call::finish': this.#onPullEventFinish,\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer,\n\t\t\t'Call::switchTrackRecordStatus': this.#onPullEventSwitchTrackRecordStatus,\n\t\t};\n\n\t\tthis._isCopilotActive = config.isCopilotActive;\n\t\tthis._isCopilotFeaturesEnabled = true;\n\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = false;\n\t\tthis._isBoostExpired = false;\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Bitrix;\n\t}\n\n\tget screenShared()\n\t{\n\t\treturn this._screenShared;\n\t}\n\n\tget isCopilotActive()\n\t{\n\t\treturn this._isCopilotActive;\n\t}\n\n\tset isCopilotActive(isCopilotActive)\n\t{\n\t\tif (isCopilotActive !== this._isCopilotActive)\n\t\t{\n\t\t\tthis._isCopilotActive = isCopilotActive;\n\t\t}\n\t}\n\n\tget isBoostExpired()\n\t{\n\t\treturn this._isBoostExpired;\n\t}\n\n\tset isBoostExpired(isBoostExpired)\n\t{\n\t\tif (isBoostExpired !== this._isBoostExpired)\n\t\t{\n\t\t\tthis._isBoostExpired = isBoostExpired;\n\t\t}\n\t}\n\n\tget isCopilotFeaturesEnabled()\n\t{\n\t\treturn this._isCopilotFeaturesEnabled;\n\t}\n\n\tset isCopilotFeaturesEnabled(isCopilotFeaturesEnabled)\n\t{\n\t\tif (isCopilotFeaturesEnabled !== this._isCopilotFeaturesEnabled)\n\t\t{\n\t\t\tthis._isCopilotFeaturesEnabled = isCopilotFeaturesEnabled;\n\t\t}\n\t}\n\n\tget isRecordWhenCopilotActivePopupAlreadyShow()\n\t{\n\t\treturn this._isRecordWhenCopilotActivePopupAlreadyShow;\n\t}\n\n\tset isRecordWhenCopilotActivePopupAlreadyShow(isRecordWhenCopilotActivePopupAlreadyShow)\n\t{\n\t\tif (isRecordWhenCopilotActivePopupAlreadyShow !== this._isRecordWhenCopilotActivePopupAlreadyShow)\n\t\t{\n\t\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = isRecordWhenCopilotActivePopupAlreadyShow;\n\t\t}\n\t}\n\n\tset screenShared(screenShared)\n\t{\n\t\tif (screenShared !== this._screenShared)\n\t\t{\n\t\t\tthis._screenShared = screenShared;\n\t\t\tthis.signaling.sendScreenState(this._screenShared);\n\t\t}\n\t}\n\n\tget localUserState()\n\t{\n\t\treturn this._localUserState\n\t}\n\n\tset localUserState(state)\n\t{\n\t\tif (state === this._localUserState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.runCallback(CallEvent.onUserStateChanged, {\n\t\t\tuserId: this.userId,\n\t\t\tstate: state,\n\t\t\tpreviousState: this._localUserState,\n\t\t\tdirection: this.direction,\n\t\t});\n\t\tthis._localUserState = state;\n\t}\n\n\tget reconnectionEventCount()\n\t{\n\t\treturn this._reconnectionEventCount;\n\t}\n\n\tset reconnectionEventCount(newValue)\n\t{\n\t\tif (this._reconnectionEventCount === 0 && newValue > 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnecting, {\n\t\t\t\treconnectionEventCount: newValue,\n\t\t\t});\n\t\t}\n\t\tif (newValue === 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t}\n\t\tthis._reconnectionEventCount = newValue;\n\t}\n\n\tinitPeers()\n\t{\n\t\tthis.users.forEach((userId) =>\n\t\t{\n\t\t\tuserId = Number(userId);\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t});\n\t};\n\n\treinitPeers()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t\tthis.peers[userId] = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.initPeers();\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tconst users = this.users.concat(this.userId);\n\t\t\tthis.signaling.sendPingToUsers({userId: users}, true);\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\tlet incomingVideoAllowed;\n\t\tif (this.videoAllowedFrom === UserMnemonic.all)\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\t\telse if (this.videoAllowedFrom === UserMnemonic.none)\n\t\t{\n\t\t\tincomingVideoAllowed = false;\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tincomingVideoAllowed = this.videoAllowedFrom.some(allowedUserId => allowedUserId == userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tisIncomingVideoAllowed: incomingVideoAllowed,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t\tif (e.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tvideoPaused: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRemoved: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged,\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout,\n\n\t\t})\n\t};\n\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.peers).length;\n\t};\n\n\tcanChangeMediaDevices()\n\t{\n\t\treturn !this.BitrixCall?.isMediaMutedBySystem;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted === event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(!this.muted);\n\n\t\t\tif (this.muted)\n\t\t\t{\n\t\t\t\tthis.BitrixCall.disableAudio();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t\t\t}\n\t\t\t\tthis.BitrixCall.enableAudio();\n\t\t\t}\n\t\t}\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled === event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.signaling.sendCameraState(this.videoEnabled);\n\n\t\t\tif (this.videoEnabled)\n\t\t\t{\n\t\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\t}\n\t\t\t\tthis.localVideoShown = true;\n\t\t\t\tthis.BitrixCall.enableVideo();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.localVideoShown)\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tthis.BitrixCall.disableVideo();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId === cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!cameraId)\n\t\t\t{\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Camera);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\n\t\t\tthis.BitrixCall.switchActiveVideoDevice(this.cameraId)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tif (Hardware.isCameraOn)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback('onUpdateLastUsedCameraId');\n\n\t\t\t\t\t\tif (this.BitrixCall.isVideoPublished() && this.canChangeMediaDevices())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.BitrixCall.getLocalVideo()\n\t\t\t\t\t\t\t\t.then(track => {\n\t\t\t\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\t\t\t\t\t\t\t\tkind: 'video',\n\t\t\t\t\t\t\t\t\t\ttrack,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\t\t\t\ttag: 'main',\n\t\t\t\t\t\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\t\t\tif (this.BitrixCall.isVideoPublished())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!this.canChangeMediaDevices())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onNeedResetMediaDevicesState);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\t\t\tthis.BitrixCall.enableVideo(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Camera);\n\t\t\t\t});\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId === microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!microphoneId)\n\t\t\t{\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Microphone);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t\tthis.#onEndpointVoiceEnd({userId: this.userId});\n\n\t\t\tthis.BitrixCall.switchActiveAudioDevice(this.microphoneId)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.BitrixCall.getLocalAudio()\n\t\t\t\t\t\t.then(track => {\n\t\t\t\t\t\t\tthis.#onMicAccessResult({\n\t\t\t\t\t\t\t\tresult: true,\n\t\t\t\t\t\t\t\tstream: new MediaStream([track]),\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tmicrophoneState: false,\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\n\t\t\t\t\tif (Hardware.isMicrophoneMuted && !this.canChangeMediaDevices())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.BitrixCall.disableAudio();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t};\n\n\t#setPublishingState(deviceType, publishing)\n\t{\n\t\tif (deviceType === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCameraPublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t\telse if (deviceType === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onMicrophonePublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t}\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\tsetMainStream(userId)\n\t{\n\t\tif (userId && userId !== this.userId)\n\t\t{\n\t\t\tconst participant = this.peers[userId]?.participant;\n\t\t\tconst kind = participant?.screenSharingEnabled ? MediaStreamsKinds.Screen : MediaStreamsKinds.Camera;\n\t\t\tthis.BitrixCall.setMainStream(userId, kind);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.BitrixCall.resetMainStream();\n\t\t}\n\t}\n\n\trequestFloor(requestActive)\n\t{\n\t\tif (this.floorRequestActive === requestActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.floorRequestActive = requestActive;\n\t\tthis.BitrixCall.raiseHand(requestActive);\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\trecordState.senderId = this.userId;\n\n\t\tif (!this.#changeRecordState(recordState))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\tuserId: this.userId,\n\t\t\trecordState: this.recordState\n\t\t})\n\t\tthis.signaling.sendRecordState(this.userId, this.recordState);\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\tthis.signaling.sendCustomMessage(message, repeatOnConnect);\n\t};\n\n\t/**\n\t * Updates list of users,\n\t */\n\tallowVideoFrom(userList: $Keys<typeof UserMnemonic> | number[])\n\t{\n\t\tif (this.videoAllowedFrom == userList)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoAllowedFrom = userList;\n\n\t\tif (userList === UserMnemonic.all)\n\t\t{\n\t\t\tthis.signaling.sendShowAll();\n\t\t\tuserList = Object.keys(this.peers);\n\t\t}\n\t\telse if (userList === UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t\tuserList = [];\n\t\t}\n\t\telse if (Type.isArray(userList))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(userList)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error(\"userList is in wrong format\");\n\t\t}\n\n\t\tlet users = {};\n\t\tuserList.forEach(userId => users[userId] = true);\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (!this.peers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (users[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(false);\n\t\t\t}\n\t\t}\n\t};\n\n\tstartScreenSharing()\n\t{\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.waitingLocalScreenShare = true;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: true,\n\t\t});\n\n\t\tthis.BitrixCall.startScreenShare();\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Screen);\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.screenShared || this.waitingLocalScreenShare;\n\t};\n\n\tisGetUserMediaFulfilled()\n\t{\n\t\treturn this.getUserMediaFulfilled;\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t */\n\tinviteUsers(config: { users: number[], show?: boolean } = {})\n\t{\n\t\tthis.ready = true;\n\t\tlet users = Type.isArray(config.users) ? config.users : this.users;\n\n\t\tthis.attachToConference()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.signaling.sendPingToUsers({userId: users});\n\n\t\t\t\tif (users.length > 0)\n\t\t\t\t{\n\t\t\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\t\t\tuserIds: users,\n\t\t\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\t\t\t\tshow: config.show === true ? 'Y' : 'N',\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(users[i]);\n\t\t\t\t\tif (!this.users.includes(userId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.users.push(userId);\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e)\n\t\t\t})\n\t\t;\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(() => this.repeatInviteUsers(), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst inviteParams = {\n\t\t\tuserIds: usersToRepeatInvite,\n\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\trepeated: 'Y',\n\t\t}\n\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t};\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool?} [config.useVideo]\n\t * @param {bool?} [config.joinAsViewer]\n\t */\n\tanswer(config = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst joinAsViewer = config.joinAsViewer === true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\n\t\tif (!joinAsViewer)\n\t\t{\n\t\t\tthis._outgoingAnswer = this.signaling.sendAnswer();\n\t\t}\n\t\tthis.attachToConference({joinAsViewer: joinAsViewer})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Attached to conference\");\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(err);\n\t\t\t})\n\t\t;\n\t};\n\n\tdecline(code)\n\t{\n\t\tthis.ready = false;\n\t\tconst data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\t\tif (code)\n\t\t{\n\t\t\tdata.code = code\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data);\n\t};\n\n\thangup(code, reason, finishCall = false)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\n\t\tlet data = {};\n\t\tthis.ready = false;\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t//clone users and append current user id to send event to all participants of the call\n\t\tdata.userId = this.users.slice(0).concat(this.userId);\n\t\tif (this._outgoingAnswer && !finishCall)\n\t\t{\n\t\t\tthis._outgoingAnswer.then(() => this.signaling.sendHangup(data));\n\t\t}\n\t\telse if (finishCall)\n\t\t{\n\t\t\tthis.signaling.sendFinish(data);\n\t\t}\n\t\telse if (reason !== 'SIGNALING_DUPLICATE_PARTICIPANT')\n\t\t{\n\t\t\tthis.signaling.sendHangup(data)\n\t\t}\n\n\t\tif (reason !== 'SIGNALING_DUPLICATE_PARTICIPANT') {\n\t\t\t// for future reconnections\n\t\t\tthis.reinitPeers();\n\t\t}\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.BitrixCall._replaceVideoSharing = false;\n\t\t\tthis.BitrixCall.hangup();\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Tried to hangup, but this.BitrixCall points nowhere\");\n\t\t\tconsole.error(\"Tried to hangup, but this.BitrixCall points nowhere\");\n\t\t}\n\n\t\tthis.screenShared = false;\n\t\tthis.localVideoShown = false;\n\t};\n\n\tattachToConference(options: { joinAsViewer: ?boolean } = {})\n\t{\n\t\tconst joinAsViewer = options.joinAsViewer === true;\n\t\tif (this.BitrixCall && this.BitrixCall.getState() === CALL_STATE.CONNECTED)\n\t\t{\n\t\t\tif (this.joinedAsViewer === joinAsViewer)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Promise.reject(\"Already joined call in another mode\");\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.direction = joinAsViewer ? EndpointDirection.RecvOnly : EndpointDirection.SendRecv;\n\t\t\tthis.sendTelemetryEvent(\"call\");\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.localUserState = UserState.Connecting;\n\t\t\t\tthis.BitrixCall = new Call(this.userId);\n\n\t\t\t\tif (Hardware.isCameraOn)\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t}\n\n\t\t\t\tthis.joinedAsViewer = joinAsViewer;\n\n\t\t\t\tif (!this.BitrixCall)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create Bitrix call\");\n\t\t\t\t\treturn reject({code: \"BITRIX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.runCallback(BitrixCallEvent.onCallConference, {\n\t\t\t\t\tcall: this\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\tthis.BitrixCall.on('Connected', () => {\n\t\t\t\t\tthis.#onCallConnected();\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\tthis.BitrixCall.on('Failed', (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.#onCallFailed(e);\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\n\t\t\t\tif (!this.ready)\n\t\t\t\t{\n\t\t\t\t\t// for rare cases with fast quit\n\t\t\t\t\treturn reject({code: \"BITRIX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.BitrixCall.connect({\n\t\t\t\t\troomId: this.id,\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tendpoint: this.connectionData.endpoint,\n\t\t\t\t\tjwt: this.connectionData.jwt,\n\t\t\t\t\tvideoBitrate: 1000000,\n\t\t\t\t\tvideoSimulcast: true,\n\t\t\t\t\taudioDeviceId: this.microphoneId,\n\t\t\t\t\tvideoDeviceId: this.cameraId,\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e);\n\t\t\t}\n\t\t});\n\t};\n\n\t#onCallConnected()\n\t{\n\t\tthis.reconnectionEventCount = 0;\n\t\tthis.log(\"Call connected\");\n\t\tthis.sendTelemetryEvent(\"connect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tthis.BitrixCall.on('Failed', this.#onCallDisconnected);\n\n\t\tthis.signaling.sendMicrophoneState(!Hardware.isMicrophoneMuted);\n\t\tthis.signaling.sendCameraState(Hardware.isCameraOn);\n\n\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\tthis.BitrixCall.enableAudio(Hardware.isMicrophoneMuted);\n\n\t\tif (Hardware.isCameraOn)\n\t\t{\n\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\t\t\tthis.BitrixCall.enableVideo();\n\t\t}\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\t};\n\n\t#onCallFailed(e)\n\t{\n\t\tthis.log(\"Could not attach to conference\", e);\n\t\tthis.sendTelemetryEvent(\"connect_failure\");\n\t\tthis.localUserState = UserState.Failed;\n\n\t\tthis.BitrixCall.enableSilentLogging(false);\n\t\tthis.BitrixCall.setLoggerCallback(null);\n\t};\n\n\tbindCallEvents()\n\t{\n\t\tthis.BitrixCall.on('PublishSucceed', this.#onLocalMediaRendererAdded);\n\t\tthis.BitrixCall.on('PublishPaused', this.#onLocalMediaRendererMuteToggled);\n\t\tthis.BitrixCall.on('MediaMutedBySystem', this.#onMediaMutedBySystem);\n\t\tthis.BitrixCall.on('PublishFailed', this.#onLocalMediaRendererEnded);\n\t\tthis.BitrixCall.on('PublishEnded', this.#onLocalMediaRendererEnded);\n\t\tthis.BitrixCall.on('GetUserMediaStarted', this.#onGetUserMediaStarted.bind(this));\n\t\tthis.BitrixCall.on('GetUserMediaEnded', this.#onGetUserMediaEnded);\n\t\tthis.BitrixCall.on('GetUserMediaSuccess', this.#onGetUserMediaSuccess.bind(this));\n\t\tthis.BitrixCall.on('RemoteMediaAdded', this.#onRemoteMediaAdded);\n\t\tthis.BitrixCall.on('RemoteMediaRemoved', this.#onRemoteMediaRemoved);\n\t\tthis.BitrixCall.on('RemoteMediaMuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.BitrixCall.on('RemoteMediaUnmuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.BitrixCall.on('ParticipantJoined', this.#onParticipantJoined);\n\t\tthis.BitrixCall.on('ParticipantStateUpdated', () => console.log('handleParticipantStateUpdated'));\n\t\tthis.BitrixCall.on('ParticipantLeaved', this.#onParticipantLeaved);\n\t\tthis.BitrixCall.on('MessageReceived', this.#onCallMessageReceived);\n\t\tthis.BitrixCall.on('HandRaised', this.#onCallHandRaised);\n\t\tthis.BitrixCall.on('VoiceStarted', this.#onEndpointVoiceStart);\n\t\tthis.BitrixCall.on('VoiceEnded', this.#onEndpointVoiceEnd);\n\t\tthis.BitrixCall.on('Reconnecting', this.#onCallReconnecting);\n\t\tthis.BitrixCall.on('Reconnected', this.#onCallReconnected);\n\t\tthis.BitrixCall.on('Disconnected', this.#onCallDisconnected);\n\t\t// if (Util.shouldCollectStats())\n\t\t// {\n\t\t\tthis.BitrixCall.on('CallStatsReceived', this.#onCallStatsReceived);\n\t\t// }\n\t\tthis.BitrixCall.on('UpdatePacketLoss', this.#onUpdatePacketLoss);\n\t\tthis.BitrixCall.on('ConnectionQualityChanged', this.#onConnectionQualityChanged);\n\t\tthis.BitrixCall.on('ToggleRemoteParticipantVideo', this.#onToggleRemoteParticipantVideo);\n\t};\n\n\tremoveCallEvents()\n\t{\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.BitrixCall.on('Failed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishSucceed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishFailed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('GetUserMediaEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RemoteMediaAdded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RemoteMediaRemoved', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantJoined', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantStateUpdated', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantLeaved', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('MessageReceived', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('HandRaised', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('VoiceStarted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('VoiceEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Reconnecting', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Reconnected', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Disconnected', BX.DoNothing);\n\t\t\t// if (Util.shouldCollectStats())\n\t\t\t// {\n\t\t\t\tthis.BitrixCall.on('CallStatsReceived', BX.DoNothing);\n\t\t\t// }\n\t\t\tthis.BitrixCall.on('UpdatePacketLoss', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ConnectionQualityChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ToggleRemoteParticipantVideo', BX.DoNothing);\n\t\t}\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\t/**\n\t * Adds new users to call\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users, show)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.type === CallType.Instant && this.peers[userId].calculatedState !== UserState.Calling)\n\t\t\t{\n\t\t\t\tthis.peers[userId].onInvited(show);\n\t\t\t}\n\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\ttoggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle = false) {\n\t\tif (this.BitrixCall) {\n\t\t\tthis.BitrixCall.toggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle)\n\t\t}\n\t}\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t#onPeerStateChanged = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.state === UserState.Failed || e.state === UserState.Unavailable || e.state === UserState.Declined || e.state === UserState.Idle)\n\t\t{\n\t\t\tif (this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout = (e) =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t#changeRecordState(params)\n\t{\n\t\tif (params.action !== View.RecordState.Started && this.recordState.userId != params.senderId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.action === View.RecordState.Started)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tthis.recordState.userId = params.senderId;\n\t\t\tthis.recordState.date.start = params.date;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\t\telse if (params.action === View.RecordState.Paused)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Started)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Paused;\n\t\t\tthis.recordState.date.pause.push(\n\t\t\t\t{start: params.date, finish: null}\n\t\t\t);\n\t\t}\n\t\telse if (params.action === View.RecordState.Resumed)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Paused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tconst pauseElement = this.recordState.date.pause.find(function (element)\n\t\t\t{\n\t\t\t\treturn element.finish === null;\n\t\t\t});\n\t\t\tif (pauseElement)\n\t\t\t{\n\t\t\t\tpauseElement.finish = params.date;\n\t\t\t}\n\t\t}\n\t\telse if (params.action === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Stopped;\n\t\t\tthis.recordState.userId = 0;\n\t\t\tthis.recordState.date.start = null;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\n\t\treturn true;\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tif (this.pullEventHandlers[command])\n\t\t{\n\t\t\tif (command !== 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\tthis.pullEventHandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventAnswer = (params) =>\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.__onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId] = this.createPeer(senderId);\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: senderId\n\t\t\t});\n\t\t}\n\n\t\tif (!this.users.includes(senderId))\n\t\t{\n\t\t\tthis.users.push(senderId);\n\t\t}\n\n\t\tthis.peers[senderId].setReady(true);\n\t};\n\n\t__onPullEventAnswerSelf(params)\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.joinedElsewhere = true;\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup = (params) =>\n\t{\n\t\tconst senderId = params.senderId;\n\t\tif (this.userId === senderId && params.callInstanceId && this.instanceId !== params.callInstanceId)\n\t\t{\n\t\t\t// Call declined by the same user elsewhere\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].participant = null;\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\t\telse if (params.code == 486)\n\t\t{\n\t\t\tthis.peers[senderId].setBusy(true);\n\t\t\tconsole.error(\"user \" + senderId + \" is busy\");\n\t\t}\n\n\t\tif (this.ready && this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersJoined', params);\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersInvited', params);\n\t\tconst users = params.users;\n\t\tconst show = params.show;\n\n\t\tif (this.type === CallType.Instant)\n\t\t{\n\t\t\tthis.addInvitedUsers(users, show);\n\t\t}\n\t};\n\n\t#onPullEventUserInviteTimeout = (params) =>\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventPing = (params) =>\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\tif (!this.joinedElsewhere)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: false\n\t\t\t\t});\n\t\t\t\tthis.joinedElsewhere = true;\n\t\t\t}\n\t\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\t\tthis.lastSelfPingReceivedTimeout = setTimeout(this.#onNoSelfPingsReceived, pingPeriod * 2.1);\n\t\t}\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tthis.lastPingReceivedTimeout = setTimeout(this.#onNoPingsReceived, pingPeriod * 2.1);\n\t\tif (this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId].setReady(true);\n\t\t}\n\t};\n\n\t#onNoPingsReceived = () =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tthis.destroy();\n\t\t}\n\t};\n\n\t#onNoSelfPingsReceived = () =>\n\t{\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: false\n\t\t});\n\t\tthis.joinedElsewhere = false;\n\t};\n\n\t#onPullEventFinish = () =>\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer = () =>\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t}\n\n\t#onPullEventSwitchTrackRecordStatus = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onSwitchTrackRecordStatus, {\n\t\t\tisTrackRecordOn: e.isTrackRecordOn,\n\t\t\terrorCode: e.errorCode,\n\t\t});\n\t}\n\n\t#onLocalMediaRendererAdded = (e) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for local mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('__onLocalMediaRendererAdded', kind);\n\n\t\tswitch (e) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.BitrixCall.getLocalVideo()\n\t\t\t\t\t.then((track) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.videoEnabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t\ttrack,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\ttag: 'main',\n\t\t\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.log(\"Screen shared\");\n\t\t\t\tthis.screenShared = true;\n\t\t\t\tthis.waitingLocalScreenShare = false;\n\n\t\t\t\tthis.BitrixCall.getLocalScreen()\n\t\t\t\t\t.then((tracks) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t\ttrack: tracks.video,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\ttag: 'screen',\n\t\t\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.BitrixCall.getLocalAudio()\n\t\t\t\t\t.then((track) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\t\t\t\tthis.#onMicAccessResult({\n\t\t\t\t\t\t\tresult: true,\n\t\t\t\t\t\t\tstream: new MediaStream([track]),\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\t#onLocalMediaRendererMuteToggled = (e) =>\n\t{\n\t\tif (e === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t}\n\t\telse if (e === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t}\n\t}\n\n\t#onMediaMutedBySystem = (muted) =>\n\t{\n\t\tconst microphoneState = muted ? false : !Hardware.isMicrophoneMuted;\n\t\tconst cameraState = muted ? false : Hardware.isCameraOn;\n\t\tthis.signaling.sendMicrophoneState(microphoneState);\n\t\tthis.signaling.sendCameraState(cameraState);\n\t}\n\n\t#onLocalMediaRendererEnded = (e, interrupted) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (e)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tif (!interrupted)\n\t\t\t\t{\n\t\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(e);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(e);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t#onGetUserMediaStarted = (options) =>\n\t{\n\t\tthis.getUserMediaFulfilled = false;\n\n\t\tif (options.video)\n\t\t{\n\t\t\tthis.signaling.sendCameraState(false);\n\t\t}\n\n\t\tif (options.audio)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(false);\n\t\t}\n\t};\n\n\t#onGetUserMediaSuccess = (options) =>\n\t{\n\t\tif (options.video)\n\t\t{\n\t\t\tthis.signaling.sendCameraState(true);\n\t\t}\n\n\t\tif (options.audio)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(true);\n\t\t}\n\t}\n\n\t#onGetUserMediaEnded = () =>\n\t{\n\t\tthis.getUserMediaFulfilled = true;\n\t};\n\n\t#onBeforeLocalMediaRendererRemoved = (e) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"__onBeforeLocalMediaRendererRemoved\", kind);\n\n\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\tkind,\n\t\t});\n\n\t\tswitch (e) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\tremoved: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\t\tthis.signaling.sendMicrophoneState(false);\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.BitrixCall.stopScreenShare();\n\t\t\t\tthis.log(\"Screen is no longer shared\");\n\t\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tscreenState: false,\n\t\t\t\t});\n\t\t\t\tthis.screenShared = false;\n\t\t\t\tthis.waitingLocalScreenShare = false;\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'screen',\n\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\tremoved: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\t#onRemoteMediaAdded = (p, t) =>\n\t{\n\t\tconst kind = MediaKinds[t.source];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${t.source}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst e = {\n\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\tkind,\n\t\t\t\ttrack: t.track\n\t\t\t})\n\t\t};\n\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tpeer.addMediaRenderer(e.mediaRenderer);\n\t\t\t// temporary solution to play new streams\n\t\t\t// todo: need to find what cause the problem itself\n\t\t\tif (!peer.participant)\n\t\t\t{\n\t\t\t\tpeer.participant = p;\n\t\t\t\tpeer.updateCalculatedState();\n\t\t\t}\n\t\t}\n\n\t\tswitch (t.source)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tcameraState: !p.isMutedVideo\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tmicrophoneState: !p.isMutedAudio\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconsole.log(`[RemoteMediaAdded]: UserId: ${p.userId}, source: ${MediaKinds[t.source]}`)\n\t};\n\n\t#onRemoteMediaRemoved = (p, t) =>\n\t{\n\t\tconst kind = MediaKinds[t.source];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${t.source}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst e = {\n\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\tkind,\n\t\t\t\ttrack: t.track\n\t\t\t})\n\t\t};\n\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tpeer.removeMediaRenderer(e.mediaRenderer);\n\t\t}\n\n\t\tconsole.log(`[RemoteMediaRemoved]: UserId: ${p.userId}, source: ${MediaKinds[t.source]}`)\n\t};\n\n\t#onRemoteMediaMuteToggled = (p, t) =>\n\t{\n\t\tif (t.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tmicrophoneState: !p.isMutedAudio\n\t\t\t});\n\t\t}\n\t}\n\n\t#onParticipantJoined = (p) =>\n\t{\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tif (!p.audioEnabled || p.isMutedAudio)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tmicrophoneState: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!p.videoEnabled || p.isMutedVideo)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tcameraState: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (p.isHandRaised)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\trequestActive: p.isHandRaised\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tpeer.participant = p;\n\t\t\tpeer.updateCalculatedState();\n\n\t\t\tif (this.recordState.state !== View.RecordState.Stopped && this.recordState.userId === this.userId)\n\t\t\t{\n\t\t\t\tthis.signaling.sendRecordState(this.userId, this.recordState);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onParticipantLeaved = (p) =>\n\t{\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tpeer.participant = null;\n\t\t\tfor (let type in MediaStreamsKinds)\n\t\t\t{\n\t\t\t\tconst source = MediaStreamsKinds[type];\n\t\t\t\tconst kind = MediaKinds[source];\n\t\t\t\tconst e = {\n\t\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\t\tkind,\n\t\t\t\t\t}),\n\t\t\t\t};\n\t\t\t\tpeer.removeMediaRenderer(e.mediaRenderer);\n\t\t\t}\n\t\t\tpeer.updateCalculatedState();\n\t\t}\n\t};\n\n\t#onMicAccessResult = (e) =>\n\t{\n\t\tif (e.result)\n\t\t{\n\t\t\tif (e.stream.getAudioTracks().length > 0)\n\t\t\t{\n\t\t\t\tif (this.localVAD)\n\t\t\t\t{\n\t\t\t\t\tthis.localVAD.destroy();\n\t\t\t\t}\n\t\t\t\tthis.localVAD = new SimpleVAD({\n\t\t\t\t\tmediaStream: e.stream,\n\t\t\t\t\tonVoiceStarted: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!Hardware.isMicrophoneMuted)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.requestFloor(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#onEndpointVoiceStart({userId: this.userId});\n\t\t\t\t\t},\n\t\t\t\t\tonVoiceStopped: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onEndpointVoiceEnd({userId: this.userId});\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t\t\tthis.microphoneLevelInterval = setInterval(\n\t\t\t\t\t() =>this.microphoneLevel = this.localVAD.currentVolume,\n\t\t\t\t\t200\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onCallReconnecting = () =>\n\t{\n\t\tif (this.reconnectionEventCount++)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (userId !== this.userId && this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tfor (let type in MediaStreamsKinds)\n\t\t\t\t{\n\t\t\t\t\tconst source = MediaStreamsKinds[type];\n\t\t\t\t\tconst kind = MediaKinds[source];\n\t\t\t\t\tconst e = {\n\t\t\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t}),\n\t\t\t\t\t};\n\t\t\t\t\tthis.peers[userId].removeMediaRenderer(e.mediaRenderer);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#onCallReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount = 0;\n\t\tthis.log(\"Call reconnected\");\n\t\tthis.sendTelemetryEvent(\"reconnect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tthis.signaling.sendMicrophoneState(!Hardware.isMicrophoneMuted);\n\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\tthis.BitrixCall.enableAudio(Hardware.isMicrophoneMuted);\n\n\t\tthis.signaling.sendCameraState(Hardware.isCameraOn);\n\t\tif (Hardware.isCameraOn)\n\t\t{\n\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\t\t\tthis.BitrixCall.enableVideo();\n\t\t}\n\n\t\tif (this.screenShared || this.waitingLocalScreenShare)\n\t\t{\n\t\t\tthis.BitrixCall.startScreenShare();\n\t\t}\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\n\t\tthis.BitrixCall.raiseHand(this.floorRequestActive);\n\t};\n\n\t#onCallDisconnected = (e) =>\n\t{\n\t\tlet logData = {};\n\n\t\tconst evt = e && typeof e === 'object' ? e : {}\n\t\tconst {headers, leaveInformation} = evt;\n\n\t\tif (headers) {\n\t\t\tlogData = {\n\t\t\t\t...logData,\n\t\t\t\theaders,\n\t\t\t}\n\t\t}\n\n\t\tif (leaveInformation) {\n\t\t\tlogData = {\n\t\t\t\t...logData,\n\t\t\t\tleaveInformation,\n\t\t\t}\n\t\t}\n\n\t\tthis.log(\"__onCallDisconnected\", (Object.keys(logData).length ? logData : null));\n\n\t\tif (this.ready && leaveInformation) {\n\t\t\tthis.hangup(leaveInformation.code, leaveInformation.reason)\n\t\t}\n\n\t\tthis.sendTelemetryEvent(\"disconnect\");\n\n\t\tthis.localUserState = UserState.Idle;\n\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.reinitPeers();\n\n\t\tthis.localVideoShown = false;\n\t\tthis.removeCallEvents();\n\t\tthis.unsubscribeHardwareChanges();\n\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: true\n\t\t});\n\t};\n\n\t#onWindowUnload = () =>\n\t{\n\t\tif (this.ready && this.BitrixCall)\n\t\t{\n\t\t\tthis.signaling.sendHangup({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t};\n\n\t#onFatalError = (error) =>\n\t{\n\t\tif (error && error.call)\n\t\t{\n\t\t\tdelete error.call;\n\t\t}\n\t\tthis.log(\"onFatalError\", error);\n\n\t\tthis.ready = false;\n\t\tthis.localUserState = UserState.Failed;\n\t\tthis.reinitPeers();\n\n\t\tthis.localVideoShown = false;\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.BitrixCall.hangup({\n\t\t\t\t\t'X-Reason': 'Fatal error',\n\t\t\t\t\t'X-Error': typeof (error) === 'string' ? error : error.code || error.name\n\t\t\t\t})\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\tthis.log(\"Bitrix hangup error: \", e);\n\t\t\t\tconsole.error(\"Bitrix hangup error: \", e);\n\t\t\t}\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\n\t\tif (typeof (error) === \"string\")\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, {\n\t\t\t\tname: error\n\t\t\t});\n\t\t}\n\t\telse if (error.name)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, error);\n\t\t}\n\t};\n\n\t#onCallStatsReceived = (stats) =>\n\t{\n\t\tconst usersToSendReports = {};\n\t\t// to order local stats by track quality\n\t\tconst statsIndexByRid = { f: 2, h: 1, q: 0 };\n\n\t\tstats.sender.forEach((report) =>\n\t\t{\n\t\t\tif (report.userId && (report.kind === 'video' || report.kind === 'audio'))\n\t\t\t{\n\t\t\t\tif (!usersToSendReports[report.userId])\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId] = {};\n\t\t\t\t}\n\n\t\t\t\tif (report.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tif (!usersToSendReports[report.userId][report.source])\n\t\t\t\t\t{\n\t\t\t\t\t\tusersToSendReports[report.userId][report.source] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tconst index = statsIndexByRid[report.rid] || 0;\n\t\t\t\t\tusersToSendReports[report.userId][report.source][index] = report;\n\t\t\t\t}\n\t\t\t\telse if (report.kind === 'audio')\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId][report.source] = report;\n\t\t\t\t}\n\n\t\t\t}\n\t\t});\n\n\t\tstats.recipient.forEach((report) =>\n\t\t{\n\t\t\tif (report.userId && (report.kind === 'video' || report.kind === 'audio'))\n\t\t\t{\n\t\t\t\tif (!usersToSendReports[report.userId])\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId] = {};\n\t\t\t\t}\n\t\t\t\tusersToSendReports[report.userId][report.source] = report;\n\t\t\t}\n\t\t});\n\n\t\tfor (let userId in usersToSendReports)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\t\tuserId,\n\t\t\t\treport: usersToSendReports[userId]\n\t\t\t});\n\t\t}\n\n\t\t// todo: need to correct stats format\n\t\t// if (this.logger)\n\t\t// {\n\t\t// \tthis.logger.sendStat(transformVoxStats(e.stats, this.BitrixCall));\n\t\t// }\n\t}\n\n\t#onUpdatePacketLoss = (participants) =>\n\t{\n\t\tconst prevPeersWithBadConnection = new Set([...this.peersWithBadConnection.values()]);\n\t\tparticipants.forEach(userId =>\n\t\t{\n\t\t\tconst peer = this.peers[userId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tif (!prevPeersWithBadConnection.has(userId))\n\t\t\t\t{\n\t\t\t\t\tthis.peersWithBadConnection.add(userId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tprevPeersWithBadConnection.delete(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t#onConnectionQualityChanged = participants =>\n\t{\n\t\tObject.keys(participants).forEach(participantId => {\n\t\t\tthis.runCallback(\n\t\t\t\tCallEvent.onConnectionQualityChanged,\n\t\t\t\t{\n\t\t\t\t\tuserId: Number(participantId),\n\t\t\t\t\tscore: participants[participantId],\n\t\t\t\t}\n\t\t\t);\n\t\t})\n\t}\n\n\t#onToggleRemoteParticipantVideo = isVideoShown =>\n\t{\n\t\tthis.runCallback(\n\t\t\tCallEvent.onToggleRemoteParticipantVideo,\n\t\t\t{ isVideoShown }\n\t\t);\n\t}\n\n\t#onCallMessageReceived = (e) =>\n\t{\n\t\tlet message;\n\t\tlet peer;\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(e.text);\n\t\t} catch (err)\n\t\t{\n\t\t\tthis.log(\"Could not parse scenario message.\", err);\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\t\tif (eventName === clientEvents.cameraState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcameraState: message.cameraState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.videoPaused)\n\t\t{\n\t\t\tif (message.senderId === this.userId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tvideoPaused: message.videoPaused === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.screenState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tscreenState: message.screenState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.recordState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trecordState: message.recordState\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.emotion)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserEmotion, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\ttoUserId: message.toUserId,\n\t\t\t\temotion: message.emotion\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.customMessage)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\tmessage: message.message\n\t\t\t})\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerJoined)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" joined\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setDirection(EndpointDirection.RecvOnly);\n\t\t\t\tpeer.setReady(true);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerLeft)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" left\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setReady(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Unknown scenario event \" + eventName);\n\t\t}\n\t};\n\n\t#onCallHandRaised = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\tuserId: p.userId,\n\t\t\trequestActive: p.isHandRaised\n\t\t})\n\t}\n\n\t#onEndpointVoiceStart = (p) =>\n\t{\n\t\t// for local user we need to send extra signal to show unmute hint\n\t\tif (p.userId === this.userId)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tlocal: true,\n\t\t\t});\n\n\t\t\tif (Hardware.isMicrophoneMuted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: p.userId,\n\t\t});\n\t};\n\n\t#onEndpointVoiceEnd = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: p.userId,\n\t\t});\n\t}\n\n\tsendTelemetryEvent(eventName)\n\t{\n\t\tUtil.sendTelemetryEvent({\n\t\t\tcall_id: this.id,\n\t\t\tuser_id: this.userId,\n\t\t\tkind: \"Bitrix\",\n\t\t\tevent: eventName,\n\t\t})\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tthis.BitrixCall.hangup();\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\n\t\twindow.removeEventListener(\"unload\", this.#onWindowUnload);\n\t\treturn super.destroy();\n\t};\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data);\n\t\t\tdata.retransmit = false;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\tsendFinish(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data);\n\t\t\tdata.retransmit = false;\n\t\t\tthis.#runRestAction(ajaxActions.finish, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\tthis.#runRestAction(ajaxActions.finish, data);\n\t\t}\n\t};\n\n\tsendCameraState(cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tcameraState: cameraState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendVideoPaused(videoPaused)\n\t{\n\t\treturn this.#sendMessage(clientEvents.videoPaused, {\n\t\t\tvideoPaused: videoPaused ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendMicrophoneState(microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tmicrophoneState: microphoneState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendScreenState(screenState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.screenState, {\n\t\t\tscreenState: screenState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendRecordState(userId, recordState)\n\t{\n\t\tthis.#sendMessage(clientEvents.recordState, {\n\t\t\tsenderId: userId,\n\t\t\trecordState: recordState\n\t\t});\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, {\n\t\t\tmessage: message,\n\t\t\trepeatOnConnect: !!repeatOnConnect\n\t\t});\n\t};\n\n\tsendShowUsers(users)\n\t{\n\t\treturn this.#sendMessage(clientEvents.showUsers, {\n\t\t\tusers: users\n\t\t});\n\t};\n\n\tsendShowAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.showAll, {});\n\t};\n\n\tsendHideAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.hideAll, {});\n\t};\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 0);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: false});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tif (data.userId.length === 0)\n\t\t{\n\t\t\t// nobody to send, exit\n\t\t\treturn;\n\t\t}\n\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\tCallEngine.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\t\tdata.eventName = eventName;\n\t\tdata.requestId = Util.getUuidv4();\n\t\tdata.senderId = this.call.userId;\n\n\t\tthis.call.BitrixCall.sendMessage(JSON.stringify(data));\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data);\n\t};\n}\n\nclass Peer\n{\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.userId = params.userId;\n\t\tthis.call = params.call;\n\n\t\tthis.ready = !!params.ready;\n\t\tthis.calling = false;\n\t\tthis.backgroundCalling = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.direction = params.direction || EndpointDirection.SendRecv;\n\n\t\tthis.stream = null;\n\t\tthis.mediaRenderers = [];\n\n\t\tthis.isIncomingVideoAllowed = params.isIncomingVideoAllowed !== false;\n\n\t\tthis.callingTimeout = 0;\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaRemoved: Type.isFunction(params.onMediaRemoved) ? params.onMediaRemoved : BX.DoNothing,\n\t\t};\n\n\t\tthis.calculatedState = this.calculateState();\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tready = !!ready;\n\t\tif (this.ready === ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.ready = ready;\n\t\tif (this.calling || this.backgroundCalling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.backgroundCalling = false;\n\t\t\tthis.inviteTimeout = false;\n\t\t}\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetDirection(direction)\n\t{\n\t\tif (this.direction === direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.direction = direction;\n\t}\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling || this.backgroundCalling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.backgroundCalling = false;\n\t\t}\n\t\tif (this.declined)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling || this.backgroundCalling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.backgroundCalling = false;\n\t\t}\n\t\tif (this.busy)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.declined = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tallowIncomingVideo(isIncomingVideoAllowed)\n\t{\n\t\tif (this.isIncomingVideoAllowed == isIncomingVideoAllowed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isIncomingVideoAllowed = !!isIncomingVideoAllowed;\n\t}\n\n\taddMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Adding media renderer for user' + this.userId, mediaRenderer);\n\n\t\tthis.mediaRenderers.push(mediaRenderer);\n\n\t\tthis.callbacks.onMediaReceived({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tremoveMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Removing media renderer for user' + this.userId, mediaRenderer);\n\n\t\tlet i\n\t\tthis.mediaRenderers.forEach((el, index) => {\n\t\t\tif (el.kind === mediaRenderer.kind) {\n\t\t\t\ti = index;\n\t\t\t}\n\t\t})\n\n\t\tif (i >= 0)\n\t\t{\n\t\t\tthis.mediaRenderers.splice(i, 1);\n\t\t}\n\t\tthis.callbacks.onMediaRemoved({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tcalculateState()\n\t{\n\t\tif (this.participant)\n\t\t{\n\t\t\treturn UserState.Connected;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t}\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState !== calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tdirection: this.direction,\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t}\n\n\tisParticipating()\n\t{\n\t\treturn ((this.calling || this.backgroundCalling || this.ready || this.participant) && !this.declined);\n\t}\n\n\tonInvited(showUser = false)\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tif (showUser)\n\t\t{\n\t\t\tthis.calling = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.backgroundCalling = true;\n\t\t}\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(() => this.onInviteTimeout(true), 30000);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tif (!(this.calling || this.backgroundCalling))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.calling = false;\n\t\tthis.backgroundCalling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.stream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.stream);\n\t\t\tthis.stream = null;\n\t\t}\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onInviteTimeout = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaRemoved = BX.DoNothing;\n\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.callingTimeout = null;\n\t}\n}\n\nconst transformVoxStats = function (s, BitrixCall)\n{\n\tlet result = {\n\t\tconnection: s.connection,\n\t\toutboundAudio: [],\n\t\toutboundVideo: [],\n\t\tinboundAudio: [],\n\t\tinboundVideo: [],\n\t}\n\n\tlet endpoints = {};\n\tif (BitrixCall.getEndpoints)\n\t{\n\t\tBitrixCall.getEndpoints().forEach(endpoint => endpoints[endpoint.id] = endpoint)\n\t}\n\n\tif (!result.connection.timestamp)\n\t{\n\t\tresult.connection.timestamp = Date.now();\n\t}\n\tfor (let trackId in s.outbound)\n\t{\n\t\tif (!s.outbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tconst statGroup = s.outbound[trackId];\n\t\tfor (let i = 0; i < statGroup.length; i++)\n\t\t{\n\t\t\tlet stat = statGroup[i];\n\t\t\tstat.trackId = trackId;\n\t\t\tif ('audioLevel' in stat)\n\t\t\t{\n\t\t\t\tresult.outboundAudio.push(stat)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.outboundVideo.push(stat)\n\t\t\t}\n\t\t}\n\t}\n\tfor (let trackId in s.inbound)\n\t{\n\t\tif (!s.inbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tlet stat = s.inbound[trackId];\n\t\tif (!('endpoint' in stat))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tstat.trackId = trackId;\n\t\tif ('audioLevel' in stat)\n\t\t{\n\t\t\tresult.inboundAudio.push(stat)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (endpoints[stat.endpoint])\n\t\t\t{\n\t\t\t\tlet videoRenderer = endpoints[stat.endpoint].mediaRenderers.find(r => r.id == stat.trackId)\n\t\t\t\tif (videoRenderer && videoRenderer.element)\n\t\t\t\t{\n\t\t\t\t\tstat.actualHeight = videoRenderer.element.videoHeight;\n\t\t\t\t\tstat.actualWidth = videoRenderer.element.videoWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.inboundVideo.push(stat)\n\t\t}\n\t}\n\treturn result;\n\n}\n\nclass MediaRenderer\n{\n\telement = null;\n\n\tconstructor(params)\n\t{\n\t\tparams = params || {};\n\t\tthis.kind = params.kind || 'video';\n\t\tif (params.track)\n\t\t{\n\t\t\tthis.stream = new MediaStream([params.track]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.stream = new MediaStream();\n\t\t}\n\t}\n\n\trender(el)\n\t{\n\t\tif (!el.srcObject || !el.srcObject.active || el.srcObject.id !== this.stream.id)\n\t\t{\n\t\t\tel.srcObject = this.stream;\n\t\t}\n\t}\n\n\trequestVideoSize()\n\t{\n\t}\n}\n","import {Type} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {\n\tCallEngine,\n\tEndpointDirection,\n\tUserState,\n\tQuality,\n\tUserMnemonic,\n\tCallEvent,\n\tCallState,\n\tCallType,\n\tProvider\n} from './engine';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../hardware';\nimport Util from '../util'\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onDestroy\n */\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tcancel: 'im.call.cancel',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping'\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n\trepeatAnswer: 'Call::repeatAnswer',\n};\n\nconst clientEvents = {\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tscreenState: 'Call::screenState',\n\trecordState: 'Call::recordState',\n\tfloorRequest: 'Call::floorRequest',\n\temotion: 'Call::emotion',\n\tcustomMessage: 'Call::customMessage',\n\tshowUsers: 'Call::showUsers',\n\tshowAll: 'Call::showAll',\n\thideAll: 'Call::hideAll',\n\n\tjoinRoom: 'Call::joinRoom',\n\tleaveRoom: 'Call::leaveRoom',\n\tlistRooms: 'Call::listRooms',\n\trequestRoomSpeaker: 'Call::requestRoomSpeaker',\n};\n\nconst scenarioEvents = {\n\tviewerJoined: 'Call::viewerJoined',\n\tviewerLeft: 'Call::viewerLeft',\n\n\tjoinRoomOffer: 'Call::joinRoomOffer',\n\ttransferRoomHost: 'Call::transferRoomHost',\n\tlistRoomsResponse: 'Call::listRoomsResponse',\n\troomUpdated: 'Call::roomUpdated',\n};\n\nconst VoximplantCallEvent = {\n\tonCallConference: 'VoximplantCall::onCallConference'\n};\n\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\nconst connectionRestoreTime = 15000;\n\n// const MAX_USERS_WITHOUT_SIMULCAST = 6;\n\nexport class VoximplantCall extends AbstractCall\n{\n\tstatic Event = VoximplantCallEvent\n\tpeers: { [key: number]: Peer }\n\tlocalVAD: ?SimpleVAD\n\n\tconstructor(config)\n\t{\n\t\tsuper(config);\n\n\t\tthis.debug = config.debug;\n\n\t\tthis.videoQuality = Quality.VeryHigh; // initial video quality. will drop on new peers connecting\n\n\t\tthis.voximplantCall = null;\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.peers = {};\n\t\tthis.joinedElsewhere = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis._localUserState = UserState.Idle;\n\t\tthis.clientEventsBound = false;\n\t\tthis._screenShared = false;\n\t\tthis.videoAllowedFrom = UserMnemonic.all;\n\t\tthis.direction = EndpointDirection.SendRecv;\n\n\t\tthis.microphoneLevelInterval = null;\n\n\t\tthis.rooms = {};\n\n\t\twindow.addEventListener(\"unload\", this.#onWindowUnload);\n\n\t\tthis.initPeers();\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.lastPingReceivedTimeout = null;\n\t\tthis.lastSelfPingReceivedTimeout = null;\n\n\t\tthis.reinviteTimeout = null;\n\n\t\t// There are two kinds of reconnection events: from call (for media connection) and from client (for signaling).\n\t\t// So we have to use counter to convert these two events to one\n\t\tthis._reconnectionEventCount = 0;\n\n\t\tthis.pullEventHandlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer,\n\t\t\t'Call::hangup': this.#onPullEventHangup,\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined,\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited,\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout,\n\t\t\t'Call::ping': this.#onPullEventPing,\n\t\t\t'Call::finish': this.#onPullEventFinish,\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer,\n\t\t}\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Voximplant;\n\t}\n\n\tget screenShared()\n\t{\n\t\treturn this._screenShared;\n\t}\n\n\tset screenShared(screenShared)\n\t{\n\t\tif (screenShared != this._screenShared)\n\t\t{\n\t\t\tthis._screenShared = screenShared;\n\t\t\tthis.signaling.sendScreenState(this._screenShared);\n\t\t}\n\t}\n\n\tget localUserState()\n\t{\n\t\treturn this._localUserState\n\t}\n\n\tset localUserState(state)\n\t{\n\t\tif (state == this._localUserState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.runCallback(CallEvent.onUserStateChanged, {\n\t\t\tuserId: this.userId,\n\t\t\tstate: state,\n\t\t\tpreviousState: this._localUserState,\n\t\t\tdirection: this.direction,\n\t\t});\n\t\tthis._localUserState = state;\n\t}\n\n\tget reconnectionEventCount()\n\t{\n\t\treturn this._reconnectionEventCount;\n\t}\n\n\tset reconnectionEventCount(newValue)\n\t{\n\t\tif (this._reconnectionEventCount === 0 && newValue > 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnecting);\n\t\t}\n\t\tif (newValue === 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t}\n\t\tthis._reconnectionEventCount = newValue;\n\t}\n\n\tinitPeers()\n\t{\n\t\tthis.users.forEach((userId) =>\n\t\t{\n\t\t\tuserId = Number(userId);\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t});\n\t};\n\n\treinitPeers()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t\tthis.peers[userId] = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.initPeers();\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tconst users = this.users.concat(this.userId);\n\t\t\tthis.signaling.sendPingToUsers({userId: users}, true);\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\tlet incomingVideoAllowed;\n\t\tif (this.videoAllowedFrom === UserMnemonic.all)\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\t\telse if (this.videoAllowedFrom === UserMnemonic.none)\n\t\t{\n\t\t\tincomingVideoAllowed = false;\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tincomingVideoAllowed = this.videoAllowedFrom.some(allowedUserId => allowedUserId == userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tisIncomingVideoAllowed: incomingVideoAllowed,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t\tif (e.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tvideoPaused: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRemoved: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonMediaRenderEnabled: (e) =>\n\t\t\t{\n\t\t\t\tconst endpoint = e.endpoint;\n\t\t\t\tconst userName = endpoint.userName;\n\t\t\t\t// user connected to conference (userName is in format `user${id}`\n\t\t\t\tconst userId = parseInt(userName.substring(4));\n\t\t\t\tif (this.peers[userId])\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onBadNetworkIndicator, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tbadNetworkIndicator: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRenderDisabled: (e) =>\n\t\t\t{\n\t\t\t\tconst endpoint = e.endpoint;\n\t\t\t\tconst userName = endpoint.userName;\n\t\t\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(userName.substring(4));\n\t\t\t\t\tif (this.peers[userId] && e.reason === 'disabledByServer')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onBadNetworkIndicator, {\n\t\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\t\tbadNetworkIndicator: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonVoiceStarted: () =>\n\t\t\t{\n\t\t\t\t// todo: uncomment to switch to SDK VAD events\n\t\t\t\t/*this.runCallback(Event.onUserVoiceStarted, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});*/\n\t\t\t},\n\t\t\tonVoiceEnded: () =>\n\t\t\t{\n\t\t\t\t// todo: uncomment to switch to SDK VAD events\n\t\t\t\t/*this.runCallback(Event.onUserVoiceStopped, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});*/\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged,\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout,\n\n\t\t})\n\t};\n\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.peers).length;\n\t};\n\n\tgetClient()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tBX.Voximplant.getClient({\n\t\t\t\tdebug: this.debug,\n\t\t\t\trestClient: CallEngine.getRestClient(),\n\t\t\t}).then((client) =>\n\t\t\t{\n\t\t\t\tclient.enableSilentLogging();\n\t\t\t\tclient.setLoggerCallback((e) => this.log(e.label + \": \" + e.message));\n\t\t\t\tthis.log(\"User agent: \" + navigator.userAgent);\n\t\t\t\tthis.log(\"Voximplant SDK version: \" + VoxImplant.version);\n\n\t\t\t\tthis.bindClientEvents();\n\n\t\t\t\tresolve(client);\n\t\t\t}).catch(reject);\n\t\t});\n\t};\n\n\tbindClientEvents()\n\t{\n\t\tconst streamManager = VoxImplant.Hardware.StreamManager.get();\n\n\t\tif (!this.clientEventsBound)\n\t\t{\n\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.MicAccessResult, this.#onMicAccessResult);\n\t\t\tif (VoxImplant.Events.Reconnecting)\n\t\t\t{\n\t\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.Reconnecting, this.#onClientReconnecting);\n\t\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.Reconnected, this.#onClientReconnected);\n\t\t\t}\n\n\t\t\t// streamManager.on(VoxImplant.Hardware.HardwareEvents.DevicesUpdated, this.#onLocalDevicesUpdated);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.MediaRendererAdded, this.#onLocalMediaRendererAdded);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.MediaRendererUpdated, this.#onLocalMediaRendererAdded);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.BeforeMediaRendererRemoved, this.#onBeforeLocalMediaRendererRemoved);\n\t\t\tthis.clientEventsBound = true;\n\t\t}\n\t};\n\n\tremoveClientEvents()\n\t{\n\t\tif (!('VoxImplant' in window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tVoxImplant.getInstance().off(VoxImplant.Events.MicAccessResult, this.#onMicAccessResult);\n\t\tif (VoxImplant.Events.Reconnecting)\n\t\t{\n\t\t\tVoxImplant.getInstance().off(VoxImplant.Events.Reconnecting, this.#onClientReconnecting);\n\t\t\tVoxImplant.getInstance().off(VoxImplant.Events.Reconnected, this.#onClientReconnected);\n\t\t}\n\n\t\tconst streamManager = VoxImplant.Hardware.StreamManager.get();\n\t\t// streamManager.off(VoxImplant.Hardware.HardwareEvents.DevicesUpdated, this.#onLocalDevicesUpdated);\n\t\tstreamManager.off(VoxImplant.Hardware.HardwareEvents.MediaRendererAdded, this.#onLocalMediaRendererAdded);\n\t\tstreamManager.off(VoxImplant.Hardware.HardwareEvents.BeforeMediaRendererRemoved, this.#onBeforeLocalMediaRendererRemoved);\n\t\tthis.clientEventsBound = false;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted == event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tif (this.muted)\n\t\t\t{\n\t\t\t\tthis.voximplantCall.muteMicrophone();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.voximplantCall.unmuteMicrophone();\n\t\t\t}\n\t\t\tthis.signaling.sendMicrophoneState(!this.muted);\n\t\t}\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tif (this.videoEnabled)\n\t\t\t{\n\t\t\t\tthis.#showLocalVideo();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.localVideoShown)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.StreamManager.get().hideLocalVideo().then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\ttag: \"main\",\n\t\t\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.voximplantCall.sendVideo(this.videoEnabled);\n\t\t\tthis.signaling.sendCameraState(this.videoEnabled);\n\t\t}\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tVoxImplant.Hardware.CameraManager.get().getInputDevices().then(() =>\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.CameraManager.get().setCallVideoSettings(this.voximplantCall, this.constructCameraParams());\n\t\t\t});\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().getInputDevices().then(() =>\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setCallAudioSettings(this.voximplantCall, {\n\t\t\t\t\tinputId: this.microphoneId\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\tgetCurrentMicrophoneId()\n\t{\n\t\tif (this.voximplantCall.peerConnection.impl.getTransceivers)\n\t\t{\n\t\t\tconst transceivers = this.voximplantCall.peerConnection.impl.getTransceivers();\n\t\t\tif (transceivers.length > 0)\n\t\t\t{\n\t\t\t\tconst audioTrack = transceivers[0].sender.track;\n\t\t\t\tconst audioTrackSettings = audioTrack.getSettings();\n\t\t\t\treturn audioTrackSettings.deviceId;\n\t\t\t}\n\t\t}\n\t\treturn this.microphoneId;\n\t};\n\n\tconstructCameraParams()\n\t{\n\t\tlet result = {};\n\n\t\tif (this.cameraId)\n\t\t{\n\t\t\tresult.cameraId = this.cameraId;\n\t\t}\n\n\t\tresult.videoQuality = this.videoHd ? VoxImplant.Hardware.VideoQuality.VIDEO_SIZE_HD : VoxImplant.Hardware.VideoQuality.VIDEO_SIZE_nHD;\n\t\tresult.facingMode = true;\n\t\treturn result;\n\t};\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\trequestFloor(requestActive)\n\t{\n\t\tthis.signaling.sendFloorRequest(requestActive);\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\tthis.signaling.sendRecordState(recordState);\n\t};\n\n\tsendEmotion(toUserId, emotion)\n\t{\n\t\tthis.signaling.sendEmotion(toUserId, emotion);\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\tthis.signaling.sendCustomMessage(message, repeatOnConnect);\n\t};\n\n\t/**\n\t * Updates list of users,\n\t */\n\tallowVideoFrom(userList: $Keys<typeof UserMnemonic> | number[])\n\t{\n\t\tif (this.videoAllowedFrom == userList)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoAllowedFrom = userList;\n\n\t\tif (userList === UserMnemonic.all)\n\t\t{\n\t\t\tthis.signaling.sendShowAll();\n\t\t\tuserList = Object.keys(this.peers);\n\t\t}\n\t\telse if (userList === UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t\tuserList = [];\n\t\t}\n\t\telse if (Type.isArray(userList))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(userList)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error(\"userList is in wrong format\");\n\t\t}\n\n\t\tlet users = {};\n\t\tuserList.forEach(userId => users[userId] = true);\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (!this.peers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (users[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(false);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Sets bitrate cap for outgoing video\n\t * @param bitrate\n\t * @deprecated\n\t */\n\n\t/*#setMaxBitrate(bitrate)\n\t{\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tconst transceivers = this.voximplantCall.peerConnection.getTransceivers();\n\t\t\tif (!transceivers)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttransceivers.forEach((tr) =>\n\t\t\t{\n\t\t\t\tif (tr.sender && tr.sender.track && tr.sender.track.kind === 'video' && !tr.stoped && tr.currentDirection.indexOf('send') !== -1)\n\t\t\t\t{\n\t\t\t\t\tconst sender = tr.sender;\n\t\t\t\t\tconst parameters = sender.getParameters();\n\t\t\t\t\tif (!parameters.encodings)\n\t\t\t\t\t{\n\t\t\t\t\t\tparameters.encodings = [{}];\n\t\t\t\t\t}\n\t\t\t\t\tif (bitrate === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdelete parameters.encodings[0].maxBitrate;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tparameters.encodings[0].maxBitrate = bitrate * 1000;\n\t\t\t\t\t}\n\t\t\t\t\tsender.setParameters(parameters);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};*/\n\n\t#showLocalVideo()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tVoxImplant.Hardware.StreamManager.get().showLocalVideo(false).then(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\t};\n\n\t#hideLocalVideo()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (!('VoxImplant' in window))\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tVoxImplant.Hardware.StreamManager.get().hideLocalVideo().then(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t);\n\t\t})\n\t};\n\n\tstartScreenSharing()\n\t{\n\t\tif (!this.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst showLocalView = !Hardware.isCameraOn;\n\t\tconst replaceTrack = Hardware.isCameraOn || this.screenShared;\n\n\t\tthis.voximplantCall.shareScreen(showLocalView, replaceTrack)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Screen shared\");\n\t\t\t\tthis.screenShared = true;\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.log(\"Screen sharing error:\", error)\n\t\t\t})\n\t\t;\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tif (!this.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.voximplantCall.stopSharingScreen()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Screen is no longer shared\");\n\t\t\t\tthis.screenShared = false;\n\t\t\t})\n\t\t;\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.screenShared;\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t */\n\tinviteUsers(config: { users: number[] } = {})\n\t{\n\t\tthis.ready = true;\n\t\tlet users = Type.isArray(config.users) ? config.users : this.users;\n\n\t\tthis.attachToConference()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.signaling.sendPingToUsers({userId: users});\n\n\t\t\t\tif (users.length > 0)\n\t\t\t\t{\n\t\t\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\t\t\tuserIds: users,\n\t\t\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(users[i]);\n\t\t\t\t\tif (!this.users.includes(userId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.users.push(userId);\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e)\n\t\t\t})\n\t\t;\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(() => this.repeatInviteUsers(), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst inviteParams = {\n\t\t\tuserIds: usersToRepeatInvite,\n\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\trepeated: 'Y',\n\t\t}\n\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t};\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool?} [config.useVideo]\n\t * @param {bool?} [config.joinAsViewer]\n\t */\n\tanswer(config = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst joinAsViewer = config.joinAsViewer === true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tif (!joinAsViewer)\n\t\t{\n\t\t\tthis.signaling.sendAnswer();\n\t\t}\n\t\tthis.attachToConference({joinAsViewer: joinAsViewer})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Attached to conference\");\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(err);\n\t\t\t})\n\t\t;\n\t};\n\n\tdecline(code)\n\t{\n\t\tthis.ready = false;\n\t\tconst data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\t\tif (code)\n\t\t{\n\t\t\tdata.code = code\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data);\n\t};\n\n\thangup(code, reason)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\n\t\tlet data = {};\n\t\tthis.ready = false;\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t//clone users and append current user id to send event to all participants of the call\n\t\tdata.userId = this.users.slice(0).concat(this.userId);\n\t\tthis.signaling.sendHangup(data);\n\n\t\t// for future reconnections\n\t\tthis.reinitPeers();\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.voximplantCall._replaceVideoSharing = false;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.voximplantCall.hangup();\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\tthis.log(\"Voximplant hangup error: \", e);\n\t\t\t\tconsole.error(\"Voximplant hangup error: \", e);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Tried to hangup, but this.voximplantCall points nowhere\");\n\t\t\tconsole.error(\"Tried to hangup, but this.voximplantCall points nowhere\");\n\t\t}\n\n\t\tthis.screenShared = false;\n\t\tthis.#hideLocalVideo();\n\t};\n\n\tattachToConference(options: { joinAsViewer: ?boolean } = {})\n\t{\n\t\tconst joinAsViewer = options.joinAsViewer === true;\n\t\tif (this.voximplantCall && this.voximplantCall.state() === \"CONNECTED\")\n\t\t{\n\t\t\tif (this.joinedAsViewer === joinAsViewer)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Promise.reject(\"Already joined call in another mode\");\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.direction = joinAsViewer ? EndpointDirection.RecvOnly : EndpointDirection.SendRecv;\n\t\t\tthis.sendTelemetryEvent(\"call\");\n\n\t\t\tthis.getClient().then((voximplantClient) =>\n\t\t\t{\n\t\t\t\tthis.localUserState = UserState.Connecting;\n\n\t\t\t\t// workaround to set default video settings before starting call. ugly, but I do not see another way\n\t\t\t\tVoxImplant.Hardware.CameraManager.get().setDefaultVideoSettings(this.constructCameraParams());\n\t\t\t\tif (this.microphoneId)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setDefaultAudioSettings({\n\t\t\t\t\t\tinputId: this.microphoneId\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (Hardware.isCameraOn)\n\t\t\t\t{\n\t\t\t\t\tthis.#showLocalVideo();\n\t\t\t\t}\n\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tif (!this.ready)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.log(\"Error: trying to attach after hangup\");\n\t\t\t\t\t\treturn reject({code: \"VOX_NO_CALL\"});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (joinAsViewer)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.voximplantCall = voximplantClient.joinAsViewer(\"bx_conf_\" + this.id, {\n\t\t\t\t\t\t\t'X-Direction': EndpointDirection.RecvOnly\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.voximplantCall = voximplantClient.callConference({\n\t\t\t\t\t\t\tnumber: \"bx_conf_\" + this.id,\n\t\t\t\t\t\t\tvideo: {sendVideo: Hardware.isCameraOn, receiveVideo: true},\n\t\t\t\t\t\t\t// simulcast: (this.getUserCount() > MAX_USERS_WITHOUT_SIMULCAST),\n\t\t\t\t\t\t\t// simulcastProfileName: 'b24',\n\t\t\t\t\t\t\tcustomData: JSON.stringify({\n\t\t\t\t\t\t\t\tcameraState: Hardware.isCameraOn,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\treturn reject(e);\n\t\t\t\t}\n\t\t\t\tthis.joinedAsViewer = joinAsViewer;\n\n\t\t\t\tif (!this.voximplantCall)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create voximplant call\");\n\t\t\t\t\treturn reject({code: \"VOX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.runCallback(VoximplantCallEvent.onCallConference, {\n\t\t\t\t\tcall: this\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\tthis.voximplantCall.on(\n\t\t\t\t\tVoxImplant.CallEvents.Connected,\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onCallConnected();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{once: true});\n\t\t\t\tthis.voximplantCall.on(\n\t\t\t\t\tVoxImplant.CallEvents.Failed,\n\t\t\t\t\t(e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onCallFailed(e);\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t},\n\t\t\t\t\t{once: true}\n\t\t\t\t);\n\t\t\t}).catch(this.#onFatalError.bind(this));\n\t\t});\n\t};\n\n\t#onCallConnected()\n\t{\n\t\tthis.log(\"Call connected\");\n\t\tthis.sendTelemetryEvent(\"connect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Failed, this.#onCallDisconnected);\n\n\t\tif (Hardware.isMicrophoneMuted)\n\t\t{\n\t\t\tthis.voximplantCall.muteMicrophone();\n\t\t}\n\n\t\tthis.signaling.sendMicrophoneState(!Hardware.isMicrophoneMuted);\n\t\tthis.signaling.sendCameraState(Hardware.isCameraOn);\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\t};\n\n\t#onCallFailed(e)\n\t{\n\t\tthis.log(\"Could not attach to conference\", e);\n\t\tthis.sendTelemetryEvent(\"connect_failure\");\n\t\tthis.localUserState = UserState.Failed;\n\n\t\tconst client = VoxImplant.getInstance();\n\t\tclient.enableSilentLogging(false);\n\t\tclient.setLoggerCallback(null);\n\t};\n\n\tbindCallEvents()\n\t{\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Disconnected, this.#onCallDisconnected);\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.MessageReceived, this.#onCallMessageReceived);\n\t\tif (Util.shouldCollectStats())\n\t\t{\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.CallStatsReceived, this.#onCallStatsReceived);\n\t\t}\n\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.EndpointAdded, this.#onCallEndpointAdded);\n\t\tif (VoxImplant.CallEvents.Reconnecting)\n\t\t{\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Reconnecting, this.#onCallReconnecting);\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Reconnected, this.#onCallReconnected);\n\t\t}\n\t};\n\n\tremoveCallEvents()\n\t{\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Disconnected, this.#onCallDisconnected);\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.MessageReceived, this.#onCallMessageReceived);\n\t\t\tif (Util.shouldCollectStats())\n\t\t\t{\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.CallStatsReceived, this.#onCallStatsReceived);\n\t\t\t}\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.EndpointAdded, this.#onCallEndpointAdded);\n\t\t\tif (VoxImplant.CallEvents.Reconnecting)\n\t\t\t{\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Reconnecting, this.#onCallReconnecting);\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Reconnected, this.#onCallReconnected);\n\t\t\t}\n\t\t}\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\t/**\n\t * Adds new users to call\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tif (this.peers[userId].calculatedState === UserState.Failed || this.peers[userId].calculatedState === UserState.Idle)\n\t\t\t\t{\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tupdateRoom(roomData)\n\t{\n\t\tif (!this.rooms[roomData.id])\n\t\t{\n\t\t\tthis.rooms[roomData.id] = {\n\t\t\t\tid: roomData.id,\n\t\t\t\tusers: roomData.users,\n\t\t\t\tspeaker: roomData.speaker\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.rooms[roomData.id].users = roomData.users;\n\t\t\tthis.rooms[roomData.id].speaker = roomData.speaker;\n\t\t}\n\t}\n\n\tcurrentRoom()\n\t{\n\t\treturn this._currentRoomId ? this.rooms[this._currentRoomId] : null;\n\t}\n\n\tisRoomSpeaker()\n\t{\n\t\treturn this.currentRoom() ? this.currentRoom().speaker == this.userId : false;\n\t}\n\n\tjoinRoom(roomId)\n\t{\n\t\tthis.signaling.sendJoinRoom(roomId);\n\t}\n\n\trequestRoomSpeaker()\n\t{\n\t\tthis.signaling.sendRequestRoomSpeaker(this._currentRoomId);\n\t}\n\n\tleaveCurrentRoom()\n\t{\n\t\tthis.signaling.sendLeaveRoom(this._currentRoomId);\n\t}\n\n\tlistRooms()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.signaling.sendListRooms();\n\t\t\tthis.__resolveListRooms = resolve;\n\t\t});\n\t}\n\n\t#onPeerStateChanged = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.state == UserState.Failed || e.state == UserState.Unavailable || e.state == UserState.Declined || e.state == UserState.Idle)\n\t\t{\n\t\t\tif (this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout = (e) =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tif (this.pullEventHandlers[command])\n\t\t{\n\t\t\tif (command != 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\tthis.pullEventHandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventAnswer = (params) =>\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.__onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId] = this.createPeer(senderId);\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: senderId\n\t\t\t});\n\t\t}\n\n\t\tif (!this.users.includes(senderId))\n\t\t{\n\t\t\tthis.users.push(senderId);\n\t\t}\n\n\t\tthis.peers[senderId].setReady(true);\n\t};\n\n\t__onPullEventAnswerSelf(params)\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.joinedElsewhere = true;\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup = (params) =>\n\t{\n\t\tconst senderId = params.senderId;\n\t\tif (this.userId == senderId && this.instanceId != params.callInstanceId)\n\t\t{\n\t\t\t// Call declined by the same user elsewhere\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\t\telse if (params.code == 486)\n\t\t{\n\t\t\tthis.peers[senderId].setBusy(true);\n\t\t\tconsole.error(\"user \" + senderId + \" is busy\");\n\t\t}\n\n\t\tif (this.ready && this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersJoined', params);\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersInvited', params);\n\t\tconst users = params.users;\n\n\t\tif (this.type === CallType.Instant)\n\t\t{\n\t\t\tthis.addInvitedUsers(users);\n\t\t}\n\t};\n\n\t#onPullEventUserInviteTimeout = (params) =>\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventPing = (params) =>\n\t{\n\t\tif (params.callInstanceId == this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\tif (!this.joinedElsewhere)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: false\n\t\t\t\t});\n\t\t\t\tthis.joinedElsewhere = true;\n\t\t\t}\n\t\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\t\tthis.lastSelfPingReceivedTimeout = setTimeout(this.#onNoSelfPingsReceived, pingPeriod * 2.1);\n\t\t}\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tthis.lastPingReceivedTimeout = setTimeout(this.#onNoPingsReceived, pingPeriod * 2.1);\n\t\tif (this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId].setReady(true);\n\t\t}\n\t};\n\n\t#onNoPingsReceived = () =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tthis.destroy();\n\t\t}\n\t};\n\n\t#onNoSelfPingsReceived = () =>\n\t{\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: false\n\t\t});\n\t\tthis.joinedElsewhere = false;\n\t};\n\n\t#onPullEventFinish = () =>\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer = () =>\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t}\n\n\t#onLocalMediaRendererAdded = (e) =>\n\t{\n\t\tconst renderer = e.renderer;\n\t\tconst trackLabel = renderer.stream.getVideoTracks().length > 0 ? renderer.stream.getVideoTracks()[0].label : \"\";\n\t\tthis.log(\"__onLocalMediaRendererAdded\", renderer.kind, trackLabel);\n\n\t\tif (renderer.kind === \"video\")\n\t\t{\n\t\t\tlet tag;\n\t\t\tif (trackLabel.match(/^screen|window|tab|web-contents-media-stream/i))\n\t\t\t{\n\t\t\t\ttag = \"screen\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttag = \"main\";\n\t\t\t}\n\n\t\t\tthis.screenShared = tag === \"screen\";\n\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: tag,\n\t\t\t\tstream: renderer.stream,\n\t\t\t});\n\t\t}\n\t\telse if (renderer.kind === \"sharing\")\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: \"screen\",\n\t\t\t\tstream: renderer.stream,\n\t\t\t});\n\t\t\tthis.screenShared = true;\n\t\t}\n\t};\n\n\t#onBeforeLocalMediaRendererRemoved = (e) =>\n\t{\n\t\tconst renderer = e.renderer;\n\t\tthis.log(\"__onBeforeLocalMediaRendererRemoved\", renderer.kind);\n\n\t\tif (renderer.kind === \"sharing\" && !Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: \"main\",\n\t\t\t\tstream: new MediaStream(),\n\t\t\t});\n\t\t\tthis.screenShared = false;\n\t\t}\n\t};\n\n\t#onMicAccessResult = (e) =>\n\t{\n\t\tif (this.ready && e.result)\n\t\t{\n\t\t\tif (e.stream.getAudioTracks().length > 0)\n\t\t\t{\n\t\t\t\tif (this.localVAD)\n\t\t\t\t{\n\t\t\t\t\tthis.localVAD.destroy();\n\t\t\t\t}\n\t\t\t\tthis.localVAD = new SimpleVAD({\n\t\t\t\t\tmediaStream: e.stream,\n\t\t\t\t\tonVoiceStarted: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonVoiceStopped: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t\t\tthis.microphoneLevelInterval = setInterval(\n\t\t\t\t\t() =>this.microphoneLevel = this.localVAD.currentVolume,\n\t\t\t\t\t200\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onCallReconnecting = () =>\n\t{\n\t\tthis.reconnectionEventCount++;\n\t}\n\n\t#onCallReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount--;\n\t}\n\n\t#onClientReconnecting = () =>\n\t{\n\t\tthis.reconnectionEventCount++;\n\t}\n\n\t#onClientReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount--;\n\t};\n\n\t#onCallDisconnected = (e) =>\n\t{\n\t\tthis.log(\"__onCallDisconnected\", (e && e.headers ? {headers: e.headers} : null));\n\t\tthis.sendTelemetryEvent(\"disconnect\");\n\t\tthis.localUserState = UserState.Idle;\n\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.reinitPeers();\n\n\t\tthis.#hideLocalVideo();\n\t\tthis.removeCallEvents();\n\t\tthis.unsubscribeHardwareChanges();\n\t\tthis.voximplantCall = null;\n\n\t\tconst client = VoxImplant.getInstance();\n\t\tclient.enableSilentLogging(false);\n\t\tclient.setLoggerCallback(null);\n\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: true\n\t\t});\n\t};\n\n\t#onWindowUnload = () =>\n\t{\n\t\tif (this.ready && this.voximplantCall)\n\t\t{\n\t\t\tthis.signaling.sendHangup({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t};\n\n\t#onFatalError = (error) =>\n\t{\n\t\tif (error && error.call)\n\t\t{\n\t\t\tdelete error.call;\n\t\t}\n\t\tthis.log(\"onFatalError\", error);\n\n\t\tthis.ready = false;\n\t\tthis.localUserState = UserState.Failed;\n\t\tthis.reinitPeers();\n\n\t\tthis.#hideLocalVideo().then(() =>\n\t\t{\n\t\t\tif (this.voximplantCall)\n\t\t\t{\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantCall.hangup({\n\t\t\t\t\t\t'X-Reason': 'Fatal error',\n\t\t\t\t\t\t'X-Error': typeof (error) === 'string' ? error : error.code || error.name\n\t\t\t\t\t})\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Voximplant hangup error: \", e);\n\t\t\t\t\tconsole.error(\"Voximplant hangup error: \", e);\n\t\t\t\t}\n\t\t\t\tthis.voximplantCall = null;\n\t\t\t}\n\n\t\t\tif (typeof (VoxImplant) !== 'undefined')\n\t\t\t{\n\t\t\t\tconst client = VoxImplant.getInstance();\n\n\t\t\t\tclient.enableSilentLogging(false);\n\t\t\t\tclient.setLoggerCallback(null);\n\t\t\t}\n\n\t\t\tif (typeof (error) === \"string\")\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onCallFailure, {\n\t\t\t\t\tname: error\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (error.name)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onCallFailure, error);\n\t\t\t}\n\t\t})\n\t};\n\n\t#setEndpointForUser(userName: string, endpoint)\n\t{\n\t\t// user connected to conference (userName is in format `user${id}`\n\t\tconst userId = parseInt(userName.substring(4));\n\t\tif (this.peers[userId])\n\t\t{\n\t\t\tthis.peers[userId].setEndpoint(endpoint);\n\t\t}\n\t\tthis.wasConnected = true;\n\t}\n\n\t#onCallEndpointAdded = (e) =>\n\t{\n\t\tconst endpoint = e.endpoint;\n\t\tconst userName = endpoint.userName;\n\t\tthis.log(\"__onCallEndpointAdded (\" + userName + \")\", e.endpoint);\n\t\tconsole.log(\"__onCallEndpointAdded (\" + userName + \")\", e.endpoint);\n\n\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t{\n\t\t\tthis.#setEndpointForUser(userName, endpoint)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tendpoint.addEventListener(VoxImplant.EndpointEvents.InfoUpdated, (e) =>\n\t\t\t{\n\t\t\t\tconst endpoint = e.endpoint;\n\t\t\t\tconst userName = endpoint.userName;\n\t\t\t\tthis.log(\"VoxImplant.EndpointEvents.InfoUpdated (\" + userName + \")\", e.endpoint);\n\n\t\t\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t\t\t{\n\t\t\t\t\tthis.#setEndpointForUser(userName, endpoint)\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.log('Unknown endpoint ' + userName);\n\t\t\tconsole.warn('Unknown endpoint ' + userName);\n\t\t}\n\t};\n\n\t#onCallStatsReceived = (e) =>\n\t{\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.sendStat(transformVoxStats(e.stats, this.voximplantCall));\n\t\t}\n\t}\n\n\t#onJoinRoomOffer = (e) =>\n\t{\n\t\tconsole.warn(\"__onJoinRoomOffer\", e)\n\t\tthis.updateRoom({\n\t\t\tid: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tspeaker: e.speaker,\n\t\t});\n\t\tthis.runCallback(CallEvent.onJoinRoomOffer, {\n\t\t\troomId: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tinitiator: e.initiator,\n\t\t\tspeaker: e.speaker,\n\t\t})\n\t}\n\n\t#onRoomUpdated = (e) =>\n\t{\n\t\tconst speakerChanged = (\n\t\t\te.roomId === this._currentRoomId\n\t\t\t&& this.rooms[e.roomId]\n\t\t\t&& this.rooms[e.roomId].speaker != e.speaker\n\t\t);\n\t\tconst previousSpeaker = speakerChanged && this.rooms[e.roomId].speaker;\n\n\t\tconsole.log(\"__onRoomUpdated; speakerChanged: \", speakerChanged)\n\t\tthis.updateRoom({\n\t\t\tid: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tspeaker: e.speaker,\n\t\t});\n\n\t\tif (e.roomId === this._currentRoomId && e.users.indexOf(this.userId) === -1)\n\t\t{\n\t\t\tthis._currentRoomId = null;\n\t\t\tthis.runCallback(CallEvent.onLeaveRoom, {\n\t\t\t\troomId: e.roomId\n\t\t\t})\n\t\t}\n\t\telse if (e.roomId !== this._currentRoomId && e.users.indexOf(this.userId) !== -1)\n\t\t{\n\t\t\tthis._currentRoomId = e.roomId;\n\t\t\tthis.runCallback(CallEvent.onJoinRoom, {\n\t\t\t\troomId: e.roomId,\n\t\t\t\tspeaker: this.currentRoom().speaker,\n\t\t\t\tusers: this.currentRoom().users,\n\t\t\t})\n\t\t}\n\t\telse if (speakerChanged)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onTransferRoomSpeaker, {\n\t\t\t\troomId: e.roomId,\n\t\t\t\tspeaker: e.speaker,\n\t\t\t\tpreviousSpeaker: previousSpeaker,\n\t\t\t\tinitiator: e.initiator,\n\t\t\t})\n\t\t}\n\t};\n\n\t#onCallMessageReceived = (e) =>\n\t{\n\t\tlet message;\n\t\tlet peer;\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(e.text);\n\t\t} catch (err)\n\t\t{\n\t\t\tthis.log(\"Could not parse scenario message.\", err);\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\t\tif (eventName === clientEvents.voiceStarted)\n\t\t{\n\t\t\t// todo: remove after switching to SDK VAD events\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: message.senderId\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.voiceStopped)\n\t\t{\n\t\t\t// todo: remove after switching to SDK VAD events\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\tuserId: message.senderId\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.microphoneState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tmicrophoneState: message.microphoneState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.cameraState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcameraState: message.cameraState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.videoPaused)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tvideoPaused: message.videoPaused === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.screenState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tscreenState: message.screenState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.recordState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trecordState: message.recordState\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.floorRequest)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trequestActive: message.requestActive === \"Y\"\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.emotion)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserEmotion, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\ttoUserId: message.toUserId,\n\t\t\t\temotion: message.emotion\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.customMessage)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\tmessage: message.message\n\t\t\t})\n\t\t}\n\t\telse if (eventName === \"scenarioLogUrl\")\n\t\t{\n\t\t\tconsole.warn(\"scenario log url: \" + message.logUrl)\n\t\t}\n\t\telse if (eventName === scenarioEvents.joinRoomOffer)\n\t\t{\n\t\t\tconsole.log(message)\n\t\t\tthis.#onJoinRoomOffer(message);\n\t\t}\n\t\telse if (eventName === scenarioEvents.roomUpdated)\n\t\t{\n\t\t\t// console.log(message)\n\t\t\tthis.#onRoomUpdated(message);\n\t\t}\n\t\telse if (eventName === scenarioEvents.listRoomsResponse)\n\t\t{\n\t\t\tif (this.__resolveListRooms)\n\t\t\t{\n\t\t\t\tthis.__resolveListRooms(message.rooms)\n\t\t\t\tdelete this.__resolveListRooms;\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerJoined)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" joined\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setDirection(EndpointDirection.RecvOnly);\n\t\t\t\tpeer.setReady(true);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerLeft)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" left\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setReady(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Unknown scenario event \" + eventName);\n\t\t}\n\t};\n\n\tsendTelemetryEvent(eventName)\n\t{\n\t\tUtil.sendTelemetryEvent({\n\t\t\tcall_id: this.id,\n\t\t\tuser_id: this.userId,\n\t\t\tkind: \"voximplant\",\n\t\t\tevent: eventName,\n\t\t})\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.#hideLocalVideo();\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tif (this.voximplantCall.state() != \"ENDED\")\n\t\t\t{\n\t\t\t\tthis.voximplantCall.hangup();\n\t\t\t}\n\t\t\tthis.voximplantCall = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.removeClientEvents();\n\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\n\t\twindow.removeEventListener(\"unload\", this.#onWindowUnload);\n\t\treturn super.destroy();\n\t};\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendCancel(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.cancel, data);\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data);\n\t\t\tdata.retransmit = false;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\tsendVoiceStarted(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStarted, data);\n\t};\n\n\tsendVoiceStopped(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStopped, data);\n\t};\n\n\tsendMicrophoneState(microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tmicrophoneState: microphoneState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendCameraState(cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tcameraState: cameraState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendScreenState(screenState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.screenState, {\n\t\t\tscreenState: screenState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.recordState, recordState);\n\t};\n\n\tsendFloorRequest(requestActive)\n\t{\n\t\treturn this.#sendMessage(clientEvents.floorRequest, {\n\t\t\trequestActive: requestActive ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendEmotion(toUserId, emotion)\n\t{\n\t\treturn this.#sendMessage(clientEvents.emotion, {\n\t\t\ttoUserId: toUserId,\n\t\t\temotion: emotion\n\t\t});\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, {\n\t\t\tmessage: message,\n\t\t\trepeatOnConnect: !!repeatOnConnect\n\t\t});\n\t};\n\n\tsendShowUsers(users)\n\t{\n\t\treturn this.#sendMessage(clientEvents.showUsers, {\n\t\t\tusers: users\n\t\t});\n\t};\n\n\tsendShowAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.showAll, {});\n\t};\n\n\tsendHideAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.hideAll, {});\n\t};\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 0);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: false});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\tsendJoinRoom(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.joinRoom, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\tsendLeaveRoom(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.leaveRoom, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\tsendListRooms()\n\t{\n\t\treturn this.#sendMessage(clientEvents.listRooms);\n\t};\n\n\tsendRequestRoomSpeaker(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.requestRoomSpeaker, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tif (data.userId.length === 0)\n\t\t{\n\t\t\t// nobody to send, exit\n\t\t\treturn;\n\t\t}\n\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\tCallEngine.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\t\tdata.eventName = eventName;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.voximplantCall.sendMessage(JSON.stringify(data));\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data);\n\t};\n}\n\nclass Peer\n{\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.userId = params.userId;\n\t\tthis.call = params.call;\n\n\t\tthis.ready = !!params.ready;\n\t\tthis.calling = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.endpoint = null;\n\t\tthis.direction = params.direction || EndpointDirection.SendRecv;\n\n\t\tthis.stream = null;\n\t\tthis.mediaRenderers = [];\n\n\t\tthis.isIncomingVideoAllowed = params.isIncomingVideoAllowed !== false;\n\n\t\tthis.callingTimeout = 0;\n\t\tthis.connectionRestoreTimeout = 0;\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaRemoved: Type.isFunction(params.onMediaRemoved) ? params.onMediaRemoved : BX.DoNothing,\n\t\t\tonVoiceStarted: Type.isFunction(params.onVoiceStarted) ? params.onVoiceStarted : BX.DoNothing,\n\t\t\tonVoiceEnded: Type.isFunction(params.onVoiceEnded) ? params.onVoiceEnded : BX.DoNothing,\n\t\t\tonMediaRenderEnabled: Type.isFunction(params.onMediaRenderEnabled) ? params.onMediaRenderEnabled : BX.DoNothing,\n\t\t\tonMediaRenderDisabled: Type.isFunction(params.onMediaRenderDisabled) ? params.onMediaRenderDisabled : BX.DoNothing,\n\t\t};\n\n\t\tthis.calculatedState = this.calculateState();\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tready = !!ready;\n\t\tif (this.ready == ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.ready = ready;\n\t\tthis.readyStack = (new Error()).stack;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.inviteTimeout = false;\n\t\t}\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetDirection(direction)\n\t{\n\t\tif (this.direction == direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.direction = direction;\n\t}\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.declined)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.busy)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.declined = false;\n\t\t}\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetEndpoint(endpoint)\n\t{\n\t\tthis.log(\"Adding endpoint with \" + endpoint.mediaRenderers.length + \" media renderers\");\n\n\t\tthis.setReady(true);\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\n\t\tthis.endpoint = endpoint;\n\n\t\tfor (let i = 0; i < this.endpoint.mediaRenderers.length; i++)\n\t\t{\n\t\t\tthis.addMediaRenderer(this.endpoint.mediaRenderers[i]);\n\t\t\tif (this.endpoint.mediaRenderers[i].element)\n\t\t\t{\n\t\t\t\t//BX.remove(this.endpoint.mediaRenderers[i].element);\n\t\t\t}\n\t\t}\n\n\t\tthis.bindEndpointEventHandlers();\n\t}\n\n\tallowIncomingVideo(isIncomingVideoAllowed)\n\t{\n\t\tif (this.isIncomingVideoAllowed == isIncomingVideoAllowed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isIncomingVideoAllowed = !!isIncomingVideoAllowed;\n\t}\n\n\taddMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Adding media renderer for user' + this.userId, mediaRenderer);\n\n\t\tthis.mediaRenderers.push(mediaRenderer);\n\t\tthis.callbacks.onMediaReceived({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tremoveMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Removing media renderer for user' + this.userId, mediaRenderer);\n\n\t\tlet i = this.mediaRenderers.indexOf(mediaRenderer);\n\t\tif (i >= 0)\n\t\t{\n\t\t\tthis.mediaRenderers.splice(i, 1);\n\t\t}\n\t\tthis.callbacks.onMediaRemoved({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tbindEndpointEventHandlers()\n\t{\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.RemoteMediaAdded, this.#onEndpointRemoteMediaAdded);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.RemoteMediaRemoved, this.#onEndpointRemoteMediaRemoved);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.VoiceStart, this.#onEndpointVoiceStart);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.VoiceEnd, this.#onEndpointVoiceEnd);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.Removed, this.#onEndpointRemoved);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.MediaRenderEnabled, this.#onEndpointMediaRenderEnabled);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.MediaRenderDisabled, this.#onEndpointMediaRenderDisabled);\n\t}\n\n\tremoveEndpointEventHandlers()\n\t{\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.RemoteMediaAdded, this.#onEndpointRemoteMediaAdded);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.RemoteMediaRemoved, this.#onEndpointRemoteMediaRemoved);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.VoiceStart, this.#onEndpointVoiceStart);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.VoiceEnd, this.#onEndpointVoiceEnd);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.Removed, this.#onEndpointRemoved);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.MediaRenderEnabled, this.#onEndpointMediaRenderEnabled);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.MediaRenderDisabled, this.#onEndpointMediaRenderDisabled);\n\t}\n\n\tcalculateState()\n\t{\n\t\tif (this.endpoint)\n\t\t{\n\t\t\treturn UserState.Connected;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t}\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState != calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tdirection: this.direction,\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t}\n\n\tisParticipating()\n\t{\n\t\treturn ((this.calling || this.ready || this.endpoint) && !this.declined);\n\t}\n\n\twaitForConnectionRestore()\n\t{\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.connectionRestoreTimeout = setTimeout(\n\t\t\tthis.onConnectionRestoreTimeout.bind(this),\n\t\t\tconnectionRestoreTime\n\t\t);\n\t}\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(() => this.onInviteTimeout(true), 30000);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tif (!this.calling)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonConnectionRestoreTimeout()\n\t{\n\t\tif (this.endpoint || !this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"Done waiting for connection restoration\");\n\t\tthis.setReady(false);\n\t}\n\n\t#onEndpointRemoteMediaAdded = (e) =>\n\t{\n\t\tthis.log(\"VoxImplant.EndpointEvents.RemoteMediaAdded\", e.mediaRenderer);\n\n\t\t// voximplant audio auto-play bug workaround:\n\t\tif (e.mediaRenderer.element)\n\t\t{\n\t\t\te.mediaRenderer.element.volume = 0;\n\t\t\te.mediaRenderer.element.srcObject = null;\n\t\t}\n\t\tthis.addMediaRenderer(e.mediaRenderer);\n\t}\n\n\t#onEndpointRemoteMediaRemoved = (e) =>\n\t{\n\t\tconsole.log(\"VoxImplant.EndpointEvents.RemoteMediaRemoved, \", e.mediaRenderer)\n\t\t//this.log(\"VoxImplant.EndpointEvents.RemoteMediaRemoved, \", e);\n\t\tthis.removeMediaRenderer(e.mediaRenderer);\n\t}\n\n\t#onEndpointVoiceStart = () =>\n\t{\n\t\tthis.callbacks.onVoiceStarted();\n\t}\n\n\t#onEndpointVoiceEnd = () =>\n\t{\n\t\tthis.callbacks.onVoiceEnded();\n\t}\n\n\t#onEndpointRemoved = (e) =>\n\t{\n\t\tthis.log(\"VoxImplant.EndpointEvents.Removed\", e);\n\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\t\tif (this.stream)\n\t\t{\n\t\t\tthis.stream = null;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.waitForConnectionRestore();\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\t#onEndpointMediaRenderEnabled = (e) =>\n\t{\n\t\tthis.callbacks.onMediaRenderEnabled(e);\n\t}\n\n\t#onEndpointMediaRenderDisabled = (e) =>\n\t{\n\t\tthis.callbacks.onMediaRenderDisabled(e);\n\t}\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.stream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.stream);\n\t\t\tthis.stream = null;\n\t\t}\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onInviteTimeout = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaRemoved = BX.DoNothing;\n\n\t\tclearTimeout(this.callingTimeout);\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.callingTimeout = null;\n\t\tthis.connectionRestoreTimeout = null;\n\t}\n}\n\nconst transformVoxStats = function (s, voximplantCall)\n{\n\tlet result = {\n\t\tconnection: s.connection,\n\t\toutboundAudio: [],\n\t\toutboundVideo: [],\n\t\tinboundAudio: [],\n\t\tinboundVideo: [],\n\t}\n\n\tlet endpoints = {};\n\tif (voximplantCall.getEndpoints)\n\t{\n\t\tvoximplantCall.getEndpoints().forEach(endpoint => endpoints[endpoint.id] = endpoint)\n\t}\n\n\tif (!result.connection.timestamp)\n\t{\n\t\tresult.connection.timestamp = Date.now();\n\t}\n\tfor (let trackId in s.outbound)\n\t{\n\t\tif (!s.outbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tconst statGroup = s.outbound[trackId];\n\t\tfor (let i = 0; i < statGroup.length; i++)\n\t\t{\n\t\t\tlet stat = statGroup[i];\n\t\t\tstat.trackId = trackId;\n\t\t\tif ('audioLevel' in stat)\n\t\t\t{\n\t\t\t\tresult.outboundAudio.push(stat)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.outboundVideo.push(stat)\n\t\t\t}\n\t\t}\n\t}\n\tfor (let trackId in s.inbound)\n\t{\n\t\tif (!s.inbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tlet stat = s.inbound[trackId];\n\t\tif (!('endpoint' in stat))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tstat.trackId = trackId;\n\t\tif ('audioLevel' in stat)\n\t\t{\n\t\t\tresult.inboundAudio.push(stat)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (endpoints[stat.endpoint])\n\t\t\t{\n\t\t\t\tlet videoRenderer = endpoints[stat.endpoint].mediaRenderers.find(r => r.id == stat.trackId)\n\t\t\t\tif (videoRenderer && videoRenderer.element)\n\t\t\t\t{\n\t\t\t\t\tstat.actualHeight = videoRenderer.element.videoHeight;\n\t\t\t\t\tstat.actualWidth = videoRenderer.element.videoWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.inboundVideo.push(stat)\n\t\t}\n\t}\n\treturn result;\n\n}\n","import {Type} from 'main.core';\n\nexport class CallStub\n{\n\tconstructor(config)\n\t{\n\t\tthis.callId = config.callId;\n\t\tthis.lifetime = config.lifetime || 120;\n\t\tthis.callbacks = {\n\t\t\tonDelete: Type.isFunction(config.onDelete) ? config.onDelete : BX.DoNothing\n\t\t};\n\n\t\tthis.deleteTimeout = setTimeout( () =>\n\t\t{\n\t\t\tthis.callbacks.onDelete({\n\t\t\t\tcallId: this.callId\n\t\t\t})\n\t\t}, this.lifetime * 1000);\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\t// do nothing\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\treturn false;\n\t};\n\n\taddEventListener()\n\t{\n\t\treturn false;\n\t};\n\n\tremoveEventListener()\n\t{\n\t\treturn false;\n\t};\n\n\taddInvitedUsers()\n\t{\n\t\tconsole.error(\"unexpected call to CallStub.addInvitedUsers\");\n\t}\n\n\tdestroy()\n\t{\n\t\tclearTimeout(this.deleteTimeout);\n\t\tthis.callbacks.onDelete = BX.DoNothing;\n\t};\n}","import {Type} from 'main.core'\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {PlainCall} from './plain_call'\nimport {BitrixCall} from './bitrix_call'\nimport {VoximplantCall} from './voximplant_call'\nimport {CallStub} from './stub'\nimport {Hardware} from '../hardware';\nimport Util from '../util'\nimport {AbstractCall} from './abstract_call';\nimport {CallAI} from '../call_ai';\n\nexport const CallState = {\n\tIdle: 'Idle',\n\tProceeding: 'Proceeding',\n\tConnected: 'Connected',\n\tFinished: 'Finished'\n};\n\nexport const UserState = {\n\tIdle: 'Idle',\n\tBusy: 'Busy',\n\tCalling: 'Calling',\n\tUnavailable: 'Unavailable',\n\tDeclined: 'Declined',\n\tReady: 'Ready',\n\tConnecting: 'Connecting',\n\tConnected: 'Connected',\n\tFailed: 'Failed'\n};\n\nexport const EndpointDirection = {\n\tSendOnly: 'send',\n\tRecvOnly: 'recv',\n\tSendRecv: 'sendrecv',\n};\n\nexport const CallType = {\n\tInstant: 1,\n\tPermanent: 2\n};\n\nexport const Provider = {\n\tPlain: 'Plain',\n\tVoximplant: 'Voximplant',\n\tBitrix: 'Bitrix',\n\tBitrixDev: 'BitrixDev',\n};\n\nexport const StreamTag = {\n\tMain: 'main',\n\tScreen: 'screen'\n};\n\nexport const Direction = {\n\tIncoming: 'Incoming',\n\tOutgoing: 'Outgoing'\n};\n\nexport const Quality = {\n\tVeryHigh: \"very_high\",\n\tHigh: \"high\",\n\tMedium: \"medium\",\n\tLow: \"low\",\n\tVeryLow: \"very_low\"\n};\n\nexport const UserMnemonic = {\n\tall: 'all',\n\tnone: 'none'\n};\n\ntype CreateCallOptions = {\n\ttype: number,\n\tprovider: string,\n\tentityType: string,\n\tentityId: string,\n\tjoinExisting: boolean,\n\tuserIds?: number[],\n\tvideoEnabled?: boolean,\n\tenableMicAutoParameters?: boolean,\n\tdebug?: boolean\n}\n\nexport const CallEvent = {\n\tonUserInvited: 'onUserInvited',\n\tonUserStateChanged: 'onUserStateChanged',\n\tonUserMicrophoneState: 'onUserMicrophoneState',\n\tonUserCameraState: 'onUserCameraState',\n\tonCameraPublishing: 'onCameraPublishing',\n\tonMicrophonePublishing: 'onMicrophonePublishing',\n\tonNeedResetMediaDevicesState: 'onNeedResetMediaDevicesState',\n\tonUserVideoPaused: 'onUserVideoPaused',\n\tonUserScreenState: 'onUserScreenState',\n\tonUserRecordState: 'onUserRecordState',\n\tonUserVoiceStarted: 'onUserVoiceStarted',\n\tonUserVoiceStopped: 'onUserVoiceStopped',\n\tonUserFloorRequest: 'onUserFloorRequest', // request for a permission to speak\n\tonUserEmotion: 'onUserEmotion',\n\tonUserStatsReceived: 'onUserStatsReceived',\n\tonCustomMessage: 'onCustomMessage',\n\tonLocalMediaReceived: 'onLocalMediaReceived',\n\tonLocalMediaStopped: 'onLocalMediaStopped',\n\tonMicrophoneLevel: 'onMicrophoneLevel',\n\tonDeviceListUpdated: 'onDeviceListUpdated',\n\tonRTCStatsReceived: 'onRTCStatsReceived',\n\tonCallFailure: 'onCallFailure',\n\tonRemoteMediaReceived: 'onRemoteMediaReceived',\n\tonRemoteMediaStopped: 'onRemoteMediaStopped',\n\tonBadNetworkIndicator: 'onBadNetworkIndicator',\n\tonConnectionQualityChanged: 'onConnectionQualityChanged',\n\tonNetworkProblem: 'onNetworkProblem',\n\tonReconnecting: 'onReconnecting',\n\tonReconnected: 'onReconnected',\n\tonJoin: 'onJoin',\n\tonLeave: 'onLeave',\n\tonJoinRoomOffer: 'onJoinRoomOffer',\n\tonJoinRoom: 'onJoinRoom',\n\tonLeaveRoom: 'onLeaveRoom',\n\tonListRooms: 'onListRooms',\n\tonUpdateRoom: 'onUpdateRoom',\n\tonTransferRoomSpeakerRequest: 'onTransferRoomSpeakerRequest',\n\tonTransferRoomSpeaker: 'onTransferRoomSpeaker',\n\tonDestroy: 'onDestroy',\n\tonGetUserMediaEnded: 'onGetUserMediaEnded',\n\tonUpdateLastUsedCameraId: 'onUpdateLastUsedCameraId',\n\tonToggleRemoteParticipantVideo: 'onToggleRemoteParticipantVideo',\n\tonSwitchTrackRecordStatus: 'onSwitchTrackRecordStatus',\n};\n\nconst ajaxActions = {\n\tcreateCall: 'im.call.create',\n\tcreateChildCall: 'im.call.createChildCall',\n\tgetPublicChannels: 'pull.channel.public.list',\n\tgetCall: 'im.call.get'\n};\n\nclass Engine\n{\n\thandlers = {\n\t\t'Call::incoming': this.#onPullIncomingCall.bind(this),\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.debugFlag = false;\n\t\tthis.calls = {};\n\t\tthis.userId = Number(BX.message('USER_ID'));\n\t\tthis.siteId = '';\n\n\t\tthis.unknownCalls = {};\n\n\t\tthis.restClient = null;\n\t\tthis.pullClient = null;\n\n\t\tthis.finishedCalls = new Set();\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tBX.addCustomEvent(\"onPullEvent-im\", this.#onPullEvent.bind(this));\n\t\tBX.addCustomEvent(\"onPullClientEvent-im\", this.#onPullClientEvent.bind(this));\n\t};\n\n\tgetSiteId()\n\t{\n\t\treturn this.siteId || BX.message('SITE_ID') || '';\n\t};\n\n\tsetSiteId(siteId)\n\t{\n\t\tthis.siteId = siteId;\n\t};\n\n\tgetCurrentUserId()\n\t{\n\t\treturn this.userId;\n\t};\n\n\tsetCurrentUserId(userId)\n\t{\n\t\tthis.userId = Number(userId);\n\t};\n\n\tsetRestClient(restClient)\n\t{\n\t\tthis.restClient = restClient;\n\t};\n\n\tsetPullClient(pullClient)\n\t{\n\t\tthis.pullClient = pullClient;\n\t};\n\n\tgetRestClient()\n\t{\n\t\treturn this.restClient || BX.rest;\n\t};\n\n\tgetPullClient()\n\t{\n\t\treturn this.pullClient || BX.PULL;\n\t};\n\n\tgetLogService()\n\t{\n\t\treturn BX.message(\"call_log_service\");\n\t};\n\n\tonCallCreated(call)\n\t{\n\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\tcall: call\n\t\t}]);\n\t}\n\n\tcreateCall(config: CreateCallOptions): Promise<AbstractCall>\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tconst callType = config.type || CallType.Instant;\n\t\t\tconst callProvider = config.provider || this.getDefaultProvider();\n\n\t\t\tif (config.joinExisting)\n\t\t\t{\n\t\t\t\tfor (let callId in this.calls)\n\t\t\t\t{\n\t\t\t\t\tif (this.calls.hasOwnProperty(callId))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst call: AbstractCall = this.calls[callId];\n\t\t\t\t\t\tif (call.provider == config.provider && call.associatedEntity.type == config.entityType && call.associatedEntity.id == config.entityId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.log(callId, \"Found existing call, attaching to it\");\n\t\t\t\t\t\t\tthis.onCallCreated(call);\n\n\t\t\t\t\t\t\tHardware.isCameraOn = config.videoEnabled === true;\n\n\t\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\t\tcall: call,\n\t\t\t\t\t\t\t\tisNew: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet callParameters = {\n\t\t\t\ttype: callType,\n\t\t\t\tprovider: callProvider,\n\t\t\t\tentityType: config.entityType,\n\t\t\t\tentityId: config.entityId,\n\t\t\t\tjoinExisting: !!config.joinExisting,\n\t\t\t\tuserIds: Type.isArray(config.userIds) ? config.userIds : []\n\t\t\t};\n\n\t\t\tthis.getRestClient().callMethod(ajaxActions.createCall, callParameters).then((response) =>\n\t\t\t{\n\t\t\t\tif (response.error())\n\t\t\t\t{\n\t\t\t\t\tconst error = response.error().getError();\n\t\t\t\t\treturn reject({\n\t\t\t\t\t\tcode: error.error,\n\t\t\t\t\t\tmessage: error.error_description\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst createCallResponse = response.data();\n\n\t\t\t\tif (createCallResponse.userData)\n\t\t\t\t{\n\t\t\t\t\tUtil.setUserData(createCallResponse.userData)\n\t\t\t\t}\n\t\t\t\tif (createCallResponse.publicChannels)\n\t\t\t\t{\n\t\t\t\t\tthis.getPullClient().setPublicIds(Object.values(createCallResponse.publicChannels))\n\t\t\t\t}\n\t\t\t\tif (createCallResponse.ai)\n\t\t\t\t{\n\t\t\t\t\tCallAI.setup(createCallResponse.ai);\n\t\t\t\t}\n\n\t\t\t\tconst callFields = createCallResponse.call;\n\t\t\t\tif (this.calls[callFields['ID']])\n\t\t\t\t{\n\t\t\t\t\tif (this.calls[callFields['ID']] instanceof CallStub)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callFields['ID']].destroy();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Call \" + callFields['ID'] + \" already exists\");\n\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\tcall: this.calls[callFields['ID']],\n\t\t\t\t\t\t\tisNew: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\t\t\t\tHardware.isCameraOn = config.videoEnabled === true;\n\n\t\t\t\tconst call = callFactory.createCall({\n\t\t\t\t\tid: parseInt(callFields['ID']),\n\t\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\t\tusers: createCallResponse.users,\n\t\t\t\t\tuserData: createCallResponse.userData,\n\t\t\t\t\tenableMicAutoParameters: (config.enableMicAutoParameters !== false),\n\t\t\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\t\t\ttype: callFields.TYPE,\n\t\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\tdebug: config.debug === true,\n\t\t\t\t\tlogToken: createCallResponse.logToken,\n\t\t\t\t\tconnectionData: createCallResponse.connectionData,\n\t\t\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\t\t\t// jwt: callFields['JWT'],\n\t\t\t\t\t// endpoint: callFields['ENDPOINT'],\n\t\t\t\t});\n\n\t\t\t\tthis.calls[callFields['ID']] = call;\n\n\t\t\t\tif (createCallResponse.isNew)\n\t\t\t\t{\n\t\t\t\t\tthis.log(call.id, \"Creating new call\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(call.id, \"Server returned existing call, attaching to it\");\n\t\t\t\t}\n\n\t\t\t\tthis.onCallCreated(call);\n\n\t\t\t\tresolve({\n\t\t\t\t\tcall: call,\n\t\t\t\t\tuserData: createCallResponse.userData,\n\t\t\t\t\tisNew: createCallResponse.isNew\n\t\t\t\t});\n\t\t\t}).catch(function (error)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(error.error))\n\t\t\t\t{\n\t\t\t\t\terror = error.error().getError();\n\t\t\t\t}\n\t\t\t\treject({\n\t\t\t\t\tcode: error.error,\n\t\t\t\t\tmessage: error.error_description\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\n\t};\n\n\tcreateChildCall(parentId, newProvider, newUsers, config)\n\t{\n\t\tif (!this.calls[parentId])\n\t\t{\n\t\t\treturn Promise.reject('Parent call is not found');\n\t\t}\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tconst parentCall = this.calls[parentId];\n\t\t\tconst callParameters = {\n\t\t\t\tparentId: parentId,\n\t\t\t\tnewProvider: newProvider,\n\t\t\t\tnewUsers: newUsers\n\t\t\t};\n\n\t\t\tthis.getRestClient().callMethod(ajaxActions.createChildCall, callParameters, (response) =>\n\t\t\t{\n\t\t\t\tconst createCallResponse = response.data();\n\t\t\t\tconst callFields = createCallResponse.call;\n\t\t\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\n\t\t\t\tconst call = callFactory.createCall({\n\t\t\t\t\tid: parseInt(callFields['ID']),\n\t\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\t\tparentId: callFields['PARENT_ID'],\n\t\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\t\tusers: createCallResponse.users,\n\t\t\t\t\tuserData: createCallResponse.userData,\n\t\t\t\t\tenableMicAutoParameters: parentCall.enableMicAutoParameters !== false,\n\t\t\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\t\t\ttype: callFields.TYPE,\n\t\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\tlogToken: createCallResponse.logToken,\n\t\t\t\t\tconnectionData: createCallResponse.connectionData,\n\t\t\t\t\tdebug: config.debug,\n\t\t\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\t\t\t// jwt: callFields['JWT'],\n\t\t\t\t\t// endpoint: callFields['ENDPOINT']\n\t\t\t\t});\n\n\t\t\t\tthis.calls[callFields['ID']] = call;\n\t\t\t\tthis.onCallCreated(call);\n\n\t\t\t\tresolve({\n\t\t\t\t\tcall: call,\n\t\t\t\t\tisNew: createCallResponse.isNew\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\t#instantiateCall(callFields, users, logToken, connectionData, userData): AbstractCall\n\t{\n\t\tif (this.calls[callFields['ID']])\n\t\t{\n\t\t\tconsole.error(\"Call \" + callFields['ID'] + \" already exists\");\n\t\t\treturn this.calls[callFields['ID']];\n\t\t}\n\n\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\t\tconst call = callFactory.createCall({\n\t\t\tid: parseInt(callFields['ID']),\n\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\tinitiatorId: parseInt(callFields['INITIATOR_ID']),\n\t\t\tparentId: callFields['PARENT_ID'],\n\t\t\tdirection: callFields['INITIATOR_ID'] == this.userId ? Direction.Outgoing : Direction.Incoming,\n\t\t\tusers: users,\n\t\t\tuserData: userData,\n\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\ttype: callFields.TYPE,\n\t\t\tstartDate: callFields['START_DATE'],\n\t\t\tlogToken: logToken,\n\t\t\tconnectionData: connectionData,\n\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\t// jwt: callFields['JWT'],\n\t\t\t// endpoint: callFields['ENDPOINT'],\n\n\t\t\tevents: {\n\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tthis.calls[callFields['ID']] = call;\n\n\t\tthis.onCallCreated(call);\n\n\t\treturn call;\n\t};\n\n\tgetCallWithId(id): Promise<{ call: AbstractCall, isNew: boolean }>\n\t{\n\t\tif (this.calls[id])\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tcall: this.calls[id],\n\t\t\t\tisNew: false\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getRestClient().callMethod(ajaxActions.getCall, {callId: id}).then((answer) =>\n\t\t\t{\n\t\t\t\tconst data = answer.data();\n\t\t\t\tresolve({\n\t\t\t\t\tcall: this.#instantiateCall(data.call, data.users, data.logToken, data.connectionData, data.userData),\n\t\t\t\t\tisNew: false\n\t\t\t\t})\n\t\t\t}).catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tif (Type.isFunction(error.error))\n\t\t\t\t{\n\t\t\t\t\terror = error.error().getError();\n\t\t\t\t}\n\t\t\t\treject({\n\t\t\t\t\tcode: error.error,\n\t\t\t\t\tmessage: error.error_description\n\t\t\t\t})\n\t\t\t})\n\t\t})\n\t};\n\n\t#onPullEvent(command: string, params, extra)\n\t{\n\t\tif (command.startsWith('Call::'))\n\t\t{\n\t\t\tif (params.publicIds)\n\t\t\t{\n\t\t\t\tthis.getPullClient().setPublicIds(Object.values(params.publicIds));\n\t\t\t}\n\t\t\tif (params.userData)\n\t\t\t{\n\t\t\t\tUtil.setUserData(params.userData);\n\t\t\t}\n\t\t}\n\n\t\tif (this.handlers[command])\n\t\t{\n\t\t\tthis.handlers[command].call(this, params, extra);\n\t\t}\n\t\telse if (command.startsWith('Call::') && (params['call'] || params['callId']))\n\t\t{\n\t\t\tconst callId = params['call'] ? params['call']['ID'] : params['callId'];\n\t\t\tif (this.calls[callId])\n\t\t\t{\n\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t}\n\t\t\telse if (command === 'Call::finish')\n\t\t\t{\n\t\t\t\tthis.log(callId, 'Got \"Call::finish\" before \"Call::incoming\"');\n\t\t\t\tthis.finishedCalls.add(callId);\n\t\t\t}\n\t\t\telse if (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.#onUnknownCallPing(params, extra).then((result) =>\n\t\t\t\t{\n\t\t\t\t\tif (result && this.calls[callId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPullClientEvent(command: string, params, extra)\n\t{\n\t\tif (command.startsWith('Call::') && params['callId'])\n\t\t{\n\t\t\tconst callId = params['callId'];\n\t\t\tif (this.calls[callId])\n\t\t\t{\n\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t}\n\t\t\telse if (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.#onUnknownCallPing(params, extra).then((result) =>\n\t\t\t\t{\n\t\t\t\t\tif (result && this.calls[callId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPullIncomingCall(params, extra)\n\t{\n\t\tconsole.log('#onPullIncomingCall', location.href);\n\t\tif (extra.server_time_ago > 30)\n\t\t{\n\t\t\tconsole.error(\"Call was started too long time ago\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst callFields = params.call;\n\t\tconst callId = parseInt(callFields.ID);\n\t\tlet call;\n\n\t\tif (this.finishedCalls.has(callId))\n\t\t{\n\t\t\tthis.log(callId, 'Got \"Call::incoming\" after \"Call::finish\"');\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.publicIds)\n\t\t{\n\t\t\tthis.getPullClient().setPublicIds(Object.values(params.publicIds));\n\t\t}\n\n\t\tif (params.userData)\n\t\t{\n\t\t\tUtil.setUserData(params.userData);\n\t\t}\n\n\t\tcall = this.calls[callId];\n\n\t\tif (!!call)\n\t\t{\n\t\t\tcall.associatedEntity = callFields.ASSOCIATED_ENTITY;\n\t\t\tcall.state = CallState.Idle;\n\t\t}\n\n\t\tif (!call) {\n\t\t\tconst callFactory = this.#getCallFactory(callFields.PROVIDER);\n\n\t\t\tcall = callFactory.createCall({\n\t\t\t\tid: callId,\n\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\tparentId: callFields.PARENT_ID || null,\n\t\t\t\tcallFromMobile: params.isLegacyMobile === true,\n\t\t\t\tdirection: Direction.Incoming,\n\t\t\t\tusers: params.users,\n\t\t\t\tuserData: params.userData,\n\t\t\t\tinitiatorId: params.senderId,\n\t\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\t\ttype: callFields.TYPE,\n\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\tlogToken: params.logToken,\n\t\t\t\tconnectionData: params.connectionData,\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t},\n\t\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\t\t// jwt: callFields['JWT'],\n\t\t\t\t// endpoint: callFields['ENDPOINT']\n\t\t\t});\n\n\t\t\tthis.calls[callId] = call;\n\t\t}\n\n\t\tthis.onCallCreated(call);\n\n\t\tif (call)\n\t\t{\n\t\t\tcall.addInvitedUsers(params.invitedUsers);\n\n\t\t\tBX.onCustomEvent(window, \"CallEvents::incomingCall\", [{\n\t\t\t\tcall: call,\n\t\t\t\tvideo: params.video === true,\n\t\t\t\tisLegacyMobile: params.isLegacyMobile === true\n\t\t\t}]);\n\t\t}\n\t\tthis.log(call.id, \"Incoming call \" + call.id);\n\t};\n\n\t#onUnknownCallPing(params, extra)\n\t{\n\t\tconst callId = Number(params.callId);\n\t\tif (extra.server_time_ago > 10)\n\t\t{\n\t\t\tthis.log(callId, \"Error: Ping was sent too long time ago\");\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\t\tif (!this.#isCallAppInitialized())\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tif (this.unknownCalls[callId])\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tthis.unknownCalls[callId] = true;\n\n\t\tif (params.userData)\n\t\t{\n\t\t\tUtil.setUserData(params.userData);\n\t\t}\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.getCallWithId(callId).then(() =>\n\t\t\t{\n\t\t\t\tthis.unknownCalls[callId] = false;\n\t\t\t\tresolve(true);\n\t\t\t}).catch((error) =>\n\t\t\t{\n\t\t\t\tthis.unknownCalls[callId] = false;\n\t\t\t\tthis.log(callId, \"Error: Could not instantiate call\", error);\n\t\t\t\tresolve(false);\n\t\t\t});\n\t\t});\n\t};\n\n\t#onCallDestroy(e)\n\t{\n\t\tconst callId = e.call.id;\n\t\tthis.calls[callId] = new CallStub({\n\t\t\tcallId: callId,\n\t\t\tonDelete: () =>\n\t\t\t{\n\t\t\t\tif (this.calls[callId])\n\t\t\t\t{\n\t\t\t\t\tdelete this.calls[callId];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tBX.onCustomEvent(window, \"CallEvents::callDestroyed\", [{\n\t\t\tcallId: e.call.id\n\t\t}]);\n\t};\n\n\t#isCallAppInitialized()\n\t{\n\t\tif ('BXIM' in window && 'init' in window.BXIM)\n\t\t{\n\t\t\treturn BXIM.init;\n\t\t}\n\t\telse if (BX.Messenger && BX.Messenger.Application && BX.Messenger.Application.conference)\n\t\t{\n\t\t\treturn BX.Messenger.Application.conference.inited;\n\t\t}\n\n\t\t//TODO: support new chat\n\t\treturn true;\n\t};\n\n\tgetDefaultProvider()\n\t{\n\t\treturn Provider.Plain;\n\t};\n\n\tgetConferencePageTag(chatDialogId)\n\t{\n\t\treturn \"conference-open-\" + chatDialogId;\n\t};\n\n\t#getCallFactory(providerType: string)\n\t{\n\t\tif (providerType == Provider.Plain)\n\t\t{\n\t\t\treturn PlainCallFactory;\n\t\t}\n\t\telse if (providerType == Provider.Bitrix)\n\t\t{\n\t\t\treturn BitrixCallFactory;\n\t\t}\n\t\telse if (providerType == Provider.Voximplant)\n\t\t{\n\t\t\treturn VoximplantCallFactory;\n\t\t}\n\n\t\tthrow new Error(\"Unknown call provider type \" + providerType);\n\t};\n\n\tdebug(debugFlag: boolean = true): boolean\n\t{\n\t\tthis.debugFlag = !!debugFlag;\n\n\t\treturn this.debugFlag;\n\t};\n\n\tlog()\n\t{\n\t\tconst text = Util.getLogMessage.call(Util, arguments);\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.writeToLogFile(BX.message('USER_ID') + '.video.log', text);\n\t\t}\n\t\tif (this.debugFlag)\n\t\t{\n\t\t\tif (console)\n\t\t\t{\n\t\t\t\tconst a = ['Call log [' + Util.getTimeForLog() + ']: '];\n\t\t\t\tconsole.log.apply(this, a.concat(Array.prototype.slice.call(arguments)));\n\t\t\t}\n\t\t}\n\t};\n\n\tgetAllowedVideoQuality(participantsCount)\n\t{\n\t\tif (participantsCount < 5)\n\t\t{\n\t\t\treturn Quality.VeryHigh\n\t\t}\n\t\telse if (participantsCount < 10)\n\t\t{\n\t\t\treturn Quality.High\n\t\t}\n\t\telse if (participantsCount < 16)\n\t\t{\n\t\t\treturn Quality.Medium\n\t\t}\n\t\telse if (participantsCount < 32)\n\t\t{\n\t\t\treturn Quality.Low\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Quality.VeryLow\n\t\t}\n\t};\n}\n\nclass PlainCallFactory\n{\n\tstatic createCall(config): PlainCall\n\t{\n\t\treturn new PlainCall(config);\n\t}\n}\n\nclass BitrixCallFactory\n{\n\tstatic createCall(config): BitrixCall\n\t{\n\t\treturn new BitrixCall(config);\n\t}\n}\n\nclass VoximplantCallFactory\n{\n\tstatic createCall(config): VoximplantCall\n\t{\n\t\treturn new VoximplantCall(config);\n\t}\n}\n\n\nexport const CallEngine = new Engine();\n","import { Type, Extension } from 'main.core'\nimport {CallEngine, Provider} from './engine/engine';\nimport { MediaStreamsKinds } from './call_api';\nimport { View } from './view/view';\nimport { CallAI } from './call_ai';\n\nconst blankAvatar = '/bitrix/js/im/images/blank.gif';\n\nlet userData = {}\nlet usersInProcess = {}\n\nfunction updateUserData(callId, users)\n{\n\tlet usersToUpdate = [];\n\tfor (let i = 0; i < users.length; i++)\n\t{\n\t\tif (userData.hasOwnProperty(users[i]))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tusersToUpdate.push(users[i]);\n\t}\n\n\tlet result = new Promise((resolve, reject) =>\n\t{\n\t\tif (usersToUpdate.length === 0)\n\t\t{\n\t\t\treturn resolve();\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(\"im.call.getUsers\", {\n\t\t\tcallId: callId,\n\t\t\tuserIds: usersToUpdate\n\t\t}).then((response) =>\n\t\t{\n\t\t\tconst result = Type.isPlainObject(response.answer.result) ? response.answer.result : {};\n\t\t\tusers.forEach((userId) =>\n\t\t\t{\n\t\t\t\tif (result[userId])\n\t\t\t\t{\n\t\t\t\t\tuserData[userId] = result[userId];\n\t\t\t\t}\n\t\t\t\tdelete usersInProcess[userId];\n\t\t\t});\n\t\t\tresolve();\n\n\t\t}).catch(function (error)\n\t\t{\n\t\t\treject(error.answer);\n\t\t});\n\t});\n\n\tfor (let i = 0; i < usersToUpdate.length; i++)\n\t{\n\t\tusersInProcess[usersToUpdate[i]] = result;\n\t}\n\treturn result;\n}\n\nfunction setUserData(users)\n{\n\tfor (let userId in users)\n\t{\n\t\tuserData[userId] = users[userId];\n\t}\n}\n\nconst getDateForLog = () =>\n{\n\tconst d = new Date();\n\n\treturn d.getFullYear() + \"-\" + lpad(d.getMonth() + 1, 2, '0') + \"-\" + lpad(d.getDate(), 2, '0') + \" \" + lpad(d.getHours(), 2, '0') + \":\" + lpad(d.getMinutes(), 2, '0') + \":\" + lpad(d.getSeconds(), 2, '0') + \".\" + d.getMilliseconds();\n}\n\nconst getTimeForLog = () =>\n{\n\tconst d = new Date();\n\n\treturn lpad(d.getHours(), 2, '0') + \":\" + lpad(d.getMinutes(), 2, '0') + \":\" + lpad(d.getSeconds(), 2, '0') + \".\" + d.getMilliseconds();\n}\n\nfunction lpad(str, length, chr)\n{\n\tstr = str.toString();\n\tchr = chr || ' ';\n\n\tif (str.length > length)\n\t{\n\t\treturn str;\n\t}\n\n\tlet result = '';\n\tfor (let i = 0; i < length - str.length; i++)\n\t{\n\t\tresult += chr;\n\t}\n\n\treturn result + str;\n}\n\nfunction getUser(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId]);\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId]);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId]);\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserCached(userId)\n{\n\treturn userData.hasOwnProperty(userId) ? userData[userId] : null;\n}\n\nfunction getUsers(callId, users)\n{\n\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tupdateUserData(callId, users).then(() =>\n\t\t{\n\t\t\tlet result = {};\n\t\t\tusers.forEach(userId => result[userId] = userData[userId] || {});\n\t\t\treturn resolve(result);\n\t\t});\n\t});\n}\n\nfunction getUserName(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserAvatar(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserAvatars(callId, users)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tupdateUserData(callId, users).then(() =>\n\t\t{\n\t\t\tlet result = {};\n\t\t\tusers.forEach((userId) =>\n\t\t\t{\n\t\t\t\tresult[userId] = userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : ''\n\t\t\t});\n\t\t\treturn resolve(result);\n\t\t});\n\t});\n}\n\nfunction isAvatarBlank(url)\n{\n\treturn isBlank(url);\n}\n\nfunction getCustomMessage(message, userData)\n{\n\tlet messageText;\n\tif (!Type.isPlainObject(userData))\n\t{\n\t\tuserData = {};\n\t}\n\n\tif (userData.gender && BX.message.hasOwnProperty(message + '_' + userData.gender))\n\t{\n\t\tmessageText = BX.message(message + '_' + userData.gender);\n\t}\n\telse\n\t{\n\t\tmessageText = BX.message(message);\n\t}\n\n\tuserData = convertKeysToUpper(userData);\n\n\treturn messageText.replace(/#.+?#/gm, function (match)\n\t{\n\t\tconst placeHolder = match.substr(1, match.length - 2);\n\t\treturn userData.hasOwnProperty(placeHolder) ? userData[placeHolder] : match;\n\t});\n}\n\nfunction convertKeysToUpper(obj)\n{\n\tvar result = BX.util.objectClone(obj);\n\n\tfor (let k in result)\n\t{\n\t\tconst u = k.toUpperCase();\n\n\t\tif (u != k)\n\t\t{\n\t\t\tresult[u] = result[k];\n\t\t\tdelete result[k];\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction appendChildren(parent, children)\n{\n\tchildren.forEach(child => parent.appendChild(child))\n}\n\nfunction containsVideoTrack(stream: MediaStream)\n{\n\tif (!(stream instanceof MediaStream))\n\t{\n\t\treturn false;\n\t}\n\n\treturn stream.getVideoTracks().length > 0;\n}\n\nfunction hasHdVideo(stream: MediaStream)\n{\n\tif (!(stream instanceof MediaStream) || stream.getVideoTracks().length === 0)\n\t{\n\t\treturn false;\n\t}\n\n\tvar videoTrack = stream.getVideoTracks()[0];\n\tvar trackSettings = videoTrack.getSettings();\n\n\treturn trackSettings.width >= 1280;\n}\n\nfunction findBestElementSize(width, height, userCount, minWidth, minHeight)\n{\n\tminWidth = minWidth || 0;\n\tminHeight = minHeight || 0;\n\tlet bestFilledArea = 0;\n\n\tfor (let i = 1; i <= userCount; i++)\n\t{\n\t\tconst area = getFilledArea(width, height, userCount, i);\n\t\tif (area.area > bestFilledArea && area.elementWidth > minWidth && area.elementHeight > minHeight)\n\t\t{\n\t\t\tbestFilledArea = area.area;\n\t\t\tvar bestWidth = area.elementWidth;\n\t\t\tvar bestHeight = area.elementHeight;\n\t\t}\n\t\tif (area.area < bestFilledArea)\n\t\t{\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (bestFilledArea === 0)\n\t{\n\t\tbestWidth = minWidth;\n\t\tbestHeight = minHeight\n\t}\n\treturn {width: bestWidth, height: bestHeight};\n}\n\nfunction getFilledArea(width, height, userCount, rowCount)\n{\n\tconst columnCount = Math.ceil(userCount / rowCount);\n\tconst maxElementWidth = Math.floor(width / columnCount);\n\tconst maxElementHeight = Math.floor(height / rowCount);\n\n\tconst ratio = maxElementHeight / maxElementWidth;\n\tconst neededRatio = 9 / 16;\n\n\tlet expectedElementHeight;\n\tlet expectedElementWidth;\n\n\tif (ratio < neededRatio)\n\t{\n\t\texpectedElementHeight = maxElementHeight;\n\t\texpectedElementWidth = Math.floor(maxElementWidth * (ratio / neededRatio));\n\t}\n\telse\n\t{\n\t\texpectedElementWidth = maxElementWidth;\n\t\texpectedElementHeight = Math.floor(maxElementHeight * (neededRatio / ratio));\n\t}\n\n\t//console.log(expectedElementWidth + 'x' + expectedElementHeight)\n\tvar area = expectedElementWidth * expectedElementHeight * userCount;\n\n\treturn {area: area, elementWidth: expectedElementWidth, elementHeight: expectedElementHeight};\n}\n\nconst isWebRTCSupported = () =>\n{\n\treturn (typeof webkitRTCPeerConnection != 'undefined' || typeof mozRTCPeerConnection != 'undefined' || typeof RTCPeerConnection != 'undefined');\n}\n\nconst isCallServerAllowed = () =>\n{\n\treturn BX.message('call_server_enabled') === 'Y'\n}\n\nconst isFeedbackAllowed = () =>\n{\n\treturn BX.message('call_allow_feedback') === 'Y'\n}\n\nconst shouldCollectStats = () =>\n{\n\treturn BX.message('call_collect_stats') === 'Y'\n}\n\nconst shouldShowDocumentButton = () =>\n{\n\treturn BX.message('call_docs_status') !== 'N' || BX.message('call_resumes_status') !== 'N';\n}\n\nconst getDocumentsArticleCode = () =>\n{\n\tif (!BX.message('call_docs_status').startsWith('L'))\n\t{\n\t\treturn false;\n\t}\n\n\treturn BX.message('call_docs_status').substr(2);\n}\n\nconst getResumesArticleCode = () =>\n{\n\tif (!BX.message('call_resumes_status').startsWith('L'))\n\t{\n\t\treturn false;\n\t}\n\n\treturn BX.message('call_resumes_status').substr(2);\n}\n\nconst getUserLimit = () =>\n{\n\tif (isCallServerAllowed())\n\t{\n\t\treturn parseInt(BX.message('call_server_max_users'));\n\t}\n\n\treturn parseInt(BX.message('turn_server_max_users'));\n}\n\nconst getClientSelfTestUrl = () =>\n{\n\treturn BX.message('call_client_selftest_url') ?? '';\n}\n\nconst getCallFeatures = () => {\n\treturn BX.message('call_features')\n}\n\nfunction getLogMessage ()\n{\n\tlet text = getDateForLog();\n\n\tfor (let i = 0; i < arguments.length; i++)\n\t{\n\t\tif (arguments[i] instanceof Error)\n\t\t{\n\t\t\ttext = arguments[i].message + \"\\n\" + arguments[i].stack\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\ttext = text + ' | ' + (typeof (arguments[i]) == 'object' ? JSON.stringify(arguments[i]) : arguments[i]);\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\ttext = text + ' | (circular structure)';\n\t\t\t}\n\t\t}\n\t}\n\n\treturn text;\n}\n\nconst getUuidv4 = () =>\n{\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) =>\n\t{\n\t\tconst r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n\t\treturn v.toString(16);\n\t});\n}\n\nfunction reportConnectionResult(callId, connectionResult)\n{\n\tBX.ajax.runAction(\"im.call.reportConnection\", {\n\t\tdata: {\n\t\t\tcallId: callId,\n\t\t\tconnectionResult: connectionResult\n\t\t}\n\t})\n}\n\nfunction sendTelemetryEvent(options)\n{\n\tconst url = (document.location.protocol == \"https:\" ? \"https://\" : \"http://\") + \"bitrix.info/bx_stat\";\n\tconst req = new XMLHttpRequest();\n\treq.open(\"POST\", url, true);\n\treq.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n\treq.withCredentials = true;\n\toptions.op = \"call\";\n\toptions.d = document.location.host;\n\tconst query = BX.util.buildQueryString(options);\n\treq.send(query);\n}\n\nconst isDesktop = () =>\n{\n\treturn typeof (BXDesktopSystem) != \"undefined\" || typeof (BXDesktopWindow) != \"undefined\";\n}\n\nconst getBrowserForStatistics = () =>\n{\n\tif (BX.browser.IsOpera())\n\t{\n\t\treturn 'opera';\n\t}\n\tif (BX.browser.IsChrome())\n\t{\n\t\treturn 'chrome';\n\t}\n\tif (BX.browser.IsFirefox())\n\t{\n\t\treturn 'firefox';\n\t}\n\tif (BX.browser.IsSafari())\n\t{\n\t\treturn 'safari';\n\t}\n\treturn 'other';\n}\n\nfunction isBlank(url)\n{\n\treturn typeof (url) !== \"string\" || url == \"\" || url.endsWith(blankAvatar);\n}\n\nfunction stopMediaStreamAudioTracks(mediaStream)\n{\n    if (!mediaStream instanceof MediaStream)\n    {\n        return;\n    }\n\n    mediaStream.getAudioTracks().forEach(function (track)\n    {\n        if (track.readyState == 'live' && track.kind === 'audio') {\n            track.stop();\n        }\n\n        mediaStream.removeTrack(track);\n    });\n}\n\nfunction stopMediaStreamVideoTracks(mediaStream)\n{\n    if (!mediaStream instanceof MediaStream)\n    {\n        return;\n    }\n\n    mediaStream.getTracks().forEach(function (track)\n    {\n        if (track.readyState == 'live' && track.kind === 'video') {\n            track.stop();\n        }\n\n        mediaStream.removeTrack(track);\n    });\n}\n\nfunction stopMediaStream(mediaStream)\n{\n\tif (!mediaStream instanceof MediaStream)\n\t{\n\t\treturn;\n\t}\n\n\tmediaStream.getTracks().forEach(function (track)\n\t{\n\t\ttrack.stop()\n\t});\n}\n\nfunction getConferenceProvider(): string{\n\tif (isCallServerAllowed())\n\t{\n\t\treturn Provider.Bitrix;\n\t}\n\n\treturn Provider.Plain;\n}\n\nfunction setCodecToReport(report, codecs, reportsWithoutCodecs)\n{\n\tif (codecs[report.codecId])\n\t{\n\t\treport.codecName = codecs[report.codecId];\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nfunction saveReportWithoutCodecs(report, reportsWithoutCodecs)\n{\n\tif (reportsWithoutCodecs[report.codecId])\n\t{\n\t\treportsWithoutCodecs[report.codecId].push(report);\n\t}\n\telse\n\t{\n\t\treportsWithoutCodecs[report.codecId] = [report];\n\t}\n}\n\nfunction processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs)\n{\n\tcodecs[report.id] = report.mimeType;\n\tif (reportsWithoutCodecs[report.id])\n\t{\n\t\treportsWithoutCodecs[report.id].forEach(r =>\n\t\t{\n\t\t\tr.codecName = report.mimeType;\n\t\t});\n\t\tdelete reportsWithoutCodecs[report.id];\n\t}\n}\n\nfunction setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo)\n{\n\tif (remoteReports[report.id])\n\t{\n\t\tconst packetsLostData = calcLocalPacketsLost(report, remoteReports[report.id]);\n\t\treport.packetsLostData = packetsLostData;\n\t\treport.packetsLost = packetsLostData.totalPacketsLost;\n\t\treport.packetsLostExtended = formatPacketsLostData(packetsLostData);\n\t\tdelete remoteReports[report.id];\n\t\treturn true;\n\t}\n\telse if (!report.packetsLostExtended)\n\t{\n\t\treportsWithoutRemoteInfo[report.id] = report;\n\t\treturn false;\n\t}\n}\n\nfunction calcBitrate(currentReport, prevReport, isLocal)\n{\n\tprevReport = prevReport || {};\n\tconst bytes = isLocal\n\t\t? currentReport.bytesSent - (prevReport.bytesSent || 0)\n\t\t: currentReport.bytesReceived - (prevReport.bytesReceived || 0);\n\tconst time = currentReport.timestamp - (prevReport.timestamp || 0);\n\tconst bitrate = 8 * bytes / (time / 1000);\n\treturn bitrate < 0 ? 0 : Math.trunc(bitrate);\n}\n\nfunction calcLocalPacketsLost(currentReport, prevReport, remoteReport)\n{\n\tprevReport = prevReport || {};\n\tconst packetsLost = Math.abs(remoteReport.packetsLost);\n\tconst deltaPacketsSent = currentReport.packetsSent - (prevReport.packetsSent || 0);\n\tconst deltaPacketsLost = packetsLost - (prevReport.packetsLost || 0);\n\tconst percentPacketLost = (deltaPacketsLost / deltaPacketsSent) * 100 || 0;\n\tconst percentPacketLostTotal = (packetsLost / currentReport.packetsSent) * 100 || 0;\n\treturn {\n\t\tcurrentPacketsLost: deltaPacketsLost,\n\t\tcurrentPercentPacketLost: percentPacketLost >= 0 ? Math.trunc(percentPacketLost) : 0,\n\t\ttotalPacketsLost: packetsLost,\n\t\ttotalPercentPacketLost: Math.trunc(percentPacketLostTotal),\n\t};\n}\n\nfunction calcRemotePacketsLost(currentReport, prevReport)\n{\n\tprevReport = prevReport || {};\n\tconst packetsLost = Math.abs(currentReport.packetsLost);\n\tconst deltaPacketsReceived = currentReport.packetsReceived - (prevReport.packetsReceived || 0);\n\tconst deltaPacketsLost = packetsLost - (prevReport.packetsLost || 0);\n\tconst percentPacketLost = (deltaPacketsLost / (deltaPacketsReceived + deltaPacketsLost)) * 100 || 0;\n\tconst percentPacketLostTotal = (packetsLost / (currentReport.packetsReceived + packetsLost)) * 100 || 0;\n\treturn {\n\t\tcurrentPacketsLost: deltaPacketsLost,\n\t\tcurrentPercentPacketLost:  percentPacketLost >= 0 ? Math.trunc(percentPacketLost) : 0,\n\t\ttotalPacketsLost: packetsLost,\n\t\ttotalPercentPacketLost:  Math.trunc(percentPacketLostTotal),\n\t};\n}\n\nfunction formatPacketsLostData(data)\n{\n\treturn `${data.currentPacketsLost} - ${data.currentPercentPacketLost}% (total: ${data.totalPacketsLost} - ${data.totalPercentPacketLost}%)`;\n}\n\nfunction getAvatarBackground()\n{\n\tconst colorList = ['#006484', '#00A2E8', '#559BE6', '#688800', '#7FA800', '#11A9D9', '#0B66C3', '#004F69', '#00789E', '#506900', '#828B95'];\n\n\treturn colorList[Math.floor(Math.random() * colorList.length)];\n}\n\nfunction getRecordTimeText(recordState, returnInSeconds = false)\n{\n\tif (!recordState)\n\t{\n\t\treturn '';\n\t}\n\n\tconst nowDate = new Date();\n\tlet startDate = new Date(recordState.date.start);\n\tif (startDate.getTime() < nowDate.getDate())\n\t{\n\t\tstartDate = nowDate;\n\t}\n\n\tconst pauseTime = recordState.date.pause\n\t\t.map((element) =>\n\t\t{\n\t\t\tconst finish = element.finish ? new Date(element.finish) : nowDate;\n\t\t\treturn finish - new Date(element.start);\n\t\t})\n\t\t.reduce((sum, element) => sum + element, 0);\n\n\tlet totalTime = nowDate - startDate - pauseTime;\n\tif (totalTime <= 0)\n\t{\n\t\ttotalTime = 0;\n\t}\n\n\tlet second = Math.floor(totalTime / 1000);\n\n\tif (returnInSeconds)\n\t{\n\t\treturn second;\n\t}\n\n\tlet hour = Math.floor(second / 60 / 60);\n\tif (hour > 0)\n\t{\n\t\tsecond -= hour * 60 * 60;\n\t}\n\n\tconst minute = Math.floor(second / 60);\n\tif (minute > 0)\n\t{\n\t\tsecond -= minute * 60;\n\t}\n\n\treturn (hour > 0 ? hour + ':' : '')\n\t\t+ (hour > 0 ? minute.toString().padStart(2, \"0\") + ':' : minute + ':')\n\t\t+ second.toString().padStart(2, \"0\")\n\t\t;\n}\n\nfunction getTimeText(startTime)\n{\n\tif (!startTime)\n\t{\n\t\treturn '';\n\t}\n\n\tconst nowDate = new Date();\n\tlet startDate = new Date(startTime);\n\tif (startDate.getTime() < nowDate.getDate())\n\t{\n\t\tstartDate = nowDate;\n\t}\n\n\tlet totalTime = nowDate - startDate;\n\tif (totalTime <= 0)\n\t{\n\t\ttotalTime = 0;\n\t}\n\n\tlet second = Math.floor(totalTime / 1000);\n\n\tlet hour = Math.floor(second / 60 / 60);\n\tif (hour > 0)\n\t{\n\t\tsecond -= hour * 60 * 60;\n\t}\n\n\tconst minute = Math.floor(second / 60);\n\tif (minute > 0)\n\t{\n\t\tsecond -= minute * 60;\n\t}\n\n\treturn (hour > 0 ? hour + ':' : '')\n\t\t+ (hour > 0 ? minute.toString().padStart(2, \"0\") + ':' : minute + ':')\n\t\t+ second.toString().padStart(2, \"0\")\n\t\t;\n}\n\nfunction getTimeInSeconds(startTime)\n{\n\tif (!startTime)\n\t{\n\t\treturn '';\n\t}\n\n\tconst nowDate = new Date();\n\tlet startDate = new Date(startTime);\n\tif (startDate.getTime() < nowDate.getDate())\n\t{\n\t\tstartDate = nowDate;\n\t}\n\n\tlet totalTime = nowDate - startDate;\n\tif (totalTime <= 0)\n\t{\n\t\ttotalTime = 0;\n\t}\n\n\treturn Math.floor(totalTime / 1000);\n}\n\nconst isConferenceChatEnabled = () =>\n{\n\treturn BX.message('conference_chat_enabled');\n}\n\nfunction startSelfTest()\n{\n\tconst link = BX.Call.Util.getClientSelfTestUrl();\n\n\tif (isDesktop()) {\n\t\twindow.open(link, '_blank', 'popup');\n\t\treturn;\n\t}\n\n\twindow.open(link, '_blank');\n}\n\nconst useTcpSdp = () =>\n{\n\treturn BX.message('call_use_tcp_sdp') === 'Y';\n}\n\nfunction openArticle(articleCode)\n{\n\tconst infoHelper = BX.UI.InfoHelper;\n\n\tif (infoHelper.isOpen())\n\t{\n\t\tinfoHelper.close()\n\t}\n\n\tinfoHelper.show(articleCode);\n}\n\nconst isUserControlFeatureEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isUserControlFeatureEnabled;\n}\n\nconst isPictureInPictureFeatureEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isPictureInPictureFeatureEnabled;\n}\n\nconst isNewQOSEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isNewQOSEnabled;\n}\n\nexport default {\n\tupdateUserData,\n\tsetUserData,\n\tgetDateForLog,\n\tgetTimeForLog,\n\tlpad,\n\tgetUser,\n\tgetUserCached,\n\tgetUsers,\n\tgetUserName,\n\tgetUserAvatar,\n\tgetUserAvatars,\n\tisAvatarBlank,\n\tgetCustomMessage,\n\tconvertKeysToUpper,\n\tappendChildren,\n\tcontainsVideoTrack,\n\thasHdVideo,\n\tfindBestElementSize,\n\tgetFilledArea,\n\tisWebRTCSupported,\n\tisCallServerAllowed,\n\tisFeedbackAllowed,\n\tshouldCollectStats,\n\tshouldShowDocumentButton,\n\tgetDocumentsArticleCode,\n\tgetResumesArticleCode,\n\tgetUserLimit,\n\tgetClientSelfTestUrl,\n\tgetLogMessage,\n\tgetUuidv4,\n\treportConnectionResult,\n\tsendTelemetryEvent,\n\tisDesktop,\n\tgetBrowserForStatistics,\n\tisBlank,\n\tstopMediaStream,\n    stopMediaStreamVideoTracks,\n    stopMediaStreamAudioTracks,\n\tgetConferenceProvider,\n\tsetCodecToReport,\n\tsaveReportWithoutCodecs,\n\tprocessReportsWithoutCodecs,\n\tsetLocalPacketsLostOrSaveReport,\n\tcalcBitrate,\n\tcalcLocalPacketsLost,\n\tcalcRemotePacketsLost,\n\tformatPacketsLostData,\n\tgetCallFeatures,\n\tgetAvatarBackground,\n\tgetRecordTimeText,\n\tgetTimeText,\n\tgetTimeInSeconds,\n\tisConferenceChatEnabled,\n\tstartSelfTest,\n\tuseTcpSdp,\n\topenArticle,\n\tisUserControlFeatureEnabled,\n\tisPictureInPictureFeatureEnabled,\n\tisNewQOSEnabled,\n}\n","import {Dom, Text, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\n\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nimport Util from '../util';\nimport { Utils } from 'im.v2.lib.utils';\n\nconst Events = {\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonButtonClick: 'onButtonClick',\n};\n\nconst InternalEvents = {\n\tsetHasCamera: \"CallNotification::setHasCamera\",\n\tcontentReady: \"CallNotification::contentReady\",\n\tonButtonClick: \"CallNotification::onButtonClick\",\n}\n\nexport type IncomingNotificationParams = {\n\tcallerName: string,\n\tcallerAvatar: string,\n\tcallerType: string,\n\tcallerColor: string,\n\tvideo: boolean,\n\thasCamera: boolean,\n\tmicrophoneState: boolean,\n\tcameraState: boolean,\n\tzIndex: number,\n\tonClose: () => void,\n\tonDestroy: () => void,\n\tonButtonClick: () => void,\n\tisMessengerOpen: boolean,\n}\n\nexport class IncomingNotification extends EventEmitter\n{\n\tstatic Events = Events;\n\n\tconstructor(config: IncomingNotificationParams)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.IncomingNotification')\n\n\t\tthis.popup = null;\n\t\tthis.window = null;\n\n\t\tthis.callerAvatar = Type.isStringFilled(config.callerAvatar) ? config.callerAvatar : \"\";\n\t\tif (Util.isAvatarBlank(this.callerAvatar))\n\t\t{\n\t\t\tthis.callerAvatar = \"\";\n\t\t}\n\n\t\tthis.callerName = config.callerName;\n\t\tthis.callerType = config.callerType;\n\t\tthis.callerColor = config.callerColor;\n\t\tthis.video = config.video;\n\t\tthis.hasCamera = config.hasCamera === true;\n\t\tthis.zIndex = config.zIndex;\n\t\tthis.isMessengerOpen = config.isMessengerOpen;\n\t\tthis.contentReady = false;\n\t\tthis.postponedEvents = [];\n\t\tthis.microphoneState = config.microphoneState;\n\t\tthis.cameraState = config.cameraState;\n\n\t\tthis.#subscribeEvents(config);\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.onButtonClickHandler = this.#onButtonClick.bind(this);\n\t\t\tthis.onContentReadyHandler = this.#onContentReady.bind(this);\n\t\t\tDesktopApi.subscribe(InternalEvents.onButtonClick, this.onButtonClickHandler);\n\t\t\tDesktopApi.subscribe(InternalEvents.contentReady, this.onContentReadyHandler);\n\t\t}\n\t};\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (let eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config[eventName])\n\t\t\t}\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tconsole.log('incoming notification : SHOW');\n\t\tif (DesktopApi.isChatWindow())\n\t\t{\n\t\t\tconsole.log('incoming notification : ISDESKTOP');\n\t\t\tconst params = {\n\t\t\t\tvideo: this.video,\n\t\t\t\thasCamera: this.hasCamera,\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerType: this.callerType,\n\t\t\t\tcallerColor: this.callerColor,\n\t\t\t\tmicrophoneState: this.microphoneState,\n\t\t\t\tcameraState: this.cameraState,\n\t\t\t\tisMessengerOpen: this.isMessengerOpen,\n\t\t\t};\n\n\t\t\tif (this.window)\n\t\t\t{\n\t\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"show\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst js = `\n\t\t\t\t\twindow.callNotification = new BX.Call.IncomingNotificationContent(${JSON.stringify(params)});\n\t\t\t\t\twindow.callNotification.showInDesktop();\n\t\t\t\t`;\n\t\t\t\tconst htmlContent = DesktopApi.prepareHtml(\"\", js);\n\t\t\t\tthis.window = DesktopApi.createTopmostWindow(htmlContent);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.log('incoming notification : ISNOTDESKTOP');\n\t\t\tthis.content = new IncomingNotificationContent({\n\t\t\t\tvideo: this.video,\n\t\t\t\thasCamera: this.hasCamera,\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerType: this.callerType,\n\t\t\t\tcallerColor: this.callerColor,\n\t\t\t\tmicrophoneState: this.microphoneState,\n\t\t\t\tcameraState: this.cameraState,\n\t\t\t\tisMessengerOpen: this.isMessengerOpen,\n\t\t\t\tonClose: () => this.emit(Events.onClose),\n\t\t\t\tonDestroy: () => this.emit(Events.onDestroy),\n\t\t\t\tonButtonClick: (e) => this.emit(Events.onButtonClick, Object.assign({}, e.data)),\n\t\t\t});\n\t\t\tthis.createPopup(this.content.render());\n\t\t\tthis.popup.show();\n\n\t\t\twindow.addEventListener('resize', () => {\n\t\t\t\tthis.onResize();\n\t\t\t});\n\t\t}\n\t};\n\n\tonResize()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.setMaxHeight(document.body.clientHeight);\n\t\t}\n\t}\n\n\tcreatePopup(content)\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: \"bx-messenger-call-notify\",\n\t\t\tbindElement: null,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tdisableScroll: true,\n\t\t\tmaxHeight: document.body.clientHeight,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: {restrict: false},\n\t\t\tborderRadius: '25px',\n\t\t\toverlay: {backgroundColor: 'black', opacity: 30},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\twindow.removeEventListener('resize', () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onResize();\n\t\t\t\t\t});\n\t\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => this.popup = null,\n\t\t\t}\n\t\t});\n\t};\n\n\tsetHasCamera(hasCamera)\n\t{\n\t\tif (this.window)\n\t\t{\n\t\t\t// desktop; send event to the window\n\t\t\tif (this.contentReady)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(InternalEvents.setHasCamera, [hasCamera]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.postponedEvents.push({\n\t\t\t\t\tname: InternalEvents.setHasCamera,\n\t\t\t\t\tparams: [hasCamera]\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\telse if (this.content)\n\t\t{\n\t\t\tthis.content.setHasCamera(hasCamera)\n\t\t}\n\t};\n\n\tsendPostponedEvents()\n\t{\n\t\tthis.postponedEvents.forEach((event) =>\n\t\t{\n\t\t\tDesktopApi.emit(event.name, event.params);\n\t\t})\n\t\tthis.postponedEvents = [];\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"hide\");\n\t\t}\n\t\tthis.emit(Events.onClose);\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tthis.window = null;\n\t\t}\n\t\tif (this.content)\n\t\t{\n\t\t\tthis.content.destroy();\n\t\t\tthis.content = null;\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.unsubscribe(InternalEvents.onButtonClick, this.onButtonClickHandler);\n\t\t\tDesktopApi.unsubscribe(InternalEvents.contentReady, this.onContentReadyHandler);\n\t\t}\n\t\tthis.emit(Events.onDestroy);\n\n\t\tthis.unsubscribeAll(Events.onButtonClick);\n\t\tthis.unsubscribeAll(Events.onClick);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t};\n\n\t#onButtonClick(event)\n\t{\n\t\tthis.emit(Events.onButtonClick, event);\n\t}\n\n\t#onContentReady()\n\t{\n\t\tthis.contentReady = true;\n\t\tthis.sendPostponedEvents();\n\t}\n}\n\nexport class IncomingNotificationContent extends EventEmitter\n{\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.IncomingNotificationContent');\n\n\t\tthis.video = !!config.video;\n\t\tthis.hasCamera = !!config.hasCamera;\n\t\tthis.callerAvatar = config.callerAvatar || '';\n\t\tthis.callerName = config.callerName || BX.message('IM_M_CALL_VIDEO_HD');\n\t\tthis.callerType = config.callerType || 'chat';\n\t\tthis.callerColor = config.callerColor || '';\n\t\tthis.microphoneState = config.microphoneState;\n\t\tthis.cameraState = config.cameraState;\n\t\tthis.isMessengerOpen = config.isMessengerOpen;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t\tbuttons: {\n\t\t\t\tanswerVideo: null\n\t\t\t}\n\t\t};\n\n\t\tthis.#subscribeEvents(config)\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.onHasCameraHandler = this.#onHasCamera.bind(this);\n\t\t\tDesktopApi.subscribe(InternalEvents.setHasCamera, this.onHasCameraHandler);\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.contentReady, []);\n\t\t}\n\t};\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (let eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config[eventName])\n\t\t\t}\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tlet callerPrefix;\n\n\t\tif (this.video)\n\t\t{\n\t\t\tif (this.callerType === 'private')\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_VIDEO_CALL_FROM\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_VIDEO_CALL_FROM_CHAT\");\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.callerType === 'private')\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_CALL_FROM\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_CALL_FROM_CHAT\");\n\t\t\t}\n\t\t}\n\n\t\tlet avatarClass = '';\n\t\tlet avatarImageStyles;\n\t\tlet avatarImageText = '';\n\n\t\tif (this.callerAvatar)\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: \"url('\" + this.callerAvatar + \"')\",\n\t\t\t\tbackgroundColor: '#fff',\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst callerType = this.callerType === 'private' ? 'user' : this.callerType;\n\n\t\t\tavatarClass = 'bx-messenger-panel-avatar-' + callerType;\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundColor: this.callerColor || '#525252',\n\t\t\t\tbackgroundSize: '40px',\n\t\t\t\tbackgroundPosition: 'center center',\n\t\t\t}\n\t\t\tavatarImageText = Utils.text.getFirstLetters(this.callerName).toUpperCase();\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-call-window\" + (DesktopApi.isDesktop() ? ' desktop' : '')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-body\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-top\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo bx-messenger-videocall-incoming-call-avatar-pulse\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-photo-left \" + avatarClass\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-photo-block\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: avatarImageStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: avatarImageText,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -2s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -1.5s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -1s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -0.5s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller-prefix\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: callerPrefix\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: Text.decode(this.callerName)\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.windowBottom = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.buttonsBlock = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: []\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.windowBottom.prepend(...[\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-block\"},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-block-title\"},\n\t\t\t\t\t\ttext: BX.message(\"CALL_M_INCOMING_NOTIFICATION_SETTINGS_TITLE\")\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-buttons-block\"},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-button\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tthis.elements.buttons.toggleMicrophoneIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-icon microphone-\" + (this.microphoneState ? \"on\" : \"off\")}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-text microphone\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_MIC\")\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tevents: {click: this.#onMicrophoneSettingClick.bind(this)},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-separator\"},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-button\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tthis.elements.buttons.toggleCameraIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-settings-icon camera-\" + (this.cameraState && this.hasCamera ? \"on\" : \"off\") + (this.hasCamera ? \"\" : \" bx-messenger-call-window-button-disabled\")\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-text camera\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_CAMERA\"),\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tevents: {click: this.#onCameraSettingClick.bind(this)}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t}),\n\t\t]);\n\n\t\tthis.elements.buttonsBlock.append(...[\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-call-window-button bx-messenger-call-window-button-danger\"},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-down\",\n\t\t\t\t\t\t\ttitle: BX.message(\"IM_M_CALL_BTN_DECLINE\"),\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {click: this.#onDeclineButtonClick.bind(this)}\n\t\t\t}),\n\t\t\tthis.elements.buttons.answer = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-call-window-button\" + (this.withBlur ? ' with-blur' : ''),\n\t\t\t\t\ttitle: BX.message(\"IM_M_CALL_BTN_ANSWER\"),\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-up\"}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {click: this.#onAnswerButtonClick.bind(this)}\n\t\t\t}),\n\t\t]);\n\n\t\treturn this.elements.root;\n\t};\n\n\tshowInDesktop()\n\t{\n\t\t// Workaround to prevent incoming call window from hanging.\n\t\t// Without it, there is a possible scenario, when BXDesktopWindow.ExecuteCommand(\"close\") is executed too early\n\t\t// (if invite window is closed before appearing), which leads to hanging of the window\n\t\tif (window.opener.BXIM?.callController && !window.opener.BXIM.callController.callNotification)\n\t\t{\n\t\t\tBXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst width = 450;\n\t\tconst height = 575;\n\n\t\tthis.render();\n\t\tdocument.body.appendChild(this.elements.root);\n\t\tDesktopApi.setWindowPosition({\n\t\t\tx: STP_CENTER,\n\t\t\ty: STP_VCENTER,\n\t\t\twidth,\n\t\t\theight\n\t\t});\n\t};\n\n\tsetHasCamera(hasCamera)\n\t{\n\t\tthis.hasCamera = !!hasCamera;\n\t};\n\n\t#onHasCamera()\n\t{\n\n\t}\n\n\t#onMicrophoneSettingClick()\n\t{\n\t\tthis.microphoneState = !this.microphoneState;\n\n\t\tif (this.microphoneState)\n\t\t{\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.add('microphone-on');\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.remove('microphone-off');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.add('microphone-off');\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.remove('microphone-on');\n\t\t}\n\t};\n\n\t#onCameraSettingClick()\n\t{\n\t\tthis.cameraState = !this.cameraState;\n\n\t\tif (this.cameraState)\n\t\t{\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.add('camera-on');\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.remove('camera-off');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.add('camera-off');\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.remove('camera-on');\n\t\t}\n\t};\n\n\t#onAnswerButtonClick()\n\t{\n\t\tif (!this.hasCamera)\n\t\t{\n\t\t\tthis.cameraState = false;\n\t\t\tthis.microphoneState = true;\n\t\t}\n\n\t\tif (this.isMessengerOpen && typeof BX.SidePanel !== 'undefined' && BX.SidePanel.Instance.isOpen())\n\t\t{\n\t\t\tBX.SidePanel.Instance.close();\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: this.microphoneState,\n\t\t\t\t\tvideo: this.cameraState,\n\t\t\t\t}\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: this.microphoneState,\n\t\t\t\t\tvideo: this.cameraState,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t#onAnswerWithVideoButtonClick()\n\t{\n\t\tif (!this.hasCamera)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: true,\n\t\t\t\t\tvideo: true,\n\t\t\t\t}\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: true,\n\t\t\t\t\tvideo: true,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t#onDeclineButtonClick()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'decline'\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'decline'\n\t\t\t});\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.unsubscribe(InternalEvents.setHasCamera, this.onHasCameraHandler);\n\t\t}\n\t\tthis.unsubscribeAll(Events.onButtonClick);\n\t\tthis.unsubscribeAll(Events.onClick);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t}\n}\n","import {Dom, Text, Type} from 'main.core';\nimport {Popup} from 'main.popup';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport Util from '../util';\nimport { Utils } from 'im.v2.lib.utils';\n\nconst Events = {\n\tonButtonClick: \"ConferenceNotification::onButtonClick\"\n};\n\n/**\n *\n * @param {Object} config\n * @param {string} config.callerName\n * @param {string} config.callerAvatar\n * @param {number} config.zIndex\n * @param {function} config.onClose\n * @param {function} config.onDestroy\n * @param {function} config.onButtonClick\n * @constructor\n */\nexport class ConferenceNotifications\n{\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\t\tthis.window = null;\n\n\t\tthis.callerAvatar = Type.isStringFilled(config.callerAvatar) ? config.callerAvatar : \"\";\n\t\tthis.zIndex = config.zIndex;\n\t\tif (Util.isAvatarBlank(this.callerAvatar))\n\t\t{\n\t\t\tthis.callerAvatar = \"\";\n\t\t}\n\n\t\tthis.callerName = config.callerName;\n\t\tthis.callerColor = config.callerColor;\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t\tonDestroy: Type.isFunction(config.onDestroy) ? config.onDestroy : BX.DoNothing,\n\t\t\tonButtonClick: Type.isFunction(config.onButtonClick) ? config.onButtonClick : BX.DoNothing\n\t\t};\n\n\t\tthis._onContentButtonClickHandler = this._onContentButtonClick.bind(this);\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.subscribe(Events.onButtonClick, this._onContentButtonClickHandler);\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (DesktopApi.isChatWindow())\n\t\t{\n\t\t\tvar params = {\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerColor: this.callerColor\n\t\t\t};\n\n\t\t\tif (this.window)\n\t\t\t{\n\t\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"show\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst js = `\n\t\t\t\t\twindow.conferenceNotification = new BX.Call.NotificationConferenceContent(${JSON.stringify(params)});\n\t\t\t\t\twindow.conferenceNotification.showInDesktop();\n\t\t\t\t`;\n\t\t\t\tconst html = DesktopApi.prepareHtml('', js);\n\t\t\t\tthis.window = DesktopApi.createTopmostWindow(html);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.content = new NotificationConferenceContent({\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerColor: this.callerColor,\n\t\t\t\tonClose: this.callbacks.onClose,\n\t\t\t\tonDestroy: this.callbacks.onDestroy,\n\t\t\t\tonButtonClick: this.callbacks.onButtonClick\n\t\t\t});\n\t\t\tthis.createPopup(this.content.render());\n\t\t\tthis.popup.show();\n\t\t\twindow.addEventListener('resize', () =>\n\t\t\t{\n\t\t\t\tthis.onResize();\n\t\t\t});\n\t\t}\n\t};\n\n\tonResize()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.setMaxHeight(document.body.clientHeight);\n\t\t}\n\t}\n\n\tcreatePopup(content)\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: \"bx-messenger-call-notify\",\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: {restrict: false},\n\t\t\tborderRadius: '25px',\n\t\t\tdisableScroll: true,\n\t\t\tmaxHeight: document.body.clientHeight,\n\t\t\toverlay: {backgroundColor: 'black', opacity: 30},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\twindow.removeEventListener('resize', () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onResize();\n\t\t\t\t\t});\n\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t}.bind(this),\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tthis.popup = null;\n\t\t\t\t}.bind(this)\n\t\t\t}\n\t\t});\n\t};\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"hide\");\n\t\t}\n\t\tthis.callbacks.onClose();\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tthis.window = null;\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.unsubscribe(Events.onButtonClick, this._onContentButtonClickHandler);\n\t\t}\n\t\tthis.callbacks.onDestroy();\n\t}\n\n\t_onContentButtonClick(e)\n\t{\n\t\tthis.callbacks.onButtonClick(e);\n\t}\n}\n\nexport class NotificationConferenceContent\n{\n\tconstructor(config)\n\t{\n\t\tthis.callerAvatar = config.callerAvatar || '';\n\t\tthis.callerName = config.callerName || BX.message('IM_CL_USER');\n\t\tthis.callerColor = config.callerColor || '#525252';\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t\tonDestroy: Type.isFunction(config.onDestroy) ? config.onDestroy : BX.DoNothing,\n\t\t\tonButtonClick: Type.isFunction(config.onButtonClick) ? config.onButtonClick : BX.DoNothing\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tvar avatarImageStyles;\n\t\tlet avatarImageText = '';\n\t\tif (this.callerAvatar)\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: \"url('\" + this.callerAvatar + \"')\",\n\t\t\t\tbackgroundColor: '#fff',\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: 'none',\n\t\t\t\tbackgroundColor: this.callerColor,\n\t\t\t\tbackgroundSize: '80px',\n\t\t\t\tbackgroundRepeat: 'no-repeat',\n\t\t\t\tbackgroundPosition: 'center center',\n\t\t\t}\n\t\t\tavatarImageText = Utils.text.getFirstLetters(this.callerName).toUpperCase();\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-call-window\" + (DesktopApi.isDesktop() ? ' desktop' : '')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-body\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-top\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo bx-messenger-videocall-incoming-call-avatar-pulse\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo-left\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo-block\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: avatarImageStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: avatarImageText,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -2s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -1.5s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -1s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -0.5s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller-prefix\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_VIDEO_CALL_FROM\")\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: Text.encode(this.callerName),\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller\"}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.buttonsBlock = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: []\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.buttonsBlock.append(...[\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-call-window-button bx-messenger-call-window-button-danger\"},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-down\",\n\t\t\t\t\t\t\ttitle: BX.message(\"IM_M_CALL_BTN_SKIP_CONFERENCE\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {click: this._onSkipConferenceButtonClick.bind(this)}\n\t\t\t}),\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-call-window-button\" + (this.withBlur ? ' with-blur' : '')},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-up\",\n\t\t\t\t\t\t\ttitle: BX.message(\"IM_M_CALL_BTN_ANSWER_CONFERENCE\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {click: this._onAnswerConferenceButtonClick.bind(this)}\n\t\t\t}),\n\t\t]);\n\n\t\treturn this.elements.root;\n\t};\n\n\tshowInDesktop()\n\t{\n\t\tconst width = 450;\n\t\tconst height = 575;\n\t\tthis.render();\n\t\tdocument.body.appendChild(this.elements.root);\n\t\tDesktopApi.setWindowPosition({\n\t\t\tx: STP_CENTER,\n\t\t\ty: STP_VCENTER,\n\t\t\twidth,\n\t\t\theight\n\t\t});\n\t};\n\n\t_onAnswerConferenceButtonClick(e)\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(Events.onButtonClick, [{\n\t\t\t\tbutton: 'answerConference',\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tbutton: 'answerConference',\n\t\t\t});\n\t\t}\n\t};\n\n\t_onSkipConferenceButtonClick(e)\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(Events.onButtonClick, [{\n\t\t\t\tbutton: 'skipConference',\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tbutton: 'skipConference'\n\t\t\t});\n\t\t}\n\t};\n\n}\n","import {Dom, Type} from 'main.core';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nimport './css/floating-screenshare.css';\n\nconst Events = {\n\tonBackToCallClick: \"FloatingScreenshare::onBackToCallClick\",\n\tonStopSharingClick: \"FloatingScreenshare::onStopSharingClick\",\n\tonChangeScreenClick: \"FloatingScreenshare::onChangeScreenClick\"\n};\n\nconst POPUP_WIDTH = 291;\nconst POPUP_HEIGHT = 81;\nconst POPUP_OFFSET_X = 80;\nconst POPUP_OFFSET_Y = 80;\n\n/**\n *\n * @param {object} config\n * @constructor\n */\nexport class FloatingScreenShare\n{\n\tconstructor(config)\n\t{\n\t\tif (typeof (config) !== \"object\")\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\t\tthis.darkMode = config.darkMode || false;\n\n\t\tthis.window = null;\n\t\tthis.sharedWindowX = null;\n\t\tthis.sharedWindowY = null;\n\t\tthis.sharedWindowHeight = null;\n\t\tthis.sharedWindowWidth = null;\n\t\tthis.title = '';\n\t\tthis.app = '';\n\n\t\tthis.screens = [];\n\t\tthis.screenToUse = null;\n\n\t\tthis.callbacks = {\n\t\t\tonBackToCallClick: Type.isFunction(config.onBackToCallClick) ? config.onBackToCallClick : BX.DoNothing,\n\t\t\tonStopSharingClick: Type.isFunction(config.onStopSharingClick) ? config.onStopSharingClick : BX.DoNothing,\n\t\t\tonChangeScreenClick: Type.isFunction(config.onChangeScreenClick) ? config.onChangeScreenClick : BX.DoNothing,\n\t\t};\n\n\t\tthis._onBackToCallClickHandler = this._onBackToCallClick.bind(this);\n\t\tthis._onStopSharingClickHandler = this._onStopSharingClick.bind(this);\n\t\tthis._onChangeScreenClickHandler = this._onChangeScreenClick.bind(this);\n\t\tthis.bindEventHandlers();\n\t};\n\n\tbindEventHandlers()\n\t{\n\t\tDesktopApi.subscribe(Events.onBackToCallClick, this._onBackToCallClickHandler);\n\t\tDesktopApi.subscribe(Events.onStopSharingClick, this._onStopSharingClickHandler);\n\t\tDesktopApi.subscribe(Events.onChangeScreenClick, this._onChangeScreenClickHandler);\n\t}\n\n\tsaveExistingScreens()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (this.screens.length > 0)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tBXDesktopSystem.ListScreenMedia((result) =>\n\t\t\t{\n\t\t\t\tresult.forEach((item) =>\n\t\t\t\t{\n\t\t\t\t\tif (item.id.slice(0, 6) === 'screen')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.screens.push({\n\t\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\t\tx: item.x,\n\t\t\t\t\t\t\ty: item.y,\n\t\t\t\t\t\t\twidth: item.width,\n\t\t\t\t\t\t\theight: item.height\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn resolve();\n\t\t\t});\n\t\t});\n\t}\n\n\t_onBackToCallClick()\n\t{\n\t\tthis.callbacks.onBackToCallClick();\n\t}\n\n\t_onStopSharingClick()\n\t{\n\t\tthis.close();\n\t\tthis.callbacks.onStopSharingClick();\n\t}\n\n\t_onChangeScreenClick()\n\t{\n\t\tthis.callbacks.onChangeScreenClick();\n\t}\n\n\tsetSharingData(data)\n\t{\n\t\treturn this.saveExistingScreens().then(() =>\n\t\t{\n\t\t\tthis.sharedWindowX = data.x + 10;\n\t\t\tthis.sharedWindowY = data.y + 10;\n\t\t\tthis.sharedWindowWidth = data.width;\n\t\t\tthis.sharedWindowHeight = data.height;\n\t\t\tthis.title = data.title;\n\t\t\tthis.app = data.app;\n\n\t\t\tfor (let i = 0; i < this.screens.length; i++)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tthis.sharedWindowX >= this.screens[i].x &&\n\t\t\t\t\tthis.sharedWindowX <= (this.screens[i].x + this.screens[i].width) &&\n\t\t\t\t\tthis.sharedWindowY >= this.screens[i].y &&\n\t\t\t\t\tthis.sharedWindowY <= (this.screens[i].y + this.screens[i].height)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.screenToUse = this.screens[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.screenToUse && this.screens.length > 0)\n\t\t\t{\n\t\t\t\tthis.screenToUse = this.screens[0];\n\t\t\t}\n\t\t}).catch((error) =>\n\t\t{\n\t\t\tconsole.log('save existing screens error', error);\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tif (!DesktopApi.isDesktop() || DesktopApi.getApiVersion() > 74)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"show\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar params = {\n\t\t\t\ttitle: this.title,\n\t\t\t\tapp: this.app,\n\t\t\t\tsharedWindowX: this.sharedWindowX,\n\t\t\t\tsharedWindowY: this.sharedWindowY,\n\t\t\t\tsharedWindowWidth: this.sharedWindowWidth,\n\t\t\t\tsharedWindowHeight: this.sharedWindowHeight,\n\t\t\t\tscreenToUse: this.screenToUse,\n\t\t\t\tdarkMode: this.darkMode\n\t\t\t};\n\n\t\t\tconst js = `window.FSSC = new BX.Call.FloatingScreenShareContent(${JSON.stringify(params)});`;\n\t\t\tconst htmlContent = DesktopApi.prepareHtml('', js);\n\t\t\tthis.window = DesktopApi.createTopmostWindow(htmlContent);\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif (!this.window || !this.window.document)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"hide\");\n\t}\n\n\tclose()\n\t{\n\t\tif (!this.window || !this.window.document)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\tthis.window = null;\n\t\tthis.visible = false;\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.window)\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tthis.window = null;\n\t\t}\n\n\t\tDesktopApi.unsubscribe(Events.onBackToCallClick, this._onBackToCallClickHandler);\n\t\tDesktopApi.unsubscribe(Events.onStopSharingClick, this._onStopSharingClickHandler);\n\t\tDesktopApi.unsubscribe(Events.onChangeScreenClick, this._onChangeScreenClickHandler);\n\t}\n}\n\nexport class FloatingScreenShareContent\n{\n\tconstructor(config)\n\t{\n\t\tthis.title = config.title || '';\n\t\tthis.app = config.app || '';\n\t\tthis.sharedWindowX = config.sharedWindowX || 0;\n\t\tthis.sharedWindowY = config.sharedWindowY || 0;\n\t\tthis.sharedWindowHeight = config.sharedWindowHeight || 0;\n\t\tthis.sharedWindowWidth = config.sharedWindowWidth || 0;\n\t\tthis.screenToUse = config.screenToUse || null;\n\t\tthis.darkMode = config.darkMode || false;\n\n\t\tthis.elements = {\n\t\t\tcontainer: null\n\t\t};\n\n\t\tthis.render();\n\t\tthis.adjustWindow(POPUP_WIDTH, POPUP_HEIGHT);\n\t};\n\n\trender()\n\t{\n\t\tconst title = this.app ? this.app + ' - ' + this.title : this.title;\n\n\t\tthis.elements.container = Dom.create(\"div\", {\n\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-wrap' + (this.darkMode ? ' dark-mode' : '')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top-icon'}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top-text', title: title},\n\t\t\t\t\t\t\ttext: title\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-left'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-back-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-back-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_BACK_TO_CALL')\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onBackToCallClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-center'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-change-screen-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-change-screen-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_CHANGE_SCREEN')\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onChangeScreenClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-right'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-stop-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-stop-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_STOP')\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onStopSharingClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tdocument.body.appendChild(this.elements.container);\n\t\tdocument.body.classList.add('bx-messenger-call-floating-screenshare');\n\t}\n\n\tonBackToCallClick()\n\t{\n\t\tthis.dispatchEvent(Events.onBackToCallClick, []);\n\t}\n\n\tonChangeScreenClick()\n\t{\n\t\tthis.dispatchEvent(Events.onChangeScreenClick, []);\n\t}\n\n\tonStopSharingClick()\n\t{\n\t\tthis.dispatchEvent(Events.onStopSharingClick, []);\n\t}\n\n\tadjustWindow(width, height)\n\t{\n\t\tif (!this.screenToUse)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst blockOffset = 22;\n\t\tconst popupPadding = 22;\n\t\tconst leftBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-left').scrollWidth;\n\t\tconst centerBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-center').scrollWidth;\n\t\tconst rightBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-right').scrollWidth;\n\t\tconst fullWidth = leftBlockWidth + centerBlockWidth + rightBlockWidth + (2 * blockOffset) + (2 * popupPadding);\n\t\tif (fullWidth > POPUP_WIDTH)\n\t\t{\n\t\t\twidth = fullWidth;\n\t\t}\n\n\t\tthis.elements.container.style.width = width + \"px\";\n\t\tthis.elements.container.style.height = height + \"px\";\n\n\t\tBXDesktopWindow.SetProperty(\"minClientSize\", {Width: width, Height: height});\n\t\tBXDesktopWindow.SetProperty(\"resizable\", false);\n\t\tBXDesktopWindow.SetProperty(\"closable\", false);\n\t\tBXDesktopWindow.SetProperty(\"title\", BX.message('IM_M_CALL_SCREENSHARE_TITLE'));\n\n\t\tBXDesktopWindow.SetProperty(\"position\", {\n\t\t\tX: this.screenToUse.x + this.screenToUse.width - width - POPUP_OFFSET_X,\n\t\t\tY: this.screenToUse.y + POPUP_OFFSET_Y,\n\t\t\tWidth: width,\n\t\t\tHeight: height,\n\t\t\tMode: STP_FRONT\n\t\t});\n\t}\n\n\tdispatchEvent(name, params)\n\t{\n\t\tlet convertedParams = {};\n\t\tfor (let i = 0; i < params.length; i++)\n\t\t{\n\t\t\tconvertedParams[i] = params[i];\n\t\t}\n\n\t\tconst mainWindow = opener ? opener : top;\n\t\tmainWindow.BXWindows.forEach( (windowItem) =>\n\t\t{\n\t\t\tif (\n\t\t\t\twindowItem &&\n\t\t\t\twindowItem.name !== '' &&\n\t\t\t\twindowItem.BXDesktopWindow &&\n\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent\n\t\t\t)\n\t\t\t{\n\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent(name, convertedParams);\n\t\t\t}\n\t\t});\n\t\tmainWindow.BXDesktopWindow.DispatchCustomEvent(name, convertedParams);\n\t}\n}","import {Dom, Text} from 'main.core'\nimport {Popup} from 'main.popup'\nimport Util from './util'\n\nexport class CallHint\n{\n\tconstructor(options)\n\t{\n\t\tthis.popup = null;\n\n\t\tthis.title = BX.prop.getString(options, \"title\", Text.encode(BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING\")));\n\t\tthis.icon = BX.prop.getString(options, \"icon\", \"mic\");\n\n\t\tthis.bindElement = BX.prop.getElementNode(options, \"bindElement\", null);\n\t\tthis.targetContainer = BX.prop.getElementNode(options, \"targetContainer\", null);\n\t\tthis.callFolded = BX.prop.getBoolean(options, \"callFolded\", false);\n\t\tthis.autoCloseDelay = BX.prop.getInteger(options, \"autoCloseDelay\", 5000);\n\n\t\tthis.buttonsLayout = BX.prop.getString(options, \"buttonsLayout\", \"right\");\n\t\tthis.buttons = BX.prop.getArray(options, \"buttons\", []);\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(options, \"onClose\", BX.DoNothing),\n\t\t}\n\t\tthis.autoCloseTimeout = 0;\n\t};\n\n\tshow()\n\t{\n\t\tclearTimeout(this.autoCloseTimeout);\n\t\tif (this.autoCloseDelay > 0)\n\t\t{\n\t\t\tthis.autoCloseTimeout = setTimeout(() => this.onAutoClose(), this.autoCloseDelay);\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.popup = new Popup({\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: this.targetContainer,\n\t\t\tcontent: this.render(),\n\t\t\tpadding: 0,\n\t\t\tcontentPadding: 14,\n\t\t\t// height: this.getPopupHeight(),\n\t\t\tclassName: 'bx-call-view-popup-call-hint',\n\t\t\tcontentBackground: 'unset',\n\t\t\tmaxWidth: 600,\n\n\t\t\tangle: false,\n\t\t\tevents: {\n\t\t\t\tonClose: () => this.popup.destroy(),\n\t\t\t\tonDestroy: () => this.popup = null,\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-body layout-\" + this.buttonsLayout},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-icon \" + this.icon},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-middle-block\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-text\"},\n\t\t\t\t\t\t\thtml: this.getPopupMessage()\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t(this.buttonsLayout == \"bottom\" ? this.renderButtons() : null),\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t\t(this.buttonsLayout == \"right\" ? this.renderButtons() : null),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-close\"},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick:  () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\t\tif (this.popup)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t]\n\t\t})\n\t}\n\n\trenderButtons()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-buttons-container\"},\n\t\t\tchildren: this.buttons.map(button => button.render())\n\t\t})\n\t}\n\n\tgetPopupMessage()\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn this.title;\n\t\t}\n\t\tlet hotKeyMessage = BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING_HOTKEY\");\n\t\tif (this.callFolded)\n\t\t{\n\t\t\tconst hotkey = (BX.browser.IsMac() ? 'Shift + &#8984; + A' : 'Ctrl + Shift + A');\n\t\t\thotKeyMessage = BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING_FOLDED_CALL_HOTKEY\").replace('#HOTKEY#', hotkey);\n\t\t}\n\t\thotKeyMessage = '<span class=\"bx-call-view-popup-call-hint-text-hotkey\">' + hotKeyMessage + '</span>';\n\n\t\treturn this.title + '<br>' + hotKeyMessage;\n\t}\n\n\t/**\n\t * Returns height in pixels for the popup.\n\t * The height depends on the hotkey hint (hint appears only in the desktop app).\n\t *\n\t * @returns {number}\n\t */\n\tgetPopupHeight()\n\t{\n\t\treturn Util.isDesktop() ? 60 : 54;\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t\tthis.callbacks.onClose();\n\t\t}\n\t}\n\n\tonAutoClose()\n\t{\n\t\tthis.close();\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\n\t\tclearTimeout(this.autoCloseTimeout)\n\t}\n}","import {Dom, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\nimport {BackgroundDialog} from './background_dialog';\nimport {View} from '../view/view';\nimport '../css/promo-popup.css';\n\nconst Events = {\n\tonActionClick: 'onActionClick',\n\tonClose: 'onClose'\n};\n\nexport class PromoPopup\n{\n\tconstructor(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\t\tthis.promoCode = Type.isStringFilled(options.promoCode) ? options.promoCode : '';\n\t\tthis.bindElement = options.bindElement;\n\n\t\tthis.elements = {\n\t\t\troot: null\n\t\t};\n\t\tthis.popup = null;\n\t\tthis.dontShowAgain = false;\n\t\tthis.eventEmitter = new EventEmitter(this, \"BX.Call.PromoPopup\");\n\n\t\tif (options.events)\n\t\t{\n\t\t\tthis.subscribeToEvents(options.events);\n\t\t}\n\t};\n\n\tsubscribeToEvents(events)\n\t{\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tif (events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t\t}\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-promo-container\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-promo-content\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-icon-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-icon\"}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-text-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-title\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_TITLE\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-text\"},\n\t\t\t\t\t\t\t\t\thtml: BX.message(\"IM_CALL_DOCUMENT_PROMO_TEXT\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-refuse\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\t\t\tattrs: {type: \"checkbox\"},\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-promo-refuse-checkbox\",\n\t\t\t\t\t\t\t\t\t\t\t\tid: \"bx-call-promo-refuse-checkbox\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tchange: this.onCheckboxChange.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\t\t\tattrs: {for: \"bx-call-promo-refuse-checkbox\"},\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-refuse-text\"},\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_DONT_SHOW_AGAIN\")\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button bx-call-promo-button-action ui-btn ui-btn-round\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_ACTION\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.onActionClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button bx-call-promo-button-action-close ui-btn ui-btn-round\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_ACTION_CLOSE\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.close.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t}\n\n\t\tthis.createPopup();\n\t\tthis.popup.show();\n\t};\n\n\tclose()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.popup.close();\n\t};\n\n\tcreatePopup()\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-popup',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.elements.root,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tangle: {position: \"bottom\", offset: 49},\n\t\t\tclassName: 'bx-call-promo-popup',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t}\n\t\t});\n\t};\n\n\tonPopupClose()\n\t{\n\t\tthis.popup.destroy();\n\t\tthis.destroy();\n\t};\n\n\tonCheckboxChange(event)\n\t{\n\t\tthis.dontShowAgain = event.currentTarget.checked;\n\t};\n\n\tonActionClick()\n\t{\n\t\tthis.eventEmitter.emit(Events.onActionClick);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.eventEmitter.emit(Events.onClose, {dontShowAgain: this.dontShowAgain});\n\n\t\tthis.eventEmitter.unsubscribeAll(Events.onClose);\n\t\tthis.eventEmitter = null;\n\t\tthis.elements = null;\n\t};\n}\n\nPromoPopup.Events = Events;\n\nexport class PromoPopup3D\n{\n\tcallView: View\n\n\tconstructor(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\n\t\tthis.callView = options.callView;\n\t\tthis.bindElement = options.bindElement;\n\n\t\tthis.popup = null;\n\n\t\toptions.events = Type.isPlainObject(options.events) ? options.events : {};\n\t\tthis.events = {\n\t\t\tonActionClick: options.events.onActionClick ? options.events.onActionClick : () => {},\n\t\t\tonClose: options.events.onClose ? options.events.onClose : () => {},\n\t\t};\n\t};\n\n\tshow()\n\t{\n\t\tthis.createPopup();\n\t\tthis.popup.show();\n\n\t\tBX.bind(BX('promo-popup-3d-button'), \"click\", this.openWindow.bind(this));\n\t};\n\n\topenWindow()\n\t{\n\t\tBackgroundDialog.open({tab: 'mask'});\n\t\tsetTimeout(() => this.close(), 100);\n\t}\n\n\topenLearningPopup()\n\t{\n\t\tconst bindElement = BX('bx-messenger-videocall-panel-item-with-arrow-camera');\n\t\tif (!bindElement)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst title = BX.message('IM_PROMO_3DAVATAR_30112022_LEARNING_TITLE');\n\t\tconst description = BX.message('IM_PROMO_3DAVATAR_30112022_LEARNING_TEXT');\n\n\t\tconst content = `\n\t\t\t<div class=\"promo-popup-3d-learning-content\">\n\t\t\t\t<h4 class=\"ui-typography-heading-h4 promo-popup-3d-learning-content__title\">${title}</h4>\n\t\t\t\t<p class=\"promo-popup-3d-learning-content__description\">${description}</p>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-learning-popup',\n\t\t\tbindElement: bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\", forceTop: -100, forceLeft: 100, forceBindPosition: true\n\t\t\t},\n\t\t\tangle: {position: \"top\", offset: 49},\n\t\t\tclassName: 'bx-call-promo-popup-learn',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.events.onClose();\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\n\t\tthis.callView.subscribe(\n\t\t\tView.Event.onDeviceSelectorShow,\n\t\t\t() => this.popup ? this.popup.close() : ''\n\t\t);\n\t}\n\n\tclose()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.popup.close();\n\t};\n\n\tcreatePopup()\n\t{\n\t\tconst title = BX.message('IM_PROMO_3DAVATAR_30112022_TITLE');\n\t\tconst description = BX.message('IM_PROMO_3DAVATAR_30112022_TEXT');\n\t\tconst btnText = BX.message('IM_PROMO_3DAVATAR_30112022_BUTTON');\n\n\t\tconst content = `\n\t\t\t<div class=\"promo-popup-3d-content\">\n\t\t\t\t<div class=\"promo-popup-3d-content__masks-container\">\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --left-2 --bear\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --left-1 --pole-bear\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --center --fox\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --right-1 --santa\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --right-2 --owl\"></div>\n\t\t\t\t</div>\n\t\t\t\t<h3 class=\"ui-typography-heading-h2 promo-popup-3d-content__title\">${title}</h3>\n\t\t\t\t<p class=\"promo-popup-3d-content__description\">${description}</p>\n\t\t\t\t<div class=\"promo-popup-3d-content__actions-btn\">\n\t\t\t\t\t<span class=\"ui-btn btn-primary ui-btn-lg ui-btn-round ui-btn-primary\" id=\"promo-popup-3d-button\">${btnText}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-popup-3d',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: '#000',\n\t\t\t\topacity: 40,\n\t\t\t},\n\t\t\twidth: 531,\n\t\t\tminHeight: 481,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tclassName: 'bx-call-promo-popup-3d-masks',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t}\n\t\t});\n\t};\n\n\tonPopupClose()\n\t{\n\t\tthis.popup.destroy();\n\t\tthis.openLearningPopup();\n\t};\n}\n\nPromoPopup3D.Events = Events;\n\n","import {Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport './css/sidebar.css';\n\nconst Events = {\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonCloseClicked: 'onCloseClicked',\n}\n\nexport class Sidebar extends EventEmitter\n{\n\tconstructor(options)\n\t{\n\t\tsuper()\n\t\tthis.setEventNamespace(\"BX.Call.SideBar\");\n\t\tthis.container = options.container;\n\n\t\tthis.width = BX.prop.getInteger(options, 'width', 200);\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tclose: null,\n\t\t\tcontentContainer: null,\n\t\t}\n\n\t\tif (options.events)\n\t\t{\n\t\t\tfor (let eventName in options.events)\n\t\t\t{\n\t\t\t\tif (options.events.hasOwnProperty(eventName))\n\t\t\t\t{\n\t\t\t\t\tthis.subscribe(eventName, options.events[eventName]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-call-sidebar-root\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-labels\"},\n\t\t\t\t\tstyle: {top: '39px' /*'17px'*/},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label\"},\n\t\t\t\t\t\t\tstyle: {maxWidth: '40px'},\n\t\t\t\t\t\t\tchildren: [Dom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label-icon-box\"},\n\t\t\t\t\t\t\t\tattrs: {title: BX.message(\"IM_M_CALL_BTN_CLOSE\")},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label-icon bx-messenger-call-sidebar-label-icon-close\"},\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () => this.emit(Events.onCloseClicked)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.contentContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-content-container\"}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\tthis.elements.root.style.setProperty('--sidebar-width', this.width + 'px');\n\n\t\treturn this.elements.root;\n\t}\n\n\tsetWidth(width)\n\t{\n\t\tif (this.width == width)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.width = width;\n\t\tthis.elements.root.style.setProperty('--sidebar-width', this.width + 'px');\n\t}\n\n\topen(animation)\n\t{\n\t\tanimation = animation !== false;\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.container.appendChild(this.render());\n\t\t\tif (animation)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add('opening');\n\t\t\t\tthis.elements.root.addEventListener(\n\t\t\t\t\t'animationend',\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.root.classList.remove('opening');\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonce: true\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t}\n\n\tclose(animation)\n\t{\n\t\tanimation = animation !== false;\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (animation)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add('closing');\n\t\t\t\tthis.elements.root.addEventListener(\n\t\t\t\t\t'animationend',\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.container.removeChild(this.elements.root);\n\t\t\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonce: true\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.container.removeChild(this.elements.root);\n\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggleHidden(hidden)\n\t{\n\t\tthis.elements.root.classList.toggle('hidden', hidden);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.emit(Events.onDestroy);\n\t\tthis.unsubscribeAll(Events.onClose);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t\tthis.eventEmitter = null;\n\t\tthis.elements = null;\n\t\tthis.container = null;\n\t}\n}","import '../css/record-with-copilot-popup.css';\n\nimport { Dom } from 'main.core';\n\ntype RecordWithCopilotPopupOptions = {\n\tonClickYesButton?: 'function',\n\tonClickNoButton?: 'function',\n\tonClose?: 'function'\n};\n\nexport class RecordWithCopilotPopup {\n\tconstructor(config: RecordWithCopilotPopupOptions)\n\t{\n\t\tthis.popup = null;\n\n\t\tthis.callbacks = {\n\t\t\tonClickYesButton: BX.type.isFunction(config.onClickYesButton) ? config.onClickYesButton : BX.DoNothing,\n\t\t\tonClickNoButton: BX.type.isFunction(config.onClickNoButton) ? config.onClickNoButton : BX.DoNothing,\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t}\n\t}\n\n\tcreate()\n\t{\n\t\tthis.popup = BX.UI.Dialogs.MessageBox.create({\n\t\t\tmodal: true,\n\t\t\tpopupOptions: {\n\t\t\t\tcontent: Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-popup-content'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-title'},\n\t\t\t\t\t\t\ttext: BX.message('CALL_RECORD_AUDIO_WITH_COPILOT_TITLE'),\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-message'},\n\t\t\t\t\t\t\ttext: BX.message('CALL_RECORD_AUDIO_WITH_COPILOT_MESSAGE'),\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-actions'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-button bx-messenger-videocall-record-alert-button-yes'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_RECORD_AUDIO_WITH_COPILOT_YES_BUTTON'),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\t\t\t\tthis.callbacks.onClickYesButton();\n\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-button bx-messenger-videocall-record-alert-button-no'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_RECORD_AUDIO_WITH_COPILOT_NO_BUTTON'),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\t\t\t\tthis.callbacks.onClickNoButton();\n\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tclassName : \"bx-messenger-videocall-record-alert-popup\",\n\t\t\t\tdarkMode: true,\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tcontentNoPaddings: true,\n\t\t\t\twidth: 420,\n\t\t\t\tanimation: \"fading\",\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: ()=>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\tthis.popup = null;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.close();\n\t\tthis.create();\n\n\t\tthis.popup.show();\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n}\n","import {Dom, Type} from 'main.core'\nimport {Popup} from 'main.popup'\n\nexport class WebScreenSharePopup\n{\n\tconstructor(options)\n\t{\n\t\tthis.popup = null;\n\t\tthis.options = options || {};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(this.options.onClose) ? this.options.onClose : BX.DoNothing,\n\t\t\tonStopSharingClick: Type.isFunction(this.options.onStopSharingClick) ? this.options.onStopSharingClick : BX.DoNothing,\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tvar popupWidth = 400;\n\n\t\tthis.popup = new Popup({\n\t\t\tbindElement: this.options.bindElement,\n\t\t\ttargetContainer: this.options.targetContainer,\n\t\t\tcontent: this.render(),\n\t\t\tpadding: 0,\n\t\t\tcontentPadding: 0,\n\t\t\theight: 38,\n\t\t\twidth: popupWidth,\n\t\t\toffsetTop: -135,\n\t\t\toffsetLeft: (this.options.bindElement.offsetWidth / 2) - (popupWidth / 2) + (this.options.bindElement.offsetWidth / 2),\n\t\t\tclassName: 'bx-call-view-popup-web-screenshare',\n\t\t\tcontentBackground: 'unset',\n\t\t\tangle: false,\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonDestroy: () => this.popup = null\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-body\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-left\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-icon-screen\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-text\"},\n\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_WEB_SCREENSHARE_STATUS\")\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-right\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-stop ui-btn ui-btn-primary ui-btn-xs ui-btn-round ui-btn-no-caps ui-btn-icon-stop\"},\n\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_WEB_SCREENSHARE_STOP\"),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () => this.callbacks.onStopSharingClick()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-close\"},\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\t}\n}","import {Type} from 'main.core';\nimport {CallEvent, UserMnemonic} from './engine/engine';\nimport {View} from './view/view';\n\nconst StrategyType = {\n\tAllowAll: 'AllowAll',\n\tAllowNone: 'AllowNone',\n\tOnlySpeaker: 'OnlySpeaker',\n\tCurrentlyTalking: 'CurrentlyTalking'\n};\n\nconst HOLD_VIDEO_SECONDS = 20;\n\nexport class VideoStrategy\n{\n\tstatic Type = StrategyType\n\n\tcall: VoximplantCall\n\tcallView: View\n\tstrategyType: $Keys<typeof StrategyType>\n\tusers: {[string]: User}\n\n\tconstructor(config)\n\t{\n\t\tthis.call = config.call;\n\t\tthis.callView = config.callView;\n\t\tthis.strategyType = config.strategyType || StrategyType.AllowAll;\n\n\t\t// event handlers\n\t\tthis.onCallUserVoiceStartedHandler = this.onCallUserVoiceStarted.bind(this);\n\t\tthis.onCallUserVoiceStoppedHandler = this.onCallUserVoiceStopped.bind(this);\n\t\tthis.onCallViewSetCentralUserHandler = this.onCallViewSetCentralUser.bind(this);\n\t\tthis.onCallViewLayoutChangeHandler = this.onCallViewLayoutChange.bind(this);\n\n\t\tthis.users = {};\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tif (this.strategyType === StrategyType.AllowAll)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.all);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.AllowNone)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t}\n\t\tthis.bindEvents();\n\t};\n\n\tbindEvents()\n\t{\n\t\tthis.call.addEventListener(CallEvent.onUserVoiceStarted, this.onCallUserVoiceStartedHandler);\n\t\tthis.call.addEventListener(CallEvent.onUserVoiceStopped, this.onCallUserVoiceStoppedHandler);\n\t\tthis.callView.subscribe(View.Event.onSetCentralUser, this.onCallViewSetCentralUserHandler);\n\t\tthis.callView.subscribe(View.Event.onLayoutChange, this.onCallViewLayoutChangeHandler);\n\t};\n\n\tremoveEvents()\n\t{\n\t\tif (this.call)\n\t\t{\n\t\t\tthis.call.removeEventListener(CallEvent.onUserVoiceStarted, this.onCallUserVoiceStartedHandler);\n\t\t\tthis.call.removeEventListener(CallEvent.onUserVoiceStopped, this.onCallUserVoiceStoppedHandler);\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.unsubscribe(View.Event.onSetCentralUser, this.onCallViewSetCentralUserHandler);\n\t\t\tthis.callView.unsubscribe(View.Event.onLayoutChange, this.onCallViewLayoutChangeHandler);\n\t\t}\n\t};\n\n\tsetType(strategyType: $Keys<typeof StrategyType>)\n\t{\n\t\tif (strategyType == this.strategyType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.strategyType = strategyType;\n\t\tthis.applyVideoLimit();\n\t};\n\n\tapplyVideoLimit()\n\t{\n\t\tif (this.strategyType === StrategyType.AllowAll)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.all);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.AllowNone)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.CurrentlyTalking)\n\t\t{\n\t\t\tlet talkingUsers = this.getActiveUsers();\n\t\t\tif (talkingUsers.length === 0)\n\t\t\t{\n\t\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.call.allowVideoFrom(this.getActiveUsers());\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * return int[]\n\t */\n\tgetActiveUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tlet user = this.users[userId];\n\t\t\tif (user.active)\n\t\t\t{\n\t\t\t\tresult.push(user.id)\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tonUserActiveChanged()\n\t{\n\t\tif (this.strategyType == StrategyType.CurrentlyTalking)\n\t\t{\n\t\t\tthis.applyVideoLimit();\n\t\t}\n\t};\n\n\tonCallUserVoiceStarted(data)\n\t{\n\t\tconst userId = data.userId;\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthis.users[userId] = new User({\n\t\t\t\tid: userId,\n\t\t\t\tonActiveChanged: this.onUserActiveChanged.bind(this)\n\t\t\t});\n\t\t}\n\n\t\tthis.users[userId].setTalking(true);\n\t};\n\n\tonCallUserVoiceStopped(data)\n\t{\n\t\tconst userId = data.userId;\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthis.users[userId] = new User({\n\t\t\t\tid: userId,\n\t\t\t\tonActiveChanged: this.onUserActiveChanged.bind(this)\n\t\t\t});\n\t\t}\n\n\t\tthis.users[userId].setTalking(false);\n\t};\n\n\tonCallViewSetCentralUser(event)\n\t{\n\t\tconst userId = event.data.userId;\n\n\t\tif (this.strategyType === StrategyType.OnlySpeaker)\n\t\t{\n\t\t\tthis.call.allowVideoFrom([userId]);\n\t\t}\n\t};\n\n\tonCallViewLayoutChange(event)\n\t{\n\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.removeEvents();\n\t\tthis.call = null;\n\t\tthis.callView = null;\n\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].destroy();\n\t\t\t}\n\t\t}\n\t\tthis.users = {};\n\t};\n}\n\nclass User\n{\n\tid: number\n\ttalking = false\n\tsharing = false\n\tactive = false\n\n\tconstructor(config)\n\t{\n\t\tthis.id = config.id;\n\n\t\tthis.callbacks = {\n\t\t\tonActiveChanged: Type.isFunction(config.onActiveChanged) ? config.onActiveChanged : BX.DoNothing\n\t\t};\n\n\t\tthis.turnOffVideoTimeout = null;\n\t};\n\n\tsetTalking(talking: boolean)\n\t{\n\t\tif (this.talking == talking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.talking = talking;\n\t\tif (this.talking)\n\t\t{\n\t\t\tthis.cancelTurnOffVideo();\n\t\t\tthis.updateActive();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleTurnOffVideo();\n\t\t}\n\t};\n\n\tsetSharing(sharing: boolean)\n\t{\n\t\tif (this.sharing == sharing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.sharing = sharing;\n\t\tif (this.sharing)\n\t\t{\n\t\t\tthis.cancelTurnOffVideo();\n\t\t\tthis.updateActive();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleTurnOffVideo();\n\t\t}\n\t};\n\n\tupdateActive()\n\t{\n\t\tconst newActive = !!(this.sharing || this.talking || this.turnOffVideoTimeout);\n\t\tif (newActive !== this.active)\n\t\t{\n\t\t\tthis.active = newActive;\n\t\t}\n\t\tthis.callbacks.onActiveChanged({\n\t\t\tuserId: this.id,\n\t\t\tactive: this.active\n\t\t});\n\t};\n\n\tscheduleTurnOffVideo()\n\t{\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t\tthis.turnOffVideoTimeout = setTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.turnOffVideoTimeout = null;\n\t\t\t\tthis.updateActive();\n\t\t\t},\n\t\t\tHOLD_VIDEO_SECONDS * 1000\n\t\t);\n\t};\n\n\tcancelTurnOffVideo()\n\t{\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t\tthis.turnOffVideoTimeout = null;\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.callbacks.onActiveChanged = BX.DoNothing;\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t};\n}","import { Dom, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Analytics } from 'call.lib.analytics';\nimport '../css/copilot-popup.css';\nimport Util from '../util';\nimport { CallAI } from '../call_ai';\n\nexport class CopilotPopup\n{\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\t\tthis.popupTemplate = null;\n\t\tthis.isCopilotActive = config.isCopilotActive;\n\t\tthis.isCopilotFeaturesEnabled = config.isCopilotFeaturesEnabled;\n\t\tthis.callId = config.callId;\n\n\t\tthis.callbacks = {\n\t\t\tupdateCopilotState: BX.type.isFunction(config.updateCopilotState) ? config.updateCopilotState : BX.DoNothing,\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t}\n\t};\n\n\tgetPopupTemplate()\n\t{\n\t\tconst getButton = () => {\n\t\t\tif (this.isCopilotActive)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_gray' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_DISABLE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.callbacks.updateCopilotState();\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.isCopilotFeaturesEnabled)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('private_coming_soon');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_transparent' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_COMING_SOON'),\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!CallAI.tariffAvailable)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('tariff_limit');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_green' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_TARIFF_UP'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tUtil.openArticle(CallAI.helpSlider);\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!CallAI.settingsEnabled)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('error_turnedoff');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_transparent' },\n\t\t\t\t\ttext: Loc.getMessage('CALL_COPILOT_POPUP_SETTINGS_DISABLED'),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!CallAI.agreementAccepted)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('agreement_limit');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_transparent' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_CONCERN_NOT_ACCEPTED'),\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!CallAI.baasAvailable)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('baas_limit');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_green' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_BUY_BOOST'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tUtil.openArticle(CallAI.baasPromoSlider);\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_green' },\n\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_ENABLE'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.callbacks.updateCopilotState();\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.popupTemplate = Dom.create(\"div\", {\n\t\t\tprops: { className: 'bx-call-copilot-popup__wrapper' },\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__content' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title-icon-background' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title-icon-image' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title-text' },\n\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_TITLE'),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__description' },\n\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_TITLE'),\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"ul\", {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_ai' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_AGENDA'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_pen' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_AGREEMENTS_V2'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_magic-pen' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_GRADE'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_list' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_TRANSCRIPT_V2'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__actions' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('button', getButton()),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tcreate()\n\t{\n\t\tconst copilotButton = document.querySelector('.bx-messenger-videocall-panel-background-copilot');\n\t\tconst self = this;\n\n\t\tif (!copilotButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getPopupTemplate();\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName : \"bx-call-copilot-popup\",\n\t\t\tbindElement: copilotButton,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.popupTemplate,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbackground: '#190A37',\n\t\t\tcontentBackground: '#190A37',\n\t\t\tdarkMode: true,\n\t\t\tcontentNoPaddings: true,\n\t\t\tanimation: \"fading\",\n\t\t\twidth: 364,\n\t\t\tpadding: 0,\n\t\t\tangle: {\n\t\t\t\toffset: 162,\n\t\t\t\tposition: 'bottom',\n\t\t\t},\n\t\t\toffsetLeft: -118,\n\t\t\tcontentBorderRadius: '18px',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onClose();\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tself.popup = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.create();\n\t\tthis.popup.show();\n\t}\n\n\ttoggle()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.close();\n\t}\n\n\tsendAnalytics(popupType)\n\t{\n\t\tAnalytics.getInstance().copilot.onAIRestrictionsPopupShow({\n\t\t\tcallId: this.callId,\n\t\t\tpopupType,\n\t\t});\n\t}\n}\n","import {Browser, Dom, Type, Text, Reflection} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup, Menu} from 'main.popup';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Button} from 'ui.buttons';\nimport {LocalStorage} from 'im.lib.localstorage';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {SoundType} from 'im.v2.const';\nimport {DesktopDownload} from 'intranet.desktop-download';\n\nimport {BackgroundDialog} from './dialogs/background_dialog'\nimport {PromoPopup, PromoPopup3D} from './dialogs/promo_popup';\nimport {IncomingNotification} from './dialogs/incoming_notification';\nimport {ConferenceNotifications} from './dialogs/conference_notification';\nimport {CallHint} from './call_hint_popup';\nimport {Sidebar} from './sidebar';\nimport { CopilotNotify, CopilotNotifyType } from './view/copilot-notify';\nimport { RecordWithCopilotPopup } from './view/record-with-copilot-popup';\nimport {WebScreenSharePopup} from './web_screenshare_popup';\nimport {FloatingScreenShare} from './floating_screenshare';\nimport {CallEngine, UserState, Provider, CallState, CallEvent} from './engine/engine';\nimport {BitrixCall} from './engine/bitrix_call'\nimport {VoximplantCall} from './engine/voximplant_call'\nimport {PlainCall} from './engine/plain_call';\nimport {SimpleVAD} from './engine/simple_vad';\nimport {Hardware} from './hardware';\nimport {View} from './view/view';\nimport {VideoStrategy} from './video_strategy';\nimport Util from './util';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Analytics } from 'call.lib.analytics';\nimport { CopilotPopup, CopilotPopupType } from './view/copilot-popup';\nimport { CallAI } from './call_ai';\n\nimport './css/call-overlay.css';\n\nconst Events = {\n\tonViewStateChanged: 'onViewStateChanged',\n\tonOpenVideoConference: 'onOpenVideoConference',\n\tonPromoViewed: 'onPromoViewed',\n\tonCallJoined: 'onCallJoined',\n\tonCallLeft: 'onCallLeft',\n\tonCallDestroyed: 'onCallDestroyed',\n};\n\nconst ViewState = {\n\tOpened: 'Opened',\n\tClosed: 'Closed',\n\tFolded: 'Folded'\n};\n\nconst DocumentType = {\n\tResume: 'resume',\n\tBlank: 'blank'\n};\n\nconst FeatureState = {\n\tEnabled: 'enabled',\n\tDisabled: 'disabled',\n\tLimited: 'limited',\n}\n\nconst DOC_EDITOR_WIDTH = 961;\nconst DOC_TEMPLATE_WIDTH = 328;\nconst DOC_CREATED_EVENT = 'CallController::documentCreated';\nconst DOCUMENT_PROMO_CODE = 'im:call-document:16102021:web';\nconst DOCUMENT_PROMO_DELAY = 5 * 60 * 1000; // 5 minutes\nconst FILE_TYPE_DOCX = 'docx';\nconst FILE_TYPE_XLSX = 'xlsx';\nconst FILE_TYPE_PPTX = 'pptx';\n\nconst MASK_PROMO_CODE = 'im:mask:06122022:desktop';\nconst MASK_PROMO_DELAY = 5 * 60 * 1000; // 5 minutes\n\ntype UserData = {\n\tid: number,\n\tname: string,\n\tavatar: string,\n\tavatar_hr: string,\n\tgender: string\n}\n\ntype InviteParams = {\n\tviewElement: HTMLElement,\n\tbindElement: HTMLElement,\n\tzIndex: number,\n\tdarkMode: boolean,\n\tidleUsers: number[],\n\tallowNewUsers: boolean,\n\tonDestroy: () => void,\n\tonSelect: ({user: UserData}) => void\n}\n\ntype Closer = {\n\tclose: () => void\n}\n\ntype MessengerFacade = {\n\tgetDefaultZIndex: () => number,\n\tisThemeDark: () => boolean,\n\tgetContainer: () => HTMLElement,\n\topenMessenger: (dialogId: string) => Promise,\n\topenHistory: (dialogId: string) => Promise,\n\topenSettings: (params: any) => void,\n\topenHelpArticle: (string) => void,\n\tisPromoRequired: (string) => boolean,\n\tisMessengerOpen: () => boolean,\n\tisSliderFocused: () => boolean,\n\tshowUserSelector?: (params: InviteParams) => Promise<Closer>,\n\n\tgetMessageCount: () => number,\n\tgetCurrentDialogId: () => string,\n\n\trepeatSound: (string, number, boolean) => void,\n\tstopRepeatSound: (string) => void\n}\n\nexport class CallController extends EventEmitter\n{\n\tcurrentCall: BitrixCall | PlainCall | VoximplantCall | null\n\tcurrentCallIsNew: false\n\tcallNotification: ?IncomingNotification\n\tfloatingScreenShareWindow: ?FloatingScreenShare\n\tcallView: ?View\n\tlanguage: string\n\tincomingVideoStrategyType: string\n\tformatRecordDate: string\n\tmessengerFacade: MessengerFacade\n\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.Controller');\n\n\t\tconst needInit = BX.prop.getBoolean(config, \"init\", true);\n\n\t\tthis.language = config.language || 'en';\n\t\tthis.incomingVideoStrategyType = config.incomingVideoStrategyType || VideoStrategy.Type.AllowAll;\n\t\tthis.formatRecordDate = config.formatRecordDate || 'd.m.Y';\n\n\t\tthis.messengerFacade = config.messengerFacade;\n\n\t\tthis.inited = false;\n\t\tthis.debug = false;\n\n\t\tthis.container = null;\n\t\tthis.docEditor = null;\n\t\tthis.docEditorIframe = null;\n\t\tthis.maxEditorWidth = DOC_TEMPLATE_WIDTH;\n\t\tthis.docCreatedForCurrentCall = false;\n\n\t\tthis.folded = false;\n\n\t\tthis.localStream = null;\n\t\tthis.audioRingtone = SoundType.ringtoneModern;\n\n\t\t// for setting the camera after reconnect\n\t\tthis.lastUsedCameraId = null;\n\t\tthis.reconnectingCameraId = null;\n\n\t\tthis.childCall = null;\n\t\tthis.invitePopup = null;\n\t\t/** @var {VideoStrategy} this.currentCall */\n\t\tthis.videoStrategy = null;\n\n\t\tthis.isHttps = window.location.protocol === \"https:\";\n\t\tthis.callWithLegacyMobile = false;\n\n\t\tthis.featureScreenSharing = FeatureState.Enabled;\n\t\tthis.featureRecord = FeatureState.Enabled;\n\n\t\tthis.screenShareStartTime = null;\n\n\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\tthis.callRecordType = View.RecordType.None;\n\t\tthis.callRecordInfo = null;\n\n\t\tthis.autoCloseCallView = true;\n\n\t\tthis.talkingUsers = {};\n\n\t\tthis._callViewState = ViewState.Closed;\n\n\t\tthis.answeredOrDeclinedCalls = new Set();\n\n\t\t// event handlers\n\t\tthis._onCallUserInvitedHandler = this._onCallUserInvited.bind(this);\n\t\tthis._onCallDestroyHandler = this._onCallDestroy.bind(this);\n\t\tthis._onCallUserStateChangedHandler = this._onCallUserStateChanged.bind(this);\n\t\tthis._onCallUserMicrophoneStateHandler = this._onCallUserMicrophoneState.bind(this);\n\t\tthis._onCallUserCameraStateHandler = this._onCallUserCameraState.bind(this);\n\t\tthis._onNeedResetMediaDevicesStateHandler = this._onNeedResetMediaDevicesState.bind(this);\n\t\tthis._onCameraPublishingHandler = this._onCameraPublishing.bind(this);\n\t\tthis._onMicrophonePublishingdHandler = this._onMicrophonePublishingd.bind(this);\n\t\tthis._onCallUserVideoPausedHandler = this._onCallUserVideoPaused.bind(this);\n\t\tthis._onCallLocalMediaReceivedHandler = this._onCallLocalMediaReceived.bind(this);\n\t\tthis._onCallLocalMediaStoppedHandler = this._onCallLocalMediaStopped.bind(this);\n\t\tthis._onCallLocalCameraFlipHandler = this._onCallLocalCameraFlip.bind(this);\n\t\tthis._onCallLocalCameraFlipInDesktopHandler = this._onCallLocalCameraFlipInDesktop.bind(this);\n\t\tthis._onCallRemoteMediaReceivedHandler = this._onCallRemoteMediaReceived.bind(this);\n\t\tthis._onCallRemoteMediaStoppedHandler = this._onCallRemoteMediaStopped.bind(this);\n\t\tthis._onCallBadNetworkIndicatorHandler = this._onCallBadNetworkIndicator.bind(this);\n\t\tthis._onCallConnectionQualityChangedHandler = this._onCallConnectionQualityChanged.bind(this);\n\t\tthis._onCallToggleRemoteParticipantVideoHandler = this._onCallToggleRemoteParticipantVideo.bind(this);\n\t\tthis._onCallUserVoiceStartedHandler = this._onCallUserVoiceStarted.bind(this);\n\t\tthis._onCallUserVoiceStoppedHandler = this._onCallUserVoiceStopped.bind(this);\n\t\tthis._onUserStatsReceivedHandler = this._onUserStatsReceived.bind(this);\n\t\tthis._onCallUserScreenStateHandler = this._onCallUserScreenState.bind(this);\n\t\tthis._onCallUserRecordStateHandler = this._onCallUserRecordState.bind(this);\n\t\tthis.onCallUserFloorRequestHandler = this._onCallUserFloorRequest.bind(this);\n\t\tthis._onCallFailureHandler = this._onCallFailure.bind(this);\n\t\tthis._onNetworkProblemHandler = this._onNetworkProblem.bind(this);\n\t\tthis._onMicrophoneLevelHandler = this._onMicrophoneLevel.bind(this);\n\t\tthis._onReconnectingHandler = this._onReconnecting.bind(this);\n\t\tthis._onReconnectedHandler = this._onReconnected.bind(this);\n\t\tthis._onCustomMessageHandler = this._onCustomMessage.bind(this);\n\t\tthis._onJoinRoomOfferHandler = this._onJoinRoomOffer.bind(this);\n\t\tthis._onJoinRoomHandler = this._onJoinRoom.bind(this);\n\t\tthis._onLeaveRoomHandler = this._onLeaveRoom.bind(this);\n\t\tthis._onTransferRoomSpeakerHandler = this._onTransferRoomSpeaker.bind(this);\n\t\tthis._onCallLeaveHandler = this._onCallLeave.bind(this);\n\t\tthis._onCallJoinHandler = this._onCallJoin.bind(this);\n\t\tthis._onGetUserMediaEndedHandler = this._onGetUserMediaEnded.bind(this);\n\t\tthis._onUpdateLastUsedCameraIdHandler = this._onUpdateLastUsedCameraId.bind(this);\n\t\tthis._onSwitchTrackRecordStatusHandler = this._onSwitchTrackRecordStatus.bind(this);\n\n\t\tthis._onBeforeUnloadHandler = this._onBeforeUnload.bind(this);\n\t\tthis._onImTabChangeHandler = this._onImTabChange.bind(this);\n\t\tthis._onUpdateChatCounterHandler = this._onUpdateChatCounter.bind(this);\n\n\t\tthis._onChildCallFirstMediaHandler = this._onChildCallFirstMedia.bind(this);\n\n\t\tthis._onWindowFocusHandler = this._onWindowFocus.bind(this);\n\t\tthis._onWindowBlurHandler = this._onWindowBlur.bind(this);\n\n\t\tif (DesktopApi.isDesktop() && false)\n\t\t{\n\t\t\tthis.floatingWindow = new FloatingVideo({\n\t\t\t\tonMainAreaClick: this._onFloatingVideoMainAreaClick.bind(this),\n\t\t\t\tonButtonClick: this._onFloatingVideoButtonClick.bind(this)\n\t\t\t});\n\t\t\tthis.floatingWindowUser = 0;\n\t\t}\n\t\tthis.showFloatingWindowTimeout = 0;\n\t\tthis.hideIncomingCallTimeout = 0;\n\t\tthis.ignoreDeclinedCallsTimeout = {};\n\t\tthis.ignoreIncomingNotificationTimeouts = {};\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.floatingScreenShareWindow = new FloatingScreenShare({\n\t\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\t\t\t\tonBackToCallClick: this._onFloatingScreenShareBackToCallClick.bind(this),\n\t\t\t\tonStopSharingClick: this._onFloatingScreenShareStopClick.bind(this),\n\t\t\t\tonChangeScreenClick: this._onFloatingScreenShareChangeScreenClick.bind(this)\n\t\t\t});\n\t\t}\n\t\tthis.showFloatingScreenShareWindowTimeout = 0;\n\n\t\tthis.mutePopup = null;\n\t\tthis.allowMutePopup = true;\n\n\t\tthis.webScreenSharePopup = null;\n\n\t\tthis.feedbackPopup = null;\n\n\t\tthis.resizeObserver = new BX.ResizeObserver(this._onResize.bind(this));\n\n\t\tthis.loopTimers = {};\n\n\t\tif (needInit)\n\t\t{\n\t\t\tthis.init();\n\t\t\tthis.#subscribeEvents(config);\n\t\t}\n\t}\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (let eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config.events[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config.events[eventName])\n\t\t\t}\n\t\t}\n\t}\n\n\tget userId()\n\t{\n\t\treturn Number(BX.message('USER_ID'))\n\t}\n\n\tget callViewState()\n\t{\n\t\treturn this._callViewState\n\t}\n\n\tset callViewState(newState)\n\t{\n\t\tif (this.callViewState == newState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._callViewState = newState;\n\t\tthis.emit(Events.onViewStateChanged, {\n\t\t\tcallViewState: newState\n\t\t})\n\t}\n\n\tinit()\n\t{\n\t\tBX.addCustomEvent(window, \"CallEvents::incomingCall\", this.onIncomingCall.bind(this));\n\t\tHardware.subscribe(Hardware.Events.deviceChanged, this._onDeviceChange.bind(this));\n\t\tHardware.subscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipHandler);\n\t\tif (DesktopApi.isDesktop() && this.floatingWindow)\n\t\t{\n\t\t\twindow.addEventListener(\"blur\", this._onWindowBlurHandler);\n\t\t\twindow.addEventListener(\"focus\", this._onWindowFocusHandler);\n\n\t\t\tDesktopApi.subscribe(\"BXForegroundChanged\", (focus) =>\n\t\t\t{\n\t\t\t\tif (focus)\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowFocus();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowBlur();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (DesktopApi.isDesktop() && this.floatingScreenShareWindow)\n\t\t{\n\t\t\tDesktopApi.subscribe(\"BXScreenMediaSharing\", (id, title, x, y, width, height, app) =>\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.close();\n\n\t\t\t\tthis.floatingScreenShareWindow.setSharingData({\n\t\t\t\t\ttitle: title,\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: y,\n\t\t\t\t\twidth: width,\n\t\t\t\t\theight: height,\n\t\t\t\t\tapp: app\n\t\t\t\t}).then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.show();\n\t\t\t\t}).catch((error) =>\n\t\t\t\t{\n\t\t\t\t\tconsole.error('setSharingData error', error);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\twindow.addEventListener(\"blur\", this._onWindowBlurHandler);\n\t\t\twindow.addEventListener(\"focus\", this._onWindowFocusHandler);\n\n\t\t\tDesktopApi.subscribe(\"BXForegroundChanged\", (focus) =>\n\t\t\t{\n\t\t\t\tif (focus)\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowFocus();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowBlur();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.subscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipInDesktopHandler);\n\t\t}\n\n\t\tif (window['VoxImplant'])\n\t\t{\n\t\t\tVoxImplant.getInstance().addEventListener(VoxImplant.Events.MicAccessResult, this.voxMicAccessResult.bind(this));\n\t\t}\n\n\t\twindow.addEventListener(\"beforeunload\", this._onBeforeUnloadHandler);\n\t\tBX.addCustomEvent(\"OnDesktopTabChange\", this._onImTabChangeHandler);\n\n\t\tBX.addCustomEvent(window, \"onImUpdateCounterMessage\", this._onUpdateChatCounter.bind(this));\n\n\t\tBX.garbage(this.destroy, this);\n\n\t\tthis.inited = true;\n\t}\n\n\t/**\n\t * Workaround to get current microphoneId\n\t * @param e\n\t */\n\tvoxMicAccessResult(e)\n\t{\n\t\tif (e.stream && e.stream.getAudioTracks().length > 0 && this.callView)\n\t\t{\n\t\t\tthis.callView.microphoneId = e.stream.getAudioTracks()[0].getSettings().deviceId\n\t\t}\n\t}\n\n\tgetCallType()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.currentCall.provider === Provider.Plain\n\t\t\t? Analytics.AnalyticsType.private\n\t\t\t: Analytics.AnalyticsType.group\n\t\t;\n\t}\n\n\tgetCallUsers(includeSelf)\n\t{\n\t\tconst result = Object.keys(this.currentCall.getUsers());\n\t\tif (includeSelf)\n\t\t{\n\t\t\tresult.push(this.currentCall.userId);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetActiveCallUsers()\n\t{\n\t\tconst userStates = this.currentCall.getUsers();\n\t\tlet activeUsers = [];\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tif (userStates[userId] === UserState.Connected || userStates[userId] === UserState.Connecting || userStates[userId] === UserState.Calling)\n\t\t\t\t{\n\t\t\t\t\tactiveUsers.push(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn activeUsers;\n\t}\n\n\tgetMaxActiveCallUsers()\n\t{\n\t\tconst userStates = this.currentCall.getUsers();\n\t\tlet activeUsers = [];\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tuserStates[userId] !== UserState.Declined\n\t\t\t\t\t&& userStates[userId] !== UserState.Busy\n\t\t\t\t\t&& userStates[userId] !== UserState.Unavailable\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tactiveUsers.push(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn activeUsers;\n\t}\n\n\tupdateFloatingWindowContent()\n\t{\n\t\tif (!this.floatingWindow || !this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\n\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) =>\n\t\t{\n\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t});\n\t}\n\n\tupdateDeviceIdInChildCall()\n\t{\n\t\tif (!this.childCall || !this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.microphoneId)\n\t\t{\n\t\t\tthis.childCall.setMicrophoneId(this.currentCall.microphoneId);\n\t\t}\n\t\tif (this.currentCall.cameraId)\n\t\t{\n\t\t\tthis.childCall.setCameraId(this.currentCall.cameraId);\n\t\t}\n\t}\n\n\tonIncomingCall(e)\n\t{\n\t\tconsole.warn(\"incoming.call\", e);\n\t\t/** @var {BitrixCall|PlainCall|VoximplantCall} newCall */\n\t\tconst newCall = e.call;\n\t\tconst isCurrentCallActive = this.currentCall && (this.callView || this.callNotification);\n\n\t\tthis.callWithLegacyMobile = (e.isLegacyMobile === true);\n\n\t\tif (!isCurrentCallActive)\n\t\t{\n\t\t\tif (this.ignoreDeclinedCallsTimeout[newCall.id])\n\t\t\t{\n\t\t\t\tclearTimeout(this.ignoreDeclinedCallsTimeout[newCall.id]);\n\t\t\t\tthis.ignoreDeclinedCallsTimeout[newCall.id] = setTimeout(\n\t\t\t\t\t() => this.answeredOrDeclinedCalls.delete(newCall.id),\n\t\t\t\t\t15000\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.callView\n\t\t\t\t|| this.answeredOrDeclinedCalls.has(newCall.id)\n\t\t\t\t|| window.BXShowedIncomingCallNotification === newCall.id\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.checkDesktop()\n\t\t\t\t.then(\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\t// don't wait for init here to speedup process\n\t\t\t\t\t\tHardware.init();\n\t\t\t\t\t\tif (this.currentCall || newCall.state == CallState.Finished)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.currentCall = newCall;\n\t\t\t\t\t\tthis.bindCallEvents();\n\t\t\t\t\t\tthis.updateFloatingWindowContent();\n\t\t\t\t\t\twindow.BXShowedIncomingCallNotification = newCall.id;\n\t\t\t\t\t\tthis.ignoreIncomingNotificationTimeouts[newCall.id] = setTimeout(\n\t\t\t\t\t\t\t() => window.BXShowedIncomingCallNotification = null,\n\t\t\t\t\t\t\t10000\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (this.currentCall.associatedEntity.type === 'chat' && this.currentCall.associatedEntity.advanced['chatType'] === 'videoconf')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.isConferencePageOpened(this.currentCall.associatedEntity.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t// conference page is already opened, do nothing\n\t\t\t\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showIncomingConference();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet video = e.video === true;\n\t\t\t\t\t\t\tthis.showIncomingCall({\n\t\t\t\t\t\t\t\tvideo: video\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tHardware.init().then(() =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!Hardware.hasCamera())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (video)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (this.callNotification)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.callNotification.setHasCamera(false);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t(error) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.currentCall)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\tthis.log(error);\n\t\t\t\t\t\tif (!this.isHttps)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_INCOMING_ERROR_HTTPS_REQUIRED\"))\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_INCOMING_UNSUPPORTED_BROWSER\"))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (newCall.id == this.currentCall.id)\n\t\t\t{\n\t\t\t\t// ignoring\n\t\t\t}\n\t\t\telse if (newCall.parentId == this.currentCall.id)\n\t\t\t{\n\t\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.stopScreenSharing();\n\t\t\t\t}\n\n\t\t\t\tif (!this.childCall)\n\t\t\t\t{\n\t\t\t\t\tthis.childCall = newCall;\n\t\t\t\t}\n\t\t\t\tthis.callView.removeScreenUsers();\n\t\t\t\tthis.childCall.users.forEach((userId) => this.callView.addUser(userId, UserState.Calling));\n\t\t\t\tthis.callView.updateCopilotFeatureState(this.childCall?.isCopilotFeaturesEnabled);\n\t\t\t\tthis.updateCallViewUsers(newCall.id, this.childCall.users);\n\t\t\t\tthis.updateDeviceIdInChildCall();\n\t\t\t\tthis.answerChildCall();\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// send busy\n\t\t\t\tnewCall.decline(486);\n\t\t\t\tconst isVideoconf =\n\t\t\t\t\tnewCall.associatedEntity.type === 'chat'\n\t\t\t\t\t&& newCall.associatedEntity.advanced['chatType'] === 'videoconf'\n\t\t\t\t;\n\t\t\t\tconst newCallType = newCall.provider === Provider.Plain\n\t\t\t\t\t? Analytics.AnalyticsType.private\n\t\t\t\t\t: Analytics.AnalyticsType.group\n\t\t\t\t;\n\n\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\tcallId: newCall.id,\n\t\t\t\t\tcallType: isVideoconf ? Analytics.AnalyticsType.videoconf : newCallType,\n\t\t\t\t\tstatus: Analytics.AnalyticsStatus.busy,\n\t\t\t\t\tassociatedEntity: newCall.associatedEntity,\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tbindCallEvents()\n\t{\n\t\tthis.currentCall.addEventListener(CallEvent.onUserInvited, this._onCallUserInvitedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onDestroy, this._onCallDestroyHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserMicrophoneState, this._onCallUserMicrophoneStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserCameraState, this._onCallUserCameraStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onNeedResetMediaDevicesState, this._onNeedResetMediaDevicesStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCameraPublishing, this._onCameraPublishingHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onMicrophonePublishing, this._onMicrophonePublishingdHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVideoPaused, this._onCallUserVideoPausedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserScreenState, this._onCallUserScreenStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserRecordState, this._onCallUserRecordStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserFloorRequest, this.onCallUserFloorRequestHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLocalMediaStopped, this._onCallLocalMediaStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onCallRemoteMediaReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRemoteMediaStopped, this._onCallRemoteMediaStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onBadNetworkIndicator, this._onCallBadNetworkIndicatorHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onConnectionQualityChanged, this._onCallConnectionQualityChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onToggleRemoteParticipantVideo, this._onCallToggleRemoteParticipantVideoHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVoiceStarted, this._onCallUserVoiceStartedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVoiceStopped, this._onCallUserVoiceStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserStatsReceived, this._onUserStatsReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCallFailure, this._onCallFailureHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onNetworkProblem, this._onNetworkProblemHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onMicrophoneLevel, this._onMicrophoneLevelHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onReconnecting, this._onReconnectingHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onReconnected, this._onReconnectedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCustomMessage, this._onCustomMessageHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoinRoomOffer, this._onJoinRoomOfferHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoinRoom, this._onJoinRoomHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLeaveRoom, this._onLeaveRoomHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onTransferRoomSpeaker, this._onTransferRoomSpeakerHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoin, this._onCallJoinHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLeave, this._onCallLeaveHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onGetUserMediaEnded, this._onGetUserMediaEndedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUpdateLastUsedCameraId, this._onUpdateLastUsedCameraIdHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onSwitchTrackRecordStatus, this._onSwitchTrackRecordStatusHandler);\n\t}\n\n\tremoveCallEvents()\n\t{\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserInvited, this._onCallUserInvitedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onDestroy, this._onCallDestroyHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserMicrophoneState, this._onCallUserMicrophoneStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserCameraState, this._onCallUserCameraStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onNeedResetMediaDevicesState, this._onNeedResetMediaDevicesStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCameraPublishing, this._onCameraPublishingHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onMicrophonePublishing, this._onMicrophonePublishingdHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVideoPaused, this._onCallUserVideoPausedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserScreenState, this._onCallUserScreenStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserRecordState, this._onCallUserRecordStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserFloorRequest, this.onCallUserFloorRequestHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLocalMediaStopped, this._onCallLocalMediaStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onCallRemoteMediaReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRemoteMediaStopped, this._onCallRemoteMediaStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onBadNetworkIndicator, this._onCallBadNetworkIndicatorHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onConnectionQualityChanged, this._onCallConnectionQualityChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onToggleRemoteParticipantVideo, this._onCallToggleRemoteParticipantVideoHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVoiceStarted, this._onCallUserVoiceStartedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVoiceStopped, this._onCallUserVoiceStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserStatsReceived, this._onUserStatsReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCallFailure, this._onCallFailureHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onNetworkProblem, this._onNetworkProblemHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onMicrophoneLevel, this._onMicrophoneLevelHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onReconnecting, this._onReconnectingHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onReconnected, this._onReconnectedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCustomMessage, this._onCustomMessageHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onJoin, this._onCallJoinHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLeave, this._onCallLeaveHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onGetUserMediaEnded, this._onGetUserMediaEndedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUpdateLastUsedCameraId, this._onUpdateLastUsedCameraIdHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onSwitchTrackRecordStatus, this._onSwitchTrackRecordStatusHandler);\n\t}\n\n\tbindCallViewEvents()\n\t{\n\t\tthis.callView.setCallback(View.Event.onShow, this._onCallViewShow.bind(this));\n\t\tthis.callView.setCallback(View.Event.onClose, this._onCallViewClose.bind(this));\n\t\tthis.callView.setCallback(View.Event.onDestroy, this._onCallViewDestroy.bind(this));\n\t\tthis.callView.setCallback(View.Event.onButtonClick, this._onCallViewButtonClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onBodyClick, this._onCallViewBodyClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceCamera, this._onCallViewReplaceCamera.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceMicrophone, this._onCallViewReplaceMicrophone.bind(this));\n\t\tthis.callView.setCallback(View.Event.onSetCentralUser, this._onCallViewSetCentralUser.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeHdVideo, this._onCallViewChangeHdVideo.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeMicAutoParams, this._onCallViewChangeMicAutoParams.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeFaceImprove, this._onCallViewChangeFaceImprove.bind(this));\n\t\tthis.callView.setCallback(View.Event.onOpenAdvancedSettings, this._onCallViewOpenAdvancedSettings.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceSpeaker, this._onCallViewReplaceSpeaker.bind(this));\n\t\tthis.callView.setCallback(View.Event.onHasMainStream, this._onCallViewHasMainStream.bind(this));\n\t\tthis.callView.setCallback(View.Event.onToggleSubscribe, this._onCallToggleSubscribe.bind(this));\n\t\tthis.callView.setCallback(View.Event.onUserClick, this._onCallUserClick.bind(this));\n\t}\n\n\tupdateCallViewUsers(callId, userList)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst convertAllItemsToInt = (arr) => Array.from(arr, (item) => parseFloat(item))\n\t\tconst userListInt = convertAllItemsToInt(userList)\n\n\t\tlet userDataInt = []\n\t\tlet notIncludedEl = []\n\n\t\tif (this.currentCall.userData)\n\t\t{\n\t\t\tthis.callView.updateUserData(this.currentCall.userData);\n\n\t\t\tuserDataInt = convertAllItemsToInt(Object.keys(this.currentCall.userData));\n\t\t\tnotIncludedEl = userListInt.filter((id) => userDataInt.indexOf(id) === -1);\n\t\t}\n\n\t\tif (this.currentCall.userData && !notIncludedEl.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.getUsers(callId, userListInt).then((userData) =>\n\t\t{\n\t\t\tthis.callView.updateUserData(userData);\n\t\t});\n\t}\n\n\tcreateVideoStrategy()\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.destroy();\n\t\t}\n\n\t\tconst strategyType = this.incomingVideoStrategyType;\n\n\t\tthis.videoStrategy = new VideoStrategy({\n\t\t\tcall: this.currentCall,\n\t\t\tcallView: this.callView,\n\t\t\tstrategyType: strategyType\n\t\t});\n\t}\n\n\tremoveVideoStrategy()\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.destroy();\n\t\t}\n\t\tthis.videoStrategy = null;\n\t}\n\n\tsetFeatureScreenSharing(enable)\n\t{\n\t\tthis.featureScreenSharing = enable;\n\t}\n\n\tsetFeatureRecord(enable)\n\t{\n\t\tthis.featureRecord = enable;\n\t}\n\n\tsetVideoStrategyType(type)\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.setType(type)\n\t\t}\n\t}\n\n\tcreateContainer()\n\t{\n\t\tthis.container = BX.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-call-overlay\"},\n\t\t});\n\n\t\tconst externalContainer = this.messengerFacade.getContainer();\n\t\texternalContainer.insertBefore(this.container, externalContainer.firstChild);\n\n\t\texternalContainer.classList.add(\"bx-messenger-call\");\n\t}\n\n\tremoveContainer()\n\t{\n\t\tif (this.container)\n\t\t{\n\t\t\tDom.remove(this.container);\n\t\t\tthis.container = null;\n\t\t\tthis.messengerFacade.getContainer().classList.remove(\"bx-messenger-call\");\n\t\t}\n\t}\n\n\tanswerChildCall()\n\t{\n\t\tthis.removeCallEvents();\n\t\tthis.removeVideoStrategy();\n\t\tthis.childCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstMediaHandler);\n\t\tthis.childCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.childCall.answer();\n\t}\n\n\tsetReconnectingCameraId(id)\n\t{\n\t\tthis.reconnectingCameraId = id;\n\n\t\tif (id) {\n\t\t\tthis.updateCameraSettingsInCurrentCallAfterReconnecting(id)\n\t\t}\n\t}\n\n\tupdateCameraSettingsInCurrentCallAfterReconnecting(cameraId)\n\t{\n\n\t\tif (this.currentCall.cameraId === cameraId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst devicesList = Hardware.getCameraList();\n\n\t\tif (!devicesList.find(device => device.deviceId === cameraId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentCall.setCameraId(cameraId);\n\t\tthis.setReconnectingCameraId(null);\n\t}\n\n\t_onChildCallFirstMedia(e)\n\t{\n\t\tif (!this.childCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.log(\"Finishing one-to-one call, switching to group call\");\n\n\t\tconst newCall = this.childCall;\n\t\tthis.childCall = null;\n\n\t\tlet previousRecordType = View.RecordType.None;\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tpreviousRecordType = this.callRecordType;\n\n\t\t\tBXDesktopSystem.CallRecordStop();\n\t\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\t\tthis.callRecordType = View.RecordType.None;\n\t\t\tthis.callView.setRecordState(this.callView.getDefaultRecordState());\n\t\t\tthis.callView.setButtonActive('record', false);\n\t\t}\n\n\t\tthis.callView.showButton('floorRequest');\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tif (\"track\" in e)\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, e.kind, e.track);\n\t\t\t}\n\t\t\tif (\"mediaRenderer\" in e && e.mediaRenderer.kind === \"audio\")\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, 'audio', e.mediaRenderer.stream.getAudioTracks()[0]);\n\t\t\t}\n\t\t\tif (\"mediaRenderer\" in e && (e.mediaRenderer.kind === \"video\" || e.mediaRenderer.kind === \"sharing\"))\n\t\t\t{\n\t\t\t\tthis.callView.setVideoRenderer(e.userId, e.mediaRenderer);\n\t\t\t}\n\t\t}\n\n\t\tnewCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstMediaHandler);\n\t\tnewCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\n\t\tthis.removeCallEvents();\n\t\tconst oldCall = this.currentCall;\n\n\t\tAnalytics.getInstance().onFinishCall({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t\tstatus: Analytics.AnalyticsStatus.privateToGroup,\n\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t\tcallUsersCount: this.getMaxActiveCallUsers().length,\n\t\t\tcallLength: Util.getTimeInSeconds(this.currentCall.startDate),\n\t\t});\n\n\t\toldCall.hangup();\n\n\t\tthis.currentCall = newCall;\n\n\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id)\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t}\n\n\t\tthis.bindCallEvents();\n\t\tthis.createVideoStrategy();\n\n\t\tif (previousRecordType !== View.RecordType.None)\n\t\t{\n\t\t\tthis._startRecordCall(previousRecordType);\n\t\t}\n\t}\n\n\tcheckDesktop()\n\t{\n\t\tif (Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst desktop = BX.Messenger.v2.Lib.DesktopManager.getInstance();\n\t\t\t\tdesktop.checkStatusInDifferentContext()\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (result === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (Reflection.getClass('BX.desktopUtils'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tBX.desktopUtils.runningCheck(\n\t\t\t\t\t() => {},\n\t\t\t\t\t() => resolve()\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tisMutedPopupAllowed()\n\t{\n\t\tif (!this.allowMutePopup || !this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\treturn !currentRoom || currentRoom.speaker == this.userId;\n\t}\n\n\tisConferencePageOpened(dialogId)\n\t{\n\t\tconst tagPresent = LocalStorage.get(\n\t\t\tCallEngine.getSiteId(),\n\t\t\tCallEngine.getCurrentUserId(),\n\t\t\tCallEngine.getConferencePageTag(dialogId),\n\t\t\t'N'\n\t\t);\n\n\t\treturn tagPresent === 'Y';\n\t}\n\n\t/**\n\t * @param {Object} params\n\t * @param {bool} [params.video = false]\n\t */\n\tshowIncomingCall(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\t\tparams.video = params.video === true;\n\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\tthis.feedbackPopup.close();\n\t\t}\n\n\t\tconst allowVideo = this.callWithLegacyMobile ? params.video === true : true;\n\n\t\tthis.callNotification = new IncomingNotification({\n\t\t\tcallerName: this.currentCall.associatedEntity.name,\n\t\t\tcallerAvatar: this.currentCall.associatedEntity.avatar,\n\t\t\tcallerType: this.currentCall.associatedEntity.advanced.chatType,\n\t\t\tcallerColor: this.currentCall.associatedEntity.avatarColor,\n\t\t\tvideo: params.video,\n\t\t\thasCamera: allowVideo,\n\t\t\tcameraState: allowVideo,\n\t\t\tmicrophoneState: !(this.getCallUsers(true).length > this.getMaxActiveMicrophonesCount()),\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: this._onCallNotificationButtonClick.bind(this),\n\t\t\tisMessengerOpen: this.messengerFacade.isMessengerOpen(),\n\t\t});\n\n\t\tthis.callNotification.show();\n\t\tthis.scheduleCancelNotification(false);\n\n\t\tthis.messengerFacade.repeatSound(this.audioRingtone, 3500, true);\n\t}\n\n\tshowIncomingConference()\n\t{\n\t\tthis.callNotification = new ConferenceNotifications({\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tcallerName: this.currentCall.associatedEntity.name,\n\t\t\tcallerAvatar: this.currentCall.associatedEntity.avatar,\n\t\t\tcallerColor: this.currentCall.associatedEntity.avatarColor,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: this._onCallConferenceNotificationButtonClick.bind(this)\n\t\t});\n\n\t\tthis.callNotification.show();\n\t\tthis.scheduleCancelNotification(true);\n\n\t\tthis.messengerFacade.repeatSound(this.audioRingtone, 3500, true);\n\t}\n\n\tscheduleCancelNotification(isIncomingConference = false)\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.hideIncomingCallTimeout = setTimeout(() =>\n\t\t{\n\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\tcallType: isIncomingConference ? Analytics.AnalyticsType.videoconf : this.getCallType(),\n\t\t\t\tstatus: Analytics.AnalyticsStatus.noAnswer,\n\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t});\n\n\t\t\tif (this.callNotification)\n\t\t\t{\n\t\t\t\tthis.callNotification.close();\n\t\t\t}\n\t\t\tif (this.currentCall)\n\t\t\t{\n\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.currentCall = null;\n\t\t\t}\n\t\t}, 30 * 1000);\n\t}\n\n\tshowNotification(notificationText, actions)\n\t{\n\t\tif (!actions)\n\t\t{\n\t\t\tactions = [];\n\t\t}\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(notificationText),\n\t\t\tposition: \"top-right\",\n\t\t\tautoHideDelay: 5000,\n\t\t\tcloseButton: true,\n\t\t\tactions: actions\n\t\t});\n\t}\n\n\tshowNetworkProblemNotification(notificationText)\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(notificationText),\n\t\t\tposition: \"top-right\",\n\t\t\tautoHideDelay: 5000,\n\t\t\tcloseButton: true,\n\t\t\tactions: [{\n\t\t\t\ttitle: BX.message(\"IM_M_CALL_HELP\"),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: (event, balloon) =>\n\t\t\t\t\t{\n\t\t\t\t\t\ttop.BX.Helper.show('redirect=detail&code=12723718');\n\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}]\n\t\t});\n\t}\n\n\tshowUnsupportedNotification()\n\t{\n\t\tlet messageBox;\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tmessageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_DESKTOP_TOO_OLD'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message('IM_M_CALL_BTN_UPDATE'),\n\t\t\t\tcancelCaption: BX.message('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\tconst url = DesktopDownload.getLinkForCurrentUser();\n\t\t\t\t\twindow.open(url, \"desktopApp\");\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmessageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_WEBRTC_USE_CHROME_OR_DESKTOP'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message(\"IM_CALL_DETAILS\"),\n\t\t\t\tcancelCaption: BX.message('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=11387752\");\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\tmessageBox.show();\n\t}\n\n\tisUserAgentSupported()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\treturn DesktopApi.getApiVersion() > 48;\n\t\t}\n\t\tif ('VoxImplant' in window)\n\t\t{\n\t\t\treturn VoxImplant.getInstance().isRTCsupported();\n\t\t}\n\t\treturn Util.isWebRTCSupported();\n\t}\n\n\tgetBlockedButtons(needBlockAddButton = false) :string[]\n\t{\n\t\tlet result = ['record', 'copilot'];\n\t\tif (!this.messengerFacade.showUserSelector || needBlockAddButton)\n\t\t{\n\t\t\tresult.push('add')\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprepareUserCall(callData)\n\t{\n\t\tthis.preparedUserCall = callData;\n\t}\n\n\tstartCall(dialogId, video, withCopilot)\n\t{\n\t\tif (!this.isUserAgentSupported())\n\t\t{\n\t\t\tthis.showUnsupportedNotification();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.callView || this.currentCall)\n\t\t{\n\t\t\tthis.unfold();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.initCallPromise)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\tthis.feedbackPopup.close();\n\t\t}\n\n\t\tlet provider = Provider.Plain;\n\t\tif (dialogId.toString().startsWith(\"chat\"))\n\t\t{\n\t\t\tprovider = Util.getConferenceProvider();\n\t\t}\n\t\tconst isCallPrepared = provider === Provider.Plain && this.preparedUserCall?.dialogId === dialogId;\n\n\t\tconst debug1 = +(new Date());\n\t\tthis.initCallPromise = this.messengerFacade.openMessenger(dialogId)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn Hardware.init();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (video && isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis._prepareLocalStream();\n\t\t\t\t}\n\n\t\t\t\tthis.createContainer();\n\t\t\t\tlet hiddenButtons = [];\n\t\t\t\tif (provider === Provider.Plain)\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t\thiddenButtons.push('hangupOptions');\n\t\t\t\t}\n\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t}\n\n\t\t\t\tHardware.isCameraOn = video;\n\n\t\t\t\tthis.callView = new View({\n\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\tlayout: dialogId.toString().startsWith(\"chat\") ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\tshowShareButton: this.featureScreenSharing !== FeatureState.Disabled,\n\t\t\t\t\tshowRecordButton: this.featureRecord !== FeatureState.Disabled,\n\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t\tblockedButtons: this.getBlockedButtons(provider === Provider.Plain),\n\t\t\t\t\tshowAddUserButtonInList: provider === Provider.Plain,\n\t\t\t\t\tisCopilotFeaturesEnabled: provider === Provider.Bitrix,\n\t\t\t\t\tisCopilotActive: withCopilot,\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallViewEvents();\n\n\t\t\t\tif (isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.isPreparing = true;\n\t\t\t\t\tthis.callView.appendUsers({\n\t\t\t\t\t\t[this.preparedUserCall.user]: UserState.Calling,\n\t\t\t\t\t});\n\t\t\t\t\tthis.callView.updateUserData({\n\t\t\t\t\t\t...this.preparedUserCall.userData,\n\t\t\t\t\t});\n\t\t\t\t\tif (this.localStream)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst streamData = {\n\t\t\t\t\t\t\tstream: this.localStream,\n\t\t\t\t\t\t\ttag: 'main',\n\t\t\t\t\t\t\tflipVideo: Hardware.enableMirroring,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis.callView.setLocalStream(streamData);\n\t\t\t\t\t}\n\t\t\t\t\tthis.callView.show();\n\t\t\t\t}\n\n\t\t\t\tif (video && !Hardware.hasCamera())\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\tvideo = false;\n\t\t\t\t}\n\n\t\t\t\treturn CallEngine.createCall({\n\t\t\t\t\tentityType: 'chat',\n\t\t\t\t\tentityId: dialogId,\n\t\t\t\t\tprovider: provider,\n\t\t\t\t\tvideoEnabled: !!video,\n\t\t\t\t\tenableMicAutoParameters: Hardware.enableMicAutoParameters,\n\t\t\t\t\tjoinExisting: true,\n\t\t\t\t\tdebug: this.debug,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then((e) =>\n\t\t\t{\n\t\t\t\tconst debug2 = +(new Date());\n\t\t\t\tthis.currentCall = e.call;\n\t\t\t\tthis.currentCallIsNew = e.isNew;\n\n\t\t\t\tif (!this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.leaveCurrentCall(true);\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tthis.log(\"Call creation time: \" + (debug2 - debug1) / 1000 + \" seconds\");\n\n\t\t\t\tthis._onUpdateCallCopilotState(this.currentCall.isCopilotActive);\n\n\t\t\t\tif (this.currentCall.isCopilotActive)\n\t\t\t\t{\n\t\t\t\t\tthis.sendStartCopilotRecordAnalytics();\n\t\t\t\t}\n\n\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t}\n\n\t\t\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id)\n\t\t\t\t{\n\t\t\t\t\tif (this.messengerFacade.getCurrentDialogId() != this.currentCall.associatedEntity.id)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\tif (isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.isPreparing = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callView.appendUsers(this.currentCall.getUsers());\n\t\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\t}\n\n\t\t\t\tthis.callView.show();\n\t\t\t\tthis.showCopilotNotify(true);\n\n\t\t\t\tthis.showDocumentPromo();\n\t\t\t\tthis.showMaskPromo();\n\n\t\t\t\tif (this.currentCallIsNew)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Inviting users\");\n\t\t\t\t\tAnalytics.getInstance().onStartCall({\n\t\t\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t\t\tisCopilotActive: this.currentCall.isCopilotActive,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.currentCall.inviteUsers();\n\n\t\t\t\t\tthis.messengerFacade.repeatSound('dialtone', 5000, true);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Joining existing call\");\n\t\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsection: Analytics.AnalyticsSection.chatWindow,\n\t\t\t\t\t\telement: Analytics.AnalyticsElement.videocall,\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.getCallUsers(true).length > this.getMaxActiveMicrophonesCount())\n\t\t\t\t\t{\n\t\t\t\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\t\t\t\tthis.showAutoMicMuteNotification();\n\t\t\t\t\t}\n\t\t\t\t\tthis.currentCall.answer();\n\t\t\t\t}\n\n\t\t\t\tthis._onUpdateLastUsedCameraId();\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\n\t\t\t\tlet errorCode;\n\t\t\t\tif (typeof (error) == \"string\")\n\t\t\t\t{\n\t\t\t\t\terrorCode = error;\n\t\t\t\t}\n\t\t\t\telse if (typeof (error) == \"object\" && error.code)\n\t\t\t\t{\n\t\t\t\t\terrorCode = error.code == 'access_denied' ? 'ACCESS_DENIED' : error.code\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\terrorCode = 'UNKNOWN_ERROR';\n\t\t\t\t}\n\t\t\t\tthis._onCallFailure({\n\t\t\t\t\tcode: errorCode,\n\t\t\t\t\tmessage: error.message || \"\",\n\t\t\t\t})\n\n\t\t\t\tif (this.hasStreamFromCall)\n\t\t\t\t{\n\t\t\t\t\tthis._stopLocalStream();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.finally(() =>\n\t\t\t{\n\t\t\t\tthis.initCallPromise = null;\n\t\t\t\tthis.preparedUserCall = null;\n\t\t\t});\n\t}\n\n\tcloseCallNotification()\n\t{\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t}\n\n\tjoinCall(callId: number, video: boolean, options: {joinAsViewer?: boolean})\n\t{\n\n\t\tconst joinAsViewer = BX.prop.getBoolean(options, \"joinAsViewer\", false);\n\n\t\tif (!this.isUserAgentSupported())\n\t\t{\n\t\t\tthis.showUnsupportedNotification();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.callView || this.initCallPromise)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet isGroupCall;\n\n\t\tthis.log(\"Joining call \" + callId);\n\t\tthis.initCallPromise = CallEngine.getCallWithId(callId)\n\t\t\t.then((result) =>\n\t\t\t{\n\t\t\t\tif (!this.currentCall || this.currentCall.id !== callId)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall = result.call;\n\t\t\t\t}\n\t\t\t\tisGroupCall = this.currentCall.associatedEntity.id.toString().startsWith(\"chat\");\n\t\t\t\treturn this.messengerFacade.openMessenger();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn Hardware.init();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.createContainer();\n\n\t\t\t\tlet hiddenButtons = [];\n\t\t\t\tif (this.currentCall instanceof PlainCall)\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t\thiddenButtons.push('hangupOptions');\n\t\t\t\t}\n\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t}\n\n\t\t\t\tHardware.isCameraOn = !!video;\n\n\t\t\t\tthis.callView = new View({\n\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\tlayout: isGroupCall ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\tshowRecordButton: this.featureRecord !== FeatureState.Disabled,\n\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t\tblockedButtons: this.getBlockedButtons(this.currentCall.provider === Provider.Plain),\n\t\t\t\t\tshowAddUserButtonInList: this.currentCall.provider === Provider.Plain,\n\t\t\t\t\tisCopilotFeaturesEnabled: this.currentCall.isCopilotFeaturesEnabled,\n\t\t\t\t\tisCopilotActive: this.currentCall.isCopilotActive,\n\t\t\t\t});\n\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\tthis.bindCallViewEvents();\n\t\t\t\tthis.callView.appendUsers(this.currentCall.getUsers());\n\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\tthis.callView.show();\n\t\t\t\tthis.showDocumentPromo();\n\t\t\t\tthis.showCopilotNotify();\n\n\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t}\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\tif (video && !Hardware.hasCamera())\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\tvideo = false;\n\t\t\t\t}\n\n\n\t\t\t\tif (this.getCallUsers(true).length > this.getMaxActiveMicrophonesCount())\n\t\t\t\t{\n\t\t\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\t\t\tthis.showAutoMicMuteNotification();\n\t\t\t\t}\n\n\t\t\t\tthis.currentCall.answer({\n\t\t\t\t\tjoinAsViewer: joinAsViewer\n\t\t\t\t});\n\n\t\t\t\tthis._onUpdateLastUsedCameraId();\n\t\t\t})\n\t\t\t.finally(() =>\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t},\n\t\t\t\t\tsection: Analytics.AnalyticsSection.chatList,\n\t\t\t\t\telement: Analytics.AnalyticsElement.joinButton,\n\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t});\n\t\t\t\tthis.initCallPromise = null;\n\t\t\t});\n\t}\n\n\tleaveCurrentCall(force, finishCall = false)\n\t{\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tAnalytics.getInstance().onRecordStop({\n\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tsubSection: finishCall ? Analytics.AnalyticsSubSection.contextMenu : Analytics.AnalyticsSubSection.window,\n\t\t\t\telement: finishCall ? Analytics.AnalyticsElement.finishForAllButton : Analytics.AnalyticsElement.disconnectButton,\n\t\t\t\trecordTime: Util.getRecordTimeText(this.callRecordInfo, true),\n\t\t\t});\n\n\t\t\tthis.callRecordInfo = null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.releaseLocalMedia();\n\t\t}\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.answeredOrDeclinedCalls.delete(this.currentCall.id);\n\t\t\tthis.currentCall.hangup(force, '', finishCall);\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tthis.currentCall = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tthis.hasStreamFromCall = false;\n\t\tthis._stopLocalStream();\n\t}\n\n\thasActiveCall()\n\t{\n\t\treturn !!((this.currentCall && this.currentCall.isAnyoneParticipating()) || (this.callView));\n\t}\n\n\thasVisibleCall()\n\t{\n\t\treturn !!(this.callView && this.callView.visible && this.callView.size == View.Size.Full);\n\t}\n\n\tcanRecord()\n\t{\n\t\treturn DesktopApi.isDesktop() && DesktopApi.getApiVersion() >= 54;\n\t}\n\n\tisRecording()\n\t{\n\t\treturn this.canRecord() && this.callRecordState != View.RecordState.Stopped;\n\t}\n\n\tuseDevicesInCurrentCall(deviceList, isForceUse = false)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < deviceList.length; i++)\n\t\t{\n\t\t\tconst deviceInfo = deviceList[i];\n\n\t\t\tswitch (deviceInfo.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\tif (deviceInfo.deviceId === 'default' || isForceUse)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst newDeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceInfo.groupId, 'audioinput');\n\t\t\t\t\t\tthis.currentCall.setMicrophoneId(newDeviceId);\n\t\t\t\t\t\tthis.callView.setMicrophoneId(newDeviceId);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"videoinput\":\n\t\t\t\t\tif (deviceInfo.deviceId === 'default' || isForceUse)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.setCameraId(deviceInfo.deviceId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.reconnectingCameraId === deviceInfo.deviceId && !Hardware.isCameraOn)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateCameraSettingsInCurrentCallAfterReconnecting(deviceInfo.deviceId)\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\tif (this.callView && deviceInfo.deviceId === 'default' || isForceUse)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst newDeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceInfo.groupId, 'audiooutput');\n\t\t\t\t\t\tthis.callView.setSpeakerId(newDeviceId);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveDevicesFromCurrentCall(deviceList)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < deviceList.length; i++)\n\t\t{\n\t\t\tconst deviceInfo = deviceList[i];\n\n\t\t\tswitch (deviceInfo.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\tif (this.currentCall.microphoneId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst microphoneIds = Object.keys(Hardware.microphoneList);\n\t\t\t\t\t\tlet deviceId;\n\n\t\t\t\t\t\tif (microphoneIds.includes('default'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst deviceGroup = Hardware.getDeviceGroupIdByDeviceId('default', 'audioinput');\n\t\t\t\t\t\t\tdeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceGroup, 'audioinput');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!deviceId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdeviceId = microphoneIds.length > 0 ? microphoneIds[0] : \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.currentCall.setMicrophoneId(deviceId);\n\n\t\t\t\t\t\tif (this.currentCall instanceof BitrixCall)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callView.setMicrophoneId(deviceId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"videoinput\":\n\t\t\t\t\tif (this.currentCall.cameraId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst cameraIds = Object.keys(Hardware.cameraList);\n\t\t\t\t\t\tthis.currentCall.setCameraId(cameraIds.length > 0 ? cameraIds[0] : \"\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\tif (this.callView && this.callView.speakerId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst speakerIds = Object.keys(Hardware.audioOutputList);\n\t\t\t\t\t\tlet deviceId;\n\n\t\t\t\t\t\tif (speakerIds.includes('default'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst deviceGroup = Hardware.getDeviceGroupIdByDeviceId('default', 'audiooutput');\n\t\t\t\t\t\t\tdeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceGroup, 'audiooutput');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!deviceId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdeviceId = speakerIds.length > 0 ? speakerIds[0] : \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.callView.setSpeakerId(deviceId);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tshowChat()\n\t{\n\t\tif (DesktopApi.isDesktop() && this.floatingWindow)\n\t\t{\n\t\t\tthis.detached = true;\n\t\t\tthis.callView.hide();\n\t\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\t\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) =>\n\t\t\t{\n\t\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t\t\tthis.floatingWindow.show();\n\t\t\t});\n\n\t\t\tthis.container.style.width = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.fold(Text.decode(this.currentCall.associatedEntity.name));\n\t\t}\n\t}\n\n\tfold(foldedCallTitle)\n\t{\n\t\tif (this.folded || (DesktopApi.isDesktop() && this.floatingWindow))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!foldedCallTitle && this.currentCall)\n\t\t{\n\t\t\tfoldedCallTitle = Text.decode(this.currentCall.associatedEntity.name)\n\t\t}\n\n\t\tthis.folded = true;\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.unobserve(this.container);\n\t\t}\n\t\tthis.container.classList.add('bx-messenger-call-overlay-folded');\n\t\tthis.callView.setTitle(foldedCallTitle);\n\t\tthis.callView.setSize(View.Size.Folded);\n\t\tthis.callViewState = ViewState.Folded;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tthis.sidebar.toggleHidden(true);\n\t\t}\n\t\tthis.closePromo();\n\t\tthis.callView.closeCopilotNotify();\n\n\t\tBX.onCustomEvent(this, \"CallController::onFold\", {});\n\t}\n\n\tsetCallEditorMaxWidth(maxWidth)\n\t{\n\t\tif (maxWidth != this.maxEditorWidth)\n\t\t{\n\t\t\tthis.maxEditorWidth = maxWidth;\n\t\t\tthis._onResize();\n\t\t}\n\t}\n\n\tfindCallEditorWidth()\n\t{\n\t\tconst containerWidth = this.container.clientWidth;\n\t\tconst editorWidth = containerWidth < (this.maxEditorWidth + View.MIN_WIDTH) ? containerWidth - View.MIN_WIDTH : this.maxEditorWidth;\n\t\tconst callWidth = containerWidth - editorWidth;\n\n\t\treturn {callWidth: callWidth, editorWidth: editorWidth};\n\t}\n\n\tshowDocumentsMenu()\n\t{\n\t\tif (this.documentsMenu)\n\t\t{\n\t\t\tthis.documentsMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tAnalytics.getInstance().onDocumentBtnClick({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tconst targetNodeWidth = this.callView.buttons.document.elements.root.offsetWidth;\n\t\tconst resumesArticleCode = Util.getResumesArticleCode();\n\t\tconst documentsArticleCode = Util.getDocumentsArticleCode();\n\n\t\tlet menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_RESUME'),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.resume);\n\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\ttype: DocumentType.Resume,\n\t\t\t\t\t\t}, resumesArticleCode);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE'),\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_DOC'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.doc);\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_DOCX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_XLS'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.sheet);\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_XLSX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_PPT'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.presentation);\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_PPTX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t,\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t]\n\t\t;\n\n\t\tif (!resumesArticleCode)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: BX.message('IM_M_CALL_MENU_OPEN_LAST_RESUME'),\n\t\t\t\tcacheable: true,\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: \"loading\",\n\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_LOADING_RESUME_LIST'),\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonSubMenuShow: (e) => this.buildPreviousResumesSubmenu(e.target)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tlet newStyleOptions = {\n\t\t\tclassName: 'bx-messenger-videocall-document-options-container',\n\t\t\tbackground: '#22272B',\n\t\t\tcontentBackground: '#22272B',\n\t\t\tdarkMode: true,\n\t\t\tcontentBorderRadius: '6px',\n\t\t};\n\n\t\tthis.documentsMenu = new BX.PopupMenuWindow({\n\t\t\t...newStyleOptions,\n\t\t\tangle: false,\n\t\t\tbindElement: this.callView.buttons.document.elements.root,\n\t\t\ttargetContainer: this.container,\n\t\t\toffsetTop: -15,\n\t\t\tbindOptions: {position: \"top\"},\n\t\t\tcacheable: false,\n\t\t\tsubMenuOptions: {\n\t\t\t\tmaxWidth: 450\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonShow: (event) =>\n\t\t\t\t{\n\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\tpopup.getPopupContainer().style.display = 'block'; // bad hack\n\n\t\t\t\t\tconst offsetLeft = (targetNodeWidth / 2) - popup.getPopupContainer().offsetWidth / 2;\n\t\t\t\t\tpopup.setOffset({offsetLeft: offsetLeft + 40, offsetTop: 0});\n\t\t\t\t\tpopup.setAngle({offset: popup.getPopupContainer().offsetWidth / 2 - 17});\n\t\t\t\t},\n\t\t\t\tonDestroy: () => this.documentsMenu = null\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t});\n\n\t\tthis.documentsMenu.show();\n\t}\n\n\tonDocumentCreateAnalyticsEvent(documentType)\n\t{\n\t\tAnalytics.getInstance().onDocumentCreate({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t\ttype: documentType,\n\t\t});\n\t}\n\n\tbuildPreviousResumesSubmenu(menuItem)\n\t{\n\t\tBX.ajax.runAction('disk.api.integration.messengerCall.listResumesInChatByCall', {\n\t\t\tdata: {\n\t\t\t\tcallId: this.currentCall.id\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tconst resumeList = response.data.resumes;\n\n\t\t\tif (resumeList.length > 0)\n\t\t\t{\n\t\t\t\tresumeList.forEach((resume) =>\n\t\t\t\t{\n\t\t\t\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\t\t\t\tid: resume.id,\n\t\t\t\t\t\ttext: resume.object.createDate + ': ' + resume.object.name,\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\tAnalytics.getInstance().onLastResumeOpen({\n\t\t\t\t\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.viewDocumentByLink(resume.links.view);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\t\t\tid: 'nothing',\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_NO_RESUME'),\n\t\t\t\t\tdisabled: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmenuItem.getSubMenu().removeMenuItem('loading');\n\t\t\tmenuItem.adjustSubMenu();\n\t\t})\n\t}\n\n\tmaybeShowDocumentEditor(options, articleCode)\n\t{\n\t\tif (articleCode)\n\t\t{\n\t\t\tif (articleCode)\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show(articleCode);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.showDocumentEditor(options);\n\t}\n\n\tshowDocumentEditor(options)\n\t{\n\t\toptions = options || {};\n\t\tlet openAnimation = true;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tif (options.force)\n\t\t\t{\n\t\t\t\tthis.sidebar.close(false);\n\t\t\t\tthis.sidebar.destroy();\n\t\t\t\tthis.sidebar = null;\n\t\t\t\topenAnimation = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setButtonActive('document', true);\n\t\t}\n\t\tclearTimeout(this.showPromoPopupTimeout);\n\n\t\tthis._createAndOpenSidebarWithIframe(\"about:blank\", openAnimation);\n\n\t\tBX.loadExt('disk.onlyoffice-im-integration')\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tconst docEditor = new BX.Disk.OnlyOfficeImIntegration.CreateDocument({\n\t\t\t\t\tdialog: {\n\t\t\t\t\t\tid: this.currentCall.associatedEntity.id,\n\t\t\t\t\t},\n\t\t\t\t\tcall: {\n\t\t\t\t\t\tid: this.currentCall.id,\n\t\t\t\t\t},\n\t\t\t\t\tdelegate: {\n\t\t\t\t\t\tsetMaxWidth: this.setCallEditorMaxWidth.bind(this),\n\t\t\t\t\t\tonDocumentCreated: this._onDocumentCreated.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\ttype: options.type,\n\t\t\t\t\ttypeFile: options?.typeFile,\n\t\t\t\t});\n\n\t\t\t\tlet promiseGetUrl;\n\t\t\t\tif (options.type === DocumentType.Resume)\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrlForTemplates();\n\t\t\t\t}\n\t\t\t\telse if (options.type === DocumentType.Blank)\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrlForCreate({\n\t\t\t\t\t\ttypeFile: options.typeFile\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrl({\n\t\t\t\t\t\tviewerItem: options.viewerItem\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tpromiseGetUrl\n\t\t\t\t\t.then((url) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.docEditorIframe.src = url;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(e)\n\t\t\t\t\t\tthis.closeDocumentEditor()\n\t\t\t\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t\t\t\t});\n\n\t\t\t\tthis.docEditor = docEditor;\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.closeDocumentEditor()\n\t\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t\t});\n\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.observe(this.container);\n\t\t}\n\t}\n\n\tcloseDocumentEditor()\n\t{\n\t\tAnalytics.getInstance().onDocumentClose({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t\ttype: this.getDocumentType(),\n\t\t});\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (this.docEditor && this.docEditorIframe)\n\t\t\t{\n\t\t\t\tthis.docEditor.onCloseIframe(this.docEditorIframe);\n\t\t\t}\n\t\t\tif (this.container && this.resizeObserver)\n\t\t\t{\n\t\t\t\tthis.resizeObserver.unobserve(this.container);\n\t\t\t}\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setButtonActive('document', false);\n\t\t\t\tthis.callView.removeMaxWidth();\n\t\t\t}\n\t\t\tif (!this.sidebar)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\t\t\tconst oldSidebar = this.sidebar;\n\t\t\tthis.sidebar = null;\n\t\t\toldSidebar.close().then(() =>\n\t\t\t{\n\t\t\t\tthis.docEditor = null;\n\t\t\t\tthis.docEditorIframe = null;\n\t\t\t\toldSidebar.destroy();\n\t\t\t\tthis.maxEditorWidth = this.docCreatedForCurrentCall ? DOC_EDITOR_WIDTH : DOC_TEMPLATE_WIDTH;\n\t\t\t\tif (!this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.removeContainer();\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tviewDocumentByLink(url)\n\t{\n\t\tif (this.sidebar)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setButtonActive('document', true);\n\t\t}\n\n\t\tthis.maxEditorWidth = DOC_EDITOR_WIDTH;\n\t\tthis._createAndOpenSidebarWithIframe(url);\n\t}\n\n\t_createAndOpenSidebarWithIframe(url, animation)\n\t{\n\t\tanimation = animation === true;\n\t\tconst result = this.findCallEditorWidth();\n\t\tconst callWidth = result.callWidth;\n\t\tconst editorWidth = result.editorWidth;\n\n\t\tthis.callView.setMaxWidth(callWidth);\n\t\tthis.sidebar = new Sidebar({\n\t\t\tcontainer: this.container,\n\t\t\twidth: editorWidth,\n\t\t\tevents: {\n\t\t\t\tonCloseClicked: this.onSideBarCloseClicked.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.sidebar.open(animation);\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: this.sidebar.elements.contentContainer\n\t\t});\n\t\tloader.show();\n\n\t\tconst docEditorIframe = BX.create(\"iframe\", {\n\t\t\tattrs: {\n\t\t\t\tsrc: url,\n\t\t\t\tframeborder: \"0\"\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\tdisplay: \"none\",\n\t\t\t\tborder: \"0\",\n\t\t\t\tmargin: \"0\",\n\t\t\t\twidth: \"100%\",\n\t\t\t\theight: \"100%\",\n\t\t\t}\n\t\t});\n\n\t\tdocEditorIframe.addEventListener('load',\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tloader.destroy();\n\t\t\t\tdocEditorIframe.style.display = 'block';\n\t\t\t},\n\t\t\t{once: true}\n\t\t);\n\t\tdocEditorIframe.addEventListener('error', (error) =>\n\t\t{\n\t\t\tconsole.error(error);\n\t\t\tthis.closeDocumentEditor()\n\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t})\n\t\tthis.sidebar.elements.contentContainer.appendChild(docEditorIframe);\n\t\tthis.docEditorIframe = docEditorIframe;\n\t}\n\n\t_onDocumentCreated()\n\t{\n\t\tthis.docCreatedForCurrentCall = true;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.sendCustomMessage(DOC_CREATED_EVENT, true)\n\t\t}\n\n\t\tAnalytics.getInstance().onDocumentUpload({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t\ttype: this.getDocumentType(),\n\t\t});\n\t}\n\n\tonSideBarCloseClicked()\n\t{\n\t\tthis.closeDocumentEditor();\n\t}\n\n\t_ensureDocumentEditorClosed()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!this.sidebar)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tconst messageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_TO_ANSWER'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_YES'),\n\t\t\t\tcancelCaption: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_NO'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.closeDocumentEditor().then(() => resolve());\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tonCancel: () =>\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tmessageBox.show();\n\t\t})\n\t}\n\n\tonDocumentPromoActionClicked()\n\t{\n\t\tthis.closePromo();\n\n\t\tconst articleCode = Util.getResumesArticleCode();\n\t\tif (articleCode)\n\t\t{\n\t\t\tBX.UI.InfoHelper.show(articleCode); //@see \\Bitrix\\Disk\\Integration\\MessengerCall::getInfoHelperCodeForDocuments()\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showDocumentEditor({\n\t\t\ttype: DocumentType.Resume,\n\t\t});\n\t}\n\n\tonDocumentPromoClosed(e)\n\t{\n\t\tconst data = e.getData();\n\t\tif (data.dontShowAgain)\n\t\t{\n\t\t\tthis.emit(Events.onPromoViewed, {\n\t\t\t\tcode: DOCUMENT_PROMO_CODE\n\t\t\t})\n\t\t}\n\n\t\tthis.documentPromoPopup = null;\n\t}\n\n\tgetDocumentType()\n\t{\n\t\tif (this.docEditor.options.type === DocumentType.Resume)\n\t\t{\n\t\t\treturn Analytics.AnalyticsType.resume;\n\t\t}\n\n\t\tswitch (this.docEditor.options.typeFile)\n\t\t{\n\t\t\tcase FILE_TYPE_DOCX:\n\t\t\t\treturn Analytics.AnalyticsType.doc;\n\t\t\tcase FILE_TYPE_XLSX:\n\t\t\t\treturn Analytics.AnalyticsType.sheet;\n\t\t\tcase FILE_TYPE_PPTX:\n\t\t\t\treturn Analytics.AnalyticsType.presentation;\n\t\t}\n\t}\n\n\tunfold()\n\t{\n\t\tif (this.detached)\n\t\t{\n\t\t\tthis.container.style.removeProperty('width');\n\t\t\tthis.callView.show();\n\t\t\tthis.detached = false;\n\t\t\tif (this.floatingWindow)\n\t\t\t{\n\t\t\t\tthis.floatingWindow.hide();\n\t\t\t}\n\t\t}\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.folded = false;\n\t\t\tthis.container.classList.remove('bx-messenger-call-overlay-folded');\n\t\t\tthis.callView.setSize(View.Size.Full);\n\t\t\tthis.callViewState = ViewState.Opened;\n\t\t\tif (this.sidebar)\n\t\t\t{\n\t\t\t\tthis.sidebar.toggleHidden(false);\n\t\t\t\tif (this.resizeObserver)\n\t\t\t\t{\n\t\t\t\t\tthis.resizeObserver.observe(this.container);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tBX.onCustomEvent(this, \"CallController::onUnfold\", {});\n\t}\n\n\tisFullScreen()\n\t{\n\t\tif (\"webkitFullscreenElement\" in document)\n\t\t{\n\t\t\treturn (!!document.webkitFullscreenElement);\n\t\t}\n\t\telse if (\"fullscreenElement\" in document)\n\t\t{\n\t\t\treturn (!!document.fullscreenElement);\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoggleFullScreen()\n\t{\n\t\tif (this.isFullScreen())\n\t\t{\n\t\t\tthis.exitFullScreen();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.enterFullScreen();\n\t\t}\n\t}\n\n\tenterFullScreen()\n\t{\n\t\tif (this.messengerFacade.isSliderFocused())\n\t\t{\n\t\t\tBX.SidePanel.Instance.enterFullScreen();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (Browser.isChrome() || Browser.isSafari())\n\t\t\t{\n\t\t\t\tdocument.body.webkitRequestFullScreen();\n\t\t\t}\n\t\t\telse if (Browser.isFirefox())\n\t\t\t{\n\t\t\t\tdocument.body.requestFullscreen();\n\t\t\t}\n\t\t}\n\t}\n\n\texitFullScreen()\n\t{\n\t\tif (this.messengerFacade.isSliderFocused())\n\t\t{\n\t\t\tBX.SidePanel.Instance.exitFullScreen();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (document.cancelFullScreen)\n\t\t\t{\n\t\t\t\tdocument.cancelFullScreen();\n\t\t\t}\n\t\t\telse if (document.mozCancelFullScreen)\n\t\t\t{\n\t\t\t\tdocument.mozCancelFullScreen();\n\t\t\t}\n\t\t\telse if (document.webkitCancelFullScreen)\n\t\t\t{\n\t\t\t\tdocument.webkitCancelFullScreen();\n\t\t\t}\n\t\t\telse if (document.exitFullscreen)\n\t\t\t{\n\t\t\t\tdocument.exitFullscreen();\n\t\t\t}\n\t\t}\n\t}\n\n\tshowDocumentPromo()\n\t{\n\t\tif (!this.callView || !this.currentCall || !Util.shouldShowDocumentButton())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.messengerFacade.isPromoRequired(DOCUMENT_PROMO_CODE))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst documentButton = this.callView.buttons.document.elements.root;\n\t\tconst bindElement = documentButton.querySelector('.bx-messenger-videocall-panel-icon');\n\t\tif (!bindElement)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tthis.documentPromoPopup = new PromoPopup({\n\t\t\tbindElement: bindElement,\n\t\t\tpromoCode: DOCUMENT_PROMO_CODE,\n\t\t\tevents: {\n\t\t\t\tonActionClick: this.onDocumentPromoActionClicked.bind(this),\n\t\t\t\tonClose: this.onDocumentPromoClosed.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.showPromoPopupTimeout = setTimeout(() =>\n\t\t{\n\t\t\tif (this.folded)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.documentPromoPopup.show();\n\t\t}, DOCUMENT_PROMO_DELAY);\n\t}\n\n\tshowMaskPromo()\n\t{\n\t\tif (!this.callView || !this.currentCall || !BackgroundDialog.isMaskAvailable())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.messengerFacade.isPromoRequired(MASK_PROMO_CODE))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.maskPromoPopup = new PromoPopup3D({\n\t\t\tcallView: this.callView,\n\t\t\tevents: {\n\t\t\t\tonClose: (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.emit(Events.onPromoViewed, {\n\t\t\t\t\t\tcode: MASK_PROMO_CODE\n\t\t\t\t\t})\n\t\t\t\t\tthis.maskPromoPopup = null\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.showPromoPopup3dTimeout = setTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tif (!this.folded)\n\t\t\t\t{\n\t\t\t\t\tthis.maskPromoPopup.show();\n\t\t\t\t}\n\t\t\t},\n\t\t\tMASK_PROMO_DELAY\n\t\t);\n\t}\n\n\tclosePromo()\n\t{\n\t\tif (this.documentPromoPopup)\n\t\t{\n\t\t\tthis.documentPromoPopup.close();\n\t\t}\n\n\t\tif (this.maskPromoPopup)\n\t\t{\n\t\t\tthis.maskPromoPopup.close();\n\t\t}\n\n\t\tclearTimeout(this.showPromoPopupTimeout);\n\t\tclearTimeout(this.showPromoPopup3dTimeout);\n\t}\n\n\t_startRecordCall(type)\n\t{\n\t\tthis.callView.setButtonActive('record', true);\n\t\tthis.callRecordType = type;\n\n\t\tthis.currentCall.sendRecordState({\n\t\t\taction: View.RecordState.Started,\n\t\t\tdate: new Date()\n\t\t});\n\n\t\tthis.callRecordState = View.RecordState.Started;\n\t}\n\n\t// event handlers\n\n\t_onCallNotificationClose()\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.destroy();\n\t\t}\n\t}\n\n\t_onCallNotificationDestroy()\n\t{\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\t\tthis.callNotification = null;\n\t}\n\n\t_onCallNotificationButtonClick(e)\n\t{\n\t\tconst data = e.data;\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.callNotification.close();\n\t\tswitch (data.button)\n\t\t{\n\t\t\tcase \"answer\":\n\t\t\t\tif (this.currentCall && !this.answeredOrDeclinedCalls.has(this.currentCall.id))\n\t\t\t\t{\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(this.currentCall.id);\n\t\t\t\t\tthis._onAnswerButtonClick(data.mediaParams);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"decline\":\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tconst callId = this.currentCall.id;\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(callId);\n\t\t\t\t\tthis.ignoreDeclinedCallsTimeout[callId] = setTimeout(\n\t\t\t\t\t\t() => this.answeredOrDeclinedCalls.delete(callId),\n\t\t\t\t\t\t15000\n\t\t\t\t\t);\n\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\tthis.removeCallEvents();\n\n\t\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\t\tcallId: callId,\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsection: Analytics.AnalyticsSection.callPopup,\n\t\t\t\t\t\telement: Analytics.AnalyticsElement.answerButton,\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.decline,\n\t\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.currentCall.decline();\n\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onAnswerButtonClick(mediaParams)\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.activateWindow();\n\t\t}\n\n\t\tif (!this.isUserAgentSupported())\n\t\t{\n\t\t\tthis.log(\"Error: unsupported user agent\");\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.currentCall.decline();\n\t\t\tthis.currentCall = null;\n\n\t\t\tthis.showUnsupportedNotification();\n\t\t\treturn;\n\t\t}\n\n\t\tAnalytics.getInstance().onJoinCall({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t\tmediaParams,\n\t\t\tsection: Analytics.AnalyticsSection.callPopup,\n\t\t\telement: Analytics.AnalyticsElement.answerButton,\n\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t});\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.destroy();\n\t\t}\n\n\t\tconst dialogId = this.currentCall.associatedEntity && this.currentCall.associatedEntity.id ? this.currentCall.associatedEntity.id : false;\n\t\tlet isGroupCall = dialogId.toString().startsWith(\"chat\");\n\t\tthis._ensureDocumentEditorClosed()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn this.messengerFacade.openMessenger(dialogId);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn Hardware.init();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (!this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tthis.log('The call was destroyed while being answered');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.createContainer();\n\t\t\t\tlet hiddenButtons = [];\n\t\t\t\tif (this.currentCall instanceof PlainCall)\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t\thiddenButtons.push('hangupOptions');\n\t\t\t\t}\n\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t}\n\t\t\t\tHardware.isCameraOn = mediaParams.video && Hardware.hasCamera();\n\t\t\t\tthis.callView = new View({\n\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\tusers: this.currentCall.users,\n\t\t\t\t\tuserStates: this.currentCall.getUsers(),\n\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\tshowRecordButton: this.featureRecord !== FeatureState.Disabled,\n\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\tlayout: isGroupCall ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\tblockedButtons: this.getBlockedButtons(this.currentCall.provider === Provider.Plain),\n\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\tshowAddUserButtonInList: this.currentCall.provider === Provider.Plain,\n\t\t\t\t\tisCopilotFeaturesEnabled: this.currentCall.isCopilotFeaturesEnabled,\n\t\t\t\t\tisCopilotActive: this.currentCall.isCopilotActive,\n\t\t\t\t});\n\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\tif (this.callWithLegacyMobile)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.blockAddUser();\n\t\t\t\t}\n\n\t\t\t\tthis.bindCallViewEvents();\n\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\tthis.callView.show();\n\t\t\t\tthis.showDocumentPromo();\n\t\t\t\tthis.showMaskPromo();\n\t\t\t\tthis.showCopilotNotify();\n\n\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t}\n\n\t\t\t\tHardware.isMicrophoneMuted = !mediaParams.audio;\n\n\t\t\t\tthis.currentCall.answer({\n\t\t\t\t\tenableMicAutoParameters: Hardware.enableMicAutoParameters\n\t\t\t\t});\n\n\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\tthis._onUpdateLastUsedCameraId();\n\t\t\t});\n\t}\n\n\t_onCallConferenceNotificationButtonClick(e)\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.callNotification.close();\n\t\tswitch (e.button)\n\t\t{\n\t\t\tcase \"answerConference\":\n\t\t\t\tif (this.currentCall && 'id' in this.currentCall.associatedEntity)\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().onAnswerConference({\n\t\t\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(this.currentCall.id);\n\t\t\t\t\tlet dialogId = this.currentCall.associatedEntity.id.toString();\n\t\t\t\t\tif (dialogId.startsWith('chat'))\n\t\t\t\t\t{\n\t\t\t\t\t\tdialogId = dialogId.substring(4);\n\t\t\t\t\t}\n\t\t\t\t\tthis.emit(Events.onOpenVideoConference, {dialogId: dialogId});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"skipConference\":\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().onDeclineConference({\n\t\t\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(this.currentCall.id);\n\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\tthis.currentCall.decline();\n\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onCallViewShow()\n\t{\n\t\tthis.callView.setButtonCounter(\"chat\", this.messengerFacade.getMessageCount());\n\t\tthis.callViewState = ViewState.Opened;\n\t}\n\n\t_onCallViewClose()\n\t{\n\t\tthis.callView.destroy();\n\t\tthis.callViewState = ViewState.Closed;\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.documentsMenu)\n\t\t{\n\t\t\tthis.documentsMenu.close();\n\t\t}\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow(DesktopApi.findWindow('callBackground'));\n\t\t}\n\t\tthis.closePromo();\n\n\t\tif (this.mediaDevicesResetStateHintBaloon)\n\t\t{\n\t\t\tthis.mediaDevicesResetStateHintBaloon.close();\n\t\t\tthis.mediaDevicesResetStateHintBaloon = null;\n\t\t}\n\t\tthis._closeReconnectionBaloon();\n\t\tthis._closeParticipantsVideoBaloon();\n\n\t\tif (this.copilotPopup)\n\t\t{\n\t\t\tthis.copilotPopup.close();\n\t\t}\n\t}\n\n\t_onCallViewDestroy()\n\t{\n\t\tthis.callView = null;\n\t\tthis.folded = false;\n\t\tthis.autoCloseCallView = true;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tBX.adjust(this.container, {\n\t\t\t\tstyle: {\n\t\t\t\t\tbackgroundColor: \"rgba(0, 0, 0, 0.5)\",\n\t\t\t\t\tbackdropFilter: \"blur(5px)\"\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.removeContainer();\n\t\t\tthis.maxEditorWidth = DOC_TEMPLATE_WIDTH;\n\t\t}\n\t}\n\n\t_onCallViewBodyClick()\n\t{\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.unfold();\n\t\t}\n\t}\n\n\t_onCallViewButtonClick(e)\n\t{\n\t\tconst buttonName = e.buttonName;\n\n\t\tconst handlers = {\n\t\t\thangup: this._onCallViewHangupButtonClick.bind(this),\n\t\t\thangupOptions: this._onCallViewHangupOptionsButtonClick.bind(this),\n\t\t\tclose: this._onCallViewCloseButtonClick.bind(this),\n\t\t\tinviteUser: this._onCallViewInviteUserButtonClick.bind(this),\n\t\t\ttoggleMute: this._onCallViewToggleMuteButtonClick.bind(this),\n\t\t\ttoggleScreenSharing: this._onCallViewToggleScreenSharingButtonClick.bind(this),\n\t\t\trecord: this._onCallViewRecordButtonClick.bind(this),\n\t\t\ttoggleVideo: this._onCallViewToggleVideoButtonClick.bind(this),\n\t\t\ttoggleSpeaker: this._onCallViewToggleSpeakerButtonClick.bind(this),\n\t\t\tshowChat: this._onCallViewShowChatButtonClick.bind(this),\n\t\t\tfloorRequest: this._onCallViewFloorRequestButtonClick.bind(this),\n\t\t\tshowHistory: this._onCallViewShowHistoryButtonClick.bind(this),\n\t\t\tfullscreen: this._onCallViewFullScreenButtonClick.bind(this),\n\t\t\tdocument: this._onCallViewDocumentButtonClick.bind(this),\n\t\t\tmicrophoneSideIcon: this._onCallViewMicrophoneSideIconClick.bind(this),\n\t\t\tfeedback: this._onCallViewFeedbackButtonClick.bind(this),\n\t\t\tcopilot: this._onCallViewCopilotButtonClick.bind(this),\n\t\t};\n\n\t\tif (Type.isFunction(handlers[buttonName]))\n\t\t{\n\t\t\thandlers[buttonName].call(this, e);\n\t\t}\n\t}\n\n\t_onCallViewHangupButtonClick()\n\t{\n\t\tAnalytics.getInstance().onDisconnectCall({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t\tsubSection: Analytics.AnalyticsSubSection.finishButton,\n\t\t\tmediaParams: {\n\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t},\n\t\t});\n\n\t\tthis.leaveCurrentCall();\n\t}\n\n\t_onCallViewHangupOptionsButtonClick()\n\t{\n\t\tif (this.hangupOptionsMenu)\n\t\t{\n\t\t\tthis.hangupOptionsMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tconst targetNodeWidth = this.callView.buttons.hangupOptions.elements.root.offsetWidth;\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: BX.message(\"CALL_M_BTN_HANGUP_OPTION_FINISH\"),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tconsole.log('this.currentCall.associatedEntity', this.currentCall.associatedEntity);\n\t\t\t\t\tAnalytics.getInstance().onFinishCall({\n\t\t\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.finishedForAll,\n\t\t\t\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t\t\t\t\tcallUsersCount: this.getMaxActiveCallUsers().length,\n\t\t\t\t\t\tcallLength: Util.getTimeInSeconds(this.currentCall.startDate),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.leaveCurrentCall(false, true);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"CALL_M_BTN_HANGUP_OPTION_LEAVE\"),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tAnalytics.getInstance().onDisconnectCall({\n\t\t\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tsubSection: Analytics.AnalyticsSubSection.contextMenu,\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.leaveCurrentCall();\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\tthis.hangupOptionsMenu = new BX.PopupMenuWindow({\n\t\t\tclassName: 'bx-messenger-videocall-hangup-options-container',\n\t\t\tbackground: '#22272B',\n\t\t\tcontentBackground: '#22272B',\n\t\t\tdarkMode: true,\n\t\t\tcontentBorderRadius: '6px',\n\t\t\tangle: false,\n\t\t\tbindElement: this.callView.buttons.hangupOptions.elements.root,\n\t\t\ttargetContainer: this.container,\n\t\t\toffsetTop: -15,\n\t\t\tbindOptions: {position: \"top\"},\n\t\t\tcacheable: false,\n\t\t\tsubMenuOptions: {\n\t\t\t\tmaxWidth: 450\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonShow: (event) =>\n\t\t\t\t{\n\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\tpopup.getPopupContainer().style.display = 'block'; // bad hack\n\n\t\t\t\t\tconst offsetLeft = (targetNodeWidth / 2) - popup.getPopupContainer().offsetWidth / 2;\n\t\t\t\t\tpopup.setOffset({offsetLeft: offsetLeft + 40, offsetTop: 0});\n\t\t\t\t\tpopup.setAngle({offset: popup.getPopupContainer().offsetWidth / 2 - 17});\n\t\t\t\t},\n\t\t\t\tonDestroy: () => this.hangupOptionsMenu = null\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t});\n\n\t\tthis.hangupOptionsMenu.show();\n\t}\n\n\t_onCallViewCloseButtonClick()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\t}\n\n\t_onCallViewShowChatButtonClick()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tAnalytics.getInstance().onShowChat({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\tthis.showChat();\n\t}\n\n\t_onCallViewFloorRequestButtonClick()\n\t{\n\t\tAnalytics.getInstance().onFloorRequest({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tconst floorState = this.callView.getUserFloorRequestState(CallEngine.getCurrentUserId());\n\t\tconst talkingState = this.callView.getUserTalking(CallEngine.getCurrentUserId());\n\n\t\tthis.callView.setUserFloorRequestState(CallEngine.getCurrentUserId(), !floorState);\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.requestFloor(!floorState);\n\t\t}\n\n\t\tclearTimeout(this.callViewFloorRequestTimeout);\n\t\tif (talkingState && !floorState)\n\t\t{\n\t\t\tthis.callViewFloorRequestTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.requestFloor(false);\n\t\t\t\t}\n\t\t\t}, 1500);\n\t\t}\n\t}\n\n\t/**\n\t * Returns list of users, that are not currently connected\n\t * @return {Array}\n\t * @private\n\t */\n\t_getDisconnectedUsers()\n\t{\n\t\tconst result = [];\n\t\tconst userStates = this.currentCall.getUsers();\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates[userId] !== UserState.Connected)\n\t\t\t{\n\t\t\t\tconst userData = Util.getUserCached(userId)\n\t\t\t\tif (userData)\n\t\t\t\t{\n\t\t\t\t\tresult.push(userData);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t_closeReconnectionBaloon()\n\t{\n\t\tif (this.reconnectionBaloon)\n\t\t{\n\t\t\tthis.reconnectionBaloon.close();\n\t\t\tthis.reconnectionBaloon = null;\n\t\t}\n\t}\n\n\t_onCallViewInviteUserButtonClick(e)\n\t{\n\t\tif (!this.messengerFacade.showUserSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userStates = this.currentCall ? this.currentCall.getUsers() : {};\n\t\tconst idleUsers = this.currentCall ? this._getDisconnectedUsers() : [];\n\n\t\tthis.messengerFacade.showUserSelector({\n\t\t\tviewElement: this.callView.container,\n\t\t\tbindElement: e.node,\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\t\t\tidleUsers: idleUsers,\n\t\t\tallowNewUsers: Object.keys(userStates).length < Util.getUserLimit() - 1,\n\t\t\tonDestroy: this._onInvitePopupDestroy.bind(this),\n\t\t\tonSelect: this._onInvitePopupSelect.bind(this)\n\t\t}).then((inviteCloser) => {\n\t\t\tthis.invitePopup = inviteCloser;\n\t\t\tthis.callView.setHotKeyTemporaryBlock(true);\n\t\t});\n\t}\n\n\t_onCallViewToggleMuteButtonClick(e)\n\t{\n\t\tAnalytics.getInstance().onToggleMicrophone({\n\t\t\tmuted: e.muted,\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\tif (currentRoom && currentRoom.speaker != this.userId && !e.muted)\n\t\t{\n\t\t\tthis.currentCall.requestRoomSpeaker();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.currentCall.microphoneId && !e.muted)\n\t\t{\n\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t}\n\n\t\tHardware.isMicrophoneMuted = e.muted;\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setAudioMuted(e.muted);\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\t\tif (!e.muted)\n\t\t{\n\t\t\tthis.allowMutePopup = true;\n\t\t}\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordMute(e.muted);\n\t\t}\n\t}\n\n\t_onCallViewRecordButtonClick(event)\n\t{\n\t\tAnalytics.getInstance().onRecordBtnClick({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tif (event.recordState === View.RecordState.Started)\n\t\t{\n\t\t\tconsole.log('test');\n\t\t\tif (this.featureRecord === FeatureState.Limited)\n\t\t\t{\n\t\t\t\tthis.messengerFacade.openHelpArticle('call_record');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.featureRecord === FeatureState.Disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.canRecord())\n\t\t\t{\n\t\t\t\tconst forceRecord = BX.prop.getBoolean(event, \"forceRecord\", View.RecordType.None);\n\t\t\t\tif (forceRecord !== View.RecordType.None)\n\t\t\t\t{\n\t\t\t\t\tthis._startRecordCall(forceRecord);\n\t\t\t\t}\n\t\t\t\telse if (DesktopApi.isDesktop() && DesktopApi.getApiVersion() > 55)\n\t\t\t\t{\n\t\t\t\t\tif (!this.callRecordMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst setIsRecordWhenCopilotActivePopupAlreadyShow = () => {\n\t\t\t\t\t\t\tif (this.currentCall)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.currentCall.isRecordWhenCopilotActivePopupAlreadyShow = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.callRecordMenu = new BX.PopupMenuWindow({\n\t\t\t\t\t\t\tbindElement: event.node,\n\t\t\t\t\t\t\ttargetContainer: this.callView.container,\n\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_RECORD_VIDEO'),\n\t\t\t\t\t\t\t\t\tonclick: (event, item) =>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis._startRecordCall(View.RecordType.Video);\n\t\t\t\t\t\t\t\t\t\titem.getMenuWindow().close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_RECORD_AUDIO'),\n\t\t\t\t\t\t\t\t\tonclick: (event, item) =>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\titem.getMenuWindow().close();\n\n\t\t\t\t\t\t\t\t\t\tif (!this.currentCall)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (this.currentCall.isRecordWhenCopilotActivePopupAlreadyShow || !this.currentCall.isCopilotActive)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis._startRecordCall(View.RecordType.Audio);\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tthis.recordWhenCopilotActivePopup = new RecordWithCopilotPopup({\n\t\t\t\t\t\t\t\t\t\t\tonClose: ()=>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tsetIsRecordWhenCopilotActivePopupAlreadyShow();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.recordWhenCopilotActivePopup = null;\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tonClickNoButton: () =>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tthis._startRecordCall(View.RecordType.Audio);\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\t\t\t\tthis.recordWhenCopilotActivePopup.show();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\tangle: {position: \"top\", offset: 80},\n\t\t\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\t\t\toffsetLeft: -25,\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonPopupClose: () => this.callRecordMenu.destroy(),\n\t\t\t\t\t\t\t\tonPopupDestroy: () => this.callRecordMenu = null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.callRecordMenu.toggle();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.callView.setButtonActive('record', true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (window.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\twindow.BX.Helper.show(\"redirect=detail&code=22079566\");\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (event.recordState === View.RecordState.Paused)\n\t\t{\n\t\t\tif (this.canRecord())\n\t\t\t{\n\t\t\t\tBXDesktopSystem.CallRecordPause(true);\n\t\t\t}\n\t\t}\n\t\telse if (event.recordState === View.RecordState.Resumed)\n\t\t{\n\t\t\tif (this.canRecord())\n\t\t\t{\n\t\t\t\tBXDesktopSystem.CallRecordPause(false);\n\t\t\t}\n\t\t}\n\t\telse if (event.recordState === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.callView.setButtonActive('record', false);\n\t\t}\n\n\t\tthis.currentCall.sendRecordState({\n\t\t\taction: event.recordState,\n\t\t\tdate: new Date()\n\t\t});\n\n\t\tthis.callRecordState = event.recordState;\n\t}\n\n\t_onChangeStateCopilot()\n\t{\n\t\tconst action = !this.currentCall.isCopilotActive ? 'call.Track.start' : 'call.Track.stop';\n\t\tBX.ajax.runAction(action, {\n\t\t\tdata: { callId: this.currentCall.id }\n\t\t}).then(() => {\n\t\t\tconst newCopilotState = !this.currentCall.isCopilotActive;\n\t\t\tthis._onUpdateCallCopilotState(newCopilotState);\n\t\t\tAnalytics.getInstance().copilot.onAIRecordStatusChanged({\n\t\t\t\tisAIOn: newCopilotState,\n\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t});\n\n\t\t\tif (!newCopilotState)\n\t\t\t{\n\t\t\t\tthis.showCopilotResultNotify();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.sendStartCopilotRecordAnalytics();\n\t\t\t}\n\t\t}).catch((error) => {\n\t\t\tconst errorCode = error.errors[0].code;\n\t\t\tCallAI.handleCopilotError(errorCode);\n\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.showCopilotErrorNotify(errorCode);\n\t\t\t}\n\n\t\t\tAnalytics.getInstance().copilot.onAIRecordStatusChanged({\n\t\t\t\tisAIOn: newCopilotState,\n\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\terror: errorCode,\n\t\t\t});\n\t\t\tthis.sendStartCopilotRecordAnalytics(errorCode);\n\t\t});\n\t}\n\n\t_onCallViewCopilotButtonClick()\n\t{\n\t\tif (this.copilotPopup)\n\t\t{\n\t\t\tthis.copilotPopup.close();\n\t\t\treturn;\n\t\t}\n\n\t\tconst isPlainCall = this.currentCall.provider === Provider.Plain;\n\n\t\tif (!isPlainCall && !CallAI.tariffAvailable)\n\t\t{\n\t\t\tUtil.openArticle(CallAI.helpSlider);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.copilotPopup = new CopilotPopup({\n\t\t\tisCopilotActive: this.currentCall.isCopilotActive,\n\t\t\tisCopilotFeaturesEnabled: this.currentCall.isCopilotFeaturesEnabled,\n\t\t\tcallId: this.currentCall.id,\n\t\t\tupdateCopilotState: () => {\n\t\t\t\tthis._onChangeStateCopilot();\n\t\t\t},\n\t\t\tonClose: () => {\n\t\t\t\tthis.copilotPopup = null;\n\t\t\t}\n\t\t});\n\n\t\tif (this.copilotPopup)\n\t\t{\n\t\t\tthis.callView.closeCopilotNotify();\n\t\t\tthis.copilotPopup.toggle();\n\t\t}\n\t}\n\n\t_onUpdateCallCopilotState(isTrackRecordOn)\n\t{\n\t\tthis.currentCall.isCopilotActive = isTrackRecordOn;\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.updateCopilotState(this.currentCall.isCopilotActive);\n\t\t}\n\t}\n\n\t_onSwitchTrackRecordStatus({ isTrackRecordOn, errorCode })\n\t{\n\t\tthis._onUpdateCallCopilotState(isTrackRecordOn);\n\n\t\tif (errorCode)\n\t\t{\n\t\t\tthis.showCopilotNotify(true, errorCode);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (isTrackRecordOn)\n\t\t{\n\t\t\tthis.showCopilotNotify();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.closeCopilotNotify();\n\t\t\tthis.showCopilotResultNotify();\n\t\t}\n\t}\n\n\tshowCopilotNotify(force = false, errorCode = '')\n\t{\n\t\tif (\n\t\t\t(this.currentCall.isCopilotActive || force)\n\t\t\t&& this.currentCall.provider !== Provider.Plain\n\t\t\t&& this.callView\n\t\t)\n\t\t{\n\t\t\tthis.callView.showCopilotNotify(this.currentCall.id, errorCode)\n\t\t}\n\t}\n\n\tshowCopilotResultNotify()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.showCopilotResultNotify()\n\t\t}\n\t}\n\n\tcloseCopilotNotify()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.closeCopilotNotify();\n\t\t}\n\t}\n\n\tsendStartCopilotRecordAnalytics(errorCode = null)\n\t{\n\t\tconst params = {\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t\terrorCode: errorCode,\n\t\t};\n\n\t\tconst userCount = this.getActiveCallUsers().length;\n\t\tif (userCount)\n\t\t{\n\t\t\tparams.userCount = userCount + 1;\n\t\t}\n\t\tAnalytics.getInstance().copilot.onAIRecordStart(params);\n\t}\n\n\t_onCallViewToggleScreenSharingButtonClick()\n\t{\n\t\tAnalytics.getInstance().onScreenShareBtnClick({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tif (this.featureScreenSharing === FeatureState.Limited)\n\t\t{\n\t\t\tthis.messengerFacade.openHelpArticle('call_screen_sharing');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.featureScreenSharing === FeatureState.Disabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t{\n\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t}\n\t\t\tif (this.webScreenSharePopup)\n\t\t\t{\n\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t}\n\t\t\tif (this.documentPromoPopup)\n\t\t\t{\n\t\t\t\tthis.documentPromoPopup.close();\n\t\t\t}\n\t\t\tthis.currentCall.stopScreenSharing();\n\n\t\t\tif (this.isRecording())\n\t\t\t{\n\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.currentCall.startScreenSharing();\n\t\t\tCallEngine.getRestClient().callMethod(\"im.call.onShareScreen\", {callId: this.currentCall.id});\n\t\t}\n\t}\n\n\t_onCallViewToggleVideoButtonClick(e)\n\t{\n\t\tAnalytics.getInstance().onToggleCamera({\n\t\t\tvideo: e.video,\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tHardware.isCameraOn = e.video;\n\t\tif (!Hardware.initialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.video && Object.values(Hardware.cameraList).length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!e.video)\n\t\t{\n\t\t\tthis.callView.releaseLocalMedia();\n\t\t}\n\n\t\tif (!this.currentCall.cameraId && e.video)\n\t\t{\n\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t}\n\t}\n\n\t_onCallViewToggleSpeakerButtonClick(e)\n\t{\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\tif (currentRoom && currentRoom.speaker != this.userId)\n\t\t{\n\t\t\talert(\"only room speaker can turn on sound\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.muteSpeaker(!e.speakerMuted);\n\n\t\tif (e.fromHotKey)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: BX.message(this.callView.speakerMuted ? 'IM_M_CALL_MUTE_SPEAKERS_OFF' : 'IM_M_CALL_MUTE_SPEAKERS_ON'),\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tautoHideDelay: 3000,\n\t\t\t\tcloseButton: true\n\t\t\t});\n\t\t}\n\t}\n\n\t_onCallViewMicrophoneSideIconClick()\n\t{\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\tif (currentRoom)\n\t\t{\n\t\t\tthis.toggleRoomMenu(this.callView.buttons.microphone.elements.icon);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleRoomListMenu(this.callView.buttons.microphone.elements.icon);\n\t\t}\n\t}\n\n\t_onCallViewFeedbackButtonClick()\n\t{\n\t\tBX.loadExt('ui.feedback.form').then(() => {\n\t\t\tBX.UI.Feedback.Form.open({\n\t\t\t\tid: `call_feedback_${this.currentCall.id}-${this.currentCall.instanceId}-${Math.random()}`,\n\t\t\t\tforms: [\n\t\t\t\t\t{ zones: ['ru', 'by', 'kz'], id: 406, sec: '9lhjhn', lang: 'ru' },\n\t\t\t\t\t{ zones: ['de'], id: 754, sec: '6upe49', lang: 'de' },\n\t\t\t\t\t{ zones: ['es'], id: 750, sec: 'whk4la', lang: 'es' },\n\t\t\t\t\t{ zones: ['com.br'], id: 752, sec: 'is01cs', lang: 'com.br' },\n\t\t\t\t\t{ zones: ['en'], id: 748, sec: 'pds0h6', lang: 'en' },\n\t\t\t\t],\n\t\t\t\tpresets: {\n\t\t\t\t\tsender_page: 'call',\n\t\t\t\t\tcall_type: this.currentCall.provider,\n\t\t\t\t\tcall_amount: this.currentCall.users.length + 1,\n\t\t\t\t\tcall_id: `id: ${this.currentCall.id}, instanceId: ${this.currentCall.instanceId}`,\n\t\t\t\t\tid_of_user: this.currentCall.userId,\n\t\t\t\t\tfrom_domain: location.origin\n\t\t\t\t},\n\t\t\t});\n\t\t})\n\t}\n\n\t_onCallViewShowHistoryButtonClick()\n\t{\n\t\tthis.messengerFacade.openHistory(this.currentCall.associatedEntity.id);\n\t}\n\n\t_onCallViewFullScreenButtonClick()\n\t{\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.unfold();\n\t\t}\n\t\tthis.toggleFullScreen();\n\t}\n\n\t_onCallViewDocumentButtonClick()\n\t{\n\t\tthis.sidebar ? this.closeDocumentEditor() : this.showDocumentsMenu();\n\t}\n\n\t_onCallViewReplaceCamera(e)\n\t{\n\t\tif (this.reconnectingCameraId) {\n\t\t\tthis.setReconnectingCameraId(null);\n\t\t}\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.setCameraId(e.deviceId);\n\t\t}\n\n\t\t// update default camera\n\t\tHardware.defaultCamera = e.deviceId;\n\t}\n\n\t_onCallViewReplaceMicrophone(e)\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.setMicrophoneId(e.deviceId)\n\t\t\tthis.callView.setMicrophoneId(e.deviceId);\n\t\t}\n\n\t\t// update default microphone\n\t\tHardware.defaultMicrophone = e.deviceId;\n\t}\n\n\t_onCallViewReplaceSpeaker(e)\n\t{\n\t\tHardware.defaultSpeaker = e.deviceId;\n\t}\n\n\t_onCallViewHasMainStream(e)\n\t{\n\t\tif (this.currentCall && this.currentCall instanceof BitrixCall)\n\t\t{\n\t\t\tthis.currentCall.setMainStream(e.userId);\n\t\t}\n\t}\n\n\t_onCallViewChangeHdVideo(e)\n\t{\n\t\tHardware.preferHdQuality = e.allowHdVideo;\n\t}\n\n\t_onCallViewChangeMicAutoParams(e)\n\t{\n\t\tHardware.enableMicAutoParameters = e.allowMicAutoParams;\n\t}\n\n\t_onCallViewChangeFaceImprove(e)\n\t{\n\t\tif (!DesktopApi.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDesktopApi.setCameraSmoothingStatus(e.faceImproveEnabled);\n\t}\n\n\t_onCallViewOpenAdvancedSettings()\n\t{\n\t\tthis.messengerFacade.openSettings({onlyPanel: 'hardware'});\n\t}\n\n\t_onCallViewSetCentralUser(e)\n\t{\n\t\tif (e.stream && this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindowUser = e.userId;\n\t\t\t//this.floatingWindow.setStream(e.stream);\n\t\t}\n\t}\n\n\t_onCallUserInvited(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.updateCallViewUsers(this.currentCall.id, [e.userId]);\n\t\t\tthis.callView.addUser(e.userId);\n\t\t}\n\t}\n\n\t_onCallDestroy()\n\t{\n\t\tlet callDetails;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tcallDetails = this.#getCallDetail(this.currentCall);\n\t\t\tthis.currentCall = null;\n\t\t}\n\t\tthis.callWithLegacyMobile = false;\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStop();\n\t\t}\n\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\tthis.callRecordType = View.RecordType.None;\n\t\tif (this.callRecordMenu)\n\t\t{\n\t\t\tthis.callRecordMenu.close();\n\t\t}\n\n\t\tif (this.callView && this.autoCloseCallView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tthis.hasStreamFromCall = false;\n\t\tthis._stopLocalStream();\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.close();\n\t\t}\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow(DesktopApi.findWindow('callBackground'));\n\t\t}\n\t\tthis.closePromo();\n\n\t\tthis.allowMutePopup = true;\n\t\tthis.docCreatedForCurrentCall = false;\n\t\tthis._closeReconnectionBaloon();\n\t\tthis._closeParticipantsVideoBaloon();\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\n\t\tthis.emit(Events.onCallDestroyed, {\n\t\t\tcallDetails: callDetails\n\t\t})\n\t}\n\n\tloopConnectionQuality(userId, quality, timeout = 200)\n\t{\n\t\tthis.loopTimers[userId] = setTimeout(() => {\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setUserConnectionQuality(userId, quality);\n\t\t\t\tconst newQuality = quality >= 4 ? 1 : quality + 1;\n\t\t\t\tthis.loopConnectionQuality(userId, newQuality, timeout);\n\t\t\t}\n\t\t}, timeout);\n\t}\n\n\tclearConnectionQualityTimer(userId)\n\t{\n\t\tif (this.loopTimers[userId] !== undefined)\n\t\t{\n\t\t\tclearTimeout(this.loopTimers[userId]);\n\t\t\tdelete this.loopTimers[userId];\n\t\t}\n\t};\n\n\t_onCallUserStateChanged(e)\n\t{\n\t\tsetTimeout(this.updateFloatingWindowContent.bind(this), 100);\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserState(e.userId, e.state);\n\t\t\tif (e.isLegacyMobile)\n\t\t\t{\n\t\t\t\tthis.callView.blockAddUser();\n\t\t\t\tthis.callView.blockSwitchCamera();\n\t\t\t\tthis.callView.blockScreenSharing();\n\t\t\t\tthis.callView.disableMediaSelection();\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\n\t\t\tif (this.currentCall && this.currentCall.provider === Provider.Plain) {\n\t\t\t\tif (e.state === UserState.Connected)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.unblockAddUser();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callView.blockAddUser();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (e.state !== UserState.Connected && this.loopTimers[e.userId] === undefined)\n\t\t{\n\t\t\tthis.loopConnectionQuality(e.userId, 1);\n\t\t}\n\n\t\tif (e.state == UserState.Connecting || e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\t}\n\n\t\tif (e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.clearConnectionQualityTimer(e.userId);\n\t\t\tthis.callView.setUserConnectionQuality(e.userId, 5);\n\n\t\t\tconst unblockButtonsList = [];\n\t\t\tconst isNeedUnblockCameraButton = (this.currentCall instanceof BitrixCall && this.currentCall.isGetUserMediaFulfilled()) || this.currentCall instanceof PlainCall;\n\n\t\t\tif (!e.isLegacyMobile)\n\t\t\t{\n\t\t\t\tunblockButtonsList.push('floorRequest', 'screen');\n\t\t\t}\n\n\t\t\tif (!e.isLegacyMobile && CallAI.serviceEnabled)\n\t\t\t{\n\t\t\t\tunblockButtonsList.push('copilot');\n\t\t\t}\n\n\t\t\tif (!e.isLegacyMobile && isNeedUnblockCameraButton)\n\t\t\t{\n\t\t\t\tunblockButtonsList.push('camera');\n\t\t\t}\n\n\t\t\tif (!!unblockButtonsList.length)\n\t\t\t{\n\t\t\t\tthis.callView.unblockButtons(unblockButtonsList);\n\t\t\t}\n\n\t\t\tif (this.callRecordState === View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\tthis.callView.unblockButtons(['record']);\n\t\t\t}\n\n\t\t\tif (this.currentCall.provider === Provider.Plain) {\n\t\t\t\tthis.callView.unblockAddUser();\n\t\t\t}\n\n\t\t\t/*Util.getUser(e.userId).then(function(userData)\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_CONNECTED\", {\n\t\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t}.bind(this));*/\n\t\t}\n\t\telse if (e.state == UserState.Idle && e.previousState == UserState.Connected)\n\t\t{\n\t\t\t/*Util.getUser(e.userId).then(function(userData)\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_DISCONNECTED\", {\n\t\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t}.bind(this));*/\n\t\t}\n\t\telse if (e.state == UserState.Failed)\n\t\t{\n\t\t\tif (e.networkProblem)\n\t\t\t{\n\t\t\t\tthis.showNetworkProblemNotification(BX.message(\"IM_M_CALL_TURN_UNAVAILABLE\"));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tUtil.getUser(this.currentCall.id, e.userId).then((userData) =>\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_FAILED\", {\n\t\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Declined)\n\t\t{\n\t\t\tUtil.getUser(this.currentCall.id, e.userId).then((userData) =>\n\t\t\t{\n\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_DECLINED\", {\n\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\tname: userData.name\n\t\t\t\t}));\n\t\t\t});\n\t\t}\n\t\telse if (e.state == UserState.Busy)\n\t\t{\n\t\t\tUtil.getUser(this.currentCall.id, e.userId).then((userData) =>\n\t\t\t{\n\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_BUSY\", {\n\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\tname: userData.name\n\t\t\t\t}));\n\t\t\t});\n\t\t}\n\t}\n\n\t_onCallUserMicrophoneState(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.userId == this.userId)\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = !e.microphoneState;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setUserMicrophoneState(e.userId, e.microphoneState);\n\t\t}\n\t}\n\n\t_onCallUserCameraState(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.callView.setUserCameraState(e.userId, e.cameraState);\n\t}\n\n\t_onNeedResetMediaDevicesState(e)\n\t{\n\t\tconsole.log('_onNeedResetMediaDevicesState');\n\t\tHardware.isMicrophoneMuted = true;\n\t\tHardware.isCameraOn = false;\n\n\t\tif (this.mediaDevicesResetStateHintBaloon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaDevicesResetStateHintBaloon = BX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(BX.message('CALL_MEDIA_DEVICES_RESET_STATE_HINT')),\n\t\t\tautoHide: false,\n\t\t\tposition: \"top-right\",\n\t\t\tcloseButton: true,\n\t\t});\n\t}\n\n\t_onCameraPublishing(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.publishing)\n\t\t{\n\t\t\tthis.callView.blockSwitchCamera();\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.unblockSwitchCamera();\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t}\n\n\t_onMicrophonePublishingd(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.publishing)\n\t\t{\n\t\t\tthis.callView.blockSwitchMicrophone();\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.unblockSwitchMicrophone();\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t}\n\n\t_onCallUserVideoPaused(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.callView.setUserVideoPaused(e.userId, e.videoPaused);\n\t}\n\n\t_onCallLocalMediaReceived(e)\n\t{\n\t\tthis.log(\"Received local media stream \" + e.tag);\n\t\tthis.hasStreamFromCall = true;\n\t\tif (this.callView)\n\t\t{\n\t\t\tconst flipVideo = (e.tag == \"main\" || e.mediaRenderer) ? Hardware.enableMirroring : false;\n\n\t\t\tthis.callView.setLocalStream(e);\n\t\t\tthis.callView.flipLocalVideo(flipVideo);\n\n\t\t\tthis.callView.setButtonActive(\"screen\", this.currentCall.isScreenSharingStarted());\n\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t{\n\t\t\t\tthis.screenShareStartTime = new Date();\n\t\t\t\tAnalytics.getInstance().onScreenShareStarted({\n\t\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t});\n\n\t\t\t\tif (!DesktopApi.isDesktop())\n\t\t\t\t{\n\t\t\t\t\tthis.showWebScreenSharePopup();\n\t\t\t\t}\n\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().onScreenShareStopped({\n\t\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\tscreenShareLength: Util.getTimeInSeconds(this.screenShareStartTime),\n\t\t\t\t});\n\t\t\t\tthis.screenShareStartTime = null;\n\n\t\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t\t}\n\t\t\t\tif (this.webScreenSharePopup)\n\t\t\t\t{\n\t\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t\t}\n\t\t\t\tif (this.isRecording())\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.currentCall.callFromMobile)\n\t\t\t{\n\t\t\t\tthis.callView.unblockSwitchCamera();\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\n\t\t\tif (this.localStream)\n\t\t\t{\n\t\t\t\tthis._stopLocalStream();\n\t\t\t}\n\t\t}\n\n\t\tif (this.currentCall && Hardware.isCameraOn && e.tag === 'main' && e.stream.getVideoTracks().length === 0)\n\t\t{\n\t\t\tif (this.currentCall.canChangeMediaDevices())\n\t\t\t{\n\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_CAMERA_ERROR_FALLBACK_TO_MIC\"));\n\t\t\t}\n\t\t\tHardware.isCameraOn = false;\n\t\t}\n\t}\n\n\t_onCallLocalCameraFlip(e)\n\t{\n\t\tthis._onCallLocalCameraFlipInDesktop(e.data.enableMirroring);\n\t}\n\n\t_onCallLocalCameraFlipInDesktop(e)\n\t{\n\t\tconsole.error('FLIPPING LOCAL VIDEO');\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.flipLocalVideo(e);\n\t\t}\n\t}\n\n\t_onCallLocalMediaStopped(e)\n\t{\n\t\t// do nothing\n\t}\n\n\t_onCallRemoteMediaReceived(e)\n\t{\n\t\tconst getStreamType = (stream) =>\n\t\t{\n\t\t\tif (stream?.getVideoTracks()?.length)\n\t\t\t{\n\t\t\t\treturn 'video';\n\t\t\t}\n\n\t\t\tif (stream?.getAudioTracks()?.length)\n\t\t\t{\n\t\t\t\treturn 'audio';\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tif ('track' in e)\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, e.kind, e.track)\n\t\t\t}\n\t\t\tif ('mediaRenderer' in e && e.mediaRenderer.kind === 'audio' && getStreamType(e.mediaRenderer.stream) === 'audio')\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, 'audio', e.mediaRenderer.stream.getAudioTracks()[0]);\n\t\t\t}\n\t\t\tif ('mediaRenderer' in e && e.mediaRenderer.kind === 'sharingAudio' && getStreamType(e.mediaRenderer.stream) === 'audio')\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, 'sharingAudio', e.mediaRenderer.stream.getAudioTracks()[0]);\n\t\t\t}\n\t\t\tif ('mediaRenderer' in e && (e.mediaRenderer.kind === 'video' || e.mediaRenderer.kind === 'sharing') && getStreamType(e.mediaRenderer.stream) === 'video')\n\t\t\t{\n\t\t\t\tthis.callView.setVideoRenderer(e.userId, e.mediaRenderer);\n\t\t\t}\n\t\t}\n\t}\n\n\t_onCallRemoteMediaStopped(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tif ('mediaRenderer' in e)\n\t\t\t{\n\t\t\t\tif (e.kind === 'video' || e.kind === 'sharing')\n\t\t\t\t{\n\t\t\t\t\te.mediaRenderer.stream = null;\n\t\t\t\t\tthis.callView.setVideoRenderer(e.userId, e.mediaRenderer);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, e.kind, null);\n\t\t\t}\n\t\t}\n\t}\n\n\t_prepareLocalStream(fallback = false)\n\t{\n\t\tconst video = {};\n\n\t\tif (Hardware.defaultCamera)\n\t\t{\n\t\t\tvideo.deviceId = { exact: Hardware.defaultCamera };\n\t\t}\n\n\t\tif (!fallback)\n\t\t{\n\t\t\tvideo.width = { ideal: 1280 };\n\t\t\tvideo.height = { ideal: 720 };\n\t\t}\n\n\t\tconst constraints = { audio: false, video };\n\t\tnavigator.mediaDevices.getUserMedia(constraints)\n\t\t\t.then((stream) =>\n\t\t\t{\n\t\t\t\tthis.localStream = stream;\n\n\t\t\t\tif (!this.initCallPromise)\n\t\t\t\t{\n\t\t\t\t\tthis._stopLocalStream();\n\t\t\t\t}\n\t\t\t\telse if (this.callView)\n\t\t\t\t{\n\t\t\t\t\tconst streamData = {\n\t\t\t\t\t\tstream,\n\t\t\t\t\t\ttag: 'main',\n\t\t\t\t\t\tflipVideo: Hardware.enableMirroring,\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.callView.setLocalStream(streamData);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tthis.log(`Attempt to get video (fallback: ${!!fallback}) for call before it has been created failed`, error);\n\t\t\t\tif (!fallback)\n\t\t\t\t{\n\t\t\t\t\tthis._prepareLocalStream(true);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t_stopLocalStream()\n\t{\n\t\tif (this.localStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.localStream);\n\t\t\tthis.localStream = null;\n\t\t}\n\t}\n\n\t_onCallBadNetworkIndicator(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setBadNetworkIndicator(e.userId, e.badNetworkIndicator);\n\t\t}\n\t}\n\n\t_onCallConnectionQualityChanged(e)\n\t{\n\t\tthis.clearConnectionQualityTimer(e.userId);\n\n\t\tthis.callView.setUserConnectionQuality(e.userId, e.score);\n\t}\n\n\t_onCallToggleRemoteParticipantVideo(e)\n\t{\n\t\tif (this.toogleParticipantsVideoBaloon)\n\t\t{\n\t\t\tif (e.isVideoShown)\n\t\t\t{\n\t\t\t\tthis._closeParticipantsVideoBaloon();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!e.isVideoShown)\n\t\t{\n\t\t\tthis.toogleParticipantsVideoBaloon = BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(BX.message('IM_M_CALL_REMOTE_PARTICIPANTS_VIDEO_MUTED')),\n\t\t\t\tautoHide: false,\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tcloseButton: false,\n\t\t\t})\n\t\t}\n\t}\n\n\t_closeParticipantsVideoBaloon()\n\t{\n\t\tif (this.toogleParticipantsVideoBaloon)\n\t\t{\n\t\t\tthis.toogleParticipantsVideoBaloon.close();\n\t\t\tthis.toogleParticipantsVideoBaloon = null;\n\t\t}\n\t}\n\n\t_onCallUserVoiceStarted(e)\n\t{\n\t\tif (e.local)\n\t\t{\n\t\t\tif (this.currentCall.muted && this.isMutedPopupAllowed())\n\t\t\t{\n\t\t\t\tthis.showMicMutedNotification();\n\t\t\t}\n\n\t\t\tif (this.currentCall.muted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.talkingUsers[e.userId] = true;\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserTalking(e.userId, true);\n\t\t\tthis.callView.setUserFloorRequestState(e.userId, false);\n\t\t}\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setTalking(Object.keys(this.talkingUsers).map(function (id)\n\t\t\t{\n\t\t\t\treturn Number(id);\n\t\t\t}));\n\t\t}\n\t}\n\n\t_onCallUserVoiceStopped(e)\n\t{\n\t\tif (this.talkingUsers[e.userId])\n\t\t{\n\t\t\tdelete this.talkingUsers[e.userId];\n\t\t}\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserTalking(e.userId, false);\n\t\t}\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setTalking(Object.keys(this.talkingUsers).map(function (id)\n\t\t\t{\n\t\t\t\treturn Number(id);\n\t\t\t}));\n\t\t}\n\t}\n\n\t_onUserStatsReceived(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserStats(e.userId, e.report);\n\t\t}\n\t}\n\n\t_onCallUserScreenState(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserScreenState(e.userId, e.screenState);\n\t\t}\n\t\tif (e.userId == CallEngine.getCurrentUserId())\n\t\t{\n\t\t\tthis.callView.setButtonActive(\"screen\", e.screenState);\n\t\t\tif (e.screenState)\n\t\t\t{\n\t\t\t\tif (!DesktopApi.isDesktop())\n\t\t\t\t{\n\t\t\t\t\tthis.showWebScreenSharePopup();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t\t}\n\t\t\t\tif (this.webScreenSharePopup)\n\t\t\t\t{\n\t\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t\t}\n\t\t\t\tif (this.isRecording())\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t}\n\n\t_onCallUserRecordState(event)\n\t{\n\t\tconsole.warn('_onCallUserRecordState', event);\n\t\tthis.callRecordState = event.recordState.state;\n\t\tthis.callView.setRecordState(event.recordState);\n\n\t\tif (event.recordState.state !== View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.callRecordInfo = event.recordState;\n\t\t}\n\n\t\tif (!this.canRecord() || event.userId != BX.message['USER_ID'])\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (\n\t\t\tevent.recordState.state === View.RecordState.Started\n\t\t\t&& event.recordState.userId == BX.message['USER_ID']\n\t\t)\n\t\t{\n\t\t\tconst windowId = View.RecordSource.Chat;\n\t\t\tconst dialogId = this.currentCall.associatedEntity.id;\n\t\t\tconst dialogName = this.currentCall.associatedEntity.name;\n\t\t\tconst callId = this.currentCall.id;\n\t\t\tconst callDate = BX.date.format(this.formatRecordDate);\n\n\t\t\tlet fileName = BX.message('IM_CALL_RECORD_NAME');\n\t\t\tif (fileName)\n\t\t\t{\n\t\t\t\tfileName = fileName\n\t\t\t\t\t.replace('#CHAT_TITLE#', dialogName)\n\t\t\t\t\t.replace('#CALL_ID#', callId)\n\t\t\t\t\t.replace('#DATE#', callDate)\n\t\t\t\t;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfileName = \"call_record_\" + this.currentCall.id;\n\t\t\t}\n\n\t\t\tCallEngine.getRestClient().callMethod(\"im.call.onStartRecord\", {callId: this.currentCall.id});\n\n\t\t\tAnalytics.getInstance().onRecordStart({\n\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t});\n\n\t\t\tconsole.error('DIALOG ID', dialogId);\n\t\t\tBXDesktopSystem.CallRecordStart({\n\t\t\t\twindowId: windowId,\n\t\t\t\tfileName: fileName,\n\t\t\t\tcallId: callId,\n\t\t\t\tcallDate: callDate,\n\t\t\t\tdialogId: dialogId,\n\t\t\t\tdialogName: dialogName,\n\t\t\t\tvideo: this.callRecordType !== View.RecordType.Audio,\n\t\t\t\tmuted: Hardware.isMicrophoneMuted,\n\t\t\t\tcropTop: 72,\n\t\t\t\tcropBottom: 90,\n\t\t\t\tshareMethod: 'im.disk.record.share'\n\t\t\t});\n\t\t}\n\t\telse if (event.recordState.state === View.RecordState.Stopped)\n\t\t{\n\t\t\tAnalytics.getInstance().onRecordStop({\n\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tsubSection: Analytics.AnalyticsSubSection.window,\n\t\t\t\telement: Analytics.AnalyticsElement.recordButton,\n\t\t\t\trecordTime: Util.getRecordTimeText(this.callRecordInfo, true),\n\t\t\t});\n\t\t\tthis.callRecordInfo = null;\n\t\t\tBXDesktopSystem.CallRecordStop();\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t_onCallUserFloorRequest(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserFloorRequestState(e.userId, e.requestActive);\n\t\t}\n\t}\n\n\t_onCallFailure(e)\n\t{\n\t\tconst errorCode = e.code || e.name || e.error;\n\n\t\tlet errorMessage;\n\n\t\tif (e.name == \"VoxConnectionError\" || e.name == \"AuthResult\")\n\t\t{\n\t\t\tUtil.reportConnectionResult(e.call.id, false);\n\t\t}\n\n\t\tif (e.name == \"AuthResult\" || errorCode == \"AUTHORIZE_ERROR\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_AUTHORIZATION\");\n\t\t}\n\t\telse if (e.name == \"Failed\" && errorCode == 403)\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_HARDWARE_ACCESS_DENIED\");\n\t\t}\n\t\telse if (errorCode == \"ERROR_UNEXPECTED_ANSWER\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_UNEXPECTED_ANSWER\");\n\t\t}\n\t\telse if (errorCode == \"BLANK_ANSWER_WITH_ERROR_CODE\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_BLANK_ANSWER\");\n\t\t}\n\t\telse if (errorCode == \"BLANK_ANSWER\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_BLANK_ANSWER\");\n\t\t}\n\t\telse if (errorCode == \"ACCESS_DENIED\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_ACCESS_DENIED\");\n\t\t}\n\t\telse if (errorCode == \"NO_WEBRTC\")\n\t\t{\n\t\t\terrorMessage = this.isHttps ? BX.message(\"IM_CALL_NO_WEBRT\") : BX.message(\"IM_CALL_ERROR_HTTPS_REQUIRED\");\n\t\t}\n\t\telse if (errorCode == \"UNKNOWN_ERROR\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_UNKNOWN\");\n\t\t}\n\t\telse if (errorCode == \"NETWORK_ERROR\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_NETWORK\");\n\t\t}\n\t\telse if (errorCode == \"NotAllowedError\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_HARDWARE_ACCESS_DENIED\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//errorMessage = BX.message(\"IM_CALL_ERROR_HARDWARE_ACCESS_DENIED\");\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_UNKNOWN_WITH_CODE\").replace(\"#ERROR_CODE#\", errorCode);\n\t\t}\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.showFatalError({text: errorMessage});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showNotification(errorMessage);\n\t\t}\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.autoCloseCallView = false;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\n\t\t\tif (this.currentCallIsNew)\n\t\t\t{\n\t\t\t\tCallEngine.getRestClient().callMethod('im.call.interrupt', {callId: this.currentCall.id});\n\t\t\t}\n\n\t\t\tthis.currentCall.destroy();\n\t\t\tthis.currentCall = null;\n\t\t\tthis.currentCallIsNew = false;\n\t\t}\n\n\t\tHardware.isMicrophoneMuted = false;\n\t}\n\n\t_onNetworkProblem()\n\t{\n\t\tthis.showNetworkProblemNotification(BX.message(\"IM_M_CALL_TURN_UNAVAILABLE\"));\n\t}\n\n\t_onMicrophoneLevel(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setMicrophoneLevel(e.level)\n\t\t}\n\t}\n\n\t_onReconnecting(e)\n\t{\n\t\tif (!(this.currentCall instanceof BitrixCall || this.currentCall instanceof PlainCall))\n\t\t{\n\t\t\t// todo: restore after fixing balloon resurrection issue\n\t\t\t// related to multiple simultaneous calls to the balloon manager\n\t\t\t// now it's enabled for Bitrix24 calls as a temp solution\n\t\t\treturn false;\n\t\t}\n\n\t\tAnalytics.getInstance().onReconnect({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t\treconnectionEventCount: e.reconnectionEventCount\n\t\t});\n\n\t\t// noinspection UnreachableCodeJS\n\t\tif (this.reconnectionBaloon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reconnectionBaloon = BX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(BX.message('IM_CALL_RECONNECTING')),\n\t\t\tautoHide: false,\n\t\t\tposition: \"top-right\",\n\t\t\tcloseButton: false,\n\t\t})\n\t}\n\n\t_onReconnected()\n\t{\n\t\tthis.setReconnectingCameraId(this.lastUsedCameraId)\n\t\tif (!(this.currentCall instanceof BitrixCall || this.currentCall instanceof PlainCall))\n\t\t{\n\t\t\t// todo: restore after fixing balloon resurrection issue\n\t\t\t// related to multiple simultaneous calls to the balloon manager\n\t\t\t// now it's enabled for Bitrix24 calls as a temp solution\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection UnreachableCodeJS\n\t\tthis._closeReconnectionBaloon();\n\t}\n\n\t_onCustomMessage(event)\n\t{\n\t\t// there will be no more template selector in this call\n\t\tif (event.message === DOC_CREATED_EVENT)\n\t\t{\n\t\t\tthis.docCreatedForCurrentCall = true;\n\t\t\tthis.maxEditorWidth = DOC_EDITOR_WIDTH;\n\t\t}\n\t}\n\n\t_onJoinRoomOffer(event)\n\t{\n\t\tconsole.log(\"_onJoinRoomOffer\", event)\n\t\tif (!event.initiator && !this.currentCall.currentRoom())\n\t\t{\n\t\t\tthis.currentCall.joinRoom(event.roomId);\n\t\t\tthis.showRoomJoinedPopup(true, event.speaker == this.userId, event.users);\n\t\t}\n\t}\n\n\t_onJoinRoom(event)\n\t{\n\t\tconsole.log(\"_onJoinRoom\", event)\n\t\tif (event.speaker == this.userId)\n\t\t{\n\t\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\tthis.callView.muteSpeaker(true);\n\n\t\t\tthis.callView.setRoomState(View.RoomState.NonSpeaker);\n\t\t}\n\t}\n\n\t_onLeaveRoom()\n\t{\n\t\t// this.callView.setRoomState(View.RoomState.None);\n\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\t\tthis.callView.muteSpeaker(false);\n\t}\n\n\t_onTransferRoomSpeaker(event)\n\t{\n\t\tconsole.log(\"_onTransferRoomSpeaker\", event);\n\t\tif (event.speaker == this.userId)\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = false;\n\t\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\n\t\t\tif (event.initiator == this.userId)\n\t\t\t{\n\t\t\t\tthis.callView.muteSpeaker(false);\n\t\t\t\tthis.showMicTakenFromPopup(event.previousSpeaker);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\tthis.callView.muteSpeaker(true);\n\t\t\tthis.callView.setRoomState(View.RoomState.NonSpeaker);\n\n\t\t\tthis.showMicTakenByPopup(event.speaker);\n\t\t}\n\t}\n\n\t_onCallJoin(e)\n\t{\n\t\tif (e.local)\n\t\t{\n\t\t\t// self answer\n\t\t\tif (this.currentCall && (this.currentCall instanceof VoximplantCall))\n\t\t\t{\n\t\t\t\tUtil.reportConnectionResult(this.currentCall.id, true);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\t// remote answer, stop ringing and hide incoming cal notification\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.currentCall = null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\t}\n\n\t_onCallLeave(e)\n\t{\n\t\tconsole.log(\"_onCallLeave\", e);\n\t\tHardware.isMicrophoneMuted = false;\n\t\tif (!e.local && this.currentCall && this.currentCall.ready)\n\t\t{\n\t\t\tthis.log(new Error(\"received remote leave with active call!\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStop();\n\t\t}\n\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\tthis.callRecordType = View.RecordType.None;\n\t\tthis.docCreatedForCurrentCall = false;\n\t\tlet callDetails;\n\n\t\tif (!this.getActiveCallUsers().length)\n\t\t{\n\t\t\tAnalytics.getInstance().onFinishCall({\n\t\t\t\tcallId: this.currentCall.id,\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tstatus: Analytics.AnalyticsStatus.lastUserLeft,\n\t\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t\t\tcallUsersCount: this.getMaxActiveCallUsers().length,\n\t\t\t\tcallLength: Util.getTimeInSeconds(this.currentCall.startDate),\n\t\t\t});\n\t\t}\n\n\t\tif (this.currentCall && this.currentCall.associatedEntity)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\n\t\t\tcallDetails = this.#getCallDetail(this.currentCall);\n\t\t\tthis.currentCall = null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tthis.hasStreamFromCall = false;\n\t\tthis._stopLocalStream();\n\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.close();\n\t\t}\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\t\tthis.allowMutePopup = true;\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow(DesktopApi.findWindow('callBackground'));\n\t\t}\n\n\t\tthis.closePromo();\n\n\t\tthis._closeReconnectionBaloon();\n\t\tthis._closeParticipantsVideoBaloon();\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\n\t\tthis.emit(Events.onCallLeft, {\n\t\t\tcallDetails: callDetails\n\t\t})\n\t}\n\n\t_onGetUserMediaEnded()\n\t{\n\t\tHardware.getCurrentDeviceList();\n\t}\n\n\t_onUpdateLastUsedCameraId()\n\t{\n\t\tconst cameraId = this.currentCall.cameraId;\n\n\t\tif (cameraId)\n\t\t{\n\t\t\tthis.lastUsedCameraId = cameraId;\n\t\t}\n\t}\n\n\t#getCallDetail(call)\n\t{\n\t\treturn {\n\t\t\tid: call.id,\n\t\t\tprovider: call.provider,\n\t\t\tchatId: call.associatedEntity.id,\n\t\t\tuserCount: call.users.length,\n\t\t\tbrowser: Util.getBrowserForStatistics(),\n\t\t\tisMobile: Browser.isMobile(),\n\t\t\tisConference: false,\n\t\t\twasConnected: call.wasConnected\n\t\t};\n\t}\n\n\t_onInvitePopupDestroy()\n\t{\n\t\tthis.invitePopup = null;\n\t\tthis.callView.setHotKeyTemporaryBlock(false);\n\t}\n\n\t_onInvitePopupSelect(e: {users: UserData})\n\t{\n\t\tthis.invitePopup.close();\n\n\t\tconst userIds = e.users.map((user) => user.id);\n\n\t\tif (!this.currentCall || !userIds.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tAnalytics.getInstance().onInviteUser({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t});\n\n\t\tif (Util.isCallServerAllowed() && this.currentCall instanceof PlainCall)\n\t\t{\n\t\t\t// trying to switch to the server version of the call\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t{\n\t\t\t\tthis.currentCall.stopScreenSharing();\n\t\t\t}\n\t\t\tCallEngine.createChildCall(\n\t\t\t\tthis.currentCall.id,\n\t\t\t\tUtil.getConferenceProvider(),\n\t\t\t\tuserIds,\n                { debug: this.debug },\n\t\t\t).then((e) =>\n\t\t\t{\n\t\t\t\tthis.childCall = e.call;\n\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstMediaHandler);\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\n\t\t\t\tthis.childCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (this.currentCall.microphoneId)\n\t\t\t\t{\n\t\t\t\t\tthis.childCall.setMicrophoneId(this.currentCall.microphoneId);\n\t\t\t\t}\n\t\t\t\tif (this.currentCall.cameraId)\n\t\t\t\t{\n\t\t\t\t\tthis.childCall.setCameraId(this.currentCall.cameraId);\n\t\t\t\t}\n\n\t\t\t\tthis.childCall.inviteUsers({\n\t\t\t\t\tusers: this.childCall.users,\n\t\t\t\t\tshow: true,\n\t\t\t\t});\n\n\t\t\t\tthis.callView.updateCopilotFeatureState(this.childCall?.isCopilotFeaturesEnabled);\n\t\t\t});\n\n\t\t\tthis.callView.removeScreenUsers();\n\t\t\tconst userData = {};\n\t\t\te.users.forEach((user) => {\n\t\t\t\tthis.callView.addUser(user.id, UserState.Calling);\n\t\t\t\tuserData[user.id] = user;\n\t\t\t});\n\t\t\tthis.callView.updateUserData(userData);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentUsers = this.currentCall.getUsers();\n\t\t\tconst usersToInvite = [];\n\t\t\tlet totalUsers = Object.keys(currentUsers).length;\n\n\t\t\tuserIds.forEach((userId) =>\n\t\t\t{\n\t\t\t\tif (totalUsers < Util.getUserLimit() - 1 || currentUsers.hasOwnProperty(userId))\n\t\t\t\t{\n\t\t\t\t\ttotalUsers++;\n\t\t\t\t\tusersToInvite.push(userId);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (usersToInvite.length)\n\t\t\t{\n\t\t\t\tthis.currentCall.inviteUsers({\n\t\t\t\t\tusers: usersToInvite,\n\t\t\t\t\tshow: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t_onWindowFocus()\n\t{\n\t\tif (!this.detached)\n\t\t{\n\t\t\tclearTimeout(this.showFloatingWindowTimeout);\n\t\t\tclearTimeout(this.showFloatingScreenShareWindowTimeout);\n\t\t\tif (this.floatingWindow)\n\t\t\t{\n\t\t\t\tthis.floatingWindow.hide();\n\t\t\t}\n\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.hide();\n\t\t\t}\n\t\t}\n\t}\n\n\t_onWindowBlur()\n\t{\n\t\tclearTimeout(this.showFloatingWindowTimeout);\n\t\tclearTimeout(this.showFloatingScreenShareWindowTimeout);\n\t\tif (this.currentCall && this.floatingWindow && this.callView)\n\t\t{\n\t\t\tthis.showFloatingWindowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall && this.floatingWindow && this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\t\t\t\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t\t\t\t\tthis.floatingWindow.show();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, 300);\n\t\t}\n\n\t\tif (this.currentCall && this.floatingScreenShareWindow && this.callView && this.currentCall.isScreenSharingStarted())\n\t\t{\n\t\t\tthis.showFloatingScreenShareWindowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall && this.floatingScreenShareWindow && this.callView && this.currentCall.isScreenSharingStarted())\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.show();\n\t\t\t\t}\n\t\t\t}, 300);\n\t\t}\n\t}\n\n\t_onBeforeUnload(e)\n\t{\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.hasActiveCall())\n\t\t{\n\t\t\te.preventDefault();\n\t\t\te.returnValue = '';\n\t\t}\n\t}\n\n\t_onImTabChange(currentTab)\n\t{\n\t\tif (currentTab === \"notify\" && this.currentCall && this.callView)\n\t\t{\n\t\t\tthis.fold(Text.decode(this.currentCall.associatedEntity.name));\n\t\t}\n\t}\n\n\t_onUpdateChatCounter(counter)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.associatedEntity || !this.currentCall.associatedEntity.id || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.setButtonCounter(\"chat\", counter);\n\t}\n\n\t_onDeviceChange(e)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst allAddedDevice = e.data.added;\n\t\tconst allRemovedDevice = e.data.removed\n\t\tconst removed = Hardware.getRemovedUsedDevices(\n\t\t\te.data.removed,\n\t\t\t{\n\t\t\t\tmicrophoneId: this.currentCall.microphoneId,\n\t\t\t\tcameraId: this.currentCall.cameraId,\n\t\t\t\tspeakerId: this.callView.speakerId,\n\t\t\t}\n\t\t);\n\n\t\tthis.log(\"New devices: \", allAddedDevice);\n\t\tif (allAddedDevice)\n\t\t{\n\t\t\tsetTimeout(() => this.useDevicesInCurrentCall(allAddedDevice), 500);\n\t\t}\n\n\t\tthis.log(\"Removed devices: \", allRemovedDevice);\n\t\tif (removed.length > 0)\n\t\t{\n\t\t\tthis.log(\"Removed devices: \", removed);\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: BX.message(\"IM_CALL_DEVICES_DETACHED\") + \"<br><ul>\" + removed.map(function (deviceInfo)\n\t\t\t\t{\n\t\t\t\t\treturn \"<li>\" + deviceInfo.label\n\t\t\t\t}) + \"</ul>\",\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tautoHideDelay: 10000,\n\t\t\t\tcloseButton: true,\n\t\t\t\t//category: \"call-device-change\",\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: BX.message(\"IM_CALL_DEVICES_CLOSE\"),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function (event, balloon)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\n\t\tif (allRemovedDevice)\n\t\t{\n\t\t\tsetTimeout(() => this.removeDevicesFromCurrentCall(allRemovedDevice), 500);\n\t\t}\n\t}\n\n\t_onFloatingVideoMainAreaClick()\n\t{\n\t\tDesktopApi.activateWindow();\n\t\tDesktopApi.changeTab(\"im\");\n\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id)\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t}\n\t\telse if (!this.messengerFacade.isMessengerOpen())\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger();\n\t\t}\n\n\t\tif (this.detached)\n\t\t{\n\t\t\tthis.container.style.removeProperty('width');\n\t\t\tthis.callView.show();\n\t\t\tthis.detached = false;\n\t\t}\n\t}\n\n\t_onFloatingVideoButtonClick(e)\n\t{\n\t\tswitch (e.buttonName)\n\t\t{\n\t\t\tcase \"toggleMute\":\n\t\t\t\tthis._onCallViewToggleMuteButtonClick(e);\n\t\t\t\tbreak;\n\t\t\tcase \"hangup\":\n\t\t\t\tthis._onCallViewHangupButtonClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onFloatingScreenShareBackToCallClick()\n\t{\n\t\tDesktopApi.activateWindow();\n\t\tDesktopApi.changeTab(\"im\");\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.hide();\n\t\t}\n\t}\n\n\t_onFloatingScreenShareStopClick()\n\t{\n\t\tDesktopApi.activateWindow();\n\t\tDesktopApi.changeTab(\"im\");\n\n\t\tthis.currentCall.stopScreenSharing();\n\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t}\n\t}\n\n\t_onFloatingScreenShareChangeScreenClick()\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.startScreenSharing(true);\n\t\t}\n\t}\n\n\t_onResize()\n\t{\n\t\tif (this.sidebar && this.callView)\n\t\t{\n\t\t\tconst result = this.findCallEditorWidth();\n\t\t\tconst callWidth = result.callWidth;\n\t\t\tconst editorWidth = result.editorWidth;\n\n\t\t\tthis.callView.setMaxWidth(callWidth);\n\t\t\tthis.sidebar.setWidth(editorWidth);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.destroy();\n\t\t\tthis.floatingWindow = null;\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.destroy();\n\t\t\tthis.floatingScreenShareWindow = null;\n\t\t}\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.disconnect();\n\t\t\tthis.resizeObserver = null;\n\t\t}\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipHandler);\n\t}\n\n\tlog()\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tlet arr = [this.currentCall.id];\n\n\t\t\tCallEngine.log.apply(CallEngine, arr.concat(Array.prototype.slice.call(arguments)));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tCallEngine.log.apply(CallEngine, arguments);\n\t\t}\n\t}\n\n\ttest(users = [473, 464], videoOptions = {width: 320, height: 180}, audioOptions = false)\n\t{\n\t\tthis.messengerFacade.openMessenger().then(() =>\n\t\t{\n\t\t\treturn (videoOptions || audioOptions) ? Hardware.init() : null;\n\t\t}).then(() =>\n\t\t{\n\t\t\tthis.createContainer();\n\t\t\tlet hiddenButtons = ['floorRequest'];\n\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t{\n\t\t\t\thiddenButtons.push('document');\n\t\t\t}\n\n\t\t\tthis.callView = new View({\n\t\t\t\tcontainer: this.container,\n\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\tshowChatButtons: true,\n\t\t\t\tuserLimit: 48,\n\t\t\t\tlanguage: this.language,\n\t\t\t\tlayout: View.Layout.Grid,\n\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\tblockedButtons: this.getBlockedButtons(),\n\t\t\t});\n\n\t\t\tthis.lastUserId = 1;\n\n\t\t\tthis.callView.setCallback('onButtonClick', (e) => this._onTestCallViewButtonClick(e));\n\t\t\t//this.callView.blockAddUser();\n\t\t\tthis.callView.setCallback(View.Event.onUserClick, (e) =>\n\t\t\t{\n\t\t\t\tif (!e.stream)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setUserState(e.userId, UserState.Connected);\n\t\t\t\t\tthis.callView.setUserMedia(e.userId, 'video', this.stream2.getVideoTracks()[0]);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.callView.setUiState(View.UiState.Connected);\n\t\t\tthis.callView.setCallback(View.Event.onBodyClick, this._onCallViewBodyClick.bind(this));\n\t\t\tthis.callView.setCallback('onShow', this._onCallViewShow.bind(this));\n\t\t\tthis.callView.setCallback('onClose', this._onCallViewClose.bind(this));\n\t\t\tthis.callView.setCallback('onReplaceMicrophone', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceMicrophone\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback('onReplaceCamera', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceCamera\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback('onReplaceSpeaker', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceSpeaker\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback(View.Event.onOpenAdvancedSettings,  (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(\"onOpenAdvancedSettings\", e);\n\t\t\t\tthis._onCallViewOpenAdvancedSettings()\n\t\t\t});\n\t\t\tthis.callView.show();\n\n\t\t\tif (audioOptions || videoOptions)\n\t\t\t{\n\t\t\t\treturn navigator.mediaDevices.getUserMedia({\n\t\t\t\t\taudio: audioOptions,\n\t\t\t\t\tvideo: videoOptions,\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn new MediaStream();\n\t\t\t}\n\n\t\t}).then((s) =>\n\t\t{\n\t\t\tthis.stream = s;\n\t\t\tconst streamData = {\n\t\t\t\tstream: this.stream,\n\t\t\t};\n\t\t\tthis.callView.setLocalStream(streamData);\n\t\t\tusers.forEach(userId => this.callView.addUser(userId, UserState.Connected));\n\n\t\t\tif (audioOptions !== false)\n\t\t\t{\n\t\t\t\tthis.vad = new SimpleVAD({\n\t\t\t\t\tmediaStream: this.stream\n\t\t\t\t});\n\t\t\t\tsetInterval(() => this.callView.setMicrophoneLevel(this.vad.currentVolume), 100)\n\t\t\t}\n\n\t\t\tif (videoOptions)\n\t\t\t{\n\t\t\t\treturn navigator.mediaDevices.getUserMedia({\n\t\t\t\t\taudio: false,\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\twidth: 320,\n\t\t\t\t\t\theight: 180\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn new MediaStream();\n\t\t\t}\n\n\t\t}).then((s2) =>\n\t\t{\n\t\t\tthis.stream2 = s2;\n\t\t\t/*users.forEach(function(userId)\n\t\t\t\t {\n\t\t\t\t\tthis.callView.setUserMedia(userId, 'video', stream2.getVideoTracks()[0]);\n\t\t\t\t},this);*/\n\n\t\t\tthis.callView.setUserMedia(users[0], 'video', this.stream2.getVideoTracks()[0]);\n\n\t\t\tBX.rest.callMethod('im.user.list.get', {\n\t\t\t\t'ID': users.concat(this.userId),\n\t\t\t\t'AVATAR_HR': 'Y'\n\t\t\t}).then((response) => this.callView.updateUserData(response.data()));\n\n\t\t});\n\t}\n\n\t_onTestCallViewButtonClick(e)\n\t{\n\t\tconsole.log(e.buttonName);\n\t\tswitch (e.buttonName)\n\t\t{\n\t\t\tcase \"hangup\":\n\t\t\tcase \"close\":\n\t\t\t\tthis.callView.close();\n\t\t\t\tbreak;\n\t\t\tcase \"inviteUser\":\n\t\t\t\t/*this.lastUserId++;\n\t\t\t\tBX.rest.callMethod('im.user.list.get', {\n\t\t\t\t\t'ID': [this.lastUserId],\n\t\t\t\t\t'AVATAR_HR': 'Y'\n\t\t\t\t}).then((response) => this.callView.updateUserData(response.data()))\n\n\t\t\t\tthis.callView.addUser(this.lastUserId, UserState.Connecting);*/\n\n\t\t\t\tthis._onCallViewInviteUserButtonClick(e)\n\t\t\t\t//this.callView.setStream(lastUserId, stream2);\n\t\t\t\tbreak;\n\t\t\tcase \"fullscreen\":\n\t\t\t\tthis.toggleFullScreen();\n\n\t\t\t\tbreak;\n\t\t\tcase \"record\":\n\t\t\t\tthis._onCallViewRecordButtonClick(e);\n\n\t\t\t\tbreak;\n\t\t\tcase \"floorRequest\":\n\t\t\t\tthis._onCallViewFloorRequestButtonClick(e);\n\t\t\t\tbreak;\n\n\t\t\tcase \"showChat\":\n\t\t\t\tthis.fold(\"asd \\\"asd\\\"\");\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"toggleScreenSharing\":\n\t\t\t\tthis.callView.setUserMedia(464, 'screen', this.stream2.getVideoTracks()[0]);\n\n\t\t\t\t/*setTimeout(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.setUserScreenState(464, true);\n\t\t\t\t\t}.bind(this), 0);*/\n\t\t\t\tbreak;\n\n\t\t\tcase \"returnToCall\":\n\t\t\t\tbreak;\n\n\t\t\tcase \"document\":\n\t\t\t\tthis._onCallViewDocumentButtonClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\ttestIncoming(hasCamera)\n\t{\n\t\tthis.callNotification = new IncomingNotification({\n\t\t\tcallerName: \"this.currentCall.associatedEntity.name\",\n\t\t\tcallerAvatar: \"this.currentCall.associatedEntity.avatar\",\n\t\t\tcallerType: \"this.currentCall.associatedEntity.advanced.chatType\",\n\t\t\tcallerColor: \"\",\n\t\t\tvideo: true,\n\t\t\thasCamera: !!hasCamera,\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: (e) =>\n\t\t\t{\n\t\t\t\tconsole.log('button pressed', e.data);\n\t\t\t\tthis.callNotification.close()\n\t\t\t}\n\t\t});\n\n\t\tthis.callNotification.show();\n\t}\n\n\tgetMaxActiveMicrophonesCount()\n\t{\n\t\treturn 4;\n\t}\n\n\tshowMicMutedNotification()\n\t{\n\t\tif (this.mutePopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mutePopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.messengerFacade.getContainer() : this.callView.container,\n\t\t\ticon: 'mic-off',\n\t\t\tbuttons: [\n\t\t\t\tthis.createUnmuteButton()\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.allowMutePopup = false;\n\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\tthis.mutePopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.mutePopup.show();\n\t}\n\n\tshowAutoMicMuteNotification()\n\t{\n\t\tif (this.mutePopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mutePopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.messengerFacade.getContainer() : this.callView.container,\n\t\t\ttitle: Text.encode(BX.message(\"IM_CALL_MIC_AUTO_MUTED\")),\n\t\t\ticon: 'mic-off',\n\t\t\tbuttons: [\n\t\t\t\tthis.createUnmuteButton()\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\tthis.mutePopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.mutePopup.show();\n\t}\n\n\tcreateUnmuteButton()\n\t{\n\t\treturn new BX.UI.Button({\n\t\t\tbaseClass: \"ui-btn ui-btn-icon-mic\",\n\t\t\ttext: BX.message(\"IM_CALL_UNMUTE_MIC\"),\n\t\t\tsize: BX.UI.Button.Size.EXTRA_SMALL,\n\t\t\tcolor: BX.UI.Button.Color.LIGHT_BORDER,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis._onCallViewToggleMuteButtonClick({\n\t\t\t\t\t\tmuted: false\n\t\t\t\t\t});\n\t\t\t\t\tif (this.mutePopup)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\t\t\tthis.mutePopup = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t_onCallToggleSubscribe(e) {\n\t\tif (this.currentCall && this.currentCall.provider === Provider.Bitrix)\n\t\t{\n\t\t\tthis.currentCall.toggleRemoteParticipantVideo(e.participantIds, e.showVideo, true)\n\t\t}\n\t}\n\n\t_onCallUserClick(e)\n\t{\n\t\tAnalytics.getInstance().onClickUser({\n\t\t\tcallId: this.currentCall.id,\n\t\t\tcallType: this.getCallType(),\n\t\t\tlayout: Object.keys(View.Layout).find(key => View.Layout[key] === e.layout),\n\t\t});\n\t}\n\n\ttoggleRoomMenu(bindElement)\n\t{\n\t\tif (this.roomMenu)\n\t\t{\n\t\t\tthis.roomMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tconst roomSpeaker = this.currentCall.currentRoom().speaker;\n\t\tconst speakerModel = this.callView.userRegistry.get(roomSpeaker);\n\t\tlet avatarText = ''\n\n\t\tif (!speakerModel)\n\t\t{\n\t\t\tavatarText = Utils.text.getFirstLetters(speakerModel.name).toUpperCase();\n\t\t}\n\n\t\tthis.roomMenu = new Menu({\n\t\t\ttargetContainer: this.container,\n\t\t\tbindElement: bindElement,\n\t\t\titems: [\n\t\t\t\t{text: BX.message(\"IM_CALL_SOUND_PLAYS_VIA\"), disabled: true},\n\t\t\t\t{html: `<div class=\"bx-messenger-videocall-room-menu-avatar\" style=\"--avatar: url('${Text.encode(speakerModel.avatar)}')\">${avatarText}</div>${Text.encode(speakerModel.name)}`},\n\t\t\t\t{delimiter: true},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_CALL_LEAVE_ROOM\"),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.leaveCurrentRoom();\n\t\t\t\t\t\tthis.roomMenu.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{delimiter: true},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_CALL_HELP\"),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showRoomHelp();\n\t\t\t\t\t\tthis.roomMenu.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tonDestroy: () => this.roomMenu = null\n\t\t\t}\n\t\t});\n\t\tthis.roomMenu.show();\n\t}\n\n\ttoggleRoomListMenu(bindElement)\n\t{\n\t\tif (this.roomListMenu)\n\t\t{\n\t\t\tthis.roomListMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentCall.listRooms().then((roomList) =>\n\t\t{\n\t\t\tthis.roomListMenu = new BX.PopupMenuWindow({\n\t\t\t\ttargetContainer: this.container,\n\t\t\t\tbindElement: bindElement,\n\t\t\t\titems: this.prepareRoomListMenuItems(roomList),\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: () => this.roomListMenu = null\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.roomListMenu.show();\n\t\t})\n\t}\n\n\tprepareRoomListMenuItems(roomList)\n\t{\n\t\tlet menuItems = [\n\t\t\t{text: BX.message(\"IM_CALL_JOIN_ROOM\"), disabled: true},\n\t\t\t{delimiter: true},\n\t\t];\n\t\tmenuItems = menuItems.concat(...roomList.map(room =>\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.getRoomDescription(room),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tif (this.currentCall && this.currentCall.joinRoom)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.joinRoom(room.id);\n\t\t\t\t\t}\n\t\t\t\t\tthis.roomListMenu.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tmenuItems.push({delimiter: true});\n\t\tmenuItems.push({\n\t\t\ttext: BX.message(\"IM_CALL_HELP\"),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.showRoomHelp();\n\t\t\t\tthis.roomMenu.close();\n\t\t\t}\n\t\t})\n\n\t\treturn menuItems;\n\t}\n\n\tshowRoomHelp()\n\t{\n\t\tBX.loadExt('ui.dialogs.messagebox').then(() =>\n\t\t{\n\t\t\tBX.UI.Dialogs.MessageBox.alert(\n\t\t\t\tBX.message(\"IM_CALL_HELP_TEXT\"),\n\t\t\t\tBX.message(\"IM_CALL_HELP\")\n\t\t\t);\n\t\t})\n\t}\n\n\tgetRoomDescription(roomFields)\n\t{\n\t\tconst userNames = roomFields.userList.map(userId =>\n\t\t{\n\t\t\tconst userModel = this.callView.userRegistry.get(userId);\n\t\t\treturn userModel.name;\n\t\t})\n\n\t\tlet result = BX.message(\"IM_CALL_ROOM_DESCRIPTION\");\n\t\tresult = result.replace(\"#ROOM_ID#\", roomFields.id)\n\t\tresult = result.replace(\"#PARTICIPANTS_LIST#\", userNames.join(\", \"))\n\t\treturn result;\n\t}\n\n\tshowRoomJoinedPopup(isAuto, isSpeaker, userIdList)\n\t{\n\t\tif (this.roomJoinedPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet title;\n\t\tif (!isAuto)\n\t\t{\n\t\t\ttitle = BX.message(\"IM_CALL_ROOM_JOINED_MANUALLY\") + \"<p>\" + BX.message(\"IM_CALL_ROOM_JOINED_P2\") + \"</p>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst userNames = userIdList.filter(userId => userId != this.userId).map(userId =>\n\t\t\t{\n\t\t\t\tconst userModel = this.callView.userRegistry.get(userId);\n\t\t\t\treturn userModel.name;\n\t\t\t})\n\n\t\t\tconst usersInRoom = userNames.join(\", \");\n\t\t\tif (isSpeaker)\n\t\t\t{\n\t\t\t\ttitle = BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_AUTO_SPEAKER\").replace(\"#PARTICIPANTS_LIST#\", usersInRoom));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttitle = BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_AUTO\").replace(\"#PARTICIPANTS_LIST#\", usersInRoom));\n\t\t\t\ttitle += \"<p>\" + BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_P2\")) + \"</p>\";\n\t\t\t}\n\t\t}\n\n\t\tthis.roomJoinedPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.messengerFacade.getContainer() : this.callView.container,\n\t\t\ttitle: title,\n\t\t\tbuttonsLayout: \"bottom\",\n\t\t\tautoCloseDelay: 0,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\tbaseClass: \"ui-btn\",\n\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_JOINED_UNDERSTOOD\"),\n\t\t\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\tnoCaps: true,\n\t\t\t\t\tround: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_WRONG_ROOM\"),\n\t\t\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\tnoCaps: true,\n\t\t\t\t\tround: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t\t\t\t\tthis.currentCall.leaveCurrentRoom();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.roomJoinedPopup.show();\n\t}\n\n\tshowMicTakenFromPopup(fromUserId)\n\t{\n\t\tif (this.micTakenFromPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.callView.userRegistry.get(fromUserId);\n\t\tconst title = BX.message(\"IM_CALL_ROOM_MIC_TAKEN_FROM\").replace('#USER_NAME#', userModel.name);\n\t\tthis.micTakenFromPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.messengerFacade.getContainer() : this.callView.container,\n\t\t\ttitle: BX.Text.encode(title),\n\t\t\tbuttonsLayout: \"right\",\n\t\t\tautoCloseDelay: 5000,\n\t\t\tbuttons: [\n\t\t\t\t/*new Button({\n\t\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_DETAILS\"),\n\t\t\t\t\t\tsize: Button.Size.SMALL,\n\t\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\t\tnoCaps: true,\n\t\t\t\t\t\tround: true,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {this.micTakenFromPopup.destroy(); this.micTakenFromPopup = null;}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),*/\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.micTakenFromPopup.destroy();\n\t\t\t\tthis.micTakenFromPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.micTakenFromPopup.show();\n\t}\n\n\tshowMicTakenByPopup(byUserId)\n\t{\n\t\tif (this.micTakenByPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.callView.userRegistry.get(byUserId);\n\n\t\tthis.micTakenByPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.messengerFacade.getContainer() : this.callView.container,\n\t\t\ttitle: BX.Text.encode(BX.message(\"IM_CALL_ROOM_MIC_TAKEN_BY\").replace('#USER_NAME#', userModel.name)),\n\t\t\tbuttonsLayout: \"right\",\n\t\t\tautoCloseDelay: 5000,\n\t\t\tbuttons: [\n\t\t\t\t/*new Button({\n\t\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_DETAILS\"),\n\t\t\t\t\t\tsize: Button.Size.SMALL,\n\t\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\t\tnoCaps: true,\n\t\t\t\t\t\tround: true,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {this.micTakenByPopup.destroy(); this.micTakenByPopup = null;}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),*/\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.micTakenByPopup.destroy();\n\t\t\t\tthis.micTakenByPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.micTakenByPopup.show();\n\t}\n\n\tshowWebScreenSharePopup()\n\t{\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webScreenSharePopup = new WebScreenSharePopup({\n\t\t\tbindElement: this.callView.buttons.screen.elements.root,\n\t\t\ttargetContainer: this.callView.container,\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.webScreenSharePopup.destroy();\n\t\t\t\tthis.webScreenSharePopup = null;\n\t\t\t},\n\t\t\tonStopSharingClick: () =>\n\t\t\t{\n\t\t\t\tthis._onCallViewToggleScreenSharingButtonClick();\n\t\t\t\tthis.webScreenSharePopup.destroy();\n\t\t\t\tthis.webScreenSharePopup = null;\n\t\t\t}\n\t\t});\n\t\tthis.webScreenSharePopup.show();\n\t}\n\n\tshowFeedbackPopup(callDetails)\n\t{\n\t\tif (!callDetails)\n\t\t{\n\t\t\tif (this.lastCallDetails)\n\t\t\t{\n\t\t\t\tcallDetails = this.lastCallDetails;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error('Could not show feedback without call ')\n\t\t\t}\n\t\t}\n\n\t\tBX.loadExt('ui.feedback.form').then(() =>\n\t\t{\n\t\t\tBX.UI.Feedback.Form.open({\n\t\t\t\tid: 'call_feedback_' + Math.random(),\n\t\t\t\tforms: [\n\t\t\t\t\t{zones: ['ru'], id: 406, sec: '9lhjhn', lang: 'ru'},\n\t\t\t\t],\n\t\t\t\tpresets: {\n\t\t\t\t\tcall_id: callDetails.id || 0,\n\t\t\t\t\tcall_amount: callDetails.userCount || 0,\n\t\t\t\t},\n\t\t\t});\n\t\t})\n\t}\n\n\tshowFeedbackPopup_(callDetails)\n\t{\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!callDetails)\n\t\t{\n\t\t\tcallDetails = this.lastCallDetails;\n\t\t}\n\t\tconst darkMode = this.messengerFacade.isThemeDark();\n\t\tif (!Type.isPlainObject(callDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.loadExt('im.component.call-feedback').then(() =>\n\t\t{\n\t\t\tlet vueInstance;\n\t\t\tthis.feedbackPopup = new Popup({\n\t\t\t\tid: 'im-call-feedback',\n\t\t\t\tcontent: '',\n\t\t\t\ttitleBar: BX.message('IM_CALL_QUALITY_FEEDBACK'),\n\t\t\t\tcloseIcon: true,\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tbackground: darkMode ? '#3A414B' : null,\n\t\t\t\tdarkMode: darkMode,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (vueInstance)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvueInstance.$destroy();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.feedbackPopup = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst template = '<bx-im-component-call-feedback ' +\n\t\t\t\t'@feedbackSent=\"onFeedbackSent\" ' +\n\t\t\t\t':darkMode=\"darkMode\" ' +\n\t\t\t\t':callDetails=\"callDetails\" />';\n\n\t\t\tvueInstance = BX.Vue.createApp({\n\t\t\t\ttemplate: template,\n\t\t\t\tdata: function ()\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdarkMode: darkMode,\n\t\t\t\t\t\tcallDetails: callDetails\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmethods: {\n\t\t\t\t\tonFeedbackSent: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (this.feedbackPopup)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.feedbackPopup.close()\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t1500\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tvueInstance.mount('#' + this.feedbackPopup.getContentContainer().id);\n\n\t\t\tthis.feedbackPopup.show();\n\n\t\t})\n\t}\n\n\tstatic FeatureState = FeatureState;\n\tstatic Events = Events;\n\tstatic ViewState = ViewState;\n\tstatic DocumentType = DocumentType;\n}\n\n","import {applyHacks} from './hacks';\nimport {BackgroundDialog} from './dialogs/background_dialog';\nimport {IncomingNotificationContent} from './dialogs/incoming_notification';\nimport {NotificationConferenceContent} from './dialogs/conference_notification';\nimport {FloatingScreenShare} from './floating_screenshare';\nimport {FloatingScreenShareContent} from './floating_screenshare';\nimport {CallHint} from './call_hint_popup'\nimport {CallController} from './controller';\nimport {CallEngine, CallEvent, EndpointDirection, UserState, Provider, CallType, CallState} from './engine/engine';\nimport {Hardware} from './hardware';\nimport Util from './util';\nimport { CallAI } from './call_ai';\nimport {VideoStrategy} from './video_strategy';\nimport {View} from './view/view';\nimport { CopilotPopup } from './view/copilot-popup';\nimport {WebScreenSharePopup} from './web_screenshare_popup';\nimport { UserListPopup } from 'call.component.user-list-popup';\nimport { UserList } from 'call.component.user-list';\nimport 'loader';\nimport 'resize_observer';\nimport 'webrtc_adapter';\nimport 'im.lib.localstorage';\nimport 'ui.hint';\nimport 'voximplant';\n\napplyHacks();\n\nexport {\n\tBackgroundDialog,\n\tCallController as Controller,\n\tCallEngine as Engine,\n\tCallEvent as Event,\n\tCallHint as Hint,\n\tCallState as State,\n\tEndpointDirection,\n\tFloatingScreenShare,\n\tFloatingScreenShareContent,\n\tIncomingNotificationContent,\n\tNotificationConferenceContent,\n\tHardware,\n\tProvider,\n\tCallType as Type,\n\tUserState,\n\tUtil,\n\tVideoStrategy,\n\tView,\n\tWebScreenSharePopup,\n\tUserListPopup,\n\tCopilotPopup,\n\tUserList,\n\tCallAI,\n};\n\n// compatibility\nBX.CallEngine = CallEngine;"],"names":["applyHacks","window","navigator","mediaParams","audio","video","mandatory","chromeMediaSource","maxWidth","screen","width","maxHeight","height","optional","googTemporalLayeredScreencast","mediaDevices","getUserMedia","BackgroundDialog","MessengerUtils","platform","getDesktopVersion","isDesktopFeatureEnabled","options","Type","isPlainObject","tab","isStringFilled","isAvailable","BX","Helper","show","html","js","DesktopApi","createWindow","controller","title","isMaskAvailable","message","SetProperty","Width","Height","ExecuteCommand","prepareHtml","Logger","serviceUrl","token","socket","attempt","reconnectTimeout","unsentMessages","onSocketOpenHandler","onSocketOpen","bind","onSocketCloseHandler","onSocketClose","onSocketErrorHandler","onSocketError","connect","console","error","isConnected","send","JSON","stringify","action","push","statRecord","startsWith","WebSocket","bindSocketEvents","clearTimeout","setTimeout","getConnectionDelay","removeSocketEvents","close","addEventListener","removeEventListener","i","length","scheduleReconnect","disconnect","readyState","lsKey","defaultMicrophone","defaultCamera","defaultSpeaker","enableMicAutoParameters","preferHd","enableMirroring","Events","initialized","deviceChanged","onChangeMirroringVideo","onChangeMicrophoneMuted","onChangeCameraOn","HardwareManager","setEventNamespace","_currentDeviceList","updating","_isCameraOn","_isMicrophoneMuted","Promise","resolve","initPromise","reject","enumerateDevices","then","deviceList","filterDeviceList","debounce","onNavigatorDeviceChanged","emit","e","devices","Error","Object","keys","cameraList","values","filter","deviceInfo","kind","deviceId","HTMLMediaElement","prototype","removedDevices","addedDevices","shouldSkipDeviceChangedEvent","every","label","forEach","index","findIndex","dev","groupId","splice","added","removed","browserDeviceList","device","isDeviceInBlackList","deviceBlackList","result","item","toLowerCase","includes","updateDeviceList","deviceKind","resultDeviceList","currentDevices","microphoneId","speakerId","cameraId","_getDeviceMap","localStorage","getItem","microphoneList","getDefaultDeviceIdByGroupId","getDeviceGroupIdByDeviceId","setItem","audioOutputList","preferHdQuality","isDesktop","isCameraOn","isMicrophoneMuted","EventEmitter","Hardware","AbstractCall","params","id","instanceId","parentId","direction","type","prop","getInteger","CallType","Instant","state","getString","CallState","Idle","ready","userId","CallEngine","getCurrentUserId","initiatorId","users","isArray","associatedEntity","startDate","Date","videoEnabled","videoHd","muted","wasConnected","logToken","getLogService","logger","localStreams","main","eventListeners","events","initEventListeners","connectionData","_microphoneLevel","eventName","listener","isFunction","indexOf","listenerIndex","eventFields","call","err","log","tag","mediaStream","command","code","reason","text","Util","getLogMessage","apply","arguments","writeToLogFile","substr","debugFlag","a","getTimeForLog","concat","Array","slice","MessengerDebug","addLog","destroy","Finished","runCallback","CallEvent","onDestroy","level","onMicrophoneLevel","CopilotNotifyType","COPILOT_ENABLED","COPILOT_DISABLED","COPILOT_RESULT","AI_UNAVAILABLE_ERROR","AI_SETTINGS_ERROR","AI_AGREEMENT_ERROR","AI_NOT_ENOUGH_BAAS_ERROR","CopilotNotify","config","callId","popup","notifyText","promoId","popupTemplate","bindElement","notifyColor","callbacks","onClose","DoNothing","setAdditionalInformation","Dom","create","props","className","children","click","Loc","getMessage","self","getPopupTemplate","Popup","targetContainer","document","body","content","bindOptions","position","padding","contentBorderRadius","background","contentBackground","darkMode","contentNoPaddings","animation","autoHide","onPopupClose","onPopupDestroy","onShow","popupWidth","getPopupContainer","offsetWidth","elementWidth","offsetFix","setOffset","offsetLeft","setAngle","offset","adjustPosition","PromoManager","getInstance","markAsWatched","canShowCopilotNotify","Analytics","copilot","onCopilotNotifyShow","isCopilotActive","needToShow","UserModel","data","name","avatar","gender","UserState","talking","getBoolean","cameraState","prevCameraState","microphoneState","screenState","videoPaused","floorRequestState","localUser","centralUser","pinned","presenter","order","prevOrder","allowRename","wasRenamed","renameRequested","EndpointDirection","SendRecv","fieldName","hasOwnProperty","defineProperty","get","_getField","set","_setField","onUpdate","_onUpdateTalking","_onUpdateState","talkingStop","eventEmitter","newValue","oldValue","user","getTime","Connected","Infinity","event","handler","subscribe","unsubscribe","UserRegistry","_sort","_onUserChanged","sort","b","createSVG","elementName","element","createElementNS","isObject","attrNS","key","setAttributeNS","adjust","TitleButton","elements","root","isGroupCall","getTitle","prettyName","Text","encode","replace","SimpleButton","backgroundClass","blocked","isActive","counter","isComingSoon","comingSoon","onClick","getFunction","onMouseOver","onMouseOut","textNode","dataset","counterType","visible","mouseover","mouseout","classList","add","remove","isBlocked","parseInt","counterLabel","toString","innerText","DeviceButton","enabled","arrowEnabled","arrowHidden","showLevel","sideIcon","iconContainer","icon","arrow","levelMeter","pointer","ellipsis","onArrowClick","onSideIconClick","getIconContainerClass","getIconClass","stopPropagation","appendChild","viewBox","fill","x1","y1","x2","y2","gradientStop1","gradientStop2","d","x","y","rx","opacity","insertAfter","setAttribute","Math","round","removeChild","WaterMarkButton","language","src","getWatermarkUrl","TopButton","iconClass","TopFramelessButton","textClass","ParticipantsButton","count","foldButtonState","FoldButtonState","Hidden","allowAdding","leftContainer","rightContainer","foldIcon","separator","onListClick","onAddClick","parentElement","Active","Fold","Unfold","ParticipantsButtonMobile","RecordStatusButton","recordState","updateViewInterval","timeText","stateText","onPauseClick","onStopClick","getRecordTimeText","clearInterval","View","RecordState","Started","setInterval","updateView","contains","CallUserMobile","userModel","avatarOutline","userName","userStatus","menuArrow","floorRequest","mic","cam","_onUserFieldChangeHandler","_onUserFieldChange","avatarBackground","getAvatarBackground","style","setProperty","removeProperty","Utils","getFirstLetters","toUpperCase","toggle","render","update","UserSelectorMobile","userRegistry","_onUserAdded","updateUsers","userFields","cx","cy","r","newNode","renderUser","MobileSlider","parent","handle","touchStartY","processedTouchId","_onBackgroundClick","touchstart","_onTouchStart","touchmove","_onTouchMove","touchend","_onTouchEnd","pageY","touches","target","header","scrollTop","identifier","delta","bottom","preventDefault","allowProcessing","changedTouches","closeWithAnimation","MobileMenu","largeIcons","slider","items","getArray","map","MobileMenuItem","createFragment","onSliderClose","onSliderDestroy","getUuidv4","showSubMenu","_userChangeHandler","_onUserChange","subscribeUserEvents","iconText","iconBackground","submenu","clickSubMenu","backgroundImage","prepend","updateUserIcons","logPlaybackError","MediaStreamsKinds","Camera","Microphone","Screen","ScreenAudio","Track","track","source","Message","from","senderSid","timestamp","floor","now","STREAM_QUALITY","HIGH","MEDIUM","LOW","CALL_STATE","CONNECTED","PROGRESSING","TERMINATED","VIDEO_QUEUE","INITIAL","ENABLE","DISABLE","LOG_LEVEL","INFO","WARNING","ERROR","MONITORING_EVENTS_NAME_LIST","TRACK_SUBSCRIPTION_FAILED","TRACK_SUBSCRIPTION_DELAY","HIGH_PACKET_LOSS_SEND","HIGH_PACKET_LOSS_RECEIVE","CPU_ISSUES","NETWORK_ISSUES","PEER_CONNECTION_REFUSED","PEER_CONNECTION_ISSUES","USER_CAMERA_DISABLED","USER_RECONNECTED","LOCAL_VIDEO_STREAM_RECEIVING_FAILED","LOCAL_MICROPHONE_STREAM_RECEIVING_FAILED","LOCAL_SCREEN_STREAM_RECEIVING_FAILED","LOCAL_VIDEO_STREAM_PUBLICATION_FAILED","LOCAL_MICROPHONE_STREAM_PUBLICATION_FAILED","LOCAL_SCREEN_STREAM_PUBLICATION_FAILED","MONITORING_EVENTS_LIST","metrics","PACKET_LOST_SEND","PACKET_LOST_RECEIVE","COUNT_TRACKS","BITRATE_IN","BITRATE_OUT","CONN_SCORE_CURRENT","JITTER","TOTAL_FREEZE_DURATION","FREEZE_COUNT","FRAMES_DECODED","FRAMES_DROPPED","FRAMES_RECEIVED","FRAMES_LOSS","startTimestamp","ReconnectionReason","NetworkError","PingPongMissed","PeerConnectionFailed","WsTransportClosed","LeaveCommand","JoinResponseError","ErrorPreventingReconnection","InputError","AccessDenied","RoomNotFound","MalfunctioningSignaling","Call","clientVersion","clientPlatform","codec","canReconnect","logs","isloggingEnable","loggerCallback","abortController","AbortController","isWaitAnswer","reportsForIncomingTracks","reportsForOutgoingTracks","prevParticipantsWithLargeDataLoss","Set","tracksDataFromSocket","realTracksIds","url","roomId","endpoint","jwt","iceServers","socketConnect","peerConnectionFailed","pendingCandidates","recipient","sender","pendingPublications","pendingSubscriptions","publicationTimeout","subscriptionTimeout","subscriptionTries","cameraStream","microphoneStream","screenStream","mediaMutedBySystem","needToEnableAudioAfterSystemMuted","needToDisableAudioAfterPublish","localTracks","localConnectionQuality","minimalConnectionQuality","rtt","pingIntervalDuration","pingTimeoutDuration","ontrackData","remoteTracks","remoteParticipants","mainStream","pingPongTimeout","pingPongInterval","localParticipantSid","defaultVideoResolution","defaultSimulcastBitrate","q","h","f","defaultRemoteStreamsQuality","audioBitrate","videoBitrate","screenBitrate","videoSimulcast","screenSimulcast","Map","offersStack","audioDeviceId","switchActiveAudioDeviceInProgress","switchActiveAudioDevicePending","videoDeviceId","switchActiveVideoDeviceInProgress","switchActiveVideoDevicePending","isReconnecting","reconnectionAttempt","reconnectionTimeout","lastReconnectionReason","fastReconnectionDelay","reconnectionDelay","callStatsInterval","callState","packetLostThreshold","statsTimeout","videoQueue","videoStreamSetupErrorList","sendLeaveBound","beforeDisconnectBound","monitoringEvents","monitoringDelayTime","monitoringIntervalTime","countMetricsInMetricsInterval","monitoringInterval","currentMonitoringEventsObject","parse","startTimestampGrabMetrics","prevInboundRtpStatsSum","freezeCount","totalFreezesDuration","jitter","framesDecoded","framesDropped","framesReceived","callback","isNewQOSEnabled","value","undefined","withCounter","currentEventIndex","evt","lastTimestamp","countVideoTracks","countAudioTracks","participant","getTrack","isMutedVideo","isLocalVideoMute","isMutedAudio","getCountRemoteTracks","monitoringTimeout","sendMonitoringEvents","withRestart","eventsToSend","eventsToLog","eventList","entries","eventData","mediaServerId","eventTime","eventTypeId","objForSend","audioSubscribed","videoSubscribed","packetLoss","bitrateIn","bitrateOut","connScore","framesLoss","sendQoS","setClearValuesForCurrentMonitoringEventsObject","startAggregateMonitoringEvents","triggerEvents","checkQosFeatureAndExecutionCallback","addMonitoringEvents","setLog","getMediaServerInfo","mediaServerInfo","signal","aborted","onmessage","socketOnMessageHandler","onopen","socketOnOpenHandler","onerror","socketOnErrorHandler","onclose","socketOnCloseHandler","fetch","method","response","ok","status","json","mediaServerUrl","tokenToAccessMediaServer","roomData","abort","createOffer","offer","useTcpSdp","sdp","setLocalDescription","getLocalVideo","videoTrack","publishTrack","onPublishFailed","getLocalAudio","audioTrack","answer","joinResponse","localParticipant","sid","connectedEvent","participantsToDelete","otherParticipants","p","pingInterval","participantJoined","participantLeft","participantId","trackId","timeout","trackCreated","cid","disableAudio","audioEnabled","screenSharingEnabled","trackDeleted","publisher","shortId","pendingSubscription","tracks","find","removeTrack","trackMuted","awaitedTrack","trickle","newMessage","handRaised","isHandRaised","speakersChanged","subscribedQualityUpdate","connectionQuality","updates","participants","participantsToUpdate","remoteParticipant","hasGoodQuality","score","participantSid","isLocalVideoMuted","pongResp","lastPingTimestamp","leave","leaveInformation","candidate","protocol","candidateInit","sdpMid","sdpMLineIndex","usernameFragment","subscriber","connectionState","eventType","has","args","bitrate","MediaStreamKind","isSimulcast","getVideoTracks","getAudioTracks","senders","getSenders","getParameters","encodings","encoding","maxBitrate","rid","setParameters","transceiver","RTCRtpReceiver","cap","getCapabilities","matched","partialMatched","unmatched","codecs","c","mimeType","matchesVideoCodec","sdpFmtpLine","setCodecPreferences","MediaStreamTrack","StreamQualityOptions","getSettings","replaceTrack","addTransceiver","streams","sendEncodings","setCodec","setBitrate","sendOffer","republishTrack","unpublishTrack","participantIds","showVideo","isPaginateToggle","errorInVideoStreamSetupErrorList","kindInListKinds","kindsArray","setVideoStreamSetupErrorList","mediaStreamKind","trackSid","keepTrack","mute","bySystem","pauseTrack","disabled","canUseUnpauseSignal","needToGetNewTrack","unpauseTrack","hasQueue","stop","skipUnpause","hasTrack","getLocalScreen","sendMessage","raised","raiseHand","onended","interrupted","force","fulfilled","promise","prevStream","prevTrack","prevTrackEnabledState","prevTrackId","isAudioPublished","switchActiveAudioDevice","isVideoPublished","switchActiveVideoDevice","info","desktopVersion","ApiVersion","version","client","appVersion","logLength","lastSentLog","enable","reconnect","pingTimeout","pingReq","tries","maxEncodings","rids","active","scaleResolutionDownBy","max","quality","encodingByRid","el","subscription","trackSids","participantTracks","trackSource","pause","trackSetting","exactUser","exactTrack","getParticipants","setStreamQuality","enableVideo","disableVideo","fallbackMode","constraints","stream","ideal","exact","GET_LOCAL_TRACK_ERROR","GetProperty","maxFrameRate","getDisplayMedia","cursor","systemAudio","onmute","onunmute","enableAudio","sendLog","msgLevel","updatedSdp","split","RegExp","test","join","hasError","setRemoteDescription","addIceCandidate","createAnswer","remoteDescription","participantEvent","Participant","kindArray","setMainStream","trackData","layers","remoteTrack","addTrack","streamRemovingId","onremovetrack","speakers","speaker","isSpeaking","RTCPeerConnection","onIceCandidate","onConnectionStateChange","ontrack","ids","getStatsHandle","statsAll","packetLostEventAdded","getStats","stats","statsOutput","reportsWithoutCodecs","remoteReports","reportsWithoutRemoteInfo","isQualityLimitationSent","totalBitrateOut","report","processReportsWithoutCodecs","reportId","localId","packetsLostData","calcLocalPacketsLost","currentPercentPacketLost","packetsLost","totalPacketsLost","packetsLostExtended","formatPacketsLostData","calcBitrate","contentType","qualityLimitationReason","qualityLimitationDurations","reduce","accumulator","setCodecToReport","saveReportWithoutCodecs","setLocalPacketsLostOrSaveReport","formattedBitrateOut","Number","parseFloat","toFixed","participantsWithLargeDataLoss","totalBitrateIn","currentPacketLostReceiveCount","inboundRtpStatsArray","needCheckPacketLosts","trackIdentifier","calcRemotePacketsLost","realTrackId","prevReport","number","decimal","pow","addValueInboundRTCStatsToMetrics","metricsKey","isSum","interval","inboundRtpStatsArraySumByKey","acc","prevInboundRtpStatsArraySumByKey","diffInboundRtpStatsArraySumByKey","metricValue","currentFramesReceived","currentFramesDropped","currentFramesLoss","formattedBitrateIn","size","streamType","getTracks","s","image","cameraStreamQuality","currentVideoQuality","CallUser","_onUserFieldChanged","parentContainer","screenSharingUser","isBoolean","allowBackgroundItem","allowMaskItem","_allowPinButton","allowPinButton","_visible","_audioTrack","_screenAudioTrack","screenAudioTrack","_audioStream","MediaStream","_screenAudioStream","_videoTrack","_stream","_videoRenderer","_previewRenderer","_flipVideo","hidden","videoBlurState","isChangingName","_badNetworkIndicator","incomingVideoConstraints","audioElement","screenAudioElement","screenAudio","callBacks","onUserRename","onUserRenameInputFocus","onUserRenameInputBlur","onPin","onUnPin","checkAspectInterval","checkVideoAspect","hintManager","UI","Hint","createInstance","popupParameters","forceBindPosition","connectionStats","connectionStatsVisible","removeAvatarPulseTimer","hideUserNameTimer","init","onMouseMoveHandler","showUserName","isVisibleMediaStateIcon","statsOverlay","showConnectionStats","videoBorder","container","avatarContainer","panel","getStateMessage","userBottomContainer","nameContainer","changeNameIcon","toggleNameInput","changeNameContainer","changeNameCancel","changeNameInput","attrs","keydown","onNameInputKeyDown","focus","blur","changeNameConfirm","changeName","changeNameLoader","introduceYourselfContainer","updateAvatarPulseState","debugPanel","connectionQualityIcon","connectionProblem","currentTarget","hide","getAvatarInnerText","videoContainer","volume","autoplay","playsinline","preview","srcObject","flipVideo","isVisibleCameraStateIcon","isVisibleMicStateIcon","buttonBackground","open","buttonMenu","showMenu","buttonPin","buttonUnPin","micState","updatePanelDeferred","statsString","cameraStats","screenStats","audioStats","_formatVideoStats","codecName","videoRenderer","requestVideoSize","updateId","updateName","updateAvatar","updateState","updateTalking","updateMicrophoneState","updateCameraState","updateVideoPaused","updateFloorRequestState","updateScreenState","updatePanel","updateRenameAllowed","updateWasRenamed","updateRenameRequested","updateOrder","select","keyCode","inputValue","newName","trim","needToUpdate","menuItems","onclick","menu","rect","getRelativePosition","Menu","left","top","closeByEsc","offsetTop","angle","overlay","backgroundColor","cacheable","isMounted","clean","videoElement","hasVideoEl","isCanPlaying","isPaused","paused","isReadyPlaying","HAVE_CURRENT_DATA","isEnded","ended","play","load","onloadeddata","playVideoElements","hasVideo","isCallServerAllowed","audioStream","setSinkId","screenAudioStream","blurState","userState","Calling","Declined","Ready","Connecting","Failed","Unavailable","addAvatarPulseTimer","clearAvatarPulseTimer","blurVideo","videoHeight","videoWidth","videoStats","resultString","limitationsString","frameWidth","frameHeight","qualityLimitationResolutionChanges","framesPerSecond","limitations","trackIndex","_getVideoStats","releaseStream","playAudio","playScreenAudio","updateRendererState","_tempVideoRenderer","currentVideoRendererKind","newVideoRendererKind","badNetworkIndicator","hasConnectionProblem","_hasConnectionProblem","_connectionQuality","connectionQualityIcons","excellent","good","poor","bad","resultIcon","FloorRequest","hideTime","_hideTimeout","_onUserModelChangedHandler","_onUserModelChanged","scheduleDismount","dismount","util","htmlspecialchars","dismountWithAnimation","innerHtml","maximumNotifications","instance","NotificationManager","maxNotification","notifications","notification","onNotificationDestroy","firstNotification","shift","DeviceSelectorEvents","onMicrophoneSelect","onMicrophoneSwitch","onCameraSelect","onCameraSwitch","onSpeakerSelect","onSpeakerSwitch","onChangeHdVideo","onChangeMicAutoParams","onChangeFaceImprove","onAdvancedSettingsClick","DeviceSelector","viewElement","zIndex","cameraEnabled","microphoneEnabled","speakerEnabled","allowHdVideo","faceImproveEnabled","allowFaceImprove","allowBackground","allowMask","allowAdvancedSettings","switchCameraBlocked","switchMicrophoneBlocked","isDestroying","Event","micContainer","cameraContainer","speakerContainer","getObject","microphoneContainer","DeviceMenu","deviceLabel","getMicrophoneList","selectedDevice","deviceEnabled","icons","onSwitch","onSelect","getCameraList","canSelectSpeaker","getSpeakerList","checked","change","onAllowHdVideoChange","onFaceImproveChange","startSelfTest","MessengerCommon","available","unblock","block","DeviceMenuEvents","menuBlocked","switchIcon","menuInner","getDeviceIconClass","Switcher","handlers","toggled","onSwitchToggled","getNode","renderDevice","deviceElements","onMenuItemClick","currentDevice","CallAiError","CallAi","serviceEnabled","settingsEnabled","recordingMinUsers","agreementAccepted","tariffAvailable","baasAvailable","feedBackLink","baasPromoSlider","helpSlider","Extension","ai","setup","errorType","_serviceEnabled","flag","_settingsEnabled","_recordingMinUsers","_agreementAccepted","_tariffAvailable","_baasAvailable","_feedBackLink","_baasPromoSlider","_helpSlider","CallAI","UserSelector","userList","current","popupWindow","MenuManager","Layouts","Grid","Centered","Mobile","RerenderReason","VideoEnabled","VideoDisabled","UserDisconnected","SwapType","Direct","Replace","UiState","Preparing","Initializing","Size","Folded","Full","Resumed","Paused","Stopped","RecordType","None","Video","Audio","RoomState","Speaker","NonSpeaker","EventName","onButtonClick","onBodyClick","onReplaceCamera","onReplaceMicrophone","onReplaceSpeaker","onSetCentralUser","onLayoutChange","onUserClick","onUserPinned","onDeviceSelectorShow","onOpenAdvancedSettings","onHasMainStream","onToggleSubscribe","beginingPosition","newUserPosition","addButtonPosition","MIN_WIDTH","SIDE_USER_WIDTH","SIDE_USER_HEIGHT","MAX_USERS_PER_PAGE","MIN_GRID_USER_WIDTH","MIN_GRID_USER_HEIGHT","CHANGE_VIDEO_RERENDER_DELAY","WAITING_VIDEO_DELAY","buttons","camera","disable","isMuted","microphone","baseZIndex","speakerMuted","showChatButtons","showUsersButton","showShareButton","showRecordButton","showDocumentButton","showCopilotButton","showButtonPanel","showAddUserButtonInList","limitation","inactiveUsers","activeUsers","rerenderTimeout","waitingForUserMediaTimeouts","rerenderQueue","shelvedRerenderQueue","broadcastingMode","broadcastingPresenters","currentPage","pagesCount","usersPerPage","lastPosition","userData","updateUserData","userLimit","isIntranetOrExtranet","screenUsers","localUserModel","avatar_hr","_onUserRename","_onUserRenameInputFocus","_onUserRenameInputBlur","_onUserClick","_onUserPin","_onUserUnPin","centralUserMobile","pinnedUser","presenterId","returnToGridAfterScreenStopped","mediaSelectionBlocked","wrap","watermark","topPanel","notificationPanel","audioContainer","screenAudioContainer","center","localUserMobile","userBlock","ear","right","addButton","userSelectorContainer","pinnedUserContainer","renameSlider","input","button","pageNavigatorLeft","pageNavigatorLeftCounter","pageNavigatorRight","pageNavigatorRightCounter","grid","share","record","mobileMenu","chat","history","hangup","fullscreen","returnToCall","recordStatus","participantsMobile","hd","more","hangupOptions","isFullScreen","isUserBlockFolded","getDefaultRecordState","blockedButtons","configBlockedButtons","buttonCode","hiddenButtons","overflownButtons","configHiddenButtons","hiddenTopButtons","configHiddenTopButtons","uiState","layout","whiteSpaceInUserGrid","roomState","scrollInterval","_onFullScreenChangeHandler","_onFullScreenChange","_onResizeHandler","_onResize","_onOrientationChangeHandler","_onOrientationChange","_onKeyDownHandler","_onKeyDown","_onKeyUpHandler","_onKeyUp","resizeObserver","ResizeObserver","intersectionObserver","switchPresenterTimeout","deviceSelector","userSelector","userSize","hotKey","all","microphoneSpace","muteSpeaker","hotKeyTemporaryBlock","_isPreparing","_videoRerenderDelay","subscribeEvents","userStates","appendUsers","hideEarTimer","isCopilotFeaturesEnabled","copilotNotify","articleCode","infoHelper","InfoHelper","isOpen","limitObj","openArticle","getCallFeatures","defaultLimitation","currentLimitation","getLimitationByType","isDesktopCall","getBackgroundImage","backgroundId","setCallBackground","getLimitation","checkAvailableBackgroundImage","isFullScreenSupported","Browser","isChrome","isSafari","isFirefox","isMobile","documentElement","innerHeight","setSpeakerId","setMuted","setCameraState","toggleVisibilityEar","isMac","keyModifier","setCallback","cb","userIds","addUser","previousCentralUser","updateUserList","setUserModel","showUserMenu","mount","candidateUserId","withYou","getConnectedUsers","isUserHasActiveState","some","currentUser","currentPresenterId","currentPresenterModel","wasTalkingAgo","minTalkingAgo","minTalkingAgoUserId","userWasTalkingAgo","newPresenterId","getPresenterUserId","setCentralUser","switchPresenter","updateButtons","newLayout","useShelvedRerenderQueue","playVideo","Buttons","unpinUser","setUserBlockFolded","toggleEars","setSideIcon","getMicrophoneSideIcon","pageNumber","recalculateUsersPerPage","innerHTML","renderUserList","containerSize","getBoundingClientRect","columns","rows","rowsWithoutGap","rowGap","elementSize","findBestElementSize","pages","ceil","getDisplayedUsers","calculateUsersPerPage","calculatePagesCount","displayedUsers","userPosition","microphoneLevel","setLevel","RecvOnly","getNextPosition","getConnectedUserCount","updateUserButtons","newState","setUiState","usersWithVideo","getUsersWithVideo","connectedUsers","timer","setUserFloorRequestState","hasCameraVideo","skippedElementsList","switchPresenterDeferred","showStats","isMicrophoneOn","updateRerenderQueue","userFloorRequestState","userActive","Busy","showFloorRequestNotification","setButtonActive","Instance","addNotification","Layout","setLayout","hasUserWithScreenSharing","streamData","mediaRenderer","isUndefined","flipLocalVideo","videoTracks","videoTrackSettings","audioTracks","audioTrackSettings","hideArrow","showArrow","videoRerenderDelay","userHasCameraVideo","setUserScreenState","setIncomingVideoConstraints","date","start","unblockButtons","blockButtons","startIntersectionObserver","resumeVideo","disableFaceImprove","checkPanelOverflow","closeCopilotNotify","overflownButtonsPopup","IntersectionObserver","_onIntersectionChange","threshold","callUser","observe","unobserve","getCameraSmoothingStatus","BXIM","_onMicrophoneSelected","_onMicrophoneButtonClick","_onCameraSelected","_onCameraButtonClick","_onSpeakerSelected","_onSpeakerButtonClick","_onChangeHdVideo","_onChangeMicAutoParams","_onChangeFaceImprove","_onMobileCallMenuFloorRequestClick","_onMobileCallMenShowParticipantsClick","_onMobileCallMenuCopyInviteClick","callMenu","showRenameSlider","_onMobileCallMenuCancelClick","pinItem","userMenu","pinUser","participantsMenu","statusNode","childElementCount","textContent","errorContainer","renderErrorCallLayout","display","stopViewUpdate","buttonName","isScreenSharingSupported","showButtons","hideButtons","scrollWidth","mediumButtonMinWidth","countOfButtonsToHide","getButtonList","hiddenButtonsCount","unusedPanelSpace","calculateUnusedPanelSpace","countOfButtonsToShow","min","buttonsLeftHidden","toggleCameraAvailability","toggleMicrophoneAvailability","setBlocked","isButtonBlocked","isMediaSelectionAllowed","previousButtonCode","_onCenterTouchStart","_onCenterTouchEnd","_onLeftPageNavigatorClick","_onRightPageNavigatorClick","_onBodyClick","_onLeftEarClick","_onRightEarClick","innerWidth","_onTopPageNavigatorClick","_onBottomPageNavigatorClick","scroll","Runtime","wheel","deltaY","_onAddButtonClick","rules","videoDisabled","userDisconnected","clear","changes","to","diffBetweenChanges","lessChangesField","moreChangesField","toUser","fromUser","orderChanges","applyOrderChanges","abs","incompleteSwaps","disconnectedUserHadVideo","swapRemains","usersWithEnabledVideo","pop","usersToKeepActive","userEnabledVideo","currenUserFromCurrentPage","possibleActiveUsers","changedUserFromCurrentPage","skipDeactivation","currentPageUsers","usersToDeactivate","usersToForceDeactivation","usersProceed","userWithoutVideo","userWithoutVideoIndex","userWithoutVideoPage","skipUsers","numberOfUsersWithVideoForSwap","userToSwap","canCompleteVideoSwap","userToSwapIndex","userToSwapPage","userSkipped","lowerOrderOnCurrentPage","higherOrderOnCurrentPage","disconnectedUserFromCurrentPage","activeUsersFromPreviousPage","lastActiveUserFromPreviousPage","showAdd","pageChange","showLocalUser","shouldShowLocalUser","userCount","skippedUsers","renderedUsers","orderingRules","getOrderingRules","orderingParams","usersWithDisabledVideo","videoDisabledProceed","processVideoRules","processDisconnectRules","getActiveUsers","getUsersWithCamera","completeVideoDisabledSwap","completeDisconnectSwap","screenUser","unobserveIntersections","previousIncompleteSwaps","currentUserFromCurrentPage","currentUserFromNextPage","completeVideoEnableSwap","swapCompleted","calculateUserActive","isPreparing","observeIntersections","updateGridUserSize","updateCentralUserAvatarSize","applyIncomingVideoConstraints","renderAddUserButtonInList","toggleSubscribingVideoInRenderUserList","avatarSize","avatarTextSize","panelInner","_onShareButtonClick","showPointer","_showMicrophoneHint","_onMicrophoneArrowClick","_destroyHotKeyHint","_onMicrophoneSideIconClick","_onCameraArrowClick","_showHotKeyHint","firstChild","_onScreenButtonClick","_onRecordToggleClick","isRecordingHotKeySupported","_onDocumentButtonClick","_onCopilotButtonClick","setActive","_onHangupButtonClick","_onHangupOptionsButtonClick","_onCloseButtonClick","_onMobileMenuButtonClick","_onChatButtonClick","_onFloorRequestButtonClick","_onMoreButtonClick","waterMark","_onRecordPauseClick","_onRecordStopClick","_onRecordMouseOver","_onRecordMouseOut","_onGridButtonClick","_onFullScreenButtonClick","feedback","_onFeedbackButtonClick","_onParticipantsButtonListClick","_onParticipantsButtonMobileListClick","isEnabled","setIsComingSoon","errorCode","notifyType","createCopilotNotify","buttonList","totalButtonWidth","buttonWidth","setCounter","recalculatePages","renderButtons","closeIcon","renderTopButtons","getTopButtonList","setCount","isAvatarBlank","BXDesktopSystem","browser","IsChrome","IsSafari","webkitFullscreenEnabled","IsFirefox","fullscreenEnabled","toggleTopEar","toggleBottomEar","stopScroll","isButtonHidden","centerTouchX","pageX","getRightUser","getLeftUser","webkitFullscreenElement","fullscreenElement","t","intersectionEntry","isIntersecting","IsMobile","rootDimensions","targetNode","existingHint","PopupWindowManager","getPopupById","isHotKeyActive","getTarget","additionalOffsetLeft","micHotkeys","shiftKey","ctrlKey","metaKey","repeat","callMinimized","pushToTalk","microphoneHotkeyTimerId","_onUsersButtonClick","_onForceRecordToggleClick","fromHotKey","setHotKeyTemporaryBlock","getRecordLimitation","onClickButtonWithLimit","_onRecordStartClick","_onForceRecordStartClick","recordType","forceRecord","node","recordingUserName","showDeviceSelector","getScreenSharingLimitation","showCallMenu","showOverflownButtonsPopup","clearNewLogicRules","viewEvent","BaseEvent","compatData","isDefaultPrevented","showParticipantsMenu","renderRenameSlider","_onMobileUserRename","toggleRenameSliderInputLoader","setCurrentPage","MAX_WIDTH_SPEAKER_MODE","animateUnsetProperty","_applyMaxWidth","setMaxWidth","containerDimensions","once","hasCurrentUserScreenSharing","unsubscribeAll","Chat","VOLUME_THRESHOLD","INACTIVITY_TIME","AVERAGING_COEFFICIENT","SimpleVAD","clone","audioContext","mediaStreamNode","analyserNode","audioTimeDomainData","voiceState","measureInterval","inactivityTimeout","currentVolume","voiceStarted","onVoiceStarted","voiceStopped","onVoiceStopped","isSupported","AudioContext","webkitAudioContext","createAnalyser","fftSize","createMediaStreamSource","Float32Array","analyzeAudioStream","getFloatTimeDomainData","updateCurrentVolume","setVoiceState","onInactivityTimeout","sum","rms","sqrt","AnalyserNode","ajaxActions","invite","cancel","decline","ping","negotiationNeeded","connectionOffer","connectionAnswer","iceCandidate","pullEvents","customMessage","userInviteTimeout","defaultConnectionOptions","offerToReceiveVideo","offerToReceiveAudio","signalingConnectionRefreshPeriod","signalingWaitReplyPeriod","pingPeriod","backendPingPeriod","reinvitePeriod","PlainCall","_classPrivateMethodInitSpec","hasVideoTracks","replaceLocalMediaStream","signaling","sendCameraState","onLocalMediaReceived","sendMicrophoneState","sendTalkingState","callFromMobile","peers","initPeers","Signaling","turnServer","turnServerLogin","turnServerPassword","pingUsersInterval","pingUsers","pingBackendInterval","pingBackend","reinviteTimeout","_onUnloadHandler","_classPrivateMethodGet","microphoneLevelInterval","_reconnectionEventCount","_isCopilotActive","_isCopilotFeaturesEnabled","_isRecordWhenCopilotActivePopupAlreadyShow","_isBoostExpired","createPeer","Peer","signalingConnected","isLegacyMobile","onMediaReceived","onRemoteMediaReceived","onMediaStopped","onRemoteMediaStopped","onStateChanged","onInviteTimeout","onRTCStatsReceived","onRTCQualityChanged","onNetworkProblem","onReconnecting","reconnectionEventCount","onReconnected","onUpdateLastUsedCameraId","calculatedState","onNeedResetMediaDevicesState","changedMediaMutedBySystem","replaceLocalAudioStream","senderId","sendRecordState","localStream","getLocalMediaStream","subscribeHardwareChanges","inviteUsers","onJoin","local","onUserInvited","onInvited","scheduleRepeatInvite","unsubscribeHardwareChanges","onCallFailure","repeatInviteUsers","usersToRepeatInvite","repeated","setVideoEnabled","hdVideo","supportedConstraints","getSupportedConstraints","echoCancellation","noiseSuppression","autoGainControl","constraintsArray","currentConstraints","fallbackToAudio","getMediaConstraints","onLocalVideoTrackEnded","onLocalVideoTrackMute","onLocalVideoTrackUnmute","onLocalAudioTrackEnded","setPublishingState","attachVoiceDetection","onDeviceListUpdated","deviceType","publishing","onCameraPublishing","onMicrophonePublishing","voiceDetection","onLocalVoiceStarted","onLocalVoiceStopped","changeSource","stopScreenSharing","onUserScreenState","sendMedia","stopMediaStreamVideoTracks","stopMediaStreamAudioTracks","prevMainStream","isReady","replaceMediaStream","stopMediaStream","onUserVoiceStarted","sendVoiceStarted","onUserVoiceStopped","sendVoiceStopped","sendCustomMessage","sendAnswer","callInstanceId","getRestClient","callMethod","tempError","stack","Proceeding","onLeave","sendHangup","sendPingToUsers","sendPingToBackend","getLocalAudioStream","isParticipating","extra","Provider","Plain","isBoostExpired","isRecordWhenCopilotActivePopupAlreadyShow","finish","pauseElement","addJoinedUsers","addInvitedUsers","failedUserId","setSignalingConnected","setReady","sendAllStreams","setDeclined","isAnyoneParticipating","peer","restart","onNegotiationNeeded","setUserAgent","userAgent","setConnectionOffer","connectionId","setConnectionAnswer","candidates","onUserMicrophoneState","onUserCameraState","onUserVideoPaused","holdOutgoingVideo","onUserRecordState","ASSOCIATED_ENTITY","onCustomMessage","onUserStateChanged","sendUserInviteTimeout","remoteReportsToShow","localReportsToShow","onUserStatsReceived","onConnectionQualityChanged","statsInterval","getPullClient","isPublishingSupported","isPublishingEnabled","retransmit","expiry","requestId","signalName","calling","inviteTimeout","declined","busy","failureReason","calculateState","pendingIceCandidates","localIceCandidates","trackList","answerTimeout","callingTimeout","connectionTimeout","signalingConnectionTimeout","candidatesTimeout","connectionOfferReplyTimeout","negotiationNeededReplyTimeout","reconnectAfterDisconnectTimeout","connectionAttempt","hasStun","hasTurn","_outgoingVideoTrack","outgoingVideoHoldState","_outgoingScreenTrack","_incomingAudioTrack","_incomingScreenAudioTrack","_incomingVideoTrack","_incomingScreenTrack","_mediaGetter","_mediaSetter","_onPeerConnectionIceCandidateHandler","_onPeerConnectionIceCandidate","_onPeerConnectionConnectionStateChangeHandler","_onPeerConnectionIceGatheringStateChangeHandler","_onPeerConnectionSignalingStateChangeHandler","_onPeerConnectionTrackHandler","_onPeerConnectionRemoveStreamHandler","_updateTracksDebounced","_waitTurnCandidatesTimeout","prevPercentPacketLostList","incomingPacketLost","outgoingPacketLost","screenShareBitrate","maxConnectionScore","incomingConnectionScore","outgoingConnectionScore","trackVariable","skipOffer","peerConnection","isInitiator","sendNegotiationNeeded","updateOutgoingTracks","applyResolutionScale","createAndSendOffer","screenTrack","outgoingVideoTrack","outgoingScreenTrack","tracksToSend","videoSender","screenSender","screenAudioSender","audioSender","rtpSender","getTransceivers","mid","factor","scaleFactor","rate","videoParams","screenParams","isRenegotiationSupported","getLocalStream","holdState","updateCalculatedState","internal","iceConnectionState","refreshSignalingTimeout","stopSignalingTimeout","previousState","networkProblem","incomingDataLoss","outgoingDataLoss","needCheckInputPacketLost","newIncomingConnectionDataLoss","newIncomingConnectionScore","calcNewConnectionScore","newOutgoingConnectionDataLoss","newOutgoingConnectionScore","dataLoss","sendIceCandidates","getSignaling","sendIceCandidate","peerConnectionId","stopStatisticsGathering","incomingAudioTrack","incomingScreenAudioTrack","incomingVideoTrack","incomingScreenTrack","isIceTricklingAllowed","toJSON","updateCandidatesTimeout","match","array_flip","_destroyPeerConnection","applyOfferAndSendAnswer","connectionConfig","_onConnectionOfferReplyTimeout","sendConnectionOffer","localDescription","getSenderMid","sharingAudio","_onNegotiationNeededReplyTimeout","sessionDescription","RTCSessionDescription","pendingRemoteSdpDelay","pendingRemoteSdp","applyPendingIceCandidates","sendConnectionAnswer","signalingState","iceRestart","urls","username","credential","startStatisticsGathering","connection","iceGatheringState","tr","currentDirection","receiver","repeatAnswer","clientEvents","emotion","showUsers","showAll","hideAll","scenarioEvents","viewerJoined","viewerLeft","BitrixCallEvent","onCallConference","MediaKinds","BitrixCall","localVideoShown","_classPrivateFieldInitSpec","__onPullEventAnswerSelf","setBusy","joinedElsewhere","lastSelfPingReceivedTimeout","lastPingReceivedTimeout","onSwitchTrackRecordStatus","isTrackRecordOn","MediaRenderer","screenShared","waitingLocalScreenShare","getUserMediaFulfilled","stopScreenShare","addMediaRenderer","removeMediaRenderer","onUserFloorRequest","requestActive","localVAD","requestFloor","sendTelemetryEvent","localUserState","startScreenShare","videoAllowedFrom","UserMnemonic","none","sendHideAll","sendShowUsers","floorRequestActive","logData","headers","joinedAsViewer","reinitPeers","removeCallEvents","usersToSendReports","statsIndexByRid","prevPeersWithBadConnection","peersWithBadConnection","isVideoShown","onToggleRemoteParticipantVideo","onUserEmotion","toUserId","setDirection","videoQuality","Quality","VeryHigh","_localUserState","clientEventsBound","_screenShared","pullEventHandlers","incomingVideoAllowed","allowedUserId","isIncomingVideoAllowed","onMediaRemoved","isMediaMutedBySystem","canChangeMediaDevices","resetMainStream","repeatOnConnect","sendShowAll","allowIncomingVideo","attachToConference","inviteParams","joinAsViewer","_outgoingAnswer","finishCall","sendFinish","_replaceVideoSharing","getState","bindCallEvents","on","toggleRemoteParticipantVideo","call_id","user_id","Bitrix","sendScreenState","enableSilentLogging","setLoggerCallback","backgroundCalling","mediaRenderers","showUser","joinRoom","leaveRoom","listRooms","requestRoomSpeaker","joinRoomOffer","transferRoomHost","listRoomsResponse","roomUpdated","VoximplantCallEvent","connectionRestoreTime","VoximplantCall","voximplantCall","muteMicrophone","unmuteMicrophone","VoxImplant","StreamManager","hideLocalVideo","sendVideo","renderer","trackLabel","EndpointEvents","InfoUpdated","warn","sendStat","transformVoxStats","updateRoom","onJoinRoomOffer","initiator","speakerChanged","_currentRoomId","rooms","previousSpeaker","onLeaveRoom","onJoinRoom","currentRoom","onTransferRoomSpeaker","logUrl","__resolveListRooms","debug","onMediaRenderEnabled","substring","onBadNetworkIndicator","onMediaRenderDisabled","onVoiceEnded","Voximplant","getClient","restClient","bindClientEvents","streamManager","MicAccessResult","Reconnecting","Reconnected","HardwareEvents","MediaRendererAdded","MediaRendererUpdated","BeforeMediaRendererRemoved","off","CameraManager","getInputDevices","setCallVideoSettings","constructCameraParams","AudioDeviceManager","setCallAudioSettings","inputId","impl","transceivers","VideoQuality","VIDEO_SIZE_HD","VIDEO_SIZE_nHD","facingMode","sendFloorRequest","sendEmotion","showLocalView","shareScreen","stopSharingScreen","voximplantClient","setDefaultVideoSettings","setDefaultAudioSettings","callConference","receiveVideo","customData","CallEvents","Disconnected","MessageReceived","shouldCollectStats","CallStatsReceived","EndpointAdded","sendJoinRoom","sendRequestRoomSpeaker","sendLeaveRoom","sendListRooms","removeClientEvents","showLocalVideo","setEndpoint","removeEndpointEventHandlers","waitForConnectionRestore","connectionRestoreTimeout","readyStack","bindEndpointEventHandlers","RemoteMediaAdded","RemoteMediaRemoved","VoiceStart","VoiceEnd","Removed","MediaRenderEnabled","MediaRenderDisabled","onConnectionRestoreTimeout","outboundAudio","outboundVideo","inboundAudio","inboundVideo","endpoints","getEndpoints","outbound","statGroup","stat","inbound","actualHeight","actualWidth","CallStub","lifetime","onDelete","deleteTimeout","SendOnly","Permanent","BitrixDev","Direction","Incoming","Outgoing","High","Medium","Low","VeryLow","onLocalMediaStopped","onListRooms","onUpdateRoom","onTransferRoomSpeakerRequest","onGetUserMediaEnded","createCall","createChildCall","getPublicChannels","getCall","Engine","calls","siteId","unknownCalls","pullClient","finishedCalls","addCustomEvent","rest","PULL","onCustomEvent","callType","callProvider","provider","getDefaultProvider","joinExisting","entityType","entityId","onCallCreated","isNew","callParameters","getError","error_description","createCallResponse","setUserData","publicChannels","setPublicIds","callFields","callFactory","TYPE","START_DATE","newProvider","newUsers","parentCall","chatDialogId","participantsCount","publicIds","__onPullEvent","location","href","server_time_ago","ID","PROVIDER","PARENT_ID","invitedUsers","getCallWithId","Messenger","Application","conference","inited","providerType","PlainCallFactory","BitrixCallFactory","VoximplantCallFactory","blankAvatar","usersInProcess","usersToUpdate","getDateForLog","getFullYear","lpad","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","str","chr","getUser","getUserCached","getUsers","getUserName","getUserAvatar","isBlank","getUserAvatars","getCustomMessage","messageText","convertKeysToUpper","placeHolder","obj","objectClone","k","u","appendChildren","child","containsVideoTrack","hasHdVideo","trackSettings","minWidth","minHeight","bestFilledArea","area","getFilledArea","elementHeight","bestWidth","bestHeight","rowCount","columnCount","maxElementWidth","maxElementHeight","ratio","neededRatio","expectedElementHeight","expectedElementWidth","isWebRTCSupported","webkitRTCPeerConnection","mozRTCPeerConnection","isFeedbackAllowed","shouldShowDocumentButton","getDocumentsArticleCode","getResumesArticleCode","getUserLimit","getClientSelfTestUrl","random","v","reportConnectionResult","connectionResult","ajax","runAction","req","XMLHttpRequest","setRequestHeader","withCredentials","op","host","query","buildQueryString","BXDesktopWindow","getBrowserForStatistics","IsOpera","endsWith","getConferenceProvider","codecId","currentReport","isLocal","bytes","bytesSent","bytesReceived","time","trunc","remoteReport","deltaPacketsSent","packetsSent","deltaPacketsLost","percentPacketLost","percentPacketLostTotal","currentPacketsLost","totalPercentPacketLost","deltaPacketsReceived","packetsReceived","colorList","returnInSeconds","nowDate","pauseTime","totalTime","second","hour","minute","padStart","getTimeText","startTime","getTimeInSeconds","isConferenceChatEnabled","link","isUserControlFeatureEnabled","isPictureInPictureFeatureEnabled","InternalEvents","setHasCamera","contentReady","IncomingNotification","callerAvatar","callerName","callerType","callerColor","hasCamera","isMessengerOpen","postponedEvents","onButtonClickHandler","onContentReadyHandler","isChatWindow","htmlContent","createTopmostWindow","IncomingNotificationContent","assign","createPopup","onResize","setMaxHeight","clientHeight","noAllPaddings","disableScroll","draggable","restrict","borderRadius","eventKeys","sendPostponedEvents","answerVideo","onHasCameraHandler","emitToMainWindow","callerPrefix","avatarClass","avatarImageStyles","avatarImageText","backgroundSize","backgroundPosition","decode","windowBottom","buttonsBlock","toggleMicrophoneIcon","toggleCameraIcon","append","withBlur","opener","callController","callNotification","setWindowPosition","STP_CENTER","STP_VCENTER","SidePanel","closeWindow","ConferenceNotifications","_onContentButtonClickHandler","_onContentButtonClick","NotificationConferenceContent","backgroundRepeat","_onSkipConferenceButtonClick","_onAnswerConferenceButtonClick","onBackToCallClick","onStopSharingClick","onChangeScreenClick","POPUP_WIDTH","POPUP_HEIGHT","POPUP_OFFSET_X","POPUP_OFFSET_Y","FloatingScreenShare","sharedWindowX","sharedWindowY","sharedWindowHeight","sharedWindowWidth","app","screens","screenToUse","_onBackToCallClickHandler","_onBackToCallClick","_onStopSharingClickHandler","_onStopSharingClick","_onChangeScreenClickHandler","_onChangeScreenClick","bindEventHandlers","ListScreenMedia","saveExistingScreens","getApiVersion","FloatingScreenShareContent","adjustWindow","dispatchEvent","blockOffset","popupPadding","leftBlockWidth","querySelector","centerBlockWidth","rightBlockWidth","fullWidth","X","Y","Mode","STP_FRONT","convertedParams","mainWindow","BXWindows","windowItem","DispatchCustomEvent","CallHint","getElementNode","callFolded","autoCloseDelay","buttonsLayout","autoCloseTimeout","onAutoClose","contentPadding","getPopupMessage","hotKeyMessage","hotkey","IsMac","onActionClick","PromoPopup","promoCode","dontShowAgain","subscribeToEvents","onCheckboxChange","PromoPopup3D","callView","openWindow","description","forceTop","forceLeft","btnText","openLearningPopup","onCloseClicked","Sidebar","contentContainer","RecordWithCopilotPopup","onClickYesButton","onClickNoButton","Dialogs","MessageBox","modal","popupOptions","WebScreenSharePopup","StrategyType","AllowAll","AllowNone","OnlySpeaker","CurrentlyTalking","HOLD_VIDEO_SECONDS","VideoStrategy","strategyType","onCallUserVoiceStartedHandler","onCallUserVoiceStarted","onCallUserVoiceStoppedHandler","onCallUserVoiceStopped","onCallViewSetCentralUserHandler","onCallViewSetCentralUser","onCallViewLayoutChangeHandler","onCallViewLayoutChange","allowVideoFrom","bindEvents","applyVideoLimit","talkingUsers","User","onActiveChanged","onUserActiveChanged","setTalking","removeEvents","turnOffVideoTimeout","cancelTurnOffVideo","updateActive","scheduleTurnOffVideo","sharing","newActive","CopilotPopup","updateCopilotState","getButton","sendAnalytics","copilotButton","popupType","onAIRestrictionsPopupShow","onViewStateChanged","onOpenVideoConference","onPromoViewed","onCallJoined","onCallLeft","onCallDestroyed","ViewState","Opened","Closed","DocumentType","Resume","Blank","FeatureState","Enabled","Disabled","Limited","DOC_EDITOR_WIDTH","DOC_TEMPLATE_WIDTH","DOC_CREATED_EVENT","DOCUMENT_PROMO_CODE","DOCUMENT_PROMO_DELAY","FILE_TYPE_DOCX","FILE_TYPE_XLSX","FILE_TYPE_PPTX","MASK_PROMO_CODE","MASK_PROMO_DELAY","CallController","needInit","incomingVideoStrategyType","formatRecordDate","messengerFacade","docEditor","docEditorIframe","maxEditorWidth","docCreatedForCurrentCall","folded","audioRingtone","SoundType","ringtoneModern","lastUsedCameraId","reconnectingCameraId","childCall","invitePopup","videoStrategy","isHttps","callWithLegacyMobile","featureScreenSharing","featureRecord","screenShareStartTime","callRecordState","callRecordType","callRecordInfo","autoCloseCallView","_callViewState","answeredOrDeclinedCalls","_onCallUserInvitedHandler","_onCallUserInvited","_onCallDestroyHandler","_onCallDestroy","_onCallUserStateChangedHandler","_onCallUserStateChanged","_onCallUserMicrophoneStateHandler","_onCallUserMicrophoneState","_onCallUserCameraStateHandler","_onCallUserCameraState","_onNeedResetMediaDevicesStateHandler","_onNeedResetMediaDevicesState","_onCameraPublishingHandler","_onCameraPublishing","_onMicrophonePublishingdHandler","_onMicrophonePublishingd","_onCallUserVideoPausedHandler","_onCallUserVideoPaused","_onCallLocalMediaReceivedHandler","_onCallLocalMediaReceived","_onCallLocalMediaStoppedHandler","_onCallLocalMediaStopped","_onCallLocalCameraFlipHandler","_onCallLocalCameraFlip","_onCallLocalCameraFlipInDesktopHandler","_onCallLocalCameraFlipInDesktop","_onCallRemoteMediaReceivedHandler","_onCallRemoteMediaReceived","_onCallRemoteMediaStoppedHandler","_onCallRemoteMediaStopped","_onCallBadNetworkIndicatorHandler","_onCallBadNetworkIndicator","_onCallConnectionQualityChangedHandler","_onCallConnectionQualityChanged","_onCallToggleRemoteParticipantVideoHandler","_onCallToggleRemoteParticipantVideo","_onCallUserVoiceStartedHandler","_onCallUserVoiceStarted","_onCallUserVoiceStoppedHandler","_onCallUserVoiceStopped","_onUserStatsReceivedHandler","_onUserStatsReceived","_onCallUserScreenStateHandler","_onCallUserScreenState","_onCallUserRecordStateHandler","_onCallUserRecordState","onCallUserFloorRequestHandler","_onCallUserFloorRequest","_onCallFailureHandler","_onCallFailure","_onNetworkProblemHandler","_onNetworkProblem","_onMicrophoneLevelHandler","_onMicrophoneLevel","_onReconnectingHandler","_onReconnecting","_onReconnectedHandler","_onReconnected","_onCustomMessageHandler","_onCustomMessage","_onJoinRoomOfferHandler","_onJoinRoomOffer","_onJoinRoomHandler","_onJoinRoom","_onLeaveRoomHandler","_onLeaveRoom","_onTransferRoomSpeakerHandler","_onTransferRoomSpeaker","_onCallLeaveHandler","_onCallLeave","_onCallJoinHandler","_onCallJoin","_onGetUserMediaEndedHandler","_onGetUserMediaEnded","_onUpdateLastUsedCameraIdHandler","_onUpdateLastUsedCameraId","_onSwitchTrackRecordStatusHandler","_onSwitchTrackRecordStatus","_onBeforeUnloadHandler","_onBeforeUnload","_onImTabChangeHandler","_onImTabChange","_onUpdateChatCounterHandler","_onUpdateChatCounter","_onChildCallFirstMediaHandler","_onChildCallFirstMedia","_onWindowFocusHandler","_onWindowFocus","_onWindowBlurHandler","_onWindowBlur","floatingWindow","FloatingVideo","onMainAreaClick","_onFloatingVideoMainAreaClick","_onFloatingVideoButtonClick","floatingWindowUser","showFloatingWindowTimeout","hideIncomingCallTimeout","ignoreDeclinedCallsTimeout","ignoreIncomingNotificationTimeouts","floatingScreenShareWindow","isThemeDark","_onFloatingScreenShareBackToCallClick","_onFloatingScreenShareStopClick","_onFloatingScreenShareChangeScreenClick","showFloatingScreenShareWindowTimeout","mutePopup","allowMutePopup","webScreenSharePopup","feedbackPopup","loopTimers","onIncomingCall","_onDeviceChange","setSharingData","voxMicAccessResult","garbage","currentCall","AnalyticsType","group","includeSelf","setTitle","getActiveCallUsers","setAvatars","setMicrophoneId","setCameraId","newCall","isCurrentCallActive","BXShowedIncomingCallNotification","checkDesktop","updateFloatingWindowContent","advanced","isConferencePageOpened","showIncomingConference","showIncomingCall","showNotification","removeVideoStrategy","isScreenSharingStarted","removeScreenUsers","updateCopilotFeatureState","updateCallViewUsers","updateDeviceIdInChildCall","answerChildCall","isVideoconf","newCallType","onJoinCall","videoconf","AnalyticsStatus","_onCallViewShow","_onCallViewClose","_onCallViewDestroy","_onCallViewButtonClick","_onCallViewBodyClick","_onCallViewReplaceCamera","_onCallViewReplaceMicrophone","_onCallViewSetCentralUser","_onCallViewChangeHdVideo","_onCallViewChangeMicAutoParams","_onCallViewChangeFaceImprove","_onCallViewOpenAdvancedSettings","_onCallViewReplaceSpeaker","_onCallViewHasMainStream","_onCallToggleSubscribe","_onCallUserClick","convertAllItemsToInt","arr","userListInt","userDataInt","notIncludedEl","setType","externalContainer","getContainer","insertBefore","updateCameraSettingsInCurrentCallAfterReconnecting","devicesList","setReconnectingCameraId","previousRecordType","isRecording","CallRecordStop","setRecordState","showButton","setUserMedia","setVideoRenderer","oldCall","onFinishCall","getCallType","privateToGroup","chatId","callUsersCount","getMaxActiveCallUsers","callLength","openMessenger","createVideoStrategy","_startRecordCall","Reflection","getClass","desktop","v2","Lib","DesktopManager","checkStatusInDifferentContext","desktopUtils","runningCheck","dialogId","tagPresent","LocalStorage","getSiteId","getConferencePageTag","allowVideo","chatType","avatarColor","getCallUsers","getMaxActiveMicrophonesCount","getDefaultZIndex","_onCallNotificationClose","_onCallNotificationDestroy","_onCallNotificationButtonClick","scheduleCancelNotification","repeatSound","_onCallConferenceNotificationButtonClick","isIncomingConference","noAnswer","notificationText","actions","Notification","Center","notify","autoHideDelay","closeButton","balloon","messageBox","MessageBoxButtons","OK_CANCEL","okCaption","cancelCaption","onOk","DesktopDownload","getLinkForCurrentUser","isRTCsupported","needBlockAddButton","showUserSelector","callData","preparedUserCall","withCopilot","isUserAgentSupported","showUnsupportedNotification","unfold","initCallPromise","isCallPrepared","debug1","_prepareLocalStream","createContainer","getBlockedButtons","bindCallViewEvents","setLocalStream","debug2","currentCallIsNew","leaveCurrentCall","_onUpdateCallCopilotState","sendStartCopilotRecordAnalytics","useHdVideo","getCurrentDialogId","showCopilotNotify","showDocumentPromo","showMaskPromo","onStartCall","success","section","AnalyticsSection","chatWindow","AnalyticsElement","videocall","showAutoMicMuteNotification","hasStreamFromCall","_stopLocalStream","chatList","joinButton","onRecordStop","subSection","AnalyticsSubSection","contextMenu","finishForAllButton","disconnectButton","recordTime","releaseLocalMedia","canRecord","isForceUse","newDeviceId","microphoneIds","deviceGroup","cameraIds","speakerIds","detached","fold","foldedCallTitle","setSize","callViewState","sidebar","toggleHidden","closePromo","containerWidth","clientWidth","editorWidth","callWidth","documentsMenu","onDocumentBtnClick","targetNodeWidth","resumesArticleCode","documentsArticleCode","onDocumentCreateAnalyticsEvent","resume","maybeShowDocumentEditor","doc","typeFile","sheet","presentation","onSubMenuShow","buildPreviousResumesSubmenu","newStyleOptions","PopupMenuWindow","subMenuOptions","documentType","onDocumentCreate","menuItem","resumeList","resumes","getSubMenu","addMenuItem","object","createDate","onLastResumeOpen","viewDocumentByLink","links","view","removeMenuItem","adjustSubMenu","showDocumentEditor","openAnimation","showPromoPopupTimeout","_createAndOpenSidebarWithIframe","loadExt","Disk","OnlyOfficeImIntegration","CreateDocument","dialog","delegate","setCallEditorMaxWidth","onDocumentCreated","_onDocumentCreated","promiseGetUrl","getIframeUrlForTemplates","getIframeUrlForCreate","getIframeUrl","viewerItem","closeDocumentEditor","alert","onDocumentClose","getDocumentType","onCloseIframe","removeMaxWidth","oldSidebar","removeContainer","findCallEditorWidth","onSideBarCloseClicked","loader","Loader","frameborder","border","margin","onDocumentUpload","onCancel","getData","documentPromoPopup","exitFullScreen","enterFullScreen","isSliderFocused","webkitRequestFullScreen","requestFullscreen","cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","exitFullscreen","isPromoRequired","documentButton","onDocumentPromoActionClicked","onDocumentPromoClosed","maskPromoPopup","showPromoPopup3dTimeout","stopRepeatSound","_onAnswerButtonClick","callPopup","answerButton","activateWindow","_ensureDocumentEditorClosed","blockAddUser","onAnswerConference","onDeclineConference","setButtonCounter","getMessageCount","findWindow","mediaDevicesResetStateHintBaloon","_closeReconnectionBaloon","_closeParticipantsVideoBaloon","copilotPopup","backdropFilter","_onCallViewHangupButtonClick","_onCallViewHangupOptionsButtonClick","_onCallViewCloseButtonClick","inviteUser","_onCallViewInviteUserButtonClick","toggleMute","_onCallViewToggleMuteButtonClick","toggleScreenSharing","_onCallViewToggleScreenSharingButtonClick","_onCallViewRecordButtonClick","toggleVideo","_onCallViewToggleVideoButtonClick","toggleSpeaker","_onCallViewToggleSpeakerButtonClick","showChat","_onCallViewShowChatButtonClick","_onCallViewFloorRequestButtonClick","showHistory","_onCallViewShowHistoryButtonClick","_onCallViewFullScreenButtonClick","_onCallViewDocumentButtonClick","microphoneSideIcon","_onCallViewMicrophoneSideIconClick","_onCallViewFeedbackButtonClick","_onCallViewCopilotButtonClick","onDisconnectCall","finishButton","hangupOptionsMenu","finishedForAll","onShowChat","onFloorRequest","floorState","getUserFloorRequestState","talkingState","getUserTalking","callViewFloorRequestTimeout","reconnectionBaloon","idleUsers","_getDisconnectedUsers","allowNewUsers","_onInvitePopupDestroy","_onInvitePopupSelect","inviteCloser","onToggleMicrophone","setAudioMuted","CallRecordMute","onRecordBtnClick","openHelpArticle","callRecordMenu","setIsRecordWhenCopilotActivePopupAlreadyShow","getMenuWindow","recordWhenCopilotActivePopup","CallRecordPause","newCopilotState","onAIRecordStatusChanged","isAIOn","showCopilotResultNotify","errors","handleCopilotError","showCopilotErrorNotify","isPlainCall","_onChangeStateCopilot","onAIRecordStart","onScreenShareBtnClick","CallRecordStopSharing","startScreenSharing","onToggleCamera","toggleRoomMenu","toggleRoomListMenu","Feedback","Form","forms","zones","sec","lang","presets","sender_page","call_type","call_amount","id_of_user","from_domain","origin","openHistory","toggleFullScreen","showDocumentsMenu","allowMicAutoParams","setCameraSmoothingStatus","openSettings","onlyPanel","callDetails","setUserConnectionQuality","newQuality","loopConnectionQuality","setUserState","blockSwitchCamera","blockScreenSharing","disableMediaSelection","unblockAddUser","clearConnectionQualityTimer","unblockButtonsList","isNeedUnblockCameraButton","isGetUserMediaFulfilled","showNetworkProblemNotification","setUserMicrophoneState","setUserCameraState","unblockSwitchCamera","blockSwitchMicrophone","unblockSwitchMicrophone","setUserVideoPaused","onScreenShareStarted","showWebScreenSharePopup","onScreenShareStopped","screenShareLength","getStreamType","fallback","setBadNetworkIndicator","toogleParticipantsVideoBaloon","isMutedPopupAllowed","showMicMutedNotification","setUserTalking","setUserStats","windowId","RecordSource","dialogName","callDate","format","fileName","onRecordStart","CallRecordStart","cropTop","cropBottom","shareMethod","recordButton","errorMessage","showFatalError","setMicrophoneLevel","onReconnect","showRoomJoinedPopup","setRoomState","showMicTakenFromPopup","showMicTakenByPopup","lastUserLeft","getCurrentDeviceList","onInviteUser","currentUsers","usersToInvite","totalUsers","hasActiveCall","returnValue","currentTab","allAddedDevice","allRemovedDevice","getRemovedUsedDevices","useDevicesInCurrentCall","removeDevicesFromCurrentCall","changeTab","setWidth","videoOptions","audioOptions","lastUserId","_onTestCallViewButtonClick","stream2","vad","s2","createUnmuteButton","Button","baseClass","EXTRA_SMALL","color","Color","LIGHT_BORDER","noCaps","onClickUser","roomMenu","roomSpeaker","speakerModel","avatarText","delimiter","leaveCurrentRoom","showRoomHelp","roomListMenu","roomList","prepareRoomListMenuItems","room","getRoomDescription","roomFields","userNames","isAuto","isSpeaker","userIdList","roomJoinedPopup","usersInRoom","LINK","fromUserId","micTakenFromPopup","byUserId","micTakenByPopup","lastCallDetails","vueInstance","titleBar","$destroy","template","Vue","createApp","methods","onFeedbackSent","getContentContainer","isConference"],"mappings":"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"}