this.BX=this.BX||{};this.BX.Call=this.BX.Call||{};(function(e,t,l,s,a,o,n,i,r,c,u,h,d,C,p,b,m,v){"use strict";let g=e=>e,_;var f=babelHelpers.classPrivateFieldLooseKey("getDelimiter");var L=babelHelpers.classPrivateFieldLooseKey("getVideoCallItem");var P=babelHelpers.classPrivateFieldLooseKey("getAudioCallItem");var M=babelHelpers.classPrivateFieldLooseKey("analyticsOnStartCallClick");var T=babelHelpers.classPrivateFieldLooseKey("getPersonalPhoneItem");var A=babelHelpers.classPrivateFieldLooseKey("getWorkPhoneItem");var I=babelHelpers.classPrivateFieldLooseKey("getInnerPhoneItem");var E=babelHelpers.classPrivateFieldLooseKey("getZoomItem");var B=babelHelpers.classPrivateFieldLooseKey("getUserPhoneHtml");var y=babelHelpers.classPrivateFieldLooseKey("isCallAvailable");var H=babelHelpers.classPrivateFieldLooseKey("getUser");var O=babelHelpers.classPrivateFieldLooseKey("isUser");var x=babelHelpers.classPrivateFieldLooseKey("requestCreateZoomConference");class N extends r.BaseMenu{constructor(){super();Object.defineProperty(this,x,{value:$});Object.defineProperty(this,O,{value:Z});Object.defineProperty(this,H,{value:V});Object.defineProperty(this,y,{value:K});Object.defineProperty(this,B,{value:j});Object.defineProperty(this,E,{value:D});Object.defineProperty(this,I,{value:U});Object.defineProperty(this,A,{value:X});Object.defineProperty(this,T,{value:k});Object.defineProperty(this,M,{value:S});Object.defineProperty(this,P,{value:w});Object.defineProperty(this,L,{value:R});Object.defineProperty(this,f,{value:F});this.id="bx-im-chat-header-call-menu"}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:4,offsetTop:5}}getMenuClassName(){return"bx-im-messenger__scope bx-call-chat-header-call-button__scope"}getMenuItems(){return[babelHelpers.classPrivateFieldLooseBase(this,L)[L](),babelHelpers.classPrivateFieldLooseBase(this,P)[P](),babelHelpers.classPrivateFieldLooseBase(this,E)[E](),babelHelpers.classPrivateFieldLooseBase(this,f)[f](),babelHelpers.classPrivateFieldLooseBase(this,T)[T](),babelHelpers.classPrivateFieldLooseBase(this,A)[A](),babelHelpers.classPrivateFieldLooseBase(this,I)[I]()]}}function F(){return{delimiter:true}}function R(){const e=babelHelpers.classPrivateFieldLooseBase(this,y)[y](this.context.dialogId);return{text:b.Loc.getMessage("CALL_CONTENT_CHAT_HEADER_VIDEOCALL"),onclick:()=>{if(!e){return}babelHelpers.classPrivateFieldLooseBase(this,M)[M](C.CallTypes.video.id);C.CallTypes.video.start(this.context.dialogId);this.emit(N.events.onMenuItemClick,C.CallTypes.video);this.menuInstance.close()},disabled:!e}}function w(){const e=babelHelpers.classPrivateFieldLooseBase(this,y)[y](this.context.dialogId);return{text:b.Loc.getMessage("CALL_CONTENT_CHAT_HEADER_CALL_MENU_AUDIO"),onclick:()=>{if(!e){return}babelHelpers.classPrivateFieldLooseBase(this,M)[M](C.CallTypes.audio.id);C.CallTypes.audio.start(this.context.dialogId);this.emit(N.events.onMenuItemClick,C.CallTypes.audio);this.menuInstance.close()},disabled:!e}}function S(e){d.Analytics.getInstance().onContextMenuStartCallClick({context:this.context,callType:e})}function k(){if(!babelHelpers.classPrivateFieldLooseBase(this,O)[O]()){return null}const{phones:e}=babelHelpers.classPrivateFieldLooseBase(this,H)[H]();if(!e.personalMobile){return null}const t=b.Loc.getMessage("CALL_CONTENT_CHAT_HEADER_CALL_MENU_PERSONAL_PHONE");return{className:"menu-popup-no-icon bx-call-chat-header-call-button-menu__item",html:babelHelpers.classPrivateFieldLooseBase(this,B)[B](t,e.personalMobile),onclick:()=>{a.Messenger.startPhoneCall(e.personalMobile);this.menuInstance.close()}}}function X(){if(!babelHelpers.classPrivateFieldLooseBase(this,O)[O]()){return null}const{phones:e}=babelHelpers.classPrivateFieldLooseBase(this,H)[H]();if(!e.workPhone){return null}const t=b.Loc.getMessage("CALL_CONTENT_CHAT_HEADER_CALL_MENU_WORK_PHONE");return{className:"menu-popup-no-icon bx-call-chat-header-call-button-menu__item",html:babelHelpers.classPrivateFieldLooseBase(this,B)[B](t,e.workPhone),onclick:()=>{a.Messenger.startPhoneCall(e.workPhone);this.menuInstance.close()}}}function U(){if(!babelHelpers.classPrivateFieldLooseBase(this,O)[O]()){return null}const{phones:e}=babelHelpers.classPrivateFieldLooseBase(this,H)[H]();if(!e.innerPhone){return null}const t=b.Loc.getMessage("CALL_CONTENT_CHAT_HEADER_CALL_MENU_INNER_PHONE_MSGVER_1");return{className:"menu-popup-no-icon bx-call-chat-header-call-button-menu__item",html:babelHelpers.classPrivateFieldLooseBase(this,B)[B](t,e.innerPhone),onclick:()=>{a.Messenger.startPhoneCall(e.innerPhone);this.menuInstance.close()}}}function D(){const e=h.FeatureManager.isFeatureAvailable(h.Feature.zoomActive);if(!e){return null}const t=["bx-call-chat-header-call-button-menu__zoom","menu-popup-no-icon"];const l=h.FeatureManager.isFeatureAvailable(h.Feature.zoomAvailable);if(!l){t.push("--disabled")}return{className:t.join(" "),text:b.Loc.getMessage("CALL_CONTENT_CHAT_HEADER_CALL_MENU_ZOOM"),onclick:()=>{if(!l){BX.UI.InfoHelper.show("limit_video_conference_zoom");return}babelHelpers.classPrivateFieldLooseBase(this,x)[x](this.context.dialogId);this.menuInstance.close()}}}function j(e,t){return b.Tag.render(_||(_=g`
			<span class="bx-call-chat-header-call-button-menu__phone_container">
				<span class="bx-call-chat-header-call-button-menu__phone_title">${0}</span>
				<span class="bx-call-chat-header-call-button-menu__phone_number">${0}</span>
			</span>
		`),e,t)}function K(e){if(c.CallManager.getInstance().hasActiveCurrentCall(e)){return true}if(c.CallManager.getInstance().hasActiveAnotherCall()){return false}const t=c.CallManager.getInstance().chatCanBeCalled(e);const l=i.PermissionManager.getInstance().canPerformActionByRole(n.ActionByRole.call,e);return t&&l}function V(){if(!babelHelpers.classPrivateFieldLooseBase(this,O)[O]()){return null}return o.Core.getStore().getters["users/get"](this.context.dialogId)}function Z(){return this.context.type===n.ChatType.user}function $(e){u.runAction(n.RestMethod.imV2CallZoomCreate,{data:{dialogId:e}}).catch((e=>{let t=b.Loc.getMessage("CALL_CONTENT_CHAT_HEADER_CALL_MENU_ZOOM_CREATE_ERROR");const l=e.some((e=>e.code==="ZOOM_CONNECTED_ERROR"));if(l){const e=`/company/personal/user/${o.Core.getUserId()}/social_services/`;t=b.Loc.getMessage("CALL_CONTENT_CHAT_HEADER_CALL_MENU_ZOOM_CONNECT_ERROR").replace("#HREF_START#",`<a href=${e}>`).replace("#HREF_END#","</>")}BX.UI.Notification.Center.notify({content:t})}))}N.events={onMenuItemClick:"onMenuItemClick"};const q={name:"CallButtonTitle",props:{text:{type:String,required:true},compactMode:{type:Boolean,default:false},copilotMode:{type:Boolean,default:false}},computed:{callButtonIconClasses(){return["bx-call-chat-header-call-button__icon",...this.copilotMode?["--copilot"]:[],...this.compactMode?["--compact"]:[]]}},template:`\n\t\t<div :class="callButtonIconClasses"></div>\n\t\t<div v-if="!compactMode" class="bx-call-chat-header-call-button__text">\n\t\t\t{{ text }}\n\t\t</div>\n\t`};const z={name:"CallButtonPromo",components:{CallPopupContainer:p.CallPopupContainer},emits:["close"],props:{bindElement:{type:Object,required:true}},data(){return{isAIConcertAccepted:m.CallAI.agreementAccepted}},computed:{getId(){return"call-ai-user-list-popup"},config(){return{width:380,padding:0,overlay:false,autoHide:false,closeByEsc:false,angle:{offset:b.Dom.getPosition(this.bindElement).width/2,position:"top"},closeIcon:true,bindElement:this.bindElement,offsetTop:28}},callButtonPromoText(){return this.isAIConcertAccepted?this.loc("CALL_CHAT_HEADER_BUTTON_PROMO_TEXT"):this.loc("CALL_CHAT_HEADER_BUTTON_PROMO_TEXT_WITHOUT_TOS")}},methods:{loc(e,t={}){return b.Loc.getMessage(e,t)}},template:`\n\t\t<CallPopupContainer\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t\t:id="getId"\n\t\t>\n\t\t\t<div class='bx-call-chat-header-call-button__promo-container'>\n                <div class='bx-call-chat-header-call-button__promo-title'>\n                    {{ loc('CALL_CHAT_HEADER_BUTTON_PROMO_TITLE') }}\n                </div>\n                <div class='bx-call-chat-header-call-button__promo-text'>\n                    {{ callButtonPromoText }}\n                </div>\n\t\t\t</div>\n\t\t</CallPopupContainer>\n\t`};const W=3;const G={name:"PulseAnimation",props:{showPulse:{type:Boolean,default:true},isConference:{type:Boolean,default:false}},computed:{rings(){if(!this.showPulse){return[]}return Array.from({length:W})}},template:`\n\t\t<div class="bx-call-pulse-animation__container">\n\t\t\t<slot />\n\t\t\t<div v-for="ring in rings" class="bx-call-pulse-animation__ring" :class="{'--conference': isConference}"></div>\n\t\t</div>\n\t`};const J={directives:{hint:v.hint},components:{CallButtonTitle:q,CallButtonPromo:z,PulseAnimation:G},props:{dialog:{type:Object,required:true},compactMode:{type:Boolean,default:false}},data(){return{lastCallType:"",copilotMinUserLimit:m.CallAI.recordingMinUsers,isCopilotActive:m.CallAI.serviceEnabled,isTariffAvailable:m.CallAI.tariffAvailable,showPromo:false,showPromoTimer:null,promoId:"call:copilot-call-button:29102024:all"}},computed:{dialogId(){return this.dialog.dialogId},chatId(){return this.dialog.chatId},userCount(){return this.dialog.userCounter},isConference(){return this.dialog.type===n.ChatType.videoconf},callButtonText(){const e=C.CallTypes[this.lastCallType].locCode;return this.loc(e)},hasActiveCurrentCall(){return c.CallManager.getInstance().hasActiveCurrentCall(this.dialogId)},hasActiveAnotherCall(){return c.CallManager.getInstance().hasActiveAnotherCall(this.dialogId)},isActive(){if(this.hasActiveCurrentCall){return true}if(this.hasActiveAnotherCall){return false}return c.CallManager.getInstance().chatCanBeCalled(this.dialogId)},userLimit(){return c.CallManager.getInstance().getCallUserLimit()},isChatUserLimitExceeded(){return c.CallManager.getInstance().isChatUserLimitExceeded(this.dialogId)},shouldShowMenu(){return this.isActive},hintContent(){if(!this.isChatUserLimitExceeded){return null}return{text:this.loc("IM_LIB_CALL_USER_LIMIT_EXCEEDED_TOOLTIP",{"#USER_LIMIT#":this.userLimit}),popupOptions:{bindOptions:{position:"bottom"},angle:{position:"top"},targetContainer:document.body,offsetLeft:63,offsetTop:0}}},isCopilotCall(){return this.isCopilotActive&&this.userCount>=this.copilotMinUserLimit&&!this.isConference&&this.isTariffAvailable},callButtonContainerClasses(){return["bx-call-chat-header-call-button__scope","bx-call-chat-header-call-button__container",...this.isConference?["--conference"]:[],...this.isCopilotCall?["--copilot"]:[],...!this.isActive?["--disabled"]:[]]},canShowPromo(){return this.isCopilotCall&&s.PromoManager.getInstance().needToShow(this.promoId)&&!this.hasActiveCurrentCall&&this.isActive}},created(){this.lastCallType=this.getLastCallChoice();this.subscribeToMenuItemClick();t.EventEmitter.subscribe("BX.Call.View:onShow",this.onShowCallView)},mounted(){this.showPromoTimer=setTimeout((()=>{this.showPromo=this.canShowPromo}),2e4)},beforeUnmount(){this.clearShowPromoTimer();this.showPromo=false;t.EventEmitter.unsubscribe("BX.Call.View:onShow",this.onShowCallView)},methods:{startVideoCall(){if(!this.isActive){return}a.Messenger.startVideoCall(this.dialogId)},subscribeToMenuItemClick(){this.getCallMenu().subscribe(N.events.onMenuItemClick,(e=>{const{id:t}=e.getData();this.saveLastCallChoice(t)}))},onShowCallView(){this.onClosePromo()},onButtonClick(){if(!this.isActive){return}if(this.isCopilotCall){this.onClosePromo()}d.Analytics.getInstance().onChatHeaderStartCallClick({dialog:this.dialog,callType:this.lastCallType});C.CallTypes[this.lastCallType].start(this.dialogId)},onMenuClick(){if(!this.shouldShowMenu){return}this.getCallMenu().openMenu(this.dialog,this.$refs.menu)},onStartConferenceClick(){if(!this.isActive){return}if(this.isCopilotCall){this.onClosePromo()}d.Analytics.getInstance().onStartConferenceClick({chatId:this.chatId});a.Messenger.openConference({code:this.dialog.public.code})},getLastCallChoice(){return l.LocalStorageManager.getInstance().get(n.LocalStorageKey.lastCallType,C.CallTypes.video.id)},saveLastCallChoice(e){this.lastCallType=e;l.LocalStorageManager.getInstance().set(n.LocalStorageKey.lastCallType,e)},getCallMenu(){if(!this.callMenu){this.callMenu=new N}return this.callMenu},loc(e,t={}){return b.Loc.getMessage(e,t)},onClosePromo(){this.clearShowPromoTimer();this.showPromo=false;s.PromoManager.getInstance().markAsWatched(this.promoId)},clearShowPromoTimer(){clearTimeout(this.showPromoTimer);this.showPromoTimer=null}},template:`\n\t\t<PulseAnimation :showPulse="showPromo" :isConference="isConference">\n\t\t\t<div\n\t\t\t\tv-if="isConference"\n\t\t\t\t:class="callButtonContainerClasses"\n\t\t\t\t@click="onStartConferenceClick"\n\t\t\t\tref="call-button"\n\t\t\t>\n\t\t\t\t<CallButtonTitle :compactMode="compactMode" :copilotMode="isCopilotCall" :text="loc('IM_CONTENT_CHAT_HEADER_START_CONFERENCE')" />\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-else\n\t\t\t\t:class="callButtonContainerClasses"\n\t\t\t\tv-hint="hintContent"\n\t\t\t\t@click="onButtonClick"\n\t\t\t\tref="call-button"\n\t\t\t>\n\t\t\t\t<CallButtonTitle :compactMode="compactMode" :copilotMode="isCopilotCall" :text="callButtonText" />\n\t\t\t\t<div class="bx-call-chat-header-call-button__separator"></div>\n\t\t\t\t<div class="bx-call-chat-header-call-button__chevron_container" @click.stop="onMenuClick">\n\t\t\t\t\t<div class="bx-call-chat-header-call-button__chevron" ref="menu"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<CallButtonPromo\n\t\t\t\tv-if="showPromo"\n\t\t\t\t:bindElement="$refs['call-button']"\n\t\t\t\t@close="onClosePromo"\n\t\t\t/>\n\t\t</PulseAnimation>\n\t`};e.CallButton=J})(this.BX.Call.Component=this.BX.Call.Component||{},BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Call.Lib,BX.Call.Const,BX.Call.Component.Elements,BX,BX.Call,BX.Vue3.Directives);
//# sourceMappingURL=call-button.bundle.map.js