function __logShowPostMenu(e,t,n,i,a,o,s,r,l,d){var f=null;var c=null;var p=null;if(!BX.type.isDomNode(e)&&BX.type.isPlainObject(e)){var u=e;e=u.bindElement;p=u.menuElement;t=u.ind}else{p=e}BX.PopupMenu.destroy("post-menu-"+t);var B=e.closest("[data-livefeed-post-pinned]");r=typeof r!=="undefined"?parseInt(r):0;if(r<=0){r=parseInt(p.getAttribute("data-log-entry-log-id"))}if(r<=0){return false}if(typeof l==="undefined"){l=p.getAttribute("data-log-entry-favorites")==="Y"}if(typeof d==="undefined"){d=p.getAttribute("data-bx-items");try{d=JSON.parse(d);if(!BX.type.isPlainObject(d)){d={}}}catch(e){d={}}}if(B){var m=B.getAttribute("data-livefeed-post-pinned")=="Y";f={text:m?BX.message("SONET_EXT_LIVEFEED_MENU_TITLE_PINNED_Y"):BX.message("SONET_EXT_LIVEFEED_MENU_TITLE_PINNED_N"),className:"menu-popup-no-icon",onclick:function(t){BX.Livefeed.PinnedPanelInstance.changePinned({logId:r,newState:m?"N":"Y",event:t,node:e});this.popupWindow.close();t.preventDefault()}}}if(BX.message("sonetLbUseFavorites")!="N"){c={text:l?BX.message("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_Y"):BX.message("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_N"),className:"menu-popup-no-icon",onclick:function(e){__logChangeFavorites(r,"log_entry_favorites_"+r,l?"N":"Y",true,e);return BX.PreventDefault(e)}}}var X=[f,c,p.getAttribute("data-log-entry-url").length>0?{html:'<span id="post-menu-'+t+'-href-text">'+BX.message("sonetLMenuHref")+"</span>",className:"menu-popup-no-icon feed-entry-popup-menu feed-entry-popup-menu-href",href:p.getAttribute("data-log-entry-url")}:null,p.getAttribute("data-log-entry-url").length>0?{html:'<span id="post-menu-'+t+'-link-text">'+BX.message("sonetLMenuLink")+"</span>"+'<span id="post-menu-'+t+'-link-icon-animate" class="post-menu-link-icon-wrap">'+'<span class="post-menu-link-icon" id="post-menu-'+t+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",className:"menu-popup-no-icon feed-entry-popup-menu feed-entry-popup-menu-link",onclick:function(){var e="post-menu-"+t+"-link",n=BX(e+"-text"),i=BX(e+"-icon-done");if(BX.clipboard.isCopySupported()){if(n&&n.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(p.getAttribute("data-log-entry-url"));if(n&&i){i.style.display="inline-block";BX.removeClass(BX(e+"-icon-animate"),"post-menu-link-icon-animate");BX.adjust(BX(e+"-text"),{attrs:{"data-block-click":"Y"}});setTimeout(function(){BX.addClass(BX(e+"-icon-animate"),"post-menu-link-icon-animate")},1);setTimeout(function(){BX.adjust(BX(e+"-text"),{attrs:{"data-block-click":"N"}})},500)}return}var a=BX.proxy_context,o=parseInt(!!a.getAttribute("bx-height")?a.getAttribute("bx-height"):a.offsetHeight);if(a.getAttribute("bx-status")!="shown"){a.setAttribute("bx-status","shown");if(!BX(e)&&!!BX(e+"-text")){var s=BX(e+"-text"),r=BX.pos(s),l=BX.pos(s.parentNode);pos3=BX.pos(BX.findParent(s,{className:"menu-popup-item"},true));r["height"]=l["height"]-1;BX.adjust(a,{attrs:{"bx-height":a.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:e},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:e+"-input",type:"text",value:p.getAttribute("data-log-entry-url")},style:{height:r["height"]+"px",width:pos3["width"]-21+"px"},events:{click:function(e){this.select();BX.PreventDefault(e)}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX.fx({time:.2,step:.05,type:"linear",start:o,finish:o*2,callback:BX.delegate(function(e){this.style.height=e+"px"},a)}).start();BX.fx.show(BX(e),.2);BX(e+"-input").select()}else{a.setAttribute("bx-status","hidden");new BX.fx({time:.2,step:.05,type:"linear",start:a.offsetHeight,finish:o,callback:BX.delegate(function(e){this.style.height=e+"px"},a)}).start();BX.fx.hide(BX(e),.2)}}}:null,BX.message("sonetLCanDelete")=="Y"?{text:BX.message("sonetLMenuDelete"),className:"menu-popup-no-icon",onclick:function(e){if(confirm(BX.message("sonetLMenuDeleteConfirm"))){__logDelete(r,"log-entry-"+r,t)}return BX.PreventDefault(e)}}:null,p.getAttribute("data-log-entry-createtask")=="Y"?{text:BX.message("sonetLMenuCreateTask"),className:"menu-popup-no-icon",onclick:function(e){oLF.createTask({entryEntityType:p.getAttribute("data-log-entry-entity-type"),entityType:p.getAttribute("data-log-entry-entity-type"),entityId:p.getAttribute("data-log-entry-entity-id"),logId:parseInt(p.getAttribute("data-log-entry-log-id"))});this.popupWindow.close();return e.preventDefault()}}:null];if(!!d&&BX.type.isArray(d)){for(var h=0;h<d.length;h++)if(typeof d[h].className=="undefined")d[h].className="menu-popup-no-icon";X=BX.util.array_merge(X,d)}var _={offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupShow:function(e){if(BX("log_entry_favorites_"+r)){var n=BX.findChildren(e.contentContainer,{className:"menu-popup-item-text"},true);if(n!=null){for(var i=0;i<n.length;i++){if(n[i].innerHTML==BX.message("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_Y")||n[i].innerHTML==BX.message("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_N")){var a=n[i];break}}}if(a!=undefined){if(BX.hasClass(BX("log_entry_favorites_"+r),"feed-post-important-switch-active"))BX(a).innerHTML=BX.message("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_Y");else BX(a).innerHTML=BX.message("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_N")}}if(BX("post-menu-"+t+"-link")){var o=BX.findChild(e.popupContainer,{className:"feed-entry-popup-menu-link"},true,false);if(o){var s=parseInt(!!o.getAttribute("bx-height")?o.getAttribute("bx-height"):0);if(s>0){BX("post-menu-"+t+"-link").style.display="none";o.setAttribute("bx-status","hidden");o.style.height=s+"px"}}}}}};BX.PopupMenu.show("post-menu-"+t,e,X,_)}function __logGetNextPageLinkEntities(e,t){if(!!window.__logGetNextPageFormName&&!!e&&!!t&&!!window["UC"]&&!!window["UC"][window.__logGetNextPageFormName]&&!!window["UC"][window.__logGetNextPageFormName].linkEntity){window["UC"][window.__logGetNextPageFormName].linkEntity(e);for(var n in t){if(!!n&&t.hasOwnProperty(n)&&!!t[n]){window["UC"][window.__logGetNextPageFormName].entitiesCorrespondence[n]=t[n]}}}}function __logChangeFavorites(e,t,n,i,a){BX.Livefeed.FeedInstance.changeFavorites({logId:e,node:t,newState:n,fromMenu:!!i,event:a})}function __logDelete(e,t,n){if(!e){return}if(!BX(t)){return}BX.ajax.runAction("socialnetwork.api.livefeed.deleteEntry",{data:{logId:e},analyticsLabel:{b24statAction:"deleteLogEntry"}}).then(function(e){if(e.data.success){if(typeof n!="undefined"){BX.PopupMenu.destroy("post-menu-"+n)}__logDeleteSuccess(BX(t))}else{__logDeleteFailure(BX(t))}},function(e){__logDeleteFailure(BX(t))})}function __logDeleteSuccess(e){if(typeof e=="undefined"||!e||!BX(e)){return}new BX.fx({time:.5,step:.05,type:"linear",start:BX(e).offsetHeight,finish:56,callback:BX.delegate(function(e){this.style.height=e+"px"},BX(e)),callback_start:BX.delegate(function(){this.style.overflow="hidden";this.style.minHeight=0},BX(e)),callback_complete:BX.delegate(function(){this.style.marginBottom=0;BX.cleanNode(this);BX.addClass(this,"feed-post-block-deleted");this.appendChild(BX.create("DIV",{props:{className:"feed-add-successfully"},children:[BX.create("span",{props:{className:"feed-add-info-text"},children:[BX.create("span",{props:{className:"feed-add-info-icon"}}),BX.create("span",{html:BX.message("SONET_EXT_LIVEFEED_DELETE_SUCCESS")})]})]}))},BX(e))}).start()}function __logDeleteFailure(e){if(typeof e=="undefined"||!e||!BX(e)){return}e.insertBefore(BX.create("DIV",{props:{className:"feed-add-error"},style:{marginLeft:"84px",marginRight:"37px",marginTop:"18px",marginBottom:"4px"},children:[BX.create("span",{props:{className:"feed-add-info-text"},children:[BX.create("span",{props:{className:"feed-add-info-icon"}}),BX.create("span",{html:BX.message("sonetLMenuDeleteFailure")})]})]}),e.firstChild)}window.__socOnUCFormClear=function(e){LHEPostForm.reinitDataBefore(e.editorId)};window.__socOnUCFormAfterShow=function(e,t,n){n=!!n?n:{};var i=e.entitiesCorrespondence[e.id.join("-")][0],a=e.entitiesCorrespondence[e.id.join("-")][1];BX.show(BX("feed_comments_block_"+i));BX.onCustomEvent(window,"OnBeforeSocialnetworkCommentShowedUp",["socialnetwork"]);e.form.action=e.url.replace(/\#eId\#/,i).replace(/\#id\#/,a);var o={ENTITY_XML_ID:e.id[0],ENTITY_TYPE:e.entitiesId[e.id[0]][0],ENTITY_ID:e.entitiesId[e.id[0]][1],parentId:e.id[1],comment_post_id:e.entitiesId[e.id[0]][1],edit_id:e.id[1],act:e.id[1]>0?"edit":"add",logId:e.entitiesId[e.id[0]][2]};for(var s in o){if(!e.form[s]){e.form.appendChild(BX.create("INPUT",{attrs:{name:s,type:"hidden"}}))}e.form[s].value=o[s]}__socOnLightEditorShow(t,n)};window.__socOnUCFormSubmit=function(e,t){t["r"]=Math.floor(Math.random()*1e3);t["sessid"]=BX.bitrix_sessid();t["log_id"]=e.entitiesCorrespondence[e.id.join("-")][0];t["p_smile"]=BX.message("sonetLPathToSmile");t["p_ubp"]=BX.message("sonetLPathToUserBlogPost");t["p_gbp"]=BX.message("sonetLPathToGroupBlogPost");t["p_umbp"]=BX.message("sonetLPathToUserMicroblogPost");t["p_gmbp"]=BX.message("sonetLPathToGroupMicroblogPost");t["p_user"]=BX.message("sonetLPathToUser");t["p_le"]=BX.message("sonetLEPath");t["f_id"]=BX.message("sonetLForumID");t["bapc"]=BX.message("sonetLBlogAllowPostCode");t["site"]=BX.message("SITE_ID");t["lang"]=BX.message("LANGUAGE_ID");t["nt"]=BX.message("sonetLNameTemplate");t["sl"]=BX.message("sonetLShowLogin");t["as"]=BX.message("sonetLAvatarSizeComment");t["dtf"]=BX.message("sonetLDateTimeFormat");t["message"]=t["REVIEW_TEXT"];t["action"]="add_comment";t["RATING_TYPE"]=BX.message("sonetRatingType");t["pull"]="Y";t["crm"]=BX.message("sonetLIsCRM");e.form["bx-action"]=e.form.action;e.form.action=BX.message("sonetLESetPath")};window.__socOnUCFormResponse=function(e,t){e.form.action=e.form["bx-action"];var n={errorMessage:t},i=e.entitiesCorrespondence[e.id.join("-")][0],a={};if(!(!!t&&typeof t=="object")){}else if(t[0]=="*"){n={errorMessage:BX.message("sonetLErrorSessid")}}else if(t["status"]=="error")n["errorMessage"]=t["message"];else{if(!(t["commentID"]>0)||!!t["strMessage"]){n["errorMessage"]=t["strMessage"]}else if(t["return_data"]){n=t["return_data"]}else{var o=t["arCommentFormatted"],s=t["arComment"],r=!!window["__logBuildRating"]?window["__logBuildRating"](t["arComment"],t["arCommentFormatted"]):null,l=!!s["SOURCE_ID"]?s["SOURCE_ID"]:s["ID"];a={ID:l,ENTITY_XML_ID:e.id[0],FULL_ID:[e.id[0],l],NEW:"N",APPROVED:"Y",POST_TIMESTAMP:t["timestamp"]-BX.message("USER_TZ_OFFSET"),POST_TIME:o["LOG_TIME_FORMAT"],POST_DATE:o["LOG_TIME_FORMAT"],"~POST_MESSAGE_TEXT":o["MESSAGE"],POST_MESSAGE_TEXT:o["MESSAGE_FORMAT"],PANELS:{MODERATE:false},URL:{LINK:typeof s["URL"]!="undefined"&&s["URL"]!=null&&s["URL"].length>0?s["URL"]:BX.message("sonetLEPath").replace("#log_id#",s["LOG_ID"])+"?commentId="+s["ID"]+"#com"+(parseInt(s["SOURCE_ID"])>0?s["SOURCE_ID"]:s["ID"])},AUTHOR:{ID:o["USER_ID"],NAME:o["CREATED_BY"]["FORMATTED"],URL:o["CREATED_BY"]["URL"],AVATAR:o["AVATAR_SRC"]},BEFORE_ACTIONS:!!r?r:"",AFTER:o["UF"]};if(typeof t["hasEditCallback"]!="undefined"&&t["hasEditCallback"]=="Y"){a["PANELS"]["EDIT"]="Y";a["URL"]["EDIT"]="__logEditComment('"+e.id[0]+"', '"+s["ID"]+"', '"+s["LOG_ID"]+"');"}if(typeof t["hasDeleteCallback"]!="undefined"&&t["hasDeleteCallback"]=="Y"){a["PANELS"]["DELETE"]="Y";a["URL"]["DELETE"]=BX.message("sonetLESetPath")+"?lang="+BX.message("LANGUAGE_ID")+"&action=delete_comment&delete_comment_id="+s["ID"]+"&post_id="+s["LOG_ID"]+"&site="+BX.message("SITE_ID")}n={errorMessage:"",okMessage:"",status:true,message:"",messageCode:o["MESSAGE"],messageId:[e.id[0],l],"~message":"",messageFields:a}}var d=BX("log_entry_follow_"+i,true),f=!!d?d.getAttribute("data-follow")=="Y"?"Y":"N":false;if(f=="N"){BX.findChild(d,{tagName:"a"}).innerHTML=BX.message("sonetLFollowY");d.setAttribute("data-follow","Y")}d=BX("feed-comments-all-cnt-"+i,true),val=!!d?d.innerHTML.length>0?parseInt(d.innerHTML):0:false;if(val!==false)d.innerHTML=val+1}e.OnUCFormResponseData=n};window.__socOnLightEditorShow=function(e,t){var n={};if(t["arFiles"]){var i={},a,o;for(var s=0;s<t["arFiles"].length;s++){a=BX.findChild(BX("wdif-doc-"+t["arFiles"][s]),{className:"feed-com-file-name"},true);o=BX.findChild(BX("wdif-doc-"+t["arFiles"][s]),{className:"feed-con-file-size"},true);i["F"+s]={FILE_ID:t["arFiles"][s],FILE_NAME:a?a.innerHTML:"noname",FILE_SIZE:o?o.innerHTML:"unknown",CONTENT_TYPE:"notimage/xyz"}}n["UF_SONET_COM_DOC"]={USER_TYPE_ID:"file",FIELD_NAME:"UF_SONET_COM_FILE[]",VALUE:i}}if(t["arDocs"])n["UF_SONET_COM_FILE"]={USER_TYPE_ID:"webdav_element",FIELD_NAME:"UF_SONET_COM_DOC[]",VALUE:BX.clone(t["arDocs"])};if(t["arDFiles"])n["UF_SONET_COM_FILE"]={USER_TYPE_ID:"disk_file",FIELD_NAME:"UF_SONET_COM_DOC[]",VALUE:BX.clone(t["arDFiles"])};LHEPostForm.reinitData(SLEC.editorId,e,n)};BitrixLF=function(){this.bLoadStarted=null;this.nextURL=null;this.scrollInitialized=null;this.bStopTrackNextPage=null;this.arMoreButtonID=null;this.logAjaxMode=null;this.nodeTmp1Cap=null;this.cmdPressed=null;this.nextPageFirst=null;this.firstPageLastTS=0;this.firstPageLastId=0;this.filterId=null;this.filterApi=null;this.tagEntryIdList=[];this.inlineTagNodeList=[];this.signedParameters="";this.componentName=""};BitrixLF.prototype.initOnce=function(e){var t=BX("feed-loader-container");if(BX.type.isNotEmptyString(e.signedParameters)){this.signedParameters=e.signedParameters}if(BX.type.isNotEmptyString(e.componentName)){this.componentName=e.componentName}if(t){BX.bind(t,"animationend",BX.proxy(this._onAnimationEnd,this));BX.bind(t,"webkitAnimationEnd",BX.proxy(this._onAnimationEnd,this));BX.bind(t,"oanimationend",BX.proxy(this._onAnimationEnd,this));BX.bind(t,"MSAnimationEnd",BX.proxy(this._onAnimationEnd,this))}BX.addCustomEvent("BX.Livefeed.Filter:beforeApply",BX.delegate(function(e,t){this.showRefreshFade()},this));BX.addCustomEvent("BX.Livefeed.Filter:apply",BX.delegate(function(e,t,n){if(typeof n!="undefined"){n.autoResolve=false}this.refresh({useBXMainFilter:"Y"},t)},this));BX.addCustomEvent("BX.Livefeed.Filter:searchInput",BX.delegate(function(e){if(typeof e!="undefined"&&BX.util.trim(e).length>0){this.showRefreshFade()}else{this.hideRefreshFade()}},this));BX.addCustomEvent("BX.Forum.Spoiler:toggle",this.processForumSpoilerToggle.bind(this));if(typeof e!="undefined"&&typeof e.crmEntityTypeName!="undefined"&&e.crmEntityTypeName.length>0&&typeof e.crmEntityId!="undefined"&&parseInt(e.crmEntityId)>0){BX.addCustomEvent("onAfterActivitySave",BX.delegate(function(){this.refresh()},this))}if(typeof e!="undefined"&&typeof e.filterId!="undefined"&&typeof BX.Main!="undefined"&&typeof BX.Main.filterManager!="undefined"){var n=BX.Main.filterManager.getById(e.filterId);this.filterId=e.filterId;if(n){this.filterApi=n.getApi()}}BX.UserContentView.init();BX("log_internal_container").addEventListener("click",BX.delegate(function(e){var t=BX.getEventTarget(e).getAttribute("bx-tag-value");if(BX.type.isNotEmptyString(t)){if(this.clickTag(t)){e.preventDefault()}}},this),true);var i=BX("feed-notification-notasks-close-btn"),a=BX("feed-notification-notasks-read-btn");if(i){BX.bind(i,"click",this.setNoTasksNotificationRead.bind(this))}if(a){BX.bind(a,"click",this.setNoTasksNotificationRead.bind(this))}};BitrixLF.prototype.init=function(e){this.bLoadStarted=false;this.nextURL=false;this.scrollInitialized=false;this.bStopTrackNextPage=false;this.arMoreButtonID=[];this.logAjaxMode=false;this.nodeTmp1Cap=false;this.cmdPressed=false;this.nextPageFirst=true;this.useBXMainFilter="N";if(BX.Livefeed&&BX.Livefeed.InformerInstance){BX.Livefeed.InformerInstance.lockCounterAnimation=false}BX.addCustomEvent("onFrameDataProcessed",function(){if(BX.Livefeed&&BX.Livefeed.InformerInstance){BX.Livefeed.InformerInstance.lockCounterAnimation=false}});if(typeof e!="undefined"){this.firstPageLastTS=typeof e.firstPageLastTS!="undefined"?e.firstPageLastTS:0;this.firstPageLastId=typeof e.firstPageLastId!="undefined"?e.firstPageLastId:0;this.useBXMainFilter=typeof e.useBXMainFilter!="undefined"?e.useBXMainFilter:"N"}};BitrixLF.prototype.initScroll=function(){if(this.scrollInitialized){return}this.scrollInitialized=true;BX.bind(window,"scroll",BX.throttle(BX.delegate(this.onFeedScroll,this),100))};BitrixLF.prototype.onFeedScroll=function(){var e=BX.GetWindowSize();if(this.bStopTrackNextPage==false){var t=e.scrollHeight-e.innerHeight-500;if(e.scrollTop>=t&&oLF.nextURL){this.bStopTrackNextPage=true;this.getNextPage()}}BX.Livefeed.InformerInstance.onFeedScroll()};BitrixLF.prototype.onFeedKeyDown=function(e){if(e==null){e=window.event}if(BX.util.in_array(e.keyCode,[224,91,93])){this.cmdPressed=true}};BitrixLF.prototype.onFeedKeyUp=function(e){if(e==null){e=window.event}if(BX.util.in_array(e.keyCode,[224,91,93])){this.cmdPressed=false}else if(e.keyCode==35||this.cmdPressed&&e.keyCode==39){this.bStopTrackNextPage=true;this.getNextPage()}};BitrixLF.prototype.getNextPage=function(){var e=BX("feed-new-message-inf-wrap");if(this.bLoadStarted){return false}this.bLoadStarted=true;BX.Livefeed.InformerInstance.lockCounterAnimation=true;this.arMoreButtonID=[];if(!this.nextPageFirst&&e){e.style.display="block"}else if(this.nextPageFirst){BX.addClass(BX("feed-new-message-inf-wrap-first"),"feed-new-message-inf-wrap-first-visible")}var t=new BX.Uri(this.nextURL);var n=t.getQueryParams();var i=1;var a="";var o=0;var s="N";var r=null;for(var l in n){if(!n.hasOwnProperty(l)){continue}r=l.match(/^PAGEN_(\d+)$/i);if(r){i=parseInt(n[l])}else if(l=="pplogid"){a=decodeURI(n[l])}else if(l=="ts"){o=n[l]}else if(l=="noblog"){s=n[l]}}var d={PAGE_NUMBER:i,LAST_LOG_TIMESTAMP:o,PREV_PAGE_LOG_ID:a,siteTemplateId:BX.message("sonetLSiteTemplateId"),useBXMainFilter:this.useBXMainFilter,preset_filter_top_id:BX.type.isNotEmptyString(n["preset_filter_top_id"])&&n["preset_filter_top_id"]!=="0"?n["preset_filter_top_id"]:"",preset_filter_id:BX.type.isNotEmptyString(n["preset_filter_id"])&&n["preset_filter_id"]!=="0"?n["preset_filter_id"]:""};var f={c:this.componentName,logajax:"Y",noblog:s,params:d};if(typeof n.CREATED_BY_ID!=="undefined"){f.flt_created_by_id=parseInt(n.CREATED_BY_ID)}if(typeof n.flt_date_datesel!=="undefined"){f.flt_date_datesel=n.flt_date_datesel}if(typeof n.flt_date_from!=="undefined"){f.flt_date_from=decodeURIComponent(n.flt_date_from)}if(typeof n.flt_date_to!=="undefined"){f.flt_date_to=decodeURIComponent(n.flt_date_to)}BX.ajax.runAction("socialnetwork.api.livefeed.getNextPage",{signedParameters:this.signedParameters,data:f}).then(function(t){var n=t.data;this.bLoadStarted=false;if(e){BX.cleanNode(e,true)}BX.Livefeed.InformerInstance.lockCounterAnimation=false;var a=typeof n.componentResult.LAST_TS!="undefined"?parseInt(n.componentResult.LAST_TS):0,o=typeof n.componentResult.LAST_ID!="undefined"?parseInt(n.componentResult.LAST_ID):null;if(n.html.length>0&&a>0&&(parseInt(this.firstPageLastTS)<=0||a<parseInt(this.firstPageLastTS)||a==parseInt(this.firstPageLastTS)&&o!==null&&o<parseInt(this.firstPageLastId))){BX.onCustomEvent(window,"OnUCMoreButtonListClear",[]);var s="content_block_"+Math.floor(Math.random()*1e3);var r=BX.create("DIV",{props:{id:s,className:"feed-wrap"},style:{display:this.nextPageFirst?"none":"block"},html:n.html});BX("log_internal_container").appendChild(r);BX.Runtime.html(r,n.html).then(function(){if(i>2){this.bStopTrackNextPage=false;this.recalcMoreButton();this.registerViewAreaList();this.recalcMoreButtonCommentsList();BX.Livefeed.PinnedPanelInstance.resetFlags();BX.Livefeed.PinnedPanelInstance.initPosts()}}.bind(this));this.clearContainerExternal(false);if(i===2){BX("feed-new-message-inf-text-first").style.display="block";BX("feed-new-message-inf-loader-first").style.display="none";BX.addClass(BX("feed-new-message-inf-wrap-first"),"feed-new-message-inf-wrap-first-active");var l=function(){this.bStopTrackNextPage=false;if(BX(s)){BX(s).style.display="block"}BX.unbind(BX("sonet_log_more_container_first"),"click",l);BX("feed-new-message-inf-wrap-first").style.display="none";this.recalcMoreButton();this.registerViewAreaList();this.recalcMoreButtonCommentsList();BX.onCustomEvent(window,"BX.Livefeed:recalculateComments",[{rootNode:BX(s)}]);BX.Livefeed.PinnedPanelInstance.resetFlags();BX.Livefeed.PinnedPanelInstance.initPosts()}.bind(this);BX.bind(BX("sonet_log_more_container_first"),"click",l)}else{if(BX(s)){BX(s).style.display="block"}}this.nextPageFirst=false}else if(BX("feed-new-message-inf-wrap-first")){BX("feed-new-message-inf-wrap-first").style.display="none"}}.bind(this),function(t){this.bLoadStarted=false;this.bStopTrackNextPage=false;if(e){e.style.display="none"}BX.Livefeed.InformerInstance.lockCounterAnimation=false;this.clearContainerExternal(false)}.bind(this));return false};BitrixLF.prototype.refresh=function(e,t){if(this.bLoadStarted){return}e=BX.type.isNotEmptyObject(e)?e:{};e.siteTemplateId=BX.message("sonetLSiteTemplateId");e.assetsCheckSum=BX.message("sonetLAssetsCheckSum");this.bLoadStarted=true;this.showRefreshFade();BX.onCustomEvent(window,"OnUCMoreButtonListClear",[]);this.arMoreButtonID=[];if(typeof e=="undefined"||typeof e.useBXMainFilter=="undefined"||e.useBXMainFilter!="Y"){BX.onCustomEvent(window,"BX.Livefeed:refresh",[])}BX.Livefeed.InformerInstance.hideReloadNode();BX.Livefeed.InformerInstance.lockCounterAnimation=true;this.bLoadStarted=false;BX.ajax.runAction("socialnetwork.api.livefeed.refresh",{signedParameters:this.signedParameters,data:{c:this.componentName,logajax:"Y",RELOAD:"Y",params:e}}).then(function(e){var n=e.data;this.bLoadStarted=false;this.hideRefreshFade();if(t){t.fulfill()}var i=null;var a=typeof n.componentResult.EMPTY!="undefined"?n.componentResult.EMPTY:"N";var o=BX.type.isNotEmptyString(n.componentResult.FORCE_PAGE_REFRESH)?n.componentResult.FORCE_PAGE_REFRESH:"N";if(o==="Y"){top.window.location.reload();return}if(a=="Y"&&BX("feed-empty-wrap")){i=BX("feed-empty-wrap")}var s=null;if(BX("feed-loader-container")){s=BX("feed-loader-container")}BX.Livefeed.InformerInstance.lockCounterAnimation=false;BX.cleanNode("log_internal_container",false);if(i){BX("log_internal_container").appendChild(BX.create("DIV",{props:{className:"feed-wrap"},children:[i]}));i.style.display="block";var r=BX.findChild(i,{className:"feed-wrap-empty"});if(r){r.innerHTML=BX.message("SONET_C30_T_EMPTY_SEARCH")}}if(s){BX("log_internal_container").appendChild(s)}if(n.html.length>0){this.clearContainerExternal(false);BX.LazyLoad.clearImages();var l="content_block_"+Math.floor(Math.random()*1e3);var d=BX.create("DIV",{props:{id:l,className:"feed-wrap"},style:{display:"block"},html:n.html});BX("log_internal_container").appendChild(d);BX.Runtime.html(d,n.html).then(function(){this.recalcMoreButton();this.recalcMoreButtonCommentsList();this.registerViewAreaList();BX.Livefeed.PinnedPanelInstance.resetFlags();BX.Livefeed.PinnedPanelInstance.initPanel();BX.Livefeed.PinnedPanelInstance.initPosts()}.bind(this));this.bStopTrackNextPage=false;BX.onCustomEvent(window,"OnUCMoreButtonListClear",[]);var f=BX.Livefeed.InformerInstance.wrap;if(f&&f.classList.contains(BX.Livefeed.InformerInstance.class.informerFixed)){var c=BX("feed-up-btn-wrap",true);if(c){c.style.display="none";BX.removeClass(c,"feed-up-btn-wrap-anim")}var p=BX.GetWindowScrollPos();new BX.easing({duration:500,start:{scroll:p.scrollTop},finish:{scroll:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){if(c)c.style.display="block";BX.onCustomEvent(window,"onGoUp")}}).animate()}}}.bind(this),function(){this.bLoadStarted=false;if(t){t.reject()}this.hideRefreshFade();this.showRefreshError()}.bind(this));return false};BitrixLF.prototype.showRefreshFade=function(){if(!BX.hasClass(BX("log_internal_container"),"log-internal-mask")){BX.addClass(BX("log_internal_container"),"log-internal-mask");BX.removeClass(BX("log_internal_container"),"log-internal-nomask");var e=BX("feed-loader-container");if(e){BX.style(e,"display","block");BX.removeClass(e,"livefeed-hide-loader");setTimeout(function(){BX.addClass(e,"livefeed-show-loader")},0)}}};BitrixLF.prototype.hideRefreshFade=function(){BX.removeClass(BX("log_internal_container"),"log-internal-mask");BX.addClass(BX("log_internal_container"),"log-internal-nomask");var e=BX("feed-loader-container");if(e){BX.removeClass(e,"livefeed-show-loader");BX.addClass(e,"livefeed-hide-loader")}};BitrixLF.prototype._onAnimationEnd=function(e){if("animationName"in e&&e.animationName&&e.animationName==="hideLoader"){var t=BX("feed-loader-container");BX.removeClass(t,"livefeed-show-loader");BX.removeClass(t,"livefeed-hide-loader");BX.style(t,"display","")}};BitrixLF.prototype.recalcMoreButton=function(){var e=null,t=null;if(typeof this.arMoreButtonID!="undefined"&&this.arMoreButtonID.length>0){var n=false;var i=false;var a=false;for(e=0;e<this.arMoreButtonID.length;e++){if(!this.arMoreButtonID.hasOwnProperty(e)||!BX.type.isNotEmptyObject(this.arMoreButtonID[e])){continue}t=BX.pos(BX(this.arMoreButtonID[e].bodyBlockID));if(typeof this.arMoreButtonID[e].outerBlockID!="undefined"){i=BX(this.arMoreButtonID[e].outerBlockID);if(i){n=BX.pos(i);if(n.width<t.width){a=BX.findChild(i,{tag:"div",className:"feed-post-text-block-inner"},false);a.style.overflowX="scroll"}}}this.recalcMoreButtonPost({arPos:t,moreButtonBlock:BX(this.arMoreButtonID[e].moreButtonBlockID),informerBlock:typeof this.arMoreButtonID[e].informerBlockID!="undefined"?BX(this.arMoreButtonID[e].informerBlockID):null});delete this.arMoreButtonID[e]}}if(BX("log_internal_container")){var o=BX.findChildren(BX("log_internal_container"),{attr:{"data-bx-onload":"Y"}},true);if(o!=null){for(e=0;e<o.length;e++){o[e].addEventListener("load",BX.proxy(function(e){var t=null,n=BX.findParent(e.currentTarget,{className:"feed-com-text"},BX("log_internal_container"));if(!n){n=BX.findParent(e.currentTarget,{className:"feed-post-block"},BX("log_internal_container"));if(n){t=BX.findChild(n,{className:"feed-post-text-block-inner-inner"},true);if(t){this.recalcMoreButtonPost({bodyBlock:t,moreButtonBlock:BX.findChild(n,{className:"feed-post-text-more"},true),informerBlock:BX.findChild(n,{className:"feed-post-text-more"},true)})}}}e.currentTarget.setAttribute("data-bx-onload","N")},this))}}}};BitrixLF.prototype.processForumSpoilerToggle=function(e){if(!BX.type.isDomNode(e.node)){return}var t=BX.findParent(e.node,{className:"feed-post-block"},BX("log_internal_container"));if(!t){return}var n=BX.findChild(t,{className:"feed-post-text-block-inner-inner"},true);if(!n){return}this.recalcMoreButtonPost({bodyBlock:n,moreButtonBlock:BX.findChild(t,{className:"feed-post-text-more"},true),informerBlock:BX.findChild(t,{className:"feed-post-text-more"},true)})};BitrixLF.prototype.recalcMoreButtonPost=function(e){var t=typeof e.arPos!="undefined"?e.arPos:BX.pos(e.bodyBlock);var n=BX.findParent(BX(e.informerBlock),{className:"feed-post-block"},BX("log_internal_container"));if(!n){return}if(t.height<=284){BX.addClass(n,"feed-post-block-short");BX.addClass(n,"feed-post-block-separator")}else{BX.removeClass(n,"feed-post-block-short")}};BitrixLF.prototype.recalcMoreButtonCommentsList=function(e){BX.onCustomEvent(window,"OnUCMoreButtonListRecalc",[])};BitrixLF.prototype.showRefreshError=function(){BX.Livefeed.InformerInstance.lockCounterAnimation=false;this.clearContainerExternal(false)};BitrixLF.prototype.LazyLoadCheckVisibility=function(e){var t=e.node;var n="comment";var i=BX.findParent(t,{className:"feed-com-text"});if(!i){n="post";i=BX.findParent(t,{className:"feed-post-text-block"})}if(i){var a=BX.findChild(i,{tag:"div",className:"feed-post-text-more"},false);if(a&&a.style.display!="none"){return t.parentNode.parentNode.offsetTop<(n=="comment"?220:270)}}return true};BitrixLF.prototype.clearContainerExternal=function(e){BX.Livefeed.InformerInstance.hideWrapAnimation();BX.Livefeed.InformerInstance.hideReloadAnimation();BX.Livefeed.InformerInstance.recover();if(this.nodeTmp1Cap&&this.nodeTmp1Cap.parentNode){this.nodeTmp1Cap.parentNode.removeChild(this.nodeTmp1Cap)}if(BX("sonet_log_counter_preset")&&this.logAjaxMode=="new"){BX("sonet_log_counter_preset").style.display="none"}};BitrixLF.prototype.clearContainerExternalNew=function(){this.logAjaxMode="new"};BitrixLF.prototype.clearContainerExternalMore=function(){this.logAjaxMode="more"};BitrixLF.prototype.createTask=function(e){this.createTaskPopup=new BX.PopupWindow("BXCTP",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:false,lightShadow:true,closeIcon:{right:"12px",top:"10px"},draggable:{restrict:true},closeByEsc:false,contentColor:"white",contentNoPaddings:true,buttons:[],content:BX.create("DIV",{attrs:{id:"BXCTP_content"},props:{className:"feed-create-task-popup-content"}}),events:{onAfterPopupShow:function(){this.createTaskSetContent(BX.create("DIV",{props:{className:"feed-create-task-popup-title"},html:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_WAIT")}));BX.ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:e.entityType,entityId:e.entityId,logId:BX.type.isNumber(e.logId)?e.logId:null,additionalParams:{getSonetGroupAvailable:"Y",getLivefeedUrl:"Y",checkPermissions:{feature:"tasks",operation:"create_tasks"}}}}}).then(function(t){var n=BX.type.isNotEmptyString(t.data.TITLE)?t.data.TITLE:"";var i=BX.type.isNotEmptyString(t.data.DESCRIPTION)?t.data.DESCRIPTION:"";var a=BX.type.isNotEmptyObject(t.data.DISK_OBJECTS)?t.data.DISK_OBJECTS:[];var o=BX.type.isNotEmptyString(t.data.LIVEFEED_URL)?t.data.LIVEFEED_URL:"";var s=BX.type.isNotEmptyString(t.data.SUFFIX)?t.data.SUFFIX:"";var r=BX.type.isNotEmptyObject(t.data.GROUPS_AVAILABLE)?t.data.GROUPS_AVAILABLE:[];var l=typeof t.data.LOG_ID!="undefined"?parseInt(t.data.LOG_ID):0;if((BX.type.isNotEmptyString(n)||BX.type.isNotEmptyString(i))&&BX.type.isNotEmptyString(o)){var d=this.formatTaskDescription(i,o,e.entityType,s);var f={TITLE:n,DESCRIPTION:d,RESPONSIBLE_ID:BX.message("USER_ID"),CREATED_BY:BX.message("USER_ID"),UF_TASK_WEBDAV_FILES:a};var c=[];for(var p in r){if(r.hasOwnProperty(p)){c.push(r[p])}}if(c.length==1){f.GROUP_ID=parseInt(c[0])}BX.Tasks.Util.Query.runOnce("task.add",{data:f}).then(function(t){var n=t.getData();if(BX.type.isNotEmptyObject(n)&&BX.type.isNotEmptyObject(n.DATA)&&typeof n.DATA.ID!="undefined"&&parseInt(n.DATA.ID)>0){this.createTaskSetContentSuccess(n.DATA.ID);BX.ajax.runAction("socialnetwork.api.livefeed.createEntityComment",{data:{params:{postEntityType:BX.type.isNotEmptyString(e.postEntityType)?e.postEntityType:e.entityType,sourceEntityType:e.entityType,sourceEntityId:e.entityId,entityType:"TASK",entityId:n.DATA.ID,logId:BX.type.isNumber(e.logId)?e.logId:l>0?l:null}}}).then(function(e){},function(e){})}else{this.createTaskSetContentFailure(t.getErrors().getMessages())}}.bind(this))}else{this.createTaskSetContentFailure([BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_ERROR_GET_DATA")])}}.bind(this),function(e){this.createTaskSetContentFailure([BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_ERROR_GET_DATA")])}.bind(this))}.bind(this),onPopupClose:function(){this.createTaskPopup.destroy()}.bind(this)}});this.createTaskPopup.show()};BitrixLF.prototype.createTaskSetContentSuccess=function(e){var t=this;var n=BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_PATH").replace("#user_id#",BX.message("USER_ID")).replace("#task_id#",e);this.createTaskPopup.destroy();window.top.BX.UI.Notification.Center.notify({content:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_SUCCESS_TITLE"),actions:[{title:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_VIEW"),events:{click:function(e,t,i){t.close();window.top.BX.SidePanel.Instance.open(n)}}}]})};BitrixLF.prototype.createTaskSetContentFailure=function(e){oLF.createTaskSetContent(BX.create("DIV",{children:[BX.create("DIV",{props:{className:"feed-create-task-popup-title"},html:BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_FAILURE_TITLE")}),BX.create("DIV",{props:{className:"feed-create-task-popup-description"},html:e.join("<br>")})]}))};BitrixLF.prototype.createTaskSetContent=function(e){if(BX("BXCTP_content")){var t=BX("BXCTP_content");BX.cleanNode(t);t.appendChild(e)}};BitrixLF.prototype.formatTaskDescription=function(e,t,n,i){var a=e;i=BX.type.isNotEmptyString(i)?"_"+i:"";if(!!t&&!!n&&t.length>0){a+="\n\n"+BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_"+n+i).replace("#A_BEGIN#","[URL="+t+"]").replace("#A_END#","[/URL]")}return a};BitrixLF.prototype.registerViewAreaList=function(){var e=BX("log_internal_container"),t=null;if(e){var n=BX.findChildren(e,{tag:"div",className:"feed-post-contentview"},true);for(var i=0,a=n.length;i<a;i++){if(n[i].id.length>0){t=BX.findChild(n[i],{tag:"div",className:"feed-post-text-block-inner-inner"});BX.UserContentView.registerViewArea(n[i].id,t?t:null)}}}};BitrixLF.prototype.clickTag=function(e){var t=false;if(BX.type.isNotEmptyString(e)&&this.filterApi){this.filterApi.setFields({TAG:e});this.filterApi.apply();if(this.filterId&&typeof BX.Main!="undefined"&&typeof BX.Main.filterManager!="undefined"&&BX.Main.filterManager.getById(this.filterId)&&(BX.Main.filterManager.getById(this.filterId).getSearch().getSquares().length>0||BX.Main.filterManager.getById(this.filterId).getSearch().getSearchString().length>0)){var n=BX.findParent(BX(this.filterId+"_filter_container"),{className:"pagetitle-wrap"});if(n){BX.addClass(n,"pagetitle-wrap-filter-opened")}}var i=BX.GetWindowScrollPos();new BX.easing({duration:500,start:{scroll:i.scrollTop},finish:{scroll:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){window.scrollTo(0,e.scroll)},complete:function(){}}).animate();t=true}return t};BitrixLF.prototype.expandPost=function(e){if(BX(e)){var t=BX.findParent(BX(e),{className:"feed-post-block"},BX("log_internal_container"));if(t){BX.addClass(t,"feed-post-block-short");BX.addClass(t,"feed-post-block-separator")}}};BitrixLF.prototype.setNoTasksNotificationRead=function(e){var t=BX.findParent(e.currentTarget,{className:"feed-notification-container"},true);if(t){BX.ajax.runAction("socialnetwork.api.livefeed.readNoTasksNotification",{data:{}}).then(function(e){if(e.data.success){BX.style(t,"height",t.offsetHeight+"px");setTimeout(function(){t.classList.add("feed-notification-container-collapsed")},10);setTimeout(function(){t.parentNode.removeChild(t)},250)}},function(e){})}};if(typeof oLF=="undefined"){oLF=new BitrixLF;window.oLF=oLF}
//# sourceMappingURL=script.map.js