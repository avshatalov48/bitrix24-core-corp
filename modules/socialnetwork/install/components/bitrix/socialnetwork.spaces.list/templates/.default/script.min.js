this.BX=this.BX||{};this.BX.Socialnetwork=this.BX.Socialnetwork||{};(function(t,e,s,a,i,n,o,c,r,d){"use strict";const l={state(){return{avatarColors:[],avatarColor:"29AD49"}},actions:{setAvatarColors:(t,e)=>{t.commit("setAvatarColors",e)},setAvatarColor:(t,e)=>{t.commit("setAvatarColor",e)}},mutations:{setAvatarColors:(t,e)=>{t.avatarColors=e},setAvatarColor:(t,e)=>{t.avatarColor=e}},getters:{avatarColors:t=>t.avatarColors,previousAvatarColor:t=>t.avatarColor}};class p{static async loadSpaces(t){const e="bitrix:socialnetwork.spaces.list";const s="loadSpaces";const a=await c.ajax.runComponentAction(e,s,{mode:"class",data:t});return a.data}static async reloadSpaces(t){const e="bitrix:socialnetwork.spaces.list";const s="reloadSpaces";const a=await c.ajax.runComponentAction(e,s,{mode:"class",data:t});return a.data}static async searchSpaces(t){const e="bitrix:socialnetwork.spaces.list";const s="searchSpaces";const a=await c.ajax.runComponentAction(e,s,{mode:"class",data:t});return a.data}static async loadRecentSearchSpaces(){const t="bitrix:socialnetwork.spaces.list";const e="loadRecentSearchSpaces";const s=await c.ajax.runComponentAction(t,e,{mode:"class"});return s.data}static async addSpaceToRecentSearch(t){const e="bitrix:socialnetwork.spaces.list";const s="addSpaceToRecentSearch";const a=await c.ajax.runComponentAction(e,s,{mode:"class",data:{spaceId:t}});return a.data}static async loadSpaceData(t){const e="bitrix:socialnetwork.spaces.list";const s="loadSpaceData";const a=await c.ajax.runComponentAction(e,s,{mode:"class",data:{spaceId:t}});return a.data}}var h=babelHelpers.classPrivateFieldLooseKey("selectedSpaceId");class u{constructor(){Object.defineProperty(this,h,{writable:true,value:void 0});this.hasMoreSpacesToLoad=true}static getInstance(){if(!this.instance){this.instance=new this}return this.instance}setSelectedSpaceId(t){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=t}getSelectedSpaceId(){return babelHelpers.classPrivateFieldLooseBase(this,h)[h]}async loadSpaces(t){const e={};e.loadedSpacesCount=t.loadedSpacesCount;e.mode=t.filterMode;e.searchString="";const s=await p.loadSpaces(e);this.hasMoreSpacesToLoad=s.hasMoreSpacesToLoad;return s}canLoadSpaces(){return this.hasMoreSpacesToLoad}async reloadSpaces(t){const e={};e.mode=t.filterMode;e.selectedSpaceId=babelHelpers.classPrivateFieldLooseBase(this,h)[h];const s=await p.reloadSpaces(e);this.hasMoreSpacesToLoad=s.hasMoreSpacesToLoad;return s}}u.instance=null;const S=Object.freeze({recent:"recent",recentSearch:"recentSearch",search:"search"});const m=Object.freeze({my:"my",other:"other",all:"all"});const v=Object.freeze([{type:m.my,nameMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_MY_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_MY_DESCRIPTION"},{type:m.other,nameMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_OTHER_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_OTHER_DESCRIPTION"},{type:m.all,nameMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_ALL_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_ALL_DESCRIPTION"}]);const g=Object.freeze({open:"open",closed:"closed",secret:"secret"});const b=Object.freeze([{type:g.open,nameMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_OPEN_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_OPEN_DESCRIPTION"},{type:g.closed,nameMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_CLOSED_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_CLOSED_DESCRIPTION"},{type:g.secret,nameMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_SECRET_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_SECRET_DESCRIPTION"}]);const f=Object.freeze({nonMember:"nonMember",applicant:"applicant",invited:"invited",member:"member"});class I{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}buildSpaces(t){return t.map((t=>({id:parseInt(t.id,10),name:t.name,isPinned:t.isPinned,isSelected:u.getInstance().getSelectedSpaceId()===parseInt(t.id,10),dateActivity:new Date(parseInt(t.dateActivityTimestamp,10)*1e3),dateActivityTimestamp:t.dateActivityTimestamp*1e3,lastActivityDescription:t.lastActivityDescription,avatar:t.avatar,visibilityType:t.visibilityType,counter:parseInt(t.counter,10),lastSearchDate:new Date(parseInt(t.lastSearchDateTimestamp,10)*1e3),lastSearchDateTimestamp:t.lastSearchDateTimestamp*1e3,userRole:t.userRole,follow:t.follow})))}buildInvitations(t){return t.map((t=>({spaceId:parseInt(t.spaceId,10),message:t.message,invitationDateTimestamp:t.invitationDateTimestamp*1e3,invitationDate:new Date(parseInt(t.invitationDateTimestamp,10)*1e3)})))}getStringCapitalized(t){return t[0].toUpperCase()+t.slice(1)}getModelNameByListViewMode(t){let e=`${t}ListSpaceIds`;if(t===S.search){e="searchResultFromServerSpaceIds"}return e}doSpaceUserRoleFitsFilterMode(t,e){if([f.nonMember,f.applicant].includes(t)&&e===m.my){return false}if(t===f.member&&e===m.other){return false}return t!==f.invited}}I.instance=null;const _={state(){return{spaces:new Map,recentListSpaceIds:new Set,searchResultFromServerSpaceIds:new Set,searchResultFromLoadedSpaceIds:new Set,invitations:new Map,invitationSpaceIds:new Set,recentSearchListSpaceIds:new Set,selectedFilterModeType:"",spacesListState:"",canCreateGroup:false}},actions:{setSpaces:(t,e)=>{t.commit("setSpaces",I.getInstance().buildSpaces(e))},setInvitations:(t,e)=>{t.commit("setInvitations",I.getInstance().buildInvitations(e))},setCanCreateGroup:(t,e)=>{t.commit("setCanCreateGroup",e)},setRecentSpaceIds:(t,e)=>{t.commit("setRecentListSpaceIds",e)},setInvitationSpaceIds:(t,e)=>{t.commit("setInvitationSpaceIds",e)},setRecentSearchSpaceIds:(t,e)=>{t.commit("setRecentSearchListSpaceIds",e)},addSpaces:(t,e)=>{t.commit("addSpaces",I.getInstance().buildSpaces(e))},setSelectedFilterModeType:(t,e)=>{t.commit("setSelectedFilterModeType",e)},setSpacesListState:(t,e)=>{t.commit("setSpacesListState",e)},setLocalSearchResult:(t,e)=>{t.commit("setSearchResultFromLoadedSpaceIds",e)},clearSpacesViewByMode:(t,e)=>{const s=I.getInstance();const a=s.getModelNameByListViewMode(e);const i=s.getStringCapitalized(a);t.commit(`set${i}`,[])},addSpacesToView:(t,e)=>{const s=I.getInstance();const a=s.getModelNameByListViewMode(e.mode);const i=s.getStringCapitalized(a);const n=s.buildSpaces(e.spaces);const o=n.map((t=>t.id));const c=[...t.state[a],...o];t.commit(`set${i}`,c);t.commit("addSpaces",n)},pinSpace:(t,e)=>{t.commit("pinSpace",e)},changeUserRole:(t,e)=>{t.commit("changeUserRole",e)},deleteInvitationFromStore:(t,e)=>{const s=e.spaceId;t.commit("deleteInvitationBySpaceId",s)},deleteSpaceFromStore:(t,e)=>{const s=e.spaceId;t.commit("deleteSpaceById",s)},updateCounters:(t,e)=>{const s=e.userId;const a=e.total;BX.ready((()=>{if(BX.getClass("BX.Intranet.LeftMenu")){e.spaces.forEach((t=>{if(t.id===0){const e={spaces:a,sonet_total:t.metrics.countersLiveFeedTotal};BX.Intranet.LeftMenu.updateCounters(e,false)}}))}}));e.spaces.forEach((e=>{t.commit("updateCounter",{userId:s,spaceId:e.id,counter:e.total,tasksTotal:e.metrics.countersTasksTotal,calendarTotal:e.metrics.countersCalendarTotal,workGroupTotal:e.metrics.countersWorkGroupRequestTotal,lifeFeedTotal:e.metrics.countersLiveFeedTotal})}))},updateSpaceData:(t,e)=>{if(e.space&&e.isInvitation){t.commit("addInvitations",I.getInstance().buildInvitations([e.invitation]))}else{t.commit("deleteInvitationBySpaceId",e.spaceId)}if(e.space){const s=I.getInstance();const a=s.buildSpaces([e.space]).pop();const i=t.getters.recentSpaces[t.getters.recentSpaces.length-1];t.commit("addSpaces",[a]);const n=i.dateActivity<a.dateActivity;const o=s.doSpaceUserRoleFitsFilterMode(a.userRole,t.state.selectedFilterModeType);if(n&&o){t.commit("addRecentListSpaceId",a.id)}else if(!o){t.commit("removeRecentListSpaceId",a.id)}}else{t.commit("deleteSpaceById",e.spaceId)}}},mutations:{setSpaces:(t,e)=>{t.spaces.clear();e.forEach((e=>t.spaces.set(e.id,e)))},addSpaces:(t,e)=>{e.forEach((e=>t.spaces.set(e.id,e)))},setRecentListSpaceIds:(t,e)=>{t.recentListSpaceIds=new Set(e)},addRecentListSpaceId:(t,e)=>{t.recentListSpaceIds.add(e)},removeRecentListSpaceId:(t,e)=>{t.recentListSpaceIds.delete(e)},setInvitations:(t,e)=>{t.invitations.clear();e.forEach((e=>t.invitations.set(e.spaceId,e)))},setInvitationSpaceIds:(t,e)=>{t.invitationSpaceIds=new Set(e)},addInvitations:(t,e)=>{e.forEach((e=>{t.invitationSpaceIds.add(e.spaceId);t.invitations.set(e.spaceId,e)}))},setCanCreateGroup:(t,e)=>{t.canCreateGroup=e},setSearchResultFromServerSpaceIds:(t,e)=>{t.searchResultFromServerSpaceIds=new Set(e)},setSearchResultFromLoadedSpaceIds:(t,e)=>{t.searchResultFromLoadedSpaceIds=new Set(e)},setRecentSearchListSpaceIds:(t,e)=>{t.recentSearchListSpaceIds=new Set(e)},setSelectedFilterModeType:(t,e)=>{t.selectedFilterModeType=e},setSpacesListState:(t,e)=>{t.spacesListState=e},pinSpace:(t,e)=>{const s=t.spaces.get(e.spaceId);s.isPinned=e.isPinned;t.spaces.set(s.id,s)},changeUserRole:(t,e)=>{const s=t.spaces.get(e.spaceId);s.userRole=e.userRole},deleteSpaceById:(t,e)=>{t.spaces.delete(e);t.recentListSpaceIds.delete(e);t.searchResultFromServerSpaceIds.delete(e);t.searchResultFromLoadedSpaceIds.delete(e);t.recentSearchListSpaceIds.delete(e)},deleteInvitationBySpaceId:(t,e)=>{t.invitations.delete(e);t.invitationSpaceIds.delete(e)},updateCounter:(t,e)=>{var s;const a=e.userId;const i=e.spaceId;const n=e.counter;const o=e.tasksTotal;const c=e.calendarTotal;const r=e.workGroupTotal;const d=e.lifeFeedTotal;const l=(s=t.spaces.get(i))!=null?s:{};l.counter=n;BX.ready((()=>{const t=i==0?BX.Main.interfaceButtonsManager.getById(`spaces_user_menu_${a}`):BX.Main.interfaceButtonsManager.getById(`spaces_group_menu_${i}`);if(t){const e=`spaces_top_menu_${a}_${i}`;const s=`${e}_tasks`;const n=`${e}_calendar`;const r=`${e}_discussions`;t.updateCounter(s,o);t.updateCounter(n,c);t.updateCounter(r,d)}}))}},getters:{spaces:t=>[...t.spaces.values()],invitations:t=>[...t.invitations.values()],spaceInvitations:(t,e)=>{const s=t.spaces;const a=e.invitations;return a.map((t=>{const e=s.get(t.spaceId);const a={dateActivity:t.invitationDate,lastActivityDescription:t.message,counter:1};return{...e,...a}})).sort(((t,e)=>e.dateActivity-t.dateActivity))},canCreateGroup:t=>t.canCreateGroup,spacesListState:t=>t.spacesListState,recentSpacesUnordered:(t,e)=>{const s=e.spaces;const a=s.filter((e=>t.recentListSpaceIds.has(e.id)&&!t.invitationSpaceIds.has(e.id)));return a.sort(((t,e)=>e.dateActivity-t.dateActivity))},pinnedSpacesFromRecent:(t,e)=>e.recentSpacesUnordered.filter((t=>t.isPinned)),commonSpaceFromRecent:(t,e)=>e.recentSpacesUnordered.find((t=>t.id===0)),selectedSpaceFromRecent:(t,e)=>e.recentSpacesUnordered.find((t=>t.isSelected&&!t.isPinned)),otherSpacesFromRecent:(t,e)=>e.recentSpacesUnordered.filter((t=>t.id!==e.commonSpaceFromRecent.id&&!t.isSelected&&!t.isPinned)),recentSpaces:(t,e)=>{const s=[];if(t.selectedFilterModeType===m.my){s.push(...e.pinnedSpacesFromRecent)}if(e.commonSpaceFromRecent&&t.selectedFilterModeType!==m.other){s.push(e.commonSpaceFromRecent)}if(e.selectedSpaceFromRecent&&e.selectedSpaceFromRecent.id!==e.commonSpaceFromRecent.id){s.push(e.selectedSpaceFromRecent)}s.push(...e.otherSpacesFromRecent);return s},searchSpaces:(t,e)=>{const s=e.spaces;const a=new Set([...t.searchResultFromLoadedSpaceIds,...t.searchResultFromServerSpaceIds]);return s.filter((t=>a.has(t.id)))},spacesLoadedByCurrentSearchQueryCount:t=>t.searchResultFromServerSpaceIds.size,recentSearchSpaces:(t,e)=>{const s=e.spaces.filter((e=>t.recentSearchListSpaceIds.has(e.id)));return s.sort(((t,e)=>e.lastSearchDate-t.lastSearchDate))},recentSpacesCountForLoad:(t,e)=>e.recentSpaces.length-2,recentSearchSpacesCountForLoad:(t,e)=>e.recentSearchSpaces.length,searchSpacesCountForLoad:(t,e)=>e.spacesLoadedByCurrentSearchQueryCount}};const L=o.createStore({modules:{addForm:l,main:_}});class C{static getSpaceLink(t){let e=C.commonSpacePath;if(t>0){e=C.groupPath.replace("#group_id#",t)}return e}}C.groupPath="";C.commonSpacePath="";const w=Object.freeze({default:"default",collapsed:"collapsed",expanded:"expanded"});const P=Object.freeze({showLoader:"socialnetwork:spacesList:showLoader",hideLoader:"socialnetwork:spacesList:hideLoader",tryToLoadSpacesIfHasNoScrollbar:"socialnetwork:spacesList:tryToLoadSpacesIfHasNoScrollbar",spaceListScroll:"socialnetwork:spacesList:onScroll",spaceListShown:"socialnetwork:spacesList:onShown",showUpperSpaceAddForm:"socialnetwork:spacesList:showUpperSpaceAddForm",showBtnToggleBlock:"socialnetwork:spacesList:showBtnToggleBlock",hideSpaceAddForm:"socialnetwork:spacesList:hideSpaceAddForm",updateCounters:"socialnetwork:spacesList:updateCounters",changeSpace:"socialnetwork:spacesList:changeSpace",changeUserRole:"socialnetwork:spacesList:changeUserRole",changeSubscription:"socialnetwork:spacesList:changeSubscription",pinChanged:"socialnetwork:spacesList:pinChanged",changeSpaceListState:"socialnetwork:spacesList:changeSpaceListState"});const y="#popup-window-content-";const M={name:"BasePopup",props:{id:{type:String,required:true},config:{type:Object,required:false,default(){return{}}}},emits:["close"],computed:{popupContainer(){return`${y}${this.id}`}},created(){this.instance=this.getPopupInstance();this.instance.show()},mounted(){this.instance.adjustPosition({forceBindPosition:true,position:this.getPopupConfig().bindOptions.position})},beforeUnmount(){if(!this.instance){return}this.closePopup()},methods:{getPopupInstance(){if(!this.instance){var t;(t=s.PopupManager.getPopupById(this.id))==null?void 0:t.destroy();this.instance=new s.Popup(this.getPopupConfig())}return this.instance},getDefaultConfig(){return{id:this.id,className:"ui-test-popup",autoHide:true,animation:"fading-slide",bindOptions:{position:"bottom"},cacheable:false,events:{onPopupClose:this.closePopup.bind(this)}}},getPopupConfig(){var t,e;const s=this.getDefaultConfig();const a={};const i=s.className;if(this.config.className){a.className=`${i} ${this.config.className}`}const n=(t=this.config.offsetTop)!=null?t:s.offsetTop;if(((e=this.config.bindOptions)==null?void 0:e.position)==="top"&&c.Type.isNumber(this.config.offsetTop)){a.offsetTop=n-10}return{...s,...this.config,...a}},closePopup(){this.$emit("close");this.instance.destroy();this.instance=null},enableAutoHide(){this.getPopupInstance().setAutoHide(true)},disableAutoHide(){this.getPopupInstance().setAutoHide(false)},adjustPosition(){this.getPopupInstance().adjustPosition({forceBindPosition:true,position:this.getPopupConfig().bindOptions.position})}},template:`\n\t\t<Teleport :to="popupContainer">\n\t\t\t<slot\n\t\t\t\t:adjustPosition="adjustPosition"\n\t\t\t\t:enableAutoHide="enableAutoHide"\n\t\t\t\t:disableAutoHide="disableAutoHide"\n\t\t\t></slot>\n\t\t</Teleport>\n\t`};const T={props:{option:{type:Object,default:()=>{}},isSelected:Boolean},emits:["changeSelectedOption"],computed:{active(){return this.isSelected?"--active":""},iconClass(){return`--${this.option.type}-spaces`},dataId(){return`spaces-list-popup-menu-option-${this.option.type}`}},template:`\n\t\t<div\n\t\t\t@click="this.$emit('changeSelectedOption', option.type)"\n\t\t\tclass="sn-spaces__popup-menu_item"\n\t\t\t:class="active"\n\t\t\t:data-id="dataId"\n\t\t>\n\t\t\t<div class="sn-spaces__popup-menu_item-icon" :class="iconClass"/>\n\t\t\t<div class="sn-spaces__popup-menu_item-info">\n\t\t\t\t<div class="sn-spaces__popup-menu_item-name">{{ option.name }}</div>\n\t\t\t\t<div class="sn-spaces__popup-menu_item-description">{{ option.description }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const E={props:{config:{type:Object,required:true}},emits:["popupMenuButtonClick"],computed:{doShowIcon(){return c.Type.isStringFilled(this.config.class)}},template:`\n\t\t<div\n\t\t\tclass="sn-spaces__popup-menu_item sn-spaces__popup-menu_item-btn"\n\t\t\tdata-id="spaces-popup-menu-button"\n\t\t\t@click="this.$emit('popupMenuButtonClick')"\n\t\t>\n\t\t\t<div v-if="doShowIcon" class="ui-icon-set" :class="config.class"></div>\n\t\t\t{{config.text}}\n\t\t</div>\n\t`};const A={name:"ModePopupContent",components:{PopupMenuOption:T,PopupMenuButton:E},props:{options:{type:Array,required:true},selectedOption:{type:String,required:false,default:""},hint:{type:String,required:false,default:""},button:{type:Object,required:false,default:()=>{}}},emits:["closePopup","changeSelectedOption","popupMenuButtonClick"],computed:{doShowHint(){return this.hint.length>0},doShowButton(){var t,e;return((t=this.button)==null?void 0:(e=t.text)==null?void 0:e.length)>0}},methods:{onChangeSelectedOption(t){this.$emit("closePopup");this.$emit("changeSelectedOption",t)},onPopupMenuButtonClick(){this.$emit("closePopup");this.$emit("popupMenuButtonClick")}},template:`\n\t\t<div class="sn-spaces__popup-menu">\n\t\t\t<PopupMenuOption\n\t\t\t\tv-for="option in options"\n\t\t\t\t:option="option"\n\t\t\t\t:key="option.type"\n\t\t\t\t:isSelected="option.type === this.selectedOption"\n\t\t\t\t@changeSelectedOption="onChangeSelectedOption"\n\t\t\t/>\n\t\t\t<PopupMenuButton\n\t\t\t\tv-if="doShowButton"\n\t\t\t\t:config="button"\n\t\t\t\t@popupMenuButtonClick="onPopupMenuButtonClick"\n\t\t\t/>\n\t\t\t<div v-if="doShowHint" class="sn-spaces__popup-menu_hint">\n\t\t\t\t{{hint}}\n\t\t\t</div>\n\t\t</div>\n\t`};const B="socialnetwork-spaces-list-mode-popup";const F={components:{BasePopup:M,PopupMenuContent:A},props:{bindElement:{type:Object,required:true},context:{type:String,required:true},options:{type:Array,required:true},selectedOption:{type:String,required:false,default:""},button:{type:Object,required:false,default:()=>{}},hint:{type:String,required:false,default:""}},computed:{POPUP_ID(){return`${B}-${this.context}`},config(){return{className:"ui-test-popup",width:343,closeIcon:false,closeByEsc:true,overlay:true,padding:12,animation:"fading-slide",bindElement:this.bindElement}}},emits:["close","changeSelectedOption","popupMenuButtonClick"],methods:{onChangeSelectedOption(t){this.$emit("changeSelectedOption",t)},onPopupMenuButtonClick(){this.$emit("popupMenuButtonClick")}},template:`\n\t\t<BasePopup\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t\tv-slot="{enableAutoHide, disableAutoHide}"\n\t\t\t:id="POPUP_ID"\n\t\t>\n\t\t\t<PopupMenuContent\n\t\t\t\t:options="options"\n\t\t\t\t:selectedOption="selectedOption"\n\t\t\t\t:hint="hint"\n\t\t\t\t@closePopup="$emit('close')"\n\t\t\t\t@enableAutoHide="enableAutoHide"\n\t\t\t\t@disableAutoHide="disableAutoHide"\n\t\t\t\t@changeSelectedOption="onChangeSelectedOption"\n\t\t\t\t@popupMenuButtonClick="onPopupMenuButtonClick"\n\t\t\t\t:button="button"\n\t\t\t/>\n\t\t</BasePopup>\n\t`};const O={components:{PopupMenu:F},props:{canCreateGroup:Boolean},emits:["changeMode"],data(){return{showModePopup:false,isSpaceListScrolled:false,filterModes:v}},computed:{scrollClass(){return this.isSpaceListScrolled?"--scroll-content":""},selectedFilterModeType(){return this.$store.state.main.selectedFilterModeType},title(){const t=this.selectedFilterModeType;const e=this.filterModes.find((e=>e.type===t));return e?this.loc(e.nameMessageId):this.loc("SOCIALNETWORK_SPACES_TITLE")},selectFilterModeButtonIconModifier(){return`--${this.selectedFilterModeType}`},popupMenuOptions(){return this.filterModes.map((t=>({type:t.type,name:this.loc(t.nameMessageId),description:this.loc(t.descriptionMessageId)})))},popupMenuButton(){if(!this.canCreateGroup){return null}return{text:this.loc("SOCIALNETWORK_SPACES_LIST_MODE_POPUP_NEW_SPACE_BUTTON"),class:"--plus-30"}}},created(){this.$bitrix.eventEmitter.subscribe(P.spaceListScroll,this.handleListChanges);this.$bitrix.eventEmitter.subscribe(P.spaceListShown,this.handleListChanges)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(P.spaceListScroll,this.handleListChanges);this.$bitrix.eventEmitter.unsubscribe(P.spaceListShown,this.handleListChanges)},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)},openPopup(){this.showModePopup=true},handleListChanges(t){const e=t.data.isSpaceListScrolled;const s=t.data.mode;if(s===S.recent){this.isSpaceListScrolled=e}},enableSearch(){this.$emit("changeMode",S.recentSearch)},async onChangeSelectedFilterMode(t){if(this.selectedFilterModeType!==t){const e=u.getInstance();this.$bitrix.eventEmitter.emit(P.showLoader,S.recent);const s=await e.reloadSpaces({filterMode:t});this.$store.dispatch("setSelectedFilterModeType",t);this.$store.dispatch("clearSpacesViewByMode",S.recent);this.$store.dispatch("addSpacesToView",{mode:S.recent,spaces:s.spaces});this.$bitrix.eventEmitter.emit(P.hideLoader,S.recent)}},onCreateSpaceButtonClick(){this.$bitrix.eventEmitter.emit(P.showUpperSpaceAddForm)},showBtnArrow(){this.$bitrix.eventEmitter.emit(P.showBtnToggleBlock)}},template:`\n\t\t<div \n\t\t\tclass="sn-spaces__list-header" \n\t\t\t:class="scrollClass"\n\t\t\t@mouseenter="showBtnArrow"\n\t\t>\n\t\t\t<div\n\t\t\t\t@click="openPopup"\n\t\t\t\tclass="sn-spaces__list-header_name"\n\t\t\t\tref="spaces-list-header-name"\n\t\t\t\tdata-id="spaces-header-title"\n\t\t\t>\n\t\t\t\t<div class="sn-spaces__list-header_name-block">\n\t\t\t\t\t<div class="sn-spaces__list-header_title">\n\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-icon-set --chevron-down" style='--ui-icon-set__icon-size: 15px;'>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="sn-spaces__list-header_btn-spaces" :class="selectFilterModeButtonIconModifier"></div>\n\t\t\t</div>\n\t\t\t<PopupMenu\n\t\t\t\t:options="popupMenuOptions"\n\t\t\t\tcontext="space-recent-header"\n\t\t\t\t:bind-element="$refs['spaces-list-header-name'] || {}"\n\t\t\t\t:selectedOption="selectedFilterModeType"\n\t\t\t\t:hint="loc('SOCIALNETWORK_SPACES_LIST_MODE_POPUP_BOTTOM_DESCRIPTION')"\n\t\t\t\t@changeSelectedOption="onChangeSelectedFilterMode"\n\t\t\t\t@popupMenuButtonClick="onCreateSpaceButtonClick"\n\t\t\t\tv-if="showModePopup"\n\t\t\t\t@close="showModePopup = false"\n\t\t\t\t:button="popupMenuButton"\n\t\t\t/>\n\t\t\t<button\n\t\t\t\tclass="ui-btn ui-btn-light ui-btn-round ui-btn-xs sn-spaces__list-header_btn-search"\n\t\t\t\t@click="enableSearch"\n\t\t\t\tdata-id="spaces-search-button"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --search-2"></div>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\tv-if="canCreateGroup"\n\t\t\t\tclass="ui-btn ui-btn-light ui-btn-round ui-btn-xs sn-spaces__list-header_btn-add"\n\t\t\t\t@click="onCreateSpaceButtonClick"\n\t\t\t\tdata-id="spaces-header-add-space-button"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --plus-30"></div>\n\t\t\t</button>\n\t\t</div>\n\t`};const R=3;class k{constructor(){this.hasMoreSpacesToLoad=true;this.searchString=""}static getInstance(){if(!this.instance){this.instance=new this}return this.instance}async loadSpaces(t){const e={};e.loadedSpacesCount=t.loadedSpacesCount;e.mode=m.all;e.searchString=this.searchString;const s=await p.searchSpaces(e);this.hasMoreSpacesToLoad=s.hasMoreSpacesToLoad;return s}canLoadSpaces(){return this.hasMoreSpacesToLoad&&this.searchString.length>=R}}k.instance=null;const D={data(){return{searchQuery:"",isSpaceListScrolled:false}},created(){this.startSearchDebounced=c.Runtime.debounce(this.startSearch,500,this);this.$bitrix.eventEmitter.subscribe(P.spaceListScroll,this.handleListChanges);this.$bitrix.eventEmitter.subscribe(P.spaceListShown,this.handleListChanges)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(P.spaceListScroll,this.handleListChanges);this.$bitrix.eventEmitter.unsubscribe(P.spaceListShown,this.handleListChanges)},computed:{...o.mapGetters({spaces:"spaces"}),scrollClass(){return this.isSpaceListScrolled?"--scroll-content":""}},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},closeSearch(){this.searchQuery="";this.$emit("changeMode",S.recent)},handleListChanges(t){const e=t.data.isSpaceListScrolled;const s=t.data.mode;if([S.search,S.recentSearch].includes(s)){this.isSpaceListScrolled=e}},onInputChange(){k.getInstance().searchString=this.searchQuery;if(this.searchQuery.length===0){this.$emit("changeMode",S.recentSearch)}else{this.startSearchDebounced()}},startSearch(){if(this.searchQuery.length>0){k.getInstance().hasMoreSpacesToLoad=true;this.$store.dispatch("clearSpacesViewByMode",S.search);const t=this.spaces.filter((t=>t.name.toLowerCase().includes(this.searchQuery.toLowerCase())));const e=t.map((t=>t.id));this.$store.dispatch("setLocalSearchResult",e);this.$emit("changeMode",S.search);setTimeout((()=>{this.$bitrix.eventEmitter.emit(P.tryToLoadSpacesIfHasNoScrollbar,S.search)}),80)}}},mounted(){this.$refs.input.focus()},template:`\n\t\t<div class="sn-spaces__list-header" :class="scrollClass">\n\t\t\t<div class="sn-spaces__search ui-ctl ui-ctl-textbox ui-ctl-after-icon ui-ctl-w100 ui-ctl-sm">\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t:placeholder="loc('SOCIALNETWORK_SPACES_LIST_SEARCH_INPUT_PLACEHOLDER')"\n\t\t\t\t\tv-model.trim="searchQuery"\n\t\t\t\t\tref="input"\n\t\t\t\t\t@input="onInputChange"\n\t\t\t\t\tdata-id="spaces-search-input"\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tclass="sn-spaces__search-clear ui-ctl-after"\n\t\t\t\t\t@click="closeSearch"\n\t\t\t\t\tdata-id="spaces-close-search-button"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --cross-circle-70"></div>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`};class H{constructor(t){this.message=t.message;this.spaceId=t.spaceId;this.emitter=new r.EventEmitter}getEmitter(){return this.emitter}}var $=babelHelpers.classPrivateFieldLooseKey("switch");var x=babelHelpers.classPrivateFieldLooseKey("flush");class N extends H{constructor(...t){super(...t);Object.defineProperty(this,x,{value:j});Object.defineProperty(this,$,{value:U})}create(){return{text:this.message,onclick:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,$)[$]().then((t=>{e.getMenuWindow().close();const s=t.data.message;const a=t.data.mode;setTimeout((()=>{e.setText(s)}),800);babelHelpers.classPrivateFieldLooseBase(this,x)[x](a)}))}}}}function U(){return c.ajax.runAction("socialnetwork.api.livefeed.spaces.switcher.pin",{data:{switcher:{type:N.ID,spaceId:this.spaceId},space:this.spaceId}})}function j(t){this.getEmitter().emit(P.pinChanged,{spaceId:this.spaceId,isPinned:t==="Y"})}N.ID="pinner";var K=babelHelpers.classPrivateFieldLooseKey("switch");var G=babelHelpers.classPrivateFieldLooseKey("flush");class W extends H{constructor(...t){super(...t);Object.defineProperty(this,G,{value:q});Object.defineProperty(this,K,{value:V})}create(){return{text:this.message,onclick:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,K)[K]().then((t=>{e.getMenuWindow().close();const s=t.data.message;const a=t.data.mode;setTimeout((()=>{e.setText(s)}),800);babelHelpers.classPrivateFieldLooseBase(this,G)[G](a)}))}}}}function V(){return c.ajax.runAction("socialnetwork.api.livefeed.spaces.switcher.follow",{data:{switcher:{type:W.ID,spaceId:this.spaceId},space:this.spaceId}})}function q(t){this.getEmitter().emit("followChanged",{spaceId:this.spaceId,isFollowed:t==="Y"})}W.ID="follow";class X extends H{create(){return{text:this.message,href:this.path}}setPath(t){this.path=t;return this}}var z=babelHelpers.classPrivateFieldLooseKey("init");class Q{constructor(t){Object.defineProperty(this,z,{value:Y});this.spaceId=t.spaceId;this.bindElement=t.bindElement;this.path=t.path;this.isSelected=t.isSelected;this.pinMessage=t.pinMessage;this.followMessage=t.followMessage;this.openMessage=t.openMessage;babelHelpers.classPrivateFieldLooseBase(this,z)[z]()}createMenu(){const t=Q.ID+this.spaceId;this.menu=s.MenuManager.create({id:t,closeByEsc:true,bindElement:this.bindElement,items:this.getItems()})}toggle(){this.collection.destroy();this.createMenu();this.menu.toggle()}getSpaceId(){return this.spaceId}getItems(){const t=[];if(!this.isSelected){const e=new X({spaceId:this.spaceId,message:this.openMessage});t.push(e.setPath(this.path).create())}const e=new N({spaceId:this.spaceId,message:this.pinMessage});t.push(e.create());const s=new W({spaceId:this.spaceId,message:this.followMessage});t.push(s.create());return t}}function Y(){this.collection=J.getInstance();this.collection.add(this)}Q.ID="space-context-menu-";class J{static getInstance(){if(J.instance===null){J.instance=new this}return J.instance}add(t){if(!this.has(t)){J.items.push(t)}}has(t){J.items.forEach((e=>{if(e.getSpaceId()===t.getSpaceId()){return true}}));return false}destroy(){J.items.forEach((t=>{const e=s.MenuManager.getMenuById(Q.ID+t.getSpaceId());e==null?void 0:e.destroy()}))}}J.items=[];J.instance=null;var Z=babelHelpers.classPrivateFieldLooseKey("date");var tt=babelHelpers.classPrivateFieldLooseKey("currentDate");var et=babelHelpers.classPrivateFieldLooseKey("isToday");var st=babelHelpers.classPrivateFieldLooseKey("isCurrentWeek");var at=babelHelpers.classPrivateFieldLooseKey("isCurrentYear");class it{static formatDate(t){return new it(new Date(t)).formatDate()}constructor(t){Object.defineProperty(this,at,{value:ct});Object.defineProperty(this,st,{value:ot});Object.defineProperty(this,et,{value:nt});Object.defineProperty(this,Z,{writable:true,value:void 0});Object.defineProperty(this,tt,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=t;babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=new Date}formatDate(){let t="";if(babelHelpers.classPrivateFieldLooseBase(this,et)[et]()){t=a.DateTimeFormat.getFormat("SHORT_TIME_FORMAT")}else if(babelHelpers.classPrivateFieldLooseBase(this,st)[st]()){t="D"}else if(babelHelpers.classPrivateFieldLooseBase(this,at)[at]()){t=a.DateTimeFormat.getFormat("DAY_SHORT_MONTH_FORMAT")}else{t=a.DateTimeFormat.getFormat("MEDIUM_DATE_FORMAT")}return a.DateTimeFormat.format(t,babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].getTime()/1e3)}}function nt(){return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].toLocaleDateString()===babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLocaleDateString()}function ot(){const t=parseInt(a.DateTimeFormat.format("W",babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]),10);const e=parseInt(a.DateTimeFormat.format("W",babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]),10);return babelHelpers.classPrivateFieldLooseBase(this,at)[at]()&&e===t}function ct(){return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].getFullYear()===babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].getFullYear()}const rt={props:{avatar:{type:Object,default:()=>{}},isSecret:{type:Boolean,default:true},isInvitation:{type:Boolean,default:true}},data(){return{secretSpaceImage:"/bitrix/components/bitrix/socialnetwork.spaces.list/templates/.default/images/socialnetwork-spaces_icon_close-spase.svg"}},computed:{avatarModel(){return this.avatar},avatarClass(){let t="";if(this.avatarModel.type==="icon"){if(this.avatarModel.id.length>0){t=`sonet-common-workgroup-avatar --${this.avatarModel.id}`}else{t="ui-icon-common-user-group ui-icon"}}return t},iconStyle(){let t="";if(this.avatarModel.type==="image"){t=`background-image: url(${this.avatarModel.id});`}return t},iconClass(){return this.avatarModel.type==="image"?"sn-spaces__list-item_img":""}},template:`\n\t\t<div class="sn-spaces__list-item_icon" :class="avatarClass">\n\t\t\t<i :style="iconStyle" :class="iconClass"/>\n\t\t\t<div v-if="isInvitation" class="sn-spaces__list-item_invitation-icon">\n\t\t\t\t<div class="ui-icon-set --mail" style="--ui-icon-set__icon-size: 18px;"></div>\n\t\t\t</div>\n\t\t\t<div class="sn-spaces__list-item_icon-close" v-if="isSecret"/>\n\t\t</div>\n\t`};const dt={components:{Avatar:rt},props:{space:{type:Object,default:()=>{}},mode:{type:String,required:true},isInvitation:{type:Boolean,default:false},showAvatar:{type:Boolean,default:true}},data(){return{modes:S,spaceUserRoles:f,doShowSuccessButton:false}},computed:{spaceModel(){return this.space},doShowCounter(){return this.spaceModel.counter&&this.spaceModel.counter>0&&this.mode===this.modes.recent&&!this.isApplicantButtonsShown},doShowPin(){return this.spaceModel.isPinned&&this.mode===this.modes.recent&&!this.isApplicantButtonsShown},isApplicantButtonsShown(){return this.doShowJoinButton||this.doShowPendingButton||this.doShowSuccessButton},doShowJoinButton(){return this.spaceModel.userRole===this.spaceUserRoles.nonMember&&this.mode===this.modes.recent},doShowPendingButton(){return this.spaceModel.userRole===this.spaceUserRoles.applicant&&this.mode===this.modes.recent},isFollowing(){return this.spaceModel.userRole!==this.spaceUserRoles.member||this.spaceModel.follow},spaceDescription(){const t=this.isApplicantButtonsShown||!this.spaceModel.lastActivityDescription||this.spaceModel.lastActivityDescription.length===0;return t?this.getVisibilityTypeName():this.spaceModel.lastActivityDescription},isCommon(){return this.spaceModel.id===0}},created(){this.$bitrix.eventEmitter.subscribe(`onSpaceUpdate_${this.spaceModel.id}`,this.onSpaceUpdate.bind(this))},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(`onSpaceUpdate_${this.spaceModel.id}`,this.onSpaceUpdate.bind(this))},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},getVisibilityTypeName(){var t;if(this.isCommon){return""}const e=(t=b.find((t=>t.type===this.spaceModel.visibilityType)))==null?void 0:t.nameMessageId;return this.loc(e)},formatDate(t){return it.formatDate(t)},isSecretSpace(t){return t===g.secret},formatCounter(t){if(t>99){return"99+"}if(t===0){return""}return t.toString()},counterClass(t){return t?"sn-spaces__list-item_counter":"sn-spaces__list-item_counter --mute"},showSuccessButton(){this.doShowSuccessButton=true;setTimeout((()=>{this.doShowSuccessButton=false}),1e3)},onSpaceUpdate(t){if(this.mode===this.modes.recent){const e=t.data;const s=I.getInstance();const a=s.buildSpaces([e]).pop();const i=this.spaceModel.userRole===this.spaceUserRoles.applicant;const n=a.userRole===this.spaceUserRoles.member;if(i&&n){this.showSuccessButton()}}},async onJoinButtonClick(t){t.preventDefault();await c.ajax.runAction("socialnetwork.api.userToGroup.join",{data:{params:{groupId:this.spaceModel.id}}}).then((t=>{const e=t.data.confirmationNeeded;let s=this.spaceUserRoles.member;if(e){s=this.spaceUserRoles.applicant}else{this.showSuccessButton()}this.$store.dispatch("changeUserRole",{spaceId:this.spaceModel.id,userRole:s})}),(t=>{console.log(t)}))},onPendingButtonClick(t){t.preventDefault()},onAcceptedButtonClick(t){t.preventDefault()},async acceptInvitationButtonClickHandler(t){t.preventDefault();await c.ajax.runAction("socialnetwork.api.userToGroup.acceptOutgoingRequest",{data:{groupId:this.spaceModel.id}}).then((t=>{const e=t.data;if(e){this.$store.dispatch("changeUserRole",{spaceId:this.spaceModel.id,userRole:this.spaceUserRoles.member});this.$store.dispatch("deleteInvitationFromStore",{spaceId:this.spaceModel.id})}}),(t=>{console.log(t)}))},async declineInvitationButtonClickHandler(t){t.preventDefault();await c.ajax.runAction("socialnetwork.api.userToGroup.rejectOutgoingRequest",{data:{groupId:this.spaceModel.id}}).then((t=>{const e=t.data;if(e){this.$store.dispatch("deleteInvitationFromStore",{spaceId:this.spaceModel.id});if(this.isSecretSpace(this.spaceModel.visibilityType)){this.$store.dispatch("deleteSpaceFromStore",{spaceId:this.spaceModel.id})}else{this.$store.dispatch("changeUserRole",{spaceId:this.spaceModel.id,userRole:this.spaceUserRoles.nonMember})}}}),(t=>{console.log(t)}))}},template:`\n\t\t<Avatar\n\t\t\tv-if="showAvatar"\n\t\t\t:avatar="spaceModel.avatar"\n\t\t\t:isSecret="isSecretSpace(spaceModel.visibilityType)"\n\t\t\t:isInvitation="isInvitation"\n\t\t/>\n\t\t<div class="sn-spaces__list-item_info">\n\t\t\t<div class="sn-spaces__list-item_title" :title="spaceModel.name">\n\t\t\t\t<div class="sn-spaces__list-item_name">{{spaceModel.name}}</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!isFollowing"\n\t\t\t\t\tclass="sn-spaces__list-item_mute ui-icon-set --sound-off"\n\t\t\t\t\tstyle="--ui-icon-set__icon-size: 18px;"\n\t\t\t\t\tdata-id="spaces-list-element-mute-icon"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class="sn-spaces__list-item_description" data-id="spaces-list-element-description">\n\t\t\t\t{{spaceDescription}}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="sn-spaces__list-item_details">\n\t\t\t<div class="sn-spaces__list-item_time" data-id="spaces-list-element-activity-date">\n\t\t\t\t{{formatDate(spaceModel.dateActivity.getTime())}}\n\t\t\t</div>\n\t\t\t<div class="sn-spaces__list-item_changes">\n\t\t\t\t<div\n\t\t\t\t\tv-if="doShowPin"\n\t\t\t\t\tclass="ui-icon-set --pin-1"\n\t\t\t\t\tstyle='--ui-icon-set__icon-size: 18px;'\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="doShowCounter"\n\t\t\t\t\t:class="counterClass(isFollowing)"\n\t\t\t\t\tdata-id="spaces-list-element-counter"\n\t\t\t\t>\n\t\t\t\t\t{{formatCounter(spaceModel.counter)}}\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\tv-if="doShowJoinButton"\n\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-success ui-btn-no-caps ui-btn-round sn-spaces__list-item_btn-event"\n\t\t\t\t\t@click="onJoinButtonClick"\n\t\t\t\t\tdata-id="spaces-list-element-join-button"\n\t\t\t\t>\n\t\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_JOIN_SPACE_BUTTON')}}\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tv-if="doShowPendingButton"\n\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-primary ui-btn-no-caps ui-btn-round sn-spaces__list-item_btn-event"\n\t\t\t\t\t@click="onPendingButtonClick"\n\t\t\t\t\tdata-id="spaces-list-element-pending-button"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --mail-out" style='--ui-icon-set__icon-color: white;'></div>\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tv-if="doShowSuccessButton"\n\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-primary ui-btn-no-caps ui-btn-round sn-spaces__list-item_btn-event"\n\t\t\t\t\t@click="onAcceptedButtonClick"\n\t\t\t\t\tdata-id="spaces-list-element-success-button"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --check" style='--ui-icon-set__icon-color: white;'></div>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if="isInvitation" class="sn-spaces__list-item_btns">\n\t\t\t<button\n\t\t\t\tclass="ui-btn ui-btn-sm ui-btn-success ui-btn-no-caps ui-btn-round"\n\t\t\t\t@click="acceptInvitationButtonClickHandler"\n\t\t\t\tdata-id="spaces-list-element-accept-invitation-button"\n\t\t\t>\n\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_ACCEPT_INVITATION_BUTTON')}}\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\tclass="ui-btn ui-btn-sm ui-btn-light-border ui-btn-no-caps ui-btn-round"\n\t\t\t\t@click="declineInvitationButtonClickHandler"\n\t\t\t\tdata-id="spaces-list-element-decline-invitation-button"\n\t\t\t>\n\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_DECLINE_INVITATION_BUTTON')}}\n\t\t\t</button>\n\t\t</div>\n\t`};const lt="sn-spaces__short";const pt={components:{BasePopup:M,SpaceContent:dt},emits:["closeSpacePopup"],props:{bindElement:{type:Object,required:true},context:{type:String,required:true},options:{type:Object,required:true},space:{type:Object,default:()=>{}},mode:{type:String,required:true},link:{type:String,required:true},isInvitation:{type:Boolean,default:false}},data(){return{modes:S}},computed:{POPUP_ID(){return`${lt}-${this.context}`},config(){return{className:"sn-spaces__list-popup",width:293,height:this.heightPopup,closeIcon:false,closeByEsc:true,overlay:false,padding:0,animation:"fading-slide",offsetLeft:this.options.left,offsetTop:-70,bindOptions:{position:"bottom"},bindElement:this.bindElement}},classModifiers(){const t=[];if(this.isInvitation){t.push("--invitation")}return t.join(" ")},spaceModel(){return this.space},heightPopup(){return this.isInvitation?115:70}},methods:{closePopupShortSpace(){this.$emit("closeSpacePopup")}},template:`\n\t\t<BasePopup\n\t\t\t:config="config"\n\t\t\t:id="POPUP_ID"\n\t\t>\n\t\t\t<a\n\t\t\t\t:href="link"\n\t\t\t\tref="popup-content"\n\t\t\t\tclass="sn-spaces__popup-list_collapsed-mode"\n\t\t\t\t@mouseleave="closePopupShortSpace"\n\t\t\t>\n\t\t\t\t<div \n\t\t\t\t\tclass="sn-spaces__popup-list-item"\n\t\t\t\t\t:class="classModifiers"\n\t\t\t\t>\n\t\t\t\t\t<SpaceContent \n\t\t\t\t\t\t:space="space" \n\t\t\t\t\t\t:mode="mode"\n\t\t\t\t\t\t:is-invitation="isInvitation"\n\t\t\t\t\t\t:showAvatar="false"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t</BasePopup>\n\t`};const ht={components:{PopupShortSpace:pt,SpaceContent:dt},props:{space:{type:Object,default:()=>{}},mode:{type:String,required:true},isInvitation:{type:Boolean,default:false}},data(){return{modes:S,spaceUserRoles:f,showModePopup:false}},computed:{popupShortSpaceOptions(){return{left:this.widthItem}},classModifiers(){const t=this.mode===this.modes.recent;const e=[];if(this.spaceModel.isSelected&&t){e.push("--active")}if(this.isInvitation){e.push("--invitation")}return e.join(" ")},link(){return C.getSpaceLink(this.spaceModel.id)},spaceModel(){return this.space},widthItem(){return this.$refs.link.getBoundingClientRect().width},isCommon(){return this.spaceModel.id===0}},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},getPinMessage(){return this.spaceModel.isPinned?this.loc("SOCIALNETWORK_SPACES_LIST_SPACE_UNPIN"):this.loc("SOCIALNETWORK_SPACES_LIST_SPACE_PIN")},getFollowMessage(){return this.spaceModel.follow?this.loc("SOCIALNETWORK_SPACES_LIST_SPACE_UNFOLLOW"):this.loc("SOCIALNETWORK_SPACES_LIST_SPACE_FOLLOW")},getOpenMessage(){return this.loc("SOCIALNETWORK_SPACES_LIST_SPACE_OPEN")},async onSpaceClick(){if([S.recentSearch,S.search].includes(this.mode)){await p.addSpaceToRecentSearch(this.spaceModel.id)}},async onSpaceContextMenuClick(t){t.preventDefault();if(this.isCommon||this.spaceModel.userRole!==f.member){return}const e=new Q({spaceId:this.spaceModel.id,bindElement:t.currentTarget,path:this.link,isSelected:this.spaceModel.isSelected,pinMessage:this.getPinMessage(),followMessage:this.getFollowMessage(),openMessage:this.getOpenMessage()});e.toggle()},openPopup(){if(this.$store.getters.spacesListState===w.collapsed){this.showModePopup=true}},closePopup(){if(this.$store.getters.spacesListState===w.collapsed){const t=this.$refs.link;const e=this.$refs["popup-item"].$refs["popup-content"];let s=null;c.Event.bind(document,"mouseover",(t=>{s=t.target}));setTimeout((()=>{if(!t.contains(s)&&!e.contains(s)){this.showModePopup=false}}),100)}}},template:`\n\t\t<a\n\t\t\tref="link"\n\t\t\t:href="link"\n\t\t\tclass="sn-spaces__list-item"\n\t\t\t:class="classModifiers"\n\t\t\tdata-id="spaces-list-element"\n\t\t\t@click="onSpaceClick"\n\t\t\t@contextmenu="onSpaceContextMenuClick"\n\t\t\t@mouseenter="openPopup"\n\t\t\t@mouseleave="closePopup"\n\t\t>\n\t\t\t<PopupShortSpace\n\t\t\t\tref="popup-item"\n\t\t\t\t:options="popupShortSpaceOptions"\n\t\t\t\t:space="space"\n\t\t\t\t:mode="mode"\n\t\t\t\t:link="link"\n\t\t\t\t:is-invitation="isInvitation"\n\t\t\t\tcontext="popup-short-space"\n\t\t\t\t:bind-element="$refs['link'] || {}"\n\t\t\t\tv-if="showModePopup"\n\t\t\t\t@close="showModePopup = false"\n\t\t\t\t@closeSpacePopup="closePopup"\n\t\t\t/>\n\t\t\t<SpaceContent \n\t\t\t\t:space="space" \n\t\t\t\t:mode="mode"\n\t\t\t\t:is-invitation="isInvitation"\n\t\t\t/>\n\t\t</a>\n\t`};const ut=Object.freeze({enter:13});const St={components:{PopupMenu:F},data(){return{modes:S,spaceViewModes:b,spaceViewModeTypes:g,spaceData:{name:"",viewMode:g.open,image:null},isFocusedOnNameInput:false,showViewModePopup:false,wasCreateGroupRequestSent:false,doShowNameAlreadyExistsError:false,avatarColor:""}},computed:{...o.mapGetters({avatarColors:"avatarColors",previousAvatarColor:"previousAvatarColor"}),isDataValidated(){return this.spaceData.name.length>0&&!this.doShowNameAlreadyExistsError},confirmButtonClass(){return this.isDataValidated&&!this.wasCreateGroupRequestSent?"":"--disabled"},popupMenuOptions(){return this.spaceViewModes.map((t=>({type:t.type,name:this.loc(t.nameMessageId),description:this.loc(t.descriptionMessageId)})))},selectedViewModeOptionName(){return this.loc(`SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_${this.spaceData.viewMode.toUpperCase()}_TITLE`)},nameInputModifier(){return this.doShowNameAlreadyExistsError?"sn-spaces__list-add-item_input-error":""},isNameInputReadOnly(){return this.wasCreateGroupRequestSent}},mounted(){this.$refs.spaceAddFormNameInput.focus();c.Event.bind(document,"mouseup",this.handleAutoHide);c.Event.bind(document,"keydown",this.handleKeyDown);this.$bitrix.eventEmitter.subscribe(P.showUpperSpaceAddForm,this.chooseRandomAvatarColor);this.chooseRandomAvatarColor()},unmounted(){c.Event.unbind(document,"mouseup",this.handleAutoHide);c.Event.unbind(document,"keydown",this.handleKeyDown);this.$bitrix.eventEmitter.unsubscribe(P.showUpperSpaceAddForm,this.chooseRandomAvatarColor)},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},openViewModePopup(){this.showViewModePopup=true},onChangeSelectedOption(t){this.spaceData.viewMode=t},chooseSpaceImage(){const t=this.getAvatarEditor();t.show("file")},getAvatarEditor(){if(!this.avatarEditor){this.avatarEditor=new i.Editor({enableCamera:false});this.avatarEditor.subscribe("onApply",(t=>{var e;const[s]=t.getCompatData();(e=s.name)!=null?e:s.name="tmp.png";this.spaceData.image=s;this.$refs.groupImage.src=URL.createObjectURL(s);c.Dom.style(this.$refs.groupImageContainer,"background","none");c.Dom.style(this.$refs.groupImage,"background","none")}))}return this.avatarEditor},onAddSpaceClickHandler(){this.addSpace()},chooseRandomAvatarColor(){if(this.spaceData.image!==null){return}if(!c.Type.isArrayFilled(this.avatarColors)){return}const t=this.avatarColors.filter((t=>t!==this.previousAvatarColor));this.avatarColor=t[Math.floor(Math.random()*t.length)];c.Dom.style(this.$refs.groupImageContainer,"backgroundColor",`#${this.avatarColor}`);this.$store.dispatch("setAvatarColor",this.avatarColor)},addSpace(){this.spaceData.name=this.spaceData.name.trim();if(this.spaceData.name.length===0){return}const t=new FormData;t.append("groupName",this.spaceData.name);t.append("viewMode",this.spaceData.viewMode);if(this.spaceData.image!==null){t.append("groupImage",this.spaceData.image,this.spaceData.image.name)}t.append("avatarColor",this.avatarColor);this.wasCreateGroupRequestSent=true;c.ajax.runAction("socialnetwork.api.workgroup.createGroup",{data:t}).then((t=>{location.href=`${C.getSpaceLink(t.data.groupId)}?empty-state=enabled`}),(t=>{t.errors.forEach((t=>{if(t.code==="ERROR_GROUP_NAME_EXISTS"){this.doShowNameAlreadyExistsError=true}}));this.wasCreateGroupRequestSent=false;console.log(t)}))},handleAutoHide(t){if(this.shouldHideForm(t)){this.$bitrix.eventEmitter.emit(P.hideSpaceAddForm)}},handleKeyDown(t){if(this.isFocusedOnNameInput&&t.keyCode===ut.enter&&this.isDataValidated&&!this.wasCreateGroupRequestSent){this.addSpace()}},shouldHideForm(t){var e,s;const a=this.$refs.spaceAddForm.offsetHeight===0;if(a){return false}const i=t.target.closest(".sn-spaces__list-item")!==null;const n=this.$refs.spaceAddForm.contains(t.target);const o=(e=this.avatarEditor)==null?void 0:(s=e.popup)==null?void 0:s.isShown();const c=this.showViewModePopup;const r=o||c;return!n&&!i&&!r&&!this.formDataChanged()},formDataChanged(){const t=this.spaceData.name!=="";const e=this.spaceData.viewMode!==g.open;const s=this.$refs.groupImage.src!=="";return t||e||s}},template:`\n\t\t<div class="sn-spaces__list-item --add-active --error" ref="spaceAddForm" data-id="spaces-list-add-space-form">\n\t\t\t<div class="sn-spaces__list-item_add">\n\t\t\t\t<div class="sn-spaces__list-item_icon" ref="groupImageContainer">\n\t\t\t\t\t<img\n\t\t\t\t\t\talt="" class="spaces-list-add-space-image"\n\t\t\t\t\t\t@click="chooseSpaceImage()"\n\t\t\t\t\t\tref="groupImage"\n\t\t\t\t\t\tdata-id="spaces-list-add-space-image"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class="sn-spaces__list-item_info">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-xs ui-ctl-no-padding ui-ctl-no-border">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tv-model="spaceData.name"\n\t\t\t\t\t\t\ttype="text" class="ui-ctl-element"\n\t\t\t\t\t\t\t:placeholder="loc('SOCIALNETWORK_SPACES_LIST_ADD_SPACE_FORM_NAME_PLACEHOLDER')"\n\t\t\t\t\t\t\tref="spaceAddFormNameInput"\n\t\t\t\t\t\t\tdata-id="spaces-list-add-space-name-input"\n\t\t\t\t\t\t\t@focus="isFocusedOnNameInput=true"\n\t\t\t\t\t\t\t@blur="isFocusedOnNameInput=false"\n\t\t\t\t\t\t\t:class="nameInputModifier"\n\t\t\t\t\t\t\t@input="doShowNameAlreadyExistsError=false"\n\t\t\t\t\t\t\t:readonly="isNameInputReadOnly"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div @click="openViewModePopup" ref="privacySelector" class="sn-spaces__list-item_select-private">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="sn-spaces__list-item_select-private-text"\n\t\t\t\t\t\t\tdata-id="spaces-list-add-space-view-mode"\n\t\t\t\t\t\t>{{selectedViewModeOptionName}}</div>\n\t\t\t\t\t\t<div class="ui-icon-set --chevron-down" style="--ui-icon-set__icon-size: 14px;"></div>\n\t\t\t\t\t\t<PopupMenu\n\t\t\t\t\t\t\tv-if="showViewModePopup"\n\t\t\t\t\t\t\t:options="popupMenuOptions"\n\t\t\t\t\t\t\tcontext="space-add-form"\n\t\t\t\t\t\t\t:bind-element="this.$refs.privacySelector || {}"\n\t\t\t\t\t\t\t:hint="loc('SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_HINT')"\n\t\t\t\t\t\t\t:selectedOption="this.spaceData.viewMode"\n\t\t\t\t\t\t\t@close="showViewModePopup = false"\n\t\t\t\t\t\t\t@changeSelectedOption="onChangeSelectedOption"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="sn-spaces__list-item_details">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="ui-icon-set --circle-check sn-spaces__list-item_save-btn" :class="confirmButtonClass"\n\t\t\t\t\t\t@click="onAddSpaceClickHandler()"\n\t\t\t\t\t\tdata-id="spaces-list-add-space-create-button"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-show="doShowNameAlreadyExistsError" class="sn-spaces__list-item_error">\n\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_NAME_ALREADY_EXISTS_ERROR')}}\n\t\t\t</div>\n\t\t</div>\n\t`};const mt={methods:{loc(t){return this.$bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="sn-spaces__list-item --add-btn">\n\t\t\t<div class="sn-spaces__list-item_icon">\n\t\t\t</div>\n\t\t\t<div class="sn-spaces__list-item_info">\n\t\t\t\t<div class="sn-spaces__list-item_title">\n\t\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_ADD_SPACE_ITEM_TITLE')}}\n\t\t\t\t</div>\n\t\t\t\t<div class="sn-spaces__list-item_description">\n\t\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_ADD_SPACE_ITEM_DESCRIPTION')}}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const vt={data(){return{loader:null}},props:{config:{type:Object,required:false,default(){return{}}}},mounted(){this.getLoaderInstance().show()},beforeUnmount(){if(!this.instance){return}this.destroyLoader()},methods:{getLoaderInstance(){if(!this.instance){this.instance=new n.Loader(this.getLoaderConfig())}return this.instance},getDefaultConfig(){return{target:this.$refs.root,size:110,color:"#2fc6f6",offset:{left:"0px",top:"0px"},mode:"absolute"}},getLoaderConfig(){const t=this.getDefaultConfig();return{...t,...this.config}},destroyLoader(){this.instance.destroy();this.instance=null}},template:`\n\t\t<div ref="root" style="position: relative">\n\t\t</div>\n\t`};const gt=20;const bt={components:{Space:ht,Loader:vt,SpaceListAddButton:mt,SpaceAddForm:St},emits:["isSpaceAddFormShown"],data(){return{isScrollLoading:false,isLoading:false,modes:S,doShowLowerSpaceAddForm:false,doShowUpperSpaceAddForm:false,skeletonItemsAmount:25}},props:{mode:{type:String,required:true},spaces:{type:Array,required:true,default:[]},spaceInvitations:{type:Array,required:false,default:[]},canCreateGroup:Boolean,spacesCountForLoad:{type:Number,required:true},serviceInstance:{type:Object,required:true},subtitle:{type:String,required:false,default:""},isShown:{type:Boolean,required:true}},created(){this.$bitrix.eventEmitter.subscribe(P.tryToLoadSpacesIfHasNoScrollbar,this.tryToLoadSpacesIfHasNoScrollbarHandler);this.$bitrix.eventEmitter.subscribe(P.showLoader,this.showLoaderHandler);this.$bitrix.eventEmitter.subscribe(P.hideLoader,this.hideLoaderHandler);this.$bitrix.eventEmitter.subscribe(P.showUpperSpaceAddForm,this.showUpperSpaceAddFormHandler);this.$bitrix.eventEmitter.subscribe(P.hideSpaceAddForm,this.hideSpaceAddFormHandler)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(P.tryToLoadSpacesIfHasNoScrollbar,this.tryToLoadSpacesIfHasNoScrollbarHandler);this.$bitrix.eventEmitter.unsubscribe(P.showLoader,this.showLoaderHandler);this.$bitrix.eventEmitter.unsubscribe(P.hideLoader,this.hideLoaderHandler);this.$bitrix.eventEmitter.unsubscribe(P.showUpperSpaceAddForm,this.showUpperSpaceAddFormHandler);this.$bitrix.eventEmitter.unsubscribe(P.hideSpaceAddForm,this.hideSpaceAddFormHandler)},computed:{service(){return this.serviceInstance},hasScrollbar(){return this.$refs.list.scrollHeight>this.$refs.list.clientHeight},loadingClass(){return this.isLoading?"--loading":""},filterMode(){return this.$store.state.main.selectedFilterModeType},doShowSubtitle(){return this.subtitle.length>0},doShowSpaceListAddButton(){return this.canCreateGroup&&this.mode===this.modes.recent&&this.spaces.length<=5&&!this.isSpaceAddFormShown},doShowInvitations(){return this.mode===this.modes.recent&&this.spaceInvitations.length>0},isSpaceAddFormShown(){return this.doShowLowerSpaceAddForm||this.doShowUpperSpaceAddForm},listState(){return this.$store.getters.spacesListState}},watch:{filterMode(){this.scrollToTop();this.isLoading=false},isShown(){if(this.isShown===true){const t=this.$refs.list.scrollTop>0;this.$bitrix.eventEmitter.emit(P.spaceListShown,{isSpaceListScrolled:t,mode:this.mode})}},doShowUpperSpaceAddForm(){if(this.doShowUpperSpaceAddForm===true){this.doShowLowerSpaceAddForm=false}},isSpaceAddFormShown(){this.$emit("isSpaceAddFormShown",this.isSpaceAddFormShown)}},methods:{tryToLoadSpacesIfHasNoScrollbarHandler(t){const e=t.data;if(this.isProperMode(e)&&!this.hasScrollbar&&this.service.canLoadSpaces()){this.loadSpaces()}},showLoaderHandler(t){const e=t.data;if(this.isProperMode(e)){this.isLoading=true}},hideLoaderHandler(t){const e=t.data;if(this.isProperMode(e)){this.isLoading=false}},showUpperSpaceAddFormHandler(){if(this.mode===this.modes.recent){this.doShowUpperSpaceAddForm=true}},showLowerSpaceAddForm(){this.doShowLowerSpaceAddForm=true},hideSpaceAddFormHandler(){this.doShowLowerSpaceAddForm=false;this.doShowUpperSpaceAddForm=false;if(this.listState===w.expanded){this.$bitrix.eventEmitter.emit(P.changeSpaceListState,w.collapsed)}},isProperMode(t){return this.mode===t},scrollToTop(){this.$refs.list.scrollTop=0},onScroll(t){const e=t.target;const s=e.scrollTop>0;this.$bitrix.eventEmitter.emit(P.spaceListScroll,{isSpaceListScrolled:s,mode:this.mode});const a=e.scrollHeight-e.offsetHeight;const i=e.scrollTop;const n=i>a-gt;if(!this.isScrollLoading&&this.service.canLoadSpaces()&&n){this.loadSpaces()}J.getInstance().destroy()},loadSpaces(){this.isScrollLoading=true;this.service.loadSpaces({loadedSpacesCount:this.spacesCountForLoad,filterMode:this.filterMode}).then((t=>{this.$store.dispatch("addSpacesToView",{mode:this.mode,spaces:t.spaces});this.isScrollLoading=false})).catch((()=>{setTimeout((()=>{this.isScrollLoading=false}),5e3)}))}},template:`\n\t\t<span>\n\t\t\t<Loader v-if="isLoading" :config="{offset: {left: '0px', top: '40vh'}}"/>\n\t\t\t<div\n\t\t\t\t@scroll="onScroll"\n\t\t\t\tclass="sn-spaces__list-content"\n\t\t\t\t:class="loadingClass"\n\t\t\t\tref="list"\n\t\t\t\tdata-id="spaces-list-content"\n\t\t\t>\n\t\t\t\t<div v-show="doShowSubtitle" class="sn-spaces__list-subtitle">\n\t\t\t\t\t{{subtitle}}\n\t\t\t\t</div>\n\t\t\t\t<SpaceAddForm v-if="doShowUpperSpaceAddForm"/>\n\t\t\t\t<div class="sn-spaces__list-item_invitation" v-if="doShowInvitations">\n\t\t\t\t\t<Space\n\t\t\t\t\t\tv-for="spaceInvitation in spaceInvitations"\n\t\t\t\t\t\t:key="spaceInvitation.id"\n\t\t\t\t\t\t:space="spaceInvitation"\n\t\t\t\t\t\t:mode="mode"\n\t\t\t\t\t\t:isInvitation="true"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<Space \n\t\t\t\t\tv-for="space in spaces"\n\t\t\t\t\t:key="space.id"\n\t\t\t\t\t:space="space"\n\t\t\t\t\t:mode="mode"/>\n\t\t\t\t<SpaceListAddButton\n\t\t\t\t\tv-if="doShowSpaceListAddButton"\n\t\t\t\t\t@click="showLowerSpaceAddForm"\n\t\t\t\t\tdata-id="spaces-list-add-space-button"\n\t\t\t\t/>\n\t\t\t\t<SpaceAddForm v-if="doShowLowerSpaceAddForm"/>\n\t\t\t\t<span v-show="isScrollLoading">\n\t\t\t\t\t<div v-for="index in skeletonItemsAmount" :key="index" class="sn-spaces__list-skeleton-item"></div>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</span>\n\t`};class ft{constructor(){this.hasMoreSpacesToLoad=false}static getInstance(){if(!this.instance){this.instance=new this}return this.instance}async loadSpaces(){return p.loadRecentSearchSpaces()}canLoadSpaces(){return false}}ft.instance=null;const It=3;const _t={name:"ToggleBlock",data(){return{dataSpacesContent:document.getElementById("sn-spaces__content"),counterImpressionsBtnShowToggleBlock:0,showBtnShowToggleBlock:false}},created(){this.$bitrix.eventEmitter.subscribe(P.showBtnToggleBlock,this.showBtnToggleBlockHandler)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(P.showBtnToggleBlock,this.showBtnToggleBlockHandler)},computed:{isShowHintBtn(){return!(this.counterImpressionsBtnShowToggleBlock>It)},btnClassName(){return this.showBtnShowToggleBlock?"":"--hide"}},mounted(){if(localStorage.counterImpressionsBtnShowToggleBlock){this.counterImpressionsBtnShowToggleBlock=localStorage.counterImpressionsBtnShowToggleBlock}},methods:{showBtnToggleBlockHandler(){if(this.isShowHintBtn&&!this.showBtnShowToggleBlock){this.showBtnShowToggleBlock=true}},hideBtnToggleBlockHandler(){this.showBtnShowToggleBlock=false},hideHintBtn(){localStorage.counterImpressionsBtnShowToggleBlock=++this.counterImpressionsBtnShowToggleBlock;this.showBtnShowToggleBlock=false},toggleList(){this.showBtnShowToggleBlock=false;if(this.$store.getters.spacesListState===w.collapsed){this.$bitrix.eventEmitter.emit(P.changeSpaceListState,w.default);this.saveState(w.default);c.Dom.removeClass(this.dataSpacesContent,"--list-collapsed-mode")}else{this.$bitrix.eventEmitter.emit(P.changeSpaceListState,w.collapsed);this.saveState(w.collapsed);c.Dom.addClass(this.dataSpacesContent,"--list-collapsed-mode")}},saveState(t){c.ajax.runAction("socialnetwork.api.space.saveListSate",{data:{spacesListState:t}})}},template:`\n\t\t<div class="sn-spaces__toggle-block">\n\t\t\t<div class="sn-spaces__toggle-image"></div>\n\t\t\t<div \n\t\t\t\tclass="sn-spaces__toggle-wrapper"\n\t\t\t\t@click="toggleList"\n\t\t\t>\n\t\t\t\t<div \n\t\t\t\t\tref="toggle-btn"\n\t\t\t\t\tclass="sn-spaces__toggle-btn" \n\t\t\t\t\tid="sn-spaces__toggle-btn"\n\t\t\t\t\tdata-id="sn-spaces__toggle-btn"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --chevron-left" style="--ui-icon-set__icon-size: 15px;"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="sn-spaces__btn-show-toggle-block"\n\t\t\t\t:class="btnClassName"\n\t\t\t\tdata-id="sn-spaces__btn-hint_show-toggle-block"\n\t\t\t\tv-if="isShowHintBtn"\n\t\t\t\t@click="hideHintBtn"\n\t\t\t\t@mouseleave="hideBtnToggleBlockHandler"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --chevron-left" style="--ui-icon-set__icon-size: 15px;"></div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Lt={components:{RecentHeader:O,SpaceList:bt,SearchHeader:D,CollapsedModeToggleBlock:_t},data(){return{mode:"recent",modes:S,listNode:document.getElementById("sn-spaces-list"),isSpaceAddFormShownInRecentList:false}},computed:{...o.mapGetters({recentSpaces:"recentSpaces",recentSpacesCountForLoad:"recentSpacesCountForLoad",recentSearchSpaces:"recentSearchSpaces",recentSearchSpacesCountForLoad:"recentSearchSpacesCountForLoad",searchSpaces:"searchSpaces",searchSpacesCountForLoad:"searchSpacesCountForLoad",spacesLoadedByCurrentSearchQueryCount:"spacesLoadedByCurrentSearchQueryCount",canCreateGroup:"canCreateGroup",spaceInvitations:"spaceInvitations"}),doExpandCollapsedList(){const t=this.$store.getters.spacesListState===w.collapsed;const e=[this.modes.search,this.modes.recentSearch].includes(this.mode);return t&&(e||this.isSpaceAddFormShownInRecentList)},doCollapseExpandedList(){const t=this.$store.getters.spacesListState===w.expanded;const e=this.modes.recent===this.mode;return t&&e&&!this.isSpaceAddFormShownInRecentList}},watch:{doExpandCollapsedList(){if(this.doExpandCollapsedList){this.changeSpaceListState(w.expanded)}},doCollapseExpandedList(){if(this.doCollapseExpandedList){this.changeSpaceListState(w.collapsed)}}},created(){this.$bitrix.eventEmitter.subscribe(P.changeSpaceListState,this.changeSpaceListStateHandler)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(P.changeSpaceListState,this.changeSpaceListStateHandler)},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},setMode(t){this.mode=t},getRecentService(){return u.getInstance()},getRecentSearchService(){return ft.getInstance()},getSearchService(){return k.getInstance()},changeSpaceListStateHandler(t){const e=t.data;this.changeSpaceListState(e)},changeSpaceListState(t){if(t===w.expanded&&!c.Dom.hasClass(this.listNode,"--fixed")){c.Dom.addClass(this.listNode,"--fixed")}else if(c.Dom.hasClass(this.listNode,"--fixed")){c.Dom.removeClass(this.listNode,"--fixed")}this.$store.dispatch("setSpacesListState",t)},isSpaceAddFormShownHandler(t){this.isSpaceAddFormShownInRecentList=t}},template:`\n\t\t<div class="sn-spaces__list-wrapper">\n\t\t\t<RecentHeader\n\t\t\t\tv-if="mode === modes.recent"\n\t\t\t\t:canCreateGroup="canCreateGroup"\n\t\t\t\t@changeMode="setMode"\n\t\t\t/>\n\t\t\t<SearchHeader\n\t\t\t\tv-if="mode === modes.search || mode === modes.recentSearch"\n\t\t\t\t@changeMode="setMode"\n\t\t\t/>\n\t\t\t<SpaceList\n\t\t\t\tv-show="mode === modes.recent"\n\t\t\t\t@isSpaceAddFormShown="isSpaceAddFormShownHandler"\n\t\t\t\t:isShown="mode === modes.recent"\n\t\t\t\t:mode="modes.recent"\n\t\t\t\t:spaces="recentSpaces"\n\t\t\t\t:spaceInvitations="spaceInvitations"\n\t\t\t\t:canCreateGroup="canCreateGroup"\n\t\t\t\t:spacesCountForLoad="recentSpacesCountForLoad"\n\t\t\t\t:serviceInstance="getRecentService()"\n\t\t\t/>\n\t\t\t<SpaceList\n\t\t\t\tv-show="mode === modes.recentSearch"\n\t\t\t\t:isShown="mode === modes.recentSearch"\n\t\t\t\t:mode="modes.recentSearch"\n\t\t\t\t:spaces="recentSearchSpaces"\n\t\t\t\t:canCreateGroup="canCreateGroup"\n\t\t\t\t:spacesCountForLoad="recentSearchSpacesCountForLoad"\n\t\t\t\t:serviceInstance="getRecentSearchService()"\n\t\t\t\t:subtitle="loc('SOCIALNETWORK_SPACES_LIST_RECENT_SEARCH_LIST_TITLE')"\n\t\t\t/>\n\t\t\t<SpaceList\n\t\t\t\tv-show="mode === modes.search"\n\t\t\t\t:isShown="mode === modes.search"\n\t\t\t\t:mode="modes.search"\n\t\t\t\t:spaces="searchSpaces"\n\t\t\t\t:canCreateGroup="canCreateGroup"\n\t\t\t\t:spacesCountForLoad="searchSpacesCountForLoad"\n\t\t\t\t:serviceInstance="getSearchService()"\n\t\t\t\t:subtitle="loc('SOCIALNETWORK_SPACES_LIST_SEARCH_LIST_TITLE')"\n\t\t\t/>\n\t\t</div>\n\t\t<CollapsedModeToggleBlock />\n\t`};var Ct=babelHelpers.classPrivateFieldLooseKey("pinChanged");var wt=babelHelpers.classPrivateFieldLooseKey("updateCounters");var Pt=babelHelpers.classPrivateFieldLooseKey("onChangeSpace");var yt=babelHelpers.classPrivateFieldLooseKey("onChangeUserRole");var Mt=babelHelpers.classPrivateFieldLooseKey("onChangeSubscription");class Tt extends r.EventEmitter{constructor(){super();Object.defineProperty(this,Mt,{value:Ot});Object.defineProperty(this,yt,{value:Ft});Object.defineProperty(this,Pt,{value:Bt});Object.defineProperty(this,wt,{value:At});Object.defineProperty(this,Ct,{value:Et});this.setEventNamespace("BX.Socialnetwork.Spaces.List.PullRequests")}getModuleId(){return"socialnetwork"}getMap(){return{workgroup_pin_changed:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].bind(this),user_spaces_counter:babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].bind(this),workgroup_update:babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt].bind(this),space_user_role_change:babelHelpers.classPrivateFieldLooseBase(this,yt)[yt].bind(this),workgroup_subscribe_changed:babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].bind(this)}}}function Et(t){this.emit(P.pinChanged,{spaceId:t.GROUP_ID,isPinned:t.ACTION==="pin"})}function At(t){this.emit(P.updateCounters,t)}function Bt(t){const e=t.params;this.emit(P.changeSpace,{spaceId:e.GROUP_ID})}function Ft(t){this.emit(P.changeUserRole,{spaceId:t.GROUP_ID,userId:t.USER_ID})}function Ot(t){this.emit(P.changeSubscription,{spaceId:t.GROUP_ID,userId:t.USER_ID})}var Rt=babelHelpers.classPrivateFieldLooseKey("initialOptions");var kt=babelHelpers.classPrivateFieldLooseKey("target");var Dt=babelHelpers.classPrivateFieldLooseKey("application");var Ht=babelHelpers.classPrivateFieldLooseKey("initLinkManager");var $t=babelHelpers.classPrivateFieldLooseKey("initServices");var xt=babelHelpers.classPrivateFieldLooseKey("createApplication");class Nt{constructor(t){Object.defineProperty(this,xt,{value:Kt});Object.defineProperty(this,$t,{value:jt});Object.defineProperty(this,Ht,{value:Ut});Object.defineProperty(this,Rt,{writable:true,value:void 0});Object.defineProperty(this,kt,{writable:true,value:void 0});Object.defineProperty(this,Dt,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]=t}create(t){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=t;babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]();babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]();babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]()}}function Ut(){C.groupPath=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].pathToGroupSpace;C.commonSpacePath=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].pathToUserSpace}function jt(){u.getInstance().setSelectedSpaceId(parseInt(babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].selectedSpaceId,10))}function Kt(){const t=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].recentSpaceIds;const s=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].invitationSpaceIds;const a=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].invitations;const i=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].spaces;const n=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].avatarColors;const o=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].filterMode;const c=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].spacesListMode;const r=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].canCreateGroup;const l=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].currentUserId;babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]=e.BitrixVue.createApp({name:"SpacesList",props:{initialSpaces:Array,selectedFilterModeType:String,spacesListState:String,canCreateGroup:Boolean,recentSpaceIds:Array,invitations:Array,invitationSpaceIds:Array},components:{BaseComponent:Lt},methods:{castArrayValuesToInt(t){return t.map((t=>parseInt(t,10)))},subscribeToPull(){const t=new Tt;t.subscribe(P.pinChanged,this.pinChangedHandler);t.subscribe(P.updateCounters,this.updateCountersHandler);t.subscribe(P.changeSpace,this.updateSpaceData);t.subscribe(P.changeUserRole,this.updateSpaceUserData);t.subscribe(P.changeSubscription,this.updateSpaceUserData);d.PULL.subscribe(t)},pinChangedHandler(t){this.pinSpace(t.getData().spaceId,t.getData().isPinned)},pinSpace(t,e){this.$store.dispatch("pinSpace",{spaceId:t,isPinned:e})},updateCountersHandler(t){if(t.data.userId&&parseInt(t.data.userId,10)===l){this.$store.dispatch("updateCounters",t.data)}},async updateSpaceData(t){if(t.data.spaceId){const e=await p.loadSpaceData(t.data.spaceId);this.$store.dispatch("updateSpaceData",e)}},async updateSpaceUserData(t){if(t.data.userId&&parseInt(t.data.userId,10)===l){const e=await p.loadSpaceData(t.data.spaceId);if(e.space){this.$bitrix.eventEmitter.emit(`onSpaceUpdate_${e.space.id}`,e.space)}this.$store.dispatch("updateSpaceData",e)}}},beforeCreate(){this.$bitrix.Application.set(this)},created(){this.$store.dispatch("setSpaces",this.initialSpaces);this.$store.dispatch("setRecentSpaceIds",this.castArrayValuesToInt(this.recentSpaceIds));this.$store.dispatch("setInvitationSpaceIds",this.castArrayValuesToInt(this.invitationSpaceIds));this.$store.dispatch("setInvitations",this.invitations);this.$store.dispatch("setAvatarColors",n);this.$store.dispatch("setSelectedFilterModeType",this.selectedFilterModeType);this.$store.dispatch("setSpacesListState",this.spacesListState);this.$store.dispatch("setCanCreateGroup",this.canCreateGroup);this.subscribeToPull()},mounted(){this.$bitrix.eventEmitter.emit(P.showLoader,S.recentSearch);ft.getInstance().loadSpaces().then((t=>{this.$store.dispatch("addSpacesToView",{mode:S.recentSearch,spaces:t});this.$bitrix.eventEmitter.emit(P.hideLoader,S.recentSearch)})).catch((()=>{}))},template:`\n\t\t\t\t\t<BaseComponent/>\n\t\t\t\t`},{initialSpaces:i,selectedFilterModeType:o,spacesListState:c,canCreateGroup:r,recentSpaceIds:t,invitationSpaceIds:s,invitations:a});babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt].use(L);babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt].mount(babelHelpers.classPrivateFieldLooseBase(this,kt)[kt])}t.List=Nt})(this.BX.Socialnetwork.Spaces=this.BX.Socialnetwork.Spaces||{},BX.Vue3,BX.Main,BX.Main,BX.UI.AvatarEditor,BX,BX.Vue3.Vuex,BX,BX.Event,BX);
//# sourceMappingURL=script.map.js