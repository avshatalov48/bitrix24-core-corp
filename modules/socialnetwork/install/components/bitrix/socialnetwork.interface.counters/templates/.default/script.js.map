{"version":3,"file":"script.js","sources":["src/counters-helper.js","src/entry.js"],"sourcesContent":["import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nclass Filter\n{\n\tconstructor(options)\n\t{\n\t\tthis.filterId = options.filterId;\n\t\tthis.filterManager = BX.Main.filterManager.getById(this.filterId);\n\t\tthis.countersManager = options.countersManager;\n\n\t\tsetTimeout(this.updateFields.bind(this), 100);\n\t}\n\n\tupdateFields()\n\t{\n\t\tconst filterManager = this.getFilter();\n\t\tif (!filterManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.presetId = filterManager.getPreset().getCurrentPresetId();\n\t\tthis.fields = filterManager.getFilterFieldsValues();\n\n\t\tthis.countersManager.activateCountersByFilter();\n\t}\n\n\tisFilteredByPresetId(presetId)\n\t{\n\t\treturn (presetId === this.presetId);\n\t}\n\n\tisFilteredByFields(filterFields)\n\t{\n\t\tlet result = false;\n\t\tlet breakNeeded = false;\n\n\t\tObject.entries(filterFields).map(([ field, value]) => {\n\t\t\tif (!breakNeeded && !Type.isUndefined(this.fields[field]))\n\t\t\t{\n\t\t\t\tresult = (this.fields[field] === value);\n\t\t\t\tif (!result)\n\t\t\t\t{\n\t\t\t\t\tbreakNeeded = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetFilter()\n\t{\n\t\treturn this.filterManager;\n\t}\n}\n\nexport {\n\tFilter\n}","import {Loc, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {PULL as Pull} from 'pull.client';\nimport {CounterPanel} from 'ui.counterpanel';\nimport {CounterColor} from 'ui.cnt';\n\nimport {Filter} from './counters-helper';\n\nexport class Counters\n{\n\tstatic updateTimeout = false;\n\tstatic needUpdate = false;\n\n\tstatic timeoutTTL = 5000;\n\n\tconstructor(options)\n\t{\n\t\tthis.userId = options.userId;\n\t\tthis.targetUserId = options.targetUserId;\n\t\tthis.entityType = options.entityType || '';\n\t\tthis.entityId = parseInt(options.entityId || 0);\n\t\tthis.role = options.role;\n\t\tthis.entityTitle = options.entityTitle || '';\n\t\tthis.counters = options.counters;\n\t\tthis.renderTo = options.renderTo;\n\n\t\tthis.signedParameters = options.signedParameters;\n\t\tthis.initialCounter = options.initialCounter || '';\n\n\t\tthis.panel = null;\n\t\tthis.tasksCounter = {};\n\n\t\tthis.bindEvents();\n\t\tthis.setData(this.counters);\n\n\t\tthis.initPull();\n\n\t\tthis.filter = new Filter({\n\t\t\tfilterId: options.filterId,\n\t\t\tcountersManager: this,\n\t\t});\n\t}\n\n\tisWorkgroupList()\n\t{\n\t\treturn false;\n\t}\n\n\tinitPull()\n\t{\n\t\tPull.subscribe({\n\t\t\tmoduleId: 'main',\n\t\t\tcallback: data => this.processPullEvent(data),\n\t\t});\n\n\t\tPull.subscribe({\n\t\t\tmoduleId: 'socialnetwork',\n\t\t\tcallback: data => this.processPullEvent(data),\n\t\t});\n\n\t\tPull.subscribe({\n\t\t\tmoduleId: 'tasks',\n\t\t\tcallback: data => this.processPullEvent(data),\n\t\t});\n\t}\n\n\textendWatch()\n\t{\n\t\tif (this.isWorkgroupList())\n\t\t{\n\t\t\tconst tagId = 'WORKGROUP_LIST';\n\n\t\t\tBX.PULL.extendWatch(tagId, true);\n\t\t\tsetTimeout(() => this.extendWatch(), 29 * 60 * 1000);\n\t\t}\n\t}\n\n\tprocessPullEvent(data)\n\t{\n\t\tconst eventHandlers = {\n\t\t\tuser_counter: this.onUserCounter.bind(this),\n\t\t};\n\t\tconst has = Object.prototype.hasOwnProperty;\n\t\tconst {command, params} = data;\n\t\tif (has.call(eventHandlers, command))\n\t\t{\n\t\t\tconst method = eventHandlers[command];\n\t\t\tif (method)\n\t\t\t{\n\t\t\t\tmethod.apply(this, [params]);\n\t\t\t}\n\t\t}\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t}\n\n\tonFilterApply()\n\t{\n\t\tthis.filter.updateFields();\n\t}\n\n\tactivateCountersByFilter()\n\t{\n\t\tif (!this.panel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.counterItems.forEach((counter) => {\n\t\t\tif (Type.isObject(counter.filterFields))\n\t\t\t{\n\t\t\t\tthis.filter.isFilteredByFields(counter.filterFields)\n\t\t\t\t\t? this.panel.getItemById(counter.type).activate()\n\t\t\t\t\t: this.panel.getItemById(counter.type).deactivate()\n\t\t\t\t;\n\t\t\t}\n\t\t\telse if (Type.isStringFilled(counter.filterPresetId))\n\t\t\t{\n\t\t\t\tthis.filter.isFilteredByPresetId(counter.filterPresetId)\n\t\t\t\t\t? this.panel.getItemById(counter.type).activate()\n\t\t\t\t\t: this.panel.getItemById(counter.type).deactivate()\n\t\t\t\t;\n\t\t\t}\n\t\t});\n\t}\n\n\tonUserCounter(data)\n\t{\n\t\tconst has = Object.prototype.hasOwnProperty;\n\n\t\tif (this.entityType === 'workgroup_detail')\n\t\t{\n\t\t\tif (\n\t\t\t\t!has.call(data, 'workgroupId')\n\t\t\t\t|| !has.call(data, 'values')\n\t\t\t\t|| this.entityId !== parseInt(data.workgroupId)\n\t\t\t\t|| this.userId !== Number(data.userId)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tObject.entries(data.values).forEach(([type, value]) => {\n\t\t\t\tthis.counterItems.forEach((counter) => {\n\t\t\t\t\tif (counter.type === type)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst item = this.panel.getItemById(counter.type);\n\t\t\t\t\t\titem.updateValue(value.all);\n\n\t\t\t\t\t\tlet baseColor = 'GRAY';\n\t\t\t\t\t\tswitch (type)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcase 'workgroup_requests_in':\n\t\t\t\t\t\t\t\tbaseColor = 'WARNING';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'workgroup_requests_out':\n\t\t\t\t\t\t\t\tbaseColor = 'SUCCESS';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titem.updateColor(value.all > 0 ? baseColor : 'GRAY');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t\telse if (this.entityType === 'workgroup_list')\n\t\t{\n\t\t\tif (\n\t\t\t\tType.isPlainObject(data[Loc.getMessage('SITE_ID')])\n\t\t\t\t&& !Type.isUndefined(data[Loc.getMessage('SITE_ID')]['**SG0'])\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.counterItems.forEach((counter) => {\n\t\t\t\t\tif (counter.type === 'workgroup_list_livefeed')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst item = this.panel.getItemById(counter.type);\n\t\t\t\t\t\tconst value = Number(data[Loc.getMessage('SITE_ID')]['**SG0']);\n\t\t\t\t\t\titem.updateValue(value);\n\t\t\t\t\t\titem.updateColor(value > 0 ? 'DANGER' : 'GRAY');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\telse if (\n\t\t\t\t!Type.isUndefined(data.projects_major)\n\t\t\t\t|| !Type.isUndefined(data.scrum_total_comments)\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (!Type.isUndefined(data.projects_major))\n\t\t\t\t{\n\t\t\t\t\tthis.tasksCounter.projects_major = Number(data.projects_major)\n\t\t\t\t}\n\n\t\t\t\tif (!Type.isUndefined(data.scrum_total_comments))\n\t\t\t\t{\n\t\t\t\t\tthis.tasksCounter.scrum_total_comments = Number(data.scrum_total_comments)\n\t\t\t\t}\n\n\t\t\t\tthis.counterItems.forEach((counter) => {\n\t\t\t\t\tif (counter.type === 'workgroup_list_tasks')\n\t\t\t\t\t{\n\t\t\t\t\t\tlet sum = 0;\n\t\t\t\t\t\tObject.entries(this.tasksCounter).map(([key]) => {\n\t\t\t\t\t\t\tsum += this.tasksCounter[key];\n\t\t\t\t\t\t})\n\t\t\t\t\t\tconst item = this.panel.getItemById(counter.type);\n\n\t\t\t\t\t\titem.updateValue(sum);\n\t\t\t\t\t\titem.updateColor(sum > 0 ? 'DANGER' : 'GRAY');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCounterItem(param: Object): Object\n\t{\n\t\tconst counterData = {\n\t\t\ttype: param.type,\n\t\t\tactiveByDefault: (param.type === this.initialCounter),\n\t\t\tfilter: this.filter,\n\t\t};\n\t\tif (Type.isObject(param.filterFields))\n\t\t{\n\t\t\tconst [key, value] = Object.entries(param.filterFields).pop();\n\t\t\tcounterData.filterField = key;\n\t\t\tcounterData.filterValue = value;\n\t\t}\n\t\telse if (Type.isStringFilled(param.filterPresetId))\n\t\t{\n\t\t\tcounterData.filterPresetId = param.filterPresetId;\n\t\t}\n\n\t\treturn {\n\t\t\tid: param.type,\n\t\t\ttitle: param.name,\n\t\t\tvalue: param.count,\n\t\t\tcolor: param.color,\n\t\t\teventsForActive: {\n\t\t\t\tclick: () => {\n\t\t\t\t\tEventEmitter.emit('Socialnetwork.Toolbar:onItem', {\n\t\t\t\t\t\tcounter: counterData,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tmouseenter: () => {},\n\t\t\t\tanyEvent: () => {},\n\t\t\t},\n\t\t\teventsForUnActive: {\n\t\t\t\tclick: () => {\n\t\t\t\t\tEventEmitter.emit('Socialnetwork.Toolbar:onItem', {\n\t\t\t\t\t\tcounter: counterData,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tsetData(counters)\n\t{\n\t\tthis.counterItems = [];\n\n\t\tObject.entries(counters).forEach(([type, data]) => {\n\t\t\tthis.counterItems.push({\n\t\t\t\ttype: type,\n\t\t\t\tname: data.TITLE,\n\t\t\t\tcount: this.getCounterSum(data.VALUE),\n\t\t\t\tcolor: data.STYLE,\n\t\t\t\tfilterPresetId: data.FILTER_PRESET_ID,\n\t\t\t\tfilterFields: data.FILTER_FIELDS,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCounterSum(counterValues)\n\t{\n\t\tlet result = 0;\n\t\tObject.entries(counterValues).map(([, value]) => {\n\n\t\t\tresult += Number(value);\n\t\t});\n\n\t\treturn result;\n\t}\n\n\trender()\n\t{\n\t\tthis.panel = new CounterPanel({\n\t\t\ttarget: this.renderTo,\n\t\t\tmultiselect: true,\n\t\t\titems: this.counterItems.map((item) => this.getCounterItem(item)),\n\t\t});\n\n\t\tthis.panel.init();\n\t}\n}"],"names":["Filter","options","filterId","filterManager","BX","Main","getById","countersManager","setTimeout","updateFields","bind","getFilter","presetId","getPreset","getCurrentPresetId","fields","getFilterFieldsValues","activateCountersByFilter","filterFields","result","breakNeeded","Object","entries","map","field","value","Type","isUndefined","Counters","userId","targetUserId","entityType","entityId","parseInt","role","entityTitle","counters","renderTo","signedParameters","initialCounter","panel","tasksCounter","bindEvents","setData","initPull","filter","Pull","subscribe","moduleId","callback","data","processPullEvent","isWorkgroupList","tagId","PULL","extendWatch","eventHandlers","user_counter","onUserCounter","has","prototype","hasOwnProperty","command","params","call","method","apply","EventEmitter","onFilterApply","counterItems","forEach","counter","isObject","isFilteredByFields","getItemById","type","activate","deactivate","isStringFilled","filterPresetId","isFilteredByPresetId","workgroupId","Number","values","item","updateValue","all","baseColor","updateColor","isPlainObject","Loc","getMessage","projects_major","scrum_total_comments","sum","key","param","counterData","activeByDefault","pop","filterField","filterValue","id","title","name","count","color","eventsForActive","click","emit","mouseenter","anyEvent","eventsForUnActive","push","TITLE","getCounterSum","VALUE","STYLE","FILTER_PRESET_ID","FILTER_FIELDS","counterValues","CounterPanel","target","multiselect","items","getCounterItem","init"],"mappings":"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"}