{"version":3,"file":"script.js","sources":["src/counters-helper.js","src/entry.js"],"sourcesContent":["import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nclass Filter\n{\n\tconstructor(options)\n\t{\n\t\tthis.filterId = options.filterId;\n\t\tthis.filterManager = BX.Main.filterManager.getById(this.filterId);\n\t\tthis.countersManager = options.countersManager;\n\n\t\tsetTimeout(this.updateFields.bind(this), 100);\n\t}\n\n\tupdateFields()\n\t{\n\t\tconst filterManager = this.getFilter();\n\t\tif (!filterManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.presetId = filterManager.getPreset().getCurrentPresetId();\n\t\tthis.fields = filterManager.getFilterFieldsValues();\n\n\t\tthis.countersManager.activateCountersByFilter();\n\t}\n\n\tisFilteredByPresetId(presetId)\n\t{\n\t\treturn (presetId === this.presetId);\n\t}\n\n\tisFilteredByFields(filterFields)\n\t{\n\t\tlet result = false;\n\t\tlet breakNeeded = false;\n\n\t\tObject.entries(filterFields).map(([ field, value]) => {\n\t\t\tif (!breakNeeded && !Type.isUndefined(this.fields[field]))\n\t\t\t{\n\t\t\t\tresult = (this.fields[field] === value);\n\t\t\t\tif (!result)\n\t\t\t\t{\n\t\t\t\t\tbreakNeeded = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetFilter()\n\t{\n\t\treturn this.filterManager;\n\t}\n}\n\nexport {\n\tFilter\n}","import {Loc, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {PULL as Pull} from 'pull.client';\nimport {CounterPanel} from 'ui.counterpanel';\nimport {CounterColor} from 'ui.cnt';\n\nimport {Filter} from './counters-helper';\n\nexport class Counters\n{\n\tstatic updateTimeout = false;\n\tstatic needUpdate = false;\n\n\tstatic timeoutTTL = 5000;\n\n\tconstructor(options)\n\t{\n\t\tthis.userId = options.userId;\n\t\tthis.targetUserId = options.targetUserId;\n\t\tthis.entityType = options.entityType || '';\n\t\tthis.entityId = parseInt(options.entityId || 0);\n\t\tthis.role = options.role;\n\t\tthis.entityTitle = options.entityTitle || '';\n\t\tthis.counters = options.counters;\n\t\tthis.renderTo = options.renderTo;\n\n\t\tthis.signedParameters = options.signedParameters;\n\t\tthis.initialCounter = options.initialCounter || '';\n\n\t\tthis.panel = null;\n\t\tthis.tasksCounter = {};\n\n\t\tthis.bindEvents();\n\t\tthis.setData(this.counters);\n\n\t\tthis.initPull();\n\n\t\tthis.filter = new Filter({\n\t\t\tfilterId: options.filterId,\n\t\t\tcountersManager: this,\n\t\t});\n\t}\n\n\tisWorkgroupList()\n\t{\n\t\treturn false;\n\t}\n\n\tinitPull()\n\t{\n\t\tPull.subscribe({\n\t\t\tmoduleId: 'main',\n\t\t\tcallback: data => this.processPullEvent(data),\n\t\t});\n\n\t\tPull.subscribe({\n\t\t\tmoduleId: 'socialnetwork',\n\t\t\tcallback: data => this.processPullEvent(data),\n\t\t});\n\n\t\tPull.subscribe({\n\t\t\tmoduleId: 'tasks',\n\t\t\tcallback: data => this.processPullEvent(data),\n\t\t});\n\t}\n\n\textendWatch()\n\t{\n\t\tif (this.isWorkgroupList())\n\t\t{\n\t\t\tconst tagId = 'WORKGROUP_LIST';\n\n\t\t\tBX.PULL.extendWatch(tagId, true);\n\t\t\tsetTimeout(() => this.extendWatch(), 29 * 60 * 1000);\n\t\t}\n\t}\n\n\tprocessPullEvent(data)\n\t{\n\t\tconst eventHandlers = {\n\t\t\tuser_counter: this.onUserCounter.bind(this),\n\t\t};\n\t\tconst has = Object.prototype.hasOwnProperty;\n\t\tconst {command, params} = data;\n\t\tif (has.call(eventHandlers, command))\n\t\t{\n\t\t\tconst method = eventHandlers[command];\n\t\t\tif (method)\n\t\t\t{\n\t\t\t\tmethod.apply(this, [params]);\n\t\t\t}\n\t\t}\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t}\n\n\tonFilterApply()\n\t{\n\t\tthis.filter.updateFields();\n\t}\n\n\tactivateCountersByFilter()\n\t{\n\t\tif (!this.panel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.counterItems.forEach((counter) => {\n\t\t\tif (Type.isObject(counter.filterFields))\n\t\t\t{\n\t\t\t\tthis.filter.isFilteredByFields(counter.filterFields)\n\t\t\t\t\t? this.panel.getItemById(counter.type).activate()\n\t\t\t\t\t: this.panel.getItemById(counter.type).deactivate()\n\t\t\t\t;\n\t\t\t}\n\t\t\telse if (Type.isStringFilled(counter.filterPresetId))\n\t\t\t{\n\t\t\t\tthis.filter.isFilteredByPresetId(counter.filterPresetId)\n\t\t\t\t\t? this.panel.getItemById(counter.type).activate()\n\t\t\t\t\t: this.panel.getItemById(counter.type).deactivate()\n\t\t\t\t;\n\t\t\t}\n\t\t});\n\t}\n\n\tonUserCounter(data)\n\t{\n\t\tconst has = Object.prototype.hasOwnProperty;\n\n\t\tif (this.entityType === 'workgroup_detail')\n\t\t{\n\t\t\tif (\n\t\t\t\t!has.call(data, 'workgroupId')\n\t\t\t\t|| !has.call(data, 'values')\n\t\t\t\t|| this.entityId !== parseInt(data.workgroupId)\n\t\t\t\t|| this.userId !== Number(data.userId)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tObject.entries(data.values).forEach(([type, value]) => {\n\t\t\t\tthis.counterItems.forEach((counter) => {\n\t\t\t\t\tif (counter.type === type)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst item = this.panel.getItemById(counter.type);\n\t\t\t\t\t\titem.updateValue(value.all);\n\n\t\t\t\t\t\tlet baseColor = 'GRAY';\n\t\t\t\t\t\tswitch (type)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcase 'workgroup_requests_in':\n\t\t\t\t\t\t\t\tbaseColor = 'DANGER';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'workgroup_requests_out':\n\t\t\t\t\t\t\t\tbaseColor = 'SUCCESS';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titem.updateColor(value.all > 0 ? baseColor : 'GRAY');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t\telse if (this.entityType === 'workgroup_list')\n\t\t{\n\t\t\tif (\n\t\t\t\tType.isPlainObject(data[Loc.getMessage('SITE_ID')])\n\t\t\t\t&& !Type.isUndefined(data[Loc.getMessage('SITE_ID')]['**SG0'])\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.counterItems.forEach((counter) => {\n\t\t\t\t\tif (counter.type === 'workgroup_list_livefeed')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst item = this.panel.getItemById(counter.type);\n\t\t\t\t\t\tconst value = Number(data[Loc.getMessage('SITE_ID')]['**SG0']);\n\t\t\t\t\t\titem.updateValue(value);\n\t\t\t\t\t\titem.updateColor(value > 0 ? 'DANGER' : 'GRAY');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\telse if (\n\t\t\t\t!Type.isUndefined(data.projects_major)\n\t\t\t\t|| !Type.isUndefined(data.scrum_total_comments)\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (!Type.isUndefined(data.projects_major))\n\t\t\t\t{\n\t\t\t\t\tthis.tasksCounter.projects_major = Number(data.projects_major)\n\t\t\t\t}\n\n\t\t\t\tif (!Type.isUndefined(data.scrum_total_comments))\n\t\t\t\t{\n\t\t\t\t\tthis.tasksCounter.scrum_total_comments = Number(data.scrum_total_comments)\n\t\t\t\t}\n\n\t\t\t\tthis.counterItems.forEach((counter) => {\n\t\t\t\t\tif (counter.type === 'workgroup_list_tasks')\n\t\t\t\t\t{\n\t\t\t\t\t\tlet sum = 0;\n\t\t\t\t\t\tObject.entries(this.tasksCounter).map(([key]) => {\n\t\t\t\t\t\t\tsum += this.tasksCounter[key];\n\t\t\t\t\t\t})\n\t\t\t\t\t\tconst item = this.panel.getItemById(counter.type);\n\n\t\t\t\t\t\titem.updateValue(sum);\n\t\t\t\t\t\titem.updateColor(sum > 0 ? 'DANGER' : 'GRAY');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCounterItem(param: Object): Object\n\t{\n\t\tconst counterData = {\n\t\t\ttype: param.type,\n\t\t\tactiveByDefault: (param.type === this.initialCounter),\n\t\t\tfilter: this.filter,\n\t\t};\n\t\tif (Type.isObject(param.filterFields))\n\t\t{\n\t\t\tconst [key, value] = Object.entries(param.filterFields).pop();\n\t\t\tcounterData.filterField = key;\n\t\t\tcounterData.filterValue = value;\n\t\t}\n\t\telse if (Type.isStringFilled(param.filterPresetId))\n\t\t{\n\t\t\tcounterData.filterPresetId = param.filterPresetId;\n\t\t}\n\n\t\treturn {\n\t\t\tid: param.type,\n\t\t\ttitle: param.name,\n\t\t\tvalue: param.count,\n\t\t\tcolor: param.color,\n\t\t\teventsForActive: {\n\t\t\t\tclick: () => {\n\t\t\t\t\tEventEmitter.emit('Socialnetwork.Toolbar:onItem', {\n\t\t\t\t\t\tcounter: counterData,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tmouseenter: () => {},\n\t\t\t\tanyEvent: () => {},\n\t\t\t},\n\t\t\teventsForUnActive: {\n\t\t\t\tclick: () => {\n\t\t\t\t\tEventEmitter.emit('Socialnetwork.Toolbar:onItem', {\n\t\t\t\t\t\tcounter: counterData,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tsetData(counters)\n\t{\n\t\tthis.counterItems = [];\n\n\t\tObject.entries(counters).forEach(([type, data]) => {\n\t\t\tthis.counterItems.push({\n\t\t\t\ttype: type,\n\t\t\t\tname: data.TITLE,\n\t\t\t\tcount: this.getCounterSum(data.VALUE),\n\t\t\t\tcolor: data.STYLE,\n\t\t\t\tfilterPresetId: data.FILTER_PRESET_ID,\n\t\t\t\tfilterFields: data.FILTER_FIELDS,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCounterSum(counterValues)\n\t{\n\t\tlet result = 0;\n\t\tObject.entries(counterValues).map(([, value]) => {\n\n\t\t\tresult += Number(value);\n\t\t});\n\n\t\treturn result;\n\t}\n\n\trender()\n\t{\n\t\tthis.panel = new CounterPanel({\n\t\t\ttarget: this.renderTo,\n\t\t\tmultiselect: true,\n\t\t\titems: this.counterItems.map((item) => this.getCounterItem(item)),\n\t\t});\n\n\t\tthis.panel.init();\n\t}\n}"],"names":["Filter","options","filterId","filterManager","BX","Main","getById","countersManager","setTimeout","updateFields","bind","getFilter","presetId","getPreset","getCurrentPresetId","fields","getFilterFieldsValues","activateCountersByFilter","filterFields","result","breakNeeded","Object","entries","map","field","value","Type","isUndefined","Counters","userId","targetUserId","entityType","entityId","parseInt","role","entityTitle","counters","renderTo","signedParameters","initialCounter","panel","tasksCounter","bindEvents","setData","initPull","filter","Pull","subscribe","moduleId","callback","data","processPullEvent","isWorkgroupList","tagId","PULL","extendWatch","eventHandlers","user_counter","onUserCounter","has","prototype","hasOwnProperty","command","params","call","method","apply","EventEmitter","onFilterApply","counterItems","forEach","counter","isObject","isFilteredByFields","getItemById","type","activate","deactivate","isStringFilled","filterPresetId","isFilteredByPresetId","workgroupId","Number","values","item","updateValue","all","baseColor","updateColor","isPlainObject","Loc","getMessage","projects_major","scrum_total_comments","sum","key","param","counterData","activeByDefault","pop","filterField","filterValue","id","title","name","count","color","eventsForActive","click","emit","mouseenter","anyEvent","eventsForUnActive","push","TITLE","getCounterSum","VALUE","STYLE","FILTER_PRESET_ID","FILTER_FIELDS","counterValues","CounterPanel","target","multiselect","items","getCounterItem","init"],"mappings":";;;;;CAC8C,IAExCA,MAAM;GAEX,gBAAYC,OAAO,EACnB;KAAA;KACC,IAAI,CAACC,QAAQ,GAAGD,OAAO,CAACC,QAAQ;KAChC,IAAI,CAACC,aAAa,GAAGC,EAAE,CAACC,IAAI,CAACF,aAAa,CAACG,OAAO,CAAC,IAAI,CAACJ,QAAQ,CAAC;KACjE,IAAI,CAACK,eAAe,GAAGN,OAAO,CAACM,eAAe;KAE9CC,UAAU,CAAC,IAAI,CAACC,YAAY,CAACC,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC;;GAC7C;KAAA;KAAA,+BAGD;OACC,IAAMP,aAAa,GAAG,IAAI,CAACQ,SAAS,EAAE;OACtC,IAAI,CAACR,aAAa,EAClB;SACC;;OAGD,IAAI,CAACS,QAAQ,GAAGT,aAAa,CAACU,SAAS,EAAE,CAACC,kBAAkB,EAAE;OAC9D,IAAI,CAACC,MAAM,GAAGZ,aAAa,CAACa,qBAAqB,EAAE;OAEnD,IAAI,CAACT,eAAe,CAACU,wBAAwB,EAAE;;;KAC/C;KAAA,qCAEoBL,QAAQ,EAC7B;OACC,OAAQA,QAAQ,KAAK,IAAI,CAACA,QAAQ;;;KAClC;KAAA,mCAEkBM,YAAY,EAC/B;OAAA;OACC,IAAIC,MAAM,GAAG,KAAK;OAClB,IAAIC,WAAW,GAAG,KAAK;OAEvBC,MAAM,CAACC,OAAO,CAACJ,YAAY,CAAC,CAACK,GAAG,CAAC,gBAAqB;SAAA;WAAlBC,KAAK;WAAEC,KAAK;SAC/C,IAAI,CAACL,WAAW,IAAI,CAACM,cAAI,CAACC,WAAW,CAAC,KAAI,CAACZ,MAAM,CAACS,KAAK,CAAC,CAAC,EACzD;WACCL,MAAM,GAAI,KAAI,CAACJ,MAAM,CAACS,KAAK,CAAC,KAAKC,KAAM;WACvC,IAAI,CAACN,MAAM,EACX;aACCC,WAAW,GAAG,IAAI;;;QAGpB,CAAC;OAEF,OAAOD,MAAM;;;KACb;KAAA,4BAGD;OACC,OAAO,IAAI,CAAChB,aAAa;;;GACzB;CAAA;;KC/CWyB,QAAQ;GAOpB,kBAAY3B,OAAO,EACnB;KAAA;KACC,IAAI,CAAC4B,MAAM,GAAG5B,OAAO,CAAC4B,MAAM;KAC5B,IAAI,CAACC,YAAY,GAAG7B,OAAO,CAAC6B,YAAY;KACxC,IAAI,CAACC,UAAU,GAAG9B,OAAO,CAAC8B,UAAU,IAAI,EAAE;KAC1C,IAAI,CAACC,QAAQ,GAAGC,QAAQ,CAAChC,OAAO,CAAC+B,QAAQ,IAAI,CAAC,CAAC;KAC/C,IAAI,CAACE,IAAI,GAAGjC,OAAO,CAACiC,IAAI;KACxB,IAAI,CAACC,WAAW,GAAGlC,OAAO,CAACkC,WAAW,IAAI,EAAE;KAC5C,IAAI,CAACC,QAAQ,GAAGnC,OAAO,CAACmC,QAAQ;KAChC,IAAI,CAACC,QAAQ,GAAGpC,OAAO,CAACoC,QAAQ;KAEhC,IAAI,CAACC,gBAAgB,GAAGrC,OAAO,CAACqC,gBAAgB;KAChD,IAAI,CAACC,cAAc,GAAGtC,OAAO,CAACsC,cAAc,IAAI,EAAE;KAElD,IAAI,CAACC,KAAK,GAAG,IAAI;KACjB,IAAI,CAACC,YAAY,GAAG,EAAE;KAEtB,IAAI,CAACC,UAAU,EAAE;KACjB,IAAI,CAACC,OAAO,CAAC,IAAI,CAACP,QAAQ,CAAC;KAE3B,IAAI,CAACQ,QAAQ,EAAE;KAEf,IAAI,CAACC,MAAM,GAAG,IAAI7C,MAAM,CAAC;OACxBE,QAAQ,EAAED,OAAO,CAACC,QAAQ;OAC1BK,eAAe,EAAE;MACjB,CAAC;;GACF;KAAA;KAAA,kCAGD;OACC,OAAO,KAAK;;;KACZ;KAAA,2BAGD;OAAA;OACCuC,gBAAI,CAACC,SAAS,CAAC;SACdC,QAAQ,EAAE,MAAM;SAChBC,QAAQ,EAAE,kBAAAC,IAAI;WAAA,OAAI,KAAI,CAACC,gBAAgB,CAACD,IAAI,CAAC;;QAC7C,CAAC;OAEFJ,gBAAI,CAACC,SAAS,CAAC;SACdC,QAAQ,EAAE,eAAe;SACzBC,QAAQ,EAAE,kBAAAC,IAAI;WAAA,OAAI,KAAI,CAACC,gBAAgB,CAACD,IAAI,CAAC;;QAC7C,CAAC;OAEFJ,gBAAI,CAACC,SAAS,CAAC;SACdC,QAAQ,EAAE,OAAO;SACjBC,QAAQ,EAAE,kBAAAC,IAAI;WAAA,OAAI,KAAI,CAACC,gBAAgB,CAACD,IAAI,CAAC;;QAC7C,CAAC;;;KACF;KAAA,8BAGD;OAAA;OACC,IAAI,IAAI,CAACE,eAAe,EAAE,EAC1B;SACC,IAAMC,KAAK,GAAG,gBAAgB;SAE9BjD,EAAE,CAACkD,IAAI,CAACC,WAAW,CAACF,KAAK,EAAE,IAAI,CAAC;SAChC7C,UAAU,CAAC;WAAA,OAAM,MAAI,CAAC+C,WAAW,EAAE;YAAE,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;;;;KAErD;KAAA,iCAEgBL,IAAI,EACrB;OACC,IAAMM,aAAa,GAAG;SACrBC,YAAY,EAAE,IAAI,CAACC,aAAa,CAAChD,IAAI,CAAC,IAAI;QAC1C;OACD,IAAMiD,GAAG,GAAGtC,MAAM,CAACuC,SAAS,CAACC,cAAc;OAC3C,IAAOC,OAAO,GAAYZ,IAAI,CAAvBY,OAAO;SAAEC,MAAM,GAAIb,IAAI,CAAda,MAAM;OACtB,IAAIJ,GAAG,CAACK,IAAI,CAACR,aAAa,EAAEM,OAAO,CAAC,EACpC;SACC,IAAMG,MAAM,GAAGT,aAAa,CAACM,OAAO,CAAC;SACrC,IAAIG,MAAM,EACV;WACCA,MAAM,CAACC,KAAK,CAAC,IAAI,EAAE,CAACH,MAAM,CAAC,CAAC;;;;;KAG9B;KAAA,6BAGD;OACCI,6BAAY,CAACpB,SAAS,CAAC,sBAAsB,EAAE,IAAI,CAACqB,aAAa,CAAC1D,IAAI,CAAC,IAAI,CAAC,CAAC;;;KAC7E;KAAA,gCAGD;OACC,IAAI,CAACmC,MAAM,CAACpC,YAAY,EAAE;;;KAC1B;KAAA,2CAGD;OAAA;OACC,IAAI,CAAC,IAAI,CAAC+B,KAAK,EACf;SACC;;OAGD,IAAI,CAAC6B,YAAY,CAACC,OAAO,CAAC,UAACC,OAAO,EAAK;SACtC,IAAI7C,cAAI,CAAC8C,QAAQ,CAACD,OAAO,CAACrD,YAAY,CAAC,EACvC;WACC,MAAI,CAAC2B,MAAM,CAAC4B,kBAAkB,CAACF,OAAO,CAACrD,YAAY,CAAC,GACjD,MAAI,CAACsB,KAAK,CAACkC,WAAW,CAACH,OAAO,CAACI,IAAI,CAAC,CAACC,QAAQ,EAAE,GAC/C,MAAI,CAACpC,KAAK,CAACkC,WAAW,CAACH,OAAO,CAACI,IAAI,CAAC,CAACE,UAAU,EAAE;UAEpD,MACI,IAAInD,cAAI,CAACoD,cAAc,CAACP,OAAO,CAACQ,cAAc,CAAC,EACpD;WACC,MAAI,CAAClC,MAAM,CAACmC,oBAAoB,CAACT,OAAO,CAACQ,cAAc,CAAC,GACrD,MAAI,CAACvC,KAAK,CAACkC,WAAW,CAACH,OAAO,CAACI,IAAI,CAAC,CAACC,QAAQ,EAAE,GAC/C,MAAI,CAACpC,KAAK,CAACkC,WAAW,CAACH,OAAO,CAACI,IAAI,CAAC,CAACE,UAAU,EAAE;;QAGrD,CAAC;;;KACF;KAAA,8BAEa3B,IAAI,EAClB;OAAA;OACC,IAAMS,GAAG,GAAGtC,MAAM,CAACuC,SAAS,CAACC,cAAc;OAE3C,IAAI,IAAI,CAAC9B,UAAU,KAAK,kBAAkB,EAC1C;SACC,IACC,CAAC4B,GAAG,CAACK,IAAI,CAACd,IAAI,EAAE,aAAa,CAAC,IAC3B,CAACS,GAAG,CAACK,IAAI,CAACd,IAAI,EAAE,QAAQ,CAAC,IACzB,IAAI,CAAClB,QAAQ,KAAKC,QAAQ,CAACiB,IAAI,CAAC+B,WAAW,CAAC,IAC5C,IAAI,CAACpD,MAAM,KAAKqD,MAAM,CAAChC,IAAI,CAACrB,MAAM,CAAC,EAEvC;WACC;;SAGDR,MAAM,CAACC,OAAO,CAAC4B,IAAI,CAACiC,MAAM,CAAC,CAACb,OAAO,CAAC,gBAAmB;WAAA;aAAjBK,IAAI;aAAElD,KAAK;WAChD,MAAI,CAAC4C,YAAY,CAACC,OAAO,CAAC,UAACC,OAAO,EAAK;aACtC,IAAIA,OAAO,CAACI,IAAI,KAAKA,IAAI,EACzB;eACC,IAAMS,IAAI,GAAG,MAAI,CAAC5C,KAAK,CAACkC,WAAW,CAACH,OAAO,CAACI,IAAI,CAAC;eACjDS,IAAI,CAACC,WAAW,CAAC5D,KAAK,CAAC6D,GAAG,CAAC;eAE3B,IAAIC,SAAS,GAAG,MAAM;eACtB,QAAQZ,IAAI;iBAEX,KAAK,uBAAuB;mBAC3BY,SAAS,GAAG,QAAQ;mBACpB;iBACD,KAAK,wBAAwB;mBAC5BA,SAAS,GAAG,SAAS;mBACrB;;eAGFH,IAAI,CAACI,WAAW,CAAC/D,KAAK,CAAC6D,GAAG,GAAG,CAAC,GAAGC,SAAS,GAAG,MAAM,CAAC;;YAErD,CAAC;UACF,CAAC;QACF,MACI,IAAI,IAAI,CAACxD,UAAU,KAAK,gBAAgB,EAC7C;SACC,IACCL,cAAI,CAAC+D,aAAa,CAACvC,IAAI,CAACwC,aAAG,CAACC,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,IAChD,CAACjE,cAAI,CAACC,WAAW,CAACuB,IAAI,CAACwC,aAAG,CAACC,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,EAE/D;WACC,IAAI,CAACtB,YAAY,CAACC,OAAO,CAAC,UAACC,OAAO,EAAK;aACtC,IAAIA,OAAO,CAACI,IAAI,KAAK,yBAAyB,EAC9C;eACC,IAAMS,IAAI,GAAG,MAAI,CAAC5C,KAAK,CAACkC,WAAW,CAACH,OAAO,CAACI,IAAI,CAAC;eACjD,IAAMlD,KAAK,GAAGyD,MAAM,CAAChC,IAAI,CAACwC,aAAG,CAACC,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;eAC9DP,IAAI,CAACC,WAAW,CAAC5D,KAAK,CAAC;eACvB2D,IAAI,CAACI,WAAW,CAAC/D,KAAK,GAAG,CAAC,GAAG,QAAQ,GAAG,MAAM,CAAC;;YAEhD,CAAC;UACF,MACI,IACJ,CAACC,cAAI,CAACC,WAAW,CAACuB,IAAI,CAAC0C,cAAc,CAAC,IACnC,CAAClE,cAAI,CAACC,WAAW,CAACuB,IAAI,CAAC2C,oBAAoB,CAAC,EAEhD;WACC,IAAI,CAACnE,cAAI,CAACC,WAAW,CAACuB,IAAI,CAAC0C,cAAc,CAAC,EAC1C;aACC,IAAI,CAACnD,YAAY,CAACmD,cAAc,GAAGV,MAAM,CAAChC,IAAI,CAAC0C,cAAc,CAAC;;WAG/D,IAAI,CAAClE,cAAI,CAACC,WAAW,CAACuB,IAAI,CAAC2C,oBAAoB,CAAC,EAChD;aACC,IAAI,CAACpD,YAAY,CAACoD,oBAAoB,GAAGX,MAAM,CAAChC,IAAI,CAAC2C,oBAAoB,CAAC;;WAG3E,IAAI,CAACxB,YAAY,CAACC,OAAO,CAAC,UAACC,OAAO,EAAK;aACtC,IAAIA,OAAO,CAACI,IAAI,KAAK,sBAAsB,EAC3C;eACC,IAAImB,GAAG,GAAG,CAAC;eACXzE,MAAM,CAACC,OAAO,CAAC,MAAI,CAACmB,YAAY,CAAC,CAAClB,GAAG,CAAC,iBAAW;iBAAA;mBAATwE,GAAG;iBAC1CD,GAAG,IAAI,MAAI,CAACrD,YAAY,CAACsD,GAAG,CAAC;gBAC7B,CAAC;eACF,IAAMX,IAAI,GAAG,MAAI,CAAC5C,KAAK,CAACkC,WAAW,CAACH,OAAO,CAACI,IAAI,CAAC;eAEjDS,IAAI,CAACC,WAAW,CAACS,GAAG,CAAC;eACrBV,IAAI,CAACI,WAAW,CAACM,GAAG,GAAG,CAAC,GAAG,QAAQ,GAAG,MAAM,CAAC;;YAE9C,CAAC;;;;;KAGJ;KAAA,+BAEcE,KAAa,EAC5B;OACC,IAAMC,WAAW,GAAG;SACnBtB,IAAI,EAAEqB,KAAK,CAACrB,IAAI;SAChBuB,eAAe,EAAGF,KAAK,CAACrB,IAAI,KAAK,IAAI,CAACpC,cAAe;SACrDM,MAAM,EAAE,IAAI,CAACA;QACb;OACD,IAAInB,cAAI,CAAC8C,QAAQ,CAACwB,KAAK,CAAC9E,YAAY,CAAC,EACrC;SACC,0BAAqBG,MAAM,CAACC,OAAO,CAAC0E,KAAK,CAAC9E,YAAY,CAAC,CAACiF,GAAG,EAAE;WAAA;WAAtDJ,GAAG;WAAEtE,KAAK;SACjBwE,WAAW,CAACG,WAAW,GAAGL,GAAG;SAC7BE,WAAW,CAACI,WAAW,GAAG5E,KAAK;QAC/B,MACI,IAAIC,cAAI,CAACoD,cAAc,CAACkB,KAAK,CAACjB,cAAc,CAAC,EAClD;SACCkB,WAAW,CAAClB,cAAc,GAAGiB,KAAK,CAACjB,cAAc;;OAGlD,OAAO;SACNuB,EAAE,EAAEN,KAAK,CAACrB,IAAI;SACd4B,KAAK,EAAEP,KAAK,CAACQ,IAAI;SACjB/E,KAAK,EAAEuE,KAAK,CAACS,KAAK;SAClBC,KAAK,EAAEV,KAAK,CAACU,KAAK;SAClBC,eAAe,EAAE;WAChBC,KAAK,EAAE,iBAAM;aACZzC,6BAAY,CAAC0C,IAAI,CAAC,8BAA8B,EAAE;eACjDtC,OAAO,EAAE0B;cACT,CAAC;YACF;WACDa,UAAU,EAAE,sBAAM,EAAE;WACpBC,QAAQ,EAAE,oBAAM;UAChB;SACDC,iBAAiB,EAAE;WAClBJ,KAAK,EAAE,iBAAM;aACZzC,6BAAY,CAAC0C,IAAI,CAAC,8BAA8B,EAAE;eACjDtC,OAAO,EAAE0B;cACT,CAAC;;;QAGJ;;;KACD;KAAA,wBAEO7D,QAAQ,EAChB;OAAA;OACC,IAAI,CAACiC,YAAY,GAAG,EAAE;OAEtBhD,MAAM,CAACC,OAAO,CAACc,QAAQ,CAAC,CAACkC,OAAO,CAAC,iBAAkB;SAAA;WAAhBK,IAAI;WAAEzB,IAAI;SAC5C,MAAI,CAACmB,YAAY,CAAC4C,IAAI,CAAC;WACtBtC,IAAI,EAAEA,IAAI;WACV6B,IAAI,EAAEtD,IAAI,CAACgE,KAAK;WAChBT,KAAK,EAAE,MAAI,CAACU,aAAa,CAACjE,IAAI,CAACkE,KAAK,CAAC;WACrCV,KAAK,EAAExD,IAAI,CAACmE,KAAK;WACjBtC,cAAc,EAAE7B,IAAI,CAACoE,gBAAgB;WACrCpG,YAAY,EAAEgC,IAAI,CAACqE;UACnB,CAAC;QACF,CAAC;;;KACF;KAAA,8BAEaC,aAAa,EAC3B;OACC,IAAIrG,MAAM,GAAG,CAAC;OACdE,MAAM,CAACC,OAAO,CAACkG,aAAa,CAAC,CAACjG,GAAG,CAAC,iBAAe;SAAA;WAAXE,KAAK;SAE1CN,MAAM,IAAI+D,MAAM,CAACzD,KAAK,CAAC;QACvB,CAAC;OAEF,OAAON,MAAM;;;KACb;KAAA,yBAGD;OAAA;OACC,IAAI,CAACqB,KAAK,GAAG,IAAIiF,4BAAY,CAAC;SAC7BC,MAAM,EAAE,IAAI,CAACrF,QAAQ;SACrBsF,WAAW,EAAE,IAAI;SACjBC,KAAK,EAAE,IAAI,CAACvD,YAAY,CAAC9C,GAAG,CAAC,UAAC6D,IAAI;WAAA,OAAK,MAAI,CAACyC,cAAc,CAACzC,IAAI,CAAC;;QAChE,CAAC;OAEF,IAAI,CAAC5C,KAAK,CAACsF,IAAI,EAAE;;;GACjB;CAAA;CACD,4BAhSYlG,QAAQ,mBAEG,KAAK;CAAA,4BAFhBA,QAAQ,gBAGA,KAAK;CAAA,4BAHbA,QAAQ,gBAKA,IAAI;;;;;;;;"}