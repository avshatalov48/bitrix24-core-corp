{"version":3,"file":"script.js","sources":["src/toolbar.js","src/actionmanager.js","src/manager.js"],"sourcesContent":["import {Type} from 'main.core';\nimport {Popup, MenuManager} from 'main.popup';\n\nexport default class Toolbar\n{\n\tconstructor(\n\t\tparams: {\n\t\t\tid: string,\n\t\t\tmenuButtonId: string,\n\t\t\tmenuItems: object,\n\t\t}\n\t)\n\t{\n\t\tthis.id = params.id;\n\t\tthis.menuItems = params.menuItems;\n\t\tthis.componentName = params.componentName;\n\n\t\tif (Type.isStringFilled(params.menuButtonId))\n\t\t{\n\t\t\tconst menuButton = document.getElementById(params.menuButtonId);\n\t\t\tif (menuButton)\n\t\t\t{\n\t\t\t\tmenuButton.addEventListener('click', (e) => {\n\t\t\t\t\tthis.menuButtonClick(e.currentTarget);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tgetId()\n\t{\n\t\treturn this._id;\n\t}\n\n\tgetSetting(name, defaultval)\n\t{\n\t\treturn this._settings.getParam(name, defaultval);\n\t}\n\n\n\tmenuButtonClick(bindNode)\n\t{\n\t\tthis.openMenu(bindNode);\n\t}\n\n\topenMenu(bindNode)\n\t{\n\t\tif (this.menuOpened)\n\t\t{\n\t\t\tthis.closeMenu();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isArray(this.menuItems))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuItems = [];\n\n\t\tthis.menuItems.forEach((item) =>\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isUndefined(item.SEPARATOR)\n\t\t\t\t&& item.SEPARATOR\n\t\t\t)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\tSEPARATOR: true,\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!Type.isStringFilled(item.TYPE))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmenuItems.push({\n\t\t\t\ttext: (Type.isStringFilled(item.TITLE) ? item.TITLE : ''),\n\t\t\t\tonclick: (Type.isStringFilled(item.LINK) ? `window.location.href = \"${item.LINK}\"; return false;` : ''),\n\t\t\t});\n\t\t});\n\n\n\t\tthis.menuId = `${this.id.toLowerCase()}_menu`;\n\n\t\tPopup.show(\n\t\t\tthis.menuId,\n\t\t\tbindNode,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: this.onPopupShow.bind(this),\n\t\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t\t\tonPopupDestroy: this.onPopupDestroy.bind(this),\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.menuPopup = MenuManager.currentItem;\n\t}\n\n\tcloseMenu()\n\t{\n\t\tif (\n\t\t\t!this.menuPopup\n\t\t\t|| !this.menuPopup.popupWindow\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.menuPopup.popupWindow.destroy();\n\t}\n\n\tonPopupShow()\n\t{\n\t\tthis.menuOpened = true;\n\t}\n\n\tonPopupClose()\n\t{\n\t\tthis.closeMenu();\n\t}\n\n\tonPopupDestroy()\n\t{\n\t\tthis.menuOpened = false;\n\t\tthis.menuPopup = null;\n\n\t\tif (!Type.isUndefined(MenuManager.Data[this.menuId]))\n\t\t{\n\t\t\tdelete(MenuManager.Data[this.menuId]);\n\t\t}\n\t}\n}\n","import {ajax, Type} from 'main.core';\n\nexport default class ActionManager\n{\n\tconstructor(\n\t\tparams: {\n\t\t\tcomponentName: string,\n\t\t\tsignedParameters: string,\n\t\t\tgridId: string,\n\t\t}\n\t)\n\t{\n\t\tthis.componentName = params.componentName;\n\t\tthis.signedParameters = params.signedParameters;\n\t\tthis.gridId = params.gridId;\n\t}\n\n\tviewProfile(params)\n\t{\n\t\tconst userId = parseInt(!Type.isUndefined(params.userId) ? params.userId : 0);\n\t\tconst pathToUser = (Type.isStringFilled(params.pathToUser) ? params.pathToUser : '');\n\n\t\tif (\n\t\t\tuserId <= 0\n\t\t\t|| !Type.isStringFilled(pathToUser)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.SidePanel.Instance.open(\n\t\t\tpathToUser.replace('#ID#', userId)\n\t\t\t\t.replace('#USER_ID#', userId)\n\t\t\t\t.replace('#user_id#', userId),\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tallowChangeHistory: true,\n\t\t\t\tcontentClassName: 'bitrix24-profile-slider-content',\n\t\t\t\tloader: 'intranet:profile',\n\t\t\t\twidth: 1100,\n\t\t\t}\n\t\t);\n\t}\n\n\tact(action, userId)\n\t{\n\t\tajax.runComponentAction(this.componentName, 'act', {\n\t\t\tmode: 'class',\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tdata: {\n\t\t\t\taction: action,\n\t\t\t\tfields: {\n\t\t\t\t\tuserId: userId,\n\t\t\t\t},\n\t\t\t},\n\t\t}).then((response) => {\n\t\t\tif (response.data.success)\n\t\t\t{\n\t\t\t\tBX.Main.gridManager.reload(this.gridId);\n\t\t\t}\n\t\t});\n\t}\n\n\tdisconnectDepartment(params)\n\t{\n\t\tconst id = parseInt(!Type.isUndefined(params.id) ? params.id : 0);\n\n\t\tif (id <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tajax.runComponentAction(this.componentName, 'disconnectDepartment', {\n\t\t\tmode: 'class',\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tdata: {\n\t\t\t\tfields: {\n\t\t\t\t\tid: id,\n\t\t\t\t},\n\t\t\t},\n\t\t}).then((response) => {\n\t\t\tif (response.data.success)\n\t\t\t{\n\t\t\t\tBX.Main.gridManager.reload(this.gridId);\n\t\t\t}\n\t\t});\n\t}\n}\n","import {Type} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport Toolbar from './toolbar';\nimport ActionManager from './actionmanager';\n\nexport default class Manager\n{\n\tstatic repo = new Map();\n\n\tstatic getById(id)\n\t{\n\t\treturn Manager.repo.get(id);\n\t}\n\n\tconstructor(\n\t\tparams: {\n\t\t\tid: string,\n\t\t\tgridId: string,\n\t\t\tfilterId: string,\n\t\t\tgridContainerId: string,\n\t\t\tcomponentName: string,\n\t\t\tsignedParameters: string,\n\t\t\ttoolbar: {\n\t\t\t\tid: string,\n\t\t\t\tmenuButtonId: string,\n\t\t\t\tmenuItems: object,\n\t\t\t},\n\t\t}\n\t)\n\t{\n\t\tthis.componentName = params.componentName;\n\t\tthis.signedParameters = params.signedParameters;\n\t\tthis.gridId = params.gridId;\n\t\tthis.filterId = (Type.isStringFilled(params.filterId) ? params.filterId : null);\n\t\tthis.gridContainer = (Type.isStringFilled(params.gridContainerId) ? document.getElementById(params.gridContainerId) : null);\n\n\t\tparams.toolbar.componentName = this.componentName;\n\t\tthis.toolbarInstance = new Toolbar(params.toolbar);\n\t\tthis.actionManagerInstance = new ActionManager({\n\t\t\tcomponentName: this.componentName,\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tgridId: this.gridId,\n\t\t});\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', (event: BaseEvent) => {\n\n\t\t\tconst [ sliderEvent ] = event.getCompatData();\n\n\t\t\tif (\n\t\t\t\tsliderEvent.getEventId() === 'sonetGroupEvent'\n\t\t\t\t&& !Type.isUndefined(sliderEvent.data)\n\t\t\t\t&& Type.isStringFilled(sliderEvent.data.code)\n\t\t\t\t&& sliderEvent.data.code === 'afterInvite'\n\t\t\t)\n\t\t\t{\n\t\t\t\tBX.Main.gridManager.reload(this.gridId);\n\t\t\t}\n\t\t});\n\n\t\tManager.repo.set(this.id, this);\n\t}\n\n\tgetActionManager()\n\t{\n\t\treturn this.actionManagerInstance;\n\t}\n\n}\n"],"names":["Toolbar","params","id","menuItems","componentName","Type","isStringFilled","menuButtonId","menuButton","document","getElementById","addEventListener","e","menuButtonClick","currentTarget","_id","name","defaultval","_settings","getParam","bindNode","openMenu","menuOpened","closeMenu","isArray","forEach","item","isUndefined","SEPARATOR","push","TYPE","text","TITLE","onclick","LINK","menuId","toLowerCase","Popup","show","autoHide","closeByEsc","offsetTop","offsetLeft","events","onPopupShow","bind","onPopupClose","onPopupDestroy","menuPopup","MenuManager","currentItem","popupWindow","destroy","Data","ActionManager","signedParameters","gridId","userId","parseInt","pathToUser","BX","SidePanel","Instance","open","replace","cacheable","allowChangeHistory","contentClassName","loader","width","action","ajax","runComponentAction","mode","data","fields","then","response","success","Main","gridManager","reload","Manager","repo","get","filterId","gridContainer","gridContainerId","toolbar","toolbarInstance","actionManagerInstance","EventEmitter","subscribe","event","getCompatData","sliderEvent","getEventId","code","set","Map"],"mappings":"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"}