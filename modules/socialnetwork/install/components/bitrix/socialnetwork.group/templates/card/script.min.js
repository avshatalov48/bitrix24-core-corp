(function(){if(typeof SonetGroupCardSlider!="undefined"){return}SonetGroupCardSlider=function(){this.instance=null;this.currentUserId=null;this.userRole=null;this.canInitiate=null;this.canModify=null;this.groupId=null;this.isProject=null;this.waitPopup=null;this.waitTimeout=null;this.notifyHintPopup=null;this.notifyHintTimeout=null;this.notifyHintTime=3e3;this.favoritesValue=null;this.styles=null;this.urls=null;this.containerNodeId=null;this.subscribeButtonNodeId=null;this.menuButtonNodeId=null;this.editFeaturesAllowed=true};SonetGroupCardSlider.getInstance=function(){if(SonetGroupCardSlider.instance==null){SonetGroupCardSlider.instance=new SonetGroupCardSlider}return SonetGroupCardSlider.instance};SonetGroupCardSlider.prototype={init:function(e){if(typeof e=="undefined"||typeof e.groupId=="undefined"||parseInt(e.groupId)<=0){return}this.currentUserId=parseInt(e.currentUserId);this.groupId=parseInt(e.groupId);this.groupType=e.groupType;this.isProject=!!e.isProject;this.isOpened=!!e.isOpened;this.favoritesValue=!!e.favoritesValue;this.canInitiate=!!e.canInitiate;this.canProcessRequestsIn=!!e.canProcessRequestsIn;this.canModify=!!e.canModify;this.userRole=e.userRole;this.userIsMember=!!e.userIsMember;this.userIsAutoMember=!!e.userIsAutoMember;this.containerNodeId=BX.type.isNotEmptyString(e.containerNodeId)?e.containerNodeId:null;this.subscribeButtonNodeId=BX.type.isNotEmptyString(e.subscribeButtonNodeId)?e.subscribeButtonNodeId:null;this.menuButtonNodeId=BX.type.isNotEmptyString(e.menuButtonNodeId)?e.menuButtonNodeId:null;this.editFeaturesAllowed=typeof e.editFeaturesAllowed!="undefined"?!!e.editFeaturesAllowed:true;if(this.containerNodeId&&BX(this.containerNodeId)&&typeof e.styles!="undefined"){this.styles=e.styles;var t=null;if(typeof e.styles.tags!="undefined"&&BX.type.isNotEmptyString(e.styles.tags.box)&&BX.type.isNotEmptyString(e.styles.tags.item)){var s=BX.findChildren(BX(this.containerNodeId),{className:e.styles.tags.box},true);for(t=0,length=s.length;t<length;t++){BX(s[t]).addEventListener("click",BX.delegate(function(e){var t=BX.getEventTarget(e).getAttribute("bx-tag-value");if(BX.type.isNotEmptyString(t)){this.clickTag(t)}e.preventDefault()},this),true)}}if(typeof e.styles.users!="undefined"&&BX.type.isNotEmptyString(e.styles.users.box)&&BX.type.isNotEmptyString(e.styles.users.item)){var i=BX.findChildren(BX(this.containerNodeId),{className:e.styles.users.box},true);for(t=0,length=i.length;t<length;t++){BX(i[t]).addEventListener("click",BX.delegate(function(e){var t=BX.getEventTarget(e).getAttribute("bx-user-id");if(parseInt(t)>0){this.clickUser(t)}e.preventDefault()},this),true)}}if(typeof e.styles.fav!="undefined"&&BX.type.isNotEmptyString(e.styles.fav.switch)){var o=BX.findChildren(BX(this.containerNodeId),{className:e.styles.fav.switch},true);for(t=0,length=o.length;t<length;t++){BX(o[t]).addEventListener("click",BX.delegate(function(e){this.setFavorites(e)},this),true)}}}if(typeof e.urls!="undefined"){this.urls=e.urls}if(this.subscribeButtonNodeId&&BX(this.subscribeButtonNodeId)){BX.bind(BX(this.subscribeButtonNodeId),"click",BX.delegate(function(e){this.setSubscribe();e.preventDefault()},this))}if(this.menuButtonNodeId&&BX(this.menuButtonNodeId)){var n=BX.SocialnetworkUICommon.SonetGroupMenu.getInstance();n.favoritesValue=this.favoritesValue;BX.bind(BX(this.menuButtonNodeId),"click",BX.delegate(function(e){BX.SocialnetworkUICommon.showGroupMenuPopup({bindElement:BX(this.menuButtonNodeId),groupId:this.groupId,groupType:this.groupType,userIsMember:this.userIsMember,userIsAutoMember:this.userIsAutoMember,userRole:this.userRole,editFeaturesAllowed:this.editFeaturesAllowed,isProject:this.isProject,isOpened:this.isOpened,perms:{canInitiate:this.canInitiate,canProcessRequestsIn:this.canProcessRequestsIn,canModify:this.canModify},urls:{requestUser:BX.message("SGCSPathToRequestUser"),edit:BX.message("SGCSPathToEdit"),delete:BX.message("SGCSPathToDelete"),features:BX.message("SGCSPathToFeatures"),members:BX.message("SGCSPathToMembers"),requests:BX.message("SGCSPathToRequests"),requestsOut:BX.message("SGCSPathToRequestsOut"),userRequestGroup:BX.message("SGCSPathToUserRequestGroup"),userLeaveGroup:BX.message("SGCSPathToUserLeaveGroup"),copy:BX.message("SGCSPathToCopy")}});e.preventDefault()},this))}BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()=="sonetGroupEvent"){var t=e.getData();if(BX.type.isNotEmptyString(t.code)&&typeof t.data!="undefined"){if(t.code=="afterEdit"&&typeof t.data.group!="undefined"&&parseInt(t.data.group.ID)==this.groupId){BX.SocialnetworkUICommon.reload()}else if(BX.util.in_array(t.code,["afterDelete","afterLeave"])&&typeof t.data.groupId!="undefined"&&parseInt(t.data.groupId)==this.groupId){if(window!==top.window){top.BX.SidePanel.Instance.getSliderByWindow(window).close()}top.location.href=this.urls.groupsList}}}},this));BX.addCustomEvent(window,"BX.Socialnetwork.WorkgroupMenu:onSetFavorites",BX.delegate(function(e){this.favoritesValue=e.value;if(e.groupId=this.groupId){var t=BX.findChild(BX(this.containerNodeId),{className:this.styles.fav.switch},true);this.switchFavorites(t,e.value)}},this))},setSubscribe:function(){var e=!BX.hasClass(this.subscribeButtonNodeId,"ui-btn-active")?"set":"unset";this.switchSubscribe(this.subscribeButtonNodeId,e=="set");BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.group_menu/ajax.php",method:"POST",dataType:"json",data:{groupID:this.groupId,action:e=="set"?"set":"unset",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(t){if(typeof t.SUCCESS!="undefined"&&t.SUCCESS=="Y"){var s={code:"afterSetSubscribe",data:{groupId:this.groupId,value:t.RESULT=="Y"}};window.top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",s)}else if(BX.type.isNotEmptyString(t.ERROR)){this.switchSubscribe(this.subscribeButtonNodeId,!(e=="set"));this.processAJAXError(t.ERROR)}},this),onerror:BX.delegate(function(t){this.switchSubscribe(this.subscribeButtonNodeId,!(e=="set"))},this)})},setFavorites:function(e){var t=this;var s=t.favoritesValue;var i=!s;var o=BX.SocialnetworkUICommon.SonetGroupMenu.getInstance();t.favoritesValue=i;o.favoritesValue=i;o.setItemTitle(i);var n=BX.hasClass(BX.getEventTarget(e),"socialnetwork-group-fav-switch")?BX.getEventTarget(e):null;if(!n){n=BX.findChild(BX(this.containerNodeId),{className:this.styles.fav.switch},true)}if(n){BX.delegate(function(){this.switchFavorites(n,i)},t)()}BX.SocialnetworkUICommon.setFavoritesAjax({groupId:t.groupId,favoritesValue:s,callback:{success:function(e){var s={code:"afterSetFavorites",data:{groupId:e.ID,value:e.RESULT=="Y"}};window.top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",s);if(typeof e.NAME!="undefined"&&typeof e.URL!="undefined"){BX.onCustomEvent(window,"BX.Socialnetwork.WorkgroupFavorites:onSet",[{id:t.groupId,name:e.NAME,url:e.URL,extranet:typeof e.EXTRANET!="undefined"?e.EXTRANET:"N"},i])}},failure:function(e){t.favoritesValue=s;o.favoritesValue=s;o.setItemTitle(s);if(BX.type.isNotEmptyString(e.ERROR)){t.processAJAXError(e.ERROR)}BX.delegate(function(){t.switchFavorites(n,s)},t)}}});e.preventDefault()},switchFavorites:function(e,t){if(BX(e)&&typeof this.styles.fav!="undefined"&&BX.type.isNotEmptyString(this.styles.fav.activeSwitch)){if(t){BX.addClass(BX(e),this.styles.fav.activeSwitch)}else{BX.removeClass(BX(e),this.styles.fav.activeSwitch)}}},switchSubscribe:function(e,t){if(BX(e)){if(!!t){BX.addClass(BX(e),"ui-btn-active");BX.removeClass(BX(e),"ui-btn-icon-follow");BX.addClass(BX(e),"ui-btn-icon-unfollow");BX(e).innerHTML=BX.message("SGCSSubscribeTitleY");this.showNotifyHint(BX(e),BX.message("SGCSSubscribeButtonHintOn"))}else{BX.removeClass(BX(e),"ui-btn-active");BX.removeClass(BX(e),"ui-btn-icon-unfollow");BX.addClass(BX(e),"ui-btn-icon-follow");BX(e).innerHTML=BX.message("SGCSSubscribeTitleN");this.showNotifyHint(BX(e),BX.message("SGCSSubscribeButtonHintOff"))}}},processAJAXError:function(e){var t=this;if(e.indexOf("SESSION_ERROR",0)===0){t.showError(BX.message("SGMErrorSessionWrong"));return false}else if(e.indexOf("CURRENT_USER_NOT_AUTH",0)===0){t.showError(BX.message("SGMErrorCurrentUserNotAuthorized"));return false}else if(e.indexOf("SONET_MODULE_NOT_INSTALLED",0)===0){t.showError(BX.message("SGMErrorModuleNotInstalled"));return false}else{t.showError(e);return false}},showWait:function(e){var t=this;if(e!==0){return t.waitTimeout=setTimeout(function(){t.showWait(0)},300)}if(!t.waitPopup){t.waitPopup=new BX.PopupWindow("socialnetwork-group-wait",window,{autoHide:true,lightShadow:true,zIndex:2,content:BX.create("DIV",{props:{className:"socialnetwork-group-wait-cont"},children:[BX.create("DIV",{props:{className:"socialnetwork-group-wait-icon"}}),BX.create("DIV",{props:{className:"socialnetwork-group-wait-text"},html:BX.message("SGCSWaitTitle")})]})})}else{t.waitPopup.setBindElement(window)}t.waitPopup.show()},closeWait:function(){if(this.waitTimeout){clearTimeout(this.waitTimeout);this.waitTimeout=null}if(this.waitPopup){this.waitPopup.close()}},showNotifyHint:function(e,t){var s=this;if(s.notifyHintTimeout){clearTimeout(s.notifyHintTimeout);s.notifyHintTimeout=null}if(s.notifyHintPopup==null){s.notifyHintPopup=new BX.PopupWindow("sgm_notify_hint",e,{autoHide:true,lightShadow:true,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-notify-hint-content"},style:{display:"none"},children:[BX.create("SPAN",{props:{id:"sgm_notify_hint_text"},html:t})]}),closeByEsc:true,closeIcon:false,offsetLeft:21,offsetTop:2});s.notifyHintPopup.TEXT=BX("sgm_notify_hint_text");s.notifyHintPopup.setBindElement(e)}else{s.notifyHintPopup.TEXT.innerHTML=t;s.notifyHintPopup.setBindElement(e)}s.notifyHintPopup.setAngle({});s.notifyHintPopup.show();s.notifyHintTimeout=setTimeout(function(){s.notifyHintPopup.close()},s.notifyHintTime)},showError:function(e){this.closeWait();var t=new BX.PopupWindow("sgm-error"+Math.random(),window,{autoHide:true,lightShadow:false,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-error-text-block"},html:e}),closeByEsc:true,closeIcon:true});t.show()},clickTag:function(e){if(e.length>0){top.location.href=BX.message("SGCSPathToGroupTag").replace("#tag#",e)}},clickUser:function(e){if(parseInt(e)>0){top.location.href=BX.message("SGCSPathToUserProfile").replace("#user_id#",e)}}}})();
//# sourceMappingURL=script.map.js