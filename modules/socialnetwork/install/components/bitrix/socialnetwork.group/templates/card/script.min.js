this.BX=this.BX||{};(function(e,t,s,i){"use strict";function o(){var e=babelHelpers.taggedTemplateLiteral(['<div class="sonet-sgm-error-text-block">',"</div>"]);o=function t(){return e};return e}var n=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"processAJAXError",value:function e(t){if(t.indexOf("SESSION_ERROR",0)===0){this.showError(s.Loc.getMessage("SGMErrorSessionWrong"))}else if(t.indexOf("CURRENT_USER_NOT_AUTH",0)===0){this.showError(s.Loc.getMessage("SGMErrorCurrentUserNotAuthorized"))}else if(t.indexOf("SONET_MODULE_NOT_INSTALLED",0)===0){this.showError(s.Loc.getMessage("SGMErrorModuleNotInstalled"))}else{this.showError(t)}return false}},{key:"showError",value:function e(t){new i.Popup("sgm-error"+Math.random(),null,{autoHide:true,lightShadow:false,zIndex:2,content:s.Tag.render(o(),t),closeByEsc:true,closeIcon:true}).show()}}]);return e}();var r=function(){function e(i){var o=this;babelHelpers.classCallCheck(this,e);this.value=!!i.value;this.containerNode=i.containerNode;this.styles=i.styles;this.groupId=parseInt(i.groupId);if(this.containerNode){if(s.Type.isPlainObject(this.styles)&&s.Type.isStringFilled(this.styles.switch)){this.containerNode.querySelectorAll(".".concat(this.styles.switch)).forEach(function(e){e.addEventListener("click",function(e){o.set(e)},true)})}t.EventEmitter.subscribe("BX.Socialnetwork.WorkgroupMenu:onSetFavorites",function(e){var t=e.getCompatData(),s=babelHelpers.slicedToArray(t,1),i=s[0];o.setValue(i.value);if(parseInt(i.groupId)===o.groupId){var n=o.containerNode.querySelector(".".concat(o.styles.switch));if(n){o.switch(n,i.value)}}})}}babelHelpers.createClass(e,[{key:"setValue",value:function e(t){this.value=t}},{key:"getValue",value:function e(){return this.value}},{key:"set",value:function e(i){var o=this;var r=this.getValue();var a=!r;var u=BX.SocialnetworkUICommon.SonetGroupMenu.getInstance();this.setValue(a);u.favoritesValue=a;u.setItemTitle(a);var l=i.target.classList.contains(this.styles.switch)?i.target:null;if(!l){l=this.containerNode.querySelector(".".concat(this.styles.switch))}if(l){this.switch(l,a)}BX.SocialnetworkUICommon.setFavoritesAjax({groupId:this.groupId,favoritesValue:r,callback:{success:function e(i){var n={code:"afterSetFavorites",data:{groupId:i.ID,value:i.RESULT=="Y"}};window.top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",n);if(s.Type.isStringFilled(i.NAME)&&s.Type.isStringFilled(i.URL)){t.EventEmitter.emit("BX.Socialnetwork.WorkgroupFavorites:onSet",new t.BaseEvent({compatData:[{id:o.groupId,name:i.NAME,url:i.URL,extranet:s.Type.isStringFilled(i.EXTRANET)?i.EXTRANET:"N"},a]}))}},failure:function e(t){o.setValue(r);u.favoritesValue=r;u.setItemTitle(r);if(s.Type.isStringFilled(t.ERROR)){n.processAJAXError(t.ERROR)}o.switch(l,r)}}});i.preventDefault()}},{key:"switch",value:function e(t,i){if(!s.Type.isDomNode(t)||!s.Type.isPlainObject(this.styles)||!s.Type.isStringFilled(this.styles.activeSwitch)){return}if(i){t.classList.add(this.styles.activeSwitch)}else{t.classList.remove(this.styles.activeSwitch)}}}]);return e}();function a(){var e=babelHelpers.taggedTemplateLiteral(['<div class="sonet-sgm-notify-hint-content" style="display: none;"><span id="sgm_notify_hint_text">',"</span></div>"]);a=function t(){return e};return e}var u=function(){function e(t){var s=this;babelHelpers.classCallCheck(this,e);this.groupId=parseInt(t.groupId);this.buttonNode=t.buttonNode;this.notifyHintTimeout=null;this.notifyHintPopup=null;this.notifyHintTime=3e3;if(this.buttonNode){this.buttonNode.addEventListener("click",function(){s.set()},true)}}babelHelpers.createClass(e,[{key:"set",value:function e(){var t=this;var i=!this.buttonNode.classList.contains("ui-btn-active")?"set":"unset";this.switch(this.buttonNode,i==="set");s.ajax.runAction("socialnetwork.api.workgroup.setSubscription",{data:{params:{groupId:this.groupId,value:i==="set"?"Y":"N"}}}).then(function(e){var s={code:"afterSetSubscribe",data:{groupId:t.groupId,value:e.RESULT=="Y"}};window.top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",s)}).catch(function(e){t.switch(t.buttonNode,!(i==="set"));n.processAJAXError(e.errors[0].message)})}},{key:"switch",value:function e(t,i){if(!s.Type.isDomNode(t)){return}if(!!i){t.classList.add("ui-btn-active");t.classList.remove("ui-btn-icon-follow");t.classList.add("ui-btn-icon-unfollow");t.innerHTML=s.Loc.getMessage("SGCSSubscribeTitleY");this.showNotifyHint(t,s.Loc.getMessage("SGCSSubscribeButtonHintOn"))}else{t.classList.remove("ui-btn-active");t.classList.add("ui-btn-icon-follow");t.classList.remove("ui-btn-icon-unfollow");t.innerHTML=s.Loc.getMessage("SGCSSubscribeTitleN");this.showNotifyHint(t,s.Loc.getMessage("SGCSSubscribeButtonHintOff"))}}},{key:"showNotifyHint",value:function e(t,o){var n=this;if(this.notifyHintTimeout){clearTimeout(this.notifyHintTimeout);this.notifyHintTimeout=null}if(s.Type.isNull(this.notifyHintPopup)){this.notifyHintPopup=new i.Popup("sgm_notify_hint",t,{autoHide:true,lightShadow:true,zIndex:2,content:s.Tag.render(a(),o),closeByEsc:true,closeIcon:false,offsetLeft:21,offsetTop:2});this.notifyHintPopup.TEXT=document.getElementById("sgm_notify_hint_text");this.notifyHintPopup.setBindElement(t)}else{this.notifyHintPopup.TEXT.innerHTML=o;this.notifyHintPopup.setBindElement(t)}this.notifyHintPopup.setAngle({});this.notifyHintPopup.show();this.notifyHintTimeout=setTimeout(function(){n.notifyHintPopup.close()},this.notifyHintTime)}}]);return e}();var l=function(){function e(){babelHelpers.classCallCheck(this,e);this.instance=null;this.currentUserId=null;this.userRole=null;this.canInitiate=null;this.canModify=null;this.groupId=null;this.isProject=null;this.isScrumProject=null;this.styles=null;this.urls=null;this.containerNode=null;this.menuButtonNode=null;this.editFeaturesAllowed=true;this.copyFeatureAllowed=true;this.favoritesInstance=null}babelHelpers.createClass(e,[{key:"init",value:function e(i){var o=this;if(s.Type.isUndefined(i)||s.Type.isUndefined(i.groupId)||parseInt(i.groupId)<=0){return}this.currentUserId=parseInt(i.currentUserId);this.groupId=parseInt(i.groupId);this.groupType=i.groupType;this.isProject=!!i.isProject;this.isScrumProject=!!i.isScrumProject;this.isOpened=!!i.isOpened;this.canInitiate=!!i.canInitiate;this.canProcessRequestsIn=!!i.canProcessRequestsIn;this.canModify=!!i.canModify;this.userRole=i.userRole;this.userIsMember=!!i.userIsMember;this.userIsAutoMember=!!i.userIsAutoMember;this.containerNode=s.Type.isStringFilled(i.containerNodeId)?document.getElementById(i.containerNodeId):null;this.menuButtonNode=s.Type.isStringFilled(i.menuButtonNodeId)?document.getElementById(i.menuButtonNodeId):null;this.editFeaturesAllowed=!s.Type.isUndefined(i.editFeaturesAllowed)?!!i.editFeaturesAllowed:true;this.copyFeatureAllowed=!s.Type.isUndefined(i.copyFeatureAllowed)?!!i.copyFeatureAllowed:true;this.favoritesInstance=new r({groupId:this.groupId,value:!!i.favoritesValue,containerNode:this.containerNode,styles:i.styles.fav});this.subscriptionInstance=new u({groupId:this.groupId,buttonNode:s.Type.isStringFilled(i.subscribeButtonNodeId)?document.getElementById(i.subscribeButtonNodeId):null});if(this.containerNode&&s.Type.isPlainObject(i.styles)){this.styles=i.styles;if(s.Type.isPlainObject(i.styles.tags)&&s.Type.isStringFilled(i.styles.tags.box)){this.containerNode.querySelectorAll(".".concat(i.styles.tags.box)).forEach(function(e){e.addEventListener("click",function(e){var t=e.target.getAttribute("bx-tag-value");if(s.Type.isStringFilled(t)){o.clickTag(t)}e.preventDefault()},true)})}if(s.Type.isPlainObject(i.styles.users)&&s.Type.isStringFilled(i.styles.users.box)&&s.Type.isStringFilled(i.styles.users.item)){this.containerNode.querySelectorAll(".".concat(i.styles.users.box)).forEach(function(e){e.addEventListener("click",function(e){var t=e.target;if(!t.hasAttribute("bx-user-id")){t=t.closest(".".concat(i.styles.users.item))}var s=t.getAttribute("bx-user-id");if(parseInt(s)>0){o.clickUser(s)}e.preventDefault()},true)})}}if(s.Type.isPlainObject(i.urls)){this.urls=i.urls}if(s.Type.isDomNode(this.menuButtonNode)){var n=BX.SocialnetworkUICommon.SonetGroupMenu.getInstance();n.favoritesValue=this.favoritesInstance.getValue();this.menuButtonNode.addEventListener("click",function(){BX.SocialnetworkUICommon.showGroupMenuPopup({bindElement:o.menuButtonNode,groupId:o.groupId,groupType:o.groupType,userIsMember:o.userIsMember,userIsAutoMember:o.userIsAutoMember,userRole:o.userRole,editFeaturesAllowed:o.editFeaturesAllowed,copyFeatureAllowed:o.copyFeatureAllowed,isProject:o.isProject,isScrumProject:o.isScrumProject,isOpened:o.isOpened,perms:{canInitiate:o.canInitiate,canProcessRequestsIn:o.canProcessRequestsIn,canModify:o.canModify},urls:{requestUser:s.Loc.getMessage("SGCSPathToRequestUser"),edit:s.Loc.getMessage("SGCSPathToEdit"),delete:s.Loc.getMessage("SGCSPathToDelete"),features:s.Loc.getMessage("SGCSPathToFeatures"),members:s.Loc.getMessage("SGCSPathToMembers"),requests:s.Loc.getMessage("SGCSPathToRequests"),requestsOut:s.Loc.getMessage("SGCSPathToRequestsOut"),userRequestGroup:s.Loc.getMessage("SGCSPathToUserRequestGroup"),userLeaveGroup:s.Loc.getMessage("SGCSPathToUserLeaveGroup"),copy:s.Loc.getMessage("SGCSPathToCopy")}})},true)}t.EventEmitter.subscribe("SidePanel.Slider:onMessage",this.onSliderMessage.bind(this))}},{key:"clickTag",value:function e(t){if(!s.Type.isStringFilled(t.length)){return}top.location.href=s.Loc.getMessage("SGCSPathToGroupTag").replace("#tag#",t)}},{key:"clickUser",value:function e(t){if(parseInt(t)<=0){return}top.location.href=s.Loc.getMessage("SGCSPathToUserProfile").replace("#user_id#",t)}},{key:"onSliderMessage",value:function e(t){var i=t.getCompatData(),o=babelHelpers.slicedToArray(i,1),n=o[0];if(n.getEventId()!=="sonetGroupEvent"){return}var r=n.getData();if(!s.Type.isStringFilled(r.code)||!s.Type.isPlainObject(r.data)){return}if(r.code==="afterEdit"&&s.Type.isPlainObject(r.data.group)&&parseInt(r.data.group.ID)===this.groupId){BX.SocialnetworkUICommon.reload()}else if(["afterDelete","afterLeave"].includes(r.code)&&!s.Type.isUndefined(r.data.groupId)&&parseInt(r.data.groupId)===this.groupId){if(window!==top.window){top.BX.SidePanel.Instance.getSliderByWindow(window).close()}top.location.href=this.urls.groupsList}}}]);return e}();e.WorkgroupCard=l})(this.BX.Socialnetwork=this.BX.Socialnetwork||{},BX.Event,BX,BX.Main);
//# sourceMappingURL=script.map.js