(function(e,t,i,s){"use strict";var n=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"init",value:function e(t){i.EventEmitter.emit("BX.CommentAux.initialize",new i.BaseEvent({compatData:[]}));s.RenderParts.init(t)}},{key:"isSourcePost",value:function e(t){return this.postEventTypeList.includes(t)}},{key:"isSourceComment",value:function e(t){return this.commentEventTypeList.includes(t)}},{key:"getTypesList",value:function e(){return Object.values(this.typesList)}},{key:"getLiveTypesList",value:function e(){return[this.typesList.createentity,this.typesList.createtask,this.typesList.fileversion,this.typesList.taskinfo]}},{key:"getLiveText",value:function e(i,n){var r=this;var a="";var T="";var E="";var c="";if(i.toLowerCase()===this.typesList.share){if(t.Type.isPlainObject(n)&&n.length>0){a=t.Loc.getMessage(n.length===1?"SONET_COMMENTAUX_JS_SHARE_TEXT":"SONET_COMMENTAUX_JS_SHARE_TEXT_1");a=a.replace("#SHARE_LIST#",this.getShareList(n))}}else if(i.toLowerCase()===this.typesList.createentity){if(t.Type.isPlainObject(n)&&t.Type.isStringFilled(n.entityType)&&!t.Type.isUndefined(n.entityId)&&parseInt(n.entityId)>0&&t.Type.isStringFilled(n.entityName)&&t.Type.isStringFilled(n.sourceEntityType)&&!t.Type.isUndefined(n.sourceEntityId)&&parseInt(n.sourceEntityId)>0){var o=this.renderEntity({ENTITY_TYPE:n.entityType,NAME:n.entityName,LINK:t.Type.isStringFilled(n.entityUrl)?n.entityUrl:"",VISIBILITY:this.getEntityVisibility(n)});E=t.Type.isStringFilled(n.sourceEntityLink)?n.sourceEntityLink:"";E=!s.RenderParts.mobile?'<a target="_blank" href="'.concat(E,'">'):"";if(this.isSourcePost(n.sourceEntityType)){T=t.Type.isStringFilled(n.sourceEntityType)?n.sourceEntityType:"BLOG_POST";c=t.Type.isStringFilled(n.suffix)?"_".concat(n.suffix):"";T="".concat(T).concat(c);a=t.Loc.getMessage("SONET_COMMENTAUX_JS_CREATEENTITY_POST_".concat(T)).replace("#ENTITY_CREATED#",this.getEntityCreatedMessage(n.entityType)).replace("#ENTITY_NAME#",o).replace("#A_BEGIN#",E).replace("#A_END#",!s.RenderParts.mobile?"</a>":"")}else if(this.isSourceComment(n.sourceEntityType)){c=t.Type.isStringFilled(n.suffix)?"_".concat(n.suffix):"";T=t.Type.isStringFilled(n.sourceEntityType)?"".concat(n.sourceEntityType).concat(c):"BLOG_COMMENT";a=t.Loc.getMessage("SONET_COMMENTAUX_JS_CREATEENTITY_COMMENT_".concat(T)).replace("#ENTITY_CREATED#",this.getEntityCreatedMessage(n.entityType)).replace("#ENTITY_NAME#",o).replace("#A_BEGIN#",E).replace("#A_END#",!s.RenderParts.mobile?"</a>":"")}}}else if(i.toLowerCase()===this.typesList.createtask){if(t.Type.isPlainObject(n)&&!t.Type.isUndefined(n.taskId)&&parseInt(n.taskId)>0&&t.Type.isStringFilled(n.taskName)&&t.Type.isStringFilled(n.sourceEntityType)&&!t.Type.isUndefined(n.sourceEntityId)&&parseInt(n.sourceEntityId)>0){var y=this.renderEntity({ENTITY_TYPE:"task",NAME:n.taskName,LINK:t.Type.isStringFilled(n.taskUrl)?n.taskUrl:"",VISIBILITY:{userId:!t.Type.isUndefined(n.taskResponsibleId)&&parseInt(n.taskResponsibleId)>0?parseInt(n.taskResponsibleId):0}});if(this.isSourcePost(n.sourceEntityType)){T=t.Type.isStringFilled(n.sourceEntityType)?n.sourceEntityType:"BLOG_POST";c=t.Type.isStringFilled(n.suffix)?"_".concat(n.suffix):"";E=t.Type.isStringFilled(n.sourceEntityLink)?n.sourceEntityLink:"";a=t.Loc.getMessage("SONET_COMMENTAUX_JS_CREATETASK_POST_".concat(T).concat(c)).replace("#TASK_NAME#",y).replace("#A_BEGIN#",!s.RenderParts.mobile?'<a target="_blank" href="'.concat(E,'">'):"").replace("#A_END#",!s.RenderParts.mobile?"</a>":"")}else if(this.isSourceComment(n.sourceEntityType)){c=t.Type.isStringFilled(n.suffix)?"_".concat(n.suffix):"";T=t.Type.isStringFilled(n.sourceEntityType)?"".concat(n.sourceEntityType).concat(c):"BLOG_COMMENT";E=t.Type.isStringFilled(n.sourceEntityLink)?n.sourceEntityLink:"";a=t.Loc.getMessage("SONET_COMMENTAUX_JS_CREATETASK_COMMENT_".concat(T)).replace("#TASK_NAME#",y).replace("#A_BEGIN#",!s.RenderParts.mobile?'<a target="_blank" href="'.concat(E,'">'):"").replace("#A_END#",!s.RenderParts.mobile?"</a>":"")}}}else if(i.toLowerCase()===this.typesList.fileversion){var l=t.Type.isPlainObject(n)&&!t.Type.isUndefined(n.isEnabledKeepVersion)&&n.isEnabledKeepVersion?"SONET_COMMENTAUX_JS_FILEVERSION_TEXT":"SONET_COMMENTAUX_JS_HEAD_FILEVERSION_TEXT";var p=t.Type.isPlainObject(n)&&t.Type.isStringFilled(n.userGender)?"_".concat(n.userGender):"";a=t.Loc.getMessage("".concat(l).concat(p))}else if(i.toLowerCase()===this.typesList.taskinfo){if(t.Type.isPlainObject(n)&&t.Type.isStringFilled(n.JSON)){var _=[];var d={};try{d=JSON.parse(t.Text.decode(n.JSON))}catch(e){d={}}t.Type.isArray(d);{d.forEach(function(e){if(!t.Type.isArray(e)){return}e.forEach(function(e){var i=e[0];if(!t.Type.isStringFilled(i)){return}_.push(r.renderEntity({ENTITY_TYPE:"TASK_COMMENT_PART",CODE:i,REPLACE_LIST:t.Type.isPlainObject(e[1])?e[1]:{}}))})})}if(_.length){a=_.join("<br>")}}}return a}},{key:"getShareList",value:function e(i){var s=this;var n="";var r=[];if(!t.Type.isPlainObject(i)||i.length<=0){return n}Object.values(i).forEach(function(e){r.push(s.renderEntity(e))});n=r.join(", ");return n}},{key:"renderEntity",value:function e(i){var n="";if(!t.Type.isPlainObject(i)||!t.Type.isStringFilled(i.ENTITY_TYPE)){return n}switch(i.ENTITY_TYPE.toUpperCase()){case"U":n=s.RenderParts.getNodeU(i);break;case"UA":n=s.RenderParts.getNodeUA();break;case"SG":n=s.RenderParts.getNodeSG(i);break;case"DR":n=s.RenderParts.getNodeDR(i);break;case"TASK":n=s.RenderParts.getNodeTask(i);break;case"BLOG_POST":n=s.RenderParts.getNodePost(i);break;case"CALENDAR_EVENT":n=s.RenderParts.getNodeCalendarEvent(i);break;case"TASK_COMMENT_PART":n=s.RenderParts.getTaskCommentPart(i);break;default:}var r=t.Dom.create("div",{children:[n]});n=r.innerHTML;t.Dom.clean(r);t.Dom.remove(r);return n}},{key:"getEntityCreatedMessage",value:function e(i){var s="";if(!t.Type.isStringFilled(i)){return s}switch(i){case"TASK":s=t.Loc.getMessage("SONET_COMMENTAUX_JS_CREATEENTITY_ENTITY_CREATED_TASK");break;case"BLOG_POST":s=t.Loc.getMessage("SONET_COMMENTAUX_JS_CREATEENTITY_ENTITY_CREATED_BLOG_POST");break;case"CALENDAR_EVENT":s=t.Loc.getMessage("SONET_COMMENTAUX_JS_CREATEENTITY_ENTITY_CREATED_CALENDAR_EVENT");break;default:}return s}},{key:"getEntityTypeName",value:function e(i){var s="";if(!t.Type.isStringFilled(i)){return s}switch(i){case"TASK":s=t.Loc.getMessage("SONET_COMMENTAUX_CREATEENTITY_ENTITY_TASK");break;default:}return s}},{key:"getEntityVisibility",value:function e(i){var s={};var n=parseInt(t.Loc.getMessage("USER_ID"));if(i.entityType.toUpperCase()==="TASK"){s.userId=!t.Type.isUndefined(i.taskResponsibleId)&&parseInt(i.taskResponsibleId)>0?parseInt(i.taskResponsibleId):0}else if(i.entityType.toUpperCase()==="BLOG_POST"){s.available=t.Type.isArray(i.socNetPermissions)&&(i.socNetPermissions.indexOf("G2")>-1||i.socNetPermissions.indexOf("UA")>-1||i.socNetPermissions.indexOf("U".concat(n))>-1||i.socNetPermissions.indexOf("US".concat(n))>-1)}else if(i.entityType.toUpperCase()==="CALENDAR_EVENT"){s.available=t.Type.isArray(i.attendees)&&i.attendees.indexOf(n)>-1}return s}}]);return e}();babelHelpers.defineProperty(n,"postEventTypeList",["BLOG_POST","FORUM_TOPIC","TASK","TIMEMAN_ENTRY","TIMEMAN_REPORT","LOG_ENTRY","PHOTO_ALBUM","PHOTO_PHOTO","WIKI","LISTS_NEW_ELEMENT","CALENDAR_EVENT","INTRANET_NEW_USER","BITRIX24_NEW_USER"]);babelHelpers.defineProperty(n,"commentEventTypeList",["BLOG_COMMENT","FORUM_POST","LOG_COMMENT"]);babelHelpers.defineProperty(n,"typesList",{share:"share",createentity:"createentity",createtask:"createtask",fileversion:"fileversion",taskinfo:"taskinfo"});e.CommentAux=n})(this.BX=this.BX||{},BX,BX.Event,BX);
//# sourceMappingURL=commentaux.bundle.map.js