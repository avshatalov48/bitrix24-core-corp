(function(){var e=window.BX;if(!!e.SocialnetworkUICommon){return}e.SocialnetworkUICommon={showRecallJoinRequestPopup:function(t){if(parseInt(t.RELATION_ID)<=0||!e.type.isNotEmptyString(t.URL_REJECT_OUTGOING_REQUEST)){return}var o=typeof t.PROJECT!="undefined"?!!t.PROJECT:false;var n=new e.PopupWindow("bx-group-join-successfull-request-popup",window,{width:420,autoHide:true,lightShadow:false,zIndex:1e3,overlay:true,content:e.create("DIV",{children:[e.create("DIV",{text:e.message("SONET_EXT_COMMON_RECALL_JOIN_POPUP_TITLE"),props:{className:"sonet-group-join-successfull-request-popup-title"}}),e.create("DIV",{text:e.message(o?"SONET_EXT_COMMON_RECALL_JOIN_POPUP_TEXT_PROJECT":"SONET_EXT_COMMON_RECALL_JOIN_POPUP_TEXT"),props:{className:"sonet-group-join-successfull-request-popup-text"}}),e.create("DIV",{props:{className:"sonet-ui-btn-cont sonet-ui-btn-cont-center"},children:[e.create("DIV",{children:[e.create("BUTTON",{props:{className:"ui-btn ui-btn-md ui-btn-danger"},events:{click:e.delegate(function(o){var i=o.currentTarget;this.hideError(e("bx-group-delete-request-error"));this.showButtonWait(i);e.ajax({url:t.URL_REJECT_OUTGOING_REQUEST,method:"POST",dataType:"json",data:{action:"reject",max_count:1,checked_0:"Y",type_0:"INVITE_GROUP",id_0:t.RELATION_ID,type:"out",ajax_request:"Y",sessid:e.bitrix_sessid()},onsuccess:e.delegate(function(o){this.hideButtonWait(i);if(typeof o.MESSAGE!="undefined"&&o.MESSAGE=="SUCCESS"){n.destroy();if(e.type.isNotEmptyString(t.URL_GROUPS_LIST)){top.location.href=t.URL_GROUPS_LIST}}else if(typeof o.MESSAGE!="undefined"&&o.MESSAGE=="ERROR"&&typeof o.ERROR_MESSAGE!="undefined"&&o.ERROR_MESSAGE.length>0){this.showError(o.ERROR_MESSAGE,e("bx-group-delete-request-error"))}},this),onfailure:e.delegate(function(t){this.showError(e.message("SONET_EXT_COMMON_AJAX_ERROR"),e("bx-group-delete-request-error"));this.hideButtonWait(i)},this)})},this)},text:e.message(o?"SONET_EXT_COMMON_RECALL_JOIN_POPUP_BUTTON_PROJECT":"SONET_EXT_COMMON_RECALL_JOIN_POPUP_BUTTON")})]})]})]}),closeByEsc:true,closeIcon:true});n.show()},showGroupMenuPopup:function(t){var o=t.bindElement,n=parseInt(e.message("USER_ID")),i=e.SocialnetworkUICommon.SonetGroupMenu.getInstance();if(e(o).tagName=="BUTTON"){e.addClass(o,"ui-btn-active")}var s=[];if(n>0){s.push({text:e.message(!!i.favoritesValue?"SONET_EXT_COMMON_GROUP_MENU_FAVORITES_REMOVE":"SONET_EXT_COMMON_GROUP_MENU_FAVORITES_ADD"),title:e.message(!!i.favoritesValue?"SONET_EXT_COMMON_GROUP_MENU_FAVORITES_REMOVE":"SONET_EXT_COMMON_GROUP_MENU_FAVORITES_ADD"),id:"set-group-favorite",onclick:e.delegate(function(o){var n=i.favoritesValue;i.setItemTitle(!n);i.favoritesValue=!n;this.setFavoritesAjax({groupId:t.groupId,favoritesValue:n,callback:{success:function(o){e.onCustomEvent(window,"BX.Socialnetwork.WorkgroupFavorites:onSet",[{id:t.groupId,name:o.NAME,url:o.URL,extranet:typeof o.EXTRANET!="undefined"?o.EXTRANET:"N"},!n]);e.onCustomEvent(window,"BX.Socialnetwork.WorkgroupMenu:onSetFavorites",[{groupId:t.groupId,value:!n}]);window.top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",{code:"afterSetFavorites",data:{groupId:o.ID,value:o.RESULT=="Y"}})},failure:function(e){i.favoritesValue=n;i.setItemTitle(n)}}})},this)});if(t.perms.canInitiate){s.push({text:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_REQU_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_REQU"),title:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_REQU_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_REQU"),href:t.urls.requestUser})}if(t.perms.canModify){s.push({text:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_EDIT_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_EDIT"),title:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_EDIT_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_EDIT"),href:t.urls.edit});if(!t.hideArchiveLinks){var a={text:e.message("SONET_EXT_COMMON_GROUP_MENU_FEAT"),title:e.message("SONET_EXT_COMMON_GROUP_MENU_FEAT")};if(t.editFeaturesAllowed){a.href=t.urls.features}else{a.onclick=function(){B24.licenseInfoPopup.show("sonetGroupFeatures",e.message("SONET_EXT_COMMON_B24_SONET_GROUP_FEATURES_TITLE"),"<span>"+e.message("SONET_EXT_COMMON_B24_SONET_GROUP_FEATURES_TEXT")+"</span>",true)}}s.push(a)}s.push({text:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_DELETE_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_DELETE"),title:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_DELETE_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_DELETE"),href:t.urls.delete})}s.push({text:e.message(t.perms.canModerate?"SONET_EXT_COMMON_GROUP_MENU_MEMBERS_EDIT":"SONET_EXT_COMMON_GROUP_MENU_MEMBERS_VIEW"),title:e.message(t.perms.canModerate?"SONET_EXT_COMMON_GROUP_MENU_MEMBERS_EDIT":"SONET_EXT_COMMON_GROUP_MENU_MEMBERS_VIEW"),href:t.urls.members});if(t.perms.canInitiate){if(t.perms.canProcessRequestsIn){s.push({text:e.message("SONET_EXT_COMMON_GROUP_MENU_REQ_IN"),title:e.message("SONET_EXT_COMMON_GROUP_MENU_REQ_IN"),href:t.urls.requests})}s.push({text:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_REQ_OUT_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_REQ_OUT"),title:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_REQ_OUT_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_REQ_OUT"),href:t.urls.requestsOut})}if(t.perms.canModify){var r={text:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_COPY_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_COPY"),title:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_COPY_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_COPY")};if(t.copyFeatureAllowed){r.href=t.urls.copy}else{r.onclick=function(){if(!!t.isProject){e.UI.InfoHelper.show("limit_task_copy_project")}else{e.UI.InfoHelper.show("limit_task_copy_group")}}}s.push(r)}if((!e.type.isNotEmptyString(t.userRole)||t.userRole==e.message("USER_TO_GROUP_ROLE_REQUEST")&&t.initiatedByType==e.message("USER_TO_GROUP_INITIATED_BY_GROUP"))&&!t.hideArchiveLinks){var _={text:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_JOIN_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_JOIN"),title:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_JOIN_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_JOIN")};if(!!t.isOpened){_.onclick=e.proxy(function(){this.sendJoinRequest(t)},this)}else{_.href=t.urls.userRequestGroup}s.push(_)}if(t.userIsMember&&!t.userIsAutoMember&&t.userRole!=e.message("USER_TO_GROUP_ROLE_OWNER")){s.push({text:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_EXIT_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_EXIT"),title:e.message(!!t.isProject?"SONET_EXT_COMMON_GROUP_MENU_EXIT_PROJECT":"SONET_EXT_COMMON_GROUP_MENU_EXIT"),href:t.urls.userLeaveGroup})}if(t.canPickTheme){s.push({text:e.message("SONET_EXT_COMMON_GROUP_MENU_THEME_DIALOG"),title:e.message("SONET_EXT_COMMON_GROUP_MENU_THEME_DIALOG"),onclick:function(){e.Intranet.Bitrix24.ThemePicker.Singleton.showDialog(false)}})}}var u=e.PopupMenu.create("group-profile-menu",o,s,{offsetTop:5,offsetLeft:o.offsetWidth-18,angle:true,events:{onPopupClose:function(){if(e(o).tagName=="BUTTON"){e.removeClass(o,"ui-btn-active")}}}});var E=u.getMenuItem("set-group-favorite");if(E){i.menuItem=E.layout.text}u.popupWindow.show();i.menuPopup=u},sendJoinRequest:function(t){e.SocialnetworkUICommon.Waiter.getInstance().show();if(e.SocialnetworkUICommon.SonetGroupMenu.getInstance()&&e.SocialnetworkUICommon.SonetGroupMenu.getInstance().menuPopup){e.SocialnetworkUICommon.SonetGroupMenu.getInstance().menuPopup.close()}e.ajax({url:t.urls.userRequestGroup,method:"POST",dataType:"json",data:{groupID:t.groupId,MESSAGE:"",ajax_request:"Y",save:"Y",sessid:e.bitrix_sessid()},onsuccess:e.delegate(function(t){e.SocialnetworkUICommon.Waiter.getInstance().hide();if(typeof t.MESSAGE!="undefined"&&t.MESSAGE=="SUCCESS"&&typeof t.URL!="undefined"){e.onCustomEvent(window.top,"sonetGroupEvent",[{code:"afterJoinRequestSend",data:{groupId:this.groupId}}]);top.location.href=t.URL}},this),onfailure:e.delegate(function(){e.SocialnetworkUICommon.Waiter.getInstance().hide()},this)})},setFavoritesAjax:function(t){e.ajax.runAction("socialnetwork.api.workgroup.setFavorites",{data:{params:{groupId:t.groupId,value:t.favoritesValue===false?"Y":"N",getAdditionalResultData:true}},analyticsLabel:{b24statAction:t.favoritesValue?"removeFavSonetGroup":"addFavSonetGroup"}}).then(function(e){t.callback.success(e.data)}.bind(this)).catch(function(e){t.callback.failure({ERROR:e.errors[0].message})}.bind(this))},showButtonWait:function(t){t=e(t);if(t){e.addClass(t,"ui-btn-clock");t.disabled=true;t.style.cursor="auto"}},hideButtonWait:function(t){t=e(t);if(t){e.removeClass(t,"ui-btn-clock");t.disabled=false;t.style.cursor="cursor"}},showError:function(t,o){if(e(o)){e(o).innerHTML=t;e.removeClass(e(o),"sonet-ui-form-error-block-invisible")}},hideError:function(t){if(e(t)){e.addClass(e(t),"sonet-ui-form-error-block-invisible")}},reload:function(){if(top!==window){if(typeof top.BX.SidePanel!="undefined"){top.BX.SidePanel.Instance.getSliderByWindow(window).showLoader()}window.location.reload()}else if(typeof top.BX.SidePanel!="undefined"&&top.BX.SidePanel.Instance.isOpen()){top.location.href=top.BX.SidePanel.Instance.getPageUrl()}else{top.location.reload()}},reloadBlock:function(t){if(typeof t=="undefined"||!e.type.isNotEmptyString(t.blockId)||!e(t.blockId)){return}var o="";if(typeof top.BX.SidePanel!="undefined"&&top.BX.SidePanel.Instance.isOpen()){o=top.BX.SidePanel.Instance.getPageUrl()}else{o=window.location.href}e.ajax.promise({url:o,method:"POST",dataType:"json",data:{BLOCK_RELOAD:"Y",BLOCK_ID:t.blockId}}).then(e.delegate(function(o){if(typeof o!="undefined"&&typeof o.CONTENT!="undefined"){e(t.blockId).innerHTML=o.CONTENT;setTimeout(function(){e.ajax.processRequestData(o.CONTENT,{dataType:"HTML"})},0)}},this))},closeGroupCardMenu:function(e){if(!e){return}var t=e.ownerDocument;var o=t.defaultView||t.parentWindow;if(!o||typeof o.BX.SocialnetworkUICommon.SonetGroupMenu=="undefined"||!o.BX.SocialnetworkUICommon.SonetGroupMenu.getInstance().menuPopup){return}o.BX.SocialnetworkUICommon.SonetGroupMenu.getInstance().menuPopup.close()}};e.SocialnetworkUICommon.Waiter=function(){this.instance=null;this.waitTimeout=null;this.waitPopup=null};e.SocialnetworkUICommon.Waiter.getInstance=function(){if(e.SocialnetworkUICommon.Waiter.instance==null){e.SocialnetworkUICommon.Waiter.instance=new e.SocialnetworkUICommon.Waiter}return e.SocialnetworkUICommon.Waiter.instance};e.SocialnetworkUICommon.Waiter.prototype={show:function(t){if(t!==0){return this.waitTimeout=setTimeout(e.proxy(function(){this.show(0)},this),50)}if(!this.waitPopup){this.waitPopup=new e.PopupWindow("sonet_common_wait_popup",window,{autoHide:true,lightShadow:true,zIndex:2,content:e.create("DIV",{props:{className:"sonet-wait-cont"},children:[e.create("DIV",{props:{className:"sonet-wait-icon"}}),e.create("DIV",{props:{className:"sonet-wait-text"},html:e.message("SONET_EXT_COMMON_WAIT")})]})})}else{this.waitPopup.setBindElement(window)}this.waitPopup.show()},hide:function(){if(this.waitTimeout){clearTimeout(this.waitTimeout);this.waitTimeout=null}if(this.waitPopup){this.waitPopup.close()}}};e.SocialnetworkUICommon.SonetGroupMenu=function(){this.favoritesValue=null;this.instance=null;this.menuPopup=null;this.menuItem=null};e.SocialnetworkUICommon.SonetGroupMenu.getInstance=function(){if(e.SocialnetworkUICommon.SonetGroupMenu.instance==null){e.SocialnetworkUICommon.SonetGroupMenu.instance=new e.SocialnetworkUICommon.SonetGroupMenu;e.addCustomEvent("SidePanel.Slider:onClose",function(t){if(e.SocialnetworkUICommon.SonetGroupMenu.instance.menuPopup){e.SocialnetworkUICommon.SonetGroupMenu.instance.menuPopup.close()}});e.addCustomEvent("BX.Socialnetwork.WorkgroupMenuIcon:onSetFavorites",function(e){this.getInstance().setItemTitle(e.value)}.bind(this))}return e.SocialnetworkUICommon.SonetGroupMenu.instance};e.SocialnetworkUICommon.SonetGroupMenu.prototype={setItemTitle:function(t){if(this.menuItem){e(this.menuItem).innerHTML=e.message(!!t?"SONET_EXT_COMMON_GROUP_MENU_FAVORITES_REMOVE":"SONET_EXT_COMMON_GROUP_MENU_FAVORITES_ADD")}}}})();
//# sourceMappingURL=socialnetwork.common.map.js