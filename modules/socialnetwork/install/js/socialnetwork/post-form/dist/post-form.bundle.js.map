{"version":3,"file":"post-form.bundle.js","sources":["../src/post-data.js","../src/post-form-manager.js","../src/post-form-router.js","../src/post-form.js"],"sourcesContent":["import { Cache, Loc, Type } from 'main.core';\nimport { InitData, PostFormData } from './post-form';\n\nexport class PostData\n{\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(data: InitData)\n\t{\n\t\tthis.#setData(data);\n\t}\n\n\tsetFormData(formData: PostFormData)\n\t{\n\t\tconst currentData = this.#cache.get('data');\n\n\t\tthis.#setData({\n\t\t\t...currentData,\n\t\t\t...formData,\n\t\t});\n\t}\n\n\tprepareRequestData(): Object\n\t{\n\t\treturn {\n\t\t\tPOST_TITLE: this.#getData('title'),\n\t\t\tPOST_MESSAGE: this.#getData('message'),\n\t\t\tDEST_DATA: this.#getData('recipients'),\n\t\t\tUF_BLOG_POST_FILE: this.#getData('fileIds'),\n\t\t\tTAGS: this.#getData('tags'),\n\t\t};\n\t}\n\n\tvalidateRequestData(): string\n\t{\n\t\tif (!this.getTitle() && !this.getMessage())\n\t\t{\n\t\t\treturn Loc.getMessage('SN_PF_REQUEST_TEXT_VALIDATION_ERROR');\n\t\t}\n\n\t\tif (!this.getRecipients())\n\t\t{\n\t\t\treturn Loc.getMessage('SN_PF_REQUEST_RECIPIENTS_VALIDATION_ERROR');\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn Type.isStringFilled(this.#getData('title')) ? this.#getData('title') : '';\n\t}\n\n\tgetMessage(): string\n\t{\n\t\treturn Type.isStringFilled(this.#getData('message')) ? this.#getData('message') : '';\n\t}\n\n\tgetRecipients(): string\n\t{\n\t\treturn Type.isStringFilled(this.#getData('recipients')) ? this.#getData('recipients') : '';\n\t}\n\n\tsetRecipients(recipients: string): void\n\t{\n\t\tconst currentData = this.#cache.get('data');\n\n\t\tconst newData = { recipients };\n\n\t\tthis.#setData({\n\t\t\t...currentData,\n\t\t\t...newData,\n\t\t});\n\t}\n\n\tgetAllUsersTitle(): string\n\t{\n\t\treturn this.#getData('allUsersTitle');\n\t}\n\n\tisAllowEmailInvitation(): boolean\n\t{\n\t\treturn this.#getData('allowEmailInvitation') === true;\n\t}\n\n\tisAllowToAll(): boolean\n\t{\n\t\treturn this.#getData('allowToAll') === true;\n\t}\n\n\t#setData(data: InitData)\n\t{\n\t\tthis.#cache.set('data', data);\n\t}\n\n\t#getData(param: string): any\n\t{\n\t\treturn this.#cache.get('data')[param];\n\t}\n}\n","import { Dom, Event, Loc, Tag } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\ntype Params = {\n\tformId: string,\n\tLHEId: string,\n\tisShownPostTitle: boolean,\n}\n\nexport type MentionEntity = {\n\tname: string,\n\tentityId: number,\n\tavatar?: string,\n\temail?: string,\n\tisExtranet?: 'Y' | 'N',\n\tisEmail?: 'Y' | 'N',\n}\n\nexport class PostFormManager extends EventEmitter\n{\n\t#formId: string;\n\t#LHEId: string;\n\t#isShownPostTitle: boolean;\n\n\t#LHEPostForm: Object;\n\t#eventNode: HTMLElement;\n\t#showPostTitleBtn: HTMLElement;\n\t#editor: BXEditor;\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Socialnetwork.PostFormManager');\n\n\t\tthis.#formId = params.formId;\n\t\tthis.#LHEId = params.LHEId;\n\t\tthis.#isShownPostTitle = params.isShownPostTitle === true;\n\n\t\tEventEmitter.subscribe('OnEditorInitedAfter', (event: BaseEvent) => {\n\t\t\tconst [editor] = event.getData();\n\t\t\tthis.#editorInited(editor);\n\t\t});\n\n\t\tEventEmitter.subscribe('onMentionAdd', this.#addMention.bind(this));\n\t}\n\n\tinitLHE()\n\t{\n\t\tif (!window.LHEPostForm)\n\t\t{\n\t\t\tthrow new Error('BX.Socialnetwork.PostFormManager: LHEPostForm not found');\n\t\t}\n\n\t\tthis.#LHEPostForm = window.LHEPostForm;\n\n\t\tconst handler = this.#LHEPostForm.getHandler(this.#LHEId);\n\n\t\tthis.#eventNode = handler.eventNode;\n\n\t\tEventEmitter.emit(this.#eventNode, 'OnShowLHE', ['show']);\n\n\t\tthis.#appendButtonShowingPostTitle();\n\t}\n\n\tgetEditorText(): string\n\t{\n\t\treturn this.#editor.GetContent();\n\t}\n\n\tfocusToEditor()\n\t{\n\t\tthis.#editor.Focus();\n\t}\n\n\t#editorInited(editor)\n\t{\n\t\tif (editor.id === this.#LHEId)\n\t\t{\n\t\t\tthis.#editor = editor;\n\n\t\t\tthis.emit('editorInited');\n\n\t\t\tEventEmitter.subscribe(editor, 'OnFullscreenExpand', () => {\n\t\t\t\tthis.emit('fullscreenExpand');\n\t\t\t});\n\t\t}\n\t}\n\n\t#addMention(baseEvent: BaseEvent)\n\t{\n\t\tconst [\n\t\t\tentity: MentionEntity,\n\t\t\ttype: 'user' | 'project' | 'department',\n\t\t] = baseEvent.getCompatData();\n\n\t\tconst entityType = this.#getEntityType(type, entity);\n\n\t\tthis.emit('addMention', { type, entity, entityType });\n\t}\n\n\t#getEntityType(type: 'user' | 'project' | 'department', entity: MentionEntity): string\n\t{\n\t\tlet entityType = '';\n\t\tif (type === 'user')\n\t\t{\n\t\t\tif (entity.isExtranet === 'Y')\n\t\t\t{\n\t\t\t\tentityType = 'extranet';\n\t\t\t}\n\t\t\telse if (entity.isEmail === 'Y')\n\t\t\t{\n\t\t\t\tentityType = 'email';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tentityType = 'employee';\n\t\t\t}\n\t\t}\n\t\telse if (type === 'project')\n\t\t{\n\t\t\tif (entity.isExtranet === 'Y')\n\t\t\t{\n\t\t\t\tentityType = 'extranet';\n\t\t\t}\n\t\t}\n\n\t\treturn entityType;\n\t}\n\n\t#appendButtonShowingPostTitle()\n\t{\n\t\tconst activeClass = this.#isShownPostTitle ? 'feed-add-post-form-btn-active' : '';\n\n\t\tthis.#showPostTitleBtn = Tag.render`\n\t\t\t<div\n\t\t\t\tdata-id=\"sn-post-form-manager-show-title-btn\"\n\t\t\t\tclass=\"feed-add-post-form-title-btn ${activeClass}\"\n\t\t\t\ttitle=\"${Loc.getMessage('SN_PF_TITLE_PLACEHOLDER')}\"\n\t\t\t>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#showPostTitleBtn, 'click', this.#toggleVisibilityPostTitle.bind(this));\n\n\t\tconst containerWithAdditionalButtons = this.#eventNode\n\t\t\t.querySelector('.feed-add-post-form-but-more-open')\n\t\t;\n\n\t\tDom.append(this.#showPostTitleBtn, containerWithAdditionalButtons);\n\t}\n\n\t#toggleVisibilityPostTitle()\n\t{\n\t\tthis.emit('toggleVisibilityPostTitle');\n\n\t\tthis.#isShownPostTitle = !this.#isShownPostTitle;\n\n\t\tDom.toggleClass(this.#showPostTitleBtn, 'feed-add-post-form-btn-active');\n\t}\n}\n","import { Type } from 'main.core';\n\ntype Params = {\n\tpathToDefaultRedirect: string,\n\tpathToGroupRedirect: string,\n}\n\nexport class PostFormRouter\n{\n\t#pathToDefaultRedirect: string;\n\t#pathToGroupRedirect: string;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#pathToDefaultRedirect = Type.isString(params.pathToDefaultRedirect)\n\t\t\t? params.pathToDefaultRedirect\n\t\t\t: ''\n\t\t;\n\t\tthis.#pathToGroupRedirect = Type.isString(params.pathToGroupRedirect)\n\t\t\t? params.pathToGroupRedirect\n\t\t\t: ''\n\t\t;\n\t}\n\n\tredirectTo(groupId: number)\n\t{\n\t\tif (groupId)\n\t\t{\n\t\t\tif (this.#pathToGroupRedirect)\n\t\t\t{\n\t\t\t\tlocation.href = this.#pathToGroupRedirect.replace('#group_id#', groupId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlocation.reload();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// eslint-disable-next-line no-lonely-if\n\t\t\tif (this.#pathToDefaultRedirect)\n\t\t\t{\n\t\t\t\tlocation.href = this.#pathToDefaultRedirect;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlocation.reload();\n\t\t\t}\n\t\t}\n\t}\n}\n","import {\n\tajax,\n\tAjaxError,\n\tAjaxResponse,\n\tDom,\n\tLoc,\n\tReflection,\n\tRuntime,\n\tTag,\n\tText,\n\tType,\n} from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { TagSelector } from 'ui.entity-selector';\nimport { Button, ButtonColor } from 'ui.buttons';\nimport { UploaderFile } from 'ui.uploader.core';\nimport { PostData } from './post-data';\nimport { PostFormManager } from './post-form-manager';\nimport { PostFormRouter } from './post-form-router';\n\nconst UserOptions = Reflection.namespace('BX.userOptions');\nconst NotificationCenter = Reflection.namespace('BX.UI.Notification.Center');\n\nimport 'ui.alerts';\nimport 'ui.notification';\nimport 'ui.icon-set.actions';\n\nimport './css/form.css';\n\ntype Params = {\n\tpostId?: number,\n\tgroupId?: number,\n\tpathToDefaultRedirect?: string,\n\tpathToGroupRedirect?: string,\n}\n\nexport type PostFormData = {\n\ttitle: string,\n\tmessage: string,\n\trecipients: string,\n\tfileIds: Array,\n\ttags: string,\n}\n\nexport type InitData = {\n\tisShownPostTitle: 'Y' | 'N',\n\ttitle?: string,\n\tmessage?: string,\n\trecipients?: string,\n\tfileIds?: Array<string | number>,\n\tallUsersTitle: string,\n\tallowEmailInvitation: boolean,\n\tallowToAll: boolean,\n}\n\nexport class PostForm extends EventEmitter\n{\n\t#postId: number;\n\t#groupId: number;\n\n\t#isShownPostTitle: boolean;\n\n\t#formId: string;\n\t#jsObjName: string;\n\t#LHEId: string;\n\t#sended: boolean;\n\n\t#popup: Popup;\n\t#sendBtn: Button;\n\t#postData: PostData;\n\t#postFormManager: PostFormManager;\n\t#postFormRouter: PostFormRouter;\n\t#node: HTMLElement;\n\t#titleNode: HTMLElement;\n\t#recipientSelector: HTMLElement;\n\n\t#errorLayout: {\n\t\tcontainer: HTMLElement,\n\t\tmessage: HTMLElement,\n\t};\n\n\t#selector: TagSelector;\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Socialnetwork.PostForm');\n\n\t\tthis.#postId = (\n\t\t\tType.isInteger(parseInt(params.postId, 10))\n\t\t\t\t? parseInt(params.postId, 10)\n\t\t\t\t: 0\n\t\t);\n\t\tthis.#groupId = (\n\t\t\tType.isInteger(parseInt(params.groupId, 10))\n\t\t\t\t? parseInt(params.groupId, 10)\n\t\t\t\t: 0\n\t\t);\n\n\t\tthis.#formId = `blogPostForm_${Text.getRandom().toLowerCase()}`;\n\t\tthis.#jsObjName = `oPostFormLHE_blogPostForm${this.#formId}`;\n\t\tthis.#LHEId = `idPostFormLHE_${this.#formId}`;\n\t\tthis.#sended = false;\n\n\t\tthis.#postFormRouter = new PostFormRouter({\n\t\t\tpathToDefaultRedirect: params.pathToDefaultRedirect,\n\t\t\tpathToGroupRedirect: params.pathToGroupRedirect,\n\t\t});\n\n\t\tthis.#errorLayout = {};\n\t}\n\n\tshow(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#init()\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (!this.#popup)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#createPopup();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#popup.subscribeOnce('onShow', () => {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#popup.show();\n\t\t\t\t})\n\t\t\t\t.catch(() => reject())\n\t\t\t;\n\t\t});\n\t}\n\n\t#init(): Promise\n\t{\n\t\treturn ajax.runAction('socialnetwork.api.livefeed.blogpost.getPostFormInitData', {\n\t\t\tdata: {\n\t\t\t\tpostId: this.#postId,\n\t\t\t\tgroupId: this.#groupId,\n\t\t\t},\n\t\t})\n\t\t\t.then((response: AjaxResponse) => {\n\t\t\t\tconst initData: InitData = response.data;\n\n\t\t\t\tthis.#postData = new PostData(initData);\n\n\t\t\t\tthis.#isShownPostTitle = initData.isShownPostTitle === 'Y';\n\n\t\t\t\tthis.#postFormManager = new PostFormManager({\n\t\t\t\t\tformId: this.#formId,\n\t\t\t\t\tLHEId: this.#LHEId,\n\t\t\t\t\tisShownPostTitle: this.#isShownPostTitle,\n\t\t\t\t});\n\t\t\t\tthis.#postFormManager.subscribe(\n\t\t\t\t\t'editorInited',\n\t\t\t\t\tthis.#afterEditorInit.bind(this),\n\t\t\t\t);\n\t\t\t\tthis.#postFormManager.subscribe(\n\t\t\t\t\t'toggleVisibilityPostTitle',\n\t\t\t\t\tthis.#toggleVisibilityPostTitle.bind(this),\n\t\t\t\t);\n\t\t\t\tthis.#postFormManager.subscribe(\n\t\t\t\t\t'fullscreenExpand',\n\t\t\t\t\tthis.#changePostFormPosition.bind(this),\n\t\t\t\t);\n\t\t\t\tthis.#postFormManager.subscribe(\n\t\t\t\t\t'addMention',\n\t\t\t\t\tthis.#addMention.bind(this),\n\t\t\t\t);\n\n\t\t\t\treturn this;\n\t\t\t})\n\t\t\t.catch((error: AjaxError) => {\n\t\t\t\tthis.#consoleError('init', error);\n\t\t\t})\n\t\t;\n\t}\n\n\t#createPopup()\n\t{\n\t\tthis.#popup = new Popup(\n\t\t\t{\n\t\t\t\tid: this.#formId,\n\t\t\t\tclassName: 'sn-post-form-popup --normal',\n\t\t\t\tcontent: this.#renderForm(),\n\t\t\t\tcontentNoPaddings: true,\n\t\t\t\tminHeight: 370,\n\t\t\t\twidth: 720,\n\t\t\t\tdisableScroll: true,\n\t\t\t\tdraggable: false,\n\t\t\t\toverlay: true,\n\t\t\t\tpadding: 0,\n\t\t\t\tbuttons: [\n\t\t\t\t\tthis.#sendBtn = new Button({\n\t\t\t\t\t\ttext: Loc.getMessage('SN_PF_SEND_BTN'),\n\t\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis.#sendForm();\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: Loc.getMessage('SN_PF_CANCEL_BTN'),\n\t\t\t\t\t\tcolor: ButtonColor.LINK,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis.#popup.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonFirstShow: this.#firstShow.bind(this),\n\t\t\t\t\tonAfterClose: this.#afterClose.bind(this),\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\t#firstShow()\n\t{\n\t\tthis.#sendBtn.setWaiting(true);\n\n\t\tthis.#initRecipientSelector();\n\n\t\t// eslint-disable-next-line promise/catch-or-return\n\t\tthis.#renderMainPostForm()\n\t\t\t.then((runtimePromise: Promise) => {\n\t\t\t\t// eslint-disable-next-line promise/catch-or-return,promise/no-nesting\n\t\t\t\truntimePromise.then(() => {\n\t\t\t\t\tthis.#postFormManager.initLHE();\n\t\t\t\t});\n\t\t\t})\n\t\t;\n\t}\n\n\t#afterClose()\n\t{\n\t\tif (this.#sended)\n\t\t{\n\t\t\tthis.#postFormRouter.redirectTo(this.#groupId);\n\t\t}\n\t}\n\n\t#sendForm()\n\t{\n\t\tif (this.#sendBtn.isWaiting())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#hideError();\n\n\t\tthis.#postData.setFormData(this.#collectFormData());\n\t\tconst errorMessage = this.#postData.validateRequestData();\n\t\tif (errorMessage)\n\t\t{\n\t\t\tthis.#showError(errorMessage);\n\n\t\t\tthis.#postFormManager.focusToEditor();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#sendBtn.setWaiting(true);\n\n\t\tconst action = `socialnetwork.api.livefeed.blogpost.${this.#postId ? 'update' : 'add'}`;\n\n\t\tconst data = this.#postId\n\t\t\t? {\n\t\t\t\tid: this.#postId,\n\t\t\t\tparams: this.#postData.prepareRequestData(),\n\t\t\t}\n\t\t\t: {\n\t\t\t\tparams: this.#postData.prepareRequestData(),\n\t\t\t}\n\t\t;\n\n\t\tajax.runAction(action, {\n\t\t\tdata,\n\t\t\tanalyticsLabel: {\n\t\t\t\tb24statAction: 'addLogEntry',\n\t\t\t\tb24statContext: 'spaces',\n\t\t\t},\n\t\t})\n\t\t\t.then((response: AjaxResponse) => {\n\t\t\t\tthis.#sended = true;\n\t\t\t\tthis.#popup.close();\n\t\t\t})\n\t\t\t.catch((error: AjaxError) => {\n\t\t\t\tthis.#sendBtn.setWaiting(false);\n\t\t\t\tthis.#consoleError('sendForm', error);\n\t\t\t})\n\t\t;\n\t}\n\n\t#collectFormData(): PostFormData\n\t{\n\t\tconst postFormData = {\n\t\t\ttitle: this.#titleNode.querySelector('input').value,\n\t\t\tmessage: this.#postFormManager.getEditorText(),\n\t\t};\n\n\t\tpostFormData.recipients = this.#postData.getRecipients();\n\n\t\tconst fileIds = [];\n\t\tconst userFieldControl = BX.Disk.Uploader.UserFieldControl.getById(this.#formId);\n\t\tuserFieldControl.getFiles().forEach((file: UploaderFile) => {\n\t\t\tif (file.getServerFileId() !== null)\n\t\t\t{\n\t\t\t\tfileIds.push(file.getServerFileId());\n\t\t\t}\n\t\t});\n\t\tpostFormData.fileIds = fileIds;\n\n\t\tconst tagsHiddenInput = this.#node.querySelector('input[name=\"TAGS\"]');\n\t\tif (Type.isDomNode(tagsHiddenInput))\n\t\t{\n\t\t\tpostFormData.tags = tagsHiddenInput.value;\n\t\t}\n\n\t\treturn postFormData;\n\t}\n\n\t#showError(message: string): void\n\t{\n\t\tDom.removeClass(this.#errorLayout.container, '--hidden');\n\n\t\tthis.#errorLayout.message.textContent = Text.encode(message);\n\t}\n\n\t#hideError(): void\n\t{\n\t\tDom.addClass(this.#errorLayout.container, '--hidden');\n\n\t\tthis.#errorLayout.message.textContent = '';\n\t}\n\n\t#renderMainPostForm(): Promise\n\t{\n\t\treturn ajax.runAction('socialnetwork.api.livefeed.blogpost.getMainPostForm', {\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tformId: this.#formId,\n\t\t\t\t\tjsObjName: this.#jsObjName,\n\t\t\t\t\tLHEId: this.#LHEId,\n\t\t\t\t\tpostId: this.#postId,\n\t\t\t\t\ttext: this.#postData.getMessage(),\n\t\t\t\t},\n\t\t\t},\n\t\t})\n\t\t\t.then((response: AjaxResponse) => {\n\t\t\t\treturn Runtime.html(\n\t\t\t\t\tthis.#node.querySelector('#sn-post-form'),\n\t\t\t\t\tresponse.data.html,\n\t\t\t\t\t{ htmlFirst: true },\n\t\t\t\t);\n\t\t\t})\n\t\t\t.catch((error: AjaxError) => {\n\t\t\t\tthis.#consoleError('afterShow', error);\n\t\t\t})\n\t\t;\n\t}\n\n\t#renderForm(): HTMLElement\n\t{\n\t\tthis.#node = Tag.render`\n\t\t\t<div class=\"sn-post-form__discussion\">\n\t\t\t\t${this.#renderErrorAlert()}\n\t\t\t\t${this.#renderRecipientSelector()}\n\t\t\t\t${this.#renderTitle()}\n\t\t\t\t<div id=\"sn-post-form\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#node;\n\t}\n\n\t#renderErrorAlert(): HTMLElement\n\t{\n\t\tconst { container, message } = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-post-form__discussion-error-alert ui-alert ui-alert-danger --hidden\"\n\t\t\t\tref=\"container\"\n\t\t\t>\n\t\t\t\t<span class=\"ui-alert-message\" ref=\"message\"></span>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#errorLayout.container = container;\n\t\tthis.#errorLayout.message = message;\n\n\t\treturn container;\n\t}\n\n\t#renderRecipientSelector(): HTMLElement\n\t{\n\t\tthis.#recipientSelector = Tag.render`\n\t\t\t<div class=\"sn-post-form__discussion-row\"></div>\n\t\t`;\n\n\t\treturn this.#recipientSelector;\n\t}\n\n\t#initRecipientSelector(): TagSelector\n\t{\n\t\tconst selectorId = 'sn-post-form-recipient-selector';\n\n\t\tthis.#selector = new TagSelector({\n\t\t\tid: selectorId,\n\t\t\tdialogOptions: {\n\t\t\t\tid: selectorId,\n\t\t\t\tcontext: 'PostForm',\n\t\t\t\tpreselectedItems: (\n\t\t\t\t\tType.isStringFilled(this.#postData.getRecipients())\n\t\t\t\t\t\t? JSON.parse(this.#postData.getRecipients())\n\t\t\t\t\t\t: []\n\t\t\t\t),\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'meta-user',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t'all-users': {\n\t\t\t\t\t\t\t\ttitle: this.#postData.getAllUsersTitle(),\n\t\t\t\t\t\t\t\tallowView: this.#postData.isAllowToAll(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\temailUsers: this.#postData.isAllowEmailInvitation(),\n\t\t\t\t\t\t\tinviteGuestLink: this.#postData.isAllowEmailInvitation(),\n\t\t\t\t\t\t\tmyEmailUsers: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'project',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tfeatures: {\n\t\t\t\t\t\t\t\tblog: [\n\t\t\t\t\t\t\t\t\t'premoderate_post',\n\t\t\t\t\t\t\t\t\t'moderate_post',\n\t\t\t\t\t\t\t\t\t'write_post',\n\t\t\t\t\t\t\t\t\t'full_post',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'department',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tselectMode: 'usersAndDepartments',\n\t\t\t\t\t\t\tallowFlatDepartments: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': () => {\n\t\t\t\t\t\tthis.#changeSelectedRecipients(this.#selector.getDialog().getSelectedItems());\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onDeselect': () => {\n\t\t\t\t\t\tthis.#changeSelectedRecipients(this.#selector.getDialog().getSelectedItems());\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis.#selector.renderTo(this.#recipientSelector);\n\n\t\treturn this.#selector;\n\t}\n\n\t#changeSelectedRecipients(selectedItems: Array): void\n\t{\n\t\tconst recipients = [];\n\n\t\tselectedItems.forEach((item) => {\n\t\t\trecipients.push([item.entityId, item.id]);\n\t\t});\n\n\t\tthis.#postData.setRecipients(recipients.length > 0 ? JSON.stringify(recipients) : '');\n\t}\n\n\t#renderTitle(): HTMLElement\n\t{\n\t\tconst uiClasses = 'ui-ctl ui-ctl-textbox ui-ctl-no-border ui-ctl-w100 ui-ctl-no-padding ui-ctl-xs';\n\t\tconst hiddenClass = this.#isShownPostTitle ? '' : '--hidden';\n\n\t\tthis.#titleNode = Tag.render`\n\t\t\t<div class=\"sn-post-form__discussion-row ${hiddenClass}\">\n\t\t\t\t<div class=\"${uiClasses}\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tclass=\"ui-ctl-element sn-post-form__discussion_title\"\n\t\t\t\t\t\tplaceholder=\"${Loc.getMessage('SN_PF_TITLE_PLACEHOLDER')}\"\n\t\t\t\t\t\tdata-id=\"sn-post-form-title-input\"\n\t\t\t\t\t\tvalue=\"${Text.encode(this.#postData.getTitle())}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#titleNode;\n\t}\n\n\t#afterEditorInit()\n\t{\n\t\tthis.#sendBtn.setWaiting(false);\n\t}\n\n\t#toggleVisibilityPostTitle()\n\t{\n\t\tDom.toggleClass(this.#titleNode, '--hidden');\n\n\t\tconst isShown = !Dom.hasClass(this.#titleNode, '--hidden');\n\t\tif (isShown)\n\t\t{\n\t\t\tthis.#titleNode.querySelector('input').focus();\n\t\t}\n\n\t\tUserOptions.save('socialnetwork', 'postEdit', 'showTitle', (isShown ? 'Y' : 'N'));\n\t}\n\n\t#changePostFormPosition()\n\t{\n\t\tDom.toggleClass(this.#popup.getPopupContainer(), '--normal');\n\t}\n\n\t#addMention(baseEvent: BaseEvent)\n\t{\n\t\tconst { type, entity, entityType } = baseEvent.getData();\n\n\t\tthis.#selector\n\t\t\t.getDialog()\n\t\t\t.addItem({\n\t\t\t\tavatar: entity.avatar,\n\t\t\t\tcustomData: {\n\t\t\t\t\temail: Type.isStringFilled(entity.email) ? entity.email : '',\n\t\t\t\t},\n\t\t\t\tentityId: type,\n\t\t\t\tentityType: entityType,\n\t\t\t\tid: entity.entityId,\n\t\t\t\ttitle: entity.name,\n\t\t\t})\n\t\t\t.select()\n\t\t;\n\t}\n\n\t#consoleError(action: string, error: AjaxError)\n\t{\n\t\t// todo\n\t\tNotificationCenter.notify({\n\t\t\tcontent: Loc.getMessage('SN_PF_REQUEST_ERROR'),\n\t\t});\n\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error(`PostForm: ${action} error`, error);\n\t}\n}\n"],"names":["PostData","data","Cache","MemoryCache","formData","currentData","get","POST_TITLE","POST_MESSAGE","DEST_DATA","UF_BLOG_POST_FILE","TAGS","getTitle","getMessage","Loc","getRecipients","Type","isStringFilled","recipients","newData","set","param","PostFormManager","params","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","setEventNamespace","formId","LHEId","isShownPostTitle","EventEmitter","subscribe","event","getData","editor","_classPrivateMethodGet","bind","window","LHEPostForm","Error","handler","getHandler","eventNode","emit","GetContent","Focus","id","baseEvent","getCompatData","entity","type","entityType","isExtranet","isEmail","activeClass","Tag","render","Event","containerWithAdditionalButtons","querySelector","Dom","append","toggleClass","PostFormRouter","isString","pathToDefaultRedirect","pathToGroupRedirect","groupId","location","href","replace","reload","UserOptions","Reflection","namespace","NotificationCenter","PostForm","isInteger","parseInt","postId","Text","getRandom","toLowerCase","Promise","resolve","reject","then","subscribeOnce","show","ajax","runAction","response","initData","error","Popup","className","content","contentNoPaddings","minHeight","width","disableScroll","draggable","overlay","padding","buttons","Button","text","color","ButtonColor","PRIMARY","onclick","LINK","close","events","onFirstShow","onAfterClose","setWaiting","runtimePromise","initLHE","redirectTo","isWaiting","setFormData","errorMessage","validateRequestData","focusToEditor","action","prepareRequestData","analyticsLabel","b24statAction","b24statContext","postFormData","title","value","message","getEditorText","fileIds","userFieldControl","BX","Disk","Uploader","UserFieldControl","getById","getFiles","forEach","file","getServerFileId","push","tagsHiddenInput","isDomNode","tags","removeClass","container","textContent","encode","addClass","jsObjName","Runtime","html","htmlFirst","selectorId","TagSelector","dialogOptions","context","preselectedItems","JSON","parse","entities","options","getAllUsersTitle","allowView","isAllowToAll","emailUsers","isAllowEmailInvitation","inviteGuestLink","myEmailUsers","features","blog","selectMode","allowFlatDepartments","getDialog","getSelectedItems","renderTo","selectedItems","item","entityId","setRecipients","length","stringify","uiClasses","hiddenClass","isShown","hasClass","focus","save","getPopupContainer","addItem","avatar","customData","email","name","select","notify","console"],"mappings":"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"}