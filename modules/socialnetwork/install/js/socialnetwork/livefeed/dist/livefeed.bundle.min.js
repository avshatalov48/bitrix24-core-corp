this.BX=this.BX||{};(function(e,t,n,a,s){"use strict";var i=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"setStyle",value:function e(t,n){Object.entries(n).forEach(function(e){var n=babelHelpers.slicedToArray(e,2),a=n[0],s=n[1];t.style[a]=s})}}]);return e}();function o(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="','" bx-data-log-id="','">\n\t\t\t\t\t<div class="feed-post-cancel-pinned-panel-inner">\n\t\t\t\t\t\t<div class="feed-post-cancel-pinned-content">\n\t\t\t\t\t\t\t<span class="','">','</span>\n\t\t\t\t\t\t\t<span class="feed-post-cancel-pinned-text">','</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button class="ui-btn ui-btn-light-border ui-btn-round ui-btn-sm ','">',"</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\n\t\t\t\t"]);o=function t(){return e};return e}var l=function(){function e(){babelHelpers.classCallCheck(this,e);this.class={pin:"feed-post-pin",post:"feed-item-wrap",postHide:"feed-item-wrap-hide",postComments:"feed-comments-block",postPinned:"feed-post-block-pinned",postPinnedHide:"feed-post-block-pinned-hide",postPinActive:"feed-post-block-pin-active",postUnfollowed:"feed-post-block-unfollowed",postExpanding:"feed-post-block-expand",panelCollapsed:"feed-pinned-panel-collapsed",panelNonEmpty:"feed-pinned-panel-nonempty",panelPosts:"feed-pinned-panel-posts",collapsedPanel:"feed-post-collapsed-panel",collapsedPanelExpand:"feed-post-collapsed-panel-right",collapsedPanelCounterPostsValue:"feed-post-collapsed-panel-count-posts",collapsedPanelCounterComments:"feed-post-collapsed-panel-box-comments",collapsedPanelCounterCommentsValue:"feed-post-collapsed-panel-count-comments-value",collapsedPanelCounterCommentsShown:"feed-post-collapsed-panel-box-shown",collapsedPanelCounterCommentsValueNew:"feed-inform-comments-pinned-new",collapsedPanelCounterCommentsValueNewValue:"feed-inform-comments-pinned-new-value",collapsedPanelCounterCommentsValueNewActive:"feed-inform-comments-pinned-new-active",collapsedPanelCounterCommentsValueOld:"feed-inform-comments-pinned-old",collapsedPanelCounterCommentsValueAll:"feed-inform-comments-pinned-all",collapsedPanelShow:"feed-post-collapsed-panel--show",collapsedPanelHide:"feed-post-collapsed-panel--hide",cancelPanel:"feed-post-cancel-pinned-panel",cancelPanelButton:"feed-post-cancel-pinned-btn",cancelPanelLabel:"feed-post-cancel-pinned-label"};this.panelInitialized=false;this.postsInitialized=false;this.handlePostClick=this.handlePostClick.bind(this);this.options={};this.initPosts()}babelHelpers.createClass(e,[{key:"resetFlags",value:function e(){this.panelInitialized=false;this.postsInitialized=false}},{key:"init",value:function e(){this.initPanel();this.initPosts();this.initEvents()}},{key:"setOptions",value:function e(t){this.options=babelHelpers.objectSpread({},this.options,t)}},{key:"getOption",value:function e(t){return this.options[t]}},{key:"initPanel",value:function e(){var n=this;if(this.panelInitialized){return}var o=this.getPanelNode();if(!o){return}this.panelInitialized=true;this.adjustCollapsedPostsPanel();a.Event.bind(this.getCollapsedPanelNode(),"click",function(){var e=n.getPanelNode();if(!e){return}var t=e.offsetHeight;i.setStyle(e,{height:t+"px",transition:"height .5s"});setTimeout(function(){e.style=""},550);n.hideCollapsedPanel()});a.Event.bind(o,"click",function(e){var i=e.target.classList.contains("feed-inform-ilike")||e.target.closest(".feed-inform-ilike")!==null;var o=e.target.classList.contains("feed-inform-follow")||e.target.closest(".feed-inform-follow")!==null;var l=e.target.classList.contains("feed-post-more-link")||e.target.closest(".feed-post-more-link")!==null||e.target.classList.contains("feed-post-right-top-menu");var r=e.target.classList.contains("feed-inform-contentview")||e.target.closest(".feed-inform-contentview")!==null;var c=e.target.classList.contains("".concat(n.class.pin))||e.target.closest(".".concat(n.class.pin))!==null;var u=e.target.classList.contains("feed-post-pinned-link-collapse");var d=e.target.classList.contains("feed-inform-comments-pinned")||e.target.closest(".feed-inform-comments-pinned")!==null;var p=null;if(e.target.classList.contains("feed-post-block")){p=e.target}else{p=e.target.closest(".feed-post-block")}if(!p){return}if(p.classList.contains("".concat(n.class.postPinned))){if(!i&&!o&&!l&&!r&&!c){p.classList.remove("".concat(n.class.postPinned));var f=p.getAttribute("data-menu-id");if(f){t.MenuManager.destroy(f)}var h=new s.BaseEvent({compatData:[{rootNode:p}],data:{rootNode:p}});s.EventEmitter.emit("BX.Livefeed:recalculateComments",h)}if(d){var v=p.querySelector(".".concat(n.class.postComments," a[name=comments]"));if(v){var m=a.Dom.getPosition(v);window.scrollTo(0,m.top-200)}}e.stopPropagation();e.preventDefault()}else if(u){p.classList.add("".concat(n.class.postPinned));e.stopPropagation();e.preventDefault()}})}},{key:"initPosts",value:function e(){var t=this;if(this.postsInitialized){return}var n=document.querySelectorAll("[data-livefeed-post-pinned]");if(n.length>0){this.postsInitialized=true}Array.from(n).forEach(function(e){a.Event.unbind(e,"click",t.handlePostClick);a.Event.bind(e,"click",t.handlePostClick)})}},{key:"handlePostClick",value:function e(t){if(!t.target.classList.contains("".concat(this.class.pin))){return}var n=t.target.closest("[data-livefeed-id]");if(!n){return}var a=n.getAttribute("data-livefeed-post-pinned")==="Y"?"N":"Y";var s=parseInt(n.getAttribute("data-livefeed-id"));if(s<=0){return}this.changePinned({logId:s,newState:a,event:t}).then(function(){})}},{key:"initEvents",value:function e(){var t=this;s.EventEmitter.subscribe("OnUCCommentWasRead",function(e){var n=e.getData(),s=babelHelpers.slicedToArray(n,3),i=s[0],o=s[1],l=s[2];var r=t.getCommentsData(i),c=r.oldValue,u=r.newValue;if(!!l.new){t.setCommentsData(i,{newValue:a.Type.isInteger(u)?u-1:0,oldValue:a.Type.isInteger(c)?c+1:1})}});s.EventEmitter.incrementMaxListeners("OnUCCommentWasPulled");s.EventEmitter.subscribe("OnUCCommentWasPulled",function(e){var n=e.getData(),s=babelHelpers.slicedToArray(n,3),i=s[0],o=s[1],l=s[2];var r=babelHelpers.slicedToArray(i,2),c=r[0],u=r[1];var d=t.getCommentsData(c),p=d.newValue,f=d.oldValue,h=d.allValue,v=d.follow;var m={allValue:a.Type.isInteger(h)?h+1:1};if(parseInt(l.AUTHOR.ID)!==parseInt(BX.message("USER_ID"))){m.newValue=a.Type.isInteger(p)?p+1:1}else{m.oldValue=a.Type.isInteger(f)?f+1:1}t.setCommentsData(c,m)});s.EventEmitter.subscribe("OnUCommentWasDeleted",function(e){var n=e.getData(),s=babelHelpers.slicedToArray(n,3),i=s[0],o=s[1],l=s[2];var r=t.getCommentsData(i),c=r.oldValue,u=r.allValue;t.setCommentsData(i,{allValue:a.Type.isInteger(u)?u-1:0,oldValue:a.Type.isInteger(c)?c-1:0})})}},{key:"changePinned",value:function e(t){var n=this;var s=t.logId?parseInt(t.logId):0;var i=t.event?t.event:null;var o=t.node?t.node:null;var l=t.newState?t.newState:null;var r=this.getPanelNode();if(!o&&!i&&s>0&&r){o=r.querySelector(".".concat(this.class.post,' > [data-livefeed-id="').concat(s,'"]'))}if(!o&&i){o=i.target}return new Promise(function(e,t){if(!!n.getOption("pinBlocked")||!o||!l){return e()}n.setPostState({node:o,state:l});a.ajax.runAction("socialnetwork.api.livefeed.logentry."+(l==="Y"?"pin":"unpin"),{data:{params:{logId:s}},analyticsLabel:{b24statAction:l==="Y"?"pinLivefeedEntry":"unpinLivefeedEntry"}}).then(function(t){if(!t.data.success){n.setPostState({node:o,state:l==="Y"?"N":"Y"});return e()}else{n.movePost({node:o,state:l}).then(function(){return e()})}},function(t){n.setPostState({node:o,state:l==="Y"?"N":"Y"});return e()})})}},{key:"setPostState",value:function e(t){var n=t.state?t.state:null;var s=t.node?t.node:null;if(!s||!["Y","N"].includes(n)){return}var i=s.closest("[data-livefeed-post-pinned]");if(!i){return}i.setAttribute("data-livefeed-post-pinned",n);if(n==="Y"){i.classList.add("".concat(this.class.postPinActive))}else{i.classList.remove("".concat(this.class.postPinActive))}var o=i.querySelector(".".concat(this.class.pin));if(o){o.setAttribute("title",a.Loc.getMessage("SONET_EXT_LIVEFEED_PIN_TITLE_".concat(n)))}}},{key:"getPanelNode",value:function e(){return document.querySelector("[data-livefeed-pinned-panel]")}},{key:"getPinnedData",value:function e(t){var n=t.logId?parseInt(t.logId):0;if(n<=0){return Promise.reject()}return new Promise(function(e,t){a.ajax.runAction("socialnetwork.api.livefeed.logentry.getPinData",{data:{params:{logId:n}}}).then(function(t){return e(t.data)},function(e){return t()})})}},{key:"movePost",value:function e(t){var n=this;var s=t.state?t.state:null;var o=t.node?t.node:null;return new Promise(function(e,t){if(!o||!["Y","N"].includes(s)){return e()}var l=o.closest("[data-livefeed-post-pinned]");if(!l){return e()}var r=parseInt(l.getAttribute("data-livefeed-id"));if(!r){return e()}var c=n.getPanelNode();if(!c){return e()}var u=l.parentNode.classList.contains("".concat(n.class.post))?l.parentNode:l;if(s==="Y"){var d=u.offsetHeight;u.setAttribute("bx-data-height",d);n.getPinnedData({logId:r}).then(function(t){var s=l.querySelector(".feed-post-pinned-title");var o=l.querySelector(".feed-post-pinned-desc");var p=l.querySelector(".".concat(n.class.pin));if(s){s.innerHTML=t.TITLE}if(o){o.innerHTML=t.DESCRIPTION}if(p){p.title=a.Loc.getMessage("SONET_EXT_LIVEFEED_PIN_TITLE_Y")}l.classList.add("".concat(n.class.postPinnedHide));var f=n.getCancelPinnedPanel({logId:r});var h=u.nextSibling;h.parentNode.insertBefore(f,h);n.centerCancelPinnedPanelElements({cancelPinnedPanel:f});f.setAttribute("bx-data-height",d);var v=f.getAttribute("bx-data-height");i.setStyle(f,{height:v+"px"});i.setStyle(u,{position:"absolute",width:"100%",height:d+"px",backgroundColor:"transparent",opacity:0});var m=n.getPanelNode();if(m){n.setOptions({panelHeight:m.offsetHeight})}setTimeout(function(){u.classList.add("".concat(n.class.postHide));i.setStyle(f,{height:"53px"});i.setStyle(u,{height:0,opacity:0});n.setOptions({pinBlocked:true})},100);a.Event.unbindAll(u,"transitionend");a.Event.bind(u,"transitionend",function(e){if(!n.checkTransitionProperty(e,"height")){return}a.Event.unbindAll(u,"transitionend");var t=c.querySelector(".".concat(n.class.panelPosts));t.insertBefore(u,t.firstChild);n.adjustCollapsedPostsPanel();u.classList.remove("".concat(n.class.postHide));l.classList.remove("".concat(n.class.postPinnedHide));n.adjustPanel();n.showCollapsedPostsPanel();setTimeout(function(){l.classList.add("".concat(n.class.postPinned));i.setStyle(u,{position:"",width:"",height:"80px",backgroundColor:"",opacity:1});n.setOptions({pinBlocked:false});setTimeout(function(){u.classList.remove("".concat(n.class.postHide));i.setStyle(u,{position:"",width:"",height:"",backgroundColor:"",opacity:""})},600)},300)});return e()})}else{var p=u.getAttribute("bx-data-height");var f=u.scrollHeight;i.setStyle(u,{transition:""});var h=document.querySelector(".".concat(n.class.cancelPanel,'[bx-data-log-id="').concat(r,'"]'));if(a.Type.isDomNode(h)){i.setStyle(u,{height:f+"px"});requestAnimationFrame(function(){u.classList.add("".concat(n.class.postExpanding));h.classList.add("".concat(n.class.postExpanding));i.setStyle(u,{opacity:0,height:0});i.setStyle(h,{opacity:0,height:0})});var v=c.classList.contains("".concat(n.class.panelCollapsed));if(v){h.parentNode.insertBefore(u,h.nextSibling);n.adjustCollapsedPostsPanel();n.adjustPanel()}var m=n.getCollapsedPanelNode().classList.contains("".concat(n.class.collapsedPanelShow));if(m){n.hideCollapsedPostsPanel();a.Event.unbindAll(h,"transitionend");a.Event.bind(h,"transitionend",function(e){if(!n.checkTransitionProperty(e,"height")){return}i.setStyle(u,{transform:"",display:"block"});n.animateCancel({post:l,postToMove:u,cancelPinnedPanel:h,height:p})})}a.Event.unbindAll(u,"transitionend");a.Event.bind(u,"transitionend",function(e){if(!n.checkTransitionProperty(e,"opacity")){return}if(!v){h.parentNode.insertBefore(u,h.nextSibling);n.adjustCollapsedPostsPanel();n.adjustPanel()}n.animateCancel({post:l,postToMove:u,cancelPinnedPanel:h,height:p})})}else{l.classList.remove("".concat(n.class.postPinned));c.parentNode.insertBefore(u,c.nextSibling);n.adjustPanel();var g=u.scrollHeight;u.setAttribute("bx-data-height",g);i.setStyle(u,{opacity:0,height:"80px"});setTimeout(function(){i.setStyle(u,{opacity:1,height:g+"px"})},100);a.Event.unbindAll(u,"transitionend");a.Event.bind(u,"transitionend",function(e){if(!n.checkTransitionProperty(e,"height")){return}i.setStyle(u,{height:""})})}return e()}})}},{key:"animateCancel",value:function e(t){var n=this;var s=t.post,o=t.postToMove,l=t.cancelPinnedPanel,r=t.height;s.classList.remove("".concat(this.class.postPinned));setTimeout(function(){i.setStyle(o,{opacity:1,height:r+"px"});i.setStyle(l,{height:0});setTimeout(function(){l.remove()},100)},100);a.Event.unbindAll(o,"transitionend");a.Event.bind(o,"transitionend",function(e){if(!n.checkTransitionProperty(e,"height")){return}s.classList.remove("".concat(n.class.postPinnedHide));i.setStyle(o,{marginBottom:"",height:""});i.setStyle(l,{marginBottom:"",height:""});o.classList.remove("".concat(n.class.postExpanding));l.classList.remove("".concat(n.class.postExpanding))})}},{key:"getCancelPinnedPanel",value:function e(t){var n=this;var s=t.logId?parseInt(t.logId):0;if(s<=0){return null}var l=document.querySelector(".".concat(this.class.cancelPanel,'[bx-data-log-id="').concat(s,'"]'));if(!a.Type.isDomNode(l)){l=a.Tag.render(o(),this.class.cancelPanel,s,this.class.cancelPanelLabel,a.Loc.getMessage("SONET_EXT_LIVEFEED_PINNED_CANCEL_TITLE"),a.Loc.getMessage("SONET_EXT_LIVEFEED_PINNED_CANCEL_DESCRIPTION"),this.class.cancelPanelButton,a.Loc.getMessage("SONET_EXT_LIVEFEED_PINNED_CANCEL_BUTTON"));a.Event.bind(l.querySelector(".".concat(this.class.cancelPanelButton)),"click",function(){n.changePinned({logId:s,newState:"N"}).then(function(){i.setStyle(l,{opacity:0,height:0})})})}return l}},{key:"centerCancelPinnedPanelElements",value:function e(t){var n=t.cancelPinnedPanel;if(!a.Type.isDomNode(n)){return}setTimeout(function(){i.setStyle(n,{opacity:1})},100);i.setStyle(n.querySelector(".".concat(this.class.cancelPanelLabel)),{marginLeft:n.querySelector(".".concat(this.class.cancelPanelButton)).getBoundingClientRect().width+"px"})}},{key:"getPostsCount",value:function e(){var t=this.getPanelNode();return t?Array.from(t.getElementsByClassName("".concat(this.class.post))).length:0}},{key:"hidePinnedItems",value:function e(){var t=this;var n=this.getPanelNode();if(!n){return}i.setStyle(n,{height:parseInt(this.getOption("panelHeight"))+"px"});Array.from(n.getElementsByClassName("".concat(this.class.post))).reduce(function(e,s){e+=s.offsetHeight;i.setStyle(s,{transition:"opacity .1s linear, transform .2s .1s linear, height .5s linear"});i.setStyle(n,{transition:"height .5s .1s linear"});requestAnimationFrame(function(){i.setStyle(s,{opacity:"0!important",transform:"translateY(-".concat(e,"px)")});i.setStyle(n,{height:"58px"})});a.Event.unbindAll(s,"transitionend");a.Event.bind(s,"transitionend",function(e){if(!t.checkTransitionProperty(e,"transform")){return}i.setStyle(s,{display:"none",opacity:"",transform:"",transition:""});i.setStyle(n,{transition:""})});return e},0)}},{key:"showPinnedItems",value:function e(){var t=this;var n=this.getPanelNode();if(!n){return}Array.from(n.getElementsByClassName("".concat(this.class.post))).map(function(e,s,o){i.setStyle(e,{display:"block",opacity:0});requestAnimationFrame(function(){i.setStyle(n,{height:84*(s+1)-4+"px"});i.setStyle(e,{transform:"translateY(".concat(0,"px)"),opacity:1})});a.Event.unbindAll(e,"transitionend");a.Event.bind(e,"transitionend",function(a){if(!t.checkTransitionProperty(a,"transform")){return}i.setStyle(e,{display:"block",height:"",transform:""});i.setStyle(n,{height:""});if(s+1===o.length){i.setStyle(n,{transition:"",height:""})}})})}},{key:"animateCollapsedPanel",value:function e(){var t=this;requestAnimationFrame(function(){var e=t.getCollapsedPanelNode();i.setStyle(e,{position:"absolute",top:0,width:"100%",opacity:0});e.classList.remove("".concat(t.class.collapsedPanelHide));e.classList.add("".concat(t.class.collapsedPanelShow));requestAnimationFrame(function(){i.setStyle(e,{position:"relative",opacity:1})})})}},{key:"adjustCollapsedPostsPanel",value:function e(){var t=this;var n=this.getPostsCount();var a=this.getCollapsedPanelNode().querySelector(".".concat(this.class.collapsedPanelCounterPostsValue));if(a){a.innerHTML=parseInt(n)}var s=this.getCollapsedPanelNode().querySelector(".".concat(this.class.collapsedPanelCounterComments));var i=this.getCollapsedPanelNode().querySelector(".".concat(this.class.collapsedPanelCounterCommentsValue));var o=this.getPanelNode();if(s&&i&&o){var l=Array.from(o.querySelectorAll(".".concat(this.class.collapsedPanelCounterCommentsValueNewValue))).reduce(function(e,n){return e+(n.closest(".".concat(t.class.postUnfollowed))?0:parseInt(n.innerHTML))},0);i.innerHTML=l;if(l>0){s.classList.add("".concat(this.class.collapsedPanelCounterCommentsShown))}else{s.classList.remove("".concat(this.class.collapsedPanelCounterCommentsShown))}}}},{key:"adjustPanel",value:function e(){var t=this;var n=this.getPanelNode();if(!n){return}setTimeout(function(){if(t.getPostsCount()>0){n.classList.add("".concat(t.class.panelNonEmpty))}else{n.classList.remove("".concat(t.class.panelNonEmpty))}},0)}},{key:"showCollapsedPostsPanel",value:function e(){if(this.getPostsCount()>=a.Loc.getMessage("SONET_EXT_LIVEFEED_COLLAPSED_PINNED_PANEL_ITEMS_LIMIT")){this.showCollapsedPanel();this.hidePinnedItems()}}},{key:"hideCollapsedPostsPanel",value:function e(){if(this.getPostsCount()<a.Loc.getMessage("SONET_EXT_LIVEFEED_COLLAPSED_PINNED_PANEL_ITEMS_LIMIT")){this.getPanelNode().classList.remove("".concat(this.class.panelCollapsed));this.removeCollapsedPanel();this.showPinnedItems()}}},{key:"showCollapsedPanel",value:function e(){this.getPanelNode().classList.add("".concat(this.class.panelCollapsed));this.animateCollapsedPanel()}},{key:"hideCollapsedPanel",value:function e(){this.getPanelNode().classList.remove("".concat(this.class.panelCollapsed));this.showPinnedItems();this.removeCollapsedPanel()}},{key:"removeCollapsedPanel",value:function e(){var t=this.getCollapsedPanelNode();i.setStyle(t,{position:"absolute",top:0,width:"100%"});t.classList.remove("".concat(this.class.collapsedPanelShow));t.classList.add("".concat(this.class.collapsedPanelHide))}},{key:"getCommentsNodes",value:function e(t){var n={follow:true,newNode:null,newValueNode:null,oldNode:null,allNode:null};if(!a.Type.isStringFilled(t)){return n}var s=document.querySelector(".".concat(this.class.postComments,'[data-bx-comments-entity-xml-id="').concat(t,'"]'));if(!s){return n}var i=s.closest(".".concat(this.class.postPinActive));if(!i){return n}var o=i.querySelector(".".concat(this.class.collapsedPanelCounterCommentsValueNew));var l=i.querySelector(".".concat(this.class.collapsedPanelCounterCommentsValueNewValue));var r=i.querySelector(".".concat(this.class.collapsedPanelCounterCommentsValueOld));var c=i.querySelector(".".concat(this.class.collapsedPanelCounterCommentsValueAll));if(!o||!l||!r||!c){return n}n.newNode=o;n.newValueNode=l;n.oldNode=r;n.allNode=c;n.follow=s.getAttribute("data-bx-follow")!=="N";return n}},{key:"getCommentsData",value:function e(t){var n={newValue:null,oldValue:null,allValue:null};if(!a.Type.isStringFilled(t)){return n}var s=this.getCommentsNodes(t),i=s.newValueNode,o=s.oldNode,l=s.allNode,r=s.follow;n.follow=r;if(!a.Type.isDomNode(i)||!a.Type.isDomNode(o)){return n}var c=0;var u=0;var d=0;var p=i.innerHTML.match(/(\d+)/);if(p){c=parseInt(p[1])}p=o.innerHTML.match(/(\d+)/);if(p){u=parseInt(p[1])}p=l.innerHTML.match(/(\d+)/);if(p){d=parseInt(p[1])}n.oldValue=u;n.newValue=c;n.allValue=d;return n}},{key:"setCommentsData",value:function e(t,n){if(!a.Type.isStringFilled(t)){return}var s=this.getCommentsNodes(t),i=s.newNode,o=s.newValueNode,l=s.oldNode,r=s.allNode;if(!a.Type.isDomNode(i)||!a.Type.isDomNode(o)||!a.Type.isDomNode(l)||!a.Type.isDomNode(r)){return}if(a.Type.isInteger(n.newValue)){o.innerHTML="".concat(n.newValue);if(n.newValue>0&&!i.classList.contains("".concat(this.class.collapsedPanelCounterCommentsValueNewActive))){i.classList.add("".concat(this.class.collapsedPanelCounterCommentsValueNewActive))}else if(n.newValue<=0&&i.classList.contains("".concat(this.class.collapsedPanelCounterCommentsValueNewActive))){i.classList.remove("".concat(this.class.collapsedPanelCounterCommentsValueNewActive))}}if(a.Type.isInteger(n.oldValue)){l.innerHTML=n.oldValue}if(a.Type.isInteger(n.allValue)){r.innerHTML=n.allValue}this.adjustCollapsedPostsPanel()}},{key:"getCollapsedPanelNode",value:function e(){return this.getPanelNode().querySelector(".".concat(this.class.collapsedPanel))}},{key:"checkTransitionProperty",value:function e(t,n){return t.propertyName===n}}]);return e}();function r(){var e=babelHelpers.taggedTemplateLiteral(["<div>","</div>"]);r=function t(){return e};return e}var c=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"showBackgroundWarning",value:function e(s){var i=s.urlToEdit,o=s.menuPopupWindow;var l=a.Tag.render(r(),a.Loc.getMessage("SONET_EXT_LIVEFEED_POST_BACKGROUND_EDIT_WARNING_DESCRIPTION"));var c=new t.Popup("create id here",null,{autoHide:true,closeByEsc:true,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:a.Loc.getMessage("SONET_EXT_LIVEFEED_POST_BACKGROUND_EDIT_WARNING_TITLE"),closeIcon:true,className:"sonet-livefeed-popup-warning",content:l,events:{},cacheable:false,buttons:[new n.Button({text:a.Loc.getMessage("SONET_EXT_LIVEFEED_POST_BACKGROUND_EDIT_WARNING_BUTTON_SUBMIT"),className:"ui-btn ui-btn-primary",events:{click:function e(){window.location=i;c.close();if(o){o.close()}}}}),new n.Button({text:a.Loc.getMessage("SONET_EXT_LIVEFEED_POST_BACKGROUND_EDIT_WARNING_BUTTON_CANCEL"),className:"ui-btn ui-btn-light",events:{click:function e(){c.close();if(o){o.close()}}}})]});c.show();return false}}]);return e}();var u=function(){function e(){babelHelpers.classCallCheck(this,e);this.container=null;this.wrap=null;this.plus=null;this.value=null;this.currentSiteId=null;this.currentCounterType=null;this.counterDecrementStack=0;this.counterValue=0;this.lockCounterAnimation=null;this.class={informerFixed:"feed-new-message-informer-fixed",informerAnimation:"feed-new-message-informer-anim",informerFixedAnimation:"feed-new-message-informer-fix-anim",counterText:"feed-new-message-inf-text",counterContainer:"feed-new-message-inf-text-counter",reloadContainer:"feed-new-message-inf-text-reload",icon:"feed-new-message-icon",iconRotating:"new-message-balloon-icon-rotating",plusHidden:"feed-new-message-informer-counter-plus-hidden"}}babelHelpers.createClass(e,[{key:"init",value:function e(){this.initNodes();this.initEvents()}},{key:"initNodes",value:function e(){this.currentCounterType=a.Loc.getMessage("sonetLCounterType")?a.Loc.getMessage("sonetLCounterType"):"**";this.currentSiteId=a.Loc.getMessage("SITE_ID");this.container=document.getElementById("sonet_log_counter_2_container");if(this.container){this.container.addEventListener("click",this.showReloadAnimation.bind(this))}this.wrap=document.getElementById("sonet_log_counter_2_wrap");this.plus=document.getElementById("sonet_log_counter_2_plus");this.value=document.getElementById("sonet_log_counter_2")}},{key:"initEvents",value:function e(){var t=this;s.EventEmitter.subscribe("onGoUp",function(e){t.unfixWrap()});s.EventEmitter.subscribe("onPullEvent-main",function(e){var n=e.getData(),s=babelHelpers.slicedToArray(n,2),i=s[0],o=s[1];if(i!=="user_counter"||!o[t.currentSiteId]||!o[t.currentSiteId][t.currentCounterType]){return}t.changeCounter(a.Runtime.clone(o[t.currentSiteId][t.currentCounterType]))});s.EventEmitter.subscribe("onImUpdateCounter",function(e){var n=e.getData(),s=babelHelpers.slicedToArray(n,1),i=s[0];if(!a.Type.isObjectLike(i)||a.Type.isUndefined(i[t.currentCounterType])){return}t.changeCounter(i[t.currentCounterType])});s.EventEmitter.subscribe("OnUCCommentWasRead",function(e){var n=e.getData(),i=babelHelpers.slicedToArray(n,3),o=i[0],l=i[1],r=i[2];if(!a.Type.isObjectLike(r)||!r.live||!r.new){return}s.EventEmitter.emit("onCounterDecrement",new s.BaseEvent({compatData:[1]}));t.decrementCounter(1)})}},{key:"changeCounter",value:function e(t){this.counterValue=parseInt(t);if(this.counterValue<=0){this.decrementStack=0}var n=this.counterValue-this.counterDecrementStack;this.changeAnimate({show:n>0,counter:n,zeroCounterFromDb:n<=0})}},{key:"changeAnimate",value:function e(t){var n=this;var a=!!t.show;var s=parseInt(t.counter);var i=!!t.zeroCounterFromDb;if(!this.container){return}var o=this.container.querySelector("span.".concat(this.class.counterText));var l=this.container.querySelector("span.".concat(this.class.reloadContainer));if(this.lockCounterAnimation){setTimeout(function(){n.changeAnimate({show:a,counter:s})},200);return false}if(a){if(this.value){this.value.innerHTML=s}this.showWrapAnimation();if(this.plus&&l&&l.style.display!=="none"&&o){l.style.display="none";o.style.display="inline-block";this.plus.classList.remove("".concat(this.class.plusHidden))}}else if(this.wrap){if(i&&this.wrap.classList.contains("".concat(this.class.informerAnimation))){if(o&&l){o.style.display="none";l.style.display="inline-block";this.hideReloadAnimation()}}else{setTimeout(function(){n.hideWrapAnimation()},400)}}}},{key:"showWrapAnimation",value:function e(){if(!this.wrap){return}this.wrap.style.visibility="visible";this.wrap.classList.add("".concat(this.class.informerAnimation))}},{key:"hideWrapAnimation",value:function e(){if(!this.wrap){return}this.wrap.classList.remove("".concat(this.class.informerAnimation));this.wrap.style.visibility="hidden"}},{key:"showReloadAnimation",value:function e(){if(!this.container){return}var t=this.container.querySelector("span.".concat(this.class.icon));if(t){t.classList.add(this.class.iconRotating)}}},{key:"hideReloadAnimation",value:function e(){if(!this.container){return}var t=this.container.querySelector("span.".concat(this.class.icon));if(t){t.classList.remove(this.class.iconRotating)}}},{key:"onFeedScroll",value:function e(){if(!this.container||!this.wrap){return}var t=this.wrap.parentNode.getBoundingClientRect().top;var n=this.container.getBoundingClientRect();if(t<=0){if(!this.wrap.classList.contains("".concat(this.class.informerFixed))){this.container.style.left="".concat(n.left+n.width/2,"px")}this.fixWrap()}else{this.unfixWrap();this.container.style.left="auto"}}},{key:"fixWrap",value:function e(){if(!this.wrap){return}this.wrap.classList.add("".concat(this.class.informerFixed),"".concat(this.class.informerFixedAnimation))}},{key:"unfixWrap",value:function e(){if(!this.wrap){return}this.wrap.classList.remove("".concat(this.class.informerFixed),"".concat(this.class.informerFixedAnimation))}},{key:"recover",value:function e(){if(!this.container){return}var t=this.container.querySelector("span.".concat(this.class.counterContainer));if(!t){return}t.style.display="inline-block";this.hideReloadNode();if(this.plus){this.plus.classList.add("".concat(this.class.plusHidden))}}},{key:"hideReloadNode",value:function e(){if(!this.container){return}var t=this.container.querySelector("span.".concat(this.class.reloadContainer));if(!t){return}t.style.display="none"}},{key:"decrementCounter",value:function e(t){this.counterDecrementStack+=parseInt(t);if(!this.value){return}var n=this.counterValue-this.counterDecrementStack;if(n>0){this.value.innerHTML=n}else{this.changeAnimate({show:false,counter:0})}}}]);return e}();var d=function(){function t(){babelHelpers.classCallCheck(this,t);this.entryData={};this.feedInitialized=false}babelHelpers.createClass(t,[{key:"init",value:function t(){if(this.feedInitialized){return}e.PinnedPanelInstance.init();e.InformerInstance.init();this.feedInitialized=true}},{key:"changeFollow",value:function e(t){var n=this;var s=t.logId?parseInt(t.logId):0;if(!s){return false}var i=document.getElementById("log_entry_follow_"+s);var o=i&&i.getAttribute("data-follow")==="Y"?"Y":"N";var l=o==="Y"?"N":"Y";this.renderFollow({logId:s,value:l});a.ajax.runAction("socialnetwork.api.livefeed.changeFollow",{data:{logId:s,value:l},analyticsLabel:{b24statAction:l==="Y"?"setFollow":"setUnfollow"}}).then(function(e){if(!e.data.success){n.renderFollow({logId:s,value:o})}},function(){n.renderFollow({logId:s,value:o})});return false}},{key:"renderFollow",value:function e(t){var n=t.logId?parseInt(t.logId):0;if(!n){return}var s=document.getElementById("log_entry_follow_"+n);var i=t.value&&t.value==="Y"?"Y":"N";if(s){s.setAttribute("data-follow",i)}var o=s?s.querySelector("a"):null;if(o){o.innerHTML=a.Loc.getMessage("SONET_EXT_LIVEFEED_FOLLOW_TITLE_"+i)}var l=s?s.closest(".feed-post-block"):null;if(l){if(i==="N"){l.classList.add("feed-post-block-unfollowed")}else if(i==="Y"){l.classList.remove("feed-post-block-unfollowed")}}}},{key:"changeFavorites",value:function e(t){var n=this;var s=t.logId?parseInt(t.logId):0;var i=t.event?t.event:null;var o=t.node?t.node:null;var l=t.newState?t.newState:null;if(a.Type.isStringFilled(o)){o=document.getElementById(o)}if(!s){return}var r=null;if(i){r=i.target;if(!r.classList.contains("menu-popup-item-text")){r=r.querySelector(".menu-popup-item-text")}}var c=null;if(a.Type.isDomNode(o)){c=o.classList.contains("feed-post-important-switch")?o:o.querySelector(".feed-post-important-switch")}if(typeof this.entryData[s]=="undefined"){this.entryData[s]={}}if(typeof this.entryData[s].favorites!="undefined"){l=this.entryData[s].favorites?"N":"Y";this.entryData[s].favorites=!this.entryData[s].favorites}else if(c){l=c.classList.contains("feed-post-important-switch-active")?"N":"Y";this.entryData[s].favorites=l=="Y"}if(!l){return}this.adjustFavoritesControlItem(c,l);this.adjustFavoritesMenuItem(r,l);a.ajax.runAction("socialnetwork.api.livefeed.changeFavorites",{data:{logId:s,value:l},analyticsLabel:{b24statAction:l=="Y"?"addFavorites":"removeFavorites"}}).then(function(e){if(a.Type.isStringFilled(e.data.newValue)&&["Y","N"].includes(e.data.newValue)){n.entryData[s].favorites=e.data.newValue=="Y"}n.adjustFavoritesControlItem(c,e.data.newValue);n.adjustFavoritesMenuItem(r,e.data.newValue)},function(e){n.entryData[s].favorites=!n.entryData[s].favorites})}},{key:"adjustFavoritesMenuItem",value:function e(t,n){if(!a.Type.isDomNode(t)||!["Y","N"].includes(n)){return}t.innerHTML=this.getMenuTitle(n==="Y")}},{key:"adjustFavoritesControlItem",value:function e(t,n){if(!a.Type.isDomNode(t)||!["Y","N"].includes(n)){return}t.title=this.getMenuTitle(n==="Y");if(n=="Y"){t.classList.add("feed-post-important-switch-active")}else{t.classList.remove("feed-post-important-switch-active")}}},{key:"getMenuTitle",value:function e(t){return a.Loc.getMessage("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_".concat(t?"Y":"N"))}}]);return t}();e.FeedInstance=null;e.PinnedPanelInstance=null;e.PostInstance=null;e.InformerInstance=null;a.Event.ready(function(){e.FeedInstance=new d;e.PinnedPanelInstance=new l;e.PostInstance=new c;e.InformerInstance=new u})})(this.BX.Livefeed=this.BX.Livefeed||{},BX.Main,BX.UI,BX,BX.Event);
//# sourceMappingURL=livefeed.bundle.map.js