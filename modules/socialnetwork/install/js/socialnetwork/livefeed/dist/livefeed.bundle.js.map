{"version":3,"file":"livefeed.bundle.js","sources":["../src/pinned.js","../src/feed.js"],"sourcesContent":["import { ajax, Event, Type, Loc, Dom } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MenuManager } from 'main.popup';\n\nclass PinnedPanel\n{\n\tconstructor()\n\t{\n\t\tthis.panelInitialized = false;\n\t\tthis.postsInitialized = false;\n\t\tthis.handlePostClick = this.handlePostClick.bind(this);\n\n\t\tthis.init();\n\t}\n\n\tresetFlags()\n\t{\n\t\tthis.panelInitialized = false;\n\t\tthis.postsInitialized = false;\n\t}\n\n\tinit()\n\t{\n\t\tthis.initPanel();\n\t\tthis.initPosts();\n\t\tthis.initEvents();\n\t\tEventEmitter.subscribe('onFrameDataProcessed', () => {\n\t\t\tthis.initPanel();\n\t\t\tthis.initPosts();\n\t\t});\n\t}\n\n\tinitPanel()\n\t{\n\t\tif (this.panelInitialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst pinnedPanelNode = this.getPanelNode();\n\t\tif (!pinnedPanelNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.panelInitialized = true;\n\n\t\tEvent.bind(pinnedPanelNode, 'click', (event) => {\n\t\t\tconst likeClicked = event.target.classList.contains('feed-inform-ilike') || event.target.closest('.feed-inform-ilike') !== null;\n\t\t\tconst followClicked = event.target.classList.contains('feed-inform-follow') || event.target.closest('.feed-inform-follow') !== null;\n\t\t\tconst menuClicked = (\n\t\t\t\tevent.target.classList.contains('feed-post-more-link')\n\t\t\t\t|| event.target.closest('.feed-post-more-link') !== null\n\t\t\t\t|| event.target.classList.contains('feed-post-right-top-menu')\n\t\t\t);\n\t\t\tconst contentViewClicked = event.target.classList.contains('feed-inform-contentview') || event.target.closest('.feed-inform-contentview') !== null;\n\t\t\tconst pinClicked = event.target.classList.contains('feed-post-pin') || event.target.closest('.feed-post-pin') !== null;\n\t\t\tconst collapseClicked = event.target.classList.contains('feed-post-pinned-link-collapse');\n\t\t\tconst commentsClicked = event.target.classList.contains('feed-inform-comments-pinned') || event.target.closest('.feed-inform-comments-pinned') !== null;\n\n\t\t\tlet postNode = null;\n\n\t\t\tif (event.target.classList.contains('feed-post-block'))\n\t\t\t{\n\t\t\t\tpostNode = event.target;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tpostNode = event.target.closest('.feed-post-block');\n\t\t\t}\n\n\t\t\tif (!postNode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (postNode.classList.contains('feed-post-block-pinned'))\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\t!likeClicked\n\t\t\t\t\t&& !followClicked\n\t\t\t\t\t&& !menuClicked\n\t\t\t\t\t&& !contentViewClicked\n\t\t\t\t\t&& !pinClicked\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tpostNode.classList.remove('feed-post-block-pinned');\n\n\t\t\t\t\tconst menuId = postNode.getAttribute('data-menu-id');\n\n\t\t\t\t\tif (menuId)\n\t\t\t\t\t{\n\t\t\t\t\t\tMenuManager.destroy(menuId);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst event = new BaseEvent({\n\t\t\t\t\t\tcompatData: [{\n\t\t\t\t\t\t\trootNode: postNode\n\t\t\t\t\t\t}],\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\trootNode: postNode\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tEventEmitter.emit('BX.Livefeed:recalculateComments', event);\n\t\t\t\t}\n\n\t\t\t\tif (commentsClicked)\n\t\t\t\t{\n\t\t\t\t\tconst anchorNode = postNode.querySelector('.feed-comments-block a[name=comments]');\n\n\t\t\t\t\tif (anchorNode)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst position = Dom.getPosition(anchorNode);\n\t\t\t\t\t\twindow.scrollTo(0, position.top - 200);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\telse if (collapseClicked)\n\t\t\t{\n\t\t\t\tpostNode.classList.add('feed-post-block-pinned');\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t});\n\t}\n\n\tinitPosts()\n\t{\n\t\tif (this.postsInitialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst postList = document.querySelectorAll('[data-livefeed-post-pinned]');\n\t\tif (postList.length > 0)\n\t\t{\n\t\t\tthis.postsInitialized = true;\n\t\t}\n\n\t\tArray.from(postList).forEach((post) => {\n\t\t\tEvent.unbind(post, 'click', this.handlePostClick);\n\t\t\tEvent.bind(post, 'click', this.handlePostClick);\n\t\t});\n\t}\n\n\thandlePostClick(event)\n\t{\n\t\tif (!event.target.classList.contains('feed-post-pin'))\n\t\t{\n\t\t\treturn\n\t\t}\n\n\t\tconst post = event.target.closest('[data-livefeed-id]');\n\n\t\tif (!post)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newState = (post.getAttribute('data-livefeed-post-pinned') === 'Y' ? 'N' : 'Y');\n\t\tconst logId = parseInt(post.getAttribute('data-livefeed-id'));\n\n\t\tif (logId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.changePinned({\n\t\t\tlogId: logId,\n\t\t\tnewState: newState,\n\t\t\tevent: event\n\t\t});\n\t}\n\n\tinitEvents()\n\t{\n\t\tEventEmitter.subscribe('OnUCCommentWasRead', (event: BaseEvent) =>\n\t\t{\n\t\t\tconst [ xmlId, id, options ] = event.getData();\n\t\t\tconst { oldValue, newValue } = this.getCommentsData(xmlId);\n\n\t\t\tif (!!options.new)\n\t\t\t{\n\t\t\t\tthis.setCommentsData(xmlId, {\n\t\t\t\t\tnewValue: (Type.isInteger(newValue) ? (newValue - 1) : 0),\n\t\t\t\t\toldValue: (Type.isInteger(oldValue) ? (oldValue + 1) : 1)\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('OnUCCommentWasPulled', (event: BaseEvent) =>\n\t\t{\n\t\t\tconst [ id, data, params ] = event.getData();\n\t\t\tconst [ xmlId, commentId ] = id;\n\t\t\tconst { newValue, oldValue, follow } = this.getCommentsData(xmlId);\n\n\t\t\tif (\n\t\t\t\tparseInt(params.AUTHOR.ID) !== parseInt(BX.message('USER_ID'))\n\t\t\t\t&& follow\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.setCommentsData(xmlId, {newValue: (Type.isInteger(newValue) ? (newValue + 1) : 1)});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setCommentsData(xmlId, {oldValue: (Type.isInteger(oldValue) ? (oldValue + 1) : 1)});\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('OnUCommentWasDeleted', (event: BaseEvent) =>\n\t\t{\n\t\t\tconst [ xmlId, id, data ] = event.getData();\n\t\t\tconst { oldValue } = this.getCommentsData(xmlId);\n\n\t\t\tthis.setCommentsData(xmlId, {oldValue: (Type.isInteger(oldValue) ? (oldValue - 1) : 0)});\n\t\t});\n\t}\n\n\tchangePinned(params)\n\t{\n\t\tconst logId = (params.logId ? parseInt(params.logId) : 0);\n\t\tconst node = (params.node ? params.node : null);\n\t\tconst event = (params.event ? params.event : null);\n\n\t\tlet newState = (params.newState ? params.newState : null);\n\n\t\tif (\n\t\t\t!logId\n\t\t\t|| !newState\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setPostState({\n\t\t\tnode: (node ? node : event.target),\n\t\t\tstate: newState\n\t\t});\n\n\t\tajax.runAction('socialnetwork.api.livefeed.logentry.' + (newState === 'Y' ? 'pin' : 'unpin'), {\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tlogId: logId\n\t\t\t\t}\n\t\t\t},\n\t\t\tanalyticsLabel: {\n\t\t\t\tb24statAction: (newState === 'Y' ? 'pinLivefeedEntry' : 'unpinLivefeedEntry')\n\t\t\t}\n\t\t}).then(response => {\n\t\t\tif (!response.data.success)\n\t\t\t{\n\t\t\t\tthis.setPostState({\n\t\t\t\t\tnode: (node ? node : event.target),\n\t\t\t\t\tstate: (newState === 'Y' ? 'N' : 'Y')\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.movePost({\n\t\t\t\t\tnode: (node ? node : event.target),\n\t\t\t\t\tstate: newState\n\t\t\t\t});\n\t\t\t}\n\t\t}, response => {\n\t\t\tthis.setPostState({\n\t\t\t\tnode: (node ? node : event.target),\n\t\t\t\tstate: (newState === 'Y' ? 'N' : 'Y')\n\t\t\t});\n\t\t});\n\t}\n\n\tsetPostState(params)\n\t{\n\t\tconst state = (params.state ? params.state : null);\n\t\tconst node = (params.node ? params.node : null);\n\n\t\tif (\n\t\t\t!node\n\t\t\t|| !['Y', 'N'].includes(state)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst post = node.closest('[data-livefeed-post-pinned]');\n\t\tif (!post)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpost.setAttribute('data-livefeed-post-pinned', state);\n\n\t\tif (state === 'Y')\n\t\t{\n\t\t\tpost.classList.add('feed-post-block-pin-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpost.classList.remove('feed-post-block-pin-active');\n\t\t}\n\t}\n\n\tgetPanelNode()\n\t{\n\t\treturn document.querySelector('[data-livefeed-pinned-panel]');\n\t}\n\n\tgetPinnedData(params)\n\t{\n\t\tconst logId = (params.logId ? parseInt(params.logId) : 0);\n\n\t\tif (logId <= 0)\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction('socialnetwork.api.livefeed.logentry.getPinData', {\n\t\t\t\tdata: {\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tlogId: logId\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).then(response => {\n\t\t\t\tresolve(response.data);\n\t\t\t}, response => {\n\t\t\t\treject();\n\t\t\t});\n\t\t})\n\t}\n\n\tmovePost(params)\n\t{\n\t\tconst state = (params.state ? params.state : null);\n\t\tconst node = (params.node ? params.node : null);\n\n\t\tif (\n\t\t\t!node\n\t\t\t|| !['Y', 'N'].includes(state)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst post = node.closest('[data-livefeed-post-pinned]');\n\t\tif (!post)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst logId = parseInt(post.getAttribute('data-livefeed-id'));\n\t\tif (!logId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst pinnedPanelNode = this.getPanelNode();\n\t\tif (!pinnedPanelNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst postToMove = (post.parentNode.classList.contains('feed-item-wrap') ? post.parentNode : post);\n\n\t\tif (state === 'Y')\n\t\t{\n\t\t\tthis.getPinnedData({\n\t\t\t\tlogId: logId\n\t\t\t}).then(data => {\n\n\t\t\t\tconst pinnedPanelTitleNode = post.querySelector('.feed-post-pinned-title');\n\t\t\t\tconst pinnedPanelDescriptionNode = post.querySelector('.feed-post-pinned-desc');\n\t\t\t\tconst pinnedPanelPinNode = post.querySelector('.feed-post-pin');\n\n\t\t\t\tif (pinnedPanelTitleNode)\n\t\t\t\t{\n\t\t\t\t\tpinnedPanelTitleNode.innerHTML = data.TITLE;\n\t\t\t\t}\n\t\t\t\tif (pinnedPanelDescriptionNode)\n\t\t\t\t{\n\t\t\t\t\tpinnedPanelDescriptionNode.innerHTML = data.DESCRIPTION;\n\t\t\t\t}\n\t\t\t\tif (pinnedPanelPinNode)\n\t\t\t\t{\n\t\t\t\t\tpinnedPanelPinNode.title = Loc.getMessage('SONET_EXT_LIVEFEED_PIN_TITLE_Y');\n\t\t\t\t}\n\n\t\t\t\tpost.classList.add('feed-post-block-pinned');\n\t\t\t\tpinnedPanelNode.insertBefore(postToMove, pinnedPanelNode.firstChild);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpost.classList.remove('feed-post-block-pinned');\n\t\t\tpinnedPanelNode.parentNode.insertBefore(postToMove, pinnedPanelNode.nextSibling);\n\t\t}\n\t}\n\n\tgetCommentsNodes(xmlId)\n\t{\n\t\tconst result = {\n\t\t\tfollow: true,\n\t\t\tnewNode: null,\n\t\t\toldNode: null\n\t\t};\n\n\t\tif (!Type.isStringFilled(xmlId))\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tconst commentsNode = document.querySelector(`.feed-comments-block[data-bx-comments-entity-xml-id=\"${xmlId}\"]`);\n\t\tif (!commentsNode)\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tconst postNode = commentsNode.closest('.feed-post-block-pin-active');\n\t\tif (!postNode)\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tconst newPinnedCommentsNode = postNode.querySelector('.feed-inform-comments-pinned-new');\n\t\tconst oldPinnedCommentsNode = postNode.querySelector('.feed-inform-comments-pinned-old');\n\n\t\tif (\n\t\t\t!newPinnedCommentsNode\n\t\t\t|| !oldPinnedCommentsNode\n\t\t)\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tresult.newNode = newPinnedCommentsNode;\n\t\tresult.oldNode = oldPinnedCommentsNode;\n\t\tresult.follow = (commentsNode.getAttribute('data-bx-follow') !== 'N');\n\n\t\treturn result;\n\t}\n\n\tgetCommentsData(xmlId)\n\t{\n\t\tconst result = {\n\t\t\tnewValue: null,\n\t\t\toldValue: null\n\t\t};\n\n\t\tif (!Type.isStringFilled(xmlId))\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tconst { newNode, oldNode, follow } = this.getCommentsNodes(xmlId);\n\n\t\tresult.follow = follow;\n\n\t\tif (\n\t\t\t!Type.isDomNode(newNode)\n\t\t\t|| !Type.isDomNode(oldNode)\n\t\t)\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tlet newCommentsValue = 0;\n\t\tlet oldCommentsValue = 0;\n\t\tlet matches = newNode.innerHTML.match(/\\+(\\d+)/);\n\n\t\tif (matches)\n\t\t{\n\t\t\tnewCommentsValue = parseInt(matches[1]);\n\t\t}\n\n\t\tmatches = oldNode.innerHTML.match(/(\\d+)/);\n\t\tif (matches)\n\t\t{\n\t\t\toldCommentsValue = parseInt(matches[1]);\n\t\t}\n\n\t\tresult.oldValue = oldCommentsValue;\n\t\tresult.newValue = newCommentsValue;\n\n\t\treturn result;\n\t}\n\n\tsetCommentsData(xmlId, value)\n\t{\n\t\tif (!Type.isStringFilled(xmlId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { newNode, oldNode } = this.getCommentsNodes(xmlId);\n\t\tif (\n\t\t\t!Type.isDomNode(newNode)\n\t\t\t|| !Type.isDomNode(oldNode)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isInteger(value.newValue))\n\t\t{\n\t\t\tnewNode.innerHTML = `+${value.newValue}`;\n\t\t\tif (\n\t\t\t\tvalue.newValue > 0\n\t\t\t\t&& !newNode.classList.contains('feed-inform-comments-pinned-new-active')\n\t\t\t)\n\t\t\t{\n\t\t\t\tnewNode.classList.add('feed-inform-comments-pinned-new-active');\n\t\t\t}\n\t\t\telse if (\n\t\t\t\tvalue.newValue <= 0\n\t\t\t\t&& newNode.classList.contains('feed-inform-comments-pinned-new-active')\n\t\t\t)\n\t\t\t{\n\t\t\t\tnewNode.classList.remove('feed-inform-comments-pinned-new-active');\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isInteger(value.oldValue))\n\t\t{\n\t\t\toldNode.innerHTML = value.oldValue;\n\t\t}\n\t}\n}\n\nexport {\n\tPinnedPanel\n};","import {Type, Loc, ajax, Event} from \"main.core\";\nimport {PinnedPanel} from \"./pinned\";\n\nclass Feed\n{\n\tconstructor()\n\t{\n\t\tthis.init();\n\t\tthis.entryData = {};\n\t}\n\n\tinit()\n\t{\n\n\t}\n\n\tchangeFavorites(params)\n\t{\n\t\tconst logId = (params.logId ? parseInt(params.logId) : 0);\n\t\tconst event = (params.event ? params.event : null);\n\n\t\tlet node = (params.node ? params.node : null);\n\t\tlet newState = (params.newState ? params.newState : null);\n\n\t\tif (Type.isStringFilled(node))\n\t\t{\n\t\t\tnode = document.getElementById(node);\n\t\t}\n\n\t\tif (!logId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet menuItem = null;\n\n\t\tif (event)\n\t\t{\n\t\t\tmenuItem = event.target;\n\t\t\tif (!menuItem.classList.contains('menu-popup-item-text'))\n\t\t\t{\n\t\t\t\tmenuItem = menuItem.querySelector('.menu-popup-item-text');\n\t\t\t}\n\t\t}\n\n\t\tlet nodeToAdjust = null;\n\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\tnodeToAdjust = (\n\t\t\t\tnode.classList.contains('feed-post-important-switch')\n\t\t\t\t\t? node\n\t\t\t\t\t: node.querySelector('.feed-post-important-switch')\n\t\t\t);\n\t\t}\n\n\t\tif (typeof this.entryData[logId] == 'undefined')\n\t\t{\n\t\t\tthis.entryData[logId] = {};\n\t\t}\n\n\t\tif (typeof this.entryData[logId].favorites != 'undefined')\n\t\t{\n\t\t\tnewState = (this.entryData[logId].favorites ? 'N' : 'Y');\n\t\t\tthis.entryData[logId].favorites = !this.entryData[logId].favorites;\n\t\t}\n\t\telse if (nodeToAdjust)\n\t\t{\n\t\t\tnewState = (\n\t\t\t\tnodeToAdjust.classList.contains('feed-post-important-switch-active')\n\t\t\t\t\t? 'N'\n\t\t\t\t\t: 'Y'\n\t\t\t);\n\t\t\tthis.entryData[logId].favorites = (newState == 'Y');\n\t\t}\n\n\t\tif (!newState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.adjustFavoritesControlItem(nodeToAdjust, newState);\n\t\tthis.adjustFavoritesMenuItem(menuItem, newState);\n\n\t\tajax.runAction('socialnetwork.api.livefeed.changeFavorites', {\n\t\t\tdata: {\n\t\t\t\tlogId: logId,\n\t\t\t\tvalue: newState\n\t\t\t},\n\t\t\tanalyticsLabel: {\n\t\t\t\tb24statAction: (newState == 'Y' ? 'addFavorites' : 'removeFavorites')\n\t\t\t}\n\t\t}).then(response =>\n\t\t{\n\t\t\tif (\n\t\t\t\tType.isStringFilled(response.data.newValue)\n\t\t\t\t&& ['Y', 'N'].includes(response.data.newValue)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.entryData[logId].favorites = (response.data.newValue == 'Y');\n\t\t\t}\n\n\t\t\tthis.adjustFavoritesControlItem(nodeToAdjust, response.data.newValue);\n\t\t\tthis.adjustFavoritesMenuItem(menuItem, response.data.newValue);\n\n\t\t}, response => {\n\t\t\tthis.entryData[logId].favorites = !this.entryData[logId].favorites;\n\t\t});\n\t}\n\n\tadjustFavoritesMenuItem(menuItemNode, state)\n\t{\n\t\tif (\n\t\t\t!Type.isDomNode(menuItemNode)\n\t\t\t|| !['Y', 'N'].includes(state)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tmenuItemNode.innerHTML = this.getMenuTitle(state === 'Y');\n\t}\n\n\tadjustFavoritesControlItem(node, state)\n\t{\n\t\tif (\n\t\t\t!Type.isDomNode(node)\n\t\t\t|| !['Y', 'N'].includes(state)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnode.title = this.getMenuTitle(state === 'Y');\n\t\tif (state == 'Y')\n\t\t{\n\t\t\tnode.classList.add('feed-post-important-switch-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnode.classList.remove('feed-post-important-switch-active');\n\t\t}\n\t}\n\n\tgetMenuTitle(state: boolean): string\n\t{\n\t\treturn Loc.getMessage(`SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_${state ? 'Y' : 'N'}`);\n\t}\n}\n\nlet FeedInstance = null;\nlet PinnedPanelInstance = null;\n\nEvent.ready(() =>\n{\n\tFeedInstance = new Feed();\n\tPinnedPanelInstance = new PinnedPanel();\n});\n\nexport {\n\tFeedInstance,\n\tPinnedPanelInstance\n};"],"names":["PinnedPanel","panelInitialized","postsInitialized","handlePostClick","bind","init","initPanel","initPosts","initEvents","EventEmitter","subscribe","pinnedPanelNode","getPanelNode","Event","event","likeClicked","target","classList","contains","closest","followClicked","menuClicked","contentViewClicked","pinClicked","collapseClicked","commentsClicked","postNode","remove","menuId","getAttribute","MenuManager","destroy","BaseEvent","compatData","rootNode","data","emit","anchorNode","querySelector","position","Dom","getPosition","window","scrollTo","top","stopPropagation","preventDefault","add","postList","document","querySelectorAll","length","Array","from","forEach","post","unbind","newState","logId","parseInt","changePinned","getData","xmlId","id","options","getCommentsData","oldValue","newValue","new","setCommentsData","Type","isInteger","params","commentId","follow","AUTHOR","ID","BX","message","node","setPostState","state","ajax","runAction","analyticsLabel","b24statAction","then","response","success","movePost","includes","setAttribute","Promise","reject","resolve","postToMove","parentNode","getPinnedData","pinnedPanelTitleNode","pinnedPanelDescriptionNode","pinnedPanelPinNode","innerHTML","TITLE","DESCRIPTION","title","Loc","getMessage","insertBefore","firstChild","nextSibling","result","newNode","oldNode","isStringFilled","commentsNode","newPinnedCommentsNode","oldPinnedCommentsNode","getCommentsNodes","isDomNode","newCommentsValue","oldCommentsValue","matches","match","value","Feed","entryData","getElementById","menuItem","nodeToAdjust","favorites","adjustFavoritesControlItem","adjustFavoritesMenuItem","menuItemNode","getMenuTitle","FeedInstance","PinnedPanelInstance","ready"],"mappings":"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"}