(function(){var e=window.BX;if(e.SocNetLogDestination){return}e.SocNetLogDestination={popupWindow:null,popupSearchWindow:null,containerWindow:null,bByFocusEvent:false,bLoadAllInitialized:false,createSocNetGroupWindow:null,inviteEmailUserWindow:null,inviteEmailUserWindowSubmitted:false,inviteEmailCurrentName:null,sendEvent:true,extranetUser:false,obUseContainer:{},obShowSearchInput:{},obSendAjaxSearch:{},obUserNameTemplate:{},obCurrentElement:{last:null,search:null,group:false},obSearchFirstElement:null,obResult:{last:null,email:null,crmemail:null,search:null,group:false},obCursorPosition:{last:null,email:null,crmemail:null,search:null,group:false},obTabs:{},obCustomTabs:{},focusOnTabs:false,searchTimeout:null,createSonetGroupTimeout:null,obAllowAddSocNetGroup:{},obAllowAddUser:{},obAllowAddCrmContact:{},obAllowSearchEmailUsers:{},obAllowSearchCrmEmailUsers:{},obAllowSearchNetworkUsers:{},obAllowSearchSelf:{},obAllowSonetGroupsAjaxSearch:{},obAllowMailContactsAjaxSearch:{},obAllowSonetGroupsAjaxSearchFeatures:{},obEmptySearchResult:{},obNewSocNetGroupCnt:{},obEmailDescMode:{},obSearchOnlyWithEmail:{},obDepartmentEnable:{},obSonetgroupsEnable:{},obProjectsEnable:{},obLastEnable:{},arDialogGroups:{},obWindowClass:{},obWindowCloseIcon:{},obPathToAjax:{},obDepartmentLoad:{},obDepartmentSelectDisable:{},obUserSearchArea:{},obItems:{},obItemsLast:{},obItemsSelected:{},obItemsSelectedUndeleted:{},obCallback:{},obShowVacations:{},obElementSearchInput:{},obElementSearchInputHidden:{},obElementBindMainPopup:{},obElementBindSearchPopup:{},obBindOptions:{},obSiteDepartmentID:{},obCrmFeed:{},obCrmTypes:{},obCrmMyCompany:{},obAllowUserSearch:{},bFinderInited:false,obClientDb:null,obClientDbData:{},obClientDbDataSearchIndex:{},oDbUserSearchResult:{},oAjaxUserSearchResult:{},obDestSort:{},oSearchWaiterEnabled:{},oSearchWaiterContentHeight:0,obUseClientDatabase:{},bResultMoved:{search:false,last:false,group:false},oXHR:null,usersVacation:null,obTabSelected:{},obTemplateClass:{1:"bx-finder-box-item",2:"bx-finder-box-item-t2",3:"bx-finder-box-item-t3",4:"bx-finder-box-item-t3",5:"bx-finder-box-item-t5",6:"bx-finder-box-item-t6",7:"bx-finder-box-item-t7","department-user":"bx-finder-company-department-employee-selected",department:"bx-finder-company-department-check-checked"},obTemplateClassSelected:{1:"bx-finder-box-item-selected",2:"bx-finder-box-item-t2-selected",3:"bx-finder-box-item-t3-selected",4:"bx-finder-box-item-t3-selected",5:"bx-finder-box-item-t5-selected",6:"bx-finder-box-item-t6-selected",7:"bx-finder-box-item-t7-selected","department-user":"bx-finder-company-department-employee-selected",department:"bx-finder-company-department-check-checked"},searchStarted:false,tmpSearchResult:{client:[],ajax:[]}};e.SocNetLogDestination.init=function(t){var o=null,n=null;if(!t.name){t.name="lm"}e.SocNetLogDestination.obPathToAjax[t.name]=!t.pathToAjax?"/bitrix/components/bitrix/main.post.form/post.ajax.php":t.pathToAjax;e.SocNetLogDestination.obShowSearchInput[t.name]=typeof t.showSearchInput!="undefined"&&!!t.showSearchInput;e.SocNetLogDestination.obSendAjaxSearch[t.name]=typeof t.sendAjaxSearch!="undefined"?!!t.sendAjaxSearch:true;e.SocNetLogDestination.obUseContainer[t.name]=e.SocNetLogDestination.obShowSearchInput[t.name]||typeof t.useContainer!="undefined"&&!!t.useContainer;e.SocNetLogDestination.obUserNameTemplate[t.name]=typeof t.userNameTemplate!="undefined"?t.userNameTemplate:"";e.SocNetLogDestination.obCallback[t.name]=t.callback;e.SocNetLogDestination.obElementBindMainPopup[t.name]=t.bindMainPopup;e.SocNetLogDestination.obElementBindSearchPopup[t.name]=t.bindSearchPopup;e.SocNetLogDestination.obElementSearchInput[t.name]=t.searchInput;e.SocNetLogDestination.obElementSearchInputHidden[t.name]=typeof t.searchInputHidden!="undefined"?t.searchInputHidden:false;e.SocNetLogDestination.obBindOptions[t.name]=typeof t.bindOptions!="undefined"?t.bindOptions:{};e.SocNetLogDestination.obBindOptions[t.name].forceBindPosition=true;e.SocNetLogDestination.obDepartmentSelectDisable[t.name]=t.departmentSelectDisable==true;e.SocNetLogDestination.obUserSearchArea[t.name]=e.util.in_array(t.userSearchArea,["I","E"])?t.userSearchArea:false;e.SocNetLogDestination.obDepartmentLoad[t.name]={};e.SocNetLogDestination.obWindowClass[t.name]=!t.obWindowClass?"bx-lm-socnet-log-destination":t.obWindowClass;e.SocNetLogDestination.obWindowCloseIcon[t.name]=typeof t.obWindowCloseIcon=="undefined"?true:t.obWindowCloseIcon;e.SocNetLogDestination.extranetUser=t.extranetUser;e.SocNetLogDestination.obCrmFeed[t.name]=t.isCrmFeed;e.SocNetLogDestination.obCrmTypes[t.name]=t.isCrmFeed&&typeof t.CrmTypes=="object"&&t.CrmTypes.length>0?t.CrmTypes:[];e.SocNetLogDestination.obCrmMyCompany[t.name]=e.prop.getBoolean(t,"enableMyCrmCompanyOnly",false);e.SocNetLogDestination.obAllowUserSearch[t.name]=!(typeof t.allowUserSearch!="undefined"&&t.allowUserSearch===false);e.SocNetLogDestination.obAllowAddSocNetGroup[t.name]=t.allowAddSocNetGroup===true;e.SocNetLogDestination.obAllowAddUser[t.name]=t.allowAddUser===true;e.SocNetLogDestination.obAllowAddCrmContact[t.name]=t.allowAddCrmContact===true;e.SocNetLogDestination.obAllowSearchEmailUsers[t.name]=typeof t.allowSearchEmailUsers!="undefined"?t.allowSearchEmailUsers===true:t.allowAddUser===true;e.SocNetLogDestination.obAllowSearchCrmEmailUsers[t.name]=typeof t.allowSearchCrmEmailUsers!="undefined"?t.allowSearchCrmEmailUsers===true:false;e.SocNetLogDestination.obAllowSearchNetworkUsers[t.name]=typeof t.allowSearchNetworkUsers!="undefined"?t.allowSearchNetworkUsers===true:false;e.SocNetLogDestination.obAllowSearchSelf[t.name]=typeof t.allowSearchSelf!="undefined"?t.allowSearchSelf!==false:true;e.SocNetLogDestination.obEmailDescMode[t.name]=typeof t.emailDescMode!="undefined"?t.emailDescMode===true:false;e.SocNetLogDestination.obSearchOnlyWithEmail[t.name]=typeof t.searchOnlyWithEmail!="undefined"?t.searchOnlyWithEmail===true:false;e.SocNetLogDestination.obSiteDepartmentID[t.name]=typeof t.siteDepartmentID!="undefined"&&parseInt(t.siteDepartmentID)>0?parseInt(t.siteDepartmentID):false;e.SocNetLogDestination.obNewSocNetGroupCnt[t.name]=0;e.SocNetLogDestination.obLastEnable[t.name]=t.lastTabDisable!=true;e.SocNetLogDestination.oDbUserSearchResult[t.name]={};e.SocNetLogDestination.obDestSort[t.name]=typeof t.destSort!="undefined"?t.destSort:[];e.SocNetLogDestination.obDepartmentEnable[t.name]=!!t.enableDepartments;if(!e.SocNetLogDestination.obDepartmentEnable[t.name]&&t.items.department){for(o in t.items.department){e.SocNetLogDestination.obDepartmentEnable[t.name]=true;break}}e.SocNetLogDestination.obSonetgroupsEnable[t.name]=!!t.enableSonetgroups;if(!e.SocNetLogDestination.obSonetgroupsEnable[t.name]&&t.items.sonetgroups){for(o in t.items.sonetgroups){e.SocNetLogDestination.obSonetgroupsEnable[t.name]=true;break}}e.SocNetLogDestination.obProjectsEnable[t.name]=!!t.enableProjects;if(!e.SocNetLogDestination.obProjectsEnable[t.name]&&e.SocNetLogDestination.obSonetgroupsEnable[t.name]&&t.items.projects){for(o in t.items.projects){e.SocNetLogDestination.obProjectsEnable[t.name]=true;break}}e.SocNetLogDestination.obAllowSonetGroupsAjaxSearch[t.name]=e.SocNetLogDestination.obSonetgroupsEnable[t.name]&&typeof t.allowSonetGroupsAjaxSearch!="undefined"&&t.allowSonetGroupsAjaxSearch===true;e.SocNetLogDestination.obAllowMailContactsAjaxSearch[t.name]=typeof t.allowSearchEmailContacts!="undefined"?t.allowSearchEmailContacts:false;e.SocNetLogDestination.obAllowSonetGroupsAjaxSearchFeatures[t.name]=e.SocNetLogDestination.obSonetgroupsEnable[t.name]&&typeof t.allowSonetGroupsAjaxSearchFeatures!="undefined"?t.allowSonetGroupsAjaxSearchFeatures:{};e.SocNetLogDestination.obUseClientDatabase[t.name]=true;if(typeof t.useClientDatabase!="undefined"&&t.useClientDatabase===false){e.SocNetLogDestination.obUseClientDatabase[t.name]=false}e.SocNetLogDestination.obTabs[t.name]=[];if(e.SocNetLogDestination.obLastEnable[t.name]){e.SocNetLogDestination.obTabs[t.name].push("last")}if(e.SocNetLogDestination.obSonetgroupsEnable[t.name]){e.SocNetLogDestination.obTabs[t.name].push("group")}if(e.SocNetLogDestination.obProjectsEnable[t.name]){e.SocNetLogDestination.obTabs[t.name].push("project")}if(e.SocNetLogDestination.obAllowSearchEmailUsers[t.name]){e.SocNetLogDestination.obTabs[t.name].push("mailContacts")}if(e.SocNetLogDestination.obDepartmentEnable[t.name]){e.SocNetLogDestination.obTabs[t.name].push("department")}if(e.SocNetLogDestination.obAllowSearchEmailUsers[t.name]){e.SocNetLogDestination.obTabs[t.name].push("email")}if(e.SocNetLogDestination.obAllowSearchCrmEmailUsers[t.name]){e.SocNetLogDestination.obTabs[t.name].push("crmemail")}e.addCustomEvent(e.SocNetLogDestination,"onTabsAdd",e.delegate(this.onTabsAdd,this));e.SocNetLogDestination.arDialogGroups[t.name]=[];var i=function(o,n,i){if(typeof t.dialogGroupParams!=="undefined"&&typeof t.dialogGroupParams[o]!=="undefined"&&typeof t.dialogGroupParams[o][n]!=="undefined"){return t.dialogGroupParams[o][n]}else if(n==="emailDescMode"&&typeof i==="undefined"){return e.SocNetLogDestination.obEmailDescMode[t.name]}else{return i}};e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:true,bMail:true,groupCode:"contacts",className:i("contacts","className","bx-lm-element-contacts"),title:i("contacts","title",e.message("LM_POPUP_TAB_LAST_CONTACTS")),emailDescMode:i("contacts","emailDescMode")});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:true,bMail:true,groupCode:"companies",className:i("companies","className","bx-lm-element-companies"),title:i("companies","title",e.message("LM_POPUP_TAB_LAST_COMPANIES"))});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:true,bMail:true,groupCode:"leads",className:i("leads","className","bx-lm-element-leads"),title:i("leads","title",e.message("LM_POPUP_TAB_LAST_LEADS"))});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:true,bMail:false,groupCode:"deals",className:i("deals","className","bx-lm-element-deals"),avatarLessMode:i("deals","avatarLessMode",true),title:i("deals","title",e.message("LM_POPUP_TAB_LAST_DEALS"))});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,bMail:false,groupCode:"groups",bHideGroup:i("groups","bHideGroup",true),className:i("groups","className","bx-lm-element-groups"),descLessMode:i("groups","descLessMode",true),emailDescMode:i("groups","emailDescMode")});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,bMail:true,groupCode:"users",className:i("users","className","bx-lm-element-user"),descLessMode:i("users","descLessMode",true),title:i("users","title",e.message("LM_POPUP_TAB_LAST_USERS")),emailDescMode:i("users","emailDescMode")});if(e.SocNetLogDestination.obAllowSearchNetworkUsers[t.name]){e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,bMail:false,groupCode:"network",className:i("network","className","bx-lm-element-user"),descLessMode:i("network","descLessMode",false),title:i("network","title",e.message("LM_POPUP_TAB_LAST_NETWORK")),emailDescMode:i("network","emailDescMode")})}e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,bMail:true,groupCode:"crmemails",className:i("crmemails","className","bx-lm-element-user"),descLessMode:i("crmemails","descLessMode",true),title:i("crmemails","title",e.message("LM_POPUP_TAB_LAST_CRMEMAILS")),emailDescMode:i("crmemails","emailDescMode")});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,bMail:true,groupCode:"mailContacts",className:i("mailContacts","className","bx-lm-element-mail-contact"),descLessMode:i("mailContacts","descLessMode",true),title:i("mailContacts","title",e.message("LM_POPUP_TAB_LAST_MAIL_CONTACTS")),emailDescMode:i("mailContacts","emailDescMode")});if(e.SocNetLogDestination.obAllowSearchEmailUsers[t.name]){e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,bMail:true,groupCode:"email",className:i("email","className","bx-lm-element-user bx-lm-element-email"),descLessMode:i("email","descLessMode",true),title:i("email","title",e.message("LM_POPUP_TAB_EMAIL")),emailDescMode:i("email","emailDescMode")})}if(e.SocNetLogDestination.obProjectsEnable[t.name]){e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,bMail:false,groupCode:"projects",className:i("projects","className","bx-lm-element-sonetgroup"),classNameExtranetGroup:i("projects","classNameExtranetGroup","bx-lm-element-extranet"),groupboxClassName:i("projects","groupboxClassName","bx-lm-groupbox-project"),descLessMode:i("projects","descLessMode",true),title:i("projects","title",e.message("LM_POPUP_TAB_LAST_SG_PROJECT"))})}e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,bMail:false,groupCode:"sonetgroups",className:i("sonetgroups","className","bx-lm-element-sonetgroup"),classNameExtranetGroup:i("sonetgroups","classNameExtranetGroup","bx-lm-element-extranet"),groupboxClassName:i("sonetgroups","groupboxClassName","bx-lm-groupbox-sonetgroup"),descLessMode:i("sonetgroups","descLessMode",true),title:i("sonetgroups","title",e.message("LM_POPUP_TAB_LAST_SG"))});if(e.SocNetLogDestination.obDepartmentEnable[t.name]){e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,bMail:false,groupCode:"department",className:i("department","className","bx-lm-element-department"),groupboxClassName:i("department","groupboxClassName","bx-lm-groupbox-department"),descLessMode:i("department","descLessMode",true),title:i("department","title",e.message("LM_POPUP_TAB_LAST_STRUCTURE"))})}e.SocNetLogDestination.obItems[t.name]=e.clone(t.items);e.SocNetLogDestination.obItemsLast[t.name]=e.clone(t.itemsLast);e.SocNetLogDestination.obItemsSelected[t.name]=e.clone(t.itemsSelected);e.SocNetLogDestination.obItemsSelectedUndeleted[t.name]=typeof t.itemsSelectedUndeleted!="undefined"?e.clone(t.itemsSelectedUndeleted):[];for(var a in e.SocNetLogDestination.obItemsSelected[t.name]){if(e.SocNetLogDestination.obItemsSelected[t.name].hasOwnProperty(a)){n=e.SocNetLogDestination.obItemsSelected[t.name][a];e.SocNetLogDestination.runSelectCallback(a,n,t.name,false,"init")}}if(e.SocNetLogDestination.obUseClientDatabase[t.name]&&!e.SocNetLogDestination.bFinderInited){e.Finder(false,"destination",[],{},e.SocNetLogDestination);e.onCustomEvent(e.SocNetLogDestination,"initFinderDb",[e.SocNetLogDestination,t.name,null,["users"],e.SocNetLogDestination]);e.SocNetLogDestination.bFinderInited=true}if(typeof t.LHEObjName!="undefined"&&e("div"+t.LHEObjName)){e.addCustomEvent(e("div"+t.LHEObjName),"OnShowLHE",function(t){if(!t){if(e.SocNetLogDestination.isOpenDialog()){e.SocNetLogDestination.closeDialog()}e.SocNetLogDestination.closeSearch()}})}e.SocNetLogDestination.obTabSelected[t.name]=e.SocNetLogDestination.obLastEnable[t.name]?"last":"";if(!e.SocNetLogDestination.bLoadAllInitialized){e.addCustomEvent("loadAllFinderDb",function(t){e.SocNetLogDestination.loadAll(t)});e.SocNetLogDestination.bLoadAllInitialized=true}e.SocNetLogDestination.obShowVacations[t.name]=typeof t.showVacations!="undefined"&&t.showVacations===true;if(e.SocNetLogDestination.obShowVacations[t.name]&&e.SocNetLogDestination.usersVacation===null&&typeof t.usersVacation!="undefined"){e.SocNetLogDestination.usersVacation=t.usersVacation}};e.SocNetLogDestination.reInit=function(t){var o=null;for(var n in e.SocNetLogDestination.obItemsSelected[t]){if(e.SocNetLogDestination.obItemsSelected[t].hasOwnProperty(n)){o=e.SocNetLogDestination.obItemsSelected[t][n];e.SocNetLogDestination.runSelectCallback(n,o,t,false,"init")}}};e.SocNetLogDestination.openContainer=function(t,o){if(!t){t="lm"}if(!o){o={}}if(e.SocNetLogDestination.containerWindow!=null){return false}var n=typeof o.bindNode!="undefined"?o.bindNode:e.SocNetLogDestination.obElementBindMainPopup[t].node;e.SocNetLogDestination.containerWindow=new e.PopupWindow({id:"BXSocNetLogDestinationContainer",bindElement:n,autoHide:true,zIndex:1200,className:"bx-finder-popup bx-finder-v2",offsetLeft:parseInt(e.SocNetLogDestination.obElementBindMainPopup[t].offsetLeft),offsetTop:parseInt(e.SocNetLogDestination.obElementBindMainPopup[t].offsetTop),bindOptions:e.SocNetLogDestination.obBindOptions[t],closeByEsc:true,closeIcon:!!e.SocNetLogDestination.obWindowCloseIcon[t],lightShadow:true,events:{onPopupShow:function(){if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[t]&&e.SocNetLogDestination.obCallback[t].openDialog){e.SocNetLogDestination.obCallback[t].openDialog(t)}if(e.SocNetLogDestination.inviteEmailUserWindow&&e.SocNetLogDestination.inviteEmailUserWindow.isShown()){e.SocNetLogDestination.inviteEmailUserWindow.close()}},onPopupClose:function(e){this.destroy()},onPopupDestroy:e.proxy(function(){e.SocNetLogDestination.containerWindow=null;if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[t]){if(e.SocNetLogDestination.obCallback[t].closeDialog){e.SocNetLogDestination.obCallback[t].closeDialog(t)}if(e.SocNetLogDestination.obCallback[t].closeSearch){e.SocNetLogDestination.obCallback[t].closeSearch(t)}}},this)},content:!!e.SocNetLogDestination.obShowSearchInput[t]?e.create("DIV",{children:[e.create("DIV",{props:{className:"bx-finder-box bx-finder-box-vertical bx-lm-box "+e.SocNetLogDestination.obWindowClass[t]},style:{minWidth:"650px",paddingBottom:"8px",overflow:"hidden"},children:[e.create("DIV",{props:{className:"bx-finder-search-block"},children:[e.create("DIV",{props:{className:"bx-finder-search-block-cell"},children:[e.create("SPAN",{attrs:{id:"bx-dest-internal-item"}}),e.create("SPAN",{attrs:{id:"bx-dest-internal-input-box",style:"display: inline-block"},props:{className:"feed-add-destination-input-box"},children:[e.create("INPUT",{attrs:{type:"text",id:"bx-dest-internal-input"},props:{className:"feed-add-destination-inp"}})]})],events:{click:function(o){e.focus(e.SocNetLogDestination.obElementSearchInput[t]);return e.PreventDefault(o)}}})]}),e.create("div",{attrs:{id:"BXSocNetLogDestinationContainerContent"},props:{className:"bx-finder-container-content"}})]})]}):e.create("div",{attrs:{id:"BXSocNetLogDestinationContainerContent"},props:{className:"bx-finder-container-content"}})});if(!!e.SocNetLogDestination.obShowSearchInput[t]){e.bind(e("bx-dest-internal-input"),"keyup",e.delegate(e.SocNetLogDestination.BXfpSearch,{formName:t,inputName:"bx-dest-internal-input",sendAjax:!!e.SocNetLogDestination.obSendAjaxSearch[t]}));e.bind(e("bx-dest-internal-input"),"paste",e.defer(e.SocNetLogDestination.BXfpSearch,{formName:t,inputName:"bx-dest-internal-input",sendAjax:!!e.SocNetLogDestination.obSendAjaxSearch[t],onPasteEvent:true}));e.bind(e("bx-dest-internal-input"),"keydown",e.delegate(e.SocNetLogDestination.BXfpSearchBefore,{formName:t,inputName:"bx-dest-internal-input"}));if(o["itemsHidden"]&&e.message("BX_FPD_LINK_1")&&e.message("BX_FPD_LINK_2")){for(var i in o["itemsHidden"]){if(o["itemsHidden"].hasOwnProperty(i)){e.SocNetLogDestination.BXfpSelectCallback({item:{id:"SG"+o["itemsHidden"][i]["ID"],name:o["itemsHidden"][i]["NAME"]},type:"sonetgroups",bUndeleted:true,containerInput:e("bx-dest-internal-item"),valueInput:e("bx-dest-internal-input"),formName:window.BXSocNetLogDestinationFormName,tagInputName:"bx-destination-tag",tagLink1:e.message("BX_FPD_LINK_1"),tagLink2:e.message("BX_FPD_LINK_2"),state:"init"})}}}e.SocNetLogDestination.obElementSearchInput[t]=e("bx-dest-internal-input");e.defer(e.focus)(e.SocNetLogDestination.obElementSearchInput[t])}return true};e.SocNetLogDestination.getDialogContent=function(t){var o=0;var n=[e.SocNetLogDestination.obLastEnable[t]?e.create("A",{attrs:{hidefocus:"true",id:"destLastTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-last bx-finder-box-tab-selected"},events:{click:function(o){o.preventDefault();return e.SocNetLogDestination.SwitchTab(t,this,"last")}},html:e.message("LM_POPUP_TAB_LAST")}):null,e.SocNetLogDestination.obProjectsEnable[t]?e.create("A",{attrs:{hidefocus:"true",id:"destProjectTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-project"},events:{click:function(o){o.preventDefault();return e.SocNetLogDestination.SwitchTab(t,this,"project")}},html:e.message("LM_POPUP_TAB_SG_PROJECT")}):null,e.SocNetLogDestination.obSonetgroupsEnable[t]?e.create("A",{attrs:{hidefocus:"true",id:"destGroupTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-sonetgroup"},events:{click:function(o){o.preventDefault();return e.SocNetLogDestination.SwitchTab(t,this,"group")}},html:e.message("LM_POPUP_TAB_SG")}):null,e.SocNetLogDestination.obDepartmentEnable[t]?e.create("A",{attrs:{hidefocus:"true",id:"destDepartmentTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-department"},events:{click:function(o){o.preventDefault();return e.SocNetLogDestination.SwitchTab(t,this,"department")}},html:e.SocNetLogDestination.obUserSearchArea[t]=="E"?e.message("LM_POPUP_TAB_STRUCTURE_EXTRANET"):e.message("LM_POPUP_TAB_STRUCTURE")}):null,e.SocNetLogDestination.obAllowSearchEmailUsers[t]?e.create("A",{attrs:{hidefocus:"true",id:"destEmailTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-email"},events:{click:function(o){o.preventDefault();return e.SocNetLogDestination.SwitchTab(t,this,"email")}},html:e.message("LM_POPUP_TAB_EMAIL")}):null,e.SocNetLogDestination.obAllowSearchCrmEmailUsers[t]?e.create("A",{attrs:{hidefocus:"true",id:"destCrmEmailTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-crmemail"},events:{click:function(o){o.preventDefault();return e.SocNetLogDestination.SwitchTab(t,this,"crmemail")}},html:e.message("LM_POPUP_TAB_CRMEMAIL")}):null,e.SocNetLogDestination.obShowSearchInput[t]?e.create("A",{attrs:{hidefocus:"true",id:"destSearchTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-search"},events:{click:function(o){o.preventDefault();return e.SocNetLogDestination.SwitchTab(t,this,"search")}},html:e.message("LM_POPUP_TAB_SEARCH")}):null];if(typeof e.SocNetLogDestination.obCustomTabs[t]!="undefined"){for(o=0;o<e.SocNetLogDestination.obCustomTabs[t].length;o++){n.push(e.create("A",{attrs:{hidefocus:"true",id:"dest"+e.SocNetLogDestination.obCustomTabs[t][o].id+"Tab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-"+e.SocNetLogDestination.obCustomTabs[t][o].id},events:{click:e.proxy(function(o){var n=o.target||o.srcElement;o.preventDefault();return e.SocNetLogDestination.SwitchTab(t,n,e.SocNetLogDestination.obCustomTabs[t][this.tabNum].id)},{tabNum:o})},html:e.SocNetLogDestination.obCustomTabs[t][o].name}));e.SocNetLogDestination.obResult[e.SocNetLogDestination.obCustomTabs[t][o].id]=[]}}n.push(e.create("DIV",{props:{className:"popup-window-hr popup-window-buttons-hr"},children:[e.create("I",{})]}));var i=[e.SocNetLogDestination.obLastEnable[t]?e.create("DIV",{props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-last"+(e.SocNetLogDestination.obLastEnable[t]?" bx-finder-box-tab-content-selected":"")},html:e.SocNetLogDestination.getItemLastHtml(false,false,t)}):null,e.SocNetLogDestination.obProjectsEnable[t]?e.create("DIV",{attrs:{id:"bx-lm-box-project-content"},props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-project"+(!e.SocNetLogDestination.obLastEnable[t]?" bx-finder-box-tab-content-selected":"")}}):null,e.SocNetLogDestination.obSonetgroupsEnable[t]?e.create("DIV",{attrs:{id:"bx-lm-box-group-content"},props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-sonetgroup"+(!e.SocNetLogDestination.obLastEnable[t]&&!e.SocNetLogDestination.obProjectsEnable[t]?" bx-finder-box-tab-content-selected":"")}}):null,e.SocNetLogDestination.obDepartmentEnable[t]?e.create("DIV",{props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-department"+(!e.SocNetLogDestination.obLastEnable[t]&&!e.SocNetLogDestination.obProjectsEnable[t]&&!e.SocNetLogDestination.obSonetgroupsEnable[t]?" bx-finder-box-tab-content-selected":"")}}):null,e.SocNetLogDestination.obAllowSearchEmailUsers[t]?e.create("DIV",{attrs:{id:"bx-lm-box-email-content"},props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-email"}}):null,e.SocNetLogDestination.obAllowSearchCrmEmailUsers[t]?e.create("DIV",{attrs:{id:"bx-lm-box-crmemail-content"},props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-crmemail"}}):null,e.SocNetLogDestination.obShowSearchInput[t]?e.create("DIV",{attrs:{id:"destSearchTabContent_"+t},props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-search"}}):null];if(typeof e.SocNetLogDestination.obCustomTabs[t]!="undefined"){for(o=0;o<e.SocNetLogDestination.obCustomTabs[t].length;o++){i.push(e.create("DIV",{attrs:{id:"dest"+e.SocNetLogDestination.obCustomTabs[t][o].id+"TabContent_"+t},props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-"+e.SocNetLogDestination.obCustomTabs[t][o].id}}))}}return e.create("DIV",{style:{minWidth:"650px",paddingBottom:"8px"},props:{className:"bx-finder-box bx-finder-box-vertical bx-lm-box "+e.SocNetLogDestination.obWindowClass[t]},children:[!e.SocNetLogDestination.obLastEnable[t]&&!e.SocNetLogDestination.obSonetgroupsEnable[t]&&!e.SocNetLogDestination.obDepartmentEnable[t]?null:e.create("DIV",{props:{className:"bx-finder-box-tabs"},children:n}),e.create("DIV",{attrs:{id:"bx-lm-box-last-content"},props:{className:"bx-finder-box-tabs-content bx-finder-box-tabs-content-window"},children:[e.create("TABLE",{props:{className:"bx-finder-box-tabs-content-table"},children:[e.create("TR",{children:[e.create("TD",{props:{className:"bx-finder-box-tabs-content-cell"},children:i})]})]})]}),!!e.SocNetLogDestination.obUseContainer[t]?e.SocNetLogDestination.getSearchWaiter():null]})};e.SocNetLogDestination.getSearchContent=function(t,o,n){return e.create("DIV",{props:{className:"bx-finder-box bx-finder-box-vertical bx-lm-box "+e.SocNetLogDestination.obWindowClass[o]},style:{minWidth:"450px",paddingBottom:"8px"},children:[e.create("DIV",{attrs:{id:"bx-lm-box-search-tabs-content"},props:{className:"bx-finder-box-tabs-content"+(!!e.SocNetLogDestination.obUseContainer[o]?" bx-finder-box-tabs-content-search":"")},children:[e.create("TABLE",{props:{className:"bx-finder-box-tabs-content-table"},children:[e.create("TR",{children:[e.create("TD",{props:{className:"bx-finder-box-tabs-content-cell"},children:[e.create("DIV",{attrs:{id:"bx-lm-box-search-content"},props:{className:"bx-finder-box-tab-content bx-finder-box-tab-content-selected"},html:e.SocNetLogDestination.getItemLastHtml(t,true,o)})]})]})]})]}),!!e.SocNetLogDestination.obUseContainer[o]?null:e.SocNetLogDestination.getSearchWaiter()]})};e.SocNetLogDestination.getHidden=function(t,o,n){if(typeof n=="undefined"||!n){n="SPERM"}var i=typeof o.id!="undefined"&&(o.id.indexOf("C_")===0||o.id.indexOf("CO_")===0||o.id.indexOf("L_")===0)?o.desc:o.id;return[e.create("input",{attrs:{type:"hidden",name:n+"["+t+"][]",value:i}}),t=="UE"&&typeof o.params!="undefined"&&typeof o.params.name!="undefined"?e.create("input",{attrs:{type:"hidden",name:"INVITED_USER_NAME["+i+"]",value:o.params.name}}):null,t=="UE"&&typeof o.params!="undefined"&&typeof o.params.lastName!="undefined"?e.create("input",{attrs:{type:"hidden",name:"INVITED_USER_LAST_NAME["+i+"]",value:o.params.lastName}}):null,t=="UE"&&typeof o.id!="undefined"&&(o.id.indexOf("C_")===0||o.id.indexOf("CO_")===0||o.id.indexOf("L_")===0)?e.create("input",{attrs:{type:"hidden",name:"INVITED_USER_CRM_ENTITY["+i+"]",value:o.id}}):null,t=="UE"&&typeof o.params!="undefined"&&typeof o.params.createCrmContact!="undefined"&&!!o.params.createCrmContact?e.create("input",{attrs:{type:"hidden",name:"INVITED_USER_CREATE_CRM_CONTACT["+i+"]",value:"Y"}}):null]};e.SocNetLogDestination.getSearchWaiter=function(){return e.create("DIV",{attrs:{id:"bx-lm-box-search-waiter"},props:{className:"bx-finder-box-search-waiter"},style:{height:"0px"},children:[e.create("IMG",{props:{className:"bx-finder-box-search-waiter-background"},attrs:{src:"/bitrix/js/main/core/images/waiter-white.gif"}}),e.create("DIV",{props:{className:"bx-finder-box-search-waiter-text"},text:e.message("LM_POPUP_WAITER_TEXT")})]})};e.SocNetLogDestination.openDialog=function(t,o){var n=null;if(!t){t="lm"}if(!o){o={}}e.SocNetLogDestination.bByFocusEvent=typeof o.bByFocusEvent!="undefined"&&o.bByFocusEvent;if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}if(e.SocNetLogDestination.popupWindow!=null){var i=e.SocNetLogDestination.popupWindow.uniquePopupId+"";if(i!=t||!e.SocNetLogDestination.bByFocusEvent){e.SocNetLogDestination.popupWindow.close()}if(i==t){return false}}if(typeof o.bByFocusEvent=="undefined"||!o.bByFocusEvent){e.SocNetLogDestination.bByFocusEvent=false}if(!!e.SocNetLogDestination.obUseContainer[t]){if(!e.SocNetLogDestination.openContainer(t,o)){return false}e.cleanNode(e("BXSocNetLogDestinationContainerContent"));e("BXSocNetLogDestinationContainerContent").appendChild(e.SocNetLogDestination.getDialogContent(t));if(!!e.SocNetLogDestination.obShowSearchInput[t]){for(var a in e.SocNetLogDestination.obItemsSelected[t]){if(e.SocNetLogDestination.obItemsSelected[t].hasOwnProperty(a)){n=e.SocNetLogDestination.obItemsSelected[t][a];e.SocNetLogDestination.runSelectCallback(a,n,t,false,"init")}}}e.SocNetLogDestination.containerWindow.setAngle({});if(typeof o.bindNode!="undefined"){e.SocNetLogDestination.containerWindow.setBindElement(o.bindNode)}e.SocNetLogDestination.containerWindow.show()}else{var s=typeof o.bindNode!="undefined"?o.bindNode:e.SocNetLogDestination.obElementBindMainPopup[t].node;e.SocNetLogDestination.popupWindow=new e.PopupWindow({id:"BXSocNetLogDestination",bindElement:s,autoHide:true,zIndex:1200,className:"bx-finder-popup bx-finder-v2",offsetLeft:parseInt(e.SocNetLogDestination.obElementBindMainPopup[t].offsetLeft),offsetTop:parseInt(e.SocNetLogDestination.obElementBindMainPopup[t].offsetTop),bindOptions:e.SocNetLogDestination.obBindOptions[t],closeByEsc:true,closeIcon:e.SocNetLogDestination.obWindowCloseIcon[t]?{top:"12px",right:"15px"}:false,lightShadow:true,events:{onPopupShow:function(){if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[t]&&e.SocNetLogDestination.obCallback[t].openDialog){e.SocNetLogDestination.obCallback[t].openDialog(t)}if(e.SocNetLogDestination.inviteEmailUserWindow&&e.SocNetLogDestination.inviteEmailUserWindow.isShown()){e.SocNetLogDestination.inviteEmailUserWindow.close()}},onPopupClose:function(e){this.destroy()},onPopupDestroy:e.proxy(function(){e.SocNetLogDestination.popupWindow=null;if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[t]&&e.SocNetLogDestination.obCallback[t].closeDialog){e.SocNetLogDestination.obCallback[t].closeDialog(t)}},this)},content:e.SocNetLogDestination.getDialogContent(t)});e.SocNetLogDestination.popupWindow.setAngle({});e.SocNetLogDestination.popupWindow.show()}if(e.SocNetLogDestination.obLastEnable[t]){e.SocNetLogDestination.initResultNavigation(t,"last",e.SocNetLogDestination.obItemsLast[t]);e.SocNetLogDestination.obTabSelected[t]="last"}if(!e.SocNetLogDestination.obLastEnable[t]&&!e.SocNetLogDestination.obSonetgroupsEnable[t]&&e.SocNetLogDestination.obDepartmentEnable[t]&&e("destDepartmentTab_"+t)){e.SocNetLogDestination.SwitchTab(t,e("destDepartmentTab_"+t),"department");e.SocNetLogDestination.popupWindow.adjustPosition()}};e.SocNetLogDestination.search=function(t,o,n,i,a){if(!n)n="lm";if(!a)a={};if(typeof i=="undefined"||i.length<=0){i=e.SocNetLogDestination.obUserNameTemplate[n]}o=o!=false;if(e.SocNetLogDestination.extranetUser){o=false}e.SocNetLogDestination.obSearchFirstElement=null;e.SocNetLogDestination.obCurrentElement.search=null;e.SocNetLogDestination.obResult.search=[];e.SocNetLogDestination.obCursorPosition.search={group:0,row:0,column:0};t=e.util.trim(t);if(t.length<=0){clearTimeout(e.SocNetLogDestination.searchTimeout);if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}return false}else{var s={groups:{},users:{},network:{},crmemails:{},sonetgroups:{},projects:{},department:{},contacts:{},companies:{},leads:{},deals:{},mailContacts:{}};var r=0;var c=0;var l=0;var d=0;var u=null;var m=false;var S=false;var p=[];var b=false;var f=false;var g=null;var N=[t];var D=null;var L=[];var h=false;var C=null;var x=null;var v=null;if(o){e.SocNetLogDestination.abortSearchRequest();var y={searchString:t};if(!!e.SocNetLogDestination.obUseClientDatabase[n]){e.onCustomEvent("findEntityByName",[e.SocNetLogDestination,y,{},e.SocNetLogDestination.oDbUserSearchResult[n]])}if(y.searchString!=t){N.push(y.searchString)}e.SocNetLogDestination.bResultMoved.search=false;e.SocNetLogDestination.tmpSearchResult.ajax=[]}else{if(typeof a!="undefined"&&typeof a.textAjax!="undefined"&&a.textAjax!=t){N.push(a.textAjax)}if(!e.SocNetLogDestination.obUserSearchArea[n]&&!e.SocNetLogDestination.obAllowSearchNetworkUsers[n]){for(C=0;C<N.length;C++){D=N[C].toLowerCase();if(D.length>1&&typeof e.SocNetLogDestination.oDbUserSearchResult[n][D]!="undefined"&&e.SocNetLogDestination.oDbUserSearchResult[n][D].length>0){e.onCustomEvent("syncClientDb",[e.SocNetLogDestination,n,e.SocNetLogDestination.oDbUserSearchResult[n][D],typeof e.SocNetLogDestination.oAjaxUserSearchResult[n][D]!="undefined"?e.SocNetLogDestination.oAjaxUserSearchResult[n][D]:{}])}}}}if(o){e.SocNetLogDestination.tmpSearchResult.client=[]}for(var E in s){u=true;L=[];if(e.SocNetLogDestination.obDepartmentSelectDisable[n]&&E=="department"){continue}for(C=0;C<N.length;C++){D=N[C].toLowerCase();if(E=="users"&&o&&typeof e.SocNetLogDestination.oDbUserSearchResult[n][D]!="undefined"&&e.SocNetLogDestination.oDbUserSearchResult[n][D].length>0){for(x in e.SocNetLogDestination.oDbUserSearchResult[n][D]){if(!e.SocNetLogDestination.oDbUserSearchResult[n][D].hasOwnProperty(x)){continue}if(!e.SocNetLogDestination.obAllowSearchSelf[n]&&e.SocNetLogDestination.oDbUserSearchResult[n][D][x]=="U"+e.message("USER_ID")){continue}if(!e.SocNetLogDestination.obUserSearchArea[n]||e.SocNetLogDestination.obUserSearchArea[n]=="E"&&e.SocNetLogDestination.obClientDbData.users[e.SocNetLogDestination.oDbUserSearchResult[n][D][x]]["isExtranet"]=="Y"||e.SocNetLogDestination.obUserSearchArea[n]=="I"&&e.SocNetLogDestination.obClientDbData.users[e.SocNetLogDestination.oDbUserSearchResult[n][D][x]]["isExtranet"]!="Y"){e.SocNetLogDestination.obItems[n][E][e.SocNetLogDestination.oDbUserSearchResult[n][D][x]]=e.SocNetLogDestination.obClientDbData.users[e.SocNetLogDestination.oDbUserSearchResult[n][D][x]]}}}}var w="";for(x in e.SocNetLogDestination.obItems[n][E]){if(!e.SocNetLogDestination.obItems[n][E].hasOwnProperty(x)){continue}if(e.SocNetLogDestination.obItemsSelected[n][x]){continue}for(C=0;C<N.length;C++){b=false;D=N[C];g=D.toLowerCase().split(" ");p=e.SocNetLogDestination.obItems[n][E][x].name.toLowerCase().split(" ");if(E==="mailContacts"&&e.SocNetLogDestination.obItems[n][E][x].email){p=p.concat(e.SocNetLogDestination.obItems[n][E][x].email.toLowerCase().split("@"))}for(v in p){if(p.hasOwnProperty(v)){p[v]=e.util.htmlspecialcharsback(p[v]);w=p[v].replace(/(["\xAB\xBB])/g,"");if(w.length!=p[v].length){p.push(w)}}}if(typeof e.SocNetLogDestination.obItems[n][E][x].email!="undefined"&&e.SocNetLogDestination.obItems[n][E][x].email&&e.SocNetLogDestination.obItems[n][E][x].email.length>0){p.push(e.SocNetLogDestination.obItems[n][E][x].email.toLowerCase())}if(typeof e.SocNetLogDestination.obItems[n][E][x].login!="undefined"&&e.SocNetLogDestination.obItems[n][E][x].login.length>0&&g.length<=1&&D.length>2){p.push(e.SocNetLogDestination.obItems[n][E][x].login.toLowerCase())}e.onCustomEvent(window,"SocNetLogDestinationSearchFillItemParts",[E,e.SocNetLogDestination.obItems[n][E][x],p]);if(g.length<=1){for(v in p){if(p.hasOwnProperty(v)&&D.toLowerCase().localeCompare(p[v].substring(0,D.length),"en-US",{sensitivity:"base"})===0){b=true;break}}}else{b=true;for(var I in g){if(!g.hasOwnProperty(I)){continue}f=false;for(v in p){if(p.hasOwnProperty(v)&&g[I].toLowerCase().localeCompare(p[v].substring(0,g[I].length),"en-US",{sensitivity:"base"})===0){f=true;break}}if(!f){b=false;break}}if(!b){continue}}if(b){break}}if(!b){continue}if(u){if(typeof e.SocNetLogDestination.obResult.search[c]!="undefined"){c++}u=false}h={value:x};if(typeof e.SocNetLogDestination.obDestSort[n][x]!="undefined"){h.sort=e.SocNetLogDestination.obDestSort[n][x]}if(e.SocNetLogDestination.obItems[n][E][x].isNetwork=="Y"){h.isNetwork=true}if(o){e.SocNetLogDestination.tmpSearchResult.client.push(x)}L.push(h)}e.SocNetLogDestination.tmpSearchResult.client.filter(function(e,t,o){return t==o.indexOf(e)});L.sort(e.SocNetLogDestination.compareDestinations);var T=0;for(C=0;C<L.length;C++){x=L[C].value;s[E][x]=++T;S=false;if(e.SocNetLogDestination.obItems[n][E][x]["id"]=="UA"){S=true}else{if(typeof e.SocNetLogDestination.obResult.search[c]=="undefined"){e.SocNetLogDestination.obResult.search[c]=[];l=0;d=0}if(d==2){l++;d=0}if(typeof e.SocNetLogDestination.obResult.search[c][l]=="undefined"){e.SocNetLogDestination.obResult.search[c][l]=[];d=0}}var _=e.clone(e.SocNetLogDestination.obItems[n][E][x]);if(S){m=_}_.type=E;if(!S){if(m){e.SocNetLogDestination.obResult.search[c][l][d]=m;m=false;d++}e.SocNetLogDestination.obResult.search[c][l][d]=_}if(r<=0){e.SocNetLogDestination.obSearchFirstElement=_;e.SocNetLogDestination.obCurrentElement.search=_}r++;d++}}if(o){if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindowContent.innerHTML=e.SocNetLogDestination.getItemLastHtml(s,true,n);if(typeof a.bindNode!="undefined"){e.SocNetLogDestination.popupSearchWindow.setBindElement(a.bindNode)}}else{e.SocNetLogDestination.openSearch(s,n,a)}if(!!e.SocNetLogDestination.obUseContainer[n]){e.SocNetLogDestination.containerWindow.adjustPosition()}else if(e.SocNetLogDestination.popupSearchWindow){e.SocNetLogDestination.popupSearchWindow.adjustPosition()}}else{if(r<=0){if(e.SocNetLogDestination.popupSearchWindow!=null){if(!e.SocNetLogDestination.obAllowSearchNetworkUsers[n]){e.SocNetLogDestination.popupSearchWindow.destroy()}}else if(e.SocNetLogDestination.obShowSearchInput[n]&&e("bx-lm-box-waiter-content-text")){e("bx-lm-box-waiter-content-text").innerHTML=e.message("LM_EMPTY_LIST")}if(e.SocNetLogDestination.obAllowAddSocNetGroup[n]){e.SocNetLogDestination.createSonetGroupTimeout=setTimeout(function(){if(e.SocNetLogDestination.createSocNetGroupWindow===null){e.SocNetLogDestination.createSocNetGroupWindow=new e.PopupWindow({id:"invite-dialog-creategroup-popup",bindElement:e.SocNetLogDestination.obElementBindSearchPopup[n].node,offsetTop:1,autoHide:true,content:e.SocNetLogDestination.createSocNetGroupContent(t),zIndex:1200,buttons:e.SocNetLogDestination.createSocNetGroupButtons(t,n)})}else{e.SocNetLogDestination.createSocNetGroupWindow.setContent(e.SocNetLogDestination.createSocNetGroupContent(t));e.SocNetLogDestination.createSocNetGroupWindow.setButtons(e.SocNetLogDestination.createSocNetGroupButtons(t,n))}if(!e.SocNetLogDestination.createSocNetGroupWindow.isShown()){e.SocNetLogDestination.createSocNetGroupWindow.show()}},1e3)}}else{if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindowContent.innerHTML=e.SocNetLogDestination.getItemLastHtml(s,true,n)}else{e.SocNetLogDestination.openSearch(s,n,a)}if(!!e.SocNetLogDestination.obUseContainer[n]){e.SocNetLogDestination.containerWindow.adjustPosition()}else if(e.SocNetLogDestination.popupSearchWindow){e.SocNetLogDestination.popupSearchWindow.adjustPosition()}}e.SocNetLogDestination.obEmptySearchResult[n]=r<=0}clearTimeout(e.SocNetLogDestination.searchTimeout);if(o&&t.toLowerCase()!=""){e.SocNetLogDestination.showSearchWaiter(n);e.SocNetLogDestination.searchTimeout=setTimeout(function(){var o={LD_SEARCH:"Y",USER_SEARCH:e.SocNetLogDestination.obAllowUserSearch[n]?"Y":"N",CRM_SEARCH:e.SocNetLogDestination.obCrmFeed[n]?"Y":"N",CRM_SEARCH_TYPES:e.SocNetLogDestination.obCrmTypes[n],CRMCOMPANYMY:e.SocNetLogDestination.obCrmMyCompany[n]?"Y":"N",EXTRANET_SEARCH:e.util.in_array(e.SocNetLogDestination.obUserSearchArea[n],["I","E"])?e.SocNetLogDestination.obUserSearchArea[n]:"N",SEARCH:t.toLowerCase(),SEARCH_CONVERTED:e.message("LANGUAGE_ID")=="ru"&&e.correctText?e.correctText(t.toLowerCase()):"",sessid:e.bitrix_sessid(),nt:typeof i!="undefined"&&i.length>0?i:"",DEPARTMENT_ID:parseInt(e.SocNetLogDestination.obSiteDepartmentID[n])>0?parseInt(e.SocNetLogDestination.obSiteDepartmentID[n]):0,EMAIL_USERS:e.SocNetLogDestination.obAllowSearchEmailUsers[n]?"Y":"N",CRMEMAIL:e.SocNetLogDestination.obAllowSearchCrmEmailUsers[n]?"Y":"N",CRMCONTACTEMAIL:e.SocNetLogDestination.obAllowAddCrmContact[n]?"Y":"N",NETWORK_SEARCH:e.SocNetLogDestination.obAllowSearchNetworkUsers[n]?"Y":"N",ADDITIONAL_SEARCH:"N",SELF:e.SocNetLogDestination.obAllowSearchSelf[n]?"Y":"N",SEARCH_SONET_GROUPS:e.SocNetLogDestination.obAllowSonetGroupsAjaxSearch[n]?"Y":"N",SEARCH_MAIL_CONTACTS:e.SocNetLogDestination.obAllowMailContactsAjaxSearch[n]?"Y":"N",SEARCH_ONLY_WITH_EMAIL:e.SocNetLogDestination.obSearchOnlyWithEmail[n]?"Y":"N",USE_PROJECTS:e.SocNetLogDestination.obProjectsEnable[n]?"Y":"N",SEARCH_SONET_FEATUES:e.SocNetLogDestination.obAllowSonetGroupsAjaxSearchFeatures[n],SITE_ID:e.message["SITE_ID"]||""};e.SocNetLogDestination.oXHR=e.ajax({url:e.SocNetLogDestination.obPathToAjax[n],method:"POST",dataType:"json",data:o,onsuccess:function(a){e.SocNetLogDestination.hideSearchWaiter(n);if(a){var s=typeof a.SEARCH!="undefined"?a.SEARCH:t;var r=e.clone(a);if(typeof a.USERS!="undefined"&&Object.keys(r.USERS).length>0){for(x in r.USERS){if(r.USERS.hasOwnProperty(x)&&(typeof r.USERS[x].active!="undefined"&&r.USERS[x].active=="N"||typeof r.USERS[x].isNetwork!="undefined"&&r.USERS[x].isNetwork=="Y")){delete r.USERS[x]}}}if(e.SocNetLogDestination.obUseClientDatabase[n]){e.onCustomEvent(e.SocNetLogDestination,"onFinderAjaxSuccess",[r.USERS,e.SocNetLogDestination])}if(!e.SocNetLogDestination.bResultMoved.search){if(!e.SocNetLogDestination.oAjaxUserSearchResult[n]||!e.SocNetLogDestination.oAjaxUserSearchResult[n][s.toLowerCase()]){e.SocNetLogDestination.oAjaxUserSearchResult[n]={};e.SocNetLogDestination.oAjaxUserSearchResult[n][s.toLowerCase()]=[]}if(typeof a.USERS!="undefined"){if(Object.keys(a.USERS).length>0){for(x in a.USERS){if(a.USERS.hasOwnProperty(x)){b=true;e.SocNetLogDestination.oAjaxUserSearchResult[n][s.toLowerCase()].push(x);if(typeof a.USERS[x].isNetwork!="undefined"&&a.USERS[x].isNetwork=="Y"){if(typeof e.SocNetLogDestination.obItems[n].network=="undefined"){e.SocNetLogDestination.obItems[n].network={}}e.SocNetLogDestination.obItems[n].network[x]=a.USERS[x];e.SocNetLogDestination.tmpSearchResult.ajax.push(x)}else{e.SocNetLogDestination.obItems[n].users[x]=a.USERS[x];e.SocNetLogDestination.tmpSearchResult.ajax.push(x)}}}}if(typeof a.CRM_EMAILS!="undefined"&&Object.keys(a.CRM_EMAILS).length>0){for(x in a.CRM_EMAILS){if(a.CRM_EMAILS.hasOwnProperty(x)){b=true;if(typeof e.SocNetLogDestination.obItems[n].crmemails=="undefined"){e.SocNetLogDestination.obItems[n].crmemails=[]}e.SocNetLogDestination.obItems[n].crmemails[x]=a.CRM_EMAILS[x];e.SocNetLogDestination.tmpSearchResult.ajax.push(x)}}}}if(e.SocNetLogDestination.obCrmFeed[n]){var c={contacts:"CONTACTS",companies:"COMPANIES",leads:"LEADS",deals:"DEALS"};for(type in c){for(x in a[c[type]]){if(a[c[type]].hasOwnProperty(x)){b=true;if(!e.SocNetLogDestination.obItems[n][type][x]){e.SocNetLogDestination.obItems[n][type][x]=a[c[type]][x];e.SocNetLogDestination.tmpSearchResult.ajax.push(x)}}}}}if(!b&&e.SocNetLogDestination.obAllowAddUser[n]){var l=e.SocNetLogDestination.checkEmail(t.trim());if(l!==false&&l.email&&l.email.length>0&&typeof e.SocNetLogDestination.obItems[n].users[l.email]=="undefined"){e.SocNetLogDestination.openInviteEmailUserDialog(l,n,e.SocNetLogDestination.obAllowAddCrmContact[n])}}if(typeof a.SONET_GROUPS!="undefined"){if(Object.keys(a.SONET_GROUPS).length>0){for(x in a.SONET_GROUPS){if(a.SONET_GROUPS.hasOwnProperty(x)){b=true;e.SocNetLogDestination.obItems[n].sonetgroups[x]=a.SONET_GROUPS[x];e.SocNetLogDestination.tmpSearchResult.ajax.push(x)}}}}if(typeof a.PROJECTS!="undefined"){if(Object.keys(a.PROJECTS).length>0){for(x in a.PROJECTS){if(a.PROJECTS.hasOwnProperty(x)){b=true;e.SocNetLogDestination.obItems[n].projects[x]=a.PROJECTS[x];e.SocNetLogDestination.tmpSearchResult.ajax.push(x)}}}}if(typeof a.MAIL_CONTACTS!="undefined"){if(Object.keys(a.MAIL_CONTACTS).length>0){for(x in a.MAIL_CONTACTS){if(a.MAIL_CONTACTS.hasOwnProperty(x)){b=true;if(typeof e.SocNetLogDestination.obItems[n].mailContacts=="undefined"){e.SocNetLogDestination.obItems[n].mailContacts={}}e.SocNetLogDestination.obItems[n].mailContacts[x]=a.MAIL_CONTACTS[x];e.SocNetLogDestination.tmpSearchResult.ajax.push(x)}}}}e.SocNetLogDestination.tmpSearchResult.ajax.filter(function(e,t,o){return t==o.indexOf(e)});e.SocNetLogDestination.search(t,false,n,i,{textAjax:s})}if(e.SocNetLogDestination.obAllowSearchNetworkUsers[n]){var d=e.findChildren(e.SocNetLogDestination.popupSearchWindowContent,{className:"bx-finder-groupbox-content"},true);e.SocNetLogDestination.searchButton=e.create("span",{props:{className:"bx-finder-box-button"},text:e.message("LM_POPUP_SEARCH_NETWORK")});var u=e.findChildren(d[0],{tagName:"a"},true);if(!u||u.length<=0){d[0].innerHTML=""}d[0].appendChild(e.SocNetLogDestination.searchButton);e.bind(e.SocNetLogDestination.searchButton,"click",function(){e.SocNetLogDestination.showSearchWaiter(n);e.SocNetLogDestination.searchNetwork(t,n,i,r,s,o)})}}},onfailure:function(t){e.SocNetLogDestination.hideSearchWaiter(n)}})},1e3)}}};e.SocNetLogDestination.searchNetwork=function(t,o,n,i,a,s){s["ADDITIONAL_SEARCH"]="Y";e.SocNetLogDestination.oXHR=e.ajax({url:e.SocNetLogDestination.obPathToAjax[o],method:"POST",dataType:"json",data:s,onsuccess:function(i){e.SocNetLogDestination.hideSearchWaiter(o);if(i&&typeof i.USERS!="undefined"){if(typeof e.SocNetLogDestination.obItems[o].network=="undefined"){e.SocNetLogDestination.obItems[o].network={}}for(var s in i.USERS){if(i.USERS.hasOwnProperty(s)){bFound=true;e.SocNetLogDestination.oAjaxUserSearchResult[o][a.toLowerCase()].push(s);e.SocNetLogDestination.obItems[o].network[s]=i.USERS[s]}}e.SocNetLogDestination.search(t,false,o,n,{textAjax:a})}else{e.SocNetLogDestination.popupSearchWindow.destroy()}},onfailure:function(t){e.SocNetLogDestination.hideSearchWaiter(o)}})};e.SocNetLogDestination.openSearch=function(t,o,n){if(!o){o="lm"}if(!n){n={}}if(e.SocNetLogDestination.popupWindow!=null){e.SocNetLogDestination.popupWindow.close()}if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close();return false}if(!!e.SocNetLogDestination.obUseContainer[o]){var i=false;if(e("bx-lm-box-search-content")){e("bx-lm-box-search-content").innerHTML=e.SocNetLogDestination.getItemLastHtml(t,true,o)}else{i=true;e.cleanNode(e("destSearchTabContent_"+o));e("destSearchTabContent_"+o).appendChild(e.SocNetLogDestination.getSearchContent(t,o,n))}e.SocNetLogDestination.SwitchTab(o,e("destSearchTab_"+o),"search");e.SocNetLogDestination.containerWindow.setAngle({});if(i){e.SocNetLogDestination.oSearchWaiterContentHeight=e.pos(e("bx-lm-box-search-tabs-content")).height}}else{var a=typeof n.bindNode!="undefined"?n.bindNode:e.SocNetLogDestination.obElementBindSearchPopup[o].node;e.SocNetLogDestination.popupSearchWindow=new e.PopupWindow({id:"BXSocNetLogDestinationSearch",bindElement:a,autoHide:true,zIndex:1200,className:"bx-finder-popup bx-finder-v2",offsetLeft:parseInt(e.SocNetLogDestination.obElementBindSearchPopup[o].offsetLeft),offsetTop:parseInt(e.SocNetLogDestination.obElementBindSearchPopup[o].offsetTop),bindOptions:e.SocNetLogDestination.obBindOptions[o],closeByEsc:true,lightShadow:true,events:{onPopupShow:function(){if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[o]&&e.SocNetLogDestination.obCallback[o].openSearch){e.SocNetLogDestination.obCallback[o].openSearch(o)}if(e.SocNetLogDestination.inviteEmailUserWindow&&e.SocNetLogDestination.inviteEmailUserWindow.isShown()){e.SocNetLogDestination.inviteEmailUserWindow.close()}},onPopupClose:function(){this.destroy();if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[o]&&e.SocNetLogDestination.obCallback[o].closeSearch){e.SocNetLogDestination.obCallback[o].closeSearch(o)}},onPopupDestroy:e.proxy(function(){e.SocNetLogDestination.popupSearchWindow=null;e.SocNetLogDestination.popupSearchWindowContent=null;if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[o]){if(e.SocNetLogDestination.obCallback[o].closeSearch){e.SocNetLogDestination.obCallback[o].closeSearch(o)}}},this)},content:e.SocNetLogDestination.getSearchContent(t,o,n)});e.SocNetLogDestination.popupSearchWindow.setAngle({});e.SocNetLogDestination.popupSearchWindow.show();e.SocNetLogDestination.oSearchWaiterContentHeight=e.pos(e("bx-lm-box-search-tabs-content")).height}e.SocNetLogDestination.popupSearchWindowContent=e("bx-lm-box-search-content")};e.SocNetLogDestination.drawItemsGroup=function(t,o,n,i,a,s){var r=typeof s.itemsHtml!="undefined"&&s.itemsHtml?s.itemsHtml:"";var c=true;var l=null;var d=t[o]?Object.keys(t[o]):[];for(var u in t[o]){if(u===true){c=false;break}}if(c){d.sort(function(e,n){return parseInt(t[o][e])-parseInt(t[o][n])})}for(var m=0;m<d.length;m++){l=d[m];if(!e.SocNetLogDestination.obItems[n][o][l]){continue}r+=e.SocNetLogDestination.getHtmlByTemplate7(n,e.SocNetLogDestination.obItems[n][o][l],{className:s.className+(o=="sonetgroups"&&typeof s.classNameExtranetGroup!="undefined"&&typeof window["arExtranetGroupID"]!="undefined"&&e.util.in_array(e.SocNetLogDestination.obItems[n][o][l].entityId,window["arExtranetGroupID"])?" "+s.classNameExtranetGroup:"")+(typeof e.SocNetLogDestination.obItems[n][o][l].active!="undefined"&&e.SocNetLogDestination.obItems[n][o][l].active=="N"?" bx-lm-element-inactive":""),descLessMode:typeof s.descLessMode!="undefined"&&s.descLessMode?true:false,emailDescMode:typeof s.emailDescMode!=="undefined"?s.emailDescMode===true:e.SocNetLogDestination.obEmailDescMode[n],itemType:o,search:i,avatarLessMode:typeof s.avatarLessMode!="undefined"&&s.avatarLessMode?true:false,itemHover:a<=0},i?"search":"last");a++}if(r!=""&&(typeof s.bHideGroup=="undefined"||!s.bHideGroup)){r='<span class="bx-finder-groupbox '+(typeof s.groupboxClassName!="undefined"?s.groupboxClassName:"bx-lm-groupbox-last")+'">'+'<span class="bx-finder-groupbox-name">'+s.title+":</span>"+'<span class="bx-finder-groupbox-content">'+r+"</span>"+"</span>"}return{html:r,count:a}};e.SocNetLogDestination.getItemLastHtml=function(t,o,n){if(!n){n="lm"}if(!t){t=e.SocNetLogDestination.obItemsLast[n]}var i="";var a=null;var s=0;var r=null;var c=null;for(var l=0;l<e.SocNetLogDestination.arDialogGroups[n].length;l++){c=e.SocNetLogDestination.arDialogGroups[n][l];if(c.bMail&&e.SocNetLogDestination.obSearchOnlyWithEmail[n]||c.bCrm&&e.SocNetLogDestination.obCrmFeed[n]||!c.bCrm&&(o||!e.SocNetLogDestination.obCrmFeed[n])){r=e.SocNetLogDestination.drawItemsGroup(t,c.groupCode,n,o,s,{itemsHtml:a?a:false,bHideGroup:typeof c.bHideGroup!="undefined"?c.bHideGroup:false,className:typeof c.className!="undefined"?c.className:false,classNameExtranetGroup:typeof c.classNameExtranetGroup!="undefined"?c.classNameExtranetGroup:false,groupboxClassName:typeof c.groupboxClassName!="undefined"?c.groupboxClassName:false,avatarLessMode:typeof c.avatarLessMode!="undefined"?c.avatarLessMode:false,descLessMode:typeof c.descLessMode!="undefined"?c.descLessMode:false,emailDescMode:typeof c.emailDescMode!=="undefined"?c.emailDescMode===true:e.SocNetLogDestination.obEmailDescMode[n],title:typeof c.title!="undefined"?c.title:""});if(r.html.length>0){if(c.bHideGroup!="undefined"&&c.bHideGroup){a=r.html}else{i+=r.html;a=null}}s=r.count}}if(i.length<=0){i='<span class="bx-finder-groupbox bx-lm-groupbox-search">'+'<span class="bx-finder-groupbox-content" id="bx-lm-box-waiter-content-text">'+e.message(o?"LM_SEARCH_PLEASE_WAIT":"LM_EMPTY_LIST")+"</span>"+"</span>"}return i};e.SocNetLogDestination.getItemDepartmentHtml=function(t,o,n,i){if(!t){t="lm"}n=n?n:false;i=i?true:false;var a=false;var s=null,r=null;if(typeof o=="undefined"||!o){o=e.SocNetLogDestination.obItems[t].departmentRelation;a=true}var c="";for(r in o){if(o.hasOwnProperty(r)&&o[r].type=="category"){var l=e.SocNetLogDestination.obItems[t].department[o[r].id];s=e.SocNetLogDestination.obItemsSelected[t][o[r].id]?e.SocNetLogDestination.obTemplateClassSelected["department"]:"";a=a&&l.id!="EX";c+='<div class="bx-finder-company-department'+(a?" bx-finder-company-department-opened":"")+'">\t\t\t\t<a href="#'+l.id+'" class="bx-finder-company-department-inner" onclick="return BX.SocNetLogDestination.OpenCompanyDepartment(\''+t+"', this.parentNode, '"+l.entityId+'\')" hidefocus="true">\t\t\t\t\t<div class="bx-finder-company-department-arrow"></div>\t\t\t\t\t<div class="bx-finder-company-department-text">'+l.name+"</div>\t\t\t\t</a>\t\t\t</div>";c+='<div class="bx-finder-company-department-children'+(a?" bx-finder-company-department-children-opened":"")+'">';if(!e.SocNetLogDestination.obDepartmentSelectDisable[t]&&!a&&l.id!="EX"){c+='<a class="bx-finder-company-department-check '+s+' bx-finder-element" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 'department', '"+o[r].id+"', 'department')\" rel=\""+o[r].id+'" href="#'+o[r].id+'">';c+='<span class="bx-finder-company-department-check-inner">\t\t\t\t\t\t<div class="bx-finder-company-department-check-arrow"></div>\t\t\t\t\t\t<div class="bx-finder-company-department-check-text" rel="'+l.name+": "+e.message("LM_POPUP_CHECK_STRUCTURE")+'">'+e.message("LM_POPUP_CHECK_STRUCTURE")+"</div>\t\t\t\t\t</span>\t\t\t\t</a>"}c+=e.SocNetLogDestination.getItemDepartmentHtml(t,o[r].items,l.entityId,a);c+="</div>"}}if(n){c+='<div class="bx-finder-company-department-employees" id="bx-lm-category-relation-'+n+'">';userCount=0;for(r in o){if(o.hasOwnProperty(r)&&o[r].type=="user"){var d=e.SocNetLogDestination.obItems[t].users[o[r].id];if(d==null){continue}s=e.SocNetLogDestination.obItemsSelected[t][o[r].id]?e.SocNetLogDestination.obTemplateClassSelected["department-user"]:"";c+='<a href="#'+d.id+'" class="bx-finder-company-department-employee '+s+' bx-finder-element" rel="'+d.id+'" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 'department-user', '"+d.id+'\', \'users\')" hidefocus="true">\t\t\t\t\t<div class="bx-finder-company-department-employee-info">\t\t\t\t\t\t<div class="bx-finder-company-department-employee-name">'+d.name+'</div>\t\t\t\t\t\t<div class="bx-finder-company-department-employee-position">'+d.desc+'</div>\t\t\t\t\t</div>\t\t\t\t\t<div style="'+(d.avatar?"background:url('"+d.avatar+"') no-repeat center center; background-size: cover;":"")+'" class="bx-finder-company-department-employee-avatar"></div>\t\t\t\t</a>';userCount++}}if(userCount<=0){if(!e.SocNetLogDestination.obDepartmentLoad[t][n]){c+='<div class="bx-finder-company-department-employees-loading">'+e.message("LM_PLEASE_WAIT")+"</div>"}if(i){e.SocNetLogDestination.getDepartmentRelation(t,n)}}c+="</div>"}return c};e.SocNetLogDestination.getTabContentHtml=function(t,o,n){if(!t){t="lm"}var i="";var a=0;var s=!!n.itemType?n.itemType:false;var r=null,c=true,l=false;var d=e.SocNetLogDestination.obEmailDescMode[t];var u=false,m;for(var S=0;S<e.SocNetLogDestination.arDialogGroups[t].length;S++){if(e.SocNetLogDestination.arDialogGroups[t][S].groupCode==o){m=e.SocNetLogDestination.arDialogGroups[t][S];u=true;break}}if(u){d=typeof m.emailDescMode!="undefined"?m.emailDescMode:d;c=typeof m.descLessMode!="undefined"?m.descLessMode:c;if(d===true){c=false}l=typeof m.avatarLessMode!="undefined"?m.avatarLessMode:l}if(o=="email"){r="bx-lm-element-user bx-lm-element-email"}else if(o=="crmemail"){r="bx-lm-element-user bx-lm-element-email bx-lm-element-crmemail"}if(s){for(var p in e.SocNetLogDestination.obItems[t][s]){if(!e.SocNetLogDestination.obItems[t][s].hasOwnProperty(p)){continue}if(o=="group"){r="bx-lm-element-sonetgroup"+(typeof window["arExtranetGroupID"]!="undefined"&&e.util.in_array(e.SocNetLogDestination.obItems[t].sonetgroups[p].entityId,window["arExtranetGroupID"])?" bx-lm-element-extranet":"")}else if(o=="project"){r="bx-lm-element-sonetgroup"+(typeof window["arExtranetGroupID"]!="undefined"&&e.util.in_array(e.SocNetLogDestination.obItems[t].projects[p].entityId,window["arExtranetGroupID"])?" bx-lm-element-extranet":"")}i+=e.SocNetLogDestination.getHtmlByTemplate7(t,e.SocNetLogDestination.obItems[t][s][p],{className:r,descLessMode:c,emailDescMode:d,avatarLessMode:l,itemType:s,itemHover:a<=0},o);a++}}return i};e.SocNetLogDestination.getDepartmentRelation=function(t,o){if(e.SocNetLogDestination.obDepartmentLoad[t][o]){return false}e.ajax({url:e.SocNetLogDestination.obPathToAjax[t],method:"POST",dataType:"json",data:{LD_DEPARTMENT_RELATION:"Y",DEPARTMENT_ID:o,sessid:e.bitrix_sessid(),nt:e.SocNetLogDestination.obUserNameTemplate[t]},onsuccess:function(n){e.SocNetLogDestination.obDepartmentLoad[t][o]=true;var i=e.util.object_search_key(o=="EX"?o:"DR"+o,e.SocNetLogDestination.obItems[t].departmentRelation);html="";for(var a in n.USERS){if(n.USERS.hasOwnProperty(a)){if(!e.SocNetLogDestination.obItems[t].users[a]){e.SocNetLogDestination.obItems[t].users[a]=n.USERS[a]}if(!i.items[a]){i.items[a]={id:a,type:"user"};var s=e.SocNetLogDestination.obItemsSelected[t][n.USERS[a].id]?e.SocNetLogDestination.obTemplateClassSelected["department-user"]:"";html+='<a href="#'+n.USERS[a].id+'" class="bx-finder-company-department-employee '+s+' bx-finder-element" rel="'+n.USERS[a].id+'" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 'department-user', '"+n.USERS[a].id+'\', \'users\')" hidefocus="true">\t\t\t\t\t\t\t<div class="bx-finder-company-department-employee-info">\t\t\t\t\t\t\t\t<div class="bx-finder-company-department-employee-name">'+n.USERS[a].name+'</div>\t\t\t\t\t\t\t\t<div class="bx-finder-company-department-employee-position">'+n.USERS[a].desc+'</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div style="'+(n.USERS[a].avatar?"background:url('"+n.USERS[a].avatar+"') no-repeat center center; background-size: cover;":"")+'" class="bx-finder-company-department-employee-avatar"></div>\t\t\t\t\t\t</a>'}}}e("bx-lm-category-relation-"+o).innerHTML=html;if(!!e.SocNetLogDestination.obUseContainer[t]){e.SocNetLogDestination.containerWindow.adjustPosition()}else{e.SocNetLogDestination.popupWindow.adjustPosition()}},onfailure:function(e){}})};e.SocNetLogDestination.getHtmlByTemplate1=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[1]:"";var a=n.itemHover?"bx-finder-box-item-hover":"";return'<a id="'+t+"_"+o.id+'" class="'+e.SocNetLogDestination.obTemplateClass[1]+" "+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 1, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" href="#'+o.id+'">\t\t<div class="bx-finder-box-item-text">'+o.name+"</div>\t</a>"};e.SocNetLogDestination.getHtmlByTemplate2=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[2]:"";var a=n.itemHover?"bx-finder-box-item-t2-hover":"";return'<a id="'+t+"_"+o.id+'" class="'+e.SocNetLogDestination.obTemplateClass[2]+" "+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 2, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" href="#'+o.id+'">\t\t<div class="bx-finder-box-item-t2-text">'+o.name+"</div>\t</a>"};e.SocNetLogDestination.getHtmlByTemplate3=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[3]:"";var a=n.itemHover?"bx-finder-box-item-t3-hover":"";return'<a id="'+t+"_"+o.id+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 3, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="'+e.SocNetLogDestination.obTemplateClass[3]+" "+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" href="#'+o.id+'">'+'<div class="bx-finder-box-item-t3-avatar" '+(o.avatar?"style=\"background:url('"+o.avatar+"') no-repeat center center; background-size: cover;\"":"")+"></div>"+'<div class="bx-finder-box-item-t3-info">'+'<div class="bx-finder-box-item-t3-name">'+o.name+"</div>"+(o.desc?'<div class="bx-finder-box-item-t3-desc">'+o.desc+"</div>":"")+"</div>"+'<div class="bx-clear"></div>'+"</a>"};e.SocNetLogDestination.getHtmlByTemplate5=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[5]:"";var a=n.itemHover?"bx-finder-box-item-t5-hover":"";return'<a id="'+t+"_"+o.id+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 5, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="'+e.SocNetLogDestination.obTemplateClass[5]+" "+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" href="#'+o.id+'">'+'<div class="bx-finder-box-item-t5-avatar" '+(o.avatar?"style=\"background:url('"+o.avatar+"') no-repeat center center; background-size: cover;\"":"")+"></div>"+'<div class="bx-finder-box-item-t5-info">'+'<div class="bx-finder-box-item-t5-name">'+o.name+"</div>"+(o.desc?'<div class="bx-finder-box-item-t5-desc">'+o.desc+"</div>":"")+"</div>"+'<div class="bx-clear"></div>'+"</a>"};e.SocNetLogDestination.getHtmlByTemplate6=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[6]:"";var a=n.itemHover?"bx-finder-box-item-t6-hover":"";return'<a id="'+t+"_"+o.id+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 6, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="'+e.SocNetLogDestination.obTemplateClass[6]+" "+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" href="#'+o.id+'">'+'<div class="bx-finder-box-item-t6-avatar" '+(o.avatar?"style=\"background:url('"+o.avatar+"') no-repeat center center; background-size: cover;\"":"")+"></div>"+'<div class="bx-finder-box-item-t6-info">'+'<div class="bx-finder-box-item-t6-name">'+o.name+"</div>"+(o.desc?'<div class="bx-finder-box-item-t6-desc">'+o.desc+"</div>":"")+"</div>"+'<div class="bx-clear"></div>'+"</a>"};e.SocNetLogDestination.getHtmlByTemplate7=function(t,o,n,i){if(!t){t="lm"}if(!n){n={}}if(!i){i=""}var a=e.type.isNotEmptyString(o.desc);a=n.descLessMode&&n.descLessMode==true?false:a;a=a||o.showDesc;var s=typeof n.emailDescMode!="undefined"&&n.emailDescMode==true;if(s===true){a=true}var r=e.SocNetLogDestination.obTemplateClass[7]+" bx-finder-element";r+=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[7]:"";r+=n.itemHover?" bx-finder-box-item-t7-hover":"";r+=a?" bx-finder-box-item-t7-desc-mode":"";r+=n.className?" "+n.className:"";r+=n.avatarLessMode&&n.avatarLessMode==true?" bx-finder-box-item-t7-avatarless":"";if(typeof o.isExtranet!="undefined"&&o.isExtranet=="Y"||typeof o.isNetwork!="undefined"&&o.isNetwork=="Y"){r+=" bx-lm-element-extranet"}if(typeof o.isCrmEmail!="undefined"&&o.isCrmEmail=="Y"){r+=" bx-lm-element-crmemail"}if(typeof o.isEmail!="undefined"&&o.isEmail=="Y"){r+=" bx-lm-element-email"}if(e.type.isNotEmptyString(n.itemType)&&n.itemType=="users"&&typeof e.SocNetLogDestination.obShowVacations[t]!="undefined"&&e.SocNetLogDestination.obShowVacations[t]===true&&typeof e.SocNetLogDestination.usersVacation[o.entityId]!="undefined"&&e.SocNetLogDestination.usersVacation[o.entityId]){r+=" bx-lm-element-vacation"}var c=o.name,l="";if(s===false&&typeof o.showEmail!="undefined"&&o.showEmail=="Y"&&typeof o.email!="undefined"&&o.email&&o.email.length>0){c+=" ("+o.email+")"}if(a){if(s===true&&typeof o.email!="undefined"&&o.email&&o.email.length){l=o.email}else{l=o.desc}}var d=o.iconCustom?"bx-finder-box-item-t7-avatar bx-finder-box-item-t7-avatar-custom":"bx-finder-box-item-t7-avatar";return'<a id="'+t+"_"+i+"_"+o.id+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 7, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="'+r+'" href="#'+o.id+'">'+(o.avatar?'<div class="bx-finder-box-item-t7-avatar"><img bx-lm-item-id="'+o.id+'" bx-lm-item-type="'+n.itemType+'" class="bx-finder-box-item-t7-avatar-img" src="'+o.avatar+"\" onerror=\"BX.onCustomEvent('removeClientDbObject', [BX.SocNetLogDestination, this.getAttribute('bx-lm-item-id'), this.getAttribute('bx-lm-item-type')]); BX.cleanNode(this, true);\"><span class=\"bx-finder-box-item-avatar-status\"></span></div>":'<div class="'+d+'">'+(o.iconCustom?o.iconCustom:"")+'<span class="bx-finder-box-item-avatar-status"></span></div>')+'<div class="bx-finder-box-item-t7-space"></div>'+'<div class="bx-finder-box-item-t7-info">'+'<div class="bx-finder-box-item-t7-name">'+c+"</div>"+(a?'<div class="bx-finder-box-item-t7-desc">'+l+"</div>":"")+"</div>"+"</a>"};e.SocNetLogDestination.SwitchTab=function(t,o,n){var i=e.findChildren(e.findChild(o.parentNode.parentNode,{tagName:"td",className:"bx-finder-box-tabs-content-cell"},true),{tagName:"div"});if(!i){return false}var a=0;var s=0;var r=e.findChildren(o.parentNode,{tagName:"a"});for(s=0;s<r.length;s++){if(r[s]===o){e.addClass(r[s],"bx-finder-box-tab-selected");a=s}else{e.removeClass(r[s],"bx-finder-box-tab-selected")}}for(s=0;s<i.length;s++){if(a===s){if(n=="last"){i[s].innerHTML=e.SocNetLogDestination.getItemLastHtml(false,false,t)}else if(n=="department"){i[s].innerHTML=e.SocNetLogDestination.getItemDepartmentHtml(t)}else if(e.util.in_array(n,["group","project","email","crmemail"])){var c=null;if(n=="email"){c="emails"}else if(n=="crmemail"){c="crmemails"}else if(n=="group"){c="sonetgroups"}else if(n=="project"){c="projects"}else if(n=="emailContacts"){c="emailContacts"}i[s].innerHTML=e.SocNetLogDestination.getTabContentHtml(t,n,{itemType:c})}else if(typeof e.SocNetLogDestination.obCustomTabs[t]!="undefined"){var l=null;for(var d=0;d<e.SocNetLogDestination.obCustomTabs[t].length;d++){l=e.SocNetLogDestination.obCustomTabs[t][d];if(l.id==n){if(typeof l.itemType!="undefined"){i[s].innerHTML=e.SocNetLogDestination.getTabContentHtml(t,n,{itemType:l.itemType})}break}}}e.addClass(i[s],"bx-finder-box-tab-content-selected")}else{e.removeClass(i[s],"bx-finder-box-tab-content-selected")}}var u={id:t};e.onCustomEvent(window,"BX.SocNetLogDestination:onBeforeSwitchTabFocus",[u]);setTimeout(function(){if(typeof u.blockFocus=="undefined"||!u.blockFocus){e.focus(e.SocNetLogDestination.obElementSearchInput[t])}},1);if(n=="last"){e.SocNetLogDestination.initResultNavigation(t,"last",e.SocNetLogDestination.obItemsLast[t])}else if(n=="group"){e.SocNetLogDestination.initResultNavigation(t,n,{sonetgroups:e.SocNetLogDestination.obItems[t].sonetgroups})}else if(n=="project"){e.SocNetLogDestination.initResultNavigation(t,n,{projects:e.SocNetLogDestination.obItems[t].projects})}else if(n=="mailContacts"){e.SocNetLogDestination.initResultNavigation(t,n,{mailContacts:e.SocNetLogDestination.obItems[t].mailContacts})}else if(n=="email"){e.SocNetLogDestination.initResultNavigation(t,n,{emails:e.SocNetLogDestination.obItems[t].emails})}else if(n=="crmemail"){e.SocNetLogDestination.initResultNavigation(t,n,{crmemails:e.SocNetLogDestination.obItems[t].crmemails})}if(typeof e.SocNetLogDestination.obCustomTabs[t]!="undefined"){for(s=0;s<e.SocNetLogDestination.obCustomTabs[t].length;s++){if(e.SocNetLogDestination.obCustomTabs[t][s].id==n){var m={};m[e.SocNetLogDestination.obCustomTabs[t][s].itemType]=e.SocNetLogDestination.obItems[t][e.SocNetLogDestination.obCustomTabs[t][s].itemType];e.SocNetLogDestination.initResultNavigation(t,e.SocNetLogDestination.obCustomTabs[t][s].id,m);break}}}e.SocNetLogDestination.obTabSelected[t]=n;if(!!e.SocNetLogDestination.obUseContainer[t]){e.SocNetLogDestination.containerWindow.adjustPosition()}else{e.SocNetLogDestination.popupWindow.adjustPosition()}return false};e.SocNetLogDestination.OpenCompanyDepartment=function(t,o,n){if(!t)t="lm";e.toggleClass(o,"bx-finder-company-department-opened");var i=e.findNextSibling(o,{tagName:"div"});if(e.hasClass(i,"bx-finder-company-department-children"))e.toggleClass(i,"bx-finder-company-department-children-opened");e.SocNetLogDestination.getDepartmentRelation(t,n);return false};Object.size=function(e){var t=0,o;for(o in e){if(e.hasOwnProperty(o))t++}return t};e.SocNetLogDestination.selectItem=function(t,o,n,i,a,s){if(!t){t="lm"}var r={id:t};e.onCustomEvent(window,"BX.SocNetLogDestination:onBeforeSelectItemFocus",[r]);setTimeout(function(){if(typeof r.blockFocus=="undefined"||!r.blockFocus){e.focus(e.SocNetLogDestination.obElementSearchInput[t])}},1);if(e.SocNetLogDestination.obItemsSelected[t][i]){return e.SocNetLogDestination.unSelectItem(t,o,n,i,a,s)}e.SocNetLogDestination.obItemsSelected[t][i]=a;if(!e.type.isArray(e.SocNetLogDestination.obItemsLast[t][a])&&!e.type.isPlainObject(e.SocNetLogDestination.obItemsLast[t][a])){e.SocNetLogDestination.obItemsLast[t][a]={}}e.SocNetLogDestination.obItemsLast[t][a][i]=i;if(!(o==null||n==null)){e.SocNetLogDestination.changeItemClass(o,n,true)}e.SocNetLogDestination.runSelectCallback(i,a,t,s,"select");if(s===true){if(e.SocNetLogDestination.popupWindow!=null){e.SocNetLogDestination.popupWindow.close()}e.SocNetLogDestination.abortSearchRequest();if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}}else{if(e.SocNetLogDestination.popupWindow!=null)e.SocNetLogDestination.popupWindow.adjustPosition();if(e.SocNetLogDestination.popupSearchWindow!=null)e.SocNetLogDestination.popupSearchWindow.adjustPosition()}var c=Object.size(e.SocNetLogDestination.obItemsLast[t][a]);var l=null;var d=0;if(c>5){l={};var u=0;var m=c-5;for(d in e.SocNetLogDestination.obItemsLast[t][a]){if(e.SocNetLogDestination.obItemsLast[t][a].hasOwnProperty(d)&&u>=m){l[e.SocNetLogDestination.obItemsLast[t][a][d]]=e.SocNetLogDestination.obItemsLast[t][a][d]}u++}}else{l=e.SocNetLogDestination.obItemsLast[t][a]}e.userOptions.save("socialnetwork","log_destination",a,JSON.stringify(l));if(e.util.in_array(a,["contacts","companies","leads","deals"])&&e.SocNetLogDestination.obCrmFeed[t]){var S=[i];for(d=0;d<e.SocNetLogDestination.obItemsLast[t].crm.length&&S.length<20;d++){if(e.SocNetLogDestination.obItemsLast[t].crm[d]!=i){S.push(e.SocNetLogDestination.obItemsLast[t].crm[d])}}e.SocNetLogDestination.obItemsLast[t].crm=S;e.userOptions.save("crm","log_destination","items",S)}return false};e.SocNetLogDestination.unSelectItem=function(t,o,n,i,a,s){if(!t){t="lm"}if(!e.SocNetLogDestination.obItemsSelected[t][i]){return false}else{delete e.SocNetLogDestination.obItemsSelected[t][i]}e.SocNetLogDestination.changeItemClass(o,n,false);e.SocNetLogDestination.runUnSelectCallback(i,a,t,s);if(s===true){if(e.SocNetLogDestination.popupWindow!=null){e.SocNetLogDestination.popupWindow.close()}if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}}else{if(e.SocNetLogDestination.popupWindow!=null)e.SocNetLogDestination.popupWindow.adjustPosition();if(e.SocNetLogDestination.popupSearchWindow!=null)e.SocNetLogDestination.popupSearchWindow.adjustPosition()}return false};e.SocNetLogDestination.runSelectCallback=function(t,o,n,i,a){if(!n){n="lm"}if(!i){i=false}if(e.SocNetLogDestination.obCallback[n]&&e.SocNetLogDestination.obCallback[n].select&&e.SocNetLogDestination.obItems[n][o]&&e.SocNetLogDestination.obItems[n][o][t]){e.SocNetLogDestination.obCallback[n].select(e.SocNetLogDestination.obItems[n][o][t],o,i,e.util.in_array(t,e.SocNetLogDestination.obItemsSelectedUndeleted[n]),n,a)}};e.SocNetLogDestination.runUnSelectCallback=function(t,o,n,i){if(!n)n="lm";if(!i)i=false;delete e.SocNetLogDestination.obItemsSelected[n][t];if(e.SocNetLogDestination.obCallback[n]&&e.SocNetLogDestination.obCallback[n].unSelect&&e.SocNetLogDestination.obItems[n][o]&&e.SocNetLogDestination.obItems[n][o][t]){e.SocNetLogDestination.obCallback[n].unSelect(e.SocNetLogDestination.obItems[n][o][t],o,i,n)}};e.SocNetLogDestination.deleteItem=function(t,o,n){if(!n)n="lm";for(var i in e.SocNetLogDestination.obResult){if(e.SocNetLogDestination.obResult.hasOwnProperty(i)){var a=n+"_"+i+"_"+t;if(e(a)){var s=null;for(var r in e.SocNetLogDestination.obTemplateClassSelected){if(e.SocNetLogDestination.obTemplateClassSelected.hasOwnProperty(r)&&e.hasClass(e(a),e.SocNetLogDestination.obTemplateClassSelected[r])){s=r;break}}if(!!s){e.SocNetLogDestination.changeItemClass(e(a),r,false)}}}}e.SocNetLogDestination.runUnSelectCallback(t,o,n)};e.SocNetLogDestination.deleteLastItem=function(t){if(!t)t="lm";var o=false;for(var n in e.SocNetLogDestination.obItemsSelected[t]){if(e.SocNetLogDestination.obItemsSelected[t].hasOwnProperty(n)){o=n}}if(o){var i=e.SocNetLogDestination.obItemsSelected[t][o];e.SocNetLogDestination.runUnSelectCallback(o,i,t)}};e.SocNetLogDestination.initResultNavigation=function(t,o,n){e.SocNetLogDestination.obCurrentElement[o]=null;e.SocNetLogDestination.obResult[o]=[];e.SocNetLogDestination.obCursorPosition[o]={group:0,row:0,column:0};var i=0;var a=null;var s=null;var r=null;var c=-1;var l=0;var d=0;var u=false;var m=null;var S=0;for(S=0;S<e.SocNetLogDestination.arDialogGroups[t].length;S++){s=e.SocNetLogDestination.arDialogGroups[t][S].groupCode;if(s=="users"){if(o=="email"){s="emails"}else if(o=="crmemails"){s="crmemails"}}if(typeof n[s]=="undefined"){continue}if(u){u=false}else{a=0}for(r in n[s]){if(!n[s].hasOwnProperty(r)||!e.SocNetLogDestination.obItems[t][s][r]){continue}if(a==0){if(s=="groups"){u=true}c++;e.SocNetLogDestination.obResult[o][c]=[];l=0;d=0}if(d==2){l++;d=0}if(typeof e.SocNetLogDestination.obResult[o][c][l]=="undefined"){e.SocNetLogDestination.obResult[o][c][l]=[]}m={id:r,type:s};e.SocNetLogDestination.obResult[o][c][l][d]=m;if(i<=0){e.SocNetLogDestination.obCurrentElement[o]=m}d++;a++;i++}}};e.SocNetLogDestination.selectFirstSearchItem=function(t){if(!t)t="lm";var o=e.SocNetLogDestination.obSearchFirstElement;if(o!=null){e.SocNetLogDestination.selectItem(t,null,null,o.id,o.type,true);e.SocNetLogDestination.obSearchFirstElement=null}};e.SocNetLogDestination.selectCurrentSearchItem=function(t){e.SocNetLogDestination.selectCurrentItem("search",t)};e.SocNetLogDestination.selectCurrentItem=function(t,o,n){if(e.SocNetLogDestination.popupSearchWindow==null&&e.SocNetLogDestination.popupWindow==null&&e.SocNetLogDestination.containerWindow==null){return}if(!o){o="lm"}if(t=="search"){clearTimeout(e.SocNetLogDestination.searchTimeout);e.SocNetLogDestination.abortSearchRequest()}var i=e.SocNetLogDestination.obCurrentElement[t];if(i!=null){var a=e(o+"_"+t+"_"+i.id);var s=e.SocNetLogDestination.getTemplateByItemClass(a);e.SocNetLogDestination.selectItem(o,a?a:null,s?s:null,i.id,i.type,i.type==="search");if(typeof n=="undefined"||typeof n.closeDialog=="undefined"||n.closeDialog){e.SocNetLogDestination.obCurrentElement[t]=null;if(e.SocNetLogDestination.isOpenDialog()){e.SocNetLogDestination.closeDialog()}e.SocNetLogDestination.closeSearch()}}};e.SocNetLogDestination.moveCurrentSearchItem=function(t,o){e.SocNetLogDestination.moveCurrentItem("search",t,o)};e.SocNetLogDestination.moveCurrentItem=function(t,o,n){if(e.SocNetLogDestination.popupSearchWindow==null&&e.SocNetLogDestination.popupWindow==null&&e.SocNetLogDestination.containerWindow==null){return}e.SocNetLogDestination.bResultMoved[t]=true;if(t=="search"&&e.SocNetLogDestination.oXHR){e.SocNetLogDestination.abortSearchRequest();e.SocNetLogDestination.hideSearchWaiter(o)}if(!e.SocNetLogDestination.obCursorPosition[t]){e.SocNetLogDestination.obCursorPosition[t]={group:0,row:0,column:0}}var i=false;switch(n){case"left":if(e.SocNetLogDestination.focusOnTabs){e.SocNetLogDestination.moveCurrentTab(t,o,n)}else if(e.SocNetLogDestination.obCursorPosition[t].column==1){if(typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row][e.SocNetLogDestination.obCursorPosition[t].column-1]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].column--;i=true}}break;case"right":if(e.SocNetLogDestination.focusOnTabs){e.SocNetLogDestination.moveCurrentTab(t,o,n)}else if(e.SocNetLogDestination.obCursorPosition[t].column==0){if(typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row][e.SocNetLogDestination.obCursorPosition[t].column+1]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].column++;i=true}}break;case"up":if(e.SocNetLogDestination.obCursorPosition[t].row>0&&typeof e.SocNetLogDestination.obResult[t]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row-1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row-1][e.SocNetLogDestination.obCursorPosition[t].column]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].row--;i=true}else if(e.SocNetLogDestination.obCursorPosition[t].row==0&&typeof e.SocNetLogDestination.obResult[t]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1][e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1].length-1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1][e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1].length-1][0]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].row=e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1].length-1;e.SocNetLogDestination.obCursorPosition[t].column=0;e.SocNetLogDestination.obCursorPosition[t].group--;i=true}else if(e.SocNetLogDestination.obCursorPosition[t].group==0&&e.SocNetLogDestination.obCursorPosition[t].row==0&&e.util.in_array(t,e.SocNetLogDestination.obTabs[o])){}break;case"down":if(e.SocNetLogDestination.focusOnTabs){}else if(typeof e.SocNetLogDestination.obResult[t]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row+1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row+1][e.SocNetLogDestination.obCursorPosition[t].column]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].row++;i=true}else if(typeof e.SocNetLogDestination.obResult[t]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row+1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row+1][0]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].column=0;e.SocNetLogDestination.obCursorPosition[t].row++;i=true}else if(typeof e.SocNetLogDestination.obResult[t]!="undefined"&&e.SocNetLogDestination.obCursorPosition[t].row==e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group].length-1&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group+1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group+1][0]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group+1][0][0]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].group++;e.SocNetLogDestination.obCursorPosition[t].row=0;e.SocNetLogDestination.obCursorPosition[t].column=0;i=true}break;default:}if(i){var a=e.SocNetLogDestination.obCurrentElement[t].id;e.SocNetLogDestination.obCurrentElement[t]=e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row][e.SocNetLogDestination.obCursorPosition[t].column];if(e(o+"_"+t+"_"+a)){e.SocNetLogDestination.unhoverItem(e(o+"_"+t+"_"+a))}var s=e(o+"_"+t+"_"+e.SocNetLogDestination.obCurrentElement[t].id);var r=null;if(t=="search"){r=e("bx-lm-box-search-tabs-content")}else if(t=="last"){r=e("bx-lm-box-last-content")}else if(t=="group"){r=e("bx-lm-box-group-content")}else if(t=="email"){r=e("bx-lm-box-email-content")}else if(t=="crmemail"){r=e("bx-lm-box-crmemail-content")}else if(e("dest"+t+"TabContent_"+o)){r=e("dest"+t+"TabContent_"+o)}if(s&&r){var c=e.pos(r);var l=e.pos(s);if(l.bottom>c.bottom||l.top<c.top){r.scrollTop+=l.bottom>c.bottom?l.bottom-c.bottom:l.top-c.top}e.SocNetLogDestination.hoverItem(s)}}};e.SocNetLogDestination.moveCurrentTab=function(t,o,n){var i={last:"destLastTab",group:"destGroupTab",department:"destDepartmentTab"};var a=e.util.array_search(t,e.SocNetLogDestination.obTabs[o]);if(a>=0){if(n=="right"){a++}else if(n=="left"){a--}if(a<=e.SocNetLogDestination.obTabs[o].length-1&&a>=0&&typeof e.SocNetLogDestination.obTabs[o][a]!="undefined"){e.SocNetLogDestination.SwitchTab(o,e(i[e.SocNetLogDestination.obTabs[o][a]]+"_"+o),e.SocNetLogDestination.obTabs[o][a])}}};e.SocNetLogDestination.getItemHoverClassName=function(e){if(!e){return false}if(e.classList.contains("bx-finder-box-item-t1")){return"bx-finder-box-item-t1-hover"}else if(e.classList.contains("bx-finder-box-item-t2")){return"bx-finder-box-item-t2-hover"}else if(e.classList.contains("bx-finder-box-item-t3")){return"bx-finder-box-item-t3-hover"}else if(e.classList.contains("bx-finder-box-item-t4")){return"bx-finder-box-item-t4-hover"}else if(e.classList.contains("bx-finder-box-item-t5")){return"bx-finder-box-item-t5-hover"}else if(e.classList.contains("bx-finder-box-item-t6")){return"bx-finder-box-item-t6-hover"}else if(e.classList.contains("bx-finder-box-item-t7")){return"bx-finder-box-item-t7-hover"}return false};e.SocNetLogDestination.hoverItem=function(t){var o=e.SocNetLogDestination.getItemHoverClassName(t);if(o){e.addClass(t,o)}};e.SocNetLogDestination.unhoverItem=function(t){var o=e.SocNetLogDestination.getItemHoverClassName(t);if(o){e.removeClass(t,o)}};e.SocNetLogDestination.getSelectedCount=function(t){if(!t)t="lm";var o=0;for(var n in e.SocNetLogDestination.obItemsSelected[t]){if(e.SocNetLogDestination.obItemsSelected[t].hasOwnProperty(n)){o++}}return o};e.SocNetLogDestination.getSelected=function(t){if(!t)t="lm";return e.SocNetLogDestination.obItemsSelected[t]};e.SocNetLogDestination.isOpenDialog=function(){return e.SocNetLogDestination.popupWindow!=null||e.SocNetLogDestination.containerWindow!=null};e.SocNetLogDestination.isOpenSearch=function(){return e.SocNetLogDestination.popupSearchWindow!=null||e.SocNetLogDestination.containerWindow!=null};e.SocNetLogDestination.isOpenContainer=function(){return e.SocNetLogDestination.containerWindow!=null};e.SocNetLogDestination.closeDialog=function(t){t=t===true;if(e.SocNetLogDestination.popupWindow!=null){if(t){e.SocNetLogDestination.popupWindow.destroy()}else{e.SocNetLogDestination.popupWindow.close()}}else if(e.SocNetLogDestination.containerWindow!=null){if(t){e.SocNetLogDestination.containerWindow.destroy()}else{e.SocNetLogDestination.containerWindow.close()}}e.onCustomEvent(window,"BX.SocNetLogDestination:onDialogClose",[this]);return true};e.SocNetLogDestination.closeSearch=function(){if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}else if(e.SocNetLogDestination.containerWindow!=null){e.SocNetLogDestination.containerWindow.close()}return true};e.SocNetLogDestination.createSocNetGroupContent=function(t){return e.create("div",{children:[e.create("div",{text:e.message("LM_CREATE_SONETGROUP_TITLE").replace("#TITLE#",t)})]})};e.SocNetLogDestination.createSocNetGroupButtons=function(t,o){return[new e.PopupWindowButton({text:e.message("LM_CREATE_SONETGROUP_BUTTON_CREATE"),events:{click:function(){var n="SGN"+e.SocNetLogDestination.obNewSocNetGroupCnt[o]+"";e.SocNetLogDestination.obItems[o]["sonetgroups"][n]={id:n,entityId:e.SocNetLogDestination.obNewSocNetGroupCnt[o],name:t,desc:""};var i={sonetgroups:{}};i["sonetgroups"][n]=true;if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindowContent.innerHTML=e.SocNetLogDestination.getItemLastHtml(i,true,o)}else{e.SocNetLogDestination.openSearch(i,o)}e.SocNetLogDestination.obNewSocNetGroupCnt[o]++;e.SocNetLogDestination.createSocNetGroupWindow.close()}}}),new e.PopupWindowButtonLink({text:e.message("LM_CREATE_SONETGROUP_BUTTON_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){e.SocNetLogDestination.createSocNetGroupWindow.close()}}})]};e.SocNetLogDestination.showSearchWaiter=function(t){if(typeof e.SocNetLogDestination.oSearchWaiterEnabled[t]=="undefined"||!e.SocNetLogDestination.oSearchWaiterEnabled[t]){if(e.SocNetLogDestination.oSearchWaiterContentHeight>0){e.SocNetLogDestination.oSearchWaiterEnabled[t]=true;var o=0;var n=40;e.SocNetLogDestination.animateSearchWaiter(o,n,t)}}};e.SocNetLogDestination.hideSearchWaiter=function(t){if(typeof e.SocNetLogDestination.oSearchWaiterEnabled[t]!="undefined"&&e.SocNetLogDestination.oSearchWaiterEnabled[t]){e.SocNetLogDestination.oSearchWaiterEnabled[t]=false;var o=40;var n=0;e.SocNetLogDestination.animateSearchWaiter(o,n,t)}};e.SocNetLogDestination.animateSearchWaiter=function(t,o,n){var i=!!e.SocNetLogDestination.obUseContainer[n]?e("bx-lm-box-last-content"):e("bx-lm-box-search-tabs-content");if(e("bx-lm-box-search-waiter")&&i){new e.fx({time:.5,step:.05,type:"linear",start:t,finish:o,callback:e.delegate(function(e){if(this){this.waiterBlock.style.height=e+"px"}},{waiterBlock:e("bx-lm-box-search-waiter"),contentBlock:i}),callback_complete:function(){}}).start()}};e.SocNetLogDestination.changeItemClass=function(t,o,n){if(t&&typeof e.SocNetLogDestination.obTemplateClassSelected[o]!="undefined"){if(n){e.addClass(t,e.SocNetLogDestination.obTemplateClassSelected[o])}else{e.removeClass(t,e.SocNetLogDestination.obTemplateClassSelected[o])}}};e.SocNetLogDestination.getTemplateByItemClass=function(t){if(t){for(var o in e.SocNetLogDestination.obTemplateClass){if(e.SocNetLogDestination.obTemplateClass.hasOwnProperty(o)&&e.hasClass(t,e.SocNetLogDestination.obTemplateClass[o])){return o}}}};e.SocNetLogDestination.BXfpSetLinkName=function(t){if(typeof t.tagInputName!="undefined"&&!!t.tagInputName&&e(t.tagInputName)){e(t.tagInputName).innerHTML=e.SocNetLogDestination.getSelectedCount(t.formName)<=0?t.tagLink1:t.tagLink2}};e.SocNetLogDestination.BXfpSelectCallback=function(t){if(!e.findChild(t.containerInput,{attr:{"data-id":t.item.id}},false,false)){var o=t.type;var n="S";if(e.util.in_array(t.type,["contacts","companies","leads","deals"])){o="crm"}if(t.type=="sonetgroups"){n="SG";if(typeof window["arExtranetGroupID"]!="undefined"&&e.util.in_array(t.item.entityId,window["arExtranetGroupID"])){o="extranet"}}else if(t.type=="groups"){n="UA";o="all-users"}else if(e.util.in_array(o,["users","emails"])){n=e.SocNetLogDestination.checkEmail(t.item.id)?"UE":"U";if(typeof t.item.isCrmEmail!="undefined"&&t.item.isCrmEmail=="Y"){o="crmemail"}else if(typeof t.item.isEmail!="undefined"&&t.item.isEmail=="Y"){o="email"}else if(typeof t.item.isExtranet!="undefined"&&t.item.isExtranet=="Y"){o="extranet"}}else if(t.type=="crmemails"){n=t.item.id.match(/(C|CO|L)_\d+/)?"UE":"U";o="crmemail"}else if(t.type=="mailContacts"){o="email"}else if(t.type=="department"){n="DR"}else if(t.type=="contacts"){n="CRMCONTACT"}else if(t.type=="companies"){n="CRMCOMPANY"}else if(t.type=="leads"){n="CRMLEAD"}else if(t.type=="deals"){n="CRMDEAL"}var i=t.bUndeleted?" feed-add-post-destination-undelete":"";var a=t.item.name+(typeof t.item.showEmail!="undefined"&&t.item.showEmail=="Y"&&typeof t.item.email!="undefined"&&t.item.email&&t.item.email.length>0?" ("+t.item.email+")":"");var s=[e.create("span",{props:{className:"feed-add-post-destination-text"},html:a})];var r=e.SocNetLogDestination.getHidden(n,t.item,typeof t.varName!="undefined"?t.varName:false);if(!e.SocNetLogDestination.obShowSearchInput[t.formName]){s=e.util.array_merge(s,r)}var c=e.create("span",{attrs:{"data-id":t.item.id,"data-type":t.type},props:{className:"feed-add-post-destination feed-add-post-destination-"+o+i},children:s});if(!t.bUndeleted){c.appendChild(e.create("span",{props:{className:"feed-add-post-del-but"},events:{click:function(o){e.SocNetLogDestination.deleteItem(t.item.id,t.type,t.formName);e.PreventDefault(o)},mouseover:function(){e.addClass(this.parentNode,"feed-add-post-destination-hover")},mouseout:function(){e.removeClass(this.parentNode,"feed-add-post-destination-hover")}}}))}t.containerInput.appendChild(c)}if(!!e.SocNetLogDestination.obShowSearchInput[t.formName]&&!!e.SocNetLogDestination.obElementSearchInputHidden[t.formName]){if(!e.findChild(e.SocNetLogDestination.obElementSearchInputHidden[t.formName],{attr:{"data-id":t.item.id}},false,false)){e.SocNetLogDestination.obElementSearchInputHidden[t.formName].appendChild(e.create("span",{attrs:{"data-id":t.item.id,"data-type":t.type},children:r}))}}t.valueInput.value="";e.SocNetLogDestination.BXfpSetLinkName({formName:t.formName,tagInputName:typeof t.tagInputName!="undefined"?t.tagInputName:false,tagLink1:t.tagLink1,tagLink2:t.tagLink2})};e.SocNetLogDestination.BXfpUnSelectCallback=function(t){var o=e.findChildren(e(this.inputContainerName),{attribute:{"data-id":""+t.id+""}},true);if(o!==null){for(var n=0;n<o.length;n++){if(typeof this.undeleteClassName=="undefined"||!e.hasClass(o[n],this.undeleteClassName)){e.remove(o[n])}}}e(this.inputName).value="";e.SocNetLogDestination.BXfpSetLinkName(this);if(!!e.SocNetLogDestination.obShowSearchInput[this.formName]&&!!e.SocNetLogDestination.obElementSearchInputHidden[this.formName]){o=e.findChildren(e.SocNetLogDestination.obElementSearchInputHidden[this.formName],{attribute:{"data-id":""+t.id+""}},true);if(o!==null){for(var i=0;i<o.length;i++){if(typeof this.undeleteClassName=="undefined"||!e.hasClass(o[i],this.undeleteClassName)){e.remove(o[i])}}}}};e.SocNetLogDestination.BXfpSearch=function(t){return e.SocNetLogDestination.searchHandler(t,{formName:this.formName,inputId:this.inputName,inputNode:e.type.isDomNode(this.inputNode)?this.inputNode:null,linkId:this.tagInputName,sendAjax:typeof this.sendAjax!="undefined"?this.sendAjax:true,multiSelect:true,onPasteEvent:typeof this.onPasteEvent!="undefined"?this.onPasteEvent:false})};e.SocNetLogDestination.BXfpSearchBefore=function(t){return e.SocNetLogDestination.searchBeforeHandler(t,{formName:this.formName,inputId:this.inputName,inputNode:e.type.isDomNode(this.inputNode)?this.inputNode:null})};e.SocNetLogDestination.BXfpOpenDialogCallback=function(){if(typeof this.inputBoxName!="undefined"){e.style(e(this.inputBoxName),"display","inline-block")}if(typeof this.tagInputName!="undefined"){e.style(e(this.tagInputName),"display","none")}e.defer(e.focus)(e(this.inputName))};e.SocNetLogDestination.BXfpCloseDialogCallback=function(){if(!e.SocNetLogDestination.isOpenSearch()&&e(this.inputName)&&e(this.inputName).value.length<=0){if(typeof this.inputBoxName!="undefined"){e.style(e(this.inputBoxName),"display","none")}if(typeof this.tagInputName!="undefined"){e.style(e(this.tagInputName),"display","inline-block")}e.SocNetLogDestination.BXfpDisableBackspace()}};e.SocNetLogDestination.BXfpCloseSearchCallback=function(){if(!e.SocNetLogDestination.isOpenSearch()&&e(this.inputName).value.length>0){if(typeof this.inputBoxName!="undefined"){e.style(e(this.inputBoxName),"display","none")}if(typeof this.tagInputName!="undefined"){e.style(e(this.tagInputName),"display","inline-block")}e(this.inputName).value="";e.SocNetLogDestination.BXfpDisableBackspace()}};e.SocNetLogDestination.BXfpDisableBackspace=function(t){if(e.SocNetLogDestination.backspaceDisable||e.SocNetLogDestination.backspaceDisable!==null){e.unbind(window,"keydown",e.SocNetLogDestination.backspaceDisable)}e.bind(window,"keydown",e.SocNetLogDestination.backspaceDisable=function(t){if(t.keyCode==8&&!e.util.in_array(t.target.tagName.toLowerCase(),["input","textarea"])){e.PreventDefault(t);return false}});setTimeout(function(){e.unbind(window,"keydown",e.SocNetLogDestination.backspaceDisable);e.SocNetLogDestination.backspaceDisable=null},5e3)};e.SocNetLogDestination.BXfpBlurInput=function(t){if((e.SocNetLogDestination.popupSearchWindow==null||!e.SocNetLogDestination.popupSearchWindow.isShown())&&(e.SocNetLogDestination.popupWindow==null||!e.SocNetLogDestination.popupWindow.isShown())&&(e.SocNetLogDestination.inviteEmailUserWindow==null||!e.SocNetLogDestination.inviteEmailUserWindow.isShown())){var o=e.proxy_context;if(o&&o.tagName.toUpperCase()=="INPUT"&&e.type.isNotEmptyString(o.value)){o.value=""}var n=e.type.isDomNode(this.inputBoxName)?this.inputBoxName:e.type.isNotEmptyString(this.inputBoxName)?e(this.inputBoxName):null;if(n){e.style(n,"display","none")}var i=e.type.isDomNode(this.tagInputName)?this.tagInputName:e.type.isNotEmptyString(this.tagInputName)?e(this.tagInputName):null;if(i){e.style(i,"display","inline-block")}}};e.SocNetLogDestination.searchHandler=function(t,o){var n=typeof o.onPasteEvent!="undefined"&&o.onPasteEvent;if(!this.searchStarted&&!n){return false}this.searchStarted=false;if(!n&&(t.keyCode==16||t.keyCode==17||t.keyCode==18||t.keyCode==20||t.keyCode==244||t.keyCode==224||t.keyCode==91||t.keyCode==93||t.keyCode==9)){return false}var i=null;if(e.SocNetLogDestination.popupSearchWindow!=null){i="search"}else if(typeof t.keyCode!="undefined"&&e.util.in_array(t.keyCode,[37,38,39,40,13])&&e.util.in_array(e.SocNetLogDestination.obTabSelected[o.formName],["department"])){return true}else{i=e.SocNetLogDestination.obTabSelected[o.formName]}if(typeof t.keyCode!="undefined"&&i){if(t.keyCode==37){e.SocNetLogDestination.moveCurrentItem(i,o.formName,"left");e.PreventDefault(t);return false}else if(t.keyCode==38){e.SocNetLogDestination.moveCurrentItem(i,o.formName,"up");e.PreventDefault(t);return false}else if(t.keyCode==39){e.SocNetLogDestination.moveCurrentItem(i,o.formName,"right");e.PreventDefault(t);return false}else if(t.keyCode==40){e.SocNetLogDestination.moveCurrentItem(i,o.formName,"down");e.PreventDefault(t);return false}else if(t.keyCode==13){e.SocNetLogDestination.selectCurrentItem(i,o.formName);return e.PreventDefault(t)}else if(typeof o.multiSelect!="undefined"&&o.multiSelect&&t.keyCode==32&&i!="search"){e.SocNetLogDestination.selectCurrentItem(i,o.formName,{closeDialog:false});return true}}var a=e.type.isDomNode(o.inputNode)?e(o.inputNode):e(o.inputId);if(!a){return false}var s="";if(t.keyCode==27){if(e.SocNetLogDestination.inviteEmailUserWindow==null||!e.SocNetLogDestination.inviteEmailUserWindow.isShown()){a.value="";e.style(e(o.linkId),"display","inline");if(typeof o.formName!="undefined"&&!e.SocNetLogDestination.obShowSearchInput[o.formName]){e.PreventDefault(t)}}else{e.SocNetLogDestination.inviteEmailUserWindow.close();return false}}else{s=a.value;e.SocNetLogDestination.search(s,o.sendAjax,o.formName)}if(!e.SocNetLogDestination.isOpenDialog()&&s.length<=0){e.SocNetLogDestination.openDialog(o.formName)}else{if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.isOpenDialog()&&!e.SocNetLogDestination.isOpenContainer()){e.SocNetLogDestination.closeDialog()}}if(t.keyCode==8){e.SocNetLogDestination.sendEvent=true}return true};e.SocNetLogDestination.searchBeforeHandler=function(t,o){var n=e.type.isDomNode(o.inputNode)?o.inputNode:e(o.inputId);if(!n){return false}if(t.keyCode==8&&n.value.length<=0){e.SocNetLogDestination.sendEvent=false;e.SocNetLogDestination.deleteLastItem(o.formName)}else if(t.keyCode==13){this.searchStarted=true;return e.PreventDefault(t)}else if(t.keyCode==17||t.keyCode==224||t.keyCode==91||t.keyCode==93){return e.PreventDefault(t)}this.searchStarted=true;return true};e.SocNetLogDestination.loadAll=function(t){if(typeof t!="undefined"&&typeof t.name!="undefined"&&typeof t.callback=="function"&&(typeof t.entity=="undefined"||t.entity=="users")){e.ajax({url:"/bitrix/components/bitrix/main.post.form/post.ajax.php",method:"POST",dataType:"json",data:{LD_ALL:"Y",sessid:e.bitrix_sessid()},onsuccess:function(o){if(typeof o.USERS!="undefined"){e.onCustomEvent("onFinderAjaxLoadAll",[o.USERS,e.SocNetLogDestination,"users"])}t.callback()},onfailure:function(e){}})}};e.SocNetLogDestination.compareDestinations=function(t,o){if(e.util.in_array(t.value,e.SocNetLogDestination.tmpSearchResult.client)&&!e.util.in_array(o.value,e.SocNetLogDestination.tmpSearchResult.client)){return-1}else if(typeof t.isNetwork=="undefined"&&typeof o.isNetwork!="undefined"){return-1}else if(typeof t.isNetwork!="undefined"&&typeof o.isNetwork=="undefined"){return 1}else if(typeof t.sort=="undefined"&&typeof o.sort=="undefined"){return 0}else if(typeof t.sort!="undefined"&&typeof o.sort=="undefined"){return-1}else if(typeof t.sort=="undefined"&&typeof o.sort!="undefined"){return 1}else{if(typeof t.sort.Y!="undefined"&&typeof o.sort.Y=="undefined"){return-1}else if(typeof t.sort.Y=="undefined"&&typeof o.sort.Y!="undefined"){return 1}else if(typeof t.sort.Y!="undefined"&&typeof o.sort.Y!="undefined"){if(parseInt(t.sort.Y)>parseInt(o.sort.Y)){return-1}else if(parseInt(t.sort.Y)<parseInt(o.sort.Y)){return 1}else{return 0}}else{if(parseInt(t.sort.N)>parseInt(o.sort.N)){return-1}else if(parseInt(t.sort.N)<parseInt(o.sort.N)){return 1}else{return 0}}}};e.SocNetLogDestination.checkEmail=function(e){var t=/^([^<]+)\s<([^>]+)>$/gim;var o=t.exec(e);var n="";var i="";if(o!=null&&o.length==3){n=o[1];var a=n.split(/[\s]+/);i=a.pop();n=a.join(" ");e=o[2].trim()}t=/^[=_0-9a-z+~'!\$&*^`|\#%/?{}-]+(\.[=_0-9a-z+~'!\$&*^`|\#%/?{}-]+)*@(([-0-9a-z_]+\.)+)([a-z0-9-]{2,20})$/gim;if(e.length>=6&&t.test(e)){return{name:n,lastName:i,email:e.toLowerCase()}}else{return false}};e.SocNetLogDestination.openInviteEmailUserDialog=function(t,o,n){e.SocNetLogDestination.inviteEmailCurrentName=o;if(e.SocNetLogDestination.inviteEmailUserWindow===null){e.SocNetLogDestination.inviteEmailUserWindow=new e.PopupWindow({id:"invite-email-email-user-popup",bindElement:e.SocNetLogDestination.obElementSearchInput[o],offsetTop:1,content:e.SocNetLogDestination.inviteEmailUserContent(t,o,n),zIndex:1250,lightShadow:true,autoHide:true,closeByEsc:true,angle:{position:"bottom",offset:20},events:{onPopupClose:function(){if(e.SocNetLogDestination.inviteEmailUserWindow!=null||!e.SocNetLogDestination.inviteEmailUserWindow.isShown()){var t={name:e.SocNetLogDestination.inviteEmailUserWindowSubmitted?e("invite_email_user_name").value:"",lastName:e.SocNetLogDestination.inviteEmailUserWindowSubmitted?e("invite_email_user_last_name").value:"",email:e("invite_email_user_email").value,createCrmContact:e("invite_email_user_create_crm_contact")&&e("invite_email_user_create_crm_contact").checked};e.SocNetLogDestination.inviteEmailAddUser(e.SocNetLogDestination.inviteEmailCurrentName,t)}e.SocNetLogDestination.inviteEmailUserWindowSubmitted=false;if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[e.SocNetLogDestination.inviteEmailCurrentName]&&e.SocNetLogDestination.obCallback[e.SocNetLogDestination.inviteEmailCurrentName].closeEmailAdd){e.SocNetLogDestination.obCallback[e.SocNetLogDestination.inviteEmailCurrentName].closeEmailAdd(e.SocNetLogDestination.inviteEmailCurrentName)}},onPopupShow:function(){e.defer(e.focus)(e("invite_email_user_name"));if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[e.SocNetLogDestination.inviteEmailCurrentName]&&e.SocNetLogDestination.obCallback[e.SocNetLogDestination.inviteEmailCurrentName].openEmailAdd){e.SocNetLogDestination.obCallback[e.SocNetLogDestination.inviteEmailCurrentName].openEmailAdd(e.SocNetLogDestination.inviteEmailCurrentName)}}}})}else{e.SocNetLogDestination.inviteEmailUserWindow.setContent(e.SocNetLogDestination.inviteEmailUserContent(t,e.SocNetLogDestination.inviteEmailCurrentName,n));e.SocNetLogDestination.inviteEmailUserWindow.setBindElement(e.SocNetLogDestination.obElementSearchInput[e.SocNetLogDestination.inviteEmailCurrentName])}if(!e.SocNetLogDestination.inviteEmailUserWindow.isShown()){e.SocNetLogDestination.inviteEmailUserWindow.show()}};e.SocNetLogDestination.inviteEmailAddUser=function(t,o){var n=false;var i=o.email;var a=e.util.htmlspecialchars(o.name)+(o.name.length>0?" ":"")+e.util.htmlspecialchars(o.lastName);if(a.length<=0){a=i}else{n=true}if(typeof e.SocNetLogDestination.obItems[t]["users"]=="undefined"){e.SocNetLogDestination.obItems[t]["users"]=[]}e.SocNetLogDestination.obItems[t]["users"][i]={name:a,email:i,id:i,isEmail:"Y",isCrmEmail:typeof o.createCrmContact!="undefined"&&!!o.createCrmContact?"Y":"N",showEmail:n?"Y":"N",params:o};e.SocNetLogDestination.runSelectCallback(i,"users",t,false,"select")};e.SocNetLogDestination.inviteEmailUserContent=function(t,o,n){n=!!n;return e.create("DIV",{props:{className:"bx-feed-email-popup"},children:[e.create("DIV",{props:{className:"bx-feed-email-title"},text:e.message("LM_INVITE_EMAIL_USER_TITLE")}),e.create("FORM",{style:{padding:0,margin:0},events:{submit:function(t){e.SocNetLogDestination.inviteEmailUserSubmitForm(o);e.PreventDefault(t)}},children:[e.create("DIV",{children:[e.create("INPUT",{attrs:{id:"invite_email_user_email",type:"hidden",value:t.email}}),e.create("INPUT",{attrs:{id:"invite_email_user_name",type:"text",placeholder:e.message("LM_INVITE_EMAIL_USER_PLACEHOLDER_NAME"),value:t.name},props:{className:"bx-feed-email-input"}}),e.create("INPUT",{attrs:{id:"invite_email_user_last_name",type:"text",placeholder:e.message("LM_INVITE_EMAIL_USER_PLACEHOLDER_LAST_NAME"),value:t.lastName},props:{className:"bx-feed-email-input"},events:{keyup:function(t){if(e("invite_email_user_name").value.length>0||e("invite_email_user_last_name").value.length>0){e.removeClass(e("invite_email_user_button"),"webform-button-disable")}else{e.addClass(e("invite_email_user_button"),"webform-button-disable")}e.PreventDefault(t)}}}),e.create("SPAN",{attrs:{id:"invite_email_user_button"},props:{className:"webform-small-button webform-small-button-blue webform-button-disable"},text:e.message("LM_INVITE_EMAIL_USER_BUTTON_OK"),style:{cursor:"pointer"},events:{click:function(){e.SocNetLogDestination.inviteEmailUserSubmitForm(o)}}}),e.create("INPUT",{style:{display:"none"},attrs:{type:"submit"}})]}),n?e.create("DIV",{props:{className:"bx-feed-email-crm-contact"},children:[e.create("INPUT",{attrs:{className:"bx-feed-email-checkbox",type:"checkbox",id:"invite_email_user_create_crm_contact",value:"Y"}}),e.create("LABEL",{attrs:{for:"invite_email_user_create_crm_contact"},html:e.message("LM_INVITE_EMAIL_CRM_CREATE_CONTACT")})]}):null]})]})};e.SocNetLogDestination.inviteEmailUserSubmitForm=function(t){e.SocNetLogDestination.inviteEmailUserWindowSubmitted=true;e.SocNetLogDestination.inviteEmailUserWindow.close()};e.SocNetLogDestination.buildDepartmentRelation=function(e){var t={},o,n;for(n in e){if(e.hasOwnProperty(n)){o=e[n]["parent"];if(!t[o])t[o]=[];t[o][t[o].length]=n}}function i(e,t){var o={},n,a;if(t[e]){for(var s in t[e]){if(t[e].hasOwnProperty(s)){n=t[e][s];a=[];if(t[n]&&t[n].length>0)a=i(n,t);o[n]={id:n,type:"category",items:a}}}}return o}return i("DR0",t)};e.SocNetLogDestination.abortSearchRequest=function(){if(e.SocNetLogDestination.oXHR){e.SocNetLogDestination.oXHR.abort()}if(e.SocNetLogDestination.searchTimeout){clearTimeout(e.SocNetLogDestination.searchTimeout)}};e.SocNetLogDestination.onTabsAdd=function(t,o){if(!e.util.in_array(o.id,e.SocNetLogDestination.obTabs[t])){e.SocNetLogDestination.obTabs[t].push(o.id);if(typeof e.SocNetLogDestination.obCustomTabs[t]=="undefined"){e.SocNetLogDestination.obCustomTabs[t]=[]}e.SocNetLogDestination.obCustomTabs[t].push(o);if(o.dialogGroup!="undefined"){var n=false;for(var i=0;i<e.SocNetLogDestination.arDialogGroups[t].length;i++){if(e.SocNetLogDestination.arDialogGroups[t][i].groupCode==o.dialogGroup.groupCode){n=true;break}}if(!n){e.SocNetLogDestination.arDialogGroups[t].push({bCrm:typeof o.dialogGroup.bCrm!="undefined"?!!o.dialogGroup.bCrm:false,groupCode:o.dialogGroup.groupCode,className:typeof o.dialogGroup.className!="undefined"?o.dialogGroup.className:"",groupboxClassName:typeof o.dialogGroup.groupboxClassName!="undefined"?o.dialogGroup.groupboxClassName:"",title:o.dialogGroup.title})}}}}})();
//# sourceMappingURL=log-destination.map.js