{"version":3,"file":"controller.bundle.js","sources":["../src/controller.js"],"sourcesContent":["import { ajax, Uri } from 'main.core';\n\ntype GroupFeature = {\n\tfeatureName: string,\n\tname: string,\n\tcustomName: string,\n\tid: number,\n\tactive: boolean,\n}\n\nexport class Controller\n{\n\tstatic paths: {\n\t\tpathToUsers: string,\n\t\tpathToCommonSpace: string,\n\t\tpathToFeatures: string,\n\t\tpathToInvite: string,\n\t};\n\n\tstatic getGroupData(groupId: number, select: Array<string>): Promise\n\t{\n\t\treturn BX.ajax.runAction('socialnetwork.api.workgroup.get', {\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tselect,\n\t\t\t\t\tgroupId,\n\t\t\t\t},\n\t\t\t},\n\t\t}).then((response) => {\n\t\t\treturn {\n\t\t\t\tid: response.data.ID,\n\t\t\t\tname: response.data.NAME,\n\t\t\t\tdescription: response.data.DESCRIPTION,\n\t\t\t\tavatar: response.data?.AVATAR,\n\t\t\t\tisPin: response.data?.IS_PIN,\n\t\t\t\tprivacyCode: response.data?.PRIVACY_CODE,\n\t\t\t\tisSubscribed: response.data.USER_DATA?.IS_SUBSCRIBED,\n\t\t\t\tnumberOfMembers: response.data?.NUMBER_OF_MEMBERS,\n\t\t\t\tlistOfMembers: response.data?.LIST_OF_MEMBERS,\n\t\t\t\tgroupMembersList: response.data?.GROUP_MEMBERS_LIST,\n\t\t\t\tactions: {\n\t\t\t\t\tcanEdit: response.data?.ACTIONS?.EDIT,\n\t\t\t\t\tcanInvite: response.data?.ACTIONS?.INVITE,\n\t\t\t\t\tcanLeave: response.data?.ACTIONS?.LEAVE,\n\t\t\t\t\tcanEditFeatures: response.data?.ACTIONS?.EDIT_FEATURES,\n\t\t\t\t},\n\t\t\t\tcounters: response.data?.COUNTERS,\n\t\t\t\tefficiency: response.data?.EFFICIENCY,\n\t\t\t\tsubject: response.data?.SUBJECT_DATA?.NAME,\n\t\t\t\tdateCreate: response.data?.DATE_CREATE,\n\t\t\t\tfeatures: response.data?.FEATURES,\n\t\t\t};\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.log(error);\n\t\t});\n\t}\n\n\tstatic inviteUsers(spaceId: number, users: number[]): Promise\n\t{\n\t\treturn BX.ajax.runAction('socialnetwork.api.workgroup.updateInvitedUsers', {\n\t\t\tdata: {\n\t\t\t\tspaceId,\n\t\t\t\tusers: [0, ...users],\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic changePrivacy(groupId: number, privacyCode: 'open' | 'closed' | 'secret'): Promise\n\t{\n\t\tconst fields = {};\n\n\t\tif (privacyCode === 'open')\n\t\t{\n\t\t\tfields.VISIBLE = 'Y';\n\t\t\tfields.OPENED = 'Y';\n\t\t\tfields.EXTERNAL = 'N';\n\t\t}\n\n\t\tif (privacyCode === 'closed')\n\t\t{\n\t\t\tfields.VISIBLE = 'Y';\n\t\t\tfields.OPENED = 'N';\n\t\t\tfields.EXTERNAL = 'N';\n\t\t}\n\n\t\tif (privacyCode === 'secret')\n\t\t{\n\t\t\tfields.VISIBLE = 'N';\n\t\t\tfields.OPENED = 'N';\n\t\t\tfields.EXTERNAL = 'N';\n\t\t}\n\n\t\treturn ajax.runAction('socialnetwork.api.workgroup.update', {\n\t\t\tdata: {\n\t\t\t\tgroupId,\n\t\t\t\tfields,\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic changeTitle(groupId: number, title: string): Promise\n\t{\n\t\treturn ajax.runAction('socialnetwork.api.workgroup.update', {\n\t\t\tdata: {\n\t\t\t\tgroupId,\n\t\t\t\tfields: {\n\t\t\t\t\tNAME: title,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic changeDescription(groupId: number, description: string): Promise\n\t{\n\t\treturn ajax.runAction('socialnetwork.api.workgroup.update', {\n\t\t\tdata: {\n\t\t\t\tgroupId,\n\t\t\t\tfields: {\n\t\t\t\t\tDESCRIPTION: description,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic changeTags(groupId: number, tags: Array<string>): Promise\n\t{\n\t\treturn ajax.runAction('socialnetwork.api.workgroup.update', {\n\t\t\tdata: {\n\t\t\t\tgroupId,\n\t\t\t\tfields: {\n\t\t\t\t\tKEYWORDS: tags.join(','),\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic changeFeatures(groupId: number, features: Array<GroupFeature>): Promise\n\t{\n\t\treturn ajax.runAction('socialnetwork.api.workgroup.setFeatures', {\n\t\t\tdata: {\n\t\t\t\tgroupId,\n\t\t\t\tfeatures,\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic updatePhoto(groupId: number, photo: File): Promise\n\t{\n\t\tconst formData = new FormData();\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tphoto.name ??= 'tmp.png';\n\t\tformData.append('newPhoto', photo, photo.name);\n\t\tformData.append('groupId', groupId);\n\n\t\treturn ajax.runAction('socialnetwork.api.workgroup.updatePhoto', {\n\t\t\tdata: formData,\n\t\t});\n\t}\n\n\tstatic changePin(groupId: number, isPinned: boolean): Promise\n\t{\n\t\treturn ajax.runAction('socialnetwork.api.workgroup.changePin', {\n\t\t\tdata: {\n\t\t\t\tgroupIdList: [groupId],\n\t\t\t\taction: isPinned ? 'pin' : 'unpin',\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic setSubscription(groupId: number, isSubscribed: boolean): Promise\n\t{\n\t\treturn ajax.runAction('socialnetwork.api.workgroup.setSubscription', {\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tgroupId,\n\t\t\t\t\tvalue: isSubscribed ? 'Y' : 'N',\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic leaveGroup(groupId: number): Promise\n\t{\n\t\treturn ajax.runAction('socialnetwork.api.workgroup.leave', {\n\t\t\tdata: {\n\t\t\t\tgroupId,\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic deleteGroup(groupId: number): Promise\n\t{\n\t\treturn ajax.runAction('socialnetwork.api.workgroup.delete', {\n\t\t\tdata: {\n\t\t\t\tgroupId,\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic openGroupUsers(mode: 'all' | 'in' | 'out')\n\t{\n\t\tconst availableModes = {\n\t\t\tall: 'members',\n\t\t\tin: 'requests_in',\n\t\t\tout: 'requests_out',\n\t\t};\n\n\t\tconst uri = new Uri(this.paths.pathToUsers);\n\t\turi.setQueryParams({\n\t\t\tmode: availableModes[mode],\n\t\t});\n\n\t\tBX.SidePanel.Instance.open(uri.toString(), {\n\t\t\twidth: 1200,\n\t\t\tcacheable: false,\n\t\t\tloader: 'group-users-loader',\n\t\t});\n\t}\n\n\tstatic openGroupFeatures()\n\t{\n\t\tBX.SidePanel.Instance.open(this.paths.pathToFeatures, {\n\t\t\twidth: 800,\n\t\t\tloader: 'group-features-loader',\n\t\t});\n\t}\n\n\tstatic openGroupInvite()\n\t{\n\t\tBX.SidePanel.Instance.open(this.paths.pathToInvite, {\n\t\t\twidth: 950,\n\t\t\tloader: 'group-invite-loader',\n\t\t});\n\t}\n\n\tstatic openCommonSpace()\n\t{\n\t\tlocation.href = this.paths.pathToCommonSpace;\n\t}\n}\n"],"names":["Controller","getGroupData","groupId","select","BX","ajax","runAction","data","params","then","response","id","ID","name","NAME","description","DESCRIPTION","avatar","AVATAR","isPin","IS_PIN","privacyCode","PRIVACY_CODE","isSubscribed","USER_DATA","IS_SUBSCRIBED","numberOfMembers","NUMBER_OF_MEMBERS","listOfMembers","LIST_OF_MEMBERS","groupMembersList","GROUP_MEMBERS_LIST","actions","canEdit","ACTIONS","EDIT","canInvite","INVITE","canLeave","LEAVE","canEditFeatures","EDIT_FEATURES","counters","COUNTERS","efficiency","EFFICIENCY","subject","SUBJECT_DATA","dateCreate","DATE_CREATE","features","FEATURES","catch","error","console","log","inviteUsers","spaceId","users","changePrivacy","fields","VISIBLE","OPENED","EXTERNAL","changeTitle","title","changeDescription","changeTags","tags","KEYWORDS","join","changeFeatures","updatePhoto","photo","formData","FormData","append","changePin","isPinned","groupIdList","action","setSubscription","value","leaveGroup","deleteGroup","openGroupUsers","mode","availableModes","all","in","out","uri","Uri","paths","pathToUsers","setQueryParams","SidePanel","Instance","open","toString","width","cacheable","loader","openGroupFeatures","pathToFeatures","openGroupInvite","pathToInvite","openCommonSpace","location","href","pathToCommonSpace"],"mappings":"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"}