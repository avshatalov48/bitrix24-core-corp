(function(){var e=window.BX;if(!!e.SocialnetworkUISelector){return}e.SocialnetworkUISelector={newSonetgroupsCounter:0,onEmptySearchResult:function(t){if(!e.type.isNotEmptyObject(t)||!e.type.isNotEmptyString(t.selectorId)||!e.type.isNotEmptyString(t.searchString)||typeof e.UI.SelectorManager=="undefined"){return}var i=e.UI.SelectorManager.instances[t.selectorId];if(!e.type.isNotEmptyObject(i)){return}if(i.getOption("allowAdd","EMAILUSERS")=="Y"){var a=i.manager.checkEmail(t.searchString);if(e.type.isNotEmptyObject(a)&&!e.type.isNotEmptyObject(i.entities.EMAILUSERS.items[a.email])){this.openInviteEmailUserDialog({selectorId:t.selectorId,emailUserData:a})}}else if(i.getOption("allowAdd","SONETGROUPS")=="Y"){this.openCreateSonetgroupDialog({selectorId:t.selectorId,name:e.type.isNotEmptyString(t.searchStringOriginal)?t.searchStringOriginal:t.searchString,isExtranet:i.getOption("newGroupType","SONETGROUPS")=="extranet"})}},openInviteEmailUserDialog:function(t){if(!e.type.isNotEmptyObject(t)||!e.type.isNotEmptyString(t.selectorId)||!e.type.isNotEmptyObject(t.emailUserData)){return}var i=e.UI.SelectorManager.instances[t.selectorId];if(!e.type.isNotEmptyObject(i)){return}if(!i.popups.inviteEmailUser){i.popups.inviteEmailUser=new e.PopupWindow("invite-email-email-user-popup",i.getPopupBind(),{offsetTop:1,content:this.inviteEmailUserContent(t),zIndex:1250,lightShadow:true,autoHide:true,closeByEsc:true,angle:{position:"bottom",offset:20},events:{onPopupClose:function(){if(i.popups.inviteEmailUser!=null||!i.popups.inviteEmailUser.isShown()){var a={selectorId:t.selectorId,name:i.inviteEmailUserWindowSubmitted?e("invite_email_user_name").value:"",lastName:i.inviteEmailUserWindowSubmitted?e("invite_email_user_last_name").value:"",email:e("invite_email_user_email").value,createCrmContact:e("invite_email_user_create_crm_contact")&&e("invite_email_user_create_crm_contact").checked};this.inviteEmailAddUser(a)}i.inviteEmailUserWindowSubmitted=false;if(i.manager.statuses.allowSendEvent&&i.callback.closeEmailAdd){i.callback.closeEmailAdd({selectorId:i.id})}}.bind(this),onPopupShow:function(){e.defer(e.focus)(e("invite_email_user_name"));if(i.manager.statuses.allowSendEvent&&i.callback.openEmailAdd){i.callback.openEmailAdd({selectorId:i.id})}}}})}else{i.popups.inviteEmailUser.setContent(this.inviteEmailUserContent(t));i.popups.inviteEmailUser.setBindElement(i.getPopupBind())}if(!i.popups.inviteEmailUser.isShown()){i.popups.inviteEmailUser.show()}},inviteEmailUserContent:function(t){if(!e.type.isNotEmptyObject(t)||!e.type.isNotEmptyString(t.selectorId)||!e.type.isNotEmptyObject(t.emailUserData)){return}var i=e.UI.SelectorManager.instances[t.selectorId];if(!e.type.isNotEmptyObject(i)){return}return e.create("DIV",{props:{className:"bx-ui-selector bx-feed-email-popup"},children:[e.create("DIV",{props:{className:"bx-feed-email-title"},text:e.message("SONET_EXT_SELECTOR_INVITE_EMAIL_USER_TITLE")}),e.create("FORM",{style:{padding:0,margin:0},events:{submit:function(e){this.inviteEmailUserSubmitForm(t);e.stopPropagation();e.preventDefault()}.bind(this)},children:[e.create("DIV",{children:[e.create("INPUT",{attrs:{id:"invite_email_user_email",type:"hidden",value:t.emailUserData.email}}),e.create("INPUT",{attrs:{id:"invite_email_user_name",type:"text",placeholder:e.message("SONET_EXT_SELECTOR_INVITE_EMAIL_USER_PLACEHOLDER_NAME"),value:t.emailUserData.name},props:{className:"bx-feed-email-input"}}),e.create("INPUT",{attrs:{id:"invite_email_user_last_name",type:"text",placeholder:e.message("SONET_EXT_SELECTOR_INVITE_EMAIL_USER_PLACEHOLDER_LAST_NAME"),value:t.emailUserData.lastName},props:{className:"bx-feed-email-input"},events:{keyup:function(t){if(e("invite_email_user_name").value.length>0||e("invite_email_user_last_name").value.length>0){e.removeClass(e("invite_email_user_button"),"ui-btn-disabled")}else{e.addClass(e("invite_email_user_button"),"ui-btn-disabled")}t.stopPropagation();t.preventDefault()}}}),e.create("SPAN",{attrs:{id:"invite_email_user_button"},props:{className:"ui-btn ui-btn-md ui-btn-primary ui-btn-disabled"},text:e.message("SONET_EXT_SELECTOR_INVITE_EMAIL_USER_BUTTON_OK"),style:{cursor:"pointer"},events:{click:function(){this.inviteEmailUserSubmitForm(t)}.bind(this)}}),e.create("INPUT",{style:{display:"none"},attrs:{type:"submit"}})]}),i.getOption("allowAddCrmContact","EMAILUSERS")=="Y"?e.create("DIV",{props:{className:"bx-feed-email-crm-contact"},children:[e.create("INPUT",{attrs:{className:"bx-feed-email-checkbox",type:"checkbox",id:"invite_email_user_create_crm_contact",value:"Y"}}),e.create("LABEL",{attrs:{for:"invite_email_user_create_crm_contact"},html:e.message("SONET_EXT_SELECTOR_INVITE_EMAIL_CRM_CREATE_CONTACT")})]}):null]})]})},inviteEmailAddUser:function(t){if(!e.type.isNotEmptyObject(t)||!e.type.isNotEmptyString(t.selectorId)){return}var i=e.UI.SelectorManager.instances[t.selectorId];if(!e.type.isNotEmptyObject(i)||!e.type.isNotEmptyObject(i.entities.EMAILUSERS)){return}var a=false,n=t.email,o=e.util.htmlspecialchars(t.name)+(e.type.isNotEmptyString(t.name)?" ":"")+e.util.htmlspecialchars(t.lastName);if(!e.type.isNotEmptyString(o)){o=n}else{a=true}i.entities.EMAILUSERS.items[n]={name:o,email:n,id:n,isEmail:"Y",isCrmEmail:typeof t.createCrmContact!="undefined"&&!!t.createCrmContact?"Y":"N",showEmail:a?"Y":"N",params:t};if(i.callback.select){i.callback.select({item:i.entities.EMAILUSERS.items[n],entityType:"EMAILUSERS",selectorId:i.id,state:"select"})}},inviteEmailUserSubmitForm:function(t){if(!e.type.isNotEmptyObject(t)||!e.type.isNotEmptyString(t.selectorId)){return}var i=e.UI.SelectorManager.instances[t.selectorId];if(!e.type.isNotEmptyObject(i)){return}i.inviteEmailUserWindowSubmitted=true;i.popups.inviteEmailUser.close()},openCreateSonetgroupDialog:function(t){if(!e.type.isNotEmptyObject(t)||!e.type.isNotEmptyString(t.selectorId)||!e.type.isNotEmptyString(t.name)){return}var i=e.UI.SelectorManager.instances[t.selectorId],a=t.name;i.timeouts.createSonetgroup=setTimeout(function(){if(!i.popups.createSonetgroup){i.popups.createSonetgroup=new e.PopupWindow("invite-dialog-creategroup-popup",i.getPopupBind(),{offsetTop:1,autoHide:true,content:this.createSocNetGroupContent(a),zIndex:1200,buttons:this.createSocNetGroupButtons({selectorId:i.id,groupName:a,isExtranet:!!t.isExtranet})})}else{i.popups.createSonetgroup.setContent(this.createSocNetGroupContent(a));i.popups.createSonetgroup.setButtons(this.createSocNetGroupButtons({selectorId:i.id,groupName:a,isExtranet:!!t.isExtranet}))}if(!i.popups.createSonetgroup.isShown()){i.popups.createSonetgroup.show()}}.bind(this),1e3)},createSocNetGroupContent:function(t){return e.create("DIV",{children:[e.create("DIV",{text:e.message("SONET_EXT_SELECTOR_CREATE_SONETGROUP_TITLE").replace("#TITLE#",t)})]})},createSocNetGroupButtons:function(t){if(!e.type.isNotEmptyString(t.selectorId)||!e.type.isNotEmptyString(t.groupName)){return[]}var i=e.UI.SelectorManager.instances[t.selectorId];return[new e.PopupWindowButton({text:e.message("SONET_EXT_SELECTOR_CREATE_SONETGROUP_BUTTON_CREATE"),events:{click:function(){var e="SGN"+this.newSonetgroupsCounter+"";i.entities.SONETGROUPS.items[e]={id:e,entityId:this.newSonetgroupsCounter,name:t.groupName,desc:"",isExtranet:!!t.isExtranet?"Y":"N"};var a={SONETGROUPS:{}};a.SONETGROUPS[e]=e;i.openSearch({itemsList:a});this.newSonetgroupsCounter++;i.popups.createSonetgroup.close()}.bind(this)}}),new e.PopupWindowButtonLink({text:e.message("SONET_EXT_SELECTOR_CREATE_SONETGROUP_BUTTON_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){i.popups.createSonetgroup.close()}.bind(this)}})]},beforeRunSearch:function(t){if(!e.type.isNotEmptyObject(t)||!e.type.isNotEmptyObject(t.selectorInstance)){return}var i=t.selectorInstance;if(i.timeouts.createSonetgroup){clearTimeout(i.timeouts.createSonetgroup)}},select:function(t){if(!e.type.isNotEmptyObject(t)||!e.type.isNotEmptyString(t.selectorId)||!e.type.isDomNode(t.contextNode)||!e.type.isNotEmptyObject(t.item)||!e.type.isNotEmptyString(t.item.id)){return}var i=e.UI.SelectorManager.instances[t.selectorId];if(!e.type.isNotEmptyObject(i)){return}if(e.type.isNotEmptyObject(i.entities.EMAILUSERS)&&e.type.isNotEmptyObject(i.entities.EMAILUSERS.items)&&e.type.isNotEmptyObject(i.entities.EMAILUSERS.items[t.item.id])&&e.type.isNotEmptyObject(t.item.params)){if(e.type.isNotEmptyString(t.item.params.name)){t.contextNode.insertBefore(e.create("INPUT",{attrs:{type:"hidden",name:"INVITED_USER_NAME["+t.item.id+"]",value:t.item.params.name}}),t.contextNode.firstChild)}if(e.type.isNotEmptyString(t.item.params.lastName)){t.contextNode.insertBefore(e.create("INPUT",{attrs:{type:"hidden",name:"INVITED_USER_LAST_NAME["+t.item.id+"]",value:t.item.params.lastName}}),t.contextNode.firstChild)}if(!!t.item.params.createCrmContact){t.contextNode.insertBefore(e.create("INPUT",{attrs:{type:"hidden",name:"INVITED_USER_CREATE_CRM_CONTACT["+t.item.id+"]",value:"Y"}}),t.contextNode.firstChild)}}else if(e.type.isNotEmptyObject(i.entities.CRMEMAILUSERS)&&e.type.isNotEmptyObject(i.entities.CRMEMAILUSERS.items)&&e.type.isNotEmptyObject(i.entities.CRMEMAILUSERS.items[t.item.id])&&e.type.isNotEmptyObject(t.item.params)){if(e.type.isNotEmptyString(t.item.params.name)){t.contextNode.insertBefore(e.create("INPUT",{attrs:{type:"hidden",name:"INVITED_USER_NAME["+t.item.email+"]",value:t.item.params.name}}),t.contextNode.firstChild)}if(e.type.isNotEmptyString(t.item.params.lastName)){t.contextNode.insertBefore(e.create("INPUT",{attrs:{type:"hidden",name:"INVITED_USER_LAST_NAME["+t.item.email+"]",value:t.item.params.lastName}}),t.contextNode.firstChild)}if(e.type.isNotEmptyString(t.item.crmEntity)){t.contextNode.insertBefore(e.create("INPUT",{attrs:{type:"hidden",name:"INVITED_USER_CRM_ENTITY["+t.item.email+"]",value:t.item.crmEntity}}),t.contextNode.firstChild)}}else if(e.type.isNotEmptyObject(i.entities.SONETGROUPS)&&e.type.isNotEmptyObject(i.entities.SONETGROUPS.items)&&e.type.isNotEmptyObject(i.entities.SONETGROUPS.items[t.item.id])){var a=t.item.id.match(/^SGN(\d+)$/i);if(a){t.contextNode.insertBefore(e.create("INPUT",{attrs:{type:"hidden",name:"SONET_GROUPS_NAME["+a[0]+"]",value:i.entities.SONETGROUPS.items[t.item.id].name}}),t.contextNode.firstChild)}}},unselect:function(t){if(!e.type.isNotEmptyObject(t)||!e.type.isNotEmptyString(t.selectorId)||!e.type.isDomNode(t.contextNode)||!e.type.isNotEmptyObject(t.item)||!e.type.isNotEmptyString(t.item.id)){return}var i=e.UI.SelectorManager.instances[t.selectorId];if(!e.type.isNotEmptyObject(i)){return}var a=null;a=e.findChild(t.contextNode,{tagName:"input",attrs:{type:"hidden",name:"INVITED_USER_NAME["+t.item.id+"]"}});if(a){e.cleanNode(a,true)}a=e.findChild(t.contextNode,{tagName:"input",attrs:{type:"hidden",name:"INVITED_USER_LAST_NAME["+t.item.id+"]"}});if(a){e.cleanNode(a,true)}a=e.findChild(t.contextNode,{tagName:"input",attrs:{type:"hidden",name:"INVITED_USER_CREATE_CRM_CONTACT["+t.item.id+"]"}});if(a){e.cleanNode(a,true)}},onGetEntityTypes:function(t){if(!e.type.isNotEmptyObject(t)||!e.type.isNotEmptyObject(t.selector)){return}var i=t.selector;i.entityTypes.GROUPS={options:{enableAll:i.getOption("enableAll")=="Y"?"Y":"N",enableEmpty:i.getOption("enableEmpty")=="Y"?"Y":"N"}};if(i.getOption("enableUsers")!="N"){i.entityTypes.USERS={options:{scope:i.getOption("userSearchArea"),extranetContext:i.getOption("userSearchArea"),allowAdd:i.getOption("allowAddUser")=="Y"?"Y":"N",allowSearch:i.getOption("allowUserSearch")!="N"?"Y":"N",allowSearchByEmail:i.getOption("allowSearchEmailUsers")=="Y"?"Y":"N",allowSearchNetwork:i.getOption("allowSearchNetworkUsers")=="Y"?"Y":"N",allowSearchSelf:i.getOption("allowSearchSelf")=="N"?"N":"Y",allowSearchCrmEmailUsers:i.getOption("allowSearchCrmEmailUsers")=="Y"?"Y":"N",showVacations:i.getOption("showVacations")=="Y"?"Y":"N"}};i.entityTypes.EMAILUSERS={options:{allowAdd:i.getOption("allowAddUser")=="Y"||i.getOption("allowEmailInvitation")=="Y"?"Y":"N",allowAddCrmContact:i.getOption("allowAddCrmContact")=="Y"?"Y":"N",allowSearchCrmEmailUsers:i.getOption("allowSearchCrmEmailUsers")=="Y"?"Y":"N",addTab:i.getOption("allowSearchEmailUsers")=="Y"?"Y":"N"}};if(i.getOption("allowSearchCrmEmailUsers")=="Y"){i.entityTypes.CRMEMAILUSERS={options:{addTab:"Y",allowSearchCrmEmailUsers:i.getOption("allowSearchCrmEmailUsers")=="Y"?"Y":"N"}}}}if(i.getOption("enableSonetgroups")=="Y"){i.entityTypes.SONETGROUPS={options:{allowAdd:i.getOption("allowAddSocNetGroup")=="Y"?"Y":"N",enableProjects:i.getOption("enableProjects")=="Y"?"Y":"N",searchFeatures:i.getOption("allowSonetGroupsAjaxSearchFeatures"),siteId:i.getOption("socNetGroupsSiteId")}}}if(i.getOption("enableProjects")=="Y"){i.entityTypes.PROJECTS={options:{allowAdd:i.getOption("allowAddSocNetGroup")=="Y"?"Y":"N"}}}}};e.ready(function(){e.addCustomEvent("BX.UI.Selector:onEmptySearchResult",e.SocialnetworkUISelector.onEmptySearchResult.bind(e.SocialnetworkUISelector));e.addCustomEvent("BX.Main.User.SelectorController:select",e.SocialnetworkUISelector.select);e.addCustomEvent("BX.Main.User.SelectorController:unSelect",e.SocialnetworkUISelector.unselect);e.addCustomEvent("BX.Main.SelectorV2:onGetEntityTypes",e.SocialnetworkUISelector.onGetEntityTypes);e.addCustomEvent("BX.UI.SelectorManager:beforeRunSearch",e.SocialnetworkUISelector.beforeRunSearch)})})();
//# sourceMappingURL=socialnetwork.selector.map.js