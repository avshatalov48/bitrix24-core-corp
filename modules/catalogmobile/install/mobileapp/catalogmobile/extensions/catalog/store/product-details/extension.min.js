jn.define("catalog/store/product-details",((e,t,s)=>{const{Alert:i}=e("alert");const{BannerButton:o}=e("layout/ui/banners");const{BarcodeField:r}=e("layout/ui/fields/barcode");const{CombinedField:a}=e("layout/ui/fields/combined");const{EntitySelectorField:l}=e("layout/ui/fields/entity-selector");const{FileField:d}=e("layout/ui/fields/file");const{MoneyField:n}=e("layout/ui/fields/money");const{NumberField:c,NumberPrecision:u}=e("layout/ui/fields/number");const{SelectField:h}=e("layout/ui/fields/select");const{StringField:p}=e("layout/ui/fields/string");const{clone:g,set:m,get:S}=e("utils/object");const{DocumentType:D}=e("catalog/store/document-type");const{capitalize:F}=e("utils/string");class f extends LayoutComponent{constructor(e){super(e);this.state={product:g(this.props.product)};this.nameFieldRef=null;this.photoFieldRef=null;this.storeFromFieldRef=null;this.storeToFieldRef=null;this.layout=e.layout;this.initLayout();this.showReadAccessDenied=this.showReadAccessDenied.bind(this);this.showEditAccessDenied=this.showEditAccessDenied.bind(this)}render(){return View({style:{backgroundColor:"#eef2f4"},resizableByKeyboard:true},ScrollView({style:{backgroundColor:"#eef2f4",flexDirection:"column",flexGrow:1}},View({},this.renderForm(),this.renderMoreOpportunitiesButton())))}renderForm(){const e=this.buildFieldsList();return View({style:{padding:16,paddingTop:0,backgroundColor:"#ffffff",borderRadius:12,marginBottom:12}},FieldsWrapper({fields:e}))}renderMoreOpportunitiesButton(){return o({title:BX.message("CSPD_MORE_OPPORTUNITIES"),description:BX.message("CSPD_ADD_SKU"),onClick:this.openDesktopVersion.bind(this)})}getFieldsListForCurrentDocumentType(){const e=this.props.document.type;if(e===D.Arrival||e===D.StoreAdjustment){return["name","sections","barcode","gallery","amount","storeTo","purchasingPrice","sellingPrice"]}if(e===D.Moving){return["name","sections","barcode","gallery","amount","storeFrom","storeTo","purchasingPrice","sellingPrice"]}if(e===D.Deduct){return["name","sections","barcode","gallery","amount","storeFrom","purchasingPrice","sellingPrice"]}return[]}buildFieldsList(){const e=this.getFieldsListForCurrentDocumentType();const t=this.getFieldsDescriptions();const s=[];e.forEach((e=>{if(t[e]){s.push(t[e])}}));return s}getFieldsDescriptions(){const e={};const t=this.hasAccess("catalog_product_edit");e.name=p({testId:"ProductGridProductDetailsNameField",ref:e=>this.nameFieldRef=e,title:BX.message("CSPD_FIELDS_PRODUCT_NAME"),value:this.state.product.name,readOnly:this.isReadonly(),required:true,onChange:e=>this.updateFieldState("name",e),...this.getAccessProps(true,t)});e.sections=l({testId:"ProductGridProductDetailsSectionsField",title:BX.message("CSPD_FIELDS_PRODUCT_SECTIONS"),value:this.state.product.sections.map((e=>e.id)),readOnly:this.isReadonly(),multiple:true,config:{selectorType:EntitySelectorFactory.Type.SECTION,enableCreation:true,provider:{options:{iblockId:this.props.catalog.id}},entityList:this.state.product.sections.map((e=>({title:e.name,id:e.id,type:"section"}))),parentWidget:this.layout},onChange:(e,t)=>{const s=t.map((e=>({id:e.id,name:e.title})));this.updateFieldState("sections",s)},...this.getAccessProps(true,t)});e.barcode=r({testId:"ProductGridProductDetailsBarcodeField",title:BX.message("CSPD_FIELDS_BARCODE"),value:this.state.product.barcode,readOnly:this.isReadonly(),onChange:e=>this.updateFieldState("barcode",e),...this.getAccessProps(true,t),config:{parentWidget:this.layout}});const s=g(this.state.product.gallery);const i=g(this.state.product.galleryInfo);e.gallery=d({testId:"ProductGridProductDetailsGalleryField",ref:e=>this.photoFieldRef=e,title:BX.message("CSPD_FIELDS_PHOTOS"),multiple:true,value:s,config:{fileInfo:i,mediaType:"image",controller:{entityId:"catalog-product",options:{productId:this.state.product.productId}}},readOnly:this.isReadonly(),onChange:e=>this.updateFieldState("gallery",e),...this.getAccessProps(true,t)});const o=this.hasAccess("catalog_purchas_info");e.purchasingPrice=n({testId:"ProductGridProductDetailsPurchasingPriceField",title:BX.message("CSPD_FIELDS_PURCHASING_PRICE"),value:this.state.product.price.purchase,readOnly:this.arePricesReadonly(),config:{currencyReadOnly:true},onChange:e=>this.updateFieldState("price.purchase",e),...this.getAccessProps(o,t)});const m=this.hasAccess("catalog_price");e.sellingPrice=n({testId:"ProductGridProductDetailsSellingPriceField",title:BX.message("CSPD_FIELDS_SELLING_PRICE"),value:this.state.product.price.sell,readOnly:this.arePricesReadonly(),config:{currencyReadOnly:true},onChange:e=>this.updateFieldState("price.sell",e),...this.getAccessProps(true,m)});const F=this.props.document.type;const f=this.state.product.hasStoreToAccess!==false;const y=this.state.product.hasStoreFromAccess!==false;let P=true;if(F===D.Arrival||F===D.StoreAdjustment){P=f}else if(F===D.Moving){P=y&&f}else if(F===D.Deduct){P=y}e.amount=a({testId:"ProductGridProductDetailsAmountField",value:{amount:this.state.product.amount,measure:S(this.state.product,"measure.code","")},onChange:({amount:e,measure:t})=>{this.updateFieldState("amount",e);this.updateFieldState("measure",this.props.measures[t])},config:{primaryField:{id:"amount",renderField:c,title:[D.Arrival,D.StoreAdjustment].includes(F)?BX.message("CSPD_FIELDS_STORE_TO_AMOUNT"):BX.message("CSPD_FIELDS_AMOUNT"),value:this.state.product.amount,placeholder:"0",config:{type:u.DOUBLE,precision:10},...this.getAccessProps(P,true)},secondaryField:{id:"measure",renderField:h,title:BX.message("CSPD_FIELDS_MEASURES"),required:true,showRequired:false,config:{items:Object.values(this.props.measures).map((e=>({name:e.name,value:e.code})))},...this.getAccessProps(P,t),disabled:!t}},readOnly:this.isReadonly(),...this.getAccessProps(P,true)});e.storeFrom=this.getStoreSelectorField({fieldTitle:F===D.Moving?BX.message("CSPD_FIELDS_STORE_FROM"):BX.message("CSPD_FIELDS_STORE"),fieldCode:"storeFrom",storeInfo:this.state.product.storeFrom?this.state.product.storeFrom:null,access:y});e.storeTo=this.getStoreSelectorField({fieldTitle:F===D.Moving?BX.message("CSPD_FIELDS_STORE_TO"):BX.message("CSPD_FIELDS_STORE"),fieldCode:"storeTo",storeInfo:this.state.product.storeTo?this.state.product.storeTo:null,access:f});return e}getStoreSelectorField(e={}){const{fieldTitle:t,fieldCode:s,storeInfo:i,access:o}=e;let r=null;const a=[];if(i){r=i.id;a.push({id:i.id,title:i.title,type:"store"})}const d=this.hasAccess("catalog_store_all")&&this.hasAccess("catalog_store_modify");const n=F(s);return l({testId:`ProductGridProductDetails${n}Field`,ref:e=>this[s+"FieldRef"]=e,title:t,value:r,readOnly:this.isReadonly(),required:true,multiple:false,config:{selectorType:EntitySelectorFactory.Type.STORE,enableCreation:d,entityList:a,provider:{options:{useAddressAsTitle:true,productId:this.state.product.productId}},parentWidget:this.layout},onChange:(e,t)=>{let i;if(t.length){i={id:t[0].id,title:t[0].title}}else{i={id:null,title:null}}this.updateFieldState(s,i);this.updateFieldState(s+"Id",i.id)},...this.getAccessProps(o,true)})}getAccessProps(e=false,t=false){if(!e){return{disabled:true,placeholder:BX.message("CSPD_ACCESS_DENIED"),emptyValue:BX.message("CSPD_ACCESS_DENIED"),value:null,onContentClick:this.showReadAccessDenied}}if(!t){return{readOnly:true,onContentClick:this.showEditAccessDenied}}return{}}showReadAccessDenied(){Notify.showUniqueMessage(BX.message("CSPD_ACCESS_DENIED_NOTIFY_TEXT"),BX.message("CSPD_READ_ACCESS_DENIED_NOTIFY_TITLE"),{time:3})}showEditAccessDenied(){Notify.showUniqueMessage(BX.message("CSPD_ACCESS_DENIED_NOTIFY_TEXT"),BX.message("CSPD_EDIT_ACCESS_DENIED_NOTIFY_TITLE"),{time:3})}updateFieldState(e,t){this.setState((s=>{const i=g(s.product);m(i,e,t);return{product:i}}))}openDesktopVersion(){const e=this.state.product.desktopUrl;const t=S(this.props,"catalog.url.create_product","/");qrauth.open({title:BX.message("CSPD_OPEN_PRODUCT_IN_DESKTOP_VERSION"),redirectUrl:e||t,layout:this.layout})}initLayout(){this.layout.setRightButtons([{name:this.isReadonly()?BX.message("CSPD_CLOSE"):BX.message("CSPD_DONE"),type:"text",color:"#0b66c3",callback:this.close.bind(this)}]);this.layout.enableNavigationBarBorder(false)}close(){if(this.isReadonly()){this.layout.close()}else if(this.hasUploadingFiles()){this.showAlertToWaitUploading()}else if(this.validateFields()){if(this.props.onChange){this.props.onChange(this.state.product)}this.emit("StoreEvents.ProductDetails.Change",[this.state.product]);this.layout.close()}}hasUploadingFiles(){if(!this.photoFieldRef){return false}return this.photoFieldRef.hasUploadingFiles()}showAlertToWaitUploading(){i.alert(BX.message("CSPD_FIELDS_PHOTOS_UPLOADING"),BX.message("CSPD_FIELDS_PHOTOS_UPLOADING_DESC"),null,BX.message("CSPD_FIELDS_PHOTOS_UPLOADING_BUTTON"))}isReadonly(){const e=Boolean(this.props.document.editable);return!e}arePricesReadonly(){return[D.Deduct,D.Moving].includes(this.props.document.type)||this.isReadonly()}validateFields(){const e=!this.nameFieldRef||this.nameFieldRef.validate();if(!e){return false}if(this.storeFromFieldRef&&!this.storeFromFieldRef.validate()){return false}if(this.storeToFieldRef&&!this.storeToFieldRef.validate()){return false}return true}emit(e,t){BX.postComponentEvent(e,t)}hasAccess(e){return!!this.props.permissions[e]}}s.exports={CatalogStoreProductDetails:f}}));
//# sourceMappingURL=extension.map.js