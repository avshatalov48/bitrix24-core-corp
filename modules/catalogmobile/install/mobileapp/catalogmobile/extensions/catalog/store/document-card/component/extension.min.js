jn.define("catalog/store/document-card/component",((t,o,e)=>{const{PureComponent:n}=t("layout/pure-component");const{CatalogStoreActivationWizard:r}=t("catalog/store/activation-wizard");const{DetailCardComponent:c}=t("layout/ui/detail-card");const{DocumentType:s}=t("catalog/store/document-type");const a=t("apptheme");class i extends n{static createDetailCardComponent(t){const o=t.card.tabs.find((t=>t.id==="main"));if(o){o.desktopUrl=t.desktopUrl;o.onFetchHandler=t=>{if(t.editor){const o=i.getColorsForDocumentStatus(t.editor.ENTITY_DATA);t.editor.ENTITY_DATA.DOC_STATUS[0]={...t.editor.ENTITY_DATA.DOC_STATUS[0],...o}}}}t.card.reloadWithDataHandler=t=>{const o=t.find((t=>t.id==="main"));if(o){const t=i.getColorsForDocumentStatus(o.result.editor.ENTITY_DATA);o.result.editor.ENTITY_DATA.DOC_STATUS[0]={...o.result.editor.ENTITY_DATA.DOC_STATUS[0],...t}}};c.create(t.card).setItemActions([{id:"conductDocument",type:"primary",title:BX.message("MOBILE_STORE_DOCUMENT_CARD_COMPONENT_ACTION_CONDUCT_DOCUMENT"),onClickCallback:o=>new Promise(((e,n)=>{BX.ajax.runAction(`${t.endpoint}.conduct`,{json:{entityId:o.ID,docType:o.DOC_TYPE}}).then((n=>{t.eventEmitter.emit("Catalog.StoreDocument::onConduct",[o.DOC_TYPE]);e(n.data)}),(t=>{n(this.processErrorAction(t))})).catch((t=>{n(this.processErrorAction(t))}))})),onActiveCallback:o=>this.hasPermission(t.permissions,o,"catalog_store_document_conduct")&&!t.isDocumentConducted(o)}]).renderTo(layout).setAnalyticsProvider((t=>({entity:"store-document",type:t&&t.DOC_TYPE}))).setMenuActionsProvider(((o,e)=>{const{entityModel:n}=o;const r=[];const c=n.DOC_TYPE==="W"&&n.IS_EXTERNAL_CATALOG;const s=this.hasPermission(t.permissions,n,"catalog_store_document_cancel")&&t.isDocumentConducted(n)&&!c;if(s){r.push({id:"cancelDocument",sectionCode:"action",onItemSelected:(o,r)=>{const c={id:"cancelDocument"};e.onActionStart(c);BX.ajax.runAction(`${t.endpoint}.cancel`,{json:{entityId:n.ID,docType:n.DOC_TYPE}}).then((o=>{t.eventEmitter.emit("Catalog.StoreDocument::onCancel",[n.DOC_TYPE]);e.onActionSuccess(c,o.data)}),(t=>{e.onActionFailure(c,this.processErrorAction(t))}))},title:BX.message("MOBILE_STORE_DOCUMENT_CARD_COMPONENT_ACTION_CANCEL_DOCUMENT"),iconUrl:"/bitrix/mobileapp/catalogmobile/extensions/catalog/store/document-card/component/images/cancel_document.png"})}r.push({type:UI.Menu.Types.DESKTOP,showHint:false,showTopSeparator:s,data:{qrUrl:t.desktopUrl}});const a=this.getArticleCodeByType(n.DOC_TYPE);if(a){r.push({type:UI.Menu.Types.HELPDESK,data:{articleCode:a}})}return r}))}static getColorsForDocumentStatus(t){const o=t.STATUS;if(o==="Y"){return{backgroundColor:a.colors.accentSoftGreen1,color:a.colors.accentSoftElementGreen1}}if(o==="N"){if(t.WAS_CANCELLED==="Y"){return{backgroundColor:a.colors.accentSoftOrange1,color:a.colors.accentExtraBrown}}return{backgroundColor:a.colors.bgSeparatorSecondary,color:a.colors.base3}}return null}static getArticleCodeByType(t){switch(t){case s.StoreAdjustment:return"14662772";case s.Arrival:return"14662786";default:return null}}static processErrorAction(t){const o=t.errors.length>0?t.errors:[{message:"Could not perform action"}];const e=r.openIfNeeded(o);return{errors:o,showErrors:!e}}static hasPermission(t,o,e){return!o||t.document[o.DOC_TYPE][e]===true}}e.exports={DocumentCardComponent:i}}));
//# sourceMappingURL=extension.map.js