this.BX=this.BX||{};(function(e,t,s,i,n){"use strict";var r=function(){function e(t){babelHelpers.classCallCheck(this,e);this.scrumMeetings=null;this.scrumMethodology=null;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.groupId=!i.Type.isUndefined(t.groupId)?Number(t.groupId):0;this.urls=i.Type.isPlainObject(t.urls)?t.urls:{};var s=document.getElementById("tasks-scrum-meetings-button");if(s){s.addEventListener("click",this.showScrumMeetings.bind(this))}var n=document.getElementById("tasks-scrum-methodology-button");if(n){n.addEventListener("click",this.showScrumMethodology.bind(this))}}},{key:"showScrumMeetings",value:function e(t){var s=this;t.target.classList.add("ui-btn-wait");i.Runtime.loadExtension("tasks.scrum.meetings").then((function(e){var i=e.Meetings;if(s.scrumMeetings===null){s.scrumMeetings=new i({groupId:s.groupId})}s.scrumMeetings.showMenu(t.target);t.target.classList.remove("ui-btn-wait")}));t.preventDefault()}},{key:"showScrumMethodology",value:function e(t){var s=this;t.target.classList.add("ui-btn-wait");i.Runtime.loadExtension("tasks.scrum.methodology").then((function(e){var i=e.Methodology;if(s.scrumMethodology===null){s.scrumMethodology=new i({groupId:s.groupId,teamSpeedPath:s.urls.ScrumTeamSpeed,burnDownPath:s.urls.ScrumBurnDown,pathToTask:s.urls.TasksTask})}s.scrumMethodology.showMenu(t.target);t.target.classList.remove("ui-btn-wait")}));t.preventDefault()}}]);return e}();var a=function(){function e(t){babelHelpers.classCallCheck(this,e);this.projectWidgetInstance=null;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.groupId=!i.Type.isUndefined(t.groupId)?Number(t.groupId):0;this.avatarPath=i.Type.isStringFilled(t.avatarPath)?t.avatarPath:"";this.avatarType=i.Type.isStringFilled(t.avatarType)?t.avatarType:"";this.projectTypeCode=i.Type.isStringFilled(t.projectTypeCode)?t.projectTypeCode:"";this.canModify=i.Type.isBoolean(t.canModify)?t.canModify:false;this.urls=i.Type.isPlainObject(t.urls)?t.urls:{};var s=document.getElementById("project-widget-button");if(s){s.addEventListener("click",this.showProjectWidget.bind(this))}}},{key:"showProjectWidget",value:function e(s){if(this.projectWidgetInstance===null){this.projectWidgetInstance=new t.WorkgroupWidget({groupId:this.groupId,avatarPath:this.avatarPath,avatarType:this.avatarType,projectTypeCode:this.projectTypeCode,perms:{canModify:this.canModify},urls:{card:this.urls.Card,members:this.urls.GroupUsers,features:this.urls.Features}})}this.projectWidgetInstance.show(s.target);if(this.projectWidgetInstance.widget&&this.projectWidgetInstance.widget.getPopup()){BX.UI.Hint.init(this.projectWidgetInstance.widget.getPopup().getContentContainer())}s.preventDefault()}}]);return e}();var u=function(){function e(t){babelHelpers.classCallCheck(this,e);this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){var s=this;this.groupId=!i.Type.isUndefined(t.groupId)?Number(t.groupId):0;this.inIframe=!i.Type.isUndefined(t.inIframe)?!!t.inIframe:false;var n=document.getElementById("group-menu-control-button-cont");if(n){i.Runtime.loadExtension("intranet.control-button").then((function(e){var t=e.ControlButton;new t({container:n,entityType:"workgroup",entityId:s.groupId,buttonClassName:"intranet-control-btn-no-hover".concat(s.inIframe?" ui-btn-themes":"")})}))}}}]);return e}();var o=function(){function e(t,s){babelHelpers.classCallCheck(this,e);this.moreButtonInstance=!i.Type.isUndefined(s.moreButtonInstance)?s.moreButtonInstance:null;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){var n=this;this.groupId=!i.Type.isUndefined(t.groupId)?Number(t.groupId):0;this.urls=i.Type.isPlainObject(t.urls)?t.urls:{};s.EventEmitter.subscribe("SidePanel.Slider:onMessage",(function(e){var t=e.getCompatData(),s=babelHelpers.slicedToArray(t,1),i=s[0];if(i.getEventId()==="sonetGroupEvent"){n.sonetGroupEventHandler(i.getData())}}));s.EventEmitter.subscribe("sonetGroupEvent",(function(e){var t=e.getCompatData(),s=babelHelpers.slicedToArray(t,1),i=s[0];n.sonetGroupEventHandler(i)}))}},{key:"sonetGroupEventHandler",value:function e(s){if(!i.Type.isStringFilled(s.code)){return}if(["afterJoinRequestSend","afterEdit"].includes(s.code)){var n=document.getElementById("bx-group-menu-join-cont");if(n){n.style.display="none"}t.Common.reload()}else if(["afterSetFavorites"].includes(s.code)){var r=t.GroupMenu.getInstance();var a=r.favoritesValue;r.setItemTitle(!a);r.favoritesValue=!a}else if(["afterDelete","afterLeave"].includes(s.code)&&i.Type.isPlainObject(s.data)&&!i.Type.isUndefined(s.data.groupId)&&Number(s.data.groupId)===this.groupId){top.location.href=this.urls.GroupsList}else if(["afterSetSubscribe"].includes(s.code)&&i.Type.isPlainObject(s.data)&&!i.Type.isUndefined(s.data.groupId)&&Number(s.data.groupId)===this.groupId&&this.moreButtonInstance){this.moreButtonInstance.redrawMenu(s.data.value)}}}]);return e}();var l=function(){function e(t){babelHelpers.classCallCheck(this,e);this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.groupId=!i.Type.isUndefined(t.groupId)?Number(t.groupId):0;this.urls=i.Type.isPlainObject(t.urls)?t.urls:{};var s=document.getElementById("bx-group-menu-join");if(s){s.addEventListener("click",this.sendJoinRequest.bind(this))}}},{key:"sendJoinRequest",value:function e(n){var r=this;var a=n.currentTarget;t.Common.showButtonWait(a);i.ajax.runAction("socialnetwork.api.usertogroup.join",{data:{params:{groupId:this.groupId}}}).then((function(e){t.Common.hideButtonWait(a);if(e.data.success&&i.Type.isStringFilled(r.urls.view)){var n={code:"afterJoinRequestSend",data:{groupId:r.groupId}};s.EventEmitter.emit(window.top,"sonetGroupEvent",new s.BaseEvent({compatData:[n],data:[n]}));window.location.href=r.urls.view}}),(function(){t.Common.hideButtonWait(a)}))}}]);return e}();var c=function(){function e(t){babelHelpers.classCallCheck(this,e);this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){var n=this;this.pageId=i.Type.isStringFilled(t.pageId)?t.pageId:"";this.currentUserId=!i.Type.isUndefined(t.currentUserId)?Number(t.currentUserId):0;this.groupId=!i.Type.isUndefined(t.groupId)?Number(t.groupId):0;var r={compatMode:true};s.EventEmitter.subscribe("onPullEvent-tasks",(function(e,t){if(e==="user_counter"){n.onUserCounter(t)}}),r);if(this.pageId!=="group_tasks"){return}document.querySelectorAll(".tasks_role_link").forEach((function(e){e.addEventListener("click",n.onTaskMenuItemClick.bind(n))}));s.EventEmitter.subscribe("BX.Main.Filter:apply",(function(e){var t=e.getCompatData(),s=babelHelpers.slicedToArray(t,3),i=s[0],r=s[1],a=s[2];n.onFilterApply(i,r,a)}))}},{key:"onTaskMenuItemClick",value:function e(t){var i=t.currentTarget;t.preventDefault();var n=i.dataset.id==="view_all"?"":i.dataset.id;var r=i.dataset.url;s.EventEmitter.emit("Tasks.TopMenu:onItem",new s.BaseEvent({compatData:[n,r],data:[n,r]}));document.querySelectorAll(".tasks_role_link").forEach((function(e){e.classList.remove("main-buttons-item-active")}));i.classList.add("main-buttons-item-active")}},{key:"onUserCounter",value:function e(t){var s=this;if(this.currentUserId!==Number(t.userId)||!Object.prototype.hasOwnProperty.call(t,this.groupId)){return}Object.keys(t[this.groupId]).forEach((function(e){var i=document.getElementById("group_panel_menu_".concat(s.groupId?s.groupId+"_":"").concat(e));if(i){i.querySelector(".main-buttons-item-counter").innerText=s.getCounterValue(t[s.groupId][e].total)}}))}},{key:"getCounterValue",value:function e(t){if(!t){return""}var s=99;return t>s?"".concat(s,"+"):t}},{key:"onFilterApply",value:function e(t,s,n){var r=n.getFilterFieldsValues().ROLEID;document.querySelectorAll(".tasks_role_link").forEach((function(e){e.classList.remove("main-buttons-item-active")}));if(i.Type.isUndefined(r)||!r){r="view_all"}var a=document.getElementById("group_panel_menu_".concat(this.groupId,"_").concat(r));if(a){a.classList.add("main-buttons-item-active")}}}]);return e}();var d=function(){function e(t){babelHelpers.classCallCheck(this,e);this.menu=null;this["class"]={activeItem:"menu-popup-item-sgm-accept-sm",inactiveItem:"menu-popup-item-sgm-empty-sm"};this.init(t);return this}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.groupId=!i.Type.isUndefined(t.groupId)?Number(t.groupId):0;this.bindingMenuItems=i.Type.isObject(t.bindingMenuItems)?Object.values(t.bindingMenuItems):[];this.userIsMember=i.Type.isBoolean(t.userIsMember)?t.userIsMember:false;this.subscribedValue=i.Type.isBoolean(t.subscribedValue)?t.subscribedValue:false;var s=document.getElementById("group-menu-more-button");if(!s){return}s.addEventListener("click",this.showMoreMenu.bind(this))}},{key:"showMoreMenu",value:function e(t){var s=this;t.preventDefault();var r=[];this.bindingMenuItems.forEach((function(e){r.push(e)}));var a=[];if(this.userIsMember){a.push({id:"subscribe",text:i.Loc.getMessage("SONET_SGM_T_MORE_MENU_SUBSCRIBE"),className:this.subscribedValue?this["class"].activeItem:this["class"].inactiveItem,onclick:function e(){s.setSubscription(true)}});a.push({id:"unsubscribe",text:i.Loc.getMessage("SONET_SGM_T_MORE_MENU_UNSUBSCRIBE"),className:!this.subscribedValue?this["class"].activeItem:this["class"].inactiveItem,onclick:function e(){s.setSubscription(false)}})}if(r.length>0){if(a.length>0){a.push({delimiter:true})}a.push({text:i.Loc.getMessage("SONET_SGM_T_MORE_MENU_BINDING"),items:r})}if(a.length<=0){return}var u=t.target;this.menu=n.MenuManager.create({id:"group-more-menu",offsetTop:5,offsetLeft:u.offsetWidth-18,angle:true,items:a,events:{onPopupClose:function e(){if(u.tagName==="BUTTON"){u.classList.remove("ui-btn-active")}}},subMenuOptions:{}});this.menu.popupWindow.setBindElement(u);this.menu.popupWindow.show()}},{key:"setSubscription",value:function e(t){var s=this;this.redrawMenu(t);i.ajax.runAction("socialnetwork.api.workgroup.setSubscription",{data:{params:{groupId:this.groupId,value:t?"Y":"N"}}}).then((function(e){var t={code:"afterSetSubscribe",data:{groupId:s.groupId,value:e.RESULT==="Y"}};window.top.BX.SidePanel.Instance.postMessageAll(window,"sonetGroupEvent",t)}))["catch"]((function(){s.redrawMenu(!t)}))}},{key:"redrawMenu",value:function e(t){if(!this.menu){return}var s=this.menu.getMenuItem(t?"subscribe":"unsubscribe");var i=this.menu.getMenuItem(t?"unsubscribe":"subscribe");if(s){s.layout.item.classList.remove(this["class"].inactiveItem);s.layout.item.classList.add(this["class"].activeItem)}if(i){i.layout.item.classList.remove(this["class"].activeItem);i.layout.item.classList.add(this["class"].inactiveItem)}}}]);return e}();var p=function(){function e(t){babelHelpers.classCallCheck(this,e);this.initialized=false;this.moreButtonInstance=null;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(s){if(this.initialized===true){return}this.initialized=true;this.pageId=i.Type.isStringFilled(s.pageId)?s.pageId:"";this.currentUserId=!i.Type.isUndefined(s.currentUserId)?Number(s.currentUserId):0;this.groupId=!i.Type.isUndefined(s.groupId)?Number(s.groupId):0;this.groupType=i.Type.isStringFilled(s.groupType)?s.groupType:"";this.projectTypeCode=i.Type.isStringFilled(s.projectTypeCode)?s.projectTypeCode:"";this.userRole=i.Type.isStringFilled(s.userRole)?s.userRole:"";this.userIsMember=i.Type.isBoolean(s.userIsMember)?s.userIsMember:false;this.userIsAutoMember=i.Type.isBoolean(s.userIsAutoMember)?s.userIsAutoMember:false;this.userIsScrumMaster=i.Type.isBoolean(s.userIsScrumMaster)?s.userIsScrumMaster:false;this.isProject=i.Type.isBoolean(s.isProject)?s.isProject:false;this.isScrumProject=i.Type.isBoolean(s.isScrumProject)?s.isScrumProject:false;this.isOpened=i.Type.isBoolean(s.isOpened)?s.isOpened:false;this.favoritesValue=i.Type.isBoolean(s.favoritesValue)?s.favoritesValue:false;this.canInitiate=i.Type.isBoolean(s.canInitiate)?s.canInitiate:false;this.canModify=i.Type.isBoolean(s.canModify)?s.canModify:false;this.canProcessRequestsIn=i.Type.isBoolean(s.canProcessRequestsIn)?s.canProcessRequestsIn:false;this.canPickTheme=i.Type.isBoolean(s.canPickTheme)?s.canPickTheme:false;this.avatarPath=i.Type.isStringFilled(s.avatarPath)?s.avatarPath:"";this.avatarType=i.Type.isStringFilled(s.avatarType)?s.avatarType:"";this.urls=i.Type.isPlainObject(s.urls)?s.urls:{};this.editFeaturesAllowed=i.Type.isBoolean(s.editFeaturesAllowed)?s.editFeaturesAllowed:true;this.copyFeatureAllowed=i.Type.isBoolean(s.copyFeatureAllowed)?s.copyFeatureAllowed:true;new l(s);new u(s);new r(s);new a(s);new c(s);this.moreButtonInstance=new d(s);new o(s,{moreButtonInstance:this.moreButtonInstance});var n=document.getElementById("bx-group-menu-settings");if(n){var p=t.GroupMenu.getInstance();p.favoritesValue=this.favoritesValue;n.addEventListener("click",this.showMenu.bind(this))}}},{key:"showMenu",value:function e(s){t.Common.showGroupMenuPopup({bindElement:s.currentTarget,groupId:this.groupId,groupType:this.groupType,userRole:this.userRole,userIsMember:this.userIsMember,userIsAutoMember:this.userIsAutoMember,userIsScrumMaster:this.userIsScrumMaster,isProject:this.isProject,isScrumProject:this.isScrumProject,isOpened:this.isOpened,editFeaturesAllowed:this.editFeaturesAllowed,copyFeatureAllowed:this.copyFeatureAllowed,canPickTheme:this.canPickTheme,perms:{canInitiate:this.canInitiate,canProcessRequestsIn:this.canProcessRequestsIn,canModify:this.canModify},urls:{requestUser:i.Type.isStringFilled(this.urls.Invite)?this.urls.Invite:"".concat(this.urls.Edit).concat(this.urls.Edit.indexOf("?")>=0?"&":"?","tab=invite"),edit:"".concat(this.urls.Edit).concat(this.urls.Edit.indexOf("?")>=0?"&":"?","tab=edit"),delete:this.urls.Delete,features:this.urls.Features,members:this.urls.GroupUsers,requests:this.urls.GroupRequests,requestsOut:this.urls.GroupRequestsOut,userRequestGroup:this.urls.UserRequestGroup,userLeaveGroup:this.urls.UserLeaveGroup,copy:this.urls.Copy}});s.preventDefault()}}]);return e}();e.GroupMenu=p})(this.BX.Intranet=this.BX.Intranet||{},BX.Socialnetwork.UI,BX.Event,BX,BX.Main);
//# sourceMappingURL=script.map.js