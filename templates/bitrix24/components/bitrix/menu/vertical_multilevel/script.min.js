BX.namespace("BX.Bitrix24");BX.Bitrix24.MenuClass=function(){var t=function(t){t=typeof t==="object"?t:{};this.arFavouriteAll=t.arFavouriteAll||{};this.arFavouriteShowAll=t.arFavouriteShowAll||{};this.arTitles=t.arTitles||[];this.ajaxPath=t.ajaxPath||null;this.isAdmin=t.isAdmin==="Y";this.hiddenCounters=t.hiddenCounters||{};this.allCounters=t.allCounters||{};this.isBitrix24=t.isBitrix24==="Y";this.siteId=t.siteId||null;this.isCompositeMode=t.isCompositeMode===true;this.activeItemsId=[];if(t.arHiddenItemsSelected){for(var e in t.arHiddenItemsSelected){this.showHideMoreItems(BX("more_btn_"+t.arHiddenItemsSelected[e]),t.arHiddenItemsSelected[e])}}for(var i=0,s=this.arTitles.length;i<s;i++){var a=this.arTitles[i];var r=BX(a);if(!r||BX.hasClass(r,"menu-favorites")){continue}BX.bind(r,"click",BX.proxy(this.showHideMenuSection2,{element:r,self:this}));BX.bind(r.lastChild,"click",BX.proxy(this.showHideMenuSection,{element:r.lastChild,self:this}))}};t.prototype.showHideMenuSection=function(t){if(this.self.isCompositeMode){this.self.clearCompositeCache()}t=t||window.event;BX.eventCancelBubble(t);B24.toggleMenu(this.element.parentNode,BX.message("menu_show"),BX.message("menu_hide"))};t.prototype.showHideMenuSection2=function(){if(!this.self.isEditMode()){if(this.self.isCompositeMode){this.self.clearCompositeCache()}B24.toggleMenu(this.element,BX.message("menu_show"),BX.message("menu_hide"))}};t.prototype.isEditMode=function(){return BX.hasClass(BX("div_menu-favorites"),"menu-favorites-editable")};t.prototype.applyEditMode=function(){var t=this.isEditMode();var e=BX.findChildren(BX("bx_b24_menu"),{className:"menu-items-block"},true);for(var i in e){if(t)BX.removeClass(e[i],"menu-favorites-editable");else BX.addClass(e[i],"menu-favorites-editable")}if(!t){BX.addClass(BX("menu_favorites_settings"),"menu-favorites-btn-active");var s=BX.findChildren(BX("bx_b24_menu"),{className:"menu-item-active"},true);for(i in s){if(!t){BX.removeClass(s[i],"menu-item-active");this.activeItemsId.push(s[i].id)}}}else{BX.removeClass(BX("menu_favorites_settings"),"menu-favorites-btn-active");for(var a in this.activeItemsId){BX.addClass(BX(this.activeItemsId[a]),"menu-item-active")}this.activeItemsId=[]}var r=[];for(var o=0;o<this.arTitles.length;o++){if(this.arTitles[o]!="menu-favorites"){BX(this.arTitles[o]).onbxdragstart=BX.proxy(this.sectionDragStart,this);BX(this.arTitles[o]).onbxdrag=BX.proxy(this.sectionDragMove,this);BX(this.arTitles[o]).onbxdragstop=BX.proxy(this.sectionDragStop,this);BX(this.arTitles[o]).onbxdraghover=BX.proxy(this.sectionDragHover,this);jsDD.registerObject(BX(this.arTitles[o]))}jsDD.registerDest(BX(this.arTitles[o]).parentNode,200);if(!t){jsDD.Enable();var n=BX.findChildren(BX("ul_"+this.arTitles[o]),{tagName:"li"},true);for(var l=0;l<n.length;l++){if(n[l].id=="separator_"+this.arTitles[o])break;if((this.isBitrix24&&this.arTitles[o]=="menu-favorites"||this.arTitles[o]=="menu-groups")&&n[l].id=="empty_li_"+this.arTitles[o])continue;if(this.isBitrix24&&n[l].id=="menu_live_feed"||n[l].id=="menu_all_groups"){jsDD.registerDest(n[l]);continue}r.push(n[l].id);n[l].onbxdragstart=BX.proxy(this.menuItemDragStart,this);n[l].onbxdrag=BX.proxy(this.menuItemDragMove,this);n[l].onbxdragstop=BX.proxy(this.menuItemDragStop,this);n[l].onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(n[l],100);jsDD.registerObject(n[l])}}var n=BX.findChildren(BX("hidden_items_ul_"+this.arTitles[o]),{tagName:"li"},true);if(n.length>0)BX("separator_"+this.arTitles[o]).style.display=t?"none":"block";else BX("separator_"+this.arTitles[o]).style.display="none"}};t.prototype.showHideMoreItems=function(t,e){BX.toggleClass(BX("hidden_items_li_"+e),"menu-item-favorites-more-open");BX.toggleClass(t,"menu-favorites-more-btn-open");if(e=="menu-favorites")BX.toggleClass(BX("menu-hidden-counter"),"menu-hidden-counter");BX.firstChild(t).innerHTML=BX.firstChild(t).innerHTML==BX.message("more_items_hide")?BX.message("more_items_show"):BX.message("more_items_hide")};t.prototype.openMenuPopup=function(t,e){var i=[];var s=this;var a=false;for(var r=0,o=this.arFavouriteAll.length;r<o;r++){if(this.arFavouriteAll[r]==e)a=true}var n=BX(e).getAttribute("data-can-delete-from-favorite");var l=BX(e).getAttribute("data-title-item");if(!a&&n=="Y")i.push({text:BX.message("add_to_favorite"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();s.addFavouriteItem(e,l,"N");BX.PopupMenu.destroy("popup_"+e)}});if(a&&n=="Y")i.push({text:BX.message("delete_from_favorite"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();s.deleteFavouriteItem(e,l,"N");BX.PopupMenu.destroy("popup_"+e)}});if(BX(e).getAttribute("data-status")=="show")i.push({text:BX.message("hide_item"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();s.hideItem(e,l);BX.PopupMenu.destroy("popup_"+e)}});if(BX(e).getAttribute("data-status")=="hide")i.push({text:BX.message("show_item"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();s.showItem(e,l);BX.PopupMenu.destroy("popup_"+e)}});if(this.isAdmin){if(!a)i.push({text:BX.message("add_to_favorite_all"),className:"menu-popup-no-icon",onclick:function(){s.addFavouriteItem(e,l,"Y");BX.PopupMenu.destroy("popup_"+e)}});if(a&&n=="A")i.push({text:BX.message("delete_from_favorite_all"),className:"menu-popup-no-icon",onclick:function(){s.deleteFavouriteItem(e,l,"Y");BX.PopupMenu.destroy("popup_"+e)}});if(BX(e).getAttribute("data-app-id"))i.push({text:BX.message("set_rights"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();s.setRights(e);BX.PopupMenu.destroy("popup_"+e)}})}var h=BX.PopupMenu.show("popup_"+e,t,i,{offsetTop:0,offsetLeft:12,angle:true,events:{onPopupClose:function(){BX.removeClass(t,"menu-favorites-btn-active")}}});BX.addClass(t,"menu-favorites-btn-active")};t.prototype.showError=function(t){var e=BX.PopupWindowManager.create("menu-error",t,{content:BX.message("edit_error"),angle:{offset:10},offsetTop:0,events:{onPopupClose:function(){BX.removeClass(this.bindElement,"filter-but-act")}},autoHide:true});e.setBindElement(t);e.show()};t.prototype.setRights=function(t){BX.rest.Marketplace.setRights(BX(t).getAttribute("data-app-id"),this.siteid)};t.prototype.addFavouriteItem=function(t,e,i){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:i=="Y"?"add_favorite_admin":"add_favorite",menu_item_id:t,title_item_id:e,all_show_items:this.arFavouriteShowAll},onsuccess:BX.proxy(function(s){if(s.error){this.showError(BX(t))}else{BX.removeClass(BX.firstChild(BX(t)),"menu-favorites-btn-active");var a=BX.clone(BX(t));BX(t).id="hidden_"+t;BX("hidden_"+t).style.display="none";BX("ul_menu-favorites").insertBefore(a,BX("separator_menu-favorites"));BX(t).setAttribute("data-title-item","menu-favorites");BX(t).setAttribute("data-status","show");if(i=="Y")BX(t).setAttribute("data-can-delete-from-favorite","A");BX(t).onbxdragstart=BX.proxy(this.menuItemDragStart,this);BX(t).onbxdrag=BX.proxy(this.menuItemDragMove,this);BX(t).onbxdragstop=BX.proxy(this.menuItemDragStop,this);BX(t).onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(BX(t));jsDD.registerObject(BX(t));var r=BX.findChildren(BX("ul_"+e),{tagName:"li"},true);var o=false;for(var n=0;n<r.length;n++){if(r[n].id!="hidden_"+t&&r[n].style.display!="none"&&r[n].id!="separator_"+e&&r[n].id!="empty_li_"+e&&r[n].id!="hidden_items_li_"+e){o=true;break}}if(!o)BX("div_"+e).style.display="none";this.arFavouriteShowAll.push(t);this.arFavouriteAll.push(t);var l=BX.findChildren(BX("hidden_items_ul_"+e),{tagName:"li"},true);var h=false;for(var n=0;n<l.length;n++){if(l[n].id!="hidden_"+t&&l[n].style.display!="none"){h=true;break}}if(!h){BX("more_btn_"+e).style.display="none";BX("separator_"+e).style.display="none"}}},this)})};t.prototype.deleteFavouriteItem=function(t,e,i){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:i=="Y"?"delete_favorite_admin":"delete_favorite",menu_item_id:t,title_item_id:e},onsuccess:BX.proxy(function(s){if(s.error){this.showError(BX(t))}else{BX.remove(BX(t));BX("hidden_"+t).id=t;BX(t).style.display="block";if(i=="Y")BX(t).setAttribute("data-can-delete-from-favorite","Y");var a=BX(t).getAttribute("data-title-item");BX("div_"+a).style.display="block";for(var r=0,o=this.arFavouriteAll.length;r<o;r++){if(this.arFavouriteAll[r]==t){this.arFavouriteAll.splice(r,1)}}for(r=0,o=this.arFavouriteShowAll.length;r<o;r++){if(this.arFavouriteShowAll[r]==t){this.arFavouriteShowAll.splice(r,1)}}var n=BX.findChildren(BX("hidden_items_ul_"+a),{tagName:"li"},true);var l=false;for(r=0;r<n.length;r++){if(n[r].style.display!="none"){l=true;break}}if(l){BX("more_btn_"+a).style.display="block";BX("separator_"+a).style.display="block"}var h=BX.findChildren(BX("hidden_items_ul_"+e),{tagName:"li"},true);if(h.length<=0){BX("more_btn_"+e).style.display="none";BX("separator_"+e).style.display="none"}}},this)})};t.prototype.hideItem=function(t,e){for(var i=0,s=this.arFavouriteShowAll.length;i<s;i++){if(this.arFavouriteShowAll[i]==t){this.arFavouriteShowAll.splice(i,1)}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"hide",menu_item_id:t,title_item_id:e,all_show_items:this.arFavouriteShowAll},onsuccess:BX.proxy(function(i){if(i.error){this.showError(BX(t))}else{BX("separator_"+e).style.display="block";BX(t).setAttribute("data-status","hide");var s=BX.clone(BX(t));BX.remove(BX(t));BX("hidden_items_ul_"+e).appendChild(s);BX("more_btn_"+e).style.display="block";if(BX(t).getAttribute("data-counter-id")){this.hiddenCounters.push(BX(t).getAttribute("data-counter-id"));var a=0;for(var r=0;r<this.hiddenCounters.length;r++){a+=+this.allCounters[this.hiddenCounters[r]]}BX("menu-hidden-counter").innerHTML=a>50?"50+":a;if(a>0)BX("menu-hidden-counter").style.display="inline-block"}}},this)})};t.prototype.showItem=function(t,e){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"show",menu_item_id:t,title_item_id:e},onsuccess:BX.proxy(function(i){if(i.error){this.showError(BX(t))}else{this.arFavouriteShowAll.push(t);BX(t).setAttribute("data-status","show");BX("ul_"+e).insertBefore(BX(t),BX("separator_"+e));BX(t).onbxdragstart=BX.proxy(this.menuItemDragStart,this);BX(t).onbxdrag=BX.proxy(this.menuItemDragMove,this);BX(t).onbxdragstop=BX.proxy(this.menuItemDragStop,this);BX(t).onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(BX(t));jsDD.registerObject(BX(t));var s=BX.findChildren(BX("hidden_items_ul_"+e),{tagName:"li"},true);if(s.length<=0){BX("more_btn_"+e).style.display="none";BX("separator_"+e).style.display="none"}if(BX(t).getAttribute("data-counter-id")){for(var a=0,r=this.hiddenCounters.length;a<r;a++){if(this.hiddenCounters[a]==BX(t).getAttribute("data-counter-id"))this.hiddenCounters.splice(a,1)}var o=0;for(a=0;a<this.hiddenCounters.length;a++){o+=+this.allCounters[this.hiddenCounters[a]]}BX("menu-hidden-counter").innerHTML=o>50?"50+":o;if(o<=0)BX("menu-hidden-counter").style.display="none"}}},this)})};t.prototype.sortItems=function(t,e){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"sort_items",title_item_id:e,all_title_items:t},onsuccess:BX.proxy(function(t){},this)})};t.prototype.sortSections=function(t){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"sort_sections",all_sections:t},onsuccess:BX.proxy(function(t){},this)})};t.prototype.menuItemDragStart=function(){if(!this.isEditMode())return;var t=BX.proxy_context;this.bxparent=t.parentNode;this.objHeight=36;BX.addClass(t,"menu-item-draggable");this.bxblank=this.bxparent.insertBefore(BX.create("DIV",{style:{height:"0px"}}),t);this.bxblank1=BX.create("DIV",{style:{height:this.objHeight+"px"}});jsDD.disableDest(this.bxparent);this.bxcp=BX.create("DIV",{attrs:{className:"menu-draggable-wrap"},children:[t]});this.bxpos=BX.pos(this.bxparent);var e=BX.findChildren(this.bxparent,{tagName:"li"},true);var i=0;var s=false;for(var a=0;a<e.length;a++){if(e[a].id=="separator_"+t.getAttribute("data-title-item"))break;if(e[a].id=="empty_li_"+t.getAttribute("data-title-item"))continue;if(e[a].style.display=="none")continue;i++}this.countObj=i>0?i:0;this.bxparent.style.position="relative";this.bxparent.appendChild(this.bxcp)};t.prototype.menuItemDragMove=function(t,e){if(!this.isEditMode())return;var i=BX.proxy_context;e-=this.bxpos.top;if(this.isBitrix24&&(i.getAttribute("data-title-item")=="menu-favorites"||i.getAttribute("data-title-item")=="menu-groups")&&e<this.objHeight)e=this.objHeight;else if(e<0)e=0;if(e>this.countObj*this.objHeight)e=this.countObj*this.objHeight;this.bxcp.style.top=e+"px"};t.prototype.menuItemDragHover=function(t,e,i){if(!this.isEditMode())return;var s=BX.proxy_context;if(BX.hasClass(s,"menu-items-title")||BX.hasClass(t,"menu-items-title")||BX.hasClass(t,"menu-items-block"))return;i-=this.bxpos.top;if(t==s){this.bxparent.insertBefore(this.bxblank1,this.bxblank)}else if(t.parentNode==this.bxparent){if(this.bxparent.parentNode.id==t.parentNode.parentNode.id){if(t.nextSibling)this.bxparent.insertBefore(this.bxblank1,t.nextSibling);else this.bxparent.appendChild(this.bxblank1)}}};t.prototype.menuItemDragStop=function(){if(!this.isEditMode())return;var t=BX.proxy_context;BX.removeClass(t,"menu-item-draggable");if(this.bxblank1&&this.bxblank1.parentNode==this.bxparent){this.bxparent.replaceChild(t,this.bxblank1);var e=[];var i=BX.findChildren(t.parentNode,{tagName:"li"},true);for(var s=0;s<i.length;s++){if(i[s].id=="empty_li_"+t.getAttribute("data-title-item"))continue;if(i[s].id=="separator_"+t.getAttribute("data-title-item"))break;e.push(i[s].id)}this.sortItems(e,t.getAttribute("data-title-item"))}else{this.bxparent.replaceChild(t,this.bxblank)}BX.remove(this.bxcp);BX.remove(this.bxblank);BX.remove(this.bxblank1);jsDD.enableDest(t);this.bxparent.style.position="static";this.bxcp=null;this.bxpos=null;this.bxparent=null;this.bxblank=null;this.bxblank1=null;jsDD.refreshDestArea()};t.prototype.sectionDragStart=function(){if(!this.isEditMode())return;var t=BX.proxy_context;this.bxSectParent=t.parentNode.parentNode;this.bxSectParentHeight=t.parentNode.parentNode.offsetHeight;this.objSectHeight=t.parentNode.offsetHeight;this.bxSectBlank=this.bxSectParent.insertBefore(BX.create("DIV",{style:{height:"0px"}}),t.parentNode);this.bxSectBlank1=BX.create("DIV",{style:{height:this.objSectHeight+"px"}});jsDD.disableDest(this.bxSectParent);this.bxSectBlock=BX.create("DIV",{style:{position:"absolute",zIndex:"100",height:this.objSectHeight-14+"px",width:t.parentNode.offsetWidth+"px",paddingTop:"10px",borderRadius:"3px",backgroundColor:"rgba(206, 218, 220, .9)"},children:[t.parentNode]});this.bxSectPos=BX.pos(this.bxSectParent);this.bxSectParent.style.position="relative";this.bxSectParent.appendChild(this.bxSectBlock)};t.prototype.sectionDragMove=function(t,e){if(!this.isEditMode())return;e-=this.bxSectPos.top;if(e<0)e=0;if(e>this.bxSectParentHeight)e=this.bxSectParentHeight;this.bxSectBlock.style.top=e+"px"};t.prototype.sectionDragHover=function(t,e,i){if(!this.isEditMode())return;var s=BX.proxy_context;if(BX.hasClass(s,"menu-item-block")||BX.hasClass(t,"menu-item-block")||BX.hasClass(t,"menu-items-empty-li"))return;if(t==s.parentNode){this.bxSectParent.insertBefore(this.bxSectBlank1,this.bxSectBlank)}else{if(t.nextSibling)this.bxSectParent.insertBefore(this.bxSectBlank1,t.nextSibling);else this.bxSectParent.appendChild(this.bxSectBlank1)}};t.prototype.sectionDragStop=function(){if(!this.isEditMode())return;var t=BX.proxy_context;if(this.bxSectBlank1&&this.bxSectBlank1.parentNode==this.bxSectParent){this.bxSectParent.replaceChild(t.parentNode,this.bxSectBlank1);var e=[];var i=BX.findChildren(t.parentNode.parentNode,{className:"menu-items-title"},true);for(var s=0;s<i.length;s++){e.push(i[s].id)}this.sortSections(e,t.getAttribute("data-title-item"))}else{this.bxSectParent.replaceChild(t.parentNode,this.bxSectBlank)}BX.remove(this.bxSectBlock);BX.remove(this.bxSectBlank);BX.remove(this.bxSectBlank1);jsDD.enableDest(t);this.bxSectBlock=null;this.bxSectBlank=null;this.bxSectBlank1=null;this.bxSectParent=null;jsDD.refreshDestArea()};t.prototype.clearCompositeCache=function(){BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"clear"},function(t){})};t.highlight=function(e){var i=BX("bx_b24_menu");if(!BX.type.isNotEmptyString(e)||!i){return false}var s=i.getElementsByTagName("a");var a=-1;var r=-1;var o=null;for(var n=0,l=s.length;n<l;n++){var h=s[n].getAttribute("href");if(!BX.type.isNotEmptyString(h)){continue}if(e.indexOf(h)===0){var d=h.length;if(d>r){a=n;o=h;r=d}}}var p=s[a].parentNode;if(o=="/"&&o==e){BX.addClass(p,"menu-item-active")}else if(o!==null&&o!="/"){BX.addClass(p,"menu-item-active")}var u=p.parentNode.parentNode;if(BX.hasClass(u,"menu-item-favorites-more")&&!BX.hasClass(u,"menu-item-favorites-more-open")){var m=BX.firstChild(u.parentNode.parentNode).getAttribute("id");t.prototype.showHideMoreItems(BX("more_btn_"+m),m)}return true};return t}();
//# sourceMappingURL=script.map.js