BX.namespace("BX.Mobile");BX.Mobile.Profile=function(){"use strict";return{user:{},pullDown:{},isWebRTCSupported:false,menu:[],actionSheet:null,userPhotoUrl:false,init:function(e){if(e){this.user=e.user||{};this.pullDown=e.pullDown||{};this.isWebRTCSupported=e.isWebRTCSupported===true;this.menu=BX.type.isArray(e.menu)?e.menu:[];this.userPhotoUrl=BX.type.isNotEmptyString(e.userPhotoUrl)?e.userPhotoUrl:false}BX.ready(BX.proxy(this.ready,this))},ready:function(){this.initButtons();this.initMenu();this.initAvatar();this.initStatus();this.initPullDown()},initButtons:function(){var e=[this.getVideoButton(),this.getAudioButton(),this.getTextButton()];var t=document.createDocumentFragment();for(var i=0;i<e.length;i++){var s=e[i];if(s===null){continue}var n=BX.create("div",{props:{className:"emp-profile-button "+s.className},children:[BX.create("span",{text:s.title})],events:{touchstart:function(e){BX.addClass(this,"emp-profile-button-selected")},touchend:function(e){BX.removeClass(this,"emp-profile-button-selected")}}});new FastButton(n,s.click);t.appendChild(n)}if(t.childNodes.length>0){var o=BX("emp-profile-buttons");BX.addClass(o,"emp-profile-buttons-"+t.childNodes.length);o.appendChild(t)}else{BX.addClass(BX("emp-profile"),"emp-profile-no-buttons")}},getVideoButton:function(){var e=null;if(app.enableInVersion(9)&&this.isWebRTCSupported&&BX.message("USER_ID")!=this.user.id&&this.user.external_auth_id!="email"&&this.user.external_auth_id!="bot"&&this.user.external_auth_id!="network"&&this.user.external_auth_id!="imconnector"){e={className:"emp-profile-video",title:BX.message("SONET_VIDEO_CALL"),click:BX.proxy(function(e){BXMobileApp.onCustomEvent("onCallInvite",{userId:this.user.id},true);BX.eventReturnFalse(e)},this)}}return e},getAudioButton:function(){var e=this.getAudioMenuItems();if(e.length<1){return null}return{className:"emp-profile-audio",title:BX.message("SONET_AUDIO_CALL"),click:BX.proxy(function(t){this.showAudioMenu(e);BX.eventReturnFalse(t)},this)}},getAudioMenuItems:function(){var e=[];if(app.enableInVersion(9)&&this.isWebRTCSupported&&BX.message("USER_ID")!=this.user.id&&this.user.external_auth_id!="email"&&this.user.external_auth_id!="bot"&&this.user.external_auth_id!="network"){e.push({title:BX.message("SONET_AUDIO_CALL"),callback:BX.proxy(function(){BXMobileApp.onCustomEvent("onCallInvite",{userId:this.user.id,video:false},true)},this)})}var t=[this.user.work_phone,this.user.personal_mobile];for(var i=0;i<t.length;i++){if(BX.type.isNotEmptyString(t[i])){var s={title:t[i],callback:function(){BX.MobileTools.phoneTo(this.title)}};s.callback=BX.delegate(s.callback,s);e.push(s)}}if(e.length>0&&!app.enableInVersion(10)){e.push({title:BX.message("MB_CANCEL"),callback:function(){}})}return e},showAudioMenu:function(e){if(app.enableInVersion(10)){if(this.actionSheet===null){this.actionSheet=new BXMobileApp.UI.ActionSheet({buttons:e},"actionSheetId")}this.actionSheet.show()}else{var t=[];for(var i=0;i<e.length;i++){t.push(e[i].title)}app.confirm({callback:function(t){t=t>1?t-1:0;e[t]["callback"]()},title:BX.message("MB_CALL"),buttons:t})}},getTextButton:function(){if(BX.message("USER_ID")==this.user.id||this.user.external_auth_id=="email"){return null}return{className:"emp-profile-text",title:BX.message("SONET_MESSAGE"),click:BX.proxy(function(e){BXMobileApp.PageManager.loadPageUnique({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/im/dialog.php",bx24ModernStyle:true,data:{dialogId:this.user.id}});BX.eventReturnFalse(e)},this)}},initMenu:function(){if(this.menu.length>0){app.menuCreate({items:this.menu});if(app.enableInVersion(10)){BXMobileApp.UI.Page.TopBar.title.setText(BX.message("SONET_TITLE"));BXMobileApp.UI.Page.TopBar.title.setCallback(function(){app.menuShow()});BXMobileApp.UI.Page.TopBar.title.show()}else{app.addButtons({menuButton:{type:"context-menu",style:"custom",callback:function(){app.menuShow()}}})}}},initAvatar:function(){if(this.userPhotoUrl!==false){new FastButton(BX("emp-profile"),BX.proxy(function(e){BXMobileApp.UI.Photo.show({photos:[{url:this.userPhotoUrl}]})},this))}},initStatus:function(){this.updateStatus(this.user.is_online=="Y");BXMobileApp.addCustomEvent("onPullOnline",BX.delegate(function(e){var t=e.params;e=e.command;if((e=="user_online"||e=="user_status")&&this.user.id==t.USER_ID){if(e=="user_status"){window.pageColor=t.COLOR;BX.style(BX("emp-profile"),"background-color",t.COLOR);app.exec("setTopBarColors",{background:t.COLOR,titleText:"#ffffff",titleDetailText:"#f0f0f0"})}this.updateStatus(true)}else if(e=="user_offline"&&this.user.id==t.USER_ID){this.updateStatus(false)}else if(e=="online_list"){this.updateStatus(typeof t.USERS[this.user.id]!=="undefined")}},this))},updateStatus:function(e){if(this.user.external_auth_id=="bot"){e=true}var t=BX("emp-profile-status",true);if(e){t.className="emp-profile-status emp-profile-status-online";t.innerHTML=BX.message("STATUS_ONLINE")}else{t.className="emp-profile-status emp-profile-status-offline";t.innerHTML=BX.message("STATUS_OFFLINE")}},initPullDown:function(){if(app.enableInVersion(2)){this.pullDown.action="RELOAD"}else{this.pullDown.callback=function(){document.location.reload()}}app.pullDown(this.pullDown)}}}();
//# sourceMappingURL=script.map.js