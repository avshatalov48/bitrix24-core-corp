(function(){if(window.BX.LikeResultMobile){return}BX.namespace("BX.LikeResultMobile");BX.LikeResultMobile=function(e){this.currentReaction=BX.type.isNotEmptyString(e.currentReaction)?e.currentReaction:"";this.pathToUserProfile=e.pathToUserProfile;this.entityTypeId=e.entityTypeId;this.entityId=e.entityId;this.blockScrollRequest=false;this.userIdList=[];this.tabData=null};BX.LikeResultMobile.initPage=function(){app.getPageParams({callback:function(e){if(BX("like-result-block")){var t=BX("like-result-block").getAttribute("data-user-path"),i=e.entityTypeId,r=parseInt(e.entityId);if(!BX.type.isNotEmptyString(i)||r<=0){return}var s=new BX.LikeResultMobile({pathToUserProfile:t,entityTypeId:i,entityId:r});s.cleanHead();s.cleanUsers();s.get()}}})};BX.LikeResultMobile.prototype={get:function(){BX.rest.callBatch({reactions:["like.reactions",{ENTITY_TYPE_ID:this.entityTypeId,ENTITY_ID:this.entityId}],likeList:["like.list",{ENTITY_TYPE_ID:this.entityTypeId,ENTITY_ID:this.entityId,REACTION:this.currentReaction=="all"?"":this.currentReaction,PATH_TO_USER_PROFILE:this.pathToUserProfile}]},function(e){if(e.reactions.error()||e.likeList.error()){console.error("LikeResultMobile.requestConfigData: failed",[e.reactions.error(),e.likeList.error()]);return false}this.tabData=e.reactions;this.buildHead(e.reactions);this.processUsersResult(e.likeList)}.bind(this))},buildHead:function(e){var t=BX("like-result-head"),i=e.data(),r=[],s=reactionsCount=0;this.cleanHead();for(reaction in i){if(i.hasOwnProperty(reaction)){if(parseInt(i[reaction])>0){reactionsCount++;s+=parseInt(i[reaction]);r.push({reaction:reaction,count:i[reaction]})}}}if(reactionsCount>1){t.appendChild(this.buildTabNode({reaction:"all",count:s}))}if(reactionsCount==0){r.push({reaction:BX.message("RATING_LIKE_REACTION_DEFAULT"),count:s})}if(BX("like-result-block")){if(reactionsCount>3){BX("like-result-block").classList.add("bx-ilike-head-length-modifier")}else{BX("like-result-block").classList.remove("bx-ilike-head-length-modifier")}}r.sort(function(e,t){var i={like:0,kiss:1,laugh:2,wonder:3,cry:4,angry:5,facepalm:6};if(i[e.reaction]<i[t.reaction]){return-1}if(i[e.reaction]>i[t.reaction]){return 1}return 0});for(var n=0;n<r.length;n++){t.appendChild(this.buildTabNode(r[n]))}},cleanHead:function(){var e=BX("like-result-head");BX.cleanNode(e)},buildTabNode:function(e){return BX.create("span",{props:{className:"bx-ilike-mobile-popup-head-item"+(e.reaction==this.currentReaction||e.reaction=="all"&&!BX.type.isNotEmptyString(this.currentReaction)?" bx-ilike-mobile-popup-head-item-current":"")},attrs:e.reaction!="all"?{title:BX.message("RATING_LIKE_EMOTION_"+e.reaction.toUpperCase()+"_CALC")}:{},children:e.reaction=="all"?[BX.create("span",{props:{className:"bx-ilike-mobile-popup-head-text"},html:BX.message("RATING_LIKE_POPUP_ALL").replace("#CNT#",e.count)})]:[BX.create("span",{props:{className:"bx-ilike-mobile-popup-head-icon bx-ilike-mobile-emoji-icon-item bx-ilike-mobile-emoji-icon-"+e.reaction}}),BX.create("span",{props:{className:"bx-ilike-mobile-popup-head-text"},html:e.count})],events:{click:BX.proxy(function(){this.currentReaction=e.reaction;this.userIdList=[];this.buildHead(this.tabData);this.cleanUsers();this.get()},this)}})},cleanUsers:function(){var e=BX("like-result-content");if(!e){return}BX.cleanNode(e)},processUsersResult:function(e){var t=null;if(BX.type.isNotEmptyObject(e.query)&&BX.type.isNotEmptyString(e.query.data)){e.query.data.split("&").forEach(function(e){var i=e.split("=");if(i.length===2){var r=i[0];var s=i[1];if(BX.type.isNotEmptyString(r)&&r==="REACTION"){t=s}}})}if(t!==null&&this.currentReaction!==t&&!(this.currentReaction==="all"&&t==="")){return}this.blockScrollRequest=false;var i=e.data();var r=BX("like-result-content");if(!r){return}var s=0;for(ind in i){if(i.hasOwnProperty(ind)&&!BX.util.in_array(i[ind].USER_ID,this.userIdList)){s++;r.appendChild(this.buildUserNode(i[ind]));this.userIdList.push(i[ind].USER_ID)}}if(s<=0){return}if(e.more()&&BX.pos(r).height<window.innerHeight-BX("like-result-head").clientHeight){this.blockScrollRequest=true;e.next(BX.proxy(this.processUsersResult,this))}BX.bind(BX("like-result-page"),"scroll",BX.proxy(function(){var t=BX.proxy_context;if(!this.blockScrollRequest&&t.scrollTop>(t.scrollHeight-t.offsetHeight)/1.5){this.blockScrollRequest=true;e.next(BX.proxy(this.processUsersResult,this));BX.unbindAll(t)}},this))},buildUserNode:function(e){return BX.create("a",{attrs:{href:e.URL},props:{className:"bx-ilike-mobile-popup-user-item"},children:[BX.create("span",{style:BX.type.isNotEmptyString(e.PHOTO_SRC)?{"background-image":'url("'+e.PHOTO_SRC+'")'}:{},props:{className:"bx-ilike-mobile-popup-user-icon"}}),BX.create("span",{props:{className:"bx-ilike-mobile-popup-user-name"},html:e.FULL_NAME})]})}};BX.ready(function(){BXMPage.getTitle().setText(BX.message("RVR_MOBILE_TITLE"));BXMPage.getTitle().show();BX.LikeResultMobile.initPage();BX.addCustomEvent("onOpenPageBefore",BX.LikeResultMobile.initPage)})})();
//# sourceMappingURL=script.map.js