if(typeof BX.CrmMobileContext==="undefined"){BX.CrmMobileContext=function(){this._reloadOnPullDown=false};BX.CrmMobileContext.prototype={initialize:function(){},isOffLine:function(){return BMNetworkStatus&&BMNetworkStatus.offline},isAndroid:function(){return BX.type.isNotEmptyString(window["platform"])&&window["platform"].toUpperCase()=="ANDROID"},createMenu:function(t){if(!app){return false}app.menuCreate({items:t});return true},showMenu:function(){if(app){app.menuShow()}},hideMenu:function(){if(app){app.menuHide()}},createMenuButton:function(){if(!app){return false}app.addButtons({menuButton:{type:"context-menu",style:"custom",callback:function(){app.menuShow()}}});return true},createButtons:function(t){if(!app){return false}app.addButtons(t);return true},removeButtons:function(t){if(!app){return false}app.removeButtons(t);return true},prepareMenu:function(t){if(!app){return false}if(t.length===0){return false}app.menuCreate({items:t});app.addButtons({menuButton:{type:"context-menu",style:"custom",callback:function(){app.menuShow()}}});return true},beginRequest:function(t){(new MobileAjaxWrapper).Wrap(t);return true},open:function(t){if(app){app.loadPageBlank(t)}},redirect:function(t){window.BXMobileApp.PageManager.loadPageBlank(t)},back:function(){if(app){app.closeController({drop:window["platform"]==="android"})}},getPageParams:function(t){if(app){app.getPageParams(t)}},createBackHandler:function(){return BX.delegate(this.back,this)},reload:function(){if(app){app.reload()}},close:function(){if(app){app.closeController({drop:true})}},createCloseHandler:function(){return BX.delegate(this.close,this)},enableReloadOnPullDown:function(t){if(!t){t={}}this._reloadOnPullDown=true;if(app){app.pullDown({enable:true,pulltext:BX.type.isNotEmptyString(t["pullText"])?t["pullText"]:"",downtext:BX.type.isNotEmptyString(t["downText"])?t["downText"]:"",loadtext:BX.type.isNotEmptyString(t["loadText"])?t["loadText"]:"",callback:BX.delegate(this._onPagePullDown,this)})}},showPopupLoader:function(){if(app){app.showPopupLoader()}},hidePopupLoader:function(){if(app){app.hidePopupLoader()}},showWait:function(){if(app){app.showLoadingScreen()}},hideWait:function(){if(app){app.hideLoadingScreen()}},showModal:function(t){if(app){app.showModalDialog(t)}},closeModal:function(){if(app){app.closeModalDialog()}},createCloseModalHandler:function(){return BX.delegate(this.closeModal,this)},riseEvent:function(t,e,i){if(i===undefined){i=3}if(i===1||i===3){BX.onCustomEvent(t,[e])}if((i===2||i===3)&&app){app.onCustomEvent(t,e)}},_onPagePullDown:function(t){if(app&&this._reloadOnPullDown){app.reload()}},openUserSelector:function(t){var e=typeof t["callback"]!=="undefined"?t["callback"]:null;var i=typeof t["multiple"]!=="undefined"?!!t["multiple"]:false;var n=BX.type.isNotEmptyString(t["okButtonTitle"])?t["okButtonTitle"]:"";var r=BX.type.isNotEmptyString(t["cancelButtonTitle"])?t["cancelButtonTitle"]:"";if(app){app.openTable({callback:e,url:"/mobile/index.php?mobile_action=get_user_list",markmode:true,multiple:i,return_full_mode:true,skipSpecialChars:true,modal:true,alphabet_index:true,outsection:false,okname:n,cancelname:r})}},showDatePicker:function(t,e,i){var n=new Date(t);var r=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear()+" "+n.getHours()+":"+n.getMinutes();if(app){app.showDatePicker({start_date:r,format:"M/d/y H:m",type:e,callback:i})}},confirm:function(t,e,i,n){if(app){app.confirm({title:t,text:e,buttons:i,callback:n})}},alert:function(t,e,i,n){if(app){app.alert({title:t,text:e,button:i,callback:n})}}};BX.CrmMobileContext.current=null;BX.CrmMobileContext.getCurrent=function(){if(!this.current){this.current=new BX.CrmMobileContext;this.current.initialize()}return this.current};BX.CrmMobileContext.redirect=function(t){this.getCurrent().redirect(t)}}if(typeof BX.CrmEntityDispatcher==="undefined"){BX.CrmEntityDispatcher=function(){this._id="";this._settings={};this._models={};this._requestIsRunning=false};BX.CrmEntityDispatcher.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};var i=this.getTypeName();var n=this.getSetting("data",[]);for(var r=0;r<n.length;r++){this.createEntityModel(n[r],i,true)}var s=this.getSetting("pullTag","");if(app&&BX.type.isNotEmptyString(s)){BXMobileApp.onCustomEvent("onPullExtendWatch",{id:s},true)}BX.addCustomEvent("onPull-crm",BX.delegate(this,this._onPull));BX.addCustomEvent(window,"onCrmEntityUpdate",BX.delegate(this._onExternalUpdate,this));BX.addCustomEvent(window,"onCrmEntityDelete",BX.delegate(this._onExternalDelete,this))},getId:function(){return this._id},getSettings:function(){return this._settings},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getTypeName:function(){return this.getSetting("typeName","")},createEntityModel:function(t,e,i){var n=BX.CrmEntityDispatcher.constructEntityModel(t,e);if(i===true){this.registerEntityModel(n)}return n},registerEntityModel:function(t){this._models[t.getKey()]=t},getModelById:function(t){var e=this._getModelKey(this.getTypeName(),t);return this._models.hasOwnProperty(e)?this._models[e]:null},getModelByKey:function(t){return this._models.hasOwnProperty(t)?this._models[t]:null},_getModelKey:function(t,e){return BX.CrmEntityModel.prepareKey(t,e)},_onPull:function(t){if(!t){return}var e=this.getSetting("updateEventName","");var i=this.getSetting("deleteEventName","");var n=BX.type.isNotEmptyString(t["command"])?t["command"]:"";if(n===""){return}var r=t&&t["params"]&&t.params["ID"]?parseInt(t.params.ID):0;if(isNaN(r)||r<=0){return}var s=this._getModelKey(this.getTypeName(),r);var a=this._models.hasOwnProperty(s)?this._models[s]:null;if(!a){return}if(n===e){this.readEntity(id)}else if(n===i){a.notifyDeleted();delete this._models[s]}},_onExternalDelete:function(t){var e=typeof t["senderId"]!=="undefined"?t["senderId"]:"";if(e===this.getId()){return}var i=typeof t["typeName"]!=="undefined"?t["typeName"]:"";if(i!==this.getTypeName()){return}var n=typeof t["id"]!=="undefined"?parseInt(t["id"]):0;var r=this._getModelKey(i,n);if(typeof this._models[r]!=="undefined"){this._models[r].notifyDeleted();delete this._models[r]}},_onExternalUpdate:function(t){var e=typeof t["senderId"]!=="undefined"?t["senderId"]:"";if(e===this.getId()){return}var i=typeof t["typeName"]!=="undefined"?t["typeName"]:"";if(i!==this.getTypeName()){return}var n=typeof t["id"]!=="undefined"?parseInt(t["id"]):0;var r=this._getModelKey(i,n);if(typeof this._models[r]!=="undefined"){var s=typeof t["data"]!=="undefined"?t["data"]:null;if(s){var a=this._models[r];a.setData(s);a.notifyUpdated()}else{var o=this;this.readEntity(n,function(){o._models[r].notifyUpdated()})}}},createEntity:function(t,e,i){if(this._requestIsRunning){return false}this._requestIsRunning=true;if(!i){i={}}var n=BX.CrmMobileContext.getCurrent();n.showPopupLoader();var r=this.getTypeName();var s=this;BX.ajax({url:this.getSetting("serviceUrl",""),method:"POST",dataType:"json",data:{ACTION:"SAVE_ENTITY",ENTITY_TYPE_NAME:r,ENTITY_DATA:t,FORMAT_PARAMS:this.getSetting("formatParams",{})},onsuccess:function(t){s._requestIsRunning=false;n.hidePopupLoader();if(BX.type.isNotEmptyString(t["ERROR"])){n.alert(BX.type.isNotEmptyString(i["title"])?i["title"]:"",t["ERROR"]);return}var a=typeof t["SAVED_ENTITY_ID"]!=="undefined"?parseInt(t["SAVED_ENTITY_ID"]):0;var o=typeof t["SAVED_ENTITY_DATA"]!=="undefined"?t["SAVED_ENTITY_DATA"]:null;var l={senderId:s.getId(),typeName:r,id:a,data:o,contextId:BX.type.isNotEmptyString(i["contextId"])?i["contextId"]:""};if(typeof e==="function"){e(l)}if(a>0){n.riseEvent("onCrmEntityCreate",l)}},onfailure:function(t){s._requestIsRunning=false;n.hidePopupLoader()}});return true},readEntity:function(t,e){var i=this.getTypeName();var n=this;BX.ajax({url:this.getSetting("serviceUrl",""),method:"POST",dataType:"json",data:{ACTION:"GET_ENTITY",ENTITY_TYPE_NAME:i,ENTITY_ID:t,FORMAT_PARAMS:this.getSetting("formatParams",{})},onsuccess:function(r){var s=r&&r["ENTITY"]?r["ENTITY"]:null;if(s){var a=n.getModelById(t);if(a){a.setData(s);a.notifyUpdated()}else{a=n.createEntityModel(s,i);t=a.getId();if(t>0){n._models[n._getModelKey(i,t)]=a}}}if(typeof e==="function"){e(s)}},onfailure:function(t){}})},updateEntity:function(t,e,i){if(this._requestIsRunning){return false}this._requestIsRunning=true;if(!i){i={}}var n=BX.CrmMobileContext.getCurrent();n.showPopupLoader();var r=this.getTypeName();var s=this;BX.ajax({url:this.getSetting("serviceUrl",""),method:"POST",dataType:"json",data:{ACTION:"SAVE_ENTITY",ENTITY_TYPE_NAME:r,ENTITY_DATA:t,FORMAT_PARAMS:this.getSetting("formatParams",{})},onsuccess:function(t){s._requestIsRunning=false;n.hidePopupLoader();if(BX.type.isNotEmptyString(t["ERROR"])){n.alert(BX.type.isNotEmptyString(i["title"])?i["title"]:"",t["ERROR"]);return}var a=typeof t["SAVED_ENTITY_ID"]!=="undefined"?parseInt(t["SAVED_ENTITY_ID"]):0;var o=typeof t["SAVED_ENTITY_DATA"]!=="undefined"?t["SAVED_ENTITY_DATA"]:null;var l={senderId:s.getId(),typeName:r,id:a,data:o,contextId:BX.type.isNotEmptyString(i["contextId"])?i["contextId"]:""};if(typeof e==="function"){e(l)}if(a>0){n.riseEvent("onCrmEntityUpdate",l);var d=s._getModelKey(r,a);if(typeof s._models[d]!=="undefined"){if(o){var u=s._models[d];u.setData(o);u.notifyUpdated()}else{s.readEntity(a,function(){s._models[d].notifyUpdated()})}}}},onfailure:function(t){s._requestIsRunning=false;n.hidePopupLoader()}});return true},deleteEntity:function(t,e){if(this._requestIsRunning){return false}this._requestIsRunning=true;var i=BX.CrmMobileContext.getCurrent();i.showPopupLoader();var n=this.getTypeName();var r=this;BX.ajax({url:this.getSetting("serviceUrl",""),method:"POST",dataType:"json",data:{ACTION:"DELETE_ENTITY",ENTITY_TYPE_NAME:n,ENTITY_ID:t},onsuccess:function(t){r._requestIsRunning=false;i.hidePopupLoader();if(BX.type.isNotEmptyString(t["ERROR"])){i.alert("",t["ERROR"]);return}var s=typeof t["DELETED_ENTITY_ID"]!=="undefined"?parseInt(t["DELETED_ENTITY_ID"]):0;var a={senderId:r.getId(),typeName:n,id:s};if(typeof e==="function"){e(a)}if(s>0){i.riseEvent("onCrmEntityDelete",a);var o=r._getModelKey(n,s);if(typeof r._models[o]!=="undefined"){r._models[o].notifyDeleted();delete r._models[o]}}},onfailure:function(t){r._requestIsRunning=false;i.hidePopupLoader()}});return true},execUpdateAction:function(t,e,i,n){if(this._requestIsRunning){return false}this._requestIsRunning=true;var r=BX.CrmMobileContext.getCurrent();r.showPopupLoader();var s=this.getTypeName();var a=this;BX.ajax({url:this.getSetting("serviceUrl",""),method:"POST",dataType:"json",data:{ACTION:t.toUpperCase(),ENTITY_TYPE_NAME:s,ENTITY_DATA:e,FORMAT_PARAMS:this.getSetting("formatParams",{})},onsuccess:function(t){a._requestIsRunning=false;r.hidePopupLoader();var e=typeof t["SAVED_ENTITY_ID"]!=="undefined"?parseInt(t["SAVED_ENTITY_ID"]):0;var o=typeof t["SAVED_ENTITY_DATA"]!=="undefined"?t["SAVED_ENTITY_DATA"]:null;var l={senderId:a.getId(),typeName:s,id:e,data:o,contextId:n&&BX.type.isNotEmptyString(n["contextId"])?n["contextId"]:""};if(typeof i==="function"){i(l)}if(e>0){r.riseEvent("onCrmEntityUpdate",l);var d=a._getModelKey(s,e);if(typeof a._models[d]!=="undefined"){if(o){var u=a._models[d];u.setData(o);u.notifyUpdated()}else{a.readEntity(e,function(){a._models[d].notifyUpdated()})}}}},onfailure:function(t){a._requestIsRunning=false;r.hidePopupLoader()}});return true}};BX.CrmEntityDispatcher.items={};BX.CrmEntityDispatcher.create=function(t,e){var i=new BX.CrmEntityDispatcher;i.initialize(t,e);this.items[i.getId()]=i;return i};BX.CrmEntityDispatcher.constructEntityModel=function(t,e){if(!BX.type.isNotEmptyString(e)){e=t&&BX.type.isNotEmptyString(t["__TYPE_NAME"])?t["__TYPE_NAME"]:"";if(e===""){e=this.getTypeName()}}var i=null;if(e===BX.CrmDealModel.typeName){i=BX.CrmDealModel.create(t)}else if(e===BX.CrmContactModel.typeName){i=BX.CrmContactModel.create(t)}else if(e===BX.CrmCompanyModel.typeName){i=BX.CrmCompanyModel.create(t)}else if(e===BX.CrmLeadModel.typeName){i=BX.CrmLeadModel.create(t)}else if(e===BX.CrmActivityModel.typeName){i=BX.CrmActivityModel.create(t)}else if(e===BX.CrmEventModel.typeName){i=BX.CrmEventModel.create(t)}else if(e===BX.CrmStatusModel.typeName){i=BX.CrmStatusModel.create(t)}else if(e===BX.CrmProductModel.typeName){i=BX.CrmProductModel.create(t)}else if(e===BX.CrmProductSectionModel.typeName){i=BX.CrmProductSectionModel.create(t)}else if(e===BX.CrmCurrencyModel.typeName){i=BX.CrmCurrencyModel.create(t)}else if(e===BX.CrmCommunicationModel.typeName){i=BX.CrmCommunicationModel.create(t)}else if(e===BX.CrmActivityModel.typeName){i=BX.CrmActivityModel.create(t)}else if(e===BX.CrmInvoiceModel.typeName){i=BX.CrmInvoiceModel.create(t)}else if(e===BX.CrmPaySystemModel.typeName){i=BX.CrmPaySystemModel.create(t)}else if(e===BX.CrmLocationModel.typeName){i=BX.CrmLocationModel.create(t)}else{i=BX.CrmEntityModel.create(t)}return i}}if(typeof BX.CrmEntityModel==="undefined"){BX.CrmEntityModel=function(){};BX.CrmEntityModel.prototype={initialize:function(t){this._data=t?t:{};this._views=[]},getData:function(){return this._data},setData:function(t){this._data=t?t:{}},getDataParam:function(t,e){return this._data.hasOwnProperty(t)?this._data[t]:e},getStringParam:function(t,e){if(typeof e==="undefined"){e=""}return this._data.hasOwnProperty(t)?this._data[t]:e},getFloatParam:function(t,e){if(typeof e==="undefined"){e=0}return this._data.hasOwnProperty(t)?parseFloat(this._data[t]):e},getIntParam:function(t,e){if(typeof e==="undefined"){e=0}return this._data.hasOwnProperty(t)?parseInt(this._data[t]):e},getBoolParam:function(t,e){if(typeof e==="undefined"){e=false}if(!this._data.hasOwnProperty(t)){return e}var i=this._data[t];if(BX.type.isBoolean(i)){return i}else if(BX.type.isString(i)){i=i.toUpperCase().trim();return i==="Y"||i==="YES"}else if(BX.type.isNumber(i)){return i>0}return i},getArrayParam:function(t,e){if(typeof e==="undefined"){e=[]}return this._data.hasOwnProperty(t)&&BX.type.isArray(this._data[t])?this._data[t]:e},setParam:function(t,e){this._data[t]=e},getId:function(){return parseInt(this.getDataParam("ID",0))},getTypeName:function(){return this.getDataParam("__TYPE_NAME","")},getKey:function(){var t=this.getTypeName();if(t===""){t="ENTITY"}return BX.CrmEntityModel.prepareKey(t,this.getId())},addView:function(t){this._views.push(t)},removeView:function(t){for(var e=0;e<this._views.length;e++){if(this._views[e]===t){this._views.splice(e,1)}}},notifyUpdated:function(){for(var t=0;t<this._views.length;t++){try{this._views[t].handleModelUpdate(this)}catch(e){}}},notifyDeleted:function(){for(var t=0;t<this._views.length;t++){try{this._views[t].handleModelDelete(this)}catch(e){}}},getCaption:function(){return this.getTypeName()+"_"+this.getId()}};BX.CrmEntityModel.prepareKey=function(t,e){return t.toUpperCase()+"_"+e.toString()};BX.CrmEntityModel.create=function(t){var e=new BX.CrmEntityModel;e.initialize(t);return e}}if(typeof BX.CrmDealModel==="undefined"){BX.CrmDealModel=function(){};BX.extend(BX.CrmDealModel,BX.CrmEntityModel);BX.CrmDealModel.prototype.getTypeName=function(){return BX.CrmDealModel.typeName};BX.CrmDealModel.typeName="DEAL";BX.CrmDealModel.checkContact=function(t,e){if(!e){return false}var i=typeof e["CONTACT_ID"]!=="undefined"?parseInt(e["CONTACT_ID"]):0;return parseInt(t)===i};BX.CrmDealModel.checkCompany=function(t,e){if(!e){return false}var i=typeof e["COMPANY_ID"]!=="undefined"?parseInt(e["COMPANY_ID"]):0;return parseInt(t)===i};BX.CrmDealModel.create=function(t){var e=new BX.CrmDealModel;e.initialize(t);return e}}if(typeof BX.CrmContactModel==="undefined"){BX.CrmContactModel=function(){};BX.extend(BX.CrmContactModel,BX.CrmEntityModel);BX.CrmContactModel.prototype.getTypeName=function(){return BX.CrmContactModel.typeName};BX.CrmContactModel.prototype.getCaption=function(){return this.getStringParam("FORMATTED_NAME")};BX.CrmContactModel.typeName="CONTACT";BX.CrmContactModel.create=function(t){var e=new BX.CrmContactModel;e.initialize(t);return e}}if(typeof BX.CrmCompanyModel==="undefined"){BX.CrmCompanyModel=function(){};BX.extend(BX.CrmCompanyModel,BX.CrmEntityModel);BX.CrmCompanyModel.prototype.getTypeName=function(){return BX.CrmCompanyModel.typeName};BX.CrmCompanyModel.prototype.getCaption=function(){return this.getStringParam("TITLE")};BX.CrmCompanyModel.typeName="COMPANY";BX.CrmCompanyModel.create=function(t){var e=new BX.CrmCompanyModel;e.initialize(t);return e}}if(typeof BX.CrmLeadModel==="undefined"){BX.CrmLeadModel=function(){};BX.extend(BX.CrmLeadModel,BX.CrmEntityModel);BX.CrmLeadModel.prototype.getTypeName=function(){return BX.CrmLeadModel.typeName};BX.CrmLeadModel.prototype.getCaption=function(){return this.getStringParam("TITLE")};BX.CrmLeadModel.typeName="LEAD";BX.CrmLeadModel.create=function(t){var e=new BX.CrmLeadModel;e.initialize(t);return e}}if(typeof BX.CrmActivityModel==="undefined"){BX.CrmActivityModel=function(){};BX.extend(BX.CrmActivityModel,BX.CrmEntityModel);BX.CrmActivityModel.prototype.getTypeName=function(){return BX.CrmActivityModel.typeName};BX.CrmActivityModel.typeName="ACTIVITY";BX.CrmActivityModel.checkBindings=function(t,e,i){if(!i){return false}var n=typeof i["OWNER_TYPE"]!=="undefined"?i["OWNER_TYPE"]:"";var r=typeof i["OWNER_ID"]!=="undefined"?parseInt(i["OWNER_ID"]):0;if(t===n&&e===r){return true}var s=typeof i["COMMUNICATIONS"]!=="undefined"?i["COMMUNICATIONS"]:[];for(var a=0;a<s.length;a++){var o=s[a];var l=typeof o["ENTITY_TYPE"]!=="undefined"?o["ENTITY_TYPE"]:"";var d=typeof o["ENTITY_ID"]!=="undefined"?parseInt(o["ENTITY_ID"]):0;if(t===l&&e===d){return true}}return false};BX.CrmActivityModel.create=function(t){var e=new BX.CrmActivityModel;e.initialize(t);return e}}if(typeof BX.CrmEventModel==="undefined"){BX.CrmEventModel=function(){};BX.extend(BX.CrmEventModel,BX.CrmEntityModel);BX.CrmEventModel.prototype.getTypeName=function(){return BX.CrmEventModel.typeName};BX.CrmEventModel.typeName="EVENT";BX.CrmEventModel.create=function(t){var e=new BX.CrmEventModel;e.initialize(t);return e}}if(typeof BX.CrmStatusModel==="undefined"){BX.CrmStatusModel=function(){};BX.extend(BX.CrmStatusModel,BX.CrmEntityModel);BX.CrmStatusModel.prototype.getTypeName=function(){return BX.CrmStatusModel.typeName};BX.CrmStatusModel.typeName="STATUS";BX.CrmStatusModel.create=function(t){var e=new BX.CrmStatusModel;e.initialize(t);return e}}if(typeof BX.CrmCurrencyModel==="undefined"){BX.CrmCurrencyModel=function(){};BX.extend(BX.CrmCurrencyModel,BX.CrmEntityModel);BX.CrmCurrencyModel.prototype.getId=function(){return this.getDataParam("ID","")};BX.CrmCurrencyModel.prototype.getTypeName=function(){return BX.CrmCurrencyModel.typeName};BX.CrmCurrencyModel.typeName="CURRENCY";BX.CrmCurrencyModel.create=function(t){var e=new BX.CrmCurrencyModel;e.initialize(t);return e}}if(typeof BX.CrmProductModel==="undefined"){BX.CrmProductModel=function(){};BX.extend(BX.CrmProductModel,BX.CrmEntityModel);BX.CrmProductModel.prototype.getTypeName=function(){return BX.CrmProductModel.typeName};BX.CrmProductModel.prototype.getCaption=function(){return this.getStringParam("NAME")};BX.CrmProductModel.typeName="PRODUCT";BX.CrmProductModel.create=function(t){var e=new BX.CrmProductModel;e.initialize(t);return e}}if(typeof BX.CrmProductRowModel==="undefined"){BX.CrmProductRowModel=function(){};BX.extend(BX.CrmProductRowModel,BX.CrmEntityModel);BX.CrmProductRowModel.prototype.getTypeName=function(){return BX.CrmProductRowModel.typeName};BX.CrmProductRowModel.prototype.getCaption=function(){return this.getStringParam("PRODUCT_NAME")};BX.CrmProductRowModel.typeName="PRODUCT_ROW";BX.CrmProductRowModel.create=function(t){var e=new BX.CrmProductRowModel;e.initialize(t);return e}}if(typeof BX.CrmProductSectionModel==="undefined"){BX.CrmProductSectionModel=function(){};BX.extend(BX.CrmProductSectionModel,BX.CrmEntityModel);BX.CrmProductSectionModel.prototype.getTypeName=function(){return BX.CrmProductSectionModel.typeName};BX.CrmProductSectionModel.prototype.getCaption=function(){return this.getStringParam("NAME")};BX.CrmProductSectionModel.typeName="PRODUCT_SECTION";BX.CrmProductSectionModel.create=function(t){var e=new BX.CrmProductSectionModel;e.initialize(t);return e}}if(typeof BX.CrmCommunicationModel==="undefined"){BX.CrmCommunicationModel=function(){};BX.extend(BX.CrmCommunicationModel,BX.CrmEntityModel);BX.CrmCommunicationModel.prototype.getTypeName=function(){return BX.CrmCommunicationModel.typeName};BX.CrmCommunicationModel.prototype.getCaption=function(){return this.getStringParam("TITLE")};BX.CrmCommunicationModel.typeName="COMMUNICATION";BX.CrmCommunicationModel.create=function(t){var e=new BX.CrmCommunicationModel;e.initialize(t);return e};BX.CrmCommunicationModel.prototype.getId=function(){return this.getDataParam("ID","")}}if(typeof BX.CrmInvoiceModel==="undefined"){BX.CrmInvoiceModel=function(){};BX.extend(BX.CrmInvoiceModel,BX.CrmEntityModel);BX.CrmInvoiceModel.prototype.getTypeName=function(){return BX.CrmInvoiceModel.typeName};BX.CrmInvoiceModel.typeName="INVOICE";BX.CrmInvoiceModel.create=function(t){var e=new BX.CrmInvoiceModel;e.initialize(t);return e}}if(typeof BX.CrmPaySystemModel==="undefined"){BX.CrmPaySystemModel=function(){};BX.extend(BX.CrmPaySystemModel,BX.CrmEntityModel);BX.CrmPaySystemModel.prototype.getTypeName=function(){return BX.CrmPaySystemModel.typeName};BX.CrmPaySystemModel.typeName="PAY_SYSTEM";BX.CrmPaySystemModel.create=function(t){var e=new BX.CrmPaySystemModel;e.initialize(t);return e}}if(typeof BX.CrmLocationModel==="undefined"){BX.CrmLocationModel=function(){};BX.extend(BX.CrmLocationModel,BX.CrmEntityModel);BX.CrmLocationModel.prototype.getTypeName=function(){return BX.CrmLocationModel.typeName};BX.CrmLocationModel.typeName="LOCATION";BX.CrmLocationModel.create=function(t){var e=new BX.CrmLocationModel;e.initialize(t);return e}}if(typeof BX.CrmEntityView==="undefined"){BX.CrmEntityView=function(){};BX.CrmEntityView.prototype={initialize:function(t){this._settings=t?t:{};this.doInitialize()},getSettings:function(){return this._settings},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},doInitialize:function(){},layout:function(){},clearLayout:function(){},getContainer:function(){return null},getModel:function(){return null},getModelKey:function(){return""},handleModelUpdate:function(t){},handleModelDelete:function(t){}};BX.CrmEntityView.create=function(t){var e=new BX.CrmEntityView;e.initialize(t);return e}}if(typeof BX.CrmEntityFilterPreset==="undefined"){BX.CrmEntityFilterPreset=function(){this._settings={};this._owner=null};BX.CrmEntityFilterPreset.prototype={initialize:function(t,e){this._settings=t?t:{};this._owner=e},getSettings:function(){return this._settings},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this.getSetting("id","")},getName:function(){return this.getSetting("name","")},getFields:function(){return this.getSetting("fields",{})},apply:function(){if(this._owner&&typeof this._owner["applyFilterPreset"]==="function"){this._owner.applyFilterPreset(this)}},createApplyDelagate:function(){return BX.delegate(this.apply,this)}};BX.CrmEntityFilterPreset.create=function(t,e){var i=new BX.CrmEntityFilterPreset;i.initialize(t,e);return i}}if(typeof BX.CrmEntityFilterPresetButton==="undefined"){BX.CrmEntityFilterPresetButton=function(){this._settings={};this._container=this._button=this._preset=null;this._isActive=false};BX.CrmEntityFilterPresetButton.prototype={initialize:function(t){this._settings=t?t:{};this._preset=this.getSetting("preset");this._container=this.getSetting("container");this._button=this.getSetting("button");if(this._button&&this._preset){BX.bind(this._button,"click",BX.delegate(this._onButtonClick,this))}this._isActive=BX.hasClass(this._container,"current")},getSettings:function(){return this._settings},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getPresetId:function(){return this._preset?this._preset.getId():""},isActive:function(){return this._isActive},setActive:function(t){t=!!t;this._isActive=t;if(!this._container){return}if(t){BX.addClass(this._container,"current")}else{BX.removeClass(this._container,"current")}},_onButtonClick:function(t){if(this._preset){this._preset.apply()}return BX.PreventDefault(t)}};BX.CrmEntityFilterPresetButton.create=function(t){var e=new BX.CrmEntityFilterPresetButton;e.initialize(t);return e}}if(typeof BX.CrmEntityListView==="undefined"){BX.CrmEntityListView=function(){};BX.CrmEntityListView.prototype={initialize:function(t,e){this._items={};this._waiter=null;this._scrollHandler=BX.delegate(this._onWindowScroll,this);this._searchFocusHandler=BX.delegate(this._onSearchFocus,this);this._searchBlurHandler=BX.delegate(this._onSearchBlur,this);this._searchKeyHandler=BX.delegate(this._onSearchKey,this);this._searchStartHandler=BX.delegate(this._onSearchClick,this);this._searchCancelHandler=BX.delegate(this._onClearSearchClick,this);this._filterHandler=BX.delegate(this._onFilterClick,this);this._isRequestStarted=false;this._isSearchRequestStarted=false;this._filterPresets=[];this._filterPresetButtons=[];this._context=BX.CrmMobileContext.getCurrent();this._id=t;this._settings=e?e:{};this._dispatcher=this.getSetting("dispatcher",null);this._wrapper=BX(this.getSetting("wrapperId",""));this._container=this.getContainer();this._isVisible=this._container&&this._container.style.display!=="none";this._searchContainer=BX(this.getSetting("searchContainerId",""));this._enableSearch=this._searchContainer&&this._searchContainer.style.display!=="none";this._filterContainer=BX(this.getSetting("filterContainerId",""));this._searchInput=BX.findChild(this._searchContainer,{className:"crm_search_input"},true,false);this._searchButton=BX.findChild(this._searchContainer,{className:"crm_button"},true,false);this._clearSearchButton=BX.findChild(this._searchContainer,{className:"crm_clear"},true,false);this._isFiltered=this.getSetting("isFiltered",false);var i=this.getWaiterClassName();var n=this.getItemContainers();if(BX.type.isArray(n)){for(var r=0;r<n.length;r++){var s=n[r];if(i!==""&&BX.hasClass(s,i)){this._waiter=s;continue}var a=this.createItemView({container:s,rootContainer:this._container,dispatcher:this._dispatcher,list:this});if(!a){continue}this._items[a.getModelKey()]=a}}if(this._searchInput){BX.bind(this._searchInput,"focus",this._searchFocusHandler);BX.bind(this._searchInput,"blur",this._searchBlurHandler);BX.bind(this._searchInput,"keypress",this._searchKeyHandler)}if(this._searchButton){BX.bind(this._searchButton,"click",this._searchStartHandler)}if(this._clearSearchButton){BX.bind(this._clearSearchButton,"click",this._searchCancelHandler)}var o=this.getSetting("filterPresets",[]);if(BX.type.isArray(o)){for(var l=0;l<o.length;l++){this._filterPresets.push(BX.CrmEntityFilterPreset.create(o[l],this))}}if(this._filterContainer){BX.bind(this._filterContainer,"click",this._filterHandler)}if(this.getSetting("enablePresetButtons",false)){var d=this.getFilterPresetContainers();if(d){for(var u=0;u<d.length;u++){var h=d[u];var c=BX.findChild(h,{className:"crm-filter-preset-data"},true,false);var f=c?this.findFilterPreset(c.value):null;if(!f){continue}this._filterPresetButtons.push(BX.CrmEntityFilterPresetButton.create({preset:f,container:h,button:BX.findChild(h,{className:"crm-filter-preset-button"},true,false)}))}}}this._pagingStarted=false;this._startPaging();BX.addCustomEvent(window,"onCrmEntityCreate",BX.delegate(this._onExternalCreate,this));this.doInitialize()},doInitialize:function(){},_startPaging:function(){var t=this.hasNextPageUrl();if(this._waiter){this._waiter.style.display=t?"":"none"}this._pagingStarted=t&&this.isVisible();if(this._pagingStarted){this._checkForNextPageRequest();BX.bind(window,"scroll",this._scrollHandler)}},release:function(){this._stopPaging();this._clearItems();if(this._searchInput){BX.unbind(this._searchInput,"focus",this._searchFocusHandler);BX.unbind(this._searchInput,"blur",this._searchBlurHandler);BX.unbind(this._searchInput,"keypress",this._searchKeyHandler)}if(this._searchButton){BX.unbind(this._searchButton,"click",this._searchStartHandler)}if(this._clearSearchButton){BX.unbind(this._clearSearchButton,"click",this._searchCancelHandler)}if(this._filterContainer){BX.unbind(this._filterContainer,"click",this._filterHandler)}BX.cleanNode(this.getContainer(),true)},_stopPaging:function(t){if(this._pagingStarted){BX.unbind(window,"scroll",this._scrollHandler);if(this._waiter&&t){this._waiter.style.display="none"}this._pagingStarted=false}},getContainer:function(){return null},getItemContainers:function(){return[]},getWaiterClassName:function(){return""},getMessage:function(t,e){return""},createItemView:function(t){return null},createSearchParams:function(t){return null},isFiltered:function(){return this._isFiltered},addItemView:function(t){var e=this.getContainer();var i=t.getContainer();if(e&&i){e.appendChild(i)}},removeItemView:function(t){var e=t.getContainer();if(e){BX.remove(e)}},getFilterPresetContainers:function(){return BX.findChildren(this._wrapper,{className:"crm-filter-preset-button-container"},true)},findFilterPreset:function(t){for(var e=0;e<this._filterPresets.length;e++){var i=this._filterPresets[e];if(i.getId()===t){return i}}return null},getId:function(){return this._id},getTypeName:function(){var t=this.getSetting("typeName","");if(t===""&&this._dispatcher){t=this._dispatcher.getTypeName()}return t},getSettings:function(){return this._settings},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getDispatcher:function(){return this._dispatcher},applyFilterPreset:function(t){if(!t){return}var e=t.getId();var i={};if(e==="clear_filter"){i["clear_filter"]="Y"}else{i["grid_filter_id"]=e;var n=t.getFields();for(var r in n){if(n.hasOwnProperty(r)){i[r]=n[r]}}}if(this._searchInput){this._searchInput.value=""}this._beginSearchRequest(i)},reload:function(t,e){if(this._isRequestStarted||this._context.isOffLine()){return false}if(!!e){this._clearItems()}this._beginReloadRequest(t);return true},setVisible:function(t){t=!!t;if(this._isVisible===t){return}this._onBeforeVisibilityChange();this._isVisible=t;var e=this.getContainer();if(e){e.style.display=t?"":"none"}if(t){this._startPaging()}else{this._stopPaging()}this._onAfterVisibilityChange()},_onBeforeVisibilityChange:function(){},_onAfterVisibilityChange:function(){},isVisible:function(){return this._isVisible},handleItemUpdate:function(t){},handleItemDelete:function(t){var e=t.getModelKey();if(this._items[e]){this._onBeforeItemDelete(t);delete this._items[e]}if(this.hasNextPageUrl()){this._checkForNextPageRequest()}this._onAfterItemDelete(t)},_onBeforeItemDelete:function(t){},_onAfterItemDelete:function(t){},hasNextPageUrl:function(){return this._settings.hasOwnProperty("nextPageUrl")&&BX.type.isNotEmptyString(this._settings["nextPageUrl"])},getNextPageUrl:function(){return this.getSetting("nextPageUrl","")},setNextPageUrl:function(t){this.setSetting("nextPageUrl",t);if(this._waiter){this._waiter.style.display=t!==""?"":"none"}},getSearchPageUrl:function(){return this.getSetting("searchPageUrl","")},setSearchPageUrl:function(t){this.setSetting("searchPageUrl",t)},_processClearSearchClick:function(){return false},_clearItems:function(){for(var t in this._items){if(this._items.hasOwnProperty(t)){this._items[t].clearLayout();delete this._items[t]}}this._items={}},hasItems:function(){for(var t in this._items){if(this._items.hasOwnProperty(t)){return true}}return false},getItemCount:function(){var t=0;for(var e in this._items){if(this._items.hasOwnProperty(e)){t++}}return t},enableSearch:function(t){if(!this._searchContainer){return}t=!!t;if(this._enableSearch===t){return}this._enableSearch=t;this._searchContainer.style.display=t?"":"none"},clearSearchInput:function(){if(this._searchInput){this._searchInput.value=""}},setSearchInputPlaceholder:function(t){if(this._searchInput){this._searchInput.setAttribute("placeholder",t);

}},_synchronizeItemData:function(t){if(!BX.type.isArray(t)){return}if(this._container&&this._waiter){this._container.removeChild(this._waiter)}if(t.length===0&&!this.hasItems()){if(!this._hasStub()){this._createStub()}}else{if(this._hasStub()){this._removeStub()}for(var e=0;e<t.length;e++){var i=this.createModel(t[e],true);var n=this.createItemView({container:null,rootContainer:this._container,dispatcher:this._dispatcher,model:i,list:this});var r=n.getModelKey();if(this._items[r]){this._items[r].clearLayout();delete this._items[r]}this._items[r]=n;n.layout()}}if(this._container&&this._waiter){this._container.appendChild(this._waiter)}},_createStub:function(){},_hasStub:function(){return false},_removeStub:function(){},_onWindowScroll:function(){this._checkForNextPageRequest()},_checkForNextPageRequest:function(){if(this._isRequestStarted){return}if(!this.hasNextPageUrl()){return}if(!this._waiter){return}var t=BX.GetWindowSize();if(BX.pos(this._waiter).top<=t.scrollTop+t.innerHeight){this._beginPagingRequest()}},_beginPagingRequest:function(){var t=this.getNextPageUrl();if(t===""||this._isRequestStarted||this._context.isOffLine()){return}this._stopPaging(false);this._isRequestStarted=this._context.beginRequest({url:t,method:"GET",type:"json",processData:true,callback:BX.delegate(this._onPagingRequestSuccess,this),callback_failure:BX.delegate(this._onRequestFailure,this)})},_beginSearchRequest:function(t){var e=this.getSearchPageUrl();if(e===""||this._isSearchRequestStarted||this._context.isOffLine()){return}this._stopPaging(false);var i=e;var n=[];for(var r in t){if(!t.hasOwnProperty(r)){continue}var s=t[r];if(!BX.type.isArray(s)){n.push(r+"="+encodeURIComponent(t[r]))}else{for(var a=0;a<s.length;a++){n.push(r+"[]="+encodeURIComponent(s[a]))}}}if(n.length>0){i+=(i.indexOf("?")>=0?"&":"?")+n.join("&")}this._context.showWait();this._isSearchRequestStarted=this._context.beginRequest({url:i,method:"GET",type:"json",processData:true,callback:BX.delegate(this._onSearchRequestSuccess,this),callback_failure:BX.delegate(this._onRequestFailure,this)});if(!this._isSearchRequestStarted){this._context.hideWait()}},_beginReloadRequest:function(t){if(this._isRequestStarted||this._context.isOffLine()){return}this._stopPaging(false);this._isRequestStarted=this._context.beginRequest({url:t,method:"GET",type:"json",processData:true,callback:BX.delegate(this._onReloadRequestSuccess,this),callback_failure:BX.delegate(this._onRequestFailure,this)});if(this._isRequestStarted){this._context.showWait()}},_onPagingRequestSuccess:function(t){this._isRequestStarted=false;var e=typeof t["DATA"]!=="undefined"?t["DATA"]:{};var i=BX.type.isArray(e["MODELS"])?e["MODELS"]:[];this._synchronizeItemData(i);var n=i.length>0&&BX.type.isNotEmptyString(e["NEXT_PAGE_URL"])?e["NEXT_PAGE_URL"]:"";this.setNextPageUrl(n);this._startPaging()},_onSearchRequestSuccess:function(t){this._context.hideWait();this._isSearchRequestStarted=false;var e=t["DATA"]?t["DATA"]:{};this._isFiltered=typeof e["IS_FILTERED"]!=="undefined"?e["IS_FILTERED"]:true;this._clearItems();this._synchronizeItemData(e["MODELS"]);this.setNextPageUrl(BX.type.isNotEmptyString(e["NEXT_PAGE_URL"])?e["NEXT_PAGE_URL"]:"");this._startPaging();if(this._filterContainer){BX.cleanNode(this._filterContainer,false);this._filterContainer.appendChild(BX.create("SPAN",{attrs:{className:"crm_filter_icon"}}));var i="";if(!this._isFiltered){i=this.getMessage("notFiltered")}else{i=BX.type.isNotEmptyString(e["GRID_FILTER_NAME"])?e["GRID_FILTER_NAME"]:this.getMessage("customFilter")}this._filterContainer.appendChild(document.createTextNode(i));this._filterContainer.appendChild(BX.create("SPAN",{attrs:{className:"crm_arrow_bottom"}}))}if(this._filterPresetButtons){var n=BX.type.isNotEmptyString(e["GRID_FILTER_ID"])?e["GRID_FILTER_ID"]:"";var r;var s=null;if(n!==""){for(r=0;r<this._filterPresetButtons.length;r++){s=this._filterPresetButtons[r];if(n!==""&&s.getPresetId()===n){s.setActive(true)}else if(s.isActive()){s.setActive(false)}}}else{for(r=0;r<this._filterPresetButtons.length;r++){s=this._filterPresetButtons[r];if(s.getPresetId()==="clear_filter"){s.setActive(true)}else if(s.isActive()){s.setActive(false)}}}}this._onSearchRequestCompleted()},_onSearchRequestCompleted:function(){},_onReloadRequestSuccess:function(t){this._isRequestStarted=false;this._context.hideWait();var e=t["DATA"]?t["DATA"]:{};this._clearItems();this._synchronizeItemData(e["MODELS"]);this.setNextPageUrl(BX.type.isNotEmptyString(e["NEXT_PAGE_URL"])?e["NEXT_PAGE_URL"]:"");var i=BX.type.isNotEmptyString(e["SEARCH_PAGE_URL"])?e["SEARCH_PAGE_URL"]:"";if(i!==""){this.setSearchPageUrl(i)}this._onReloadRequestCompleted(t);this._startPaging()},_onReloadRequestCompleted:function(t){},_onRequestFailure:function(){this._context.hideWait();this._isSearchRequestStarted=false;this._startPaging()},_onSearchFocus:function(){if(this._searchContainer){BX.removeClass(this._searchContainer,"crm_search");BX.addClass(this._searchContainer,"crm_search active")}},_onSearchClick:function(){var t=this.createSearchParams(this._searchInput?this._searchInput.value:"");if(t){this._beginSearchRequest(t)}},_onClearSearchClick:function(){if(this._searchInput){this._searchInput.value=""}if(this._processClearSearchClick()){return}if(this._isFiltered){BX.CrmMobileContext.getCurrent().reload()}},_onSearchBlur:function(){var t=this._searchInput?this._searchInput.value:"";if(t===""&&this._searchContainer){BX.removeClass(this._searchContainer,"crm_search active");BX.addClass(this._searchContainer,"crm_search")}},_onSearchKey:function(t){if(!t){t=window.event}if(t.keyCode!=13){return}var e=this.createSearchParams(this._searchInput?this._searchInput.value:"");if(e){this._beginSearchRequest(e)}},_onFilterClick:function(){var t=[];for(var e=0;e<this._filterPresets.length;e++){var i=this._filterPresets[e];t.push({name:i.getName(),arrowFlag:false,action:i.createApplyDelagate()})}if(t.length>0){this._context.createMenu(t);this._context.showMenu()}},_onExternalCreate:function(t){var e=typeof t["typeName"]!=="undefined"?t["typeName"]:"";if(e===this.getTypeName()){this._processExternalCreate(t)}},_processExternalCreate:function(t){}}}if(typeof BX.CrmDealStageManager==="undefined"){BX.CrmDealStageManager=function(){};BX.CrmDealStageManager.prototype={getInfos:function(){return BX.CrmDealStageManager.infos},getMessage:function(t){var e=BX.CrmDealStageManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},prepareGovernor:function(t){return null}};BX.CrmDealStageManager.current=new BX.CrmDealStageManager;BX.CrmDealStageManager.infos=[{id:"NEW",name:"In Progress",sort:10,semantics:"process"},{id:"WON",name:"Is Won",sort:20,semantics:"success"},{id:"LOSE",name:"Is Lost",sort:30,semantics:"failure"}];BX.CrmDealStageManager.messages={}}if(typeof BX.CrmLeadStatusManager==="undefined"){BX.CrmLeadStatusManager=function(){};BX.CrmLeadStatusManager.prototype={getInfos:function(){return BX.CrmLeadStatusManager.infos},getMessage:function(t){var e=BX.CrmLeadStatusManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},prepareGovernor:function(t){return null}};BX.CrmLeadStatusManager.current=new BX.CrmLeadStatusManager;BX.CrmLeadStatusManager.infos=[{id:"NEW",name:"Not Processed",sort:10,semantics:"process"},{id:"CONVERTED",name:"Converted",sort:20,semantics:"success"},{id:"JUNK",name:"Junk",sort:30,semantics:"failure"}];BX.CrmLeadStatusManager.messages={}}if(typeof BX.CrmInvoiceStatusManager==="undefined"){BX.CrmInvoiceStatusManager=function(){};BX.CrmInvoiceStatusManager.prototype={getInfos:function(){return BX.CrmInvoiceStatusManager.infos},getMessage:function(t){var e=BX.CrmInvoiceStatusManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},prepareGovernor:function(t){return t==="P"||t==="D"?BX.CrmInvoiceStatusGovernor.create(t):null}};BX.CrmInvoiceStatusManager.current=new BX.CrmInvoiceStatusManager;BX.CrmInvoiceStatusManager.infos=[{id:"N",name:"In Progress",sort:10,semantics:"process"},{id:"P",name:"Is Paid",sort:20,semantics:"success",hasParams:true},{id:"D",name:"Is Dismiss",sort:30,semantics:"failure"}];BX.CrmInvoiceStatusManager.messages={}}if(typeof BX.CrmInvoiceStatusGovernor==="undefined"){BX.CrmInvoiceStatusGovernor=function(){this._manager=null;this._id="";this._container=this._saveButton=this._docElem=this._dateWrapper=this._dateElem=this._dateTextElem=this._commentElem=null;this._onReadyCallback=null;this._model=null;this._saveHandler=BX.delegate(this._onSaveButtonClick,this);this._dateClickHandler=BX.delegate(this._onDateClick,this);this._dateChangeHandler=BX.delegate(this._onDateChahge,this);this._hasLayout=false};BX.CrmInvoiceStatusGovernor.prototype={initialize:function(t){this._id=t;if(this._id===""){throw"BX.CrmInvoiceStatusGovernor. Id is not defined."}this._manager=BX.CrmInvoiceStatusManager.current},layout:function(t){if(!BX.type.isDomNode(t)){throw"BX.CrmInvoiceStatusGovernor. Anchor is not defined."}if(this._hasLayout){return}this._container=BX.create("DIV",{style:{marginTop:"15px"}});if(t.parentNode){var e=BX.nextSibling(t);if(e){t.parentNode.insertBefore(this._container,e)}else{t.parentNode.appendChild(this._container)}}var i=0;var n=this._model;if(this._id==="P"){i=n.getIntParam("PAYMENT_TIME_STAMP",0);var r=i>0?n.getStringParam("PAYMENT_DATE","-"):this._manager.getMessage("notSpecified");this._dateElem=BX.create("INPUT",{props:{type:"hidden",value:i}});this._dateTextElem=BX.create("SPAN",{style:{fontSize:"14px",fontWeight:"bold",color:"#3f7cbf"},text:r});this._dateWrapper=BX.create("DIV",{props:{className:"crm_arrow"},children:[BX.create("SPAN",{style:{fontSize:"14px",fontWeight:"bold"},text:this._manager.getMessage("dateLabelText")+": "}),this._dateTextElem,this._dateElem]});BX.bind(this._dateWrapper,"click",this._dateClickHandler);this._container.appendChild(BX.create("DIV",{props:{className:"crm_card"},style:{paddingBottom:"0"},children:[this._dateWrapper]}));this._docElem=BX.create("INPUT",{props:{type:"text",className:"crm_input_text",value:n.getStringParam("PAYMENT_DOC","")}});this._container.appendChild(BX.create("DIV",{props:{className:"crm_card"},style:{paddingBottom:"0"},children:[BX.create("SPAN",{style:{fontSize:"14px",fontWeight:"bold"},text:this._manager.getMessage("payVoucherNumLabelText")+":"}),this._docElem]}));this._commentElem=BX.create("TEXTAREA",{props:{className:"crm_input_text"},text:n.getStringParam("PAYMENT_COMMENT","")});this._container.appendChild(BX.create("DIV",{props:{className:"crm_card"},style:{paddingBottom:"0"},children:[BX.create("SPAN",{style:{fontSize:"14px",fontWeight:"bold"},text:this._manager.getMessage("commentLabelText")+":"}),this._commentElem]}))}else if(this._id==="D"){i=n.getIntParam("CANCEL_TIME_STAMP",0);var s=i>0?n.getStringParam("CANCEL_DATE","-"):this._manager.getMessage("notSpecified");this._dateElem=BX.create("INPUT",{props:{type:"hidden",value:i}});this._dateTextElem=BX.create("SPAN",{style:{fontSize:"14px",fontWeight:"bold",color:"#3f7cbf"},text:s});this._dateWrapper=BX.create("DIV",{props:{className:"crm_arrow"},children:[BX.create("SPAN",{style:{fontSize:"14px",fontWeight:"bold"},text:this._manager.getMessage("dateLabelText")+": "}),this._dateTextElem,this._dateElem]});BX.bind(this._dateWrapper,"click",this._dateClickHandler);this._container.appendChild(BX.create("DIV",{props:{className:"crm_card"},style:{paddingBottom:"0"},children:[this._dateWrapper]}));this._commentElem=BX.create("TEXTAREA",{props:{className:"crm_input_text"},text:n.getStringParam("CANCEL_REASON","")});this._container.appendChild(BX.create("DIV",{props:{className:"crm_card"},style:{paddingBottom:"0"},children:[BX.create("SPAN",{style:{fontSize:"14px",fontWeight:"bold"},text:this._manager.getMessage("commentLabelText")+":"}),this._commentElem]}))}this._saveButton=BX.create("A",{attrs:{className:"crm_buttons detail",href:"#"},text:BX.message("JS_CORE_WINDOW_SAVE")});BX.bind(this._saveButton,"click",this._saveHandler);this._container.appendChild(this._saveButton);this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}this._docElem=this._dateElem=this._dateTextElem=this._commentElem=null;BX.bind(this._dateWrapper,"click",this._dateClickHandler);this._dateWrapper=null;BX.unbind(this._saveButton,"click",this._saveHandler);this._saveButton=null;BX.cleanNode(this._container);BX.remove(this._container);this._container=null;this._hasLayout=false},getId:function(){return this._id},getOnReadyCallback:function(){return this._onReadyCallback},setOnReadyCallback:function(t){this._onReadyCallback=t},getModel:function(){return this._model},setModel:function(t){this._model=t},prepareData:function(){var t=this._dateElem?parseInt(this._dateElem.value):0;var e="";if(t>0){var i=BX.message("FORMAT_DATE");i=BX.date.convertBitrixFormat(BX.type.isNotEmptyString(i)?i:"DD.MM.YYYY");e=BX.date.format(i,new Date(BX.date.getBrowserTimestamp(t)))}var n=this._commentElem?this._commentElem.value:"";if(this._id==="P"){var r=this._docElem?this._docElem.value:"";return{PAYMENT_TIME_STAMP:t,PAYMENT_DATE:e,PAYMENT_DOC:r,PAYMENT_COMMENT:n}}else if(this._id==="D"){return{CANCEL_TIME_STAMP:t,CANCEL_DATE:e,CANCEL_REASON:this._commentElem.value}}return{}},_onDateClick:function(t){if(!this._dateElem){return}var e=parseInt(this._dateElem.value);if(e<=0){e=parseInt(BX.message("SERVER_TIME"))}BX.CrmMobileContext.getCurrent().showDatePicker(BX.date.getBrowserTimestamp(e),"date",this._dateChangeHandler)},_onDateChahge:function(t){var e=Date.parse(t);if(this._dateElem){this._dateElem.value=BX.date.getServerTimestamp(e)}if(this._dateTextElem){var i=BX.message("FORMAT_DATE");i=BX.date.convertBitrixFormat(BX.type.isNotEmptyString(i)?i:"DD.MM.YYYY");this._dateTextElem.innerHTML=BX.date.format(i,new Date(e))}},_onSaveButtonClick:function(t){if(BX.type.isFunction(this._onReadyCallback)){this._onReadyCallback(this)}return BX.PreventDefault(t)}};BX.CrmInvoiceStatusGovernor.create=function(t){var e=new BX.CrmInvoiceStatusGovernor;e.initialize(t);return e}}if(typeof BX.CrmProgressBar==="undefined"){BX.CrmProgressBar=function(){this._id="";this._settings=null;this._rootContainer=null;this._container=null;this._entityId=0;this._entityType=null;this._currentStepId="";this._manager=null;this._stepInfos=null;this._steps=[];this._isEditable=true;this._isFrozen=false;this._layout="small";this._hasLayout=false};BX.CrmProgressBar.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._rootContainer=this.getSetting("rootContainer",null);this._container=this.getSetting("container",null);this._hasLayout=BX.type.isDomNode(this._container);this._legendElem=this.getSetting("legend",null);this._entityId=parseInt(this.getSetting("entityId",0));this._entityType=this.getSetting("entityType","");this._currentStepId=this.getSetting("currentStepId","");this._layout=this.getSetting("layout","");if(!(BX.type.isNotEmptyString(this._layout)&&(this._layout==="small"||this._layout==="big"))){this._layout="small"}if(this._entityType==="DEAL"){this._manager=BX.CrmDealStageManager.current}else if(this._entityType==="LEAD"){this._manager=BX.CrmLeadStatusManager.current}else if(this._entityType==="INVOICE"){this._manager=BX.CrmInvoiceStatusManager.current}var i=this._stepInfos=this._manager.getInfos();var n=this._findStepInfoIndex(this._currentStepId);var r=n>=0?i[n]:null;this._isEditable=this.getSetting("isEditable",true);this._isFrozen=r&&BX.type.isBoolean(r["isFrozen"])?r["isFrozen"]:false;if(this._hasLayout){for(var s=0;s<i.length;s++){var a=i[s];var o=this._findStepContainer(a["id"]);if(!o){continue}var l=parseInt(a["sort"]);this._steps.push(BX.CrmProgressStep.create(a["id"],{name:a["name"],sort:l,isPassed:s<=n,container:o,progressBar:this}))}}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getLayout:function(){return this._layout},layout:function(t){if(this._hasLayout){return}if(!BX.type.isDomNode(t)){t=this._rootContainer}var e=this._findStepInfoIndex(this._currentStepId);var i=e>=0?this._stepInfos[e]:null;var n=i&&BX.type.isNotEmptyString(i["semantics"])?i["semantics"]:"";var r=i&&typeof i["sort"]!=="undefined"?parseInt(i["sort"]):0;var s="crm-list-stage-bar-"+this._layout;if(n==="success"){s+=" crm-list-stage-end-good"}else if(n==="failure"||n==="apology"){s+=" crm-list-stage-end-bad"}this._container=BX.create("DIV",{attrs:{className:s}});var a=BX.create("TABLE",{attrs:{className:"crm-list-stage-bar-table-"+this._layout}});this._container.appendChild(a);t.appendChild(this._container);var o=a.insertRow(-1);var l=this._stepInfos;for(var d=0;d<l.length;d++){var u=l[d];var h=BX.type.isNotEmptyString(u["semantics"])?u["semantics"]:"";if(h==="failure"||h==="apology"){break}var c=typeof u["id"]!=="undefined"?u["id"].toLowerCase():"";var f=typeof u["name"]!=="undefined"?u["name"]:"";var m=typeof u["sort"]!=="undefined"?parseInt(u["sort"]):0;var _=o.insertCell(-1);_.className="crm-list-stage-bar-part";if(m<=r){_.className+=" crm-list-stage-passed"}var p=BX.create("DIV",{attrs:{className:"crm-list-stage-bar-block","data-progress-step-id":c},children:[BX.create("DIV",{attrs:{className:"crm-list-stage-bar-btn"}})]});_.appendChild(p);_.appendChild(BX.create("INPUT",{attrs:{className:"crm-list-stage-bar-block-sort",type:"hidden",value:m}}));this._steps.push(BX.CrmProgressStep.create(c,{name:f,sort:m,isPassed:d<=e,container:p,progressBar:this}))}if(this._legendElem){this._legendElem.innerHTML=BX.util.htmlspecialchars(BX.type.isNotEmptyString(i["name"])?i["name"]:i["id"])}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}this._steps=[];BX.cleanNode(this._container);BX.remove(this._container);this._container=null;this._hasLayout=false},getCurrentStepId:function(){return this._currentStepId},setCurrentStepId:function(t,e){if(this._currentStepId===t){return}if(this._isFrozen){return}var i=this._findStepInfoIndex(t);if(i<0){return}this._currentStepId=t;var n=this._stepInfos[i];this._isFrozen=BX.type.isBoolean(n["isFrozen"])?n["isFrozen"]:false;var r=BX.type.isNotEmptyString(n["name"])?n["name"]:"";if(this._hasLayout){for(var s=0;s<this._steps.length;s++){this._steps[s].setPassed(s<=i)}var a=BX.type.isNotEmptyString(n["semantics"])?n["semantics"]:"";if(a==="success"){BX.addClass(this._container,"crm-list-stage-end-good");BX.removeClass(this._container,"crm-list-stage-end-bad")}else if(a==="failure"||a==="apology"){BX.removeClass(this._container,"crm-list-stage-end-good");BX.addClass(this._container,"crm-list-stage-end-bad")}else{BX.removeClass(this._container,"crm-list-stage-end-good");BX.removeClass(this._container,"crm-list-stage-end-bad")}if(this._legendElem){this._legendElem.innerHTML=BX.util.htmlspecialchars(r!==""?r:t)}}if(!!e){BX.onCustomEvent(this,"onStepChange",[{sender:this,stepId:this._currentStepId,stepName:r}])}},processStepSelection:function(t){if(!this._isEditable){return}var e=t.getId();var i=this._findStepInfoIndex(e);if(i<0){return}if(i<this._steps.length-1){this.setCurrentStepId(e,true)}else{BX.onCustomEvent(this,"onStepSelectPageRequest",[{sender:this}])}},getEntityType:function(){return this._entityType},getEntityId:function(){return this._entityId},isEditable:function(){return this._isEditable},_findStepInfoIndex:function(t){var e=this._stepInfos;for(var i=0;i<e.length;i++){if(e[i]["id"]===t){return i}}return-1},_findStepInfoBySemantics:function(t){var e=this._stepInfos;for(var i=0;i<e.length;i++){var n=e[i];var r=BX.type.isNotEmptyString(n["semantics"])?n["semantics"]:"";if(t===r){return n}}return null},_findStepContainer:function(t){return BX.type.isNotEmptyString(t)?BX.findChild(this._container,{attr:{"data-progress-step-id":t.toLowerCase()}},true,false):null}};BX.CrmProgressBar.create=function(t,e){var i=new BX.CrmProgressBar;i.initialize(t,e);return i};BX.CrmProgressBar.layout=function(t){var e=this.create("",t);e.layout()}}if(typeof BX.CrmProgressStep==="undefined"){BX.CrmProgressStep=function(){this._id="";this._settings=null;this._progressBar=null;this._container=null;this._name="";this._isPassed=false};BX.CrmProgressStep.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._progressBar=this.getSetting("progressBar");this._container=this.getSetting("container");this._name=this.getSetting("name");this._isPassed=this.getSetting("isPassed",false);if(this._progressBar.isEditable()){BX.bind(this._container,"click",BX.delegate(this._onClick,this))}},getId:function(){return this._id},getName:function(){return this._name},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},isPassed:function(){return this._isPassed},setPassed:function(t){t=!!t;if(this._isPassed===t){return}this._isPassed=t;var e=BX.findParent(this._container,{"class":"crm-list-stage-bar-part"});if(t){BX.addClass(e,"crm-list-stage-passed")}else{BX.removeClass(e,"crm-list-stage-passed")}},_onClick:function(t){if(this._progressBar.isEditable()){this._progressBar.processStepSelection(this);BX.eventCancelBubble(t)}}};BX.CrmProgressStep.create=function(t,e){var i=new BX.CrmProgressStep;i.initialize(t,e);return i}}if(typeof BX.CrmProductRowList==="undefined"){BX.CrmProductRowList=function(){this._id="";this._settings={};this._containerId="";this._ownerType="";this._ownerId=0;this._currencyId="";this._formattedSumTotal="";this._items=[];this._totalInfos=[];this._hasLayout=false;this._addItemButton=this._totalsContainer=null;this._afterPageOpenHandler=BX.delegate(this._onAfterPageOpen,this);this._addItemHandler=BX.delegate(this._onAddItemButtonClick,this);this._productSelectHandler=BX.delegate(this._onExternalProductSelect,this);this._isProductSelectorBound={};this._newItemIndex=-1;this._isInEditMode=false;this._enableTotalInfoRefresh=true};BX.CrmProductRowList.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._containerId=this.getSetting("containerId","");this._ownerType=this.getSetting("ownerType","");this._ownerId=parseInt(this.getSetting("ownerId",0));this._currencyId=this.getSetting("currencyId");this._enableTotalInfoRefresh=this.getSetting("enableTotalInfoRefresh",true);this._formattedSumTotal=this.getSetting("formattedSumTotal","");var i=this.getSetting("data",[]);var n=this.getSetting("itemInfoHtmlTemplate","");for(var r=0;r<i.length;r++){var s=BX.CrmProductRowListItem.create({model:BX.CrmProductRowModel.create(i[r]),infoHtmlTemplate:n,list:this});this._items.push(s)}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getOwnerType:function(){return this._ownerType},getOwnerId:function(){return this._ownerId},getItemCount:function(){return this._items.length},clearItems:function(){while(this._items.length>0){this._items.pop().clearLayout()}this._formattedSumTotal="";this._clearTotals()},getSumTotal:function(){var t=0;for(var e=0;e<this._items.length;e++){var i=this._items[e].getModel();if(i){t+=i.getFloatParam("PRICE")*i.getIntParam("QUANTITY")}}return Math.round(t*100)/100},layout:function(){if(this._hasLayout){this.clearLayout()}var t=BX(this._containerId);var e=this._items.length;if(e>0){for(var i=0;i<e;i++){this._items[i].layout(t)}}this._totalsContainer=BX.create("DIV",{attrs:{className:"crm_block_container"}});if(this._enableTotalInfoRefresh){this._addTotalInfo({title:this.getMessage("sumTotal"),html:this._formattedSumTotal});if(e===0){this._totalsContainer.style.display="none"}}else if(this._totalInfos.length>0){for(var n=0;n<this._totalInfos.length;n++){this._addTotalInfo(this._totalInfos[n])}if(e===0){this._totalsContainer.style.display="none"}}else{this._totalsContainer.style.display="none"}t.appendChild(this._totalsContainer);this._addItemButton=BX.create("A",{attrs:{className:"crm_buttons detail",href:"#"},style:{marginBottom:"0"},text:this.getMessage("addItemButton")});t.appendChild(this._addItemButton);BX.bind(this._addItemButton,"click",this._addItemHandler);this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}if(this._addItemButton){BX.unbind(this._addItemButton,"click",this._addItemHandler);this._addItemButton=BX.remove(this._addItemButton)}if(this._totalsContainer){this._totalsContainer=BX.remove(this._totalsContainer)}var t=this._items.length;if(t>0){for(var e=0;e<t;e++){this._items[e].clearLayout()}}this._hasLayout=false},_addTotalInfo:function(t){if(!this._totalsContainer){return}this._totalsContainer.appendChild(BX.create("DIV",{attrs:{className:"crm_meeting_info"},children:[BX.create("SPAN",{text:(BX.type.isNotEmptyString(t["title"])?t["title"]:"")+": "}),BX.create("STRONG",{html:BX.type.isNotEmptyString(t["html"])?t["html"]:""})]}))},_clearTotals:function(){if(this._totalsContainer){BX.cleanNode(this._totalsContainer,false)}},_showTotals:function(t){t=!!t;if(this._totalsContainer){if(t&&this._totalsContainer.style.display==="none"){this._totalsContainer.style.display=""}else if(!t&&this._totalsContainer.style.display!=="none"){this._totalsContainer.style.display="none"}}},getMessage:function(t,e){var i=BX.CrmProductRowList.messages;return i.hasOwnProperty(t)?i[t]:e},getContextId:function(){return this.getSetting("contextId","")},getItemModificationUrl:function(t){return this.getSetting("editUrl","")},_findItemIndex:function(t){for(var e=0;e<this._items.length;e++){if(this._items[e]===t){return e}}return-1},processItemDeletion:function(t){var e=this._findItemIndex(t);if(e<0){return}t.clearLayout();this._items.splice(e,1);if(this._enableTotalInfoRefresh){this._refreshTotalInfo(BX.delegate(this._notifyDeleted,this),true)}else{this._notifyDeleted()}},beforeItemModification:function(t){this._isInEditMode=true;for(var e=0;e<this._items.length;e++){this._items[e]._enableEditMode(false)}},afterItemModification:function(t,e){this._isInEditMode=false;if(!!e){if(this._enableTotalInfoRefresh){this._refreshTotalInfo(BX.delegate(this._notifyUpdated,this),true)}else{this._notifyUpdated()}}},getCurrencyId:function(){return this._currencyId},setCurrencyId:function(t,e){if(this._currencyId===t){return}var i=[];for(var n=0;n<this._items.length;n++){var r=this._items[n].getModel();i.push({QUANTITY:r?r.getIntParam("QUANTITY"):0,PRICE:r?r.getFloatParam("PRICE"):0})}var s=this._currencyId;this._currencyId=t;var a=this;BX.ajax({url:this.getSetting("serviceUrl",""),method:"POST",dataType:"json",data:{ACTION:"CONVERT",OWNER_TYPE:this._ownerType,SRC_CURRENCY_ID:s,DST_CURRENCY_ID:t,ITEMS:i},onsuccess:function(t){var i=typeof t["ITEMS"]!=="undefined"?t["ITEMS"]:[];if(BX.type.isArray(i)&&i.length===a._items.length){a._formattedSumTotal=typeof t["FORMATTED_SUM_TOTAL"]!=="undefined"?t["FORMATTED_SUM_TOTAL"]:"";for(var n=0;n<i.length;n++){var r=a._items[n];var s=r.getModel();if(s){var o=i[n];s.setParam("QUANTITY",parseInt(o["QUANTITY"]));s.setParam("PRICE",parseFloat(o["PRICE"]));s.setParam("CURRENCY_ID",o["CURRENCY_ID"]);s.setParam("FORMATTED_PRICE",o["FORMATTED_PRICE"]);s.setParam("FORMATTED_SUM",o["FORMATTED_SUM"])}}a.layout()}if(BX.type.isFunction(e)){e()}},onfailure:function(t){if(BX.type.isFunction(e)){e()}}})},setup:function(t,e,i){i=!!i;if(!i&&t.length===this._items.length){for(var n=0;n<this._items.length;n++){this._items[n].setupData(t[n])}}else{this.clearItems();var r=this.getSetting("itemInfoHtmlTemplate","");for(var s=0;s<t.length;s++){var a=BX.CrmProductRowListItem.create({model:BX.CrmProductRowModel.create(t[s]),infoHtmlTemplate:r,list:this});this._items.push(a)}}if(!this._enableTotalInfoRefresh){this._totalInfos=BX.type.isArray(e)?e:[]}if(this._hasLayout){var o=BX(this._containerId);o.removeChild(this._addItemButton);o.removeChild(this._totalsContainer);for(var l=0;l<this._items.length;l++){this._items[l].layout(o)}this._clearTotals();if(this._totalInfos.length>0){for(var d=0;d<this._totalInfos.length;d++){this._addTotalInfo(this._totalInfos[d])}if(this._totalsContainer.style.display==="none"){this._totalsContainer.style.display=""}}else if(this._totalsContainer.style.display!=="none"){this._totalsContainer.style.display="none"}o.appendChild(this._totalsContainer);o.appendChild(this._addItemButton)}},prepareForSave:function(){var t=[];for(var e=0;e<this._items.length;e++){this._items[e].prepareForSave(t)}return t},isInEditMode:function(){return this._isInEditMode},cancelEditMode:function(){if(!this._isInEditMode){return}this._isInEditMode=false;for(var t=0;t<this._items.length;t++){this._items[t]._enableEditMode(false)}},_notifyCreated:function(){BX.onCustomEvent(this,"onCrmProductRowListChange",[{action:"CREATE"}]);if(this._newItemIndex>=0){if(this._items.length>this._newItemIndex){this._items[this._newItemIndex].openEditor()}this._newItemIndex=-1}},_notifyUpdated:function(){BX.onCustomEvent(this,"onCrmProductRowListChange",[{action:"UPDATE"}])},_notifyDeleted:function(){BX.onCustomEvent(this,"onCrmProductRowListChange",[{action:"DELETE"}])},_refreshTotalInfo:function(t,e){if(!this._enableTotalInfoRefresh){if(BX.type.isFunction(t)){t()}return}e=!!e;if(e){BX.CrmMobileContext.getCurrent().showWait()}var i=this;BX.ajax({url:this.getSetting("serviceUrl",""),method:"POST",dataType:"json",data:{ACTION:"FORMAT_MONEY",SUM:this.getSumTotal(),CURRENCY_ID:this.getCurrencyId()},onsuccess:function(n){i._formattedSumTotal=BX.type.isNotEmptyString(n["FORMATTED_SUM"])?n["FORMATTED_SUM"]:"";i._clearTotals();i._addTotalInfo({title:i.getMessage("sumTotal"),html:i._formattedSumTotal});i._showTotals(i.getItemCount()>0);if(e){BX.CrmMobileContext.getCurrent().hideWait()}if(BX.type.isFunction(t)){t()}},onfailure:function(i){if(e){BX.CrmMobileContext.getCurrent().hideWait()}if(BX.type.isFunction(t)){t()}}})},_onAddItemButtonClick:function(t){var e=this.getCurrencyId();var i=this.getSetting("productSelectorUrlTemplate");var n=i.replace(/#currency_id#/gi,e);BX.CrmMobileContext.getCurrent().open({url:n,data:{contextId:this.getContextId()}});if(this._isProductSelectorBound){BX.removeCustomEvent(window,"onCrmProductSelect",this._productSelectHandler);this._isProductSelectorBound=false}BX.addCustomEvent(window,"onCrmProductSelect",this._productSelectHandler);this._isProductSelectorBound=true;return BX.PreventDefault(t)},_onExternalProductSelect:function(t){var e=BX.type.isNotEmptyString(t["contextId"])?t["contextId"]:"";if(e!==this.getContextId()){return}BX.removeCustomEvent(window,"onCrmProductSelect",this._productSelectHandler);this._isProductSelectorBound=false;var i=typeof t["modelData"]!=="undefined"?t["modelData"]:null;if(!i){return}var n=typeof i["PRICE"]!=="undefined"?parseFloat(i["PRICE"]):0;var r=BX.type.isNotEmptyString(i["FORMATTED_PRICE"])?i["FORMATTED_PRICE"]:"";var s={PRODUCT_ID:typeof i["ID"]!=="undefined"?parseInt(i["ID"]):0,PRODUCT_NAME:BX.type.isNotEmptyString(i["NAME"])?i["NAME"]:"",QUANTITY:1,PRICE:n,FORMATTED_PRICE:r,SUM:n,FORMATTED_SUM:r};var a=BX.CrmProductRowListItem.create({model:BX.CrmProductRowModel.create(s),infoHtmlTemplate:this.getSetting("itemInfoHtmlTemplate",""),list:this});this._items.push(a);if(this._hasLayout){var o=BX(this._containerId);o.removeChild(this._totalsContainer);o.removeChild(this._addItemButton);a.layout(o);if(this._totalsContainer.style.display==="none"){this._totalsContainer.style.display=""}o.appendChild(this._totalsContainer);o.appendChild(this._addItemButton);BX.scrollToNode(this._addItemButton)}this._newItemIndex=this._items.length-1;BX.addCustomEvent("onOpenPageAfter",this._afterPageOpenHandler)},_onAfterPageOpen:function(){if(this._newItemIndex>=0){if(this._enableTotalInfoRefresh){this._refreshTotalInfo(BX.delegate(this._notifyCreated,this),true)}else{this._notifyCreated()}}BX.removeCustomEvent("onOpenPageAfter",this._afterPageOpenHandler)}};BX.CrmProductRowList.create=function(t,e){var i=new BX.CrmProductRowList;i.initialize(t,e);return i};if(typeof BX.CrmProductRowList.messages==="undefined"){BX.CrmProductRowList.messages={}}}if(typeof BX.CrmProductRowListItem==="undefined"){BX.CrmProductRowListItem=function(){this._settings={};this._list=null;this._container=null;this._model=null;this._hasLayout=false;this._isInEditMode=false;this._info=null;this._deleteButton=this._editButton=null;this._deleteHandler=BX.delegate(this._onDeleteButtonClick,this);

this._editHandler=BX.delegate(this._onEditButtonClick,this);this._editCompleteHandler=BX.delegate(this._onExternalEditComplete,this)};BX.CrmProductRowListItem.prototype={initialize:function(t){this._settings=t?t:{};this._list=this.getSetting("list",null);if(!this._list){throw"BX.CrmProductRowListItem. Could not find list!"}this._model=this.getSetting("model",null);if(!this._model){throw"BX.CrmProductRowListItem. Could not find model!"}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getModel:function(){return this._model},layout:function(t){if(this._hasLayout){this.clearLayout()}var e=this._container=BX.create("DIV",{attrs:{className:"crm_block_container"}});t.appendChild(e);var i=this._info=BX.create("DIV",{attrs:{className:"crm_meeting_info"},html:this._prepareInfoHtml()});e.appendChild(i);e.appendChild(BX.create("HR",{style:{marginLeft:"0",marginTop:"15px",marginRight:"0",marginBottom:"15px"}}));this._deleteButton=BX.create("A",{attrs:{className:"crm_buttons close"},style:{marginBottom:"0"},children:[BX.create("SPAN")]});BX.bind(this._deleteButton,"click",this._deleteHandler);this._editButton=BX.create("A",{attrs:{className:"crm_buttons edit",href:"#"},style:{marginBottom:"0"},children:[BX.create("SPAN")]});BX.bind(this._editButton,"click",this._editHandler);e.appendChild(BX.create("DIV",{attrs:{className:"crm_meeting_info tac"},children:[this._deleteButton,this._editButton]}));this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}if(this._deleteButton){BX.unbind(this._deleteButton,"click",this._deleteHandler);this._deleteButton=null}if(this._editButton){BX.unbind(this._editButton,"click",this._editHandler);this._editButton=null}if(this._info){this._info=null}if(this._container){BX.cleanNode(this._container);BX.remove(this._container);this._container=null}this._hasLayout=false},resetLayout:function(){if(!this._hasLayout){return}if(this._info){this._info.innerHTML=this._prepareInfoHtml()}},isInEditMode:function(){return this._isInEditMode},setupData:function(t){if(this._model){this._model.setData(t);this.resetLayout()}},prepareForSave:function(t){var e=this._model;t.push({ID:e.getIntParam("ID"),PRODUCT_ID:e.getIntParam("PRODUCT_ID"),QUANTITY:e.getIntParam("QUANTITY"),PRICE:e.getFloatParam("PRICE")})},_enableEditMode:function(t){t=!!t;if(this._isInEditMode===t){return}this._isInEditMode=t;if(t){BX.addCustomEvent(window,"onCrmProductRowEditComplete",this._editCompleteHandler)}else{BX.removeCustomEvent(window,"onCrmProductRowEditComplete",this._editCompleteHandler)}},openEditor:function(){this._list.beforeItemModification(this);this._enableEditMode(true);BX.CrmMobileContext.getCurrent().open({url:this._list.getItemModificationUrl(this),data:{modelData:this._model.getData(),contextId:this._list.getContextId()}})},_prepareInfoHtml:function(){var t=this._model;var e=t.getArrayParam("TAX_INFOS");var i="";if(e.length>0){for(var n=0;n<e.length;n++){var r=e[n];var s=BX.type.isNotEmptyString(r["NAME"])?r["NAME"]:"";var a=BX.type.isNotEmptyString(r["FORMATTED_RATE"])?r["FORMATTED_RATE"]:"";if(s!==""&&a!==""){if(i!==""){i+=", "}i+=s+": "+a}}}var o=this.getSetting("infoHtmlTemplate","");var l=o.replace(/#PRODUCT_NAME#/gi,t.getStringParam("PRODUCT_NAME")).replace(/#QUANTITY#/gi,t.getStringParam("QUANTITY")).replace(/#FORMATTED_PRICE#/gi,t.getStringParam("FORMATTED_PRICE"));if(i!==""){l+=" ("+BX.util.htmlspecialchars(i)+")"}return l},_onDeleteButtonClick:function(t){this._list.processItemDeletion(this);return BX.PreventDefault(t)},_onEditButtonClick:function(t){this.openEditor();return BX.PreventDefault(t)},_onExternalEditComplete:function(t){var e=BX.type.isNotEmptyString(t["contextId"])?t["contextId"]:"";if(e!==this._list.getContextId()){return}var i=typeof t["modelData"]!=="undefined"?t["modelData"]:"";if(!i){return}var n=this._model.getFloatParam("PRICE");var r=typeof i["PRICE"]!=="undefined"?parseFloat(i["PRICE"]):0;var s=this._model.getIntParam("QUANTITY");var a=typeof i["QUANTITY"]!=="undefined"?parseInt(i["QUANTITY"]):0;var o=n!==r||s!==a;if(o){this._model.setData(i);this.resetLayout()}this._enableEditMode(false);this._list.afterItemModification(this,o)}};BX.CrmProductRowListItem.create=function(t){var e=new BX.CrmProductRowListItem;e.initialize(t);return e}}if(typeof BX.CrmActivityStorageType==="undefined"){BX.CrmActivityStorageType={undefined:0,file:1,webdav:2,disk:3}}
//# sourceMappingURL=crm_mobile.map.js