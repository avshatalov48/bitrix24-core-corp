BX.namespace("BX.Mobile.Tasks");window.Application=window.Application||window.BXMobileAppContext;BX.Mobile.Tasks.widget=function(e){BX.merge(this,{opts:{scope:false,controls:{},instances:{},instanceCode:false,bindEvents:{},removeTemplates:true,useSpawn:false,initializeByGlobalEvent:false,globalEventScope:"document",registerDispatcher:true,usePull:false,setTitle:true,setPullDown:true},vars:{},ctrls:{A:{},S:{}},tmpls:{},sys:{scope:null,stack:{init:[]},instances:{},classCode:"widget",instanceCode:false,initialized:false}});this.pushFuncStack("init",BX.Mobile.Tasks.widget);this.isuiWidget=true};BX.merge(BX.Mobile.Tasks.widget.prototype,{preInit:function(){var e=this,t=this.opts,s=this.ctrls,i=this.sys.classCode;if(!("querySelector"in document))throw new Error("Your browser does not support querySelector");if(!i.match(/^[a-zA-Z0-9-_]+$/))throw new Error('Only letters, digitis, "-" and "_" allowed in code');if(BX.type.isNotEmptyString(t.instanceCode)){this.sys.instanceCode=t.instanceCode}},init:function(){var e=this,t=this.ctrls,s=this.opts,i=this.sys,n=this.sys.classCode,o;if(s.scope!==false){i.scope=BX.type.isNotEmptyString(s.scope)?BX(s.scope):s.scope;if(!BX.type.isElementNode(i.scope))throw new Error("Bad scope: invalid node passed");if(s.useSpawn&&i.scope)e.tmpls["scope"]=i.scope.outerHTML;this.findTemplates()}if(typeof s.bindEvents=="object"){for(o in s.bindEvents){if(BX.type.isFunction(s.bindEvents[o]))this.bindEvent(o,s.bindEvents[o])}}s.bindEvents=null},destroy:function(){},option:function(e,t){if(typeof t=="undefined"){return this.opts[e]}else{this.opts[e]=t}},variable:function(e,t){if(typeof t=="undefined"){return this.vars[e]}else{this.vars[e]=t}},control:function(e,t,s){if(!BX.type.isNotEmptyString(e))throw new Error("Requested control id is incorrect");if(t!==false&&typeof t!=="undefined"&&t!==null){if(!BX.type.isDomNode(t))throw new TypeError("Bad control instance to keep");this.ctrls["S"]=t;return}if(!BX.type.isPlainObject(s))s={};if(typeof s.scope!="undefined"){if(!BX.type.isDomNode(s.scope))throw new Error("Scope provided is not a valid dom node")}else{if(!BX.type.isDomNode(this.sys.scope))throw new Error("Widget scope is not a valid dom node")}var i=s.scope||this.sys.scope,n=!!s.all,o=!!s.reCache,r=!!s.noCache;if(BX.type.isElementNode(this.opts.controls[e]))return this.opts.controls[e];var a=n?"A":"S";if(typeof this.ctrls[a][e]==="undefined"||o){var l=i[n?"querySelectorAll":"querySelector"](this.getControlSearchString(e));if(l!==null)this.ctrls[a][e]=l}var c=this.ctrls[a][e];if(r)delete this.ctrls[a][e];return c},getRequiredControl:function(e,t){return this.controlR.apply(this,[e,t])},controlR:function(e,t){var s=this.control(e,false,t);if(typeof s=="undefined"||s===null)throw new ReferenceError("Requested control can not be found: "+this.getControlSearchValue(e));return s},instance:function(e,t){if(typeof t!="undefined"){if(typeof t=="undefined"||typeof t===null)throw new TypeError("Bad instance reference");if(typeof this.sys.instances[e]!="undefined")throw new ReferenceError("Instance is already defined under code: "+e);this.sys.instances[e]=t}return this.sys.instances[e]},find:function(e){if(!BX.type.isNotEmptyString(e))return null;return this.sys.scope.querySelector(e)},findAll:function(e){if(!BX.type.isNotEmptyString(e))return[];return Array.prototype.slice.call(this.sys.scope.querySelectorAll(e))},template:function(e,t){if(typeof t=="undefined"){return this.tmpls[e]}else{if(!BX.type.isString(t))throw new TypeError("Bad template html");this.tmpls[e]=t}},findTemplates:function(){var e=this.scope().querySelectorAll('script[type="text/html"]');for(var t=0;t<e.length;t++){var s=BX.data(e[t],"bx-template-id");if(typeof s=="string"&&s.length>0&&s.search(this.classCode())==0){s=s.replace(this.classCode()+"-","");this.tmpls[s]=e[t].innerHTML;if(this.opts.removeTemplates)BX.remove(e[t])}}},getHTMLByTemplate:function(e,t){var s=this.tmpls[e];if(!BX.type.isNotEmptyString(s))return"";for(var i in t){if(typeof t[i]!="undefined"&&t.hasOwnProperty(i)){var n="";if(i.toString().indexOf("=")==0){n=t[i].toString();i=i.toString().substr(1)}else n=BX.util.htmlspecialchars(t[i]).toString();var o="{{"+i.toString().toLowerCase()+"}}";if(n.search(o)>=0)n="";while(s.search(o)>=0)s=s.replace(o,n)}}return s},createNodesByTemplate:function(e,t,s){var i=this.tmpls[e];if(!BX.type.isNotEmptyString(i))return null;i=i.replace(/^\s\s*/,"").replace(/\s\s*$/,"");var n=this.getHTMLByTemplate(e,t);var o=false;var r=false;if(i.search(/^<\s*(tr|th)[^<]*>/)>=0)o=true;else if(i.search(/^<\s*td[^<]*>/)>=0)r=true;var a=document.createElement("div");if(o||r){if(o){a.innerHTML="<table><tbody>"+n+"</tbody></table>";a=a.childNodes[0].childNodes[0]}else{a.innerHTML="<table><tbody><tr>"+n+"</tr></tbody></table>";a=a.childNodes[0].childNodes[0].childNodes[0]}}else a.innerHTML=n;if(s){var l=a.childNodes;var c=[];for(var p=0;p<l.length;p++)if(BX.type.isElementNode(l[p]))c.push(l[p]);return c}else return Array.prototype.slice.call(a.childNodes)},parentConstruct:function(e,t){var s=e.superclass;if(typeof s=="object")s.constructor.apply(this,[t,true])},handleInitStack:function(e,t,s){this.pushFuncStack("init",t);if(!e){BX.merge(this.opts,s);BX.Mobile.Tasks.widget.prototype.preInit.call(this);var i=function(){if(this.sys.initialized)return;this.resolveFuncStack("init");for(var e in this.sys.stack){if(e!="init")this.resolveFuncStack(e,true)}this.sys.initialized=true;this.fireEvent("init",[this])};if(BX.type.isString(this.opts.initializeByGlobalEvent)&&this.opts.initializeByGlobalEvent.length>0){var n=this.opts.globalEventScope=="window"?window:document;BX.addCustomEvent(n,this.opts.initializeByGlobalEvent,BX.proxy(i,this))}else i.call(this)}},pushFuncStack:function(e,t){if(BX.type.isFunction(t.prototype[e])){if(typeof this.sys.stack[e]=="undefined")this.sys.stack[e]=[];this.sys.stack[e].push({owner:t,f:t.prototype[e]})}},disableInFuncStack:function(e,t){var s=this.sys.stack[e];if(typeof s=="undefined")return;for(var i=0;i<s.length;i++){if(s[i].owner==t)s[i].f=BX.DoNothing}},resolveFuncStack:function(e,t){var s=this.sys.stack[e];if(typeof s=="undefined")return;for(var i=0;i<s.length;i++){s[i].f.call(this)}if(t)this.fireEvent(e,[this],document);this.sys.stack[e]=null},fireEvent:function(e,t,s){s=s||this;t=t||[];BX.onCustomEvent(s,"bx-tasks-ui-"+this.sys.classCode+"-"+e,t);return this},bindEvent:function(e,t){BX.addCustomEvent(this,"bx-tasks-ui-"+this.sys.classCode+"-"+e,t);return this},getControlSearchValue:function(e){return this.sys.classCode+"-"+(this.sys.instanceCode===false?"":this.sys.instanceCode.toLowerCase()+"-")+e},getControlSearchString:function(e){return'[data-bx-id~="'+this.getControlSearchValue(e)+'"]'},getClassCode:function(){return this.sys.classCode},classCode:function(){return this.getClassCode()},getInstanceCode:function(){return this.sys.instanceCode},getScope:function(){return this.sys.scope},scope:function(){return this.getScope()},passCtx:function(e,t){return function(){var s=Array.prototype.slice.call(arguments);s.unshift(t);e.apply(this,s)}}});BX.Mobile.Tasks.page=function(e,t){this.parentConstruct(BX.Mobile.Tasks.page,e);BX.merge(this,{sys:{classCode:"page"},vars:{userId:false},appCtrls:{menu:false}});this.handleInitStack(t,BX.Mobile.Tasks.page,e)};BX.extend(BX.Mobile.Tasks.page,BX.Mobile.Tasks.widget);BX.merge(BX.Mobile.Tasks.page.prototype,{init:function(){if(typeof window.BXMobileApp!="undefined"){var e=BX.message("PAGE_TITLE");if(BX.type.isNotEmptyString(e)&&this.option("setTitle")){window.BXMobileApp.UI.Page.TopBar.title.setText(e);window.BXMobileApp.UI.Page.TopBar.title.show()}}else throw new ReferenceError("BXMobileApp is not defined, no init is possible");if(typeof window.app=="undefined")throw new ReferenceError("app is not defined, no init is possible");else if(this.option("setPullDown")){window.app.pullDown({enable:false,pulltext:BX.message("MB_TASKS_PULLDOWN_PULL"),downtext:BX.message("MB_TASKS_PULLDOWN_DOWN"),loadtext:BX.message("MB_TASKS_PULLDOWN_LOADING"),action:"RELOAD",callback:function(){window.app.reload()}});BX.addCustomEvent("onOpenPageBefore",BX.delegate(this.getPageParameters,this));BX.ready(BX.delegate(this.getPageParameters,this))}if(this.option("usePull")){BX.addCustomEvent("onPull",BX.delegate(this.pullHandler,this))}},addFastClick:function(e){if(BX.type.isElementNode(e)&&typeof window.FastButton!="undefined"){document.addEventListener("DOMContentLoaded",(function(){new window.FastButton(e,(function(e){e.target.click()}))}),false)}},pullHandler:function(e){},pageOpenHandler:function(e){},dynamicActionsCustom:function(e){},getDefaultMenu:function(){return[]},resetMenu:function(e){var t="";if(BX.type.isArray(e)&&e.length>0){this.appCtrls.menu=new window.BXMobileApp.UI.Menu({items:e});t=BX.delegate(this.appCtrls.menu.show,this.appCtrls.menu)}window.BXMobileApp.UI.Page.TopBar.title.setCallback(t)},setUser:function(e){if(+e>0)this.variable("userId",+e)},getUser:function(){return this.variable("userId")},dynamicActions:function(e){try{this.setUser(e.userId)}catch(e){}this.dynamicActionsCustom(e)},getPageParameters:function(){if(typeof window.app=="undefined")throw new ReferenceError("app is not defined, pageOpenHandler() wont work");window.app.getPageParams({callback:BX.delegate(this.pageOpenHandler,this)})}});
//# sourceMappingURL=logic.map.js